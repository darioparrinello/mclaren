parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"FRly":[function(require,module,exports) {
"use strict";exports.byteLength=u,exports.toByteArray=i,exports.fromByteArray=d;for(var r=[],t=[],e="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=n.length;o<a;++o)r[o]=n[o],t[n.charCodeAt(o)]=o;function h(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=r.indexOf("=");return-1===e&&(e=t),[e,e===t?0:4-e%4]}function u(r){var t=h(r),e=t[0],n=t[1];return 3*(e+n)/4-n}function c(r,t,e){return 3*(t+e)/4-e}function i(r){var n,o,a=h(r),u=a[0],i=a[1],f=new e(c(r,u,i)),A=0,d=i>0?u-4:u;for(o=0;o<d;o+=4)n=t[r.charCodeAt(o)]<<18|t[r.charCodeAt(o+1)]<<12|t[r.charCodeAt(o+2)]<<6|t[r.charCodeAt(o+3)],f[A++]=n>>16&255,f[A++]=n>>8&255,f[A++]=255&n;return 2===i&&(n=t[r.charCodeAt(o)]<<2|t[r.charCodeAt(o+1)]>>4,f[A++]=255&n),1===i&&(n=t[r.charCodeAt(o)]<<10|t[r.charCodeAt(o+1)]<<4|t[r.charCodeAt(o+2)]>>2,f[A++]=n>>8&255,f[A++]=255&n),f}function f(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function A(r,t,e){for(var n,o=[],a=t;a<e;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(255&r[a+2]),o.push(f(n));return o.join("")}function d(t){for(var e,n=t.length,o=n%3,a=[],h=0,u=n-o;h<u;h+=16383)a.push(A(t,h,h+16383>u?u:h+16383));return 1===o?(e=t[n-1],a.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],a.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),a.join("")}t["-".charCodeAt(0)]=62,t["_".charCodeAt(0)]=63;
},{}],"Quj6":[function(require,module,exports) {
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),(o+=p+N>=1?n/f:n*Math.pow(2,1-N))*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],"aqZJ":[function(require,module,exports) {
var r={}.toString;module.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)};
},{}],"aMB2":[function(require,module,exports) {

var global = arguments[3];
var t=arguments[3],r=require("base64-js"),e=require("ieee754"),n=require("isarray");function i(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(r){return!1}}function o(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(t,r){if(o()<r)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r)).__proto__=f.prototype:(null===t&&(t=new f(r)),t.length=r),t}function f(t,r,e){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(t,r,e);if("number"==typeof t){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return s(this,t,r,e)}function s(t,r,e,n){if("number"==typeof r)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?g(t,r,e,n):"string"==typeof r?l(t,r,e):y(t,r)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function a(t,r,e,n){return h(r),r<=0?u(t,r):void 0!==e?"string"==typeof n?u(t,r).fill(e,n):u(t,r).fill(e):u(t,r)}function c(t,r){if(h(r),t=u(t,r<0?0:0|w(r)),!f.TYPED_ARRAY_SUPPORT)for(var e=0;e<r;++e)t[e]=0;return t}function l(t,r,e){if("string"==typeof e&&""!==e||(e="utf8"),!f.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(r,e),i=(t=u(t,n)).write(r,e);return i!==n&&(t=t.slice(0,i)),t}function p(t,r){var e=r.length<0?0:0|w(r.length);t=u(t,e);for(var n=0;n<e;n+=1)t[n]=255&r[n];return t}function g(t,r,e,n){if(r.byteLength,e<0||r.byteLength<e)throw new RangeError("'offset' is out of bounds");if(r.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");return r=void 0===e&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,e):new Uint8Array(r,e,n),f.TYPED_ARRAY_SUPPORT?(t=r).__proto__=f.prototype:t=p(t,r),t}function y(t,r){if(f.isBuffer(r)){var e=0|w(r.length);return 0===(t=u(t,e)).length?t:(r.copy(t,0,0,e),t)}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||W(r.length)?u(t,0):p(t,r);if("Buffer"===r.type&&n(r.data))return p(t,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function w(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function d(t){return+t!=t&&(t=0),f.alloc(+t)}function v(t,r){if(f.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var e=t.length;if(0===e)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return $(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return K(t).length;default:if(n)return $(t).length;r=(""+r).toLowerCase(),n=!0}}function E(t,r,e){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if((e>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return x(this,r,e);case"utf8":case"utf-8":return Y(this,r,e);case"ascii":return L(this,r,e);case"latin1":case"binary":return D(this,r,e);case"base64":return S(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,r,e);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,r,e){var n=t[r];t[r]=t[e],t[e]=n}function R(t,r,e,n,i){if(0===t.length)return-1;if("string"==typeof e?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=i?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(i)return-1;e=t.length-1}else if(e<0){if(!i)return-1;e=0}if("string"==typeof r&&(r=f.from(r,n)),f.isBuffer(r))return 0===r.length?-1:_(t,r,e,n,i);if("number"==typeof r)return r&=255,f.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,e):Uint8Array.prototype.lastIndexOf.call(t,r,e):_(t,[r],e,n,i);throw new TypeError("val must be string, number or Buffer")}function _(t,r,e,n,i){var o,u=1,f=t.length,s=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return-1;u=2,f/=2,s/=2,e/=2}function h(t,r){return 1===u?t[r]:t.readUInt16BE(r*u)}if(i){var a=-1;for(o=e;o<f;o++)if(h(t,o)===h(r,-1===a?0:o-a)){if(-1===a&&(a=o),o-a+1===s)return a*u}else-1!==a&&(o-=o-a),a=-1}else for(e+s>f&&(e=f-s),o=e;o>=0;o--){for(var c=!0,l=0;l<s;l++)if(h(t,o+l)!==h(r,l)){c=!1;break}if(c)return o}return-1}function A(t,r,e,n){e=Number(e)||0;var i=t.length-e;n?(n=Number(n))>i&&(n=i):n=i;var o=r.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var u=0;u<n;++u){var f=parseInt(r.substr(2*u,2),16);if(isNaN(f))return u;t[e+u]=f}return u}function m(t,r,e,n){return Q($(r,t.length-e),t,e,n)}function P(t,r,e,n){return Q(G(r),t,e,n)}function T(t,r,e,n){return P(t,r,e,n)}function B(t,r,e,n){return Q(K(r),t,e,n)}function U(t,r,e,n){return Q(H(r,t.length-e),t,e,n)}function S(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function Y(t,r,e){e=Math.min(t.length,e);for(var n=[],i=r;i<e;){var o,u,f,s,h=t[i],a=null,c=h>239?4:h>223?3:h>191?2:1;if(i+c<=e)switch(c){case 1:h<128&&(a=h);break;case 2:128==(192&(o=t[i+1]))&&(s=(31&h)<<6|63&o)>127&&(a=s);break;case 3:o=t[i+1],u=t[i+2],128==(192&o)&&128==(192&u)&&(s=(15&h)<<12|(63&o)<<6|63&u)>2047&&(s<55296||s>57343)&&(a=s);break;case 4:o=t[i+1],u=t[i+2],f=t[i+3],128==(192&o)&&128==(192&u)&&128==(192&f)&&(s=(15&h)<<18|(63&o)<<12|(63&u)<<6|63&f)>65535&&s<1114112&&(a=s)}null===a?(a=65533,c=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=c}return O(n)}exports.Buffer=f,exports.SlowBuffer=d,exports.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),exports.kMaxLength=o(),f.poolSize=8192,f._augment=function(t){return t.__proto__=f.prototype,t},f.from=function(t,r,e){return s(null,t,r,e)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(t,r,e){return a(null,t,r,e)},f.allocUnsafe=function(t){return c(null,t)},f.allocUnsafeSlow=function(t){return c(null,t)},f.isBuffer=function(t){return!(null==t||!t._isBuffer)},f.compare=function(t,r){if(!f.isBuffer(t)||!f.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var e=t.length,n=r.length,i=0,o=Math.min(e,n);i<o;++i)if(t[i]!==r[i]){e=t[i],n=r[i];break}return e<n?-1:n<e?1:0},f.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(t,r){if(!n(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return f.alloc(0);var e;if(void 0===r)for(r=0,e=0;e<t.length;++e)r+=t[e].length;var i=f.allocUnsafe(r),o=0;for(e=0;e<t.length;++e){var u=t[e];if(!f.isBuffer(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(i,o),o+=u.length}return i},f.byteLength=v,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)b(this,r,r+1);return this},f.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)b(this,r,r+3),b(this,r+1,r+2);return this},f.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)b(this,r,r+7),b(this,r+1,r+6),b(this,r+2,r+5),b(this,r+3,r+4);return this},f.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Y(this,0,t):E.apply(this,arguments)},f.prototype.equals=function(t){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===f.compare(this,t)},f.prototype.inspect=function(){var t="",r=exports.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},f.prototype.compare=function(t,r,e,n,i){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===e&&(e=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),r<0||e>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&r>=e)return 0;if(n>=i)return-1;if(r>=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),u=(e>>>=0)-(r>>>=0),s=Math.min(o,u),h=this.slice(n,i),a=t.slice(r,e),c=0;c<s;++c)if(h[c]!==a[c]){o=h[c],u=a[c];break}return o<u?-1:u<o?1:0},f.prototype.includes=function(t,r,e){return-1!==this.indexOf(t,r,e)},f.prototype.indexOf=function(t,r,e){return R(this,t,r,e,!0)},f.prototype.lastIndexOf=function(t,r,e){return R(this,t,r,e,!1)},f.prototype.write=function(t,r,e,n){if(void 0===r)n="utf8",e=this.length,r=0;else if(void 0===e&&"string"==typeof r)n=r,e=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(e)?(e|=0,void 0===n&&(n="utf8")):(n=e,e=void 0)}var i=this.length-r;if((void 0===e||e>i)&&(e=i),t.length>0&&(e<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return A(this,t,r,e);case"utf8":case"utf-8":return m(this,t,r,e);case"ascii":return P(this,t,r,e);case"latin1":case"binary":return T(this,t,r,e);case"base64":return B(this,t,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,r,e);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function O(t){var r=t.length;if(r<=I)return String.fromCharCode.apply(String,t);for(var e="",n=0;n<r;)e+=String.fromCharCode.apply(String,t.slice(n,n+=I));return e}function L(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(127&t[i]);return n}function D(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(t[i]);return n}function x(t,r,e){var n=t.length;(!r||r<0)&&(r=0),(!e||e<0||e>n)&&(e=n);for(var i="",o=r;o<e;++o)i+=Z(t[o]);return i}function C(t,r,e){for(var n=t.slice(r,e),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function M(t,r,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+r>e)throw new RangeError("Trying to access beyond buffer length")}function k(t,r,e,n,i,o){if(!f.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<o)throw new RangeError('"value" argument is out of bounds');if(e+n>t.length)throw new RangeError("Index out of range")}function N(t,r,e,n){r<0&&(r=65535+r+1);for(var i=0,o=Math.min(t.length-e,2);i<o;++i)t[e+i]=(r&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function z(t,r,e,n){r<0&&(r=4294967295+r+1);for(var i=0,o=Math.min(t.length-e,4);i<o;++i)t[e+i]=r>>>8*(n?i:3-i)&255}function F(t,r,e,n,i,o){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function j(t,r,n,i,o){return o||F(t,r,n,4,3.4028234663852886e38,-3.4028234663852886e38),e.write(t,r,n,i,23,4),n+4}function q(t,r,n,i,o){return o||F(t,r,n,8,1.7976931348623157e308,-1.7976931348623157e308),e.write(t,r,n,i,52,8),n+8}f.prototype.slice=function(t,r){var e,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t),f.TYPED_ARRAY_SUPPORT)(e=this.subarray(t,r)).__proto__=f.prototype;else{var i=r-t;e=new f(i,void 0);for(var o=0;o<i;++o)e[o]=this[o+t]}return e},f.prototype.readUIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n},f.prototype.readUIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t+--r],i=1;r>0&&(i*=256);)n+=this[t+--r]*i;return n},f.prototype.readUInt8=function(t,r){return r||M(t,1,this.length),this[t]},f.prototype.readUInt16LE=function(t,r){return r||M(t,2,this.length),this[t]|this[t+1]<<8},f.prototype.readUInt16BE=function(t,r){return r||M(t,2,this.length),this[t]<<8|this[t+1]},f.prototype.readUInt32LE=function(t,r){return r||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},f.prototype.readUInt32BE=function(t,r){return r||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},f.prototype.readIntLE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*r)),n},f.prototype.readIntBE=function(t,r,e){t|=0,r|=0,e||M(t,r,this.length);for(var n=r,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*r)),o},f.prototype.readInt8=function(t,r){return r||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},f.prototype.readInt16LE=function(t,r){r||M(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt16BE=function(t,r){r||M(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e},f.prototype.readInt32LE=function(t,r){return r||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},f.prototype.readInt32BE=function(t,r){return r||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},f.prototype.readFloatLE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!0,23,4)},f.prototype.readFloatBE=function(t,r){return r||M(t,4,this.length),e.read(this,t,!1,23,4)},f.prototype.readDoubleLE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!0,52,8)},f.prototype.readDoubleBE=function(t,r){return r||M(t,8,this.length),e.read(this,t,!1,52,8)},f.prototype.writeUIntLE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=1,o=0;for(this[r]=255&t;++o<e&&(i*=256);)this[r+o]=t/i&255;return r+e},f.prototype.writeUIntBE=function(t,r,e,n){(t=+t,r|=0,e|=0,n)||k(this,t,r,e,Math.pow(2,8*e)-1,0);var i=e-1,o=1;for(this[r+i]=255&t;--i>=0&&(o*=256);)this[r+i]=t/o&255;return r+e},f.prototype.writeUInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,255,0),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1},f.prototype.writeUInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeUInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeUInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):z(this,t,r,!0),r+4},f.prototype.writeUInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeIntLE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=0,u=1,f=0;for(this[r]=255&t;++o<e&&(u*=256);)t<0&&0===f&&0!==this[r+o-1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeIntBE=function(t,r,e,n){if(t=+t,r|=0,!n){var i=Math.pow(2,8*e-1);k(this,t,r,e,i-1,-i)}var o=e-1,u=1,f=0;for(this[r+o]=255&t;--o>=0&&(u*=256);)t<0&&0===f&&0!==this[r+o+1]&&(f=1),this[r+o]=(t/u>>0)-f&255;return r+e},f.prototype.writeInt8=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,1,127,-128),f.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=255&t,r+1},f.prototype.writeInt16LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):N(this,t,r,!0),r+2},f.prototype.writeInt16BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):N(this,t,r,!1),r+2},f.prototype.writeInt32LE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):z(this,t,r,!0),r+4},f.prototype.writeInt32BE=function(t,r,e){return t=+t,r|=0,e||k(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),f.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):z(this,t,r,!1),r+4},f.prototype.writeFloatLE=function(t,r,e){return j(this,t,r,!0,e)},f.prototype.writeFloatBE=function(t,r,e){return j(this,t,r,!1,e)},f.prototype.writeDoubleLE=function(t,r,e){return q(this,t,r,!0,e)},f.prototype.writeDoubleBE=function(t,r,e){return q(this,t,r,!1,e)},f.prototype.copy=function(t,r,e,n){if(e||(e=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<e&&(n=e),n===e)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-e&&(n=t.length-r+e);var i,o=n-e;if(this===t&&e<r&&r<n)for(i=o-1;i>=0;--i)t[i+r]=this[i+e];else if(o<1e3||!f.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+r]=this[i+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+o),r);return o},f.prototype.fill=function(t,r,e,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,e=this.length):"string"==typeof e&&(n=e,e=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<e)throw new RangeError("Out of range index");if(e<=r)return this;var o;if(r>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0),"number"==typeof t)for(o=r;o<e;++o)this[o]=t;else{var u=f.isBuffer(t)?t:$(new f(t,n).toString()),s=u.length;for(o=0;o<e-r;++o)this[o+r]=u[o%s]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function X(t){if((t=J(t).replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function J(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Z(t){return t<16?"0"+t.toString(16):t.toString(16)}function $(t,r){var e;r=r||1/0;for(var n=t.length,i=null,o=[],u=0;u<n;++u){if((e=t.charCodeAt(u))>55295&&e<57344){if(!i){if(e>56319){(r-=3)>-1&&o.push(239,191,189);continue}if(u+1===n){(r-=3)>-1&&o.push(239,191,189);continue}i=e;continue}if(e<56320){(r-=3)>-1&&o.push(239,191,189),i=e;continue}e=65536+(i-55296<<10|e-56320)}else i&&(r-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((r-=1)<0)break;o.push(e)}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,63&e|128)}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return o}function G(t){for(var r=[],e=0;e<t.length;++e)r.push(255&t.charCodeAt(e));return r}function H(t,r){for(var e,n,i,o=[],u=0;u<t.length&&!((r-=2)<0);++u)n=(e=t.charCodeAt(u))>>8,i=e%256,o.push(i),o.push(n);return o}function K(t){return r.toByteArray(X(t))}function Q(t,r,e,n){for(var i=0;i<n&&!(i+e>=r.length||i>=t.length);++i)r[i+e]=t[i];return i}function W(t){return t!=t}
},{"base64-js":"FRly","ieee754":"Quj6","isarray":"aqZJ","buffer":"aMB2"}],"rbXN":[function(require,module,exports) {
var Buffer = require("buffer").Buffer;
var Buffer=require("buffer").Buffer;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorKeyframeTrack=exports.Color=exports.Clock=exports.ClearcoatTintPlugin=exports.ClampToEdgeWrapping=exports.CircleGeometry=exports.CircleBufferGeometry=exports.CineonToneMapping=exports.ChromaticAberrationPlugin=exports.CatmullRomCurve3=exports.CapsuleGeometry=exports.CapsuleBufferGeometry=exports.CanvasTexture=exports.CanvasSnipperPlugin=exports.CanvasSnipper=exports.CanvasRecorderPlugin=exports.CanvasRecorder=exports.CameraViewPlugin=exports.CameraView=exports.CameraUiPlugin=exports.CameraHelper=exports.CameraController=exports.Camera=exports.Cache=exports.CSS3DRendererPlugin=exports.CSGPluginBase=exports.CSGPluginBVH=exports.CSGPluginBSP=exports.ByteType=exports.BufferGeometryLoader=exports.BufferGeometry=exports.BufferAttribute=exports.BoxSelectionWidget=exports.BoxHelper=exports.BoxGeometry=exports.BoxBufferGeometry=exports.Box3Helper=exports.Box3B=exports.Box3=exports.Box2=exports.BooleanKeyframeTrack=exports.Bone=exports.BloomPlugin=exports.BlobLoader=exports.BasicShadowMap=exports.BasicDepthPacking=exports.BaseRenderer=exports.BaseGroundPlugin=exports.BackSide=exports.AxesHelper=exports.AudioLoader=exports.AudioListener=exports.AudioContext=exports.AudioAnalyser=exports.Audio=exports.AsyncZlib=exports.AsyncZipDeflate=exports.AsyncUnzlib=exports.AsyncUnzipInflate=exports.AsyncInflate=exports.AsyncGzip=exports.AsyncGunzip=exports.AsyncDeflate=exports.AsyncDecompress=exports.AsyncCompress=exports.AssetManagerPlugin=exports.AssetManagerLoadingBarPlugin=exports.AssetManagerBasicPopupPlugin=exports.AssetImporter=exports.AssetExporterPlugin=exports.AssetExporter=exports.ArrowHelper=exports.ArrayCamera=exports.ArcCurve=exports.AnisotropyPlugin=exports.AnimationUtils=exports.AnimationObjectGroup=exports.AnimationMixer=exports.AnimationLoader=exports.AnimationClip=exports.AmbientLightProbe=exports.AmbientLight2=exports.AmbientLight=exports.AlwaysStencilFunc=exports.AlwaysDepth=exports.AlphaFormat=exports.AdditiveBlending=exports.AdditiveAnimationBlendMode=exports.AddOperation=exports.AddEquation=exports.AddBlendPass=exports.AViewerPlugin=exports.AShaderMaterial2=exports.ARTouchInputHelper=exports.ARPlugin=exports.ARPlacementBox=exports.AMaterialManager=exports.ACameraControlsPlugin=exports.ACESFilmicToneMapping=exports.AAssetManagerProcessStatePlugin=void 0,exports.FrameFadePlugin=exports.FogExp2=exports.Fog=exports.FloatType=exports.Float64BufferAttribute=exports.Float32BufferAttribute=exports.Float16BufferAttribute=exports.FirstPersonControlsPlugin=exports.FirstPersonControls2=exports.FilmicGrainPlugin=exports.FileLoader=exports.FSShadowMaterial=exports.FBXLoadPlugin=exports.ExtrudeGeometry=exports.ExtrudeBufferGeometry=exports.ExtrasUiPlugin=exports.EventDispatcher=exports.Euler=exports.EquirectangularRefractionMapping=exports.EquirectangularReflectionMapping=exports.EqualStencilFunc=exports.EqualDepth=exports.EncodeUTF8=exports.EllipseCurve3D=exports.EllipseCurve=exports.EffectComposer2=exports.EdgesGeometry=exports.EasingFunctions=exports.EXRLoadPlugin=exports.DynamicReadUsage=exports.DynamicDrawUsage=exports.DynamicCopyUsage=exports.DstColorFactor=exports.DstAlphaFactor=exports.DropzonePlugin=exports.Dropzone=exports.DoubleSide=exports.DodecahedronGeometry=exports.DodecahedronBufferGeometry=exports.DiscreteInterpolant=exports.DirectionalLightHelper=exports.DirectionalLight2=exports.DirectionalLight=exports.DiamondPlugin=exports.DiamondMaterial=exports.DeviceOrientationControlsPlugin=exports.DeviceOrientationControls2=exports.DepthTexture=exports.DepthStencilFormat=exports.DepthOfFieldPlugin=exports.DepthOfFieldPass=exports.DepthFormat=exports.Deflate=exports.DefaultLoadingManager=exports.DecrementWrapStencilOp=exports.DecrementStencilOp=exports.Decompress=exports.DecodeUTF8=exports.DebugPlugin=exports.DataUtils=exports.DataUrlLoader=exports.DataTextureLoader=exports.DataTexture3D=exports.DataTexture2DArray=exports.DataTexture=exports.DataArrayTexture=exports.Data3DTexture=exports.Damper=exports.DRACOLoader2=exports.DECAY_MILLISECONDS=exports.Cylindrical=exports.CylinderGeometry=exports.CylinderBufferGeometry=exports.CustomToneMapping=exports.CustomBumpMapPlugin=exports.CustomBlending=exports.CurvePath=exports.Curve=exports.CullFaceNone=exports.CullFaceFrontBack=exports.CullFaceFront=exports.CullFaceBack=exports.CubicInterpolant=exports.CubicBezierCurve3=exports.CubicBezierCurve=exports.CubeUVReflectionMapping=exports.CubeTextureLoader=exports.CubeTexture=exports.CubeRefractionMapping=exports.CubeReflectionMapping=exports.CubeNormalsCaptureHelper=exports.CubeCamera=exports.ContactShadowGroundPlugin=exports.ConeGeometry=exports.ConeBufferGeometry=exports.CompressedTextureLoader=exports.CompressedTexture=exports.Compress=exports.CombinedPostPlugin=exports.ColorManagement=void 0,exports.LoadingManager=exports.LoaderUtils=exports.Loader=exports.LinearToneMapping=exports.LinearSRGBColorSpace=exports.LinearMipmapNearestFilter=exports.LinearMipmapLinearFilter=exports.LinearMipMapNearestFilter=exports.LinearMipMapLinearFilter=exports.LinearInterpolant=exports.LinearFilter=exports.LinearEncoding=exports.LineSegments=exports.LineLoop=exports.LineDashedMaterial=exports.LineCurve3=exports.LineCurve=exports.LineBasicMaterial=exports.Line3=exports.Line=exports.LightsUiPlugin=exports.LightProbe=exports.Light=exports.LessStencilFunc=exports.LessEqualStencilFunc=exports.LessEqualDepth=exports.LessDepth=exports.Layers=exports.LatheGeometry=exports.LatheBufferGeometry=exports.LUTPlugin=exports.LOD=exports.KeyframeTrack=exports.KeepStencilOp=exports.KTXLoadPlugin=exports.KTX2LoadPlugin=exports.KHR_TEXTURE_BASISU=exports.InvertStencilOp=exports.InterpolateSmooth=exports.InterpolateLinear=exports.InterpolateDiscrete=exports.Interpolant=exports.InterleavedBufferAttribute=exports.InterleavedBuffer=exports.IntType=exports.Int8BufferAttribute=exports.Int32BufferAttribute=exports.Int16BufferAttribute=exports.InstancedMesh=exports.InstancedInterleavedBuffer=exports.InstancedBufferGeometry=exports.InstancedBufferAttribute=exports.Inflate=exports.IncrementWrapStencilOp=exports.IncrementStencilOp=exports.Importer=exports.ImmediateRenderObject=exports.ImageUtils=exports.ImageLoader=exports.ImageBitmapLoader=exports.IcosahedronGeometry=exports.IcosahedronBufferGeometry=exports.HierarchyUiPlugin=exports.HemisphereLightProbe=exports.HemisphereLightHelper=exports.HemisphereLight=exports.HalfFloatType=exports.HDRiGroundPlugin=exports.Gzip=exports.Gunzip=exports.Group=exports.GroundPlugin=exports.GridHelper=exports.GreaterStencilFunc=exports.GreaterEqualStencilFunc=exports.GreaterEqualDepth=exports.GreaterDepth=exports.GenericFilterPlugin=exports.GenericBlendTexturePass=exports.GammaCorrectionPlugin=exports.GammaCorrectionExtension=exports.GLTFWriter2=exports.GLTFMeshOptPlugin=exports.GLTFMaterialsLightMapExtensionName=exports.GLTFMaterialsDisplacementMapExtensionName=exports.GLTFMaterialsBumpMapExtensionName=exports.GLTFMaterialsAlphaMapExtensionName=exports.GLTFLoader2=exports.GLTFExporter2=exports.GLTFDracoExporter=exports.GLTFDracoExportPlugin=exports.GLTFAnimationPlugin=exports.GLSL3=exports.GLSL1=exports.GLBufferAttribute=exports.GBufferPlugin=exports.FullScreenPlugin=exports.Frustum=exports.FrontSide=exports.FramebufferTexture=void 0,exports.PolyhedronGeometry=exports.PolyhedronBufferGeometry=exports.PolarGridHelper=exports.PointsMaterial=exports.Points=exports.PointerLockControlsPlugin=exports.PointerLockControls2=exports.PointLightHelper=exports.PointLight2=exports.PointLight=exports.PlaneHelper=exports.PlaneGeometry=exports.PlaneBufferGeometry=exports.Plane=exports.PickingPlugin=exports.PerspectiveCamera=exports.Path=exports.ParallaxMappingPlugin=exports.PMREMGeneratorPlugin=exports.PMREMGenerator=exports.PCFSoftShadowMap=exports.PCFShadowMap=exports.OutlinePlugin=exports.OrthographicCamera=exports.OrbitControls3=exports.OrbitControls2=exports.OneMinusSrcColorFactor=exports.OneMinusSrcAlphaFactor=exports.OneMinusDstColorFactor=exports.OneMinusDstAlphaFactor=exports.OneFactor=exports.OctahedronGeometry=exports.OctahedronBufferGeometry=exports.ObjectSpaceNormalMap=exports.ObjectRotationPlugin=exports.ObjectProcessorMap=exports.ObjectPicker=exports.ObjectLoader2=exports.ObjectLoader=exports.Object3DModel=exports.Object3D=exports.ObjMtlLoadPlugin=exports.OBJLoader2=exports.NumberKeyframeTrack=exports.NotEqualStencilFunc=exports.NotEqualDepth=exports.NormalCaptureMaterial=exports.NormalBufferPlugin=exports.NormalBlending=exports.NormalAnimationBlendMode=exports.NoiseBumpMaterialPlugin=exports.NoToneMapping=exports.NoColorSpace=exports.NoBlending=exports.NeverStencilFunc=exports.NeverDepth=exports.NearestMipmapNearestFilter=exports.NearestMipmapLinearFilter=exports.NearestMipMapNearestFilter=exports.NearestMipMapLinearFilter=exports.NearestFilter=exports.MultiplyOperation=exports.MultiplyBlending=exports.MultiFilterPlugin=exports.MixOperation=exports.MirroredRepeatWrapping=exports.MinEquation=exports.MeshToonMaterial=exports.MeshStandardMaterial2=exports.MeshStandardMaterial=exports.MeshPhysicalMaterial=exports.MeshPhongMaterial=exports.MeshNormalMaterial=exports.MeshMatcapMaterial=exports.MeshLambertMaterial=exports.MeshDistanceMaterial=exports.MeshDepthMaterial=exports.MeshBasicMaterial2=exports.MeshBasicMaterial=exports.Mesh=exports.MaxEquation=exports.Matrix4=exports.Matrix3=exports.MathUtils=exports.MaterialPreviewGenerator=exports.MaterialManager=exports.MaterialLoader=exports.MaterialLibraryPlugin=exports.MaterialLibraryBasePlugin=exports.MaterialExtender=exports.MaterialConfiguratorPlugin=exports.MaterialConfiguratorBasePlugin=exports.Material=exports.MTLLoader2=exports.MOUSE=exports.LuminanceFormat=exports.LuminanceAlphaFormat=exports.LoopRepeat=exports.LoopPingPong=exports.LoopOnce=void 0,exports.SimpleTextExporter=exports.SimpleJSONLoader=exports.SimpleJSONExporter=exports.SimpleEventDispatcher=exports.SimpleDataSource=exports.SimpleBackgroundEnvUiPlugin=exports.SimpleAssetList=exports.ShortType=exports.ShapeUtils=exports.ShapeTubeExtrudePlugin=exports.ShapePath=exports.ShapeGeometry=exports.ShapeBufferGeometry=exports.Shape=exports.ShadowMaterial=exports.ShadowMapBaker=exports.ShaderPass2=exports.ShaderMaterialEncodingSupport=exports.ShaderMaterial2=exports.ShaderMaterial=exports.ShaderLib=exports.ShaderChunk=exports.SelectionWidget=exports.SceneLoopPlugin=exports.SceneCamerasUiPlugin=exports.Scene=exports.STLLoadPlugin=exports.SSRPlugin=exports.SSGIPlugin=exports.SSContactShadows=exports.SSBevelPlugin=exports.SSAOPlugin=exports.SRGBColorSpace=exports.SETTLING_TIME=exports.RootScene=exports.RingGeometry=exports.RingBufferGeometry=exports.Rhino3dmLoader2=exports.Rhino3dmLoadPlugin=exports.ReverseSubtractEquation=exports.ReplaceStencilOp=exports.RepeatWrapping=exports.RendererUiPlugin=exports.ReinhardToneMapping=exports.Reflector2=exports.RedIntegerFormat=exports.RedFormat=exports.RectAreaLight=exports.Raycaster=exports.Ray=exports.RawShaderMaterial=exports.RandomizedDirectionalLightPlugin=exports.RandomizedDirectionalLight=exports.RGIntegerFormat=exports.RGFormat=exports.RGB_S3TC_DXT1_Format=exports.RGB_PVRTC_4BPPV1_Format=exports.RGB_PVRTC_2BPPV1_Format=exports.RGB_ETC2_Format=exports.RGB_ETC1_Format=exports.RGBM7Encoding=exports.RGBM16Encoding_=exports.RGBM16Encoding=exports.RGBFormat=exports.RGBA_S3TC_DXT5_Format=exports.RGBA_S3TC_DXT3_Format=exports.RGBA_S3TC_DXT1_Format=exports.RGBA_PVRTC_4BPPV1_Format=exports.RGBA_PVRTC_2BPPV1_Format=exports.RGBA_ETC2_EAC_Format=exports.RGBA_BPTC_Format=exports.RGBA_ASTC_8x8_Format=exports.RGBA_ASTC_8x6_Format=exports.RGBA_ASTC_8x5_Format=exports.RGBA_ASTC_6x6_Format=exports.RGBA_ASTC_6x5_Format=exports.RGBA_ASTC_5x5_Format=exports.RGBA_ASTC_5x4_Format=exports.RGBA_ASTC_4x4_Format=exports.RGBA_ASTC_12x12_Format=exports.RGBA_ASTC_12x10_Format=exports.RGBA_ASTC_10x8_Format=exports.RGBA_ASTC_10x6_Format=exports.RGBA_ASTC_10x5_Format=exports.RGBA_ASTC_10x10_Format=exports.RGBAIntegerFormat=exports.RGBAFormat=exports.RGBADepthPacking=exports.REVISION=exports.QuaternionLinearInterpolant=exports.QuaternionKeyframeTrack=exports.Quaternion=exports.QuadraticBezierCurve3=exports.QuadraticBezierCurve=exports.PropertyMixer=exports.PropertyBinding=exports.ProgressivePlugin=exports.PresetLibraryPlugin=exports.PositionalAudio=exports.PopmotionPlugin=void 0,exports.WrapAroundEnding=exports.WireframeGeometry=exports.WindowiseDialogPlugin=exports.WebGiViewerElement=exports.WebGLUtils=exports.WebGLRenderer=exports.WebGLRenderTarget=exports.WebGLMultisampleRenderTarget=exports.WebGLMultipleRenderTargets=exports.WebGLCubeRenderTarget=exports.WebGLArrayRenderTarget=exports.WebGL3DRenderTarget=exports.WebGL1Renderer=exports.VignettePlugin=exports.ViewerState=exports.ViewerApp=exports.VideoTexture=exports.VelocityBufferPlugin=exports.VectorKeyframeTrack=exports.Vector4=exports.Vector3=exports.Vector2=exports.VSMShadowMap=exports.Unzlib=exports.UnzipPassThrough=exports.UnzipInflate=exports.Unzip=exports.UnsignedShortType=exports.UnsignedShort5551Type=exports.UnsignedShort4444Type=exports.UnsignedIntType=exports.UnsignedInt248Type=exports.UnsignedByteType=exports.UniformsUtils=exports.UniformsLib=exports.UniformsGroup=exports.Uniform=exports.Uncharted2Tonemapping=exports.Uint8ClampedBufferAttribute=exports.Uint8BufferAttribute=exports.Uint32BufferAttribute=exports.Uint16BufferAttribute=exports.UVMapping=exports.TweakpaneWrapper=exports.TweakpaneUiPlugin=exports.TubeShapeGeometry=exports.TubeGeometry=exports.TubeBufferGeometry=exports.TrianglesDrawMode=exports.TriangleStripDrawMode=exports.TriangleFanDrawMode=exports.Triangle=exports.TransformControls2=exports.TorusKnotGeometry=exports.TorusKnotBufferGeometry=exports.TorusGeometry=exports.TorusBufferGeometry=exports.TonemapPlugin=exports.ThreeMaterialLoader=exports.ThinFilmLayerPlugin=exports.TextureLoader=exports.Texture=exports.TextSVGOptions=exports.TetrahedronGeometry=exports.TetrahedronBufferGeometry=exports.TemporalAAPlugin=exports.TangentSpaceNormalMap=exports.TOUCH=exports.SwitchNodePlugin=exports.SubtractiveBlending=exports.SubtractEquation=exports.StringKeyframeTrack=exports.StreamReadUsage=exports.StreamDrawUsage=exports.StreamCopyUsage=exports.StereoCamera=exports.StaticReadUsage=exports.StaticDrawUsage=exports.StaticCopyUsage=exports.SrcColorFactor=exports.SrcAlphaSaturateFactor=exports.SrcAlphaFactor=exports.SpriteMaterial=exports.Sprite=exports.SpotLightHelper=exports.SpotLight2=exports.SpotLight=exports.SplineCurve=exports.SphericalHarmonics3=exports.Spherical=exports.SphereSelectionWidget=exports.SphereGeometry=exports.SphereBufferGeometry=exports.Sphere=exports.Source=exports.SkinnedMesh=exports.SkeletonHelper=exports.Skeleton=exports.SimpleViewerUi=exports.SimpleTextPlugin=void 0,exports.degreesToRadians=exports.deflateSync=exports.deflate=exports.deepAccessObject=exports.decompressSync=exports.decompress=exports.decay=exports.dataTextureFromVec4=exports.dataTextureFromColor=exports.cubicBezier=exports.css=exports.csgOperations=exports.createStyles=exports.createScriptFromURL=exports.createRenderTargetKey=exports.createPopperLite=exports.createPopperBase=exports.createPopper=exports.createImage=exports.createIFrameCSS3DObject=exports.createExpoIn=exports.createDiv=exports.createCanvasElement=exports.createBackIn=exports.createAttractor=exports.createAnticipate=exports.copyTextureUserData=exports.copyProps=exports.copyObject3DUserData=exports.copyMaterialUserData=exports.computeStyles=exports.computeScreenSpaceBoundingBox=exports.computeOffsetMatrix=exports.computeGeometrySize=exports.computeGeometryCenter=exports.computeEigenVectors=exports.computeAverageGeometryNormal=exports.compressSync=exports.compress=exports.combineDofShader=exports.clippingParents=exports.clamp=exports.circOut=exports.circInOut=exports.circIn=exports.cRGBMToLinear=exports.cLinearToRGBM=exports.buildCSGMeshBVH=exports.buildCSGMeshBSP=exports.bounceOut=exports.bounceInOut=exports.bounceIn=exports.bottom=exports.blobToDataURL=exports.beforeWrite=exports.beforeRead=exports.beforeMain=exports.basicMaterialPropList=exports.basePlacements=exports.base64ToArrayBuffer=exports.backOut=exports.backInOut=exports.backIn=exports.autoScaleObject3D=exports.autoCenterObject3D=exports.auto=exports.attractExpo=exports.attract=exports.arrow=exports.arrayBufferToBase64=exports.applyStyles=exports.applyOffset=exports.anticipate=exports.animateTarget=exports.animateSet=exports.animatePromise=exports.animateObject=exports.animateAsync=exports.animate=exports.angle=exports.afterWrite=exports.afterRead=exports.afterMain=exports.addZipLoader=exports.addRGBELoader=exports.addLUTData=exports.addGLTFLoader=exports.addGLTFExporter=exports.addDracoLoader=exports.addBasePlugins=exports._SRGBAFormat=exports.Zlib=exports.ZipPassThrough=exports.ZipLoader=exports.ZipDeflate=exports.Zip=exports.ZeroStencilOp=exports.ZeroSlopeEnding=exports.ZeroFactor=exports.ZeroCurvatureEnding=void 0,exports.reference=exports.read=exports.radiansToDegrees=exports.progress=exports.processViewer=exports.preventOverflow=exports.popperOffsets=exports.popperGenerator=exports.popper=exports.pointFromVector=exports.placements=exports.pipe=exports.physicalMaterialPropList=exports.pathJoin=exports.patchShaderEncodingSupport=exports.parseFileExtension=exports.onChange=exports.offset=exports.now=exports.modifierPhases=exports.mobileAndTabletCheck=exports.mixComplex=exports.mixColor=exports.mix=exports.mirrorEasing=exports.matDefine=exports.makeTextSvg=exports.makeSetterForAnimObject=exports.makeSetterFor=exports.makeSamplerUi=exports.makeFilter=exports.makeColorSvgCircle=exports.makeColorSvg=exports.main=exports.linear=exports.lerpAngle2=exports.lerpAngle=exports.left=exports.keyframes=exports.isPropertyWritable=exports.isPoint3D=exports.isPoint=exports.isAnimatableType=exports.interpolate=exports.inflateSync=exports.inflate=exports.inertia=exports.includesAll=exports.imageUrlToImageData=exports.imageToCanvas=exports.imageBitmapToBase64=exports.iTextureIgnoredUserData=exports.iModelIgnoredUserData=exports.iMaterialIgnoredUserData=exports.iGeometryIgnoredUserData=exports.htmlToSvg=exports.htmlToPng=exports.htmlToCanvas=exports.html=exports.hide=exports.gzipSync=exports.gzip=exports.gunzipSync=exports.gunzip=exports.glsl=exports.getUrlQueryParam=exports.getTypedArray=exports.getTextureEncodingFromMap=exports.getTextureDataType=exports.getTexelEncodingFunction=exports.getTexelEncoding=exports.getTexelDecodingFunction=exports.getTexelDecoding2=exports.getTexelDecoding=exports.getPropertyDescriptor=exports.getOrCall=exports.getKeyByValue=exports.getFilenameFromPath=exports.getEncodingComponents=exports.generateUiFolder=exports.generateUiConfig=exports.fontFormatExtensionMap=exports.flip=exports.flattenUiConfig=exports.extractAnimationKey=exports.eventListeners=exports.escapeRegExp=exports.envMapBackground=exports.end=exports.embedUrlRefs=exports.easeOut=exports.easeInOut=exports.easeIn=exports.downloadFile=exports.downloadBlob=exports.distance=exports.diamondMaterialPropList=exports.detectOverflow=exports.deserializers=exports.deserializeObject=void 0,exports.zlibSync=exports.zlib=exports.zipSync=exports.zip=exports.writeFile=exports.write=exports.wrap=exports.webgiObject3DExtrasExtension=exports.webgiMaterialExtrasExtension=exports.webgiLightExtrasExtension=exports.viewport=exports.viewerGLTFExtension=exports.verifyPermission=exports.velocityPerSecond=exports.velocityPerFrame=exports.variationPlacements=exports.vRGBMToLinear=exports.vLinearToRGBM=exports.uploadFile=exports.unzlibSync=exports.unzlib=exports.unzipSync=exports.unzip=exports.uniform=exports.uiVector=exports.uiToggle=exports.uiSlider=exports.uiPanel=exports.uiMonitor=exports.uiInput=exports.uiImage=exports.uiFolder=exports.uiDropdown=exports.uiConfig=exports.uiColor=exports.uiButton=exports.top=exports.toTitleCase=exports.toIndexedGeometry=exports.toDecimal=exports.timeout=exports.syncAnimSetUi=exports.svgUrl=exports.svgToPng=exports.svgToCanvas=exports.strToU8=exports.strFromU8=exports.steps=exports.start=exports.standardMaterialPropList=exports.spring=exports.sphericalFromObject=exports.snapObject=exports.snap=exports.smoothFrame=exports.smooth=exports.slerp=exports.shaderReplaceString=exports.setupSandboxWebGiEditor=exports.setupObject3dModel=exports.setupIModel=exports.setupCoreWebGiViewer=exports.setUrlQueryParam=exports.setThreeRendererMode=exports.setMeshMaterial=exports.setMeshGeometry=exports.serializers=exports.serializeObject=exports.serialize=exports.serializable=exports.safeSetProperty=exports.sRGBEncoding=exports.rotateDuplicatedMesh=exports.right=exports.reverseEasing=exports.replaceAll=exports.removeDuplicateGeometries=void 0;var __webpackgi_modules__={44:function(e,t,r){var i=r(352),n=r.n(i)()(function(e){return e[1]});n.push([e.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:transparent;height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:#222222aa;text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),t.Z=n},798:function(e,t,r){var i=r(352),n=r.n(i)()(function(e){return e[1]});n.push([e.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),t.Z=n},898:function(e,t,r){var i=r(352),n=r.n(i)()(function(e){return e[1]});n.push([e.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),t.Z=n},513:function(e,t,r){var i=r(352),n=r.n(i)()(function(e){return e[1]});n.push([e.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),t.Z=n},476:function(e){var t;t=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i={convertToObject:function(e){var t=e.substring(e.indexOf("{")+1).trim().slice(0,-1),r={};return t.split(";").map(function(e){if(e=e.trim()){var t=e.split(":");r[t[0].trim()]=t[1].trim()}}),r},getFromSheets:function(e){var t=document.styleSheets;for(var r in t){var n=null;try{n=t[r].rules||t[r].cssRules}catch(e){}if(n)for(var s in n)if(n[s].selectorText&&-1!=n[s].selectorText.split(",").indexOf(e))return n[s].cssText?i.convertToObject(n[s].cssText):i.convertToObject(n[s].style.cssText)}return{}},getPropertyDefault:function(e){return"timing-function"==e?"ease":"iteration-count"==e?1:"direction"==e?"normal":"fill-mode"==e?"none":null}};t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i={generateId:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<8;++r)e+=t.charAt(Math.floor(Math.random()*t.length));return e},frameToString:function(e){var t="";for(var r in e)t+=r+":"+e[r]+";";return t},convertTimeToMs:function(e){if(!e)return 0;if("number"==typeof e)return e;var t=parseFloat(e);return-1!=e.indexOf("ms")?t:1e3*t},prefixes:["","-webkit-","-moz-","-o-"]};t.default=i},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=r(0))&&i.__esModule?i:{default:i};t.default=function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.styles="string"==typeof t?n.default.getFromSheets(t):t,"string"==typeof r){var i=n.default.getFromSheets(r);for(var s in this.options={},i)this.options[s.replace("animation-","")]=i[s]}else this.options="number"==typeof r?{duration:r}:r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=a(r(4)),s=a(r(1)),o=a(r(0));function a(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,r,i,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.constructor===Array?this.doms=t:this.doms=[t],r.constructor===Array?this.frames=r:this.frames=[r],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},null!=i&&null!=i)if("boolean"==typeof i)this.options.instant=i;else if("number"==typeof i)this.options.count=i,"boolean"==typeof n&&(this.options.instant=n);else for(var o in i)"pauseAt"==o&&i.pauseAt.constructor!==Array?this.options[o]=[i[o]]:this.options[o]=i[o];for(var a in this.promiseSupported="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=s.default.prefixes:this.prefixes=[""],t)this.countRemainder[a]=this.options.count-1;this.options.instant&&this.play()}return i(e,[{key:"play",value:function(){var e=this;for(var t in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(t){e.promiseResolve=t})),this.doms){var r=this.makeAnimation(this.doms[t]);this.animations[t]=r.names,this.styleDoms[t]=r.styleDom,this.superSets[t]=this.makeSuperSet(this.doms[t],this.animations[t]),this.playAnimation(this.doms[t],this.superSets[t]),this.eventHandler[t]=this.handleAnimationEnd.bind(this,t),this.doms[t].addEventListener("animationend",this.eventHandler[t])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(e){if(!e){for(var t in this.doms)this.clear(t);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var r=this.styleDoms[e];for(var i in r&&r.parentNode&&r.parentNode.removeChild(r),this.superSets[e])for(var n in this.prefixes)this.doms[e].style[this.prefixes[n]+"animation-"+i]=null;for(var s in this.prefixes)this.doms[e].style[this.prefixes[s]+"animation-play-state"]=null;this.doms[e].removeEventListener("animationend",this.eventHandler[e]),this.countRemainder[e]=this.options.count-1}},{key:"replay",value:function(e){var t=this.doms[e],r=t.cloneNode(!0);t.parentNode.replaceChild(r,t),this.doms[e].removeEventListener("animationend",this.eventHandler[e]),this.doms[e]=r,this.doms[e].addEventListener("animationend",this.eventHandler[e])}},{key:"pause",value:function(){for(var e in this.doms)this.pauseDom(this.doms[e])}},{key:"resume",value:function(){for(var e in this.doms)this.resumeDom(this.doms[e])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(e,t){var r=t.animationName,i=r.substring(r.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(i))&&this.pauseDom(this.doms[e]),i==this.frames.length&&(-1==this.countRemainder[e]?this.replay(e):this.countRemainder[e]>0?(this.countRemainder[e]--,this.replay(e)):(this.options.applyOnEnd&&this.applyOnEnd(e),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(e){for(var t in this.prefixes)e.style[this.prefixes[t]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(e){for(var t in this.prefixes)e.style[this.prefixes[t]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(e){var t=this.newFrames[this.frames.length];for(var r in t)this.doms[e].style[r]=t[r]}},{key:"makeAnimation",value:function(e){var t={},r=[],i={};for(var s in this.frames)for(var o in r.push(this.frames[s].styles),r[s])i[o]=!0;var a=window.getComputedStyle(e);for(var l in i)t[l]=a[l];r.unshift(t);for(var c=[r[0]],u=1;u<r.length;++u){var p=JSON.parse(JSON.stringify(c[u-1]));for(var h in r[u])p[h]=r[u][h];c.push(p)}return this.newFrames=c,n.default.make(c,this.prefixes)}},{key:"makeSuperSet",value:function(e,t){var r=0,i={};for(var n in this.frames)for(var a in this.frames[n].options)i[a]="";i.name="",i.duration="",i.delay="";for(var l=0;l<this.frames.length;++l){if(l)for(var c in i)i[c]+=",";var u=s.default.convertTimeToMs(this.frames[l].options.duration),p=s.default.convertTimeToMs(this.frames[l].options.delay);for(var h in l<this.options.startFrom&&(u=0,p=0),i.name+=t[l],i.duration+=u+"ms",i.delay+=r+p+"ms",i)"name"!=h&&"duration"!=h&&"delay"!=h&&(i[h]+=this.frames[l].options[h]?this.frames[l].options[h]:o.default.getPropertyDefault(h));var d=this.frames[l].options["iteration-count"];r+=u*parseInt(d||1)+p}return i}},{key:"playAnimation",value:function(e,t){for(var r in t)for(var i in this.prefixes)e.style[this.prefixes[i]+"animation-"+r]=t[r];this.options.pauseAt.includes(0)&&this.pauseDom(e)}}]),e}();t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=r(1))&&i.__esModule?i:{default:i},s={make:function(e,t){for(var r=[],i="",o="atr-"+n.default.generateId(),a=document.createElement("style"),l=0;l<e.length-1;++l)r.push(o+"-"+(l+1)),i+=s.makeFromTwoFrames(e[l],e[l+1],r[l],t);return a.innerHTML=i,a.class="foo",document.getElementsByTagName("head")[0].appendChild(a),{names:r,styleDom:a}},makeFromTwoFrames:function(e,t,r,i){var s="";for(var o in i)s+="@"+i[o]+"keyframes "+r+" {",s+="0%",s+="{"+n.default.frameToString(e)+"}",s+="100%",s+="{"+n.default.frameToString(t)+"}",s+="}";return s}};t.default=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=t.Frame=void 0;var i=s(r(2)),n=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}t.Frame=i.default,t.Queue=n.default}])},e.exports=t()},352:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=e(t);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r}).join("")},t.i=function(e,r,i){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(i)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(n[o]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);i&&n[l[0]]||(r&&(l[2]?l[2]="".concat(r," and ").concat(l[2]):l[2]=r),t.push(l))}},t}},388:function(e){e.exports=function e(t,r,i){function n(o,a){if(!r[o]){if(!t[o]){if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){return n(t[o][1][e]||e)},l,l.exports,e,t,r,i)}return r[o].exports}for(var s=void 0,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,r){(function(i,n,s,o,a,l,c,u,p){var h=e("crypto");function d(e,t){return function(e,t){var r;if(void 0===(r="passthrough"!==t.algorithm?h.createHash(t.algorithm):new x).write&&(r.write=r.update,r.end=r.update),v(t,r).dispatch(e),r.update||r.end(""),r.digest)return r.digest("buffer"===t.encoding?void 0:t.encoding);var i=r.read();return"buffer"!==t.encoding?i.toString(t.encoding):i}(e,t=m(e,t))}(r=t.exports=d).sha1=function(e){return d(e)},r.keys=function(e){return d(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},r.MD5=function(e){return d(e,{algorithm:"md5",encoding:"hex"})},r.keysMD5=function(e){return d(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var f=h.getHashes?h.getHashes().slice():["sha1","md5"];f.push("passthrough");var g=["buffer","hex","binary","base64"];function m(e,t){t=t||{};var r={};if(r.algorithm=t.algorithm||"sha1",r.encoding=t.encoding||"hex",r.excludeValues=!!t.excludeValues,r.algorithm=r.algorithm.toLowerCase(),r.encoding=r.encoding.toLowerCase(),r.ignoreUnknown=!0===t.ignoreUnknown,r.respectType=!1!==t.respectType,r.respectFunctionNames=!1!==t.respectFunctionNames,r.respectFunctionProperties=!1!==t.respectFunctionProperties,r.unorderedArrays=!0===t.unorderedArrays,r.unorderedSets=!1!==t.unorderedSets,r.unorderedObjects=!1!==t.unorderedObjects,r.replacer=t.replacer||void 0,r.excludeKeys=t.excludeKeys||void 0,void 0===e)throw new Error("Object argument required.");for(var i=0;i<f.length;++i)f[i].toLowerCase()===r.algorithm.toLowerCase()&&(r.algorithm=f[i]);if(-1===f.indexOf(r.algorithm))throw new Error('Algorithm "'+r.algorithm+'"  not supported. supported values: '+f.join(", "));if(-1===g.indexOf(r.encoding)&&"passthrough"!==r.algorithm)throw new Error('Encoding "'+r.encoding+'"  not supported. supported values: '+g.join(", "));return r}function _(e){if("function"==typeof e)return null!=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))}function v(e,t,r){function i(e){return t.update?t.update(e,"utf8"):t.write(e,"utf8")}return r=r||[],{dispatch:function(t){return e.replacer&&(t=e.replacer(t)),this["_"+(null===t?"null":typeof t)](t)},_object:function(t){var n,o=Object.prototype.toString.call(t),a=/\[object (.*)\]/i.exec(o);if(a=(a=a?a[1]:"unknown:["+o+"]").toLowerCase(),0<=(n=r.indexOf(t)))return this.dispatch("[CIRCULAR:"+n+"]");if(r.push(t),void 0!==s&&s.isBuffer&&s.isBuffer(t))return i("buffer:"),i(t);if("object"===a||"function"===a||"asyncfunction"===a){var l=Object.keys(t);e.unorderedObjects&&(l=l.sort()),!1===e.respectType||_(t)||l.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(l=l.filter(function(t){return!e.excludeKeys(t)})),i("object:"+l.length+":");var c=this;return l.forEach(function(r){c.dispatch(r),i(":"),e.excludeValues||c.dispatch(t[r]),i(",")})}if(!this["_"+a]){if(e.ignoreUnknown)return i("["+a+"]");throw new Error('Unknown object type "'+a+'"')}this["_"+a](t)},_array:function(t,n){n=void 0!==n?n:!1!==e.unorderedArrays;var s=this;if(i("array:"+t.length+":"),!n||t.length<=1)return t.forEach(function(e){return s.dispatch(e)});var o=[],a=t.map(function(t){var i=new x,n=r.slice();return v(e,i,n).dispatch(t),o=o.concat(n.slice(r.length)),i.read().toString()});return r=r.concat(o),a.sort(),this._array(a,!1)},_date:function(e){return i("date:"+e.toJSON())},_symbol:function(e){return i("symbol:"+e.toString())},_error:function(e){return i("error:"+e.toString())},_boolean:function(e){return i("bool:"+e.toString())},_string:function(e){i("string:"+e.length+":"),i(e.toString())},_function:function(t){i("fn:"),_(t)?this.dispatch("[native]"):this.dispatch(t.toString()),!1!==e.respectFunctionNames&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(e){return i("number:"+e.toString())},_xml:function(e){return i("xml:"+e.toString())},_null:function(){return i("Null")},_undefined:function(){return i("Undefined")},_regexp:function(e){return i("regex:"+e.toString())},_uint8array:function(e){return i("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return i("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return i("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return i("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return i("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return i("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return i("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return i("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return i("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return i("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){return i("url:"+e.toString())},_map:function(t){i("map:");var r=Array.from(t);return this._array(r,!1!==e.unorderedSets)},_set:function(t){i("set:");var r=Array.from(t);return this._array(r,!1!==e.unorderedSets)},_file:function(e){return i("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},_blob:function(){if(e.ignoreUnknown)return i("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n')},_domwindow:function(){return i("domwindow")},_bigint:function(e){return i("bigint:"+e.toString())},_process:function(){return i("process")},_timer:function(){return i("timer")},_pipe:function(){return i("pipe")},_tcp:function(){return i("tcp")},_udp:function(){return i("udp")},_tty:function(){return i("tty")},_statwatcher:function(){return i("statwatcher")},_securecontext:function(){return i("securecontext")},_connection:function(){return i("connection")},_zlib:function(){return i("zlib")},_context:function(){return i("context")},_nodescript:function(){return i("nodescript")},_httpparser:function(){return i("httpparser")},_dataview:function(){return i("dataview")},_signal:function(){return i("signal")},_fsevent:function(){return i("fsevent")},_tlswrap:function(){return i("tlswrap")}}}function x(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}r.writeToStream=function(e,t,r){return void 0===r&&(r=t,t={}),v(t=m(e,t),r).dispatch(e)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(e,t,r){(function(e,t,i,n,s,o,a,l,c){!function(e){var t="undefined"!=typeof Uint8Array?Uint8Array:Array,r="+".charCodeAt(0),i="/".charCodeAt(0),n="0".charCodeAt(0),s="a".charCodeAt(0),o="A".charCodeAt(0),a="-".charCodeAt(0),l="_".charCodeAt(0);function c(e){var t=e.charCodeAt(0);return t===r||t===a?62:t===i||t===l?63:t<n?-1:t<n+10?t-n+26+26:t<o+26?t-o:t<s+26?t-s+26:void 0}e.toByteArray=function(e){var r,i;if(0<e.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.length,s="="===e.charAt(n-2)?2:"="===e.charAt(n-1)?1:0,o=new t(3*e.length/4-s),a=0<s?e.length-4:e.length,l=0;function u(e){o[l++]=e}for(r=0;r<a;r+=4,0)u((16711680&(i=c(e.charAt(r))<<18|c(e.charAt(r+1))<<12|c(e.charAt(r+2))<<6|c(e.charAt(r+3))))>>16),u((65280&i)>>8),u(255&i);return 2==s?u(255&(i=c(e.charAt(r))<<2|c(e.charAt(r+1))>>4)):1==s&&(u((i=c(e.charAt(r))<<10|c(e.charAt(r+1))<<4|c(e.charAt(r+2))>>2)>>8&255),u(255&i)),o},e.fromByteArray=function(e){var t,r,i,n,s=e.length%3,o="";function a(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,i=e.length-s;t<i;t+=3)o+=a((n=r=(e[t]<<16)+(e[t+1]<<8)+e[t+2])>>18&63)+a(n>>12&63)+a(n>>6&63)+a(63&n);switch(s){case 1:o+=a((r=e[e.length-1])>>2),o+=a(r<<4&63),o+="==";break;case 2:o+=a((r=(e[e.length-2]<<8)+e[e.length-1])>>10),o+=a(r>>4&63),o+=a(r<<2&63),o+="="}return o}}(void 0===r?this.base64js={}:r)}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(e,t,r){(function(t,i,n,s,o,a,l,c,u){var p=e("base64-js"),h=e("ieee754");function n(e,t,r){if(!(this instanceof n))return new n(e,t,r);var i,s,o,a,l,c=typeof e;if("base64"===t&&"string"==c)for(e=(i=e).trim?i.trim():i.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"==c)s=M(e);else if("string"==c)s=n.byteLength(e,t);else{if("object"!=c)throw new Error("First argument needs to be a number, array or string.");s=M(e.length)}if(n._useTypedArrays?o=n._augment(new Uint8Array(s)):((o=this).length=s,o._isBuffer=!0),n._useTypedArrays&&"number"==typeof e.byteLength)o._set(e);else if(T(l=e)||n.isBuffer(l)||l&&"object"==typeof l&&"number"==typeof l.length)for(a=0;a<s;a++)n.isBuffer(e)?o[a]=e.readUInt8(a):o[a]=e[a];else if("string"==c)o.write(e,0,t);else if("number"==c&&!n._useTypedArrays&&!r)for(a=0;a<s;a++)o[a]=0;return o}function d(e,t,r,i){i||(F("boolean"==typeof r,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+1<e.length,"Trying to read beyond buffer length"));var n,s=e.length;if(!(s<=t))return r?(n=e[t],t+1<s&&(n|=e[t+1]<<8)):(n=e[t]<<8,t+1<s&&(n|=e[t+1])),n}function f(e,t,r,i){i||(F("boolean"==typeof r,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+3<e.length,"Trying to read beyond buffer length"));var n,s=e.length;if(!(s<=t))return r?(t+2<s&&(n=e[t+2]<<16),t+1<s&&(n|=e[t+1]<<8),n|=e[t],t+3<s&&(n+=e[t+3]<<24>>>0)):(t+1<s&&(n=e[t+1]<<16),t+2<s&&(n|=e[t+2]<<8),t+3<s&&(n|=e[t+3]),n+=e[t]<<24>>>0),n}function g(e,t,r,i){if(i||(F("boolean"==typeof r,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+1<e.length,"Trying to read beyond buffer length")),!(e.length<=t)){var n=d(e,t,r,!0);return 32768&n?-1*(65535-n+1):n}}function m(e,t,r,i){if(i||(F("boolean"==typeof r,"missing or invalid endian"),F(null!=t,"missing offset"),F(t+3<e.length,"Trying to read beyond buffer length")),!(e.length<=t)){var n=f(e,t,r,!0);return 2147483648&n?-1*(4294967295-n+1):n}}function _(e,t,r,i){return i||(F("boolean"==typeof r,"missing or invalid endian"),F(t+3<e.length,"Trying to read beyond buffer length")),h.read(e,t,r,23,4)}function v(e,t,r,i){return i||(F("boolean"==typeof r,"missing or invalid endian"),F(t+7<e.length,"Trying to read beyond buffer length")),h.read(e,t,r,52,8)}function x(e,t,r,i,n){n||(F(null!=t,"missing value"),F("boolean"==typeof i,"missing or invalid endian"),F(null!=r,"missing offset"),F(r+1<e.length,"trying to write beyond buffer length"),R(t,65535));var s=e.length;if(!(s<=r))for(var o=0,a=Math.min(s-r,2);o<a;o++)e[r+o]=(t&255<<8*(i?o:1-o))>>>8*(i?o:1-o)}function A(e,t,r,i,n){n||(F(null!=t,"missing value"),F("boolean"==typeof i,"missing or invalid endian"),F(null!=r,"missing offset"),F(r+3<e.length,"trying to write beyond buffer length"),R(t,4294967295));var s=e.length;if(!(s<=r))for(var o=0,a=Math.min(s-r,4);o<a;o++)e[r+o]=t>>>8*(i?o:3-o)&255}function b(e,t,r,i,n){n||(F(null!=t,"missing value"),F("boolean"==typeof i,"missing or invalid endian"),F(null!=r,"missing offset"),F(r+1<e.length,"Trying to write beyond buffer length"),L(t,32767,-32768)),e.length<=r||x(e,0<=t?t:65535+t+1,r,i,n)}function y(e,t,r,i,n){n||(F(null!=t,"missing value"),F("boolean"==typeof i,"missing or invalid endian"),F(null!=r,"missing offset"),F(r+3<e.length,"Trying to write beyond buffer length"),L(t,2147483647,-2147483648)),e.length<=r||A(e,0<=t?t:4294967295+t+1,r,i,n)}function w(e,t,r,i,n){n||(F(null!=t,"missing value"),F("boolean"==typeof i,"missing or invalid endian"),F(null!=r,"missing offset"),F(r+3<e.length,"Trying to write beyond buffer length"),O(t,3.4028234663852886e38,-3.4028234663852886e38)),e.length<=r||h.write(e,t,r,i,23,4)}function E(e,t,r,i,n){n||(F(null!=t,"missing value"),F("boolean"==typeof i,"missing or invalid endian"),F(null!=r,"missing offset"),F(r+7<e.length,"Trying to write beyond buffer length"),O(t,1.7976931348623157e308,-1.7976931348623157e308)),e.length<=r||h.write(e,t,r,i,52,8)}r.Buffer=n,r.SlowBuffer=n,r.INSPECT_MAX_BYTES=50,n.poolSize=8192,n._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),n.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},n.isBuffer=function(e){return!(null==e||!e._isBuffer)},n.byteLength=function(e,t){var r;switch(e+="",t||"utf8"){case"hex":r=e.length/2;break;case"utf8":case"utf-8":r=k(e).length;break;case"ascii":case"binary":case"raw":r=e.length;break;case"base64":r=D(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=2*e.length;break;default:throw new Error("Unknown encoding")}return r},n.concat=function(e,t){if(F(T(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new n(0);if(1===e.length)return e[0];if("number"!=typeof t)for(s=t=0;s<e.length;s++)t+=e[s].length;for(var r=new n(t),i=0,s=0;s<e.length;s++){var o=e[s];o.copy(r,i),i+=o.length}return r},n.prototype.write=function(e,t,r,i){var s;isFinite(t)?isFinite(r)||(i=r,r=void 0):(s=i,i=t,t=r,r=s),t=Number(t)||0;var o,a,l,c,u,p,h,d=this.length-t;switch((!r||d<(r=Number(r)))&&(r=d),i=String(i||"utf8").toLowerCase()){case"hex":o=function(e,t,r,i){r=Number(r)||0;var s=e.length-r;(!i||s<(i=Number(i)))&&(i=s);var o=t.length;F(o%2==0,"Invalid hex string"),o/2<i&&(i=o/2);for(var a=0;a<i;a++){var l=parseInt(t.substr(2*a,2),16);F(!isNaN(l),"Invalid hex string"),e[r+a]=l}return n._charsWritten=2*a,a}(this,e,t,r);break;case"utf8":case"utf-8":u=e,p=t,h=r,o=n._charsWritten=P(k(u),this,p,h);break;case"ascii":case"binary":o=function(e,t,r,i){return n._charsWritten=P(function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}(this,e,t,r);break;case"base64":a=e,l=t,c=r,o=n._charsWritten=P(D(a),this,l,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=function(e,t,r,i){return n._charsWritten=P(function(e){for(var t,r,i,n=[],s=0;s<e.length;s++)r=(t=e.charCodeAt(s))>>8,i=t%256,n.push(i),n.push(r);return n}(t),e,r,i)}(this,e,t,r);break;default:throw new Error("Unknown encoding")}return o},n.prototype.toString=function(e,t,r){var i,n,s,o,a=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(r=void 0!==r?Number(r):r=a.length)===t)return"";switch(e){case"hex":i=function(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||i<r)&&(r=i);for(var n="",s=t;s<r;s++)n+=I(e[s]);return n}(a,t,r);break;case"utf8":case"utf-8":i=function(e,t,r){var i="",n="";r=Math.min(e.length,r);for(var s=t;s<r;s++)e[s]<=127?(i+=B(n)+String.fromCharCode(e[s]),n=""):n+="%"+e[s].toString(16);return i+B(n)}(a,t,r);break;case"ascii":case"binary":i=function(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;n++)i+=String.fromCharCode(e[n]);return i}(a,t,r);break;case"base64":n=a,o=r,i=0===(s=t)&&o===n.length?p.fromByteArray(n):p.fromByteArray(n.slice(s,o));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=function(e,t,r){for(var i=a.slice(t,r),n="",s=0;s<i.length;s+=2)n+=String.fromCharCode(i[s]+256*i[s+1]);return n}(0,t,r);break;default:throw new Error("Unknown encoding")}return i},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},n.prototype.copy=function(e,t,r,i){if(r=r||0,i||0===i||(i=this.length),t=t||0,i!==r&&0!==e.length&&0!==this.length){F(r<=i,"sourceEnd < sourceStart"),F(0<=t&&t<e.length,"targetStart out of bounds"),F(0<=r&&r<this.length,"sourceStart out of bounds"),F(0<=i&&i<=this.length,"sourceEnd out of bounds"),i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var s=i-r;if(s<100||!n._useTypedArrays)for(var o=0;o<s;o++)e[o+t]=this[o+r];else e._set(this.subarray(r,r+s),t)}},n.prototype.slice=function(e,t){var r=this.length;if(e=C(e,r,0),t=C(t,r,r),n._useTypedArrays)return n._augment(this.subarray(e,t));for(var i=t-e,s=new n(i,void 0,!0),o=0;o<i;o++)s[o]=this[o+e];return s},n.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},n.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},n.prototype.readUInt8=function(e,t){if(t||(F(null!=e,"missing offset"),F(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},n.prototype.readUInt16LE=function(e,t){return d(this,e,!0,t)},n.prototype.readUInt16BE=function(e,t){return d(this,e,!1,t)},n.prototype.readUInt32LE=function(e,t){return f(this,e,!0,t)},n.prototype.readUInt32BE=function(e,t){return f(this,e,!1,t)},n.prototype.readInt8=function(e,t){if(t||(F(null!=e,"missing offset"),F(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},n.prototype.readInt16LE=function(e,t){return g(this,e,!0,t)},n.prototype.readInt16BE=function(e,t){return g(this,e,!1,t)},n.prototype.readInt32LE=function(e,t){return m(this,e,!0,t)},n.prototype.readInt32BE=function(e,t){return m(this,e,!1,t)},n.prototype.readFloatLE=function(e,t){return _(this,e,!0,t)},n.prototype.readFloatBE=function(e,t){return _(this,e,!1,t)},n.prototype.readDoubleLE=function(e,t){return v(this,e,!0,t)},n.prototype.readDoubleBE=function(e,t){return v(this,e,!1,t)},n.prototype.writeUInt8=function(e,t,r){r||(F(null!=e,"missing value"),F(null!=t,"missing offset"),F(t<this.length,"trying to write beyond buffer length"),R(e,255)),t>=this.length||(this[t]=e)},n.prototype.writeUInt16LE=function(e,t,r){x(this,e,t,!0,r)},n.prototype.writeUInt16BE=function(e,t,r){x(this,e,t,!1,r)},n.prototype.writeUInt32LE=function(e,t,r){A(this,e,t,!0,r)},n.prototype.writeUInt32BE=function(e,t,r){A(this,e,t,!1,r)},n.prototype.writeInt8=function(e,t,r){r||(F(null!=e,"missing value"),F(null!=t,"missing offset"),F(t<this.length,"Trying to write beyond buffer length"),L(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,r):this.writeUInt8(255+e+1,t,r))},n.prototype.writeInt16LE=function(e,t,r){b(this,e,t,!0,r)},n.prototype.writeInt16BE=function(e,t,r){b(this,e,t,!1,r)},n.prototype.writeInt32LE=function(e,t,r){y(this,e,t,!0,r)},n.prototype.writeInt32BE=function(e,t,r){y(this,e,t,!1,r)},n.prototype.writeFloatLE=function(e,t,r){w(this,e,t,!0,r)},n.prototype.writeFloatBE=function(e,t,r){w(this,e,t,!1,r)},n.prototype.writeDoubleLE=function(e,t,r){E(this,e,t,!0,r)},n.prototype.writeDoubleBE=function(e,t,r){E(this,e,t,!1,r)},n.prototype.fill=function(e,t,r){if(e=e||0,t=t||0,r=r||this.length,"string"==typeof e&&(e=e.charCodeAt(0)),F("number"==typeof e&&!isNaN(e),"value is not a number"),F(t<=r,"end < start"),r!==t&&0!==this.length){F(0<=t&&t<this.length,"start out of bounds"),F(0<=r&&r<=this.length,"end out of bounds");for(var i=t;i<r;i++)this[i]=e}},n.prototype.inspect=function(){for(var e=[],t=this.length,i=0;i<t;i++)if(e[i]=I(this[i]),i===r.INSPECT_MAX_BYTES){e[i+1]="...";break}return"<Buffer "+e.join(" ")+">"},n.prototype.toArrayBuffer=function(){if("undefined"==typeof Uint8Array)throw new Error("Buffer.toArrayBuffer not supported in this browser");if(n._useTypedArrays)return new n(this).buffer;for(var e=new Uint8Array(this.length),t=0,r=e.length;t<r;t+=1)e[t]=this[t];return e.buffer};var S=n.prototype;function C(e,t,r){return"number"!=typeof e?r:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function M(e){return(e=~~Math.ceil(+e))<0?0:e}function T(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function I(e){return e<16?"0"+e.toString(16):e.toString(16)}function k(e){for(var t=[],r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i<=127)t.push(e.charCodeAt(r));else{var n=r;55296<=i&&i<=57343&&r++;for(var s=encodeURIComponent(e.slice(n,r+1)).substr(1).split("%"),o=0;o<s.length;o++)t.push(parseInt(s[o],16))}}return t}function D(e){return p.toByteArray(e)}function P(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);n++)t[n+r]=e[n];return n}function B(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function R(e,t){F("number"==typeof e,"cannot write a non-number as a number"),F(0<=e,"specified a negative value for writing an unsigned value"),F(e<=t,"value is larger than maximum value for type"),F(Math.floor(e)===e,"value has a fractional component")}function L(e,t,r){F("number"==typeof e,"cannot write a non-number as a number"),F(e<=t,"value larger than maximum allowed value"),F(r<=e,"value smaller than minimum allowed value"),F(Math.floor(e)===e,"value has a fractional component")}function O(e,t,r){F("number"==typeof e,"cannot write a non-number as a number"),F(e<=t,"value larger than maximum allowed value"),F(r<=e,"value smaller than minimum allowed value")}function F(e,t){if(!e)throw new Error(t||"Failed assertion")}n._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=S.get,e.set=S.set,e.write=S.write,e.toString=S.toString,e.toLocaleString=S.toString,e.toJSON=S.toJSON,e.copy=S.copy,e.slice=S.slice,e.readUInt8=S.readUInt8,e.readUInt16LE=S.readUInt16LE,e.readUInt16BE=S.readUInt16BE,e.readUInt32LE=S.readUInt32LE,e.readUInt32BE=S.readUInt32BE,e.readInt8=S.readInt8,e.readInt16LE=S.readInt16LE,e.readInt16BE=S.readInt16BE,e.readInt32LE=S.readInt32LE,e.readInt32BE=S.readInt32BE,e.readFloatLE=S.readFloatLE,e.readFloatBE=S.readFloatBE,e.readDoubleLE=S.readDoubleLE,e.readDoubleBE=S.readDoubleBE,e.writeUInt8=S.writeUInt8,e.writeUInt16LE=S.writeUInt16LE,e.writeUInt16BE=S.writeUInt16BE,e.writeUInt32LE=S.writeUInt32LE,e.writeUInt32BE=S.writeUInt32BE,e.writeInt8=S.writeInt8,e.writeInt16LE=S.writeInt16LE,e.writeInt16BE=S.writeInt16BE,e.writeInt32LE=S.writeInt32LE,e.writeInt32BE=S.writeInt32BE,e.writeFloatLE=S.writeFloatLE,e.writeFloatBE=S.writeFloatBE,e.writeDoubleLE=S.writeDoubleLE,e.writeDoubleBE=S.writeDoubleBE,e.fill=S.fill,e.inspect=S.inspect,e.toArrayBuffer=S.toArrayBuffer,e}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(e,t,r){(function(r,i,n,s,o,a,l,c,u){var p=new(n=e("buffer").Buffer)(4);p.fill(0),t.exports={hash:function(e,t,r,i){return n.isBuffer(e)||(e=new n(e)),function(e,t,r){for(var i=new n(t),s=r?i.writeInt32BE:i.writeInt32LE,o=0;o<e.length;o++)s.call(i,e[o],4*o,!0);return i}(t(function(e,t){var r;e.length%4!=0&&(r=e.length+(4-e.length%4),e=n.concat([e,p],r));for(var i=[],s=t?e.readInt32BE:e.readInt32LE,o=0;o<e.length;o+=4)i.push(s.call(e,o));return i}(e,i),8*e.length),r,i)}}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(e,t,r){(function(t,i,n,s,o,a,l,c,u){n=e("buffer").Buffer;var p=e("./sha"),h=e("./sha256"),d=e("./rng"),f={sha1:p,sha256:h,md5:e("./md5")},g=64,m=new n(g);function _(e,t){var r=f[e=e||"sha1"],i=[];return r||v("algorithm:",e,"is not yet supported"),{update:function(e){return n.isBuffer(e)||(e=new n(e)),i.push(e),e.length,this},digest:function(e){var s=n.concat(i),o=t?function(e,t,r){n.isBuffer(t)||(t=new n(t)),n.isBuffer(r)||(r=new n(r)),t.length>g?t=e(t):t.length<g&&(t=n.concat([t,m],g));for(var i=new n(g),s=new n(g),o=0;o<g;o++)i[o]=54^t[o],s[o]=92^t[o];var a=e(n.concat([i,r]));return e(n.concat([s,a]))}(r,t,s):r(s);return i=null,e?o.toString(e):o}}}function v(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}m.fill(0),r.createHash=function(e){return _(e)},r.createHmac=_,r.randomBytes=function(e,t){if(!t||!t.call)return new n(d(e));try{t.call(this,void 0,new n(d(e)))}catch(e){t(e)}},function(e,t){for(var r in e)t(e[r])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(e){r[e]=function(){v("sorry,",e,"is not implemented yet")}})}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(e,t,r){(function(r,i,n,s,o,a,l,c,u){var p=e("./helpers");function h(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,i=-271733879,n=-1732584194,s=271733878,o=0;o<e.length;o+=16){var a=r,l=i,c=n,u=s;r=f(r,i,n,s,e[o+0],7,-680876936),s=f(s,r,i,n,e[o+1],12,-389564586),n=f(n,s,r,i,e[o+2],17,606105819),i=f(i,n,s,r,e[o+3],22,-1044525330),r=f(r,i,n,s,e[o+4],7,-176418897),s=f(s,r,i,n,e[o+5],12,1200080426),n=f(n,s,r,i,e[o+6],17,-1473231341),i=f(i,n,s,r,e[o+7],22,-45705983),r=f(r,i,n,s,e[o+8],7,1770035416),s=f(s,r,i,n,e[o+9],12,-1958414417),n=f(n,s,r,i,e[o+10],17,-42063),i=f(i,n,s,r,e[o+11],22,-1990404162),r=f(r,i,n,s,e[o+12],7,1804603682),s=f(s,r,i,n,e[o+13],12,-40341101),n=f(n,s,r,i,e[o+14],17,-1502002290),r=g(r,i=f(i,n,s,r,e[o+15],22,1236535329),n,s,e[o+1],5,-165796510),s=g(s,r,i,n,e[o+6],9,-1069501632),n=g(n,s,r,i,e[o+11],14,643717713),i=g(i,n,s,r,e[o+0],20,-373897302),r=g(r,i,n,s,e[o+5],5,-701558691),s=g(s,r,i,n,e[o+10],9,38016083),n=g(n,s,r,i,e[o+15],14,-660478335),i=g(i,n,s,r,e[o+4],20,-405537848),r=g(r,i,n,s,e[o+9],5,568446438),s=g(s,r,i,n,e[o+14],9,-1019803690),n=g(n,s,r,i,e[o+3],14,-187363961),i=g(i,n,s,r,e[o+8],20,1163531501),r=g(r,i,n,s,e[o+13],5,-1444681467),s=g(s,r,i,n,e[o+2],9,-51403784),n=g(n,s,r,i,e[o+7],14,1735328473),r=m(r,i=g(i,n,s,r,e[o+12],20,-1926607734),n,s,e[o+5],4,-378558),s=m(s,r,i,n,e[o+8],11,-2022574463),n=m(n,s,r,i,e[o+11],16,1839030562),i=m(i,n,s,r,e[o+14],23,-35309556),r=m(r,i,n,s,e[o+1],4,-1530992060),s=m(s,r,i,n,e[o+4],11,1272893353),n=m(n,s,r,i,e[o+7],16,-155497632),i=m(i,n,s,r,e[o+10],23,-1094730640),r=m(r,i,n,s,e[o+13],4,681279174),s=m(s,r,i,n,e[o+0],11,-358537222),n=m(n,s,r,i,e[o+3],16,-722521979),i=m(i,n,s,r,e[o+6],23,76029189),r=m(r,i,n,s,e[o+9],4,-640364487),s=m(s,r,i,n,e[o+12],11,-421815835),n=m(n,s,r,i,e[o+15],16,530742520),r=_(r,i=m(i,n,s,r,e[o+2],23,-995338651),n,s,e[o+0],6,-198630844),s=_(s,r,i,n,e[o+7],10,1126891415),n=_(n,s,r,i,e[o+14],15,-1416354905),i=_(i,n,s,r,e[o+5],21,-57434055),r=_(r,i,n,s,e[o+12],6,1700485571),s=_(s,r,i,n,e[o+3],10,-1894986606),n=_(n,s,r,i,e[o+10],15,-1051523),i=_(i,n,s,r,e[o+1],21,-2054922799),r=_(r,i,n,s,e[o+8],6,1873313359),s=_(s,r,i,n,e[o+15],10,-30611744),n=_(n,s,r,i,e[o+6],15,-1560198380),i=_(i,n,s,r,e[o+13],21,1309151649),r=_(r,i,n,s,e[o+4],6,-145523070),s=_(s,r,i,n,e[o+11],10,-1120210379),n=_(n,s,r,i,e[o+2],15,718787259),i=_(i,n,s,r,e[o+9],21,-343485551),r=v(r,a),i=v(i,l),n=v(n,c),s=v(s,u)}return Array(r,i,n,s)}function d(e,t,r,i,n,s){return v((o=v(v(t,e),v(i,s)))<<(a=n)|o>>>32-a,r);var o,a}function f(e,t,r,i,n,s,o){return d(t&r|~t&i,e,t,n,s,o)}function g(e,t,r,i,n,s,o){return d(t&i|r&~i,e,t,n,s,o)}function m(e,t,r,i,n,s,o){return d(t^r^i,e,t,n,s,o)}function _(e,t,r,i,n,s,o){return d(r^(t|~i),e,t,n,s,o)}function v(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}t.exports=function(e){return p.hash(e,h,16)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(e,t,r){(function(e,r,i,n,s,o,a,l,c){var u;u=function(e){for(var t,r=new Array(e),i=0;i<e;i++)0==(3&i)&&(t=4294967296*Math.random()),r[i]=t>>>((3&i)<<3)&255;return r},t.exports=u}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(e,t,r){(function(r,i,n,s,o,a,l,c,u){var p=e("./helpers");function h(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var r,i,n,s,o,a=Array(80),l=1732584193,c=-271733879,u=-1732584194,p=271733878,h=-1009589776,g=0;g<e.length;g+=16){for(var m=l,_=c,v=u,x=p,A=h,b=0;b<80;b++){a[b]=b<16?e[g+b]:f(a[b-3]^a[b-8]^a[b-14]^a[b-16],1);var y=d(d(f(l,5),(n=c,s=u,o=p,(i=b)<20?n&s|~n&o:!(i<40)&&i<60?n&s|n&o|s&o:n^s^o)),d(d(h,a[b]),(r=b)<20?1518500249:r<40?1859775393:r<60?-1894007588:-899497514));h=p,p=u,u=f(c,30),c=l,l=y}l=d(l,m),c=d(c,_),u=d(u,v),p=d(p,x),h=d(h,A)}return Array(l,c,u,p,h)}function d(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function f(e,t){return e<<t|e>>>32-t}t.exports=function(e){return p.hash(e,h,20,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(e,t,r){(function(r,i,n,s,o,a,l,c,u){function p(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function h(e,t){return e>>>t|e<<32-t}function d(e,t){var r,i,n,s,o,a,l,c,u,d,f=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),g=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),m=new Array(64);e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var _,v,x,A,b,y,w,E,S=0;S<e.length;S+=16){r=g[0],i=g[1],n=g[2],s=g[3],o=g[4],a=g[5],l=g[6],c=g[7];for(var C=0;C<64;C++)m[C]=C<16?e[C+S]:p(p(p(h(E=m[C-2],17)^h(E,19)^E>>>10,m[C-7]),h(w=m[C-15],7)^h(w,18)^w>>>3),m[C-16]),u=p(p(p(p(c,h(y=o,6)^h(y,11)^h(y,25)),(b=o)&a^~b&l),f[C]),m[C]),d=p(h(A=r,2)^h(A,13)^h(A,22),(_=r)&(v=i)^_&(x=n)^v&x),c=l,l=a,a=o,o=p(s,u),s=n,n=i,i=r,r=p(u,d);g[0]=p(r,g[0]),g[1]=p(i,g[1]),g[2]=p(n,g[2]),g[3]=p(s,g[3]),g[4]=p(o,g[4]),g[5]=p(a,g[5]),g[6]=p(l,g[6]),g[7]=p(c,g[7])}return g}var f=e("./helpers");t.exports=function(e){return f.hash(e,d,32,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(e,t,r){(function(e,r,i,n,s,o,a,l,c){function u(){}(e=t.exports={}).nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var r=[];return window.addEventListener("message",function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<r.length&&r.shift()())},!0),function(e){r.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=u,e.addListener=u,e.once=u,e.off=u,e.removeListener=u,e.removeAllListeners=u,e.emit=u,e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(e,t,r){(function(e,t,i,n,s,o,a,l,c){r.read=function(e,t,r,i,n){var s,o,a=8*n-i-1,l=(1<<a)-1,c=l>>1,u=-7,p=r?n-1:0,h=r?-1:1,d=e[t+p];for(p+=h,s=d&(1<<-u)-1,d>>=-u,u+=a;0<u;s=256*s+e[t+p],p+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;0<u;o=256*o+e[t+p],p+=h,u-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),s-=c}return(d?-1:1)*o*Math.pow(2,s-i)},r.write=function(e,t,r,i,n,s){var o,a,l,c=8*s-n-1,u=(1<<c)-1,p=u>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:s-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),2<=(t+=1<=o+p?h/l:h*Math.pow(2,1-p))*l&&(o++,l/=2),u<=o+p?(a=0,o=u):1<=o+p?(a=(t*l-1)*Math.pow(2,n),o+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,n),o=0));8<=n;e[r+d]=255&a,d+=f,a/=256,n-=8);for(o=o<<n|a,c+=n;0<c;e[r+d]=255&o,d+=f,o/=256,c-=8);e[r+d-f]|=128*g}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(e){var t=function(){function e(e){return l(e,c(a(u(e.length),e),1/e.length))}function t(e){return a(p(e),e)}function r(e,t){return c(e,t?1/(e.length-1):1/e.length)}function i(e){var t=function(e){var t,r=Math.pow(2,-52),i=1e-64/r,n=0,s=0,o=0,a=0,l=0,c=h(e),u=c.length,p=c[0].length;if(u<p)throw"Need more rows than columns";var d=new Array(p),f=new Array(p);for(s=0;s<p;s++)d[s]=f[s]=0;var g=function e(t,r,i){void 0===i&&(i=0);var n,s=t[i],o=Array(s);if(i===t.length-1){for(n=s-2;n>=0;n-=2)o[n+1]=r,o[n]=r;return-1===n&&(o[0]=r),o}for(n=s-1;n>=0;n--)o[n]=e(t,r,i+1);return o}([p,p],0);function m(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var _=0,v=0,x=0,A=0,b=0,y=0,w=0;for(s=0;s<p;s++){for(d[s]=v,w=0,l=s+1,o=s;o<u;o++)w+=c[o][s]*c[o][s];if(w<=i)v=0;else for(_=c[s][s],v=Math.sqrt(w),_>=0&&(v=-v),x=_*v-w,c[s][s]=_-v,o=l;o<p;o++){for(w=0,a=s;a<u;a++)w+=c[a][s]*c[a][o];for(_=w/x,a=s;a<u;a++)c[a][o]+=_*c[a][s]}for(f[s]=v,w=0,o=l;o<p;o++)w+=c[s][o]*c[s][o];if(w<=i)v=0;else{for(_=c[s][s+1],v=Math.sqrt(w),_>=0&&(v=-v),x=_*v-w,c[s][s+1]=_-v,o=l;o<p;o++)d[o]=c[s][o]/x;for(o=l;o<u;o++){for(w=0,a=l;a<p;a++)w+=c[o][a]*c[s][a];for(a=l;a<p;a++)c[o][a]+=w*d[a]}}(b=Math.abs(f[s])+Math.abs(d[s]))>A&&(A=b)}for(s=p-1;-1!=s;s+=-1){if(0!=v){for(x=v*c[s][s+1],o=l;o<p;o++)g[o][s]=c[s][o]/x;for(o=l;o<p;o++){for(w=0,a=l;a<p;a++)w+=c[s][a]*g[a][o];for(a=l;a<p;a++)g[a][o]+=w*g[a][s]}}for(o=l;o<p;o++)g[s][o]=0,g[o][s]=0;g[s][s]=1,v=d[s],l=s}for(s=p-1;-1!=s;s+=-1){for(l=s+1,v=f[s],o=l;o<p;o++)c[s][o]=0;if(0!=v){for(x=c[s][s]*v,o=l;o<p;o++){for(w=0,a=l;a<u;a++)w+=c[a][s]*c[a][o];for(_=w/x,a=s;a<u;a++)c[a][o]+=_*c[a][s]}for(o=s;o<u;o++)c[o][s]=c[o][s]/v}else for(o=s;o<u;o++)c[o][s]=0;c[s][s]+=1}for(r*=A,a=p-1;-1!=a;a+=-1)for(var E=0;E<50;E++){var S=!1;for(l=a;-1!=l;l+=-1){if(Math.abs(d[l])<=r){S=!0;break}if(Math.abs(f[l-1])<=r)break}if(!S){n=0,w=1;var C=l-1;for(s=l;s<a+1&&(_=w*d[s],d[s]=n*d[s],!(Math.abs(_)<=r));s++)for(x=m(_,v=f[s]),f[s]=x,n=v/x,w=-_/x,o=0;o<u;o++)b=c[o][C],y=c[o][s],c[o][C]=b*n+y*w,c[o][s]=-b*w+y*n}if(y=f[a],l==a){if(y<0)for(f[a]=-y,o=0;o<p;o++)g[o][a]=-g[o][a];break}if(E>=49)throw"Error: no convergence.";for(A=f[l],v=m(_=(((b=f[a-1])-y)*(b+y)+((v=d[a-1])-(x=d[a]))*(v+x))/(2*x*b),1),_=_<0?((A-y)*(A+y)+x*(b/(_-v)-x))/A:((A-y)*(A+y)+x*(b/(_+v)-x))/A,n=1,w=1,s=l+1;s<a+1;s++){for(v=d[s],b=f[s],x=w*v,v*=n,y=m(_,x),d[s-1]=y,_=A*(n=_/y)+v*(w=x/y),v=-A*w+v*n,x=b*w,b*=n,o=0;o<p;o++)A=g[o][s-1],y=g[o][s],g[o][s-1]=A*n+y*w,g[o][s]=-A*w+y*n;for(y=m(_,x),f[s-1]=y,_=(n=_/y)*v+(w=x/y)*b,A=-w*v+n*b,o=0;o<u;o++)b=c[o][s-1],y=c[o][s],c[o][s-1]=b*n+y*w,c[o][s]=-b*w+y*n}d[l]=0,d[a]=_,f[a]=A}for(s=0;s<f.length;s++)f[s]<r&&(f[s]=0);for(s=0;s<p;s++)for(o=s-1;o>=0;o--)if(f[o]<f[s]){for(n=f[o],f[o]=f[s],f[s]=n,a=0;a<c.length;a++)t=c[a][s],c[a][s]=c[a][o],c[a][o]=t;for(a=0;a<g.length;a++)t=g[a][s],g[a][s]=g[a][o],g[a][o]=t;s=o}return{U:c,S:f,V:g}}(e);console.log(t);var r=t.U;return t.S.map(function(e,t){var i={};return i.eigenvalue=e,i.vector=r.map(function(e,r){return-1*e[t]}),i})}function n(t,...r){var i=r.map(function(e){return e.vector}),n=a(i,p(e(t))),s=c(a(u(t.length),t),-1/t.length);return{adjustedData:n,formattedAdjustedData:o(n,2),avgData:s,selectedVectors:i}}function s(n){return i(r(t(e(n)),!1))}function o(e,t){var r=Math.pow(10,t||2);return e.map(function(e,t){return e.map(function(e){return Math.round(e*r)/r})})}function a(e,t){if(!(e[0]&&t[0]&&e.length&&t.length))throw new Error("Both A and B should be matrices");if(t.length!==e[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var r=[],i=0;i<e.length;i++){r[i]=[];for(var n=0;n<t[0].length;n++)for(var s=0;s<e[0].length;s++)r[i][n]=r[i][n]?r[i][n]+e[i][s]*t[s][n]:e[i][s]*t[s][n]}return r}function l(e,t){if(e.length!==t.length||e[0].length!==t[0].length)throw new Error("Both A and B should have the same dimensions");for(var r=[],i=0;i<e.length;i++){r[i]=[];for(var n=0;n<t[0].length;n++)r[i][n]=e[i][n]-t[i][n]}return r}function c(e,t){for(var r=[],i=0;i<e.length;i++){r[i]=[];for(var n=0;n<e[0].length;n++)r[i][n]=e[i][n]*t}return r}function u(e){for(var t=[],r=0;r<e;r++){t[r]=[];for(var i=0;i<e;i++)t[r][i]=1}return t}function p(e){return h(e)[0].map(function(t,r){return e.map(function(e){return e[r]})})}function h(e){var t=JSON.stringify(e);return JSON.parse(t)}return{computeDeviationScores:t,computeDeviationMatrix:e,computeSVD:i,computePercentageExplained:function(e,...t){var r=e.map(function(e){return e.eigenvalue}).reduce(function(e,t){return e+t});return t.map(function(e){return e.eigenvalue}).reduce(function(e,t){return e+t})/r},computeOriginalData:function(e,t,r){var i=l(p(a(p(t),e)),r);return{originalData:i,formattedOriginalData:o(i,2)}},computeVarianceCovariance:r,computeAdjustedData:n,getEigenVectors:s,analyseTopResult:function(e){var t=s(e).sort(function(e,t){return t.eigenvalue-e.eigenvalue});return console.log("Sorted Vectors",t),n(e,t[0].vector)},transpose:p,multiply:a,clone:h,scale:c}}();e.exports=t},701:function(e){var t=[];function r(e){for(var r=-1,i=0;i<t.length;i++)if(t[i].identifier===e){r=i;break}return r}function i(e,i){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=s[c]||0,p="".concat(c," ").concat(u);s[c]=u+1;var h=r(p),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(d);else{var f=n(d,i);i.byIndex=a,t.splice(a,0,{identifier:p,updater:f,references:1})}o.push(p)}return o}function n(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,n){var s=i(e=e||[],n=n||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=r(s[o]);t[a].references--}for(var l=i(e,n),c=0;c<s.length;c++){var u=r(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},182:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},850:function(e,t,r){e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},236:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var i="";r.supports&&(i+="@supports (".concat(r.supports,") {")),r.media&&(i+="@media ".concat(r.media," {"));var n=void 0!==r.layer;n&&(i+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),i+=r.css,n&&(i+="}"),r.media&&(i+="}"),r.supports&&(i+="}");var s=r.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/",i+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," *"),i+="/"),t.styleTagTransform(i,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},213:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1:function(e){self,e.exports=function(){var e={820:function(e,t,r){var i=r(537),n=r.n(i),s=r(645),o=r.n(s)()(n());o.push([e.id,".treejs {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.treejs *:after,\n.treejs *:before {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.treejs > .treejs-node {\n  padding-left: 0;\n}\n.treejs .treejs-nodes {\n  list-style: none;\n  padding-left: 18px;\n  margin: 0;\n  overflow: hidden;\n  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;\n  -o-transition: height 150ms ease-out, opacity 150ms ease-out;\n  transition: height 150ms ease-out, opacity 150ms ease-out;\n}\n.treejs .treejs-node {\n  cursor: pointer;\n  overflow: hidden;\n}\n.treejs .treejs-node.treejs-placeholder {\n  padding-left: 18px;\n}\n.treejs .treejs-switcher {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n  -webkit-transition: -webkit-transform 150ms ease-out;\n  transition: -webkit-transform 150ms ease-out;\n  -o-transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;\n}\n.treejs .treejs-switcher:before {\n  position: absolute;\n  top: 8px;\n  left: 6px;\n  display: block;\n  content: ' ';\n  border: 4px solid transparent;\n  border-top: 4px solid rgba(245, 245, 245, 0.7);\n  -webkit-transition: border-color 150ms;\n  -o-transition: border-color 150ms;\n  transition: border-color 150ms;\n}\n.treejs .treejs-switcher:hover:before {\n  border-top: 4px solid rgba(245, 245, 245, 0.96);\n}\n.treejs .treejs-node__close > .treejs-switcher {\n  -webkit-transform: rotate(-90deg);\n      -ms-transform: rotate(-90deg);\n          transform: rotate(-90deg);\n}\n.treejs .treejs-node__close > .treejs-nodes {\n  height: 0;\n}\n.treejs .treejs-checkbox {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n}\n.treejs .treejs-checkbox:before {\n  -webkit-transition: all 0.3s;\n  -o-transition: all 0.3s;\n  transition: all 0.3s;\n  cursor: pointer;\n  position: absolute;\n  top: 2px;\n  content: ' ';\n  display: block;\n  width: 16px;\n  height: 16px;\n  border: 1px solid #d9d9d9;\n  border-radius: 2px;\n}\n.treejs .treejs-checkbox:hover:before {\n  -webkit-box-shadow: 0 0 2px 1px #1890ff;\n          box-shadow: 0 0 2px 1px #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__checked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 4px;\n  left: 5px;\n  width: 5px;\n  height: 9px;\n  border: 2px solid #fff;\n  border-top: none;\n  border-left: none;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:before {\n  background-color: #1890ff;\n  border-color: #1890ff;\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 9px;\n  left: 3px;\n  width: 10px;\n  height: 2px;\n  background-color: #fff;\n}\n.treejs .treejs-node__disabled {\n  cursor: not-allowed;\n  color: rgba(255, 255, 255, 0.25);\n}\n.treejs .treejs-node__disabled .treejs-checkbox {\n  cursor: not-allowed;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:before {\n  cursor: not-allowed;\n  border-color: #d9d9d9 !important;\n  background-color: #f5f5f5 !important;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:hover:before {\n  -webkit-box-shadow: none !important;\n          box-shadow: none !important;\n}\n.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {\n  border-color: #d9d9d9;\n}\n.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: #d9d9d9;\n}\n.treejs .treejs-label {\n  vertical-align: middle;\n}\n","",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:["@color-disable: #d4d4d4;\n@bgcolor-disable: #f5f5f5;\n@greyborder: #d9d9d9;\n@bluebg: #1890ff;\n\n.treejs {\n  box-sizing: border-box;\n  font-size: 14px;\n  margin-left: -18px;\n  user-select: none;\n\n  *:after,\n  *:before {\n    box-sizing: border-box;\n  }\n\n  & > .treejs-node {\n    padding-left: 0;\n  }\n\n  .treejs-nodes {\n    list-style: none;\n    padding-left: 18px;\n    margin: 0; //  for default ul...\n    overflow: hidden;\n    transition: height 150ms ease-out, opacity 150ms ease-out;\n  }\n\n  .treejs-node {\n    cursor: pointer;\n    overflow: hidden;\n\n    &.treejs-placeholder {\n      padding-left: 18px;\n    }\n  }\n\n  .treejs-switcher {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n    transition: transform 150ms ease-out;\n\n    &:before {\n      position: absolute;\n      top: 8px;\n      left: 6px;\n      display: block;\n      content: ' ';\n      border: 4px solid transparent;\n      border-top: 4px solid rgba(245, 245, 245, 0.7);\n      transition: border-color 150ms;\n    }\n    &:hover:before {\n      border-top: 4px solid rgba(245, 245, 245, 0.96);\n    }\n  }\n  .treejs-node__close > .treejs-switcher {\n    transform: rotate(-90deg);\n  }\n  .treejs-node__close > .treejs-nodes {\n    height: 0;\n  }\n\n  .treejs-checkbox {\n    display: inline-block;\n    vertical-align: middle;\n    width: 20px;\n    height: 20px;\n    cursor: pointer;\n    position: relative;\n\n    &:before {\n      transition: all 0.3s;\n      cursor: pointer;\n      position: absolute;\n      top: 2px;\n      content: ' ';\n      display: block;\n      width: 16px;\n      height: 16px;\n      border: 1px solid @greyborder;\n      border-radius: 2px;\n    }\n    &:hover:before {\n      box-shadow: 0 0 2px 1px @bluebg;\n    }\n  }\n  .treejs-node__checked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 4px;\n        left: 5px;\n        width: 5px;\n        height: 9px;\n        border: 2px solid #fff;\n        border-top: none;\n        border-left: none;\n        transform: rotate(45deg);\n      }\n    }\n  }\n  .treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:before {\n        background-color: @bluebg;\n        border-color: @bluebg;\n      }\n      &:after {\n        position: absolute;\n        content: ' ';\n        display: block;\n        top: 9px;\n        left: 3px;\n        width: 10px;\n        height: 2px;\n        background-color: #fff;\n      }\n    }\n  }\n\n  .treejs-node__disabled {\n    cursor: not-allowed;\n    color: rgba(255, 255, 255, 0.25);\n    .treejs-checkbox {\n      cursor: not-allowed;\n      &:before {\n        cursor: not-allowed;\n        border-color: @greyborder !important;\n        background-color: @bgcolor-disable !important;\n      }\n      &:hover:before {\n        box-shadow: none !important;\n      }\n    }\n    .treejs-node__checked {\n      & > .treejs-checkbox {\n        &:after {\n          border-color: @greyborder;\n        }\n      }\n    }\n    .treejs-node__halfchecked {\n      & > .treejs-checkbox {\n        &:after {\n          background-color: @greyborder;\n        }\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__checked {\n    & > .treejs-checkbox {\n      &:after {\n        border-color: @greyborder;\n      }\n    }\n  }\n  .treejs-node__disabled.treejs-node__halfchecked {\n    & > .treejs-checkbox {\n      &:after {\n        background-color: @greyborder;\n      }\n    }\n  }\n\n  .treejs-label {\n    vertical-align: middle;\n  }\n}\n"],sourceRoot:""}]),t.Z=o},645:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r="",i=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),i&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),i&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r}).join("")},t.i=function(e,r,i,n,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),n&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=n):u[4]="".concat(n)),t.push(u))}},t}},537:function(e){e.exports=function(e){var t=e[1],r=e[3];if(!r)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),s="/*# ".concat(n," */"),o=r.sources.map(function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")});return[t].concat(o).concat([s]).join("\n")}return[t].join("\n")}},379:function(e){var t=[];function r(e){for(var r=-1,i=0;i<t.length;i++)if(t[i].identifier===e){r=i;break}return r}function i(e,i){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=s[c]||0,p="".concat(c," ").concat(u);s[c]=u+1;var h=r(p),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(d);else{var f=n(d,i);i.byIndex=a,t.splice(a,0,{identifier:p,updater:f,references:1})}o.push(p)}return o}function n(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,n){var s=i(e=e||[],n=n||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=r(s[o]);t[a].references--}for(var l=i(e,n),c=0;c<s.length;c++){var u=r(s[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}s=l}}},216:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},636:function(e,t,r){e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},795:function(e){e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var i="";r.supports&&(i+="@supports (".concat(r.supports,") {")),r.media&&(i+="@media ".concat(r.media," {"));var n=void 0!==r.layer;n&&(i+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),i+=r.css,n&&(i+="}"),r.media&&(i+="}"),r.supports&&(i+="}");var s=r.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/",i+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," *"),i+="/"),t.styleTagTransform(i,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={id:i,exports:{}};return e[i](s,s.exports,r),s.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.nc=void 0;var i={};return function(){r.d(i,{default:function(){return C}});var e=r(379),t=r.n(e),n=r(795),s=r.n(n),o=r(636),a=r.n(o),l=r(216),c=r.n(l),u=r(589),p=r.n(u),h=r(820),d={};h.Z&&h.Z.locals&&(d.locals=h.Z.locals);var f,g=0,m={};m.styleTagTransform=p(),m.setAttributes=a(),m.insert=function(e,t){(t.target||document.head).appendChild(e)},m.domAPI=s(),m.insertStyleElement=c(),d.use=function(e){return m.options=e||{},g++||(f=t()(h.Z,m)),d},d.unuse=function(){g>0&&!--g&&(f(),f=null)};var _=d;function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,s=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(i=r.next()).done)&&(s.push(i.value),!t||s.length!==t);o=!0);}catch(e){a=!0,n=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw n}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach(function(t){y(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function E(e){var t={};return e.reduce(function(e,r){return t[r]||(t[r]=!0,e.push(r)),e},[])}function S(e,t){requestAnimationFrame(function(){t.enter(),requestAnimationFrame(function(){t.active(),setTimeout(function(){t.leave()},e)})})}var C=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_.use({target:"string"==typeof this.container?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=t,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},r),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(e){this.setValues(E(e))}},disables:{get:function(){return this.getDisables()},set:function(e){this.setDisables(E(e))}},selectedNodes:{get:function(){var e=[],t=this.nodesById;return Object.keys(t).forEach(function(r){if(Object.prototype.hasOwnProperty.call(t,r)&&(1===t[r].status||2===t[r].status)){var i=b({},t[r]);delete i.parent,delete i.children,e.push(i)}}),e}},disabledNodes:{get:function(){var e=[],t=this.nodesById;return Object.keys(t).forEach(function(r){if(Object.prototype.hasOwnProperty.call(t,r)&&t[r].disabled){var i=b({},t[r]);delete i.parent,e.push(i)}}),e}}}),this.init(this.options.data)}var t,r,i;return t=e,i=[{key:"onSwitcherClick",value:function(e){var t=e.parentNode,r=t.lastChild,i=r.scrollHeight;t.classList.contains("treejs-node__close")?S(150,{enter:function(){r.style.height=0,r.style.opacity=0},active:function(){r.style.height="".concat(i,"px"),r.style.opacity=1},leave:function(){r.style.height="",r.style.opacity="",t.classList.remove("treejs-node__close")}}):S(150,{enter:function(){r.style.height="".concat(i,"px"),r.style.opacity=1},active:function(){r.style.height=0,r.style.opacity=0},leave:function(){r.style.height="",r.style.opacity="",t.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(e){var t,r=(t=e,JSON.parse(JSON.stringify(t))),i={},n={},s=[],o=[];return function e(t,r){t.forEach(function(t){i[t.id]=t,t.checked&&s.push(t.id),t.disabled&&o.push(t.id),r&&(t.parent=r),t.children&&t.children.length?e(t.children,t):n[t.id]=t})}(r),{treeNodes:r,nodesById:i,leafNodesById:n,defaultValues:s,defaultDisables:o}}},{key:"createRootEle",value:function(){var e=document.createElement("div");return e.classList.add("treejs"),e}},{key:"createUlEle",value:function(){var e=document.createElement("ul");return e.classList.add("treejs-nodes"),e}},{key:"createLiEle",value:function(e,t){var r=document.createElement("li");if(r.classList.add("treejs-node"),t&&r.classList.add("treejs-node__close"),e.children&&e.children.length){var i=document.createElement("span");i.classList.add("treejs-switcher"),r.appendChild(i)}else r.classList.add("treejs-placeholder");var n=document.createElement("span");n.classList.add("treejs-checkbox"),r.appendChild(n);var s=document.createElement("span");s.classList.add("treejs-label");var o=document.createTextNode(e.text);return s.appendChild(o),r.appendChild(s),r.nodeId=e.id,r}}],(r=[{key:"init",value:function(t){var r=e.parseTreeData(t),i=r.treeNodes,n=r.nodesById,s=r.leafNodesById,o=r.defaultValues,a=r.defaultDisables;this.treeNodes=i,this.nodesById=n,this.leafNodesById=s,this.render(this.treeNodes);var l=this.options,c=l.values,u=l.disables,p=l.loaded;c&&c.length?this.setValues(c):o&&o.length&&this.setValues(o),u&&u.length?this.setDisables(u):a&&a.length&&this.setDisables(a),"function"==typeof p&&p.call(this)}},{key:"render",value:function(t){var r=e.createRootEle();r.appendChild(this.buildTree(t,0)),this.bindEvent(r);var i="string"==typeof this.container?document.querySelector(this.container):this.container;!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(i),i.appendChild(r)}},{key:"buildTree",value:function(t,r){var i=this,n=e.createUlEle();return t&&t.length&&t.forEach(function(t){var s=e.createLiEle(t,r===i.options.closeDepth-1);i.liElementsById[t.id]=s;var o=null;t.children&&t.children.length&&(o=i.buildTree(t.children,r+1)),o&&s.appendChild(o),n.appendChild(s)}),n}},{key:"bindEvent",value:function(t){var r=this;t.addEventListener("click",function(t){var i=t.target;"SPAN"===i.nodeName&&i.classList.contains("treejs-checkbox")?r.onItemClick(i.parentNode.nodeId):"SPAN"===i.nodeName&&i.classList.contains("treejs-label")?r.onItemLabelClick(i.parentNode.nodeId):"LI"===i.nodeName&&i.classList.contains("treejs-node")?r.onItemClick(i.nodeId):"SPAN"===i.nodeName&&i.classList.contains("treejs-switcher")&&e.onSwitcherClick(i)},!1)}},{key:"onItemClick",value:function(e){var t=this.nodesById[e],r=this.options.onChange;t.disabled||(this.setValue(e),this.updateLiElements()),r&&r.call(this)}},{key:"onItemLabelClick",value:function(e){var t=this.options.onItemLabelClick;t&&t.call(this,e)}},{key:"setValue",value:function(e){var t=this.nodesById[e];if(t){var r=t.status,i=1===r||2===r?0:2;t.status=i,this.markWillUpdateNode(t),this.walkUp(t,"status"),this.walkDown(t,"status")}}},{key:"getValues",value:function(){var e=this,t=[];return Object.keys(this.leafNodesById).forEach(function(r){Object.prototype.hasOwnProperty.call(e.leafNodesById,r)&&(1!==e.leafNodesById[r].status&&2!==e.leafNodesById[r].status||t.push(r))}),t}},{key:"setValues",value:function(e){var t=this;this.emptyNodesCheckStatus(),e.forEach(function(e){t.setValue(e)}),this.updateLiElements();var r=this.options.onChange;r&&r.call(this)}},{key:"setDisable",value:function(e){var t=this.nodesById[e];t&&(t.disabled||(t.disabled=!0,this.markWillUpdateNode(t),this.walkUp(t,"disabled"),this.walkDown(t,"disabled")))}},{key:"getDisables",value:function(){var e=this,t=[];return Object.keys(this.leafNodesById).forEach(function(r){Object.prototype.hasOwnProperty.call(e.leafNodesById,r)&&e.leafNodesById[r].disabled&&t.push(r)}),t}},{key:"setDisables",value:function(e){var t=this;this.emptyNodesDisable(),e.forEach(function(e){t.setDisable(e)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(e){e.disabled||(e.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(e){e.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(e,t){var r=v(t,2),i=r[0],n=r[1];return 1!==n.status&&2!==n.status||(e[i]=n),e},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(e,t){var r=v(t,2),i=r[0],n=r[1];return n.disabled&&(e[i]=n),e},{})}},{key:"updateLiElements",value:function(){var e=this;Object.values(this.willUpdateNodesById).forEach(function(t){e.updateLiElement(t)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(e){this.willUpdateNodesById[e.id]=e}},{key:"walkUp",value:function(e,t){var r=e.parent;if(r){if("status"===t){var i,n=r.children.reduce(function(e,t){return Number.isNaN(t.status)?e:e+t.status},0);if(i=n?n===2*r.children.length?2:1:0,r.status===i)return;r.status=i}else{var s=r.children.reduce(function(e,t){return e&&t.disabled},!0);if(r.disabled===s)return;r.disabled=s}this.markWillUpdateNode(r),this.walkUp(r,t)}}},{key:"walkDown",value:function(e,t){var r=this;e.children&&e.children.length&&e.children.forEach(function(i){"status"===t&&i.disabled||(i[t]=e[t],r.markWillUpdateNode(i),r.walkDown(i,t))})}},{key:"updateLiElement",value:function(e){var t=this.liElementsById[e.id].classList;switch(e.status){case 0:t.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:t.remove("treejs-node__checked"),t.add("treejs-node__halfchecked");break;case 2:t.remove("treejs-node__halfchecked"),t.add("treejs-node__checked")}switch(e.disabled){case!0:t.contains("treejs-node__disabled")||t.add("treejs-node__disabled");break;case!1:t.contains("treejs-node__disabled")&&t.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var e=this;Object.keys(this.leafNodesById).forEach(function(t){var r=e.leafNodesById[t];!function e(t,r){try{var i=t.liElementsById[r.parent.id];i.classList.contains("treejs-node__close")||i.getElementsByClassName("treejs-switcher")[0].click()}catch(t){return}Object.prototype.hasOwnProperty.call(r,"parent")&&e(t,r.parent)}(e,r)})}},{key:"expandAll",value:function(){!function e(t,r){var i=t.liElementsById[r.id];i.classList.contains("treejs-node__close")&&i.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(r,"children")&&r.children.forEach(function(r){return e(t,r)})}(this,this.treeNodes[0])}}])&&w(t.prototype,r),i&&w(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()}(),i.default}()},819:function(e,t){!function(e){const t="tp";function r(e){return t=>r=>{if(!t&&void 0===r)return{succeeded:!1,value:void 0};if(t&&void 0===r)return{succeeded:!0,value:void 0};const i=e(r);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function i(e){return{custom:t=>r(t)(e),boolean:r(e=>"boolean"==typeof e?e:void 0)(e),number:r(e=>"number"==typeof e?e:void 0)(e),string:r(e=>"string"==typeof e?e:void 0)(e),function:r(e=>"function"==typeof e?e:void 0)(e),constant:t=>r(e=>e===t?t:void 0)(e),raw:r(e=>e)(e),object:t=>r(e=>{if(null!==(r=e)&&"object"==typeof r)return function(e,t){return Object.keys(t).reduce((r,i)=>{if(void 0===r)return;const n=(0,t[i])(e[i]);return n.succeeded?Object.assign(Object.assign({},r),{[i]:n.value}):void 0},{})}(e,t);var r})(e),array:t=>r(e=>{if(Array.isArray(e))return r=t,e.reduce((e,t)=>{if(void 0===e)return;const i=r(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0},[]);var r})(e)}}const n={optional:i(!0),required:i(!1)};function s(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((i=i.apply(e,t||[])).next())})}function o(e){return s(this,void 0,void 0,function*(){const t=new Image;return t.crossOrigin="anonymous",new Promise((r,i)=>{t.src=e,t.onload=(()=>{r(t)}),t.onerror=i})})}const a=(l="img",(e,r)=>[t,"-",l,"v",e?`_${e}`:"",r?`-${r}`:""].join(""));var l;class c{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(a()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(a("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.image_=e.createElement("img"),this.image_.classList.add(a("image")),this.image_.classList.add(a(`image_${t.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=(e=>{t.clickCallback?t.clickCallback(e,this.input):this.input.click()}),this.element.classList.add(a("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?null==t||t.classList.add(a("area_dragging")):null==t||t.classList.remove(a("area_dragging"))}}let u=null;class p{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new c(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit,clickCallback:t.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(e){const t=(null==e?void 0:e.target).files;if(!t||!t.length)return;const r=t[0];this.setValue(r)}onDrop(e){return s(this,void 0,void 0,function*(){e.preventDefault();try{const{dataTransfer:t}=e,r=null==t?void 0:t.files[0];if(r)this.setValue(r);else{const e=null==t?void 0:t.getData("url");if(!e)throw new Error("No url");this.setValue(e)}}catch(e){console.error("Could not parse the dropped image",e)}finally{this.view.changeDraggingState(!1)}})}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){return s(this,void 0,void 0,function*(){e instanceof HTMLImageElement?this.updateImage(e.src):"string"!=typeof e&&e?yield this.setValue(e):("placeholder"!==e&&e||(e=(yield this.handlePlaceholderImage()).src),this.updateImage(e))})}updateImage(e){this.view.changeImage(e)}setValue(e){return s(this,void 0,void 0,function*(){if(e instanceof HTMLImageElement)this.value.setRawValue(e);else if(e instanceof File){const t=URL.createObjectURL(e)+"#"+e.name;e.src=t;const r=yield o(t).catch(()=>{});this.value.setRawValue(r||e)}else e?this.value.setRawValue(yield o(e)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return s(this,void 0,void 0,function*(){return u||(u=yield function(){const e=document.createElement("canvas");e.width=320,e.height=50;const t=e.getContext("2d");return t.fillStyle="#00000004",t.fillRect(0,0,e.width,e.height),t.fillStyle="#eee",t.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',t.textAlign="center",t.textBaseline="middle",t.fillText("No image",.5*e.width,.5*e.height),new Promise(t=>{e.toBlob(e=>{const r=new Image;r.src=URL.createObjectURL(e),r.isPlaceholder=!0,r.onload=(()=>{t(r)})})})}()),u})}}const h=[".jpg",".png",".gif"],d={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(e,t){if(!(e instanceof HTMLImageElement||"string"==typeof e))return null;const r=n,i=function(e,t){const r=n.required.object(t)(e);return r.succeeded?r.value:void 0}(t,{view:r.required.constant("input-image"),acceptUrl:r.optional.boolean,clickCallback:r.optional.function,imageFit:r.optional.custom(e=>"contain"===e||"cover"===e?e:void 0),extensions:r.optional.array(r.required.string)});return i?{initialValue:e,params:i}:null},binding:{reader:e=>e=>void 0!==e.src?""===e.src?"placeholder":e.src:e,writer:e=>(e,t)=>{e.write(t)}},controller(e){var t,r;return new p(e.document,{value:e.value,imageFit:null!==(t=e.params.imageFit)&&void 0!==t?t:"cover",clickCallback:e.params.clickCallback,viewProps:e.viewProps,extensions:null!==(r=e.params.extensions)&&void 0!==r?r:h})}};e.plugin=d,Object.defineProperty(e,"__esModule",{value:!0})}(t)},665:function(e,t){!function(e){class t{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class r{constructor(e){this.target=e}}class i extends r{constructor(e,t,r,i){super(e),this.value=t,this.presetKey=r,this.last=null==i||i}}class n extends r{constructor(e,t,r){super(e),this.value=t,this.presetKey=r}}class s extends r{constructor(e,t){super(e),this.expanded=t}}function o(e){return null==e}function a(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const l={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class c{constructor(e){var t;this.message=null!==(t=l[e.type](e.context))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}static alreadyDisposed(){return new c({type:"alreadydisposed"})}static notBindable(){return new c({type:"notbindable"})}static propertyNotFound(e){return new c({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new c({type:"shouldneverhappen"})}}class u{constructor(e,t,r){this.obj_=e,this.key_=t,this.presetKey_=null!=r?r:t}static isBindable(e){return null!==e&&"object"==typeof e}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const r=this.read();if(!u.isBindable(r))throw c.notBindable();if(!(e in r))throw c.propertyNotFound(e);r[e]=t}}class p extends t{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return null!==(e=this.controller_.valueController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller_.valueController.emitter.on(e,()=>{i(new r(this))}),this}}class h{constructor(){this.observers_={}}on(e,t){let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t}),this}off(e,t){const r=this.observers_[e];return r&&(this.observers_[e]=r.filter(e=>e.handler!==t)),this}emit(e,t){const r=this.observers_[e];r&&r.forEach(e=>{e.handler(t)})}}const d="tp";function f(e){return(t,r)=>[d,"-",e,"v",t?`_${t}`:"",r?`-${r}`:""].join("")}function g(e){return e.rawValue}function m(e,t){var r,i;e.emitter.on("change",(r=g,i=t,e=>i(r(e)))),t(e.rawValue)}function _(e,t,r){m(e.value(t),r)}function v(e,t){return r=>{!function(e,t,r){r?e.classList.add(t):e.classList.remove(t)}(e,t,r)}}function x(e,t){m(e,e=>{t.textContent=null!=e?e:""})}const A=f("btn");class b{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(A()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("button");r.classList.add(A("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const i=e.createElement("div");i.classList.add(A("t")),x(t.props.value("title"),i),this.buttonElement.appendChild(i)}}class y{constructor(e,t){this.emitter=new h,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new b(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class w{constructor(e,t){var r;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(r=null==t?void 0:t.equals)&&void 0!==r?r:(e,t)=>e===t,this.emitter=new h,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const r=null!=t?t:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e;(!this.equals_(this.rawValue_,i)||r.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:r,rawValue:i,sender:this}))}}class E{constructor(e){this.emitter=new h,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const r=null!=t?t:{forceEmit:!1,last:!0};(this.value_!==e||r.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:r,rawValue:this.value_,sender:this}))}}function S(e,t){const r=null==t?void 0:t.constraint,i=null==t?void 0:t.equals;return r||i?new w(e,t):new E(e)}class C{constructor(e){this.emitter=new h,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((t,r)=>Object.assign(t,{[r]:S(e[r])}),{})}static fromObject(e){const t=this.createCore(e);return new C(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function M(e){return t=>r=>{if(!t&&void 0===r)return{succeeded:!1,value:void 0};if(t&&void 0===r)return{succeeded:!0,value:void 0};const i=e(r);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function T(e){return{custom:t=>M(t)(e),boolean:M(e=>"boolean"==typeof e?e:void 0)(e),number:M(e=>"number"==typeof e?e:void 0)(e),string:M(e=>"string"==typeof e?e:void 0)(e),function:M(e=>"function"==typeof e?e:void 0)(e),constant:t=>M(e=>e===t?t:void 0)(e),raw:M(e=>e)(e),object:t=>M(e=>{if(null!==(r=e)&&"object"==typeof r)return function(e,t){return Object.keys(t).reduce((r,i)=>{if(void 0===r)return;const n=(0,t[i])(e[i]);return n.succeeded?Object.assign(Object.assign({},r),{[i]:n.value}):void 0},{})}(e,t);var r})(e),array:t=>M(e=>{if(Array.isArray(e))return r=t,e.reduce((e,t)=>{if(void 0===e)return;const i=r(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0},[]);var r})(e)}}const I={optional:T(!0),required:T(!1)};function k(e,t){const r=I.required.object(t)(e);return r.succeeded?r.value:void 0}const D=f(""),P={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class B{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(e=>{t.classList.remove(D(void 0,P[e]))}),this.blade.get("positions").forEach(e=>{t.classList.add(D(void 0,P[e]))})}),this.viewProps.handleDispose(()=>{!function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}(t)})}get parent(){return this.parent_}}const R="http://www.w3.org/2000/svg";function L(e){e.offsetHeight}function O(e){return void 0!==e.ontouchstart}const F={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function U(e,t){const r=e.createElementNS(R,"svg");return r.innerHTML=F[t],r}function N(e,t,r){e.insertBefore(t,e.children[r])}function j(e){e.parentElement&&e.parentElement.removeChild(e)}function G(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function z(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}const V=f("lbl");class Q{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(V()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(V("l")),_(t.props,"label",t=>{o(t)?this.element.classList.add(V(void 0,"nol")):(this.element.classList.remove(V(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(r),r.appendChild(function(e,t){const r=e.createDocumentFragment();return t.split("\n").map(t=>e.createTextNode(t)).forEach((t,i)=>{i>0&&r.appendChild(e.createElement("br")),r.appendChild(t)}),r}(e,t)))}),this.element.appendChild(r),this.labelElement=r;const i=e.createElement("div");i.classList.add(V("v")),this.element.appendChild(i),this.valueElement=i}}class H extends B{constructor(e,t){const r=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new Q(e,{props:t.props,viewProps:r}),viewProps:r})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const W={id:"button",type:"blade",accept(e){const t=I,r=k(e,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return r?{params:r}:null},controller:e=>new H(e.document,{blade:e.blade,props:C.fromObject({label:e.params.label}),valueController:new y(e.document,{props:C.fromObject({title:e.params.title}),viewProps:e.viewProps})}),api:e=>e.controller instanceof H&&e.controller.valueController instanceof y?new p(e.controller):null};class q extends B{constructor(e){super(e),this.value=e.value}}function X(){return new C({positions:S([],{equals:a})})}class Y extends C{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},r=C.createCore(t);return new Y(r)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!o(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const r=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};_(this,"expanded",r),_(this,"temporaryExpanded",r)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function K(e,t){t.style.height=e.styleHeight}function J(e,t){e.value("expanded").emitter.on("beforechange",()=>{e.set("completed",!1),o(e.get("expandedHeight"))&&e.set("expandedHeight",function(e,t){let r=0;return function(e,t){const r=e.style.transition;e.style.transition="none",t(),e.style.transition=r}(t,()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),L(t),r=t.clientHeight,e.set("temporaryExpanded",null),L(t)}),r}(e,t)),e.set("shouldFixHeight",!0),L(t)}),e.emitter.on("change",()=>{K(e,t)}),K(e,t),t.addEventListener("transitionend",t=>{"height"===t.propertyName&&e.cleanUpTransition()})}class Z extends t{constructor(e,t){super(e),this.rackApi_=t}}class ${constructor(e){this.emitter=new h,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw c.shouldNeverHappen();const r=void 0!==t?t:this.items_.length;this.items_.splice(r,0,e),this.cache_.add(e);const i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach(e=>{this.cache_.add(e)})),this.emitter.emit("add",{index:r,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const r=this.extract_(e);r&&(r.emitter.off("add",this.onSubListAdd_),r.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class ee extends t{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new h,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new i(this,t,this.controller_.binding.target.presetKey,e.options.last)})}}class te extends H{constructor(e,t){super(e,t),this.binding=t.binding}}class re extends t{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new h,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new n(this,t,this.controller_.binding.target.presetKey)})}}class ie extends H{constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function ne(e){return e instanceof ae?e.apiSet_:e instanceof Z?e.rackApi_.apiSet_:null}function se(e,t){const r=e.find(e=>e.controller_===t);if(!r)throw c.shouldNeverHappen();return r}function oe(e,t,r){if(!u.isBindable(e))throw c.notBindable();return new u(e,t,r)}class ae extends t{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new h,this.apiSet_=new $(ne),this.pool_=t;const r=this.controller_.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),r.emitter.on("inputchange",this.onRackInputChange_),r.emitter.on("monitorupdate",this.onRackMonitorUpdate_),r.children.forEach(e=>{this.setUpApi_(e)})}get children(){return this.controller_.rack.children.map(e=>se(this.apiSet_,e))}addInput(e,t,r){const i=r||{},n=this.controller_.view.element.ownerDocument,s=this.pool_.createInput(n,oe(e,t,i.presetKey),i),o=new ee(s);return this.add(o,i.index)}addMonitor(e,t,r){const i=r||{},n=this.controller_.view.element.ownerDocument,s=this.pool_.createMonitor(n,oe(e,t),i),o=new re(s);return this.add(o,i.index)}addFolder(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}(this,e)}addButton(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}(this,e)}addSeparator(e){return function(e,t){const r=t||{};return e.addBlade(Object.assign(Object.assign({},r),{view:"separator"}))}(this,e)}addTab(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const r=this.apiSet_.find(t=>t.controller_===e.controller_);return r&&this.apiSet_.remove(r),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,r=this.pool_.createBlade(t,e),i=this.pool_.createBladeApi(r);return this.add(i,e.index)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}setUpApi_(e){this.apiSet_.find(t=>t.controller_===e)||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=se(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof te){const r=se(this.apiSet_,t),n=t.binding;this.emitter_.emit("change",{event:new i(r,n.target.read(),n.target.presetKey,e.options.last)})}else if(t instanceof q){const r=se(this.apiSet_,t);this.emitter_.emit("change",{event:new i(r,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof ie))throw c.shouldNeverHappen();const t=se(this.apiSet_,e.bladeController),r=e.bladeController.binding;this.emitter_.emit("update",{event:new n(t,r.target.read(),r.target.presetKey)})}}class le extends Z{constructor(e,t){super(e,new ae(e.rackController,t)),this.emitter_=new h,this.controller_.foldable.value("expanded").emitter.on("change",e=>{this.emitter_.emit("fold",{event:new s(this,e.sender.rawValue)})}),this.rackApi_.on("change",e=>{this.emitter_.emit("change",{event:e})}),this.rackApi_.on("update",e=>{this.emitter_.emit("update",{event:e})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,r){return this.rackApi_.addInput(e,t,r)}addMonitor(e,t,r){return this.rackApi_.addMonitor(e,t,r)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}}class ce extends B{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class ue{constructor(e,t){const r=f(t.viewName);this.element=e.createElement("div"),this.element.classList.add(r()),t.viewProps.bindClassModifiers(this.element)}}function pe(e){return e instanceof fe?e.rack:e instanceof ce?e.rackController.rack:null}function he(e){const t=pe(e);return t?t.bcSet_:null}class de{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new h,this.blade_=null!=e?e:null,null===(t=this.blade_)||void 0===t||t.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new $(he),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)}remove(e){e.parent_=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(t=>t instanceof e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const r=e.item;if(r.viewProps.emitter.on("change",this.onChildViewPropsChange_),r.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),r.viewProps.handleDispose(this.onChildDispose_),r instanceof te)r.binding.emitter.on("change",this.onChildInputChange_);else if(r instanceof ie)r.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(r instanceof q)r.value.emitter.on("change",this.onChildValueChange_);else{const e=pe(r);if(e){const t=e.emitter;t.on("layout",this.onDescendantLayout_),t.on("inputchange",this.onDescendantInputChange_),t.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const r=e.item;if(r instanceof te)r.binding.emitter.off("change",this.onChildInputChange_);else if(r instanceof ie)r.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(r instanceof q)r.value.emitter.off("change",this.onChildValueChange_);else{const e=pe(r);if(e){const t=e.emitter;t.off("layout",this.onDescendantLayout_),t.off("inputchange",this.onDescendantInputChange_),t.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter(e=>!e.viewProps.get("hidden")),t=e[0],r=e[e.length-1];this.bcSet_.items.forEach(e=>{const i=[];e===t&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),e===r&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),e.blade.set("positions",i)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(e=>e.viewProps.get("disposed")).forEach(e=>{this.bcSet_.remove(e)})}onChildInputChange_(e){const t=function(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i instanceof te&&i.binding===t)return i}return null}(this.find(te),e.sender);if(!t)throw c.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=function(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i instanceof ie&&i.binding===t)return i}return null}(this.find(ie),e.sender);if(!t)throw c.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=function(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i instanceof q&&i.value===t)return i}return null}(this.find(q),e.sender);if(!t)throw c.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class fe extends B{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new ue(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=new de(t.root?void 0:t.blade);r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.rack=r,this.viewProps.handleDispose(()=>{for(let e=this.rack.children.length-1;e>=0;e--)this.rack.children[e].viewProps.set("disposed",!0)})}onRackAdd_(e){e.isRoot&&N(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.isRoot&&j(e.bladeController.view.element)}}const ge=f("cnt");class me{constructor(e,t){this.className_=f(t.viewName||"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),ge()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),_(this.foldable_,"completed",v(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),_(t.props,"title",e=>{o(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const i=e.createElement("div");i.classList.add(this.className_("t")),x(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i;const n=e.createElement("div");n.classList.add(this.className_("m")),this.buttonElement.appendChild(n);const s=t.containerElement;s.classList.add(this.className_("c")),this.element.appendChild(s),this.containerElement=s}}class _e extends ce{constructor(e,t){var r;const i=Y.create(null===(r=t.expanded)||void 0===r||r),n=new fe(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:n,view:new me(e,{containerElement:n.view.element,foldable:i,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=i,J(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ve={id:"folder",type:"blade",accept(e){const t=I,r=k(e,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return r?{params:r}:null},controller:e=>new _e(e.document,{blade:e.blade,expanded:e.params.expanded,props:C.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof _e?new le(e.controller,e.pool):null};class xe extends q{constructor(e,t){const r=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new Q(e,{props:t.props,viewProps:r}),viewProps:r})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ae extends t{}const be=f("spr");class ye{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(be()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("hr");r.classList.add(be("r")),this.element.appendChild(r)}}class we extends B{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new ye(e,{viewProps:t.viewProps})}))}}const Ee={id:"separator",type:"blade",accept(e){const t=k(e,{view:I.required.constant("separator")});return t?{params:t}:null},controller:e=>new we(e.document,{blade:e.blade,viewProps:e.viewProps}),api:e=>e.controller instanceof we?new Ae(e.controller):null},Se=f("");function Ce(e,t){return v(e,Se(void 0,t))}class Me extends C{constructor(e){super(e)}static create(e){var t,r;const i=null!=e?e:{},n={disabled:null!==(t=i.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(r=i.hidden)&&void 0!==r&&r},s=C.createCore(n);return new Me(s)}bindClassModifiers(e){_(this,"disabled",Ce(e,"disabled")),_(this,"hidden",Ce(e,"hidden"))}bindDisabled(e){_(this,"disabled",t=>{e.disabled=t})}bindTabIndex(e){_(this,"disabled",t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}}const Te=f("tbi");class Ie{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Te()),t.viewProps.bindClassModifiers(this.element),_(t.props,"selected",e=>{e?this.element.classList.add(Te(void 0,"sel")):this.element.classList.remove(Te(void 0,"sel"))});const r=e.createElement("button");r.classList.add(Te("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const i=e.createElement("div");i.classList.add(Te("t")),x(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class ke{constructor(e,t){this.emitter=new h,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Ie(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class De{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ke(e,{props:t.itemProps,viewProps:Me.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new fe(e,{blade:X(),viewProps:Me.create()}),this.props=t.props,_(this.props,"selected",e=>{this.itemController.props.set("selected",e),this.contentController.viewProps.set("hidden",!e)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Pe{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return null!==(e=this.controller_.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,r){return this.rackApi_.addInput(e,t,r)}addMonitor(e,t,r){return this.rackApi_.addMonitor(e,t,r)}addBlade(e){return this.rackApi_.addBlade(e)}}class Be extends Z{constructor(e,t){super(e,new ae(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new h,this.pageApiMap_=new Map,this.rackApi_.on("change",e=>{this.emitter_.emit("change",{event:e})}),this.rackApi_.on("update",e=>{this.emitter_.emit("update",{event:e})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(e=>{this.setUpPageApi_(e)})}get pages(){return this.controller_.pageSet.items.map(e=>{const t=this.pageApiMap_.get(e);if(!t)throw c.shouldNeverHappen();return t})}addPage(e){const t=this.controller_.view.element.ownerDocument,r=new De(t,{itemProps:C.fromObject({selected:!1,title:e.title}),props:C.fromObject({selected:!1})});this.controller_.add(r,e.index);const i=this.pageApiMap_.get(r);if(!i)throw c.shouldNeverHappen();return i}removePage(e){this.controller_.remove(e)}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find(t=>t.controller_===e.contentController);if(!t)throw c.shouldNeverHappen();const r=new Pe(e,t);this.pageApiMap_.set(e,r)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw c.shouldNeverHappen();this.pageApiMap_.delete(e.item)}}const Re=f("tab");class Le{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Re(),ge()),t.viewProps.bindClassModifiers(this.element),m(t.empty,v(this.element,Re(void 0,"nop")));const r=e.createElement("div");r.classList.add(Re("i")),this.element.appendChild(r),this.itemsElement=r;const i=t.contentsElement;i.classList.add(Re("c")),this.element.appendChild(i),this.contentsElement=i}}class Oe extends ce{constructor(e,t){const r=new fe(e,{blade:t.blade,viewProps:t.viewProps}),i=S(!0);super({blade:t.blade,rackController:r,view:new Le(e,{contentsElement:r.view.element,empty:i,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new $(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=i,this.applyPages_()}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,null!=t?t:this.pageSet_.items.length)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=0===this.pageSet_.items.length}onPageAdd_(e){const t=e.item;N(this.view.itemsElement,t.itemController.view.element,e.index),this.rackController.rack.add(t.contentController,e.index),t.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(e){const t=e.item;j(t.itemController.view.element),this.rackController.rack.remove(t.contentController),t.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(0===this.pageSet_.items.length)return;const e=this.pageSet_.items.findIndex(e=>e.props.get("selected"));e<0?this.pageSet_.items.forEach((e,t)=>{e.props.set("selected",0===t)}):this.pageSet_.items.forEach((t,r)=>{t.props.set("selected",r===e)})}onPageSelectedChange_(e){if(e.rawValue){const t=this.pageSet_.items.findIndex(t=>t.props.value("selected")===e.sender);this.pageSet_.items.forEach((e,r)=>{e.props.set("selected",r===t)})}else this.keepSelection_()}}const Fe={id:"tab",type:"blade",accept(e){const t=I,r=k(e,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return r&&0!==r.pages.length?{params:r}:null},controller(e){const t=new Oe(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach(r=>{const i=new De(e.document,{itemProps:C.fromObject({selected:!1,title:r.title}),props:C.fromObject({selected:!1})});t.add(i)}),t},api:e=>e.controller instanceof Oe?new Be(e.controller,e.pool):null};class Ue{constructor(){this.disabled=!1,this.emitter=new h}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ne{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new h,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class je{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((e,t)=>t.constrain(e),e)}}function Ge(e,t){if(e instanceof t)return e;if(e instanceof je){const r=e.constraints.reduce((e,r)=>e||(r instanceof t?r:null),null);if(r)return r}return null}class ze{constructor(e){this.options=e}constrain(e){const t=this.options;return 0===t.length||t.filter(t=>t.value===e).length>0?e:t[0].value}}class Ve{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let t=e;return o(this.minValue)||(t=Math.max(t,this.minValue)),o(this.maxValue)||(t=Math.min(t,this.maxValue)),t}}class Qe{constructor(e){this.step=e}constrain(e){return(e<0?-Math.round(-e/this.step):Math.round(e/this.step))*this.step}}const He=f("lst");class We{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(He()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("select");r.classList.add(He("s")),_(this.props_,"options",t=>{G(r),t.forEach((t,i)=>{const n=e.createElement("option");n.dataset.index=String(i),n.textContent=t.text,n.value=String(t.value),r.appendChild(n)})}),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.selectElement=r;const i=e.createElement("div");i.classList.add(He("m")),i.appendChild(U(e,"dropdown")),this.element.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class qe{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new We(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget.selectedOptions.item(0);if(!t)return;const r=Number(t.dataset.index);this.value.rawValue=this.props.get("options")[r].value}}const Xe=f("pop");class Ye{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xe()),t.viewProps.bindClassModifiers(this.element),m(t.shows,v(this.element,Xe(void 0,"v")))}}class Ke{constructor(e,t){this.shows=S(!1),this.viewProps=t.viewProps,this.view=new Ye(e,{shows:this.shows,viewProps:this.viewProps})}}const Je=f("txt");class Ze{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Je()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const r=e.createElement("input");r.classList.add(Je("i")),r.type="text",t.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class $e{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Ze(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget.value,r=this.parser_(t);o(r)||(this.value.rawValue=r),this.view.refresh()}}function et(e){return"false"!==e&&!!e}function tt(e){return function(e){return String(e)}(e)}class rt{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const it={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class nt{constructor(e,t,r){this.left=t,this.operator=e,this.right=r}evaluate(){const e=it[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const st={"+":e=>e,"-":e=>-e,"~":e=>~e};class ot{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=st[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function at(e){return(t,r)=>{for(let i=0;i<e.length;i++){const n=e[i](t,r);if(""!==n)return n}return""}}function lt(e,t){var r;const i=e.substr(t).match(/^\s+/);return null!==(r=i&&i[0])&&void 0!==r?r:""}function ct(e,t){var r;const i=e.substr(t).match(/^[0-9]+/);return null!==(r=i&&i[0])&&void 0!==r?r:""}function ut(e,t){const r=e.substr(t,1);if(t+=1,"e"!==r.toLowerCase())return"";const i=function(e,t){const r=ct(e,t);if(""!==r)return r;const i=e.substr(t,1);if("-"!==i&&"+"!==i)return"";const n=ct(e,t+=1);return""===n?"":i+n}(e,t);return""===i?"":r+i}function pt(e,t){const r=e.substr(t,1);if("0"===r)return r;const i=function(e,t){const r=e.substr(t,1);return r.match(/^[1-9]$/)?r:""}(e,t);return t+=i.length,""===i?"":i+ct(e,t)}const ht=at([function(e,t){const r=pt(e,t);if(t+=r.length,""===r)return"";const i=e.substr(t,1);if(t+=i.length,"."!==i)return"";const n=ct(e,t);return r+i+n+ut(e,t+=n.length)},function(e,t){const r=e.substr(t,1);if(t+=r.length,"."!==r)return"";const i=ct(e,t);return t+=i.length,""===i?"":r+i+ut(e,t)},function(e,t){const r=pt(e,t);return t+=r.length,""===r?"":r+ut(e,t)}]),dt=at([function(e,t){const r=e.substr(t,2);if(t+=r.length,"0b"!==r.toLowerCase())return"";const i=function(e,t){var r;const i=e.substr(t).match(/^[01]+/);return null!==(r=i&&i[0])&&void 0!==r?r:""}(e,t);return""===i?"":r+i},function(e,t){const r=e.substr(t,2);if(t+=r.length,"0o"!==r.toLowerCase())return"";const i=function(e,t){var r;const i=e.substr(t).match(/^[0-7]+/);return null!==(r=i&&i[0])&&void 0!==r?r:""}(e,t);return""===i?"":r+i},function(e,t){const r=e.substr(t,2);if(t+=r.length,"0x"!==r.toLowerCase())return"";const i=function(e,t){var r;const i=e.substr(t).match(/^[0-9a-f]+/i);return null!==(r=i&&i[0])&&void 0!==r?r:""}(e,t);return""===i?"":r+i}]),ft=at([dt,ht]);function gt(e,t,r){r+=lt(t,r).length;const i=e.filter(e=>t.startsWith(e,r))[0];return i?(r+=i.length,{cursor:r+=lt(t,r).length,operator:i}):null}const mt=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((e,t)=>(function(e,t){return(r,i)=>{const n=e(r,i);if(!n)return null;i=n.cursor;let s=n.evaluable;for(;;){const n=gt(t,r,i);if(!n)break;i=n.cursor;const o=e(r,i);if(!o)return null;i=o.cursor,s=new nt(n.operator,s,o.evaluable)}return s?{cursor:i,evaluable:s}:null}})(e,t),function e(t,r){const i=function(e,t){return function(e,t){const r=ft(e,t);return t+=r.length,""===r?null:{evaluable:new rt(r),cursor:t}}(e,t)||function(e,t){const r=e.substr(t,1);if(t+=r.length,"("!==r)return null;const i=_t(e,t);if(!i)return null;t=i.cursor,t+=lt(e,t).length;const n=e.substr(t,1);return t+=n.length,")"!==n?null:{evaluable:i.evaluable,cursor:t}}(e,t)}(t,r);if(i)return i;const n=t.substr(r,1);if(r+=n.length,"+"!==n&&"-"!==n&&"~"!==n)return null;const s=e(t,r);return s?{cursor:r=s.cursor,evaluable:new ot(n,s.evaluable)}:null});function _t(e,t){return t+=lt(e,t).length,mt(e,t)}function vt(e){var t;const r=function(e){const t=_t(e,0);return t?t.cursor+lt(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==r?void 0:r.evaluate())&&void 0!==t?t:null}function xt(e){if("number"==typeof e)return e;if("string"==typeof e){const t=vt(e);if(!o(t))return t}return 0}function At(e){return String(e)}function bt(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}const yt=bt(0);function wt(e){return yt(e)+"%"}function Et(e){return String(e)}function St(e){return e}function Ct(e,t){for(;e.length<t;)e.push(void 0)}function Mt(e){const t=[];return Ct(t,e),S(t)}function Tt(e){const t=e.indexOf(void 0);return t<0?e:e.slice(0,t)}function It({primary:e,secondary:t,forward:r,backward:i}){let n=!1;function s(e){n||(n=!0,e(),n=!1)}e.emitter.on("change",i=>{s(()=>{t.setRawValue(r(e,t),i.options)})}),t.emitter.on("change",n=>{s(()=>{e.setRawValue(i(e,t),n.options)}),s(()=>{t.setRawValue(r(e,t),n.options)})}),s(()=>{t.setRawValue(r(e,t),{forceEmit:!1,last:!0})})}function kt(e,t){const r=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+r:t.downKey?-r:0}function Dt(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function Pt(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function Bt(e){return function(e){return"ArrowUp"===e||"ArrowDown"===e}(e)||"ArrowLeft"===e||"ArrowRight"===e}function Rt(e,t){const r=t.ownerDocument.defaultView,i=t.getBoundingClientRect();return{x:e.pageX-((r&&r.scrollX||0)+i.left),y:e.pageY-((r&&r.scrollY||0)+i.top)}}class Lt{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new h,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const r=this.elem_.ownerDocument;r.addEventListener("mousemove",this.onDocumentMouseMove_),r.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Rt(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Rt(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Rt(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-r.left,y:t.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-r.left,y:t.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const r=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(r?{x:r.clientX-i.left,y:r.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Ot(e,t,r,i,n){return i+(e-t)/(r-t)*(n-i)}function Ft(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ut(e,t,r){return Math.min(Math.max(e,t),r)}function Nt(e,t){return(e%t+t)%t}const jt=f("txt");class Gt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(jt(),jt(void 0,"num")),t.arrayPosition&&this.element.classList.add(jt(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("input");r.classList.add(jt("i")),r.type="text",t.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(jt()),this.inputElement.classList.add(jt("i"));const i=e.createElement("div");i.classList.add(jt("k")),this.element.appendChild(i),this.knobElement=i;const n=e.createElementNS(R,"svg");n.classList.add(jt("g")),this.knobElement.appendChild(n);const s=e.createElementNS(R,"path");s.classList.add(jt("gb")),n.appendChild(s),this.guideBodyElem_=s;const o=e.createElementNS(R,"path");o.classList.add(jt("gh")),n.appendChild(o),this.guideHeadElem_=o;const a=e.createElement("div");a.classList.add(f("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(jt(void 0,"drg"));this.element.classList.add(jt(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),r=t+(t>0?-1:t<0?1:0),i=Ut(-r,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${r+i},0 L${r},4 L${r+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class zt{constructor(e,t){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=S(null),this.view=new Gt(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new Lt(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}onInputChange_(e){const t=e.currentTarget.value,r=this.parser_(t);o(r)||(this.value.rawValue=r),this.view.refresh()}onInputKeyDown_(e){const t=kt(this.baseStep_,Dt(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==kt(this.baseStep_,Dt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.originRawValue_+t*this.props.get("draggingScale")}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Vt=f("sld");class Qt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Vt()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(Vt("t")),t.viewProps.bindTabIndex(r),this.element.appendChild(r),this.trackElement=r;const i=e.createElement("div");i.classList.add(Vt("k")),this.trackElement.appendChild(i),this.knobElement=i,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ut(Ot(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Ht{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Qt(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Lt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Ot(Ut(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=kt(this.baseStep_,Pt(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==kt(this.baseStep_,Pt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Wt=f("sldtxt");class qt{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Wt());const r=e.createElement("div");r.classList.add(Wt("s")),this.sliderView_=t.sliderView,r.appendChild(this.sliderView_.element),this.element.appendChild(r);const i=e.createElement("div");i.classList.add(Wt("t")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class Xt{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Ht(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new zt(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,value:t.value,viewProps:t.viewProps}),this.view=new qt(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Yt(e,t){e.write(t)}function Kt(e){const t=I;return Array.isArray(e)?t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(e).value:"object"==typeof e?t.required.raw(e).value:void 0}function Jt(e){if("inline"===e||"popup"===e)return e}function Zt(e){const t=I;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(e).value}function $t(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach(r=>{t.push({text:r,value:e[r]})}),t}function er(e){return o(e)?null:new ze($t(e))}function tr(e){const t=e?Ge(e,ze):null;return t?t.options:null}function rr(e,t){const r=e&&Ge(e,Qe);return r?Ft(r.step):Math.max(Ft(t),2)}function ir(e){const t=function(e){const t=e?Ge(e,Qe):null;return t?t.step:null}(e);return null!=t?t:1}function nr(e,t){var r;const i=e&&Ge(e,Qe),n=Math.abs(null!==(r=null==i?void 0:i.step)&&void 0!==r?r:t);return 0===n?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}const sr=f("ckb");class or{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(sr()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("label");r.classList.add(sr("l")),this.element.appendChild(r);const i=e.createElement("input");i.classList.add(sr("i")),i.type="checkbox",r.appendChild(i),this.inputElement=i,t.viewProps.bindDisabled(this.inputElement);const n=e.createElement("div");n.classList.add(sr("w")),r.appendChild(n);const s=U(e,"check");n.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class ar{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new or(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}const lr={id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const r=k(t,{options:I.optional.custom(Kt)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>et,constraint:e=>(function(e){const t=[],r=er(e.options);return r&&t.push(r),new je(t)})(e.params),writer:e=>Yt},controller:e=>{var t;const r=e.document,i=e.value,n=e.constraint;return n&&Ge(n,ze)?new qe(r,{props:C.fromObject({options:null!==(t=tr(n))&&void 0!==t?t:[]}),value:i,viewProps:e.viewProps}):new ar(r,{value:i,viewProps:e.viewProps})}},cr=f("col");class ur{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cr()),t.foldable.bindExpandedClass(this.element,cr(void 0,"expanded")),_(t.foldable,"completed",v(this.element,cr(void 0,"cpl")));const r=e.createElement("div");r.classList.add(cr("h")),this.element.appendChild(r);const i=e.createElement("div");i.classList.add(cr("s")),r.appendChild(i),this.swatchElement=i;const n=e.createElement("div");if(n.classList.add(cr("t")),r.appendChild(n),this.textElement=n,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(cr("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function pr(e,t,r){const i=Nt(e,360),n=Ut(t/100,0,1),s=Ut(r/100,0,1),o=s*n,a=o*(1-Math.abs(i/60%2-1)),l=s-o;let c,u,p;return[c,u,p]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(p+l)]}function hr(e){return[e[0],e[1],e[2]]}function dr(e,t){return[e[0],e[1],e[2],t]}const fr={hsl:{hsl:(e,t,r)=>[e,t,r],hsv:function(e,t,r){const i=r+t*(100-Math.abs(2*r-100))/200;return[e,0!==i?t*(100-Math.abs(2*r-100))/i:0,r+t*(100-Math.abs(2*r-100))/200]},rgb:function(e,t,r){const i=(e%360+360)%360,n=Ut(t/100,0,1),s=Ut(r/100,0,1),o=(1-Math.abs(2*s-1))*n,a=o*(1-Math.abs(i/60%2-1)),l=s-o/2;let c,u,p;return[c,u,p]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(p+l)]}},hsv:{hsl:function(e,t,r){const i=100-Math.abs(r*(200-t)/100-100);return[e,0!==i?t*r/i:0,r*(200-t)/200]},hsv:(e,t,r)=>[e,t,r],rgb:pr},rgb:{hsl:function(e,t,r){const i=Ut(e/255,0,1),n=Ut(t/255,0,1),s=Ut(r/255,0,1),o=Math.max(i,n,s),a=Math.min(i,n,s),l=o-a;let c=0,u=0;const p=(a+o)/2;return 0!==l&&(u=l/(1-Math.abs(o+a-1)),c=(c=i===o?(n-s)/l:n===o?2+(s-i)/l:4+(i-n)/l)/6+(c<0?1:0)),[360*c,100*u,100*p]},hsv:function(e,t,r){const i=Ut(e/255,0,1),n=Ut(t/255,0,1),s=Ut(r/255,0,1),o=Math.max(i,n,s),a=o-Math.min(i,n,s);let l;return[l=0===a?0:o===i?((n-s)/a%6+6)%6*60:o===n?60*((s-i)/a+2):60*((i-n)/a+4),100*(0===o?0:a/o),100*o]},rgb:(e,t,r)=>[e,t,r]}},gr={hsl:e=>{var t;return[Nt(e[0],360),Ut(e[1],0,100),Ut(e[2],0,100),Ut(null!==(t=e[3])&&void 0!==t?t:1,0,1)]},hsv:e=>{var t;return[Nt(e[0],360),Ut(e[1],0,100),Ut(e[2],0,100),Ut(null!==(t=e[3])&&void 0!==t?t:1,0,1)]},rgb:e=>{var t;return[Ut(e[0],0,255),Ut(e[1],0,255),Ut(e[2],0,255),Ut(null!==(t=e[3])&&void 0!==t?t:1,0,1)]}};function mr(e,t){return"object"==typeof e&&!o(e)&&t in e&&"number"==typeof e[t]}class _r{constructor(e,t){this.mode_=t,this.comps_=gr[t](e)}static black(){return new _r([0,0,0],"rgb")}static fromObject(e){const t="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new _r(t,"rgb")}static toRgbaObject(e){return e.toRgbaObject()}static isRgbColorObject(e){return mr(e,"r")&&mr(e,"g")&&mr(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&mr(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode_!==t.mode_)return!1;const r=e.comps_,i=t.comps_;for(let n=0;n<r.length;n++)if(r[n]!==i[n])return!1;return!0}get mode(){return this.mode_}getComponents(e){return dr((t=hr(this.comps_),r=this.mode_,i=e||this.mode_,fr[r][i](...t)),this.comps_[3]);var t,r,i}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const vr=f("colp");class xr{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(vr());const r=e.createElement("div");r.classList.add(vr("hsv"));const i=e.createElement("div");i.classList.add(vr("sv")),this.svPaletteView_=t.svPaletteView,i.appendChild(this.svPaletteView_.element),r.appendChild(i);const n=e.createElement("div");n.classList.add(vr("h")),this.hPaletteView_=t.hPaletteView,n.appendChild(this.hPaletteView_.element),r.appendChild(n),this.element.appendChild(r);const s=e.createElement("div");if(s.classList.add(vr("rgb")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const r=e.createElement("div");r.classList.add(vr("a"));const i=e.createElement("div");i.classList.add(vr("ap")),i.appendChild(this.alphaViews_.palette.element),r.appendChild(i);const n=e.createElement("div");n.classList.add(vr("at")),n.appendChild(this.alphaViews_.text.element),r.appendChild(n),this.element.appendChild(r)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(e=>e.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Ar(e){const t=I;return k(e,{alpha:t.optional.boolean,expanded:t.optional.boolean,picker:t.optional.custom(Jt)})}function br(e){return e?.1:1}function yr(e,t){const r=e.match(/^(.+)%$/);return r?Math.min(.01*parseFloat(r[1])*t,t):Math.min(parseFloat(e),t)}const wr={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function Er(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const r=parseFloat(t[1]),i=t[2];return wr[i](r)}const Sr={"func.rgb":e=>{const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[yr(t[1],255),yr(t[2],255),yr(t[3],255)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?null:new _r(r,"rgb")},"func.rgba":e=>{const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[yr(t[1],255),yr(t[2],255),yr(t[3],255),yr(t[4],1)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?null:new _r(r,"rgb")},"func.hsl":e=>{const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[Er(t[1]),yr(t[2],100),yr(t[3],100)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?null:new _r(r,"hsl")},"func.hsla":e=>{const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const r=[Er(t[1]),yr(t[2],100),yr(t[3],100),yr(t[4],1)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?null:new _r(r,"hsl")},"hex.rgb":e=>{const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new _r([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)],"rgb");const r=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return r?new _r([parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)],"rgb"):null},"hex.rgba":e=>{const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new _r([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Ot(parseInt(t[4]+t[4],16),0,255,0,1)],"rgb");const r=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return r?new _r([parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16),Ot(parseInt(r[4],16),0,255,0,1)],"rgb"):null}};function Cr(e){return Object.keys(Sr).reduce((t,r)=>t||((0,Sr[r])(e)?r:null),null)}const Mr=e=>{const t=Cr(e);return t?Sr[t](e):null};function Tr(e){return"func.hsla"===e||"func.rgba"===e||"hex.rgba"===e}function Ir(e){const t=Ut(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function kr(e,t="#"){return`${t}${hr(e.getComponents("rgb")).map(Ir).join("")}`}function Dr(e,t="#"){const r=e.getComponents("rgb");return`${t}${[r[0],r[1],r[2],255*r[3]].map(Ir).join("")}`}function Pr(e){const t=bt(0);return`rgb(${hr(e.getComponents("rgb")).map(e=>t(e)).join(", ")})`}function Br(e){const t=bt(2),r=bt(0);return`rgba(${e.getComponents("rgb").map((e,i)=>(3===i?t:r)(e)).join(", ")})`}const Rr={"func.hsl":function(e){const t=[bt(0),wt,wt];return`hsl(${hr(e.getComponents("hsl")).map((e,r)=>t[r](e)).join(", ")})`},"func.hsla":function(e){const t=[bt(0),wt,wt,bt(2)];return`hsla(${e.getComponents("hsl").map((e,r)=>t[r](e)).join(", ")})`},"func.rgb":Pr,"func.rgba":Br,"hex.rgb":kr,"hex.rgba":Dr};function Lr(e){return Rr[e]}const Or=f("apl");class Fr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Or()),t.viewProps.bindTabIndex(this.element);const r=e.createElement("div");r.classList.add(Or("b")),this.element.appendChild(r);const i=e.createElement("div");i.classList.add(Or("c")),r.appendChild(i),this.colorElem_=i;const n=e.createElement("div");n.classList.add(Or("m")),this.element.appendChild(n),this.markerElem_=n;const s=e.createElement("div");s.classList.add(Or("p")),this.markerElem_.appendChild(s),this.previewElem_=s,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),r=new _r([t[0],t[1],t[2],0],"rgb"),i=new _r([t[0],t[1],t[2],255],"rgb"),n=["to right",Br(r),Br(i)];this.colorElem_.style.background=`linear-gradient(${n.join(",")})`,this.previewElem_.style.backgroundColor=Br(e);const s=Ot(t[3],0,1,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class Ur{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Fr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Lt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=e.point.x/e.bounds.width,i=this.value.rawValue,[n,s,o]=i.getComponents("hsv");this.value.setRawValue(new _r([n,s,o,r],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=kt(br(!0),Pt(e));if(0===t)return;const r=this.value.rawValue,[i,n,s,o]=r.getComponents("hsv");this.value.setRawValue(new _r([i,n,s,o+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==kt(br(!0),Pt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Nr=f("coltxt");class jr{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Nr());const r=e.createElement("div");r.classList.add(Nr("m")),this.modeElem_=function(e){const t=e.createElement("select");return t.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((t,r)=>{const i=e.createElement("option");return i.textContent=r.text,i.value=r.value,t.appendChild(i),t},e.createDocumentFragment())),t}(e),this.modeElem_.classList.add(Nr("ms")),r.appendChild(this.modeSelectElement);const i=e.createElement("div");i.classList.add(Nr("mm")),i.appendChild(U(e,"dropdown")),r.appendChild(i),this.element.appendChild(r);const n=e.createElement("div");n.classList.add(Nr("w")),this.element.appendChild(n),this.textsElem_=n,this.textViews_=t.textViews,this.applyTextViews_(),m(t.colorMode,e=>{this.modeElem_.value=e})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){G(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach(t=>{const r=e.createElement("div");r.classList.add(Nr("c")),r.appendChild(t.element),this.textsElem_.appendChild(r)})}}const Gr=bt(0),zr={rgb:()=>new Ve({min:0,max:255}),hsl:e=>new Ve(0===e?{min:0,max:360}:{min:0,max:100}),hsv:e=>new Ve(0===e?{min:0,max:360}:{min:0,max:100})};function Vr(e,t,r){return new zt(e,{arrayPosition:0===r?"fst":2===r?"lst":"mid",baseStep:br(!1),parser:t.parser,props:C.fromObject({draggingScale:1,formatter:Gr}),value:S(0,{constraint:zr[t.colorMode](r)}),viewProps:t.viewProps})}class Qr{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=S(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new jr(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},r=[Vr(e,t,0),Vr(e,t,1),Vr(e,t,2)];return r.forEach((e,t)=>{It({primary:this.value,secondary:e.value,forward:e=>e.rawValue.getComponents(this.colorMode.rawValue)[t],backward:(e,r)=>{const i=this.colorMode.rawValue,n=e.rawValue.getComponents(i);return n[t]=r.rawValue,new _r(dr(hr(n),n[3]),i)}})}),r}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Hr=f("hpl");class Wr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Hr()),t.viewProps.bindTabIndex(this.element);const r=e.createElement("div");r.classList.add(Hr("c")),this.element.appendChild(r);const i=e.createElement("div");i.classList.add(Hr("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=Pr(new _r([t,100,100],"hsv"));const r=Ot(t,0,360,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class qr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Wr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Lt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=Ot(Ut(e.point.x,0,e.bounds.width),0,e.bounds.width,0,359),i=this.value.rawValue,[,n,s,o]=i.getComponents("hsv");this.value.setRawValue(new _r([r,n,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=kt(br(!1),Pt(e));if(0===t)return;const r=this.value.rawValue,[i,n,s,o]=r.getComponents("hsv");this.value.setRawValue(new _r([i+t,n,s,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==kt(br(!1),Pt(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Xr=f("svp");class Yr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Xr()),t.viewProps.bindTabIndex(this.element);const r=e.createElement("canvas");r.height=64,r.width=64,r.classList.add(Xr("c")),this.element.appendChild(r),this.canvasElement=r;const i=e.createElement("div");i.classList.add(Xr("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=function(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d"):null}(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),r=this.canvasElement.width,i=this.canvasElement.height,n=e.getImageData(0,0,r,i),s=n.data;for(let l=0;l<i;l++)for(let e=0;e<r;e++){const n=Ot(e,0,r,0,100),o=Ot(l,0,i,100,0),a=pr(t[0],n,o),c=4*(l*r+e);s[c]=a[0],s[c+1]=a[1],s[c+2]=a[2],s[c+3]=255}e.putImageData(n,0,0);const o=Ot(t[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=Ot(t[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Kr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Yr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Lt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=Ot(e.point.x,0,e.bounds.width,0,100),i=Ot(e.point.y,0,e.bounds.height,100,0),[n,,,s]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new _r([n,r,i,s],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Bt(e.key)&&e.preventDefault();const[t,r,i,n]=this.value.rawValue.getComponents("hsv"),s=br(!1),o=kt(s,Pt(e)),a=kt(s,Dt(e));0===o&&0===a||this.value.setRawValue(new _r([t,r+o,i+a,n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=br(!1),r=kt(t,Pt(e)),i=kt(t,Dt(e));0===r&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Jr{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new qr(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Kr(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new Ur(e,{value:this.value,viewProps:this.viewProps}),text:new zt(e,{parser:vt,baseStep:.1,props:C.fromObject({draggingScale:.01,formatter:bt(2)}),value:S(0,{constraint:new Ve({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&It({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.rawValue.getComponents()[3],backward:(e,t)=>{const r=e.rawValue.getComponents();return r[3]=t.rawValue,new _r(r,e.rawValue.mode)}}),this.textC_=new Qr(e,{parser:vt,value:this.value,viewProps:this.viewProps}),this.view=new xr(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Zr=f("colsw");class $r{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Zr()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("div");r.classList.add(Zr("sw")),this.element.appendChild(r),this.swatchElem_=r;const i=e.createElement("button");i.classList.add(Zr("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Dr(e)}onValueChange_(){this.update_()}}class ei{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new $r(e,{value:this.value,viewProps:this.viewProps})}}class ti{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Y.create(t.expanded),this.swatchC_=new ei(e,{value:this.value,viewProps:this.viewProps});const r=this.swatchC_.view.buttonElement;r.addEventListener("blur",this.onButtonBlur_),r.addEventListener("click",this.onButtonClick_),this.textC_=new $e(e,{parser:t.parser,props:C.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ur(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new Ke(e,{viewProps:this.viewProps}):null;const i=new Jr(e,{supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),It({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),J(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,r=e.relatedTarget;r&&t.contains(r)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,r=z(e);r&&t.contains(r)||r&&r===this.swatchC_.view.buttonElement&&!O(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function ri(e){return hr(e.getComponents("rgb")).reduce((e,t)=>e<<8|255&Math.floor(t),0)}function ii(e){return e.getComponents("rgb").reduce((e,t,r)=>e<<8|255&Math.floor(3===r?255*t:t),0)>>>0}function ni(e,t){const r=t.toRgbaObject();e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b),e.writeProperty("a",r.a)}function si(e,t){const r=t.toRgbaObject();e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b)}function oi(e){return"alpha"in e&&!0===e.alpha}function ai(e){return e?e=>Dr(e,"0x"):e=>kr(e,"0x")}const li={id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!("view"in t))return null;if("color"!==t.view)return null;const r=Ar(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>oi(e.params)?function(e){return"number"!=typeof e?_r.black():new _r([(t=e)>>24&255,t>>16&255,t>>8&255,Ot(255&t,0,255,0,1)],"rgb");var t}:function(e){return"number"!=typeof e?_r.black():new _r([(t=e)>>16&255,t>>8&255,255&t],"rgb");var t},equals:_r.equals,writer:e=>(function(e){const t=e?ii:ri;return(e,r)=>{Yt(e,t(r))}})(oi(e.params))},controller:e=>{const t=oi(e.params),r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0;return new ti(e.document,{expanded:null!=r&&r,formatter:ai(t),parser:Mr,pickerLayout:null!=i?i:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}},ci={id:"input-color-object",type:"input",accept:(e,t)=>{if(!_r.isColorObject(e))return null;const r=Ar(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>(function(e){return _r.isColorObject(e)?_r.fromObject(e):_r.black()}),equals:_r.equals,writer:e=>{return t=e.initialValue,_r.isRgbaColorObject(t)?ni:si;var t}},controller:e=>{const t=_r.isRgbaColorObject(e.initialValue),r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0,n=t?Dr:kr;return new ti(e.document,{expanded:null!=r&&r,formatter:n,parser:Mr,pickerLayout:null!=i?i:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}},ui={id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("view"in t&&"text"===t.view)return null;if(!Cr(e))return null;const r=Ar(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>(function(e){if("string"==typeof e){const t=Mr(e);if(t)return t}return _r.black()}),equals:_r.equals,writer:e=>{const t=Cr(e.initialValue);if(!t)throw c.shouldNeverHappen();return function(e){const t=Lr(e);return(e,r)=>{Yt(e,t(r))}}(t)}},controller:e=>{const t=Cr(e.initialValue);if(!t)throw c.shouldNeverHappen();const r=Lr(t),i="expanded"in e.params?e.params.expanded:void 0,n="picker"in e.params?e.params.picker:void 0;return new ti(e.document,{expanded:null!=i&&i,formatter:r,parser:Mr,pickerLayout:null!=n?n:"popup",supportsAlpha:Tr(t),value:e.value,viewProps:e.viewProps})}};class pi{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((e,t)=>{var r,i;return null!==(i=null===(r=this.components[t])||void 0===r?void 0:r.constrain(e))&&void 0!==i?i:e});return this.asm_.fromComponents(t)}}const hi=f("pndtxt");class di{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(hi()),this.textViews.forEach(t=>{const r=e.createElement("div");r.classList.add(hi("a")),r.appendChild(t.element),this.element.appendChild(r)})}}class fi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((r,i)=>(function(e,t,r){return new zt(e,{arrayPosition:0===r?"fst":r===t.axes.length-1?"lst":"mid",baseStep:t.axes[r].baseStep,parser:t.parser,props:t.axes[r].textProps,value:S(0,{constraint:t.axes[r].constraint}),viewProps:t.viewProps})})(e,t,i)),this.acs_.forEach((e,r)=>{It({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e.rawValue)[r],backward:(e,i)=>{const n=t.assembly.toComponents(e.rawValue);return n[r]=i.rawValue,t.assembly.fromComponents(n)}})}),this.view=new di(e,{textViews:this.acs_.map(e=>e.view)})}}const gi={id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const r=I,i=k(t,{format:r.optional.function,max:r.optional.number,min:r.optional.number,options:r.optional.custom(Kt),step:r.optional.number});return i?{initialValue:e,params:i}:null},binding:{reader:e=>xt,constraint:e=>(function(e){const t=[],r=function(e){return"step"in e&&!o(e.step)?new Qe(e.step):null}(e);r&&t.push(r);const i=function(e){return"max"in e&&!o(e.max)||"min"in e&&!o(e.min)?new Ve({max:e.max,min:e.min}):null}(e);i&&t.push(i);const n=er(e.options);return n&&t.push(n),new je(t)})(e.params),writer:e=>Yt},controller:e=>{var t,r;const i=e.value,n=e.constraint;if(n&&Ge(n,ze))return new qe(e.document,{props:C.fromObject({options:null!==(t=tr(n))&&void 0!==t?t:[]}),value:i,viewProps:e.viewProps});const s=null!==(r="format"in e.params?e.params.format:void 0)&&void 0!==r?r:bt(rr(n,i.rawValue));if(n&&Ge(n,Ve)){const[t,r]=function(e){const[t,r]=function(e){const t=e?Ge(e,Ve):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}(e);return[null!=t?t:0,null!=r?r:100]}(n);return new Xt(e.document,{baseStep:ir(n),parser:vt,sliderProps:C.fromObject({maxValue:r,minValue:t}),textProps:C.fromObject({draggingScale:nr(n,i.rawValue),formatter:s}),value:i,viewProps:e.viewProps})}return new zt(e.document,{baseStep:ir(n),parser:vt,props:C.fromObject({draggingScale:nr(n,i.rawValue),formatter:s}),value:i,viewProps:e.viewProps})}};class mi{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(o(e))return!1;const t=e.x,r=e.y;return"number"==typeof t&&"number"==typeof r}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const _i={toComponents:e=>e.getComponents(),fromComponents:e=>new mi(...e)},vi=f("p2d");class xi{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vi()),t.viewProps.bindClassModifiers(this.element),m(t.expanded,v(this.element,vi(void 0,"expanded")));const r=e.createElement("div");r.classList.add(vi("h")),this.element.appendChild(r);const i=e.createElement("button");i.classList.add(vi("b")),i.appendChild(U(e,"p2dpad")),t.viewProps.bindDisabled(i),r.appendChild(i),this.buttonElement=i;const n=e.createElement("div");if(n.classList.add(vi("t")),r.appendChild(n),this.textElement=n,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(vi("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const Ai=f("p2dp");class bi{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(Ai()),"popup"===t.layout&&this.element.classList.add(Ai(void 0,"p"));const r=e.createElement("div");r.classList.add(Ai("p")),t.viewProps.bindTabIndex(r),this.element.appendChild(r),this.padElement=r;const i=e.createElementNS(R,"svg");i.classList.add(Ai("g")),this.padElement.appendChild(i),this.svgElem_=i;const n=e.createElementNS(R,"line");n.classList.add(Ai("ax")),n.setAttributeNS(null,"x1","0"),n.setAttributeNS(null,"y1","50%"),n.setAttributeNS(null,"x2","100%"),n.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(n);const s=e.createElementNS(R,"line");s.classList.add(Ai("ax")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","0"),s.setAttributeNS(null,"x2","50%"),s.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(s);const o=e.createElementNS(R,"line");o.classList.add(Ai("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=e.createElement("div");a.classList.add(Ai("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),r=this.maxValue_,i=Ot(e,-r,+r,0,100),n=Ot(t,-r,+r,0,100),s=this.invertsY_?100-n:n;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${s}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${s}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function yi(e,t,r){return[kt(t[0],Pt(e)),kt(t[1],Dt(e))*(r?1:-1)]}class wi{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new bi(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Lt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const r=this.maxValue_,i=Ot(e.point.x,0,e.bounds.width,-r,+r),n=Ot(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-r,+r);this.value.setRawValue(new mi(i,n),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Bt(e.key)&&e.preventDefault();const[t,r]=yi(e,this.baseSteps_,this.invertsY_);0===t&&0===r||this.value.setRawValue(new mi(this.value.rawValue.x+t,this.value.rawValue.y+r),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,r]=yi(e,this.baseSteps_,this.invertsY_);0===t&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ei{constructor(e,t){var r,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Y.create(t.expanded),this.popC_="popup"===t.pickerLayout?new Ke(e,{viewProps:this.viewProps}):null;const n=new wi(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.textC_=new fi(e,{assembly:_i,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new xi(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),It({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),J(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,r=e.relatedTarget;r&&t.contains(r)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,r=z(e);r&&t.contains(r)||r&&r===this.view.buttonElement&&!O(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}function Si(e){if(!e)return;const t=[];return o(e.step)||t.push(new Qe(e.step)),o(e.max)&&o(e.min)||t.push(new Ve({max:e.max,min:e.min})),new je(t)}function Ci(e,t){const r=e&&Ge(e,Ve);if(r)return Math.max(Math.abs(r.minValue||0),Math.abs(r.maxValue||0));const i=ir(e);return Math.max(10*Math.abs(i),10*Math.abs(t))}function Mi(e,t){const r=t instanceof pi?t.components[0]:void 0,i=t instanceof pi?t.components[1]:void 0,n=Ci(r,e.x),s=Ci(i,e.y);return Math.max(n,s)}function Ti(e,t){return{baseStep:ir(t),constraint:t,textProps:C.fromObject({draggingScale:nr(t,e),formatter:bt(rr(t,e))})}}function Ii(e){if(!("y"in e))return!1;const t=e.y;return!!t&&"inverted"in t&&!!t.inverted}const ki={id:"input-point2d",type:"input",accept:(e,t)=>{if(!mi.isObject(e))return null;const r=I,i=k(t,{expanded:r.optional.boolean,picker:r.optional.custom(Jt),x:r.optional.custom(Zt),y:r.optional.object({inverted:r.optional.boolean,max:r.optional.number,min:r.optional.number,step:r.optional.number})});return i?{initialValue:e,params:i}:null},binding:{reader:e=>(function(e){return mi.isObject(e)?new mi(e.x,e.y):new mi}),constraint:e=>{return t=e.params,new pi({assembly:_i,components:[Si("x"in t?t.x:void 0),Si("y"in t?t.y:void 0)]});var t},equals:mi.equals,writer:e=>(function(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)})},controller:e=>{const t=e.document,r=e.value,i=e.constraint;if(!(i instanceof pi))throw c.shouldNeverHappen();const n="expanded"in e.params?e.params.expanded:void 0,s="picker"in e.params?e.params.picker:void 0;return new Ei(t,{axes:[Ti(r.rawValue.x,i.components[0]),Ti(r.rawValue.y,i.components[1])],expanded:null!=n&&n,invertsY:Ii(e.params),maxValue:Mi(r.rawValue,i),parser:vt,pickerLayout:null!=s?s:"popup",value:r,viewProps:e.viewProps})}};class Di{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(o(e))return!1;const t=e.x,r=e.y,i=e.z;return"number"==typeof t&&"number"==typeof r&&"number"==typeof i}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Pi={toComponents:e=>e.getComponents(),fromComponents:e=>new Di(...e)};function Bi(e){if(!e)return;const t=[];return o(e.step)||t.push(new Qe(e.step)),o(e.max)&&o(e.min)||t.push(new Ve({max:e.max,min:e.min})),new je(t)}function Ri(e,t){return{baseStep:ir(t),constraint:t,textProps:C.fromObject({draggingScale:nr(t,e),formatter:bt(rr(t,e))})}}const Li={id:"input-point3d",type:"input",accept:(e,t)=>{if(!Di.isObject(e))return null;const r=I,i=k(t,{x:r.optional.custom(Zt),y:r.optional.custom(Zt),z:r.optional.custom(Zt)});return i?{initialValue:e,params:i}:null},binding:{reader:e=>(function(e){return Di.isObject(e)?new Di(e.x,e.y,e.z):new Di}),constraint:e=>{return t=e.params,new pi({assembly:Pi,components:[Bi("x"in t?t.x:void 0),Bi("y"in t?t.y:void 0),Bi("z"in t?t.z:void 0)]});var t},equals:Di.equals,writer:e=>(function(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)})},controller:e=>{const t=e.value,r=e.constraint;if(!(r instanceof pi))throw c.shouldNeverHappen();return new fi(e.document,{assembly:Pi,axes:[Ri(t.rawValue.x,r.components[0]),Ri(t.rawValue.y,r.components[1]),Ri(t.rawValue.z,r.components[2])],parser:vt,value:t,viewProps:e.viewProps})}};class Oi{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.z=r,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(o(e))return!1;const t=e.x,r=e.y,i=e.z,n=e.w;return"number"==typeof t&&"number"==typeof r&&"number"==typeof i&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Fi={toComponents:e=>e.getComponents(),fromComponents:e=>new Oi(...e)};function Ui(e){if(!e)return;const t=[];return o(e.step)||t.push(new Qe(e.step)),o(e.max)&&o(e.min)||t.push(new Ve({max:e.max,min:e.min})),new je(t)}const Ni={id:"input-point4d",type:"input",accept:(e,t)=>{if(!Oi.isObject(e))return null;const r=I,i=k(t,{x:r.optional.custom(Zt),y:r.optional.custom(Zt),z:r.optional.custom(Zt),w:r.optional.custom(Zt)});return i?{initialValue:e,params:i}:null},binding:{reader:e=>(function(e){return Oi.isObject(e)?new Oi(e.x,e.y,e.z,e.w):new Oi}),constraint:e=>{return t=e.params,new pi({assembly:Fi,components:[Ui("x"in t?t.x:void 0),Ui("y"in t?t.y:void 0),Ui("z"in t?t.z:void 0),Ui("w"in t?t.w:void 0)]});var t},equals:Oi.equals,writer:e=>(function(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)})},controller:e=>{const t=e.value,r=e.constraint;if(!(r instanceof pi))throw c.shouldNeverHappen();return new fi(e.document,{assembly:Fi,axes:t.rawValue.getComponents().map((e,t)=>{return i=e,{baseStep:ir(n=r.components[t]),constraint:n,textProps:C.fromObject({draggingScale:nr(n,i),formatter:bt(rr(n,i))})};var i,n}),parser:vt,value:t,viewProps:e.viewProps})}},ji={id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const r=k(t,{options:I.optional.custom(Kt)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Et,constraint:e=>(function(e){const t=[],r=er(e.options);return r&&t.push(r),new je(t)})(e.params),writer:e=>Yt},controller:e=>{var t;const r=e.document,i=e.value,n=e.constraint;return n&&Ge(n,ze)?new qe(r,{props:C.fromObject({options:null!==(t=tr(n))&&void 0!==t?t:[]}),value:i,viewProps:e.viewProps}):new $e(r,{parser:e=>e,props:C.fromObject({formatter:St}),value:i,viewProps:e.viewProps})}},Gi={defaultInterval:200,defaultLineCount:3},zi=f("mll");class Vi{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(zi()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("textarea");r.classList.add(zi("i")),r.style.height=`calc(var(--bld-us) * ${t.lineCount})`,r.readOnly=!0,t.viewProps.bindDisabled(r),this.element.appendChild(r),this.textareaElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,r=[];this.value.rawValue.forEach(e=>{void 0!==e&&r.push(this.formatter_(e))}),e.textContent=r.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class Qi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Vi(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const Hi=f("sgl");class Wi{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Hi()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("input");r.classList.add(Hi("i")),r.readOnly=!0,r.type="text",t.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class qi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Wi(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const Xi={id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const r=k(t,{lineCount:I.optional.number});return r?{initialValue:e,params:r}:null},binding:{reader:e=>et},controller:e=>{var t;return 1===e.value.rawValue.length?new qi(e.document,{formatter:tt,value:e.value,viewProps:e.viewProps}):new Qi(e.document,{formatter:tt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Gi.defaultLineCount,value:e.value,viewProps:e.viewProps})}};class Yi{constructor(){this.emitter=new h,this.index_=-1}get index(){return this.index_}set index(e){this.index_!==e&&(this.index_=e,this.emitter.emit("change",{index:e,sender:this}))}}const Ki=f("grl");class Ji{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ki()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.minValue_=t.minValue,this.maxValue_=t.maxValue,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const r=e.createElementNS(R,"svg");r.classList.add(Ki("g")),r.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(r),this.svgElem_=r;const i=e.createElementNS(R,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const n=e.createElement("div");n.classList.add(Ki("t"),f("tt")()),this.element.appendChild(n),this.tooltipElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,r=this.minValue_,i=this.maxValue_,n=[];this.value.rawValue.forEach((s,o)=>{if(void 0===s)return;const a=Ot(o,0,t,0,e.width),l=Ot(s,r,i,e.height,0);n.push([a,l].join(","))}),this.lineElem_.setAttributeNS(null,"points",n.join(" "));const s=this.tooltipElem_,o=this.value.rawValue[this.cursor_.index];if(void 0===o)return void s.classList.remove(Ki("t","a"));const a=Ot(this.cursor_.index,0,t,0,e.width),l=Ot(o,r,i,e.height,0);s.style.left=`${a}px`,s.style.top=`${l}px`,s.textContent=`${this.formatter_(o)}`,s.classList.contains(Ki("t","a"))||(s.classList.add(Ki("t","a"),Ki("t","in")),L(s),s.classList.remove(Ki("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Zi{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.cursor_=new Yi,this.view=new Ji(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,maxValue:t.maxValue,minValue:t.minValue,value:this.value,viewProps:this.viewProps}),O(e)){const e=new Lt(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(Ot(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.index=Math.floor(Ot(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function $i(e){return"format"in e&&!o(e.format)?e.format:bt(2)}function en(e){return"view"in e&&"graph"===e.view}const tn={id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const r=I,i=k(t,{format:r.optional.function,lineCount:r.optional.number,max:r.optional.number,min:r.optional.number,view:r.optional.string});return i?{initialValue:e,params:i}:null},binding:{defaultBufferSize:e=>en(e)?64:1,reader:e=>xt},controller:e=>en(e.params)?function(e){var t,r,i;return new Zi(e.document,{formatter:$i(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Gi.defaultLineCount,maxValue:null!==(r="max"in e.params?e.params.max:null)&&void 0!==r?r:100,minValue:null!==(i="min"in e.params?e.params.min:null)&&void 0!==i?i:0,value:e.value,viewProps:e.viewProps})}(e):function(e){var t;return 1===e.value.rawValue.length?new qi(e.document,{formatter:$i(e.params),value:e.value,viewProps:e.viewProps}):new Qi(e.document,{formatter:$i(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Gi.defaultLineCount,value:e.value,viewProps:e.viewProps})}(e)},rn={id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const r=I,i=k(t,{lineCount:r.optional.number,multiline:r.optional.boolean});return i?{initialValue:e,params:i}:null},binding:{reader:e=>Et},controller:e=>{var t;const r=e.value;return r.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new Qi(e.document,{formatter:St,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:Gi.defaultLineCount,value:r,viewProps:e.viewProps}):new qi(e.document,{formatter:St,value:r,viewProps:e.viewProps})}};class nn{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new h,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}class sn{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new h,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(void 0===e)return;const t=this.value.rawValue,r=this.reader_(e);this.value.rawValue=function(e,t){const r=[...Tt(e),t];return r.length>e.length?r.splice(0,r.length-e.length):Ct(r,e.length),r}(t,r),this.emitter.emit("update",{rawValue:r,sender:this})}onTick_(e){this.read()}}function on(e,t){return 0===t?new Ue:new Ne(e,null!=t?t:Gi.defaultInterval)}class an{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,r){if(o(t.read()))throw new c({context:{key:t.key},type:"nomatchingcontroller"});const i=this.pluginsMap_.inputs.reduce((i,n)=>i||function(e,t){const r=e.accept(t.target.read(),t.params);if(o(r))return null;const i=I,n={target:t.target,initialValue:r.initialValue,params:r.params},s=e.binding.reader(n),a=e.binding.constraint?e.binding.constraint(n):void 0,l=S(s(r.initialValue),{constraint:a,equals:e.binding.equals}),c=new nn({reader:s,target:t.target,value:l,writer:e.binding.writer(n)}),u=i.optional.boolean(t.params.disabled).value,p=i.optional.boolean(t.params.hidden).value,h=e.controller({constraint:a,document:t.document,initialValue:r.initialValue,params:r.params,value:c.value,viewProps:Me.create({disabled:u,hidden:p})}),d=i.optional.string(t.params.label).value;return new te(t.document,{binding:c,blade:X(),props:C.fromObject({label:d||t.target.key}),valueController:h})}(n,{document:e,target:t,params:r}),null);if(i)return i;throw new c({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,r){const i=this.pluginsMap_.monitors.reduce((i,n)=>i||function(e,t){var r,i,n;const s=I,a=e.accept(t.target.read(),t.params);if(o(a))return null;const l={target:t.target,initialValue:a.initialValue,params:a.params},c=e.binding.reader(l),u=null!==(i=null!==(r=s.optional.number(t.params.bufferSize).value)&&void 0!==r?r:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(a.params))&&void 0!==i?i:1,p=s.optional.number(t.params.interval).value,h=new sn({reader:c,target:t.target,ticker:on(t.document,p),value:Mt(u)}),d=s.optional.boolean(t.params.disabled).value,f=s.optional.boolean(t.params.hidden).value,g=e.controller({document:t.document,params:a.params,value:h.value,viewProps:Me.create({disabled:d,hidden:f})}),m=null!==(n=s.optional.string(t.params.label).value)&&void 0!==n?n:t.target.key;return new ie(t.document,{binding:h,blade:X(),props:C.fromObject({label:m}),valueController:g})}(n,{document:e,params:r,target:t}),null);if(i)return i;throw new c({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const r=this.pluginsMap_.blades.reduce((r,i)=>r||function(e,t){const r=e.accept(t.params);if(!r)return null;const i=I.optional.boolean(t.params.disabled).value,n=I.optional.boolean(t.params.hidden).value;return e.controller({blade:X(),document:t.document,params:Object.assign(Object.assign({},r.params),{disabled:i,hidden:n}),viewProps:Me.create({disabled:i,hidden:n})})}(i,{document:e,params:t}),null);if(!r)throw new c({type:"nomatchingview",context:{params:t}});return r}createBladeApi(e){if(e instanceof te)return new ee(e);if(e instanceof ie)return new re(e);if(e instanceof fe)return new ae(e,this);const t=this.pluginsMap_.blades.reduce((t,r)=>t||r.api({controller:e,pool:this}),null);if(!t)throw c.shouldNeverHappen();return t}}class ln extends t{constructor(e){super(e),this.emitter_=new h,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}}class cn extends t{constructor(e){super(e),this.emitter_=new h,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}}class un extends t{constructor(e){super(e),this.emitter_=new h,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const r=t.bind(this);return this.emitter_.on(e,e=>{r(e.event)}),this}}const pn={id:"list",type:"blade",accept(e){const t=I,r=k(e,{options:t.required.custom(Kt),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return r?{params:r}:null},controller(e){const t=new qe(e.document,{props:C.fromObject({options:$t(e.params.options)}),value:S(e.params.value),viewProps:e.viewProps});return new xe(e.document,{blade:e.blade,props:C.fromObject({label:e.params.label}),valueController:t})},api:e=>e.controller instanceof xe&&e.controller.valueController instanceof qe?new ln(e.controller):null};class hn extends le{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){(function(e,t){e.forEach(e=>{const r=t[e.presetKey];void 0!==r&&e.write(r)})})(this.controller_.rackController.rack.find(te).map(e=>e.binding.target),e),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(te).map(e=>e.binding.target).reduce((e,t)=>Object.assign(e,{[t.presetKey]:t.read()}),{})}refresh(){this.controller_.rackController.rack.find(te).forEach(e=>{e.binding.read()}),this.controller_.rackController.rack.find(ie).forEach(e=>{e.binding.read()})}}class dn extends _e{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const fn={id:"slider",type:"blade",accept(e){const t=I,r=k(e,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return r?{params:r}:null},controller(e){var t,r;const i=null!==(t=e.params.value)&&void 0!==t?t:0,n=new Xt(e.document,{baseStep:1,parser:vt,sliderProps:C.fromObject({maxValue:e.params.max,minValue:e.params.min}),textProps:C.fromObject({draggingScale:nr(void 0,i),formatter:null!==(r=e.params.format)&&void 0!==r?r:At}),value:S(i),viewProps:e.viewProps});return new xe(e.document,{blade:e.blade,props:C.fromObject({label:e.params.label}),valueController:n})},api:e=>e.controller instanceof xe&&e.controller.valueController instanceof Xt?new cn(e.controller):null},gn={id:"text",type:"blade",accept(e){const t=I,r=k(e,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return r?{params:r}:null},controller(e){var t;const r=new $e(e.document,{parser:e.params.parse,props:C.fromObject({formatter:null!==(t=e.params.format)&&void 0!==t?t:e=>String(e)}),value:S(e.params.value),viewProps:e.viewProps});return new xe(e.document,{blade:e.blade,props:C.fromObject({label:e.params.label}),valueController:r})},api:e=>e.controller instanceof xe&&e.controller.valueController instanceof $e?new un(e.controller):null};function mn(e,t,r){if(e.querySelector(`style[data-tp-style=${t}]`))return;const i=e.createElement("style");i.dataset.tpStyle=t,i.textContent=r,e.head.appendChild(i)}const _n=new class{constructor(e){const[t,r]=e.split("-"),i=t.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=r?r:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}("3.0.8");e.BladeApi=t,e.ButtonApi=p,e.FolderApi=le,e.InputBindingApi=ee,e.ListApi=ln,e.MonitorBindingApi=re,e.Pane=class extends hn{constructor(e){var t;const r=e||{},i=null!==(t=r.document)&&void 0!==t?t:new Function("return this")().document,n=function(){const e=new an;return[ki,Li,Ni,ji,gi,ui,ci,li,lr,Xi,rn,tn,W,ve,Ee,Fe].forEach(t=>{e.register(t)}),e}();super(new dn(i,{expanded:r.expanded,blade:X(),props:C.fromObject({title:r.title}),viewProps:Me.create()}),n),this.pool_=n,this.containerElem_=r.container||function(e){const t=e.createElement("div");return t.classList.add(f("dfw")()),e.body&&e.body.appendChild(t),t}(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw c.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw c.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(e=>{this.pool_.register(e),this.embedPluginStyle_(e)})}embedPluginStyle_(e){e.css&&mn(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){mn(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(e=>{this.embedPluginStyle_(e)}),this.registerPlugin({plugins:[fn,pn,Fe,gn]})}},e.SeparatorApi=Ae,e.SliderApi=cn,e.TabApi=Be,e.TabPageApi=Pe,e.TextApi=un,e.TpChangeEvent=i,e.VERSION=_n,Object.defineProperty(e,"__esModule",{value:!0})}(t)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(e){super(e),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(e,t){const r=await super.loadAsync(e,t);return r?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(r,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(e=!0,t=!1){return e&&super.preload(),t&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS="object"!=typeof WebAssembly||"js"===this.encoderConfig.type,librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),null===(_a=eval(jsContent+"\nDracoEncoderModule;"))||void 0===_a?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async e=>e.text()).then(e=>{const t=e.indexOf("/* worker */");if(t<1)throw new Error("unable to load decoder module");return e.substring(0,t-1)});return null===(_a=eval(jsContent+"\nDracoDecoderModule;"))||void 0===_a?void 0:_a()}}},87:function(){},263:function(){},988:function(e,t,r){r.d(t,{$TI:function(){return zh},$V:function(){return qh},$Vf:function(){return Vd},$YQ:function(){return il},A5E:function(){return Pd},AHu:function(){return Bd},AXT:function(){return Dc},Aip:function(){return Jd},B02:function(){return c},BFQ:function(){return He},BG$:function(){return ot},BKK:function(){return qd},BVF:function(){return N},BVQ:function(){return zc},BbS:function(){return bh},Bf4:function(){return oe},BtG:function(){return As},CJI:function(){return bn},CN8:function(){return Ld},CP7:function(){return al},CaW:function(){return Je},CdI:function(){return Z},Cne:function(){return $d},CtA:function(){return ze},CtF:function(){return vp},D1R:function(){return xe},D9w:function(){return je},DT1:function(){return zd},Djp:function(){return st},DqL:function(){return Cp},DvJ:function(){return ps},E2K:function(){return Ve},EB7:function(){return _c},EJi:function(){return Qu},EoG:function(){return J},F5T:function(){return wn},FDw:function(){return Ae},FE5:function(){return Ou},FIo:function(){return zu},FM8:function(){return kr},FT0:function(){return Ku},FUD:function(){return ht},FvO:function(){return td},GG6:function(){return ut},GQ:function(){return wd},GUF:function(){return jt},GVz:function(){return ri},GZb:function(){return Hd},Gih:function(){return pt},Gql:function(){return eh},H$k:function(){return Ru},HTd:function(){return de},HW6:function(){return Kd},HgB:function(){return cr},HkE:function(){return $a},Hmr:function(){return oh},Hw6:function(){return Yr},Hy8:function(){return L},Hyl:function(){return xc},IEO:function(){return Gl},IFH:function(){return St},IKL:function(){return Wu},ILR:function(){return qe},IOt:function(){return Ot},Ilk:function(){return Wr},Inb:function(){return Bt},Ir4:function(){return lr},JOQ:function(){return Ss},JQ4:function(){return Ce},JUT:function(){return ii},JWc:function(){return or},KI_:function(){return Nt},Kgo:function(){return qc},KhW:function(){return k},Kj0:function(){return cs},Kz5:function(){return Se},L5g:function(){return Zd},L5s:function(){return Zp},LBq:function(){return Xh},LSk:function(){return dr},LY2:function(){return ee},L_r:function(){return fr},Lcc:function(){return tf},LgE:function(){return Pt},LgZ:function(){return B},LsT:function(){return Ee},Ltg:function(){return $r},Lun:function(){return Xa},M5h:function(){return b},M6v:function(){return W},M8C:function(){return Ir},Mig:function(){return Wp},MyG:function(){return Yt},N$j:function(){return jl},N4l:function(){return A},NDo:function(){return Y},NMF:function(){return At},NYV:function(){return at},Ns1:function(){return q},NwF:function(){return fp},Ny0:function(){return Ac},O7d:function(){return Mu},OAl:function(){return $t},OM3:function(){return Fn},OTo:function(){return Pe},OdW:function(){return Ql},OoA:function(){return ue},Ox3:function(){return Hp},PA7:function(){return Ft},PMe:function(){return Up},Pa4:function(){return ai},PeU:function(){return o},Pnf:function(){return yt},PpQ:function(){return Xr},QM0:function(){return ar},QRU:function(){return nh},QZ1:function(){return sr},QmN:function(){return s},Qpg:function(){return ud},R2R:function(){return up},REq:function(){return Wd},RNb:function(){return Tn},ROQ:function(){return vc},RSm:function(){return qu},Rki:function(){return xd},RlZ:function(){return U},RsA:function(){return n},RvT:function(){return er},S2y:function(){return l},S3k:function(){return Mp},S9g:function(){return Yi},SJI:function(){return Ah},SPe:function(){return Kl},SUY:function(){return fh},Se2:function(){return j},Sm8:function(){return M},So8:function(){return lh},SvJ:function(){return ft},Syv:function(){return xt},T95:function(){return ye},TOt:function(){return Zc},TUj:function(){return Kh},TUv:function(){return Nl},T_1:function(){return kd},T_J:function(){return qt},T__:function(){return bc},T_f:function(){return qp},TlE:function(){return Mn},Tme:function(){return un},Tn7:function(){return Gu},TyD:function(){return pe},U7:function(){return Rc},UCm:function(){return Be},USm:function(){return Xi},UY4:function(){return lc},UZH:function(){return i},Uk6:function(){return Uu},UlW:function(){return Tt},Uol:function(){return Wc},V1s:function(){return ms},V4E:function(){return Yd},VLJ:function(){return pd},VYz:function(){return Ch},Vdb:function(){return O},Vj0:function(){return Rs},Vkp:function(){return Dr},VzW:function(){return Me},W2J:function(){return ir},WMw:function(){return x},WTc:function(){return In},WXh:function(){return Fu},Wbm:function(){return E},WdD:function(){return Ps},Wid:function(){return Vu},Wjw:function(){return Qd},Wl3:function(){return f},Wpd:function(){return F},Wqd:function(){return Nc},WwZ:function(){return Mt},Wzm:function(){return mc},XZw:function(){return ef},Xaj:function(){return y},Xcj:function(){return Uh},XvJ:function(){return Lu},Y8D:function(){return Le},YBo:function(){return Xu},YGz:function(){return $},YKA:function(){return _t},YLQ:function(){return he},YN5:function(){return Ud},YT8:function(){return Mc},Ywn:function(){return ni},Z6B:function(){return pr},ZAu:function(){return el},ZQ6:function(){return Lc},ZRs:function(){return Qt},ZZA:function(){return ip},Zp0:function(){return Jp},Zr5:function(){return G},ZzF:function(){return ui},Zzh:function(){return $h},_12:function(){return Ds},_3:function(){return jd},_AM:function(){return Xe},_C8:function(){return np},_Li:function(){return g},_MY:function(){return u},_YM:function(){return cp},_YX:function(){return sd},_am:function(){return xs},_fP:function(){return oi},_iA:function(){return p},_kC:function(){return Dp},_lf:function(){return wt},_sL:function(){return Et},a$l:function(){return On},aCh:function(){return Ut},aH4:function(){return fe},aLr:function(){return Ii},aNw:function(){return bp},aVm:function(){return Dn},ad5:function(){return Gt},anP:function(){return Ys},aq0:function(){return hd},av9:function(){return Ge},b5g:function(){return ll},bGH:function(){return w},b_z:function(){return Hc},bdR:function(){return v},blk:function(){return ac},bnF:function(){return $c},brP:function(){return Ue},bsb:function(){return gt},c8b:function(){return T},cBI:function(){return md},cBK:function(){return Tp},cJO:function(){return Iu},cLu:function(){return Te},cPb:function(){return _s},cRx:function(){return Oe},cU9:function(){return ap},ce8:function(){return Vt},cek:function(){return Vp},cum:function(){return rr},dSO:function(){return se},dUE:function(){return pp},dYG:function(){return sp},dZ3:function(){return te},dd2:function(){return ei},dj0:function(){return nr},dpR:function(){return kp},dwk:function(){return d},e62:function(){return Ln},eD:function(){return V},eMJ:function(){return Xt},eaV:function(){return Ke},ehD:function(){return m},ejS:function(){return oc},ekQ:function(){return et},epp:function(){return Nr},fHI:function(){return Qc},fO1:function(){return gc},fQA:function(){return yd},fQK:function(){return Za},fSK:function(){return R},fY$:function(){return ie},fto:function(){return Ze},g8_:function(){return ae},gH0:function(){return Gh},gSk:function(){return Ct},g_z:function(){return Bc},ghN:function(){return I},gi4:function(){return nt},gti:function(){return Fc},hEm:function(){return Ne},hH6:function(){return Ep},iAb:function(){return we},iDF:function(){return Eu},iKG:function(){return Gs},iLg:function(){return dp},iMs:function(){return Qh},iUV:function(){return Rh},iWC:function(){return D},iWj:function(){return Ts},i_9:function(){return ch},iiP:function(){return dt},irR:function(){return ke},j4z:function(){return tr},j87:function(){return Bn},jAl:function(){return mt},jFi:function(){return _},jZA:function(){return rt},jfJ:function(){return Ht},jwo:function(){return Jt},jyi:function(){return Il},jyz:function(){return gs},k0A:function(){return Ie},k74:function(){return P},kB5:function(){return fl},kFz:function(){return si},kaV:function(){return Yu},knz:function(){return Dt},kqm:function(){return Mh},ksN:function(){return Q},l0P:function(){return $e},l8J:function(){return ur},lCJ:function(){return Rn},lDi:function(){return Xp},lLk:function(){return xp},lRF:function(){return qa},lRj:function(){return ve},lb7:function(){return Hl},lfu:function(){return op},lk7:function(){return Yp},m7l:function(){return mp},mSO:function(){return Lt},mTL:function(){return ah},mXe:function(){return Oc},m_w:function(){return Gd},mzJ:function(){return Lh},nls:function(){return Jl},ntZ:function(){return h},nvb:function(){return Fd},o8S:function(){return Du},oAp:function(){return bs},oa8:function(){return Pu},oqc:function(){return Wt},p3g:function(){return ti},p7A:function(){return Rd},p7y:function(){return Gc},pBf:function(){return gr},pIN:function(){return bt},pKu:function(){return ct},pQR:function(){return ku},ptH:function(){return tt},qhX:function(){return X},qkB:function(){return Fe},qlB:function(){return Pn},qyh:function(){return _e},rAo:function(){return kn},rBU:function(){return Bs},rDY:function(){return fs},rOj:function(){return S},r_:function(){return C},rnI:function(){return kt},rpg:function(){return le},s4_:function(){return $p},sYA:function(){return Sp},tEQ:function(){return Ap},tGC:function(){return Td},tJx:function(){return Ed},tUh:function(){return lp},tf:function(){return Th},tm_:function(){return a},trn:function(){return Nd},u37:function(){return dh},u7G:function(){return Kp},u9r:function(){return Hn},uEv:function(){return vt},uL9:function(){return K},uWy:function(){return ce},uXU:function(){return Kt},ujx:function(){return Xd},v3W:function(){return We},v9Y:function(){return hr},vBJ:function(){return En},vCF:function(){return z},vCx:function(){return Ye},vZf:function(){return ge},vmT:function(){return Pp},vpT:function(){return hl},vxC:function(){return ne},w$m:function(){return H},wJv:function(){return De},wem:function(){return me},wk1:function(){return Re},woe:function(){return dc},wuA:function(){return Qe},x12:function(){return ic},x5V:function(){return zt},xEZ:function(){return Zr},xG9:function(){return od},xJs:function(){return lt},xWb:function(){return Nh},xeV:function(){return gl},xfE:function(){return re},xo$:function(){return Bu},xoR:function(){return Hu},xsS:function(){return pl},y$t:function(){return jc},y2t:function(){return it},y8_:function(){return Id},yC1:function(){return gp},yGw:function(){return Ui},ybr:function(){return ul},yj7:function(){return Pc},ylh:function(){return Vh},yo9:function(){return cl},yt0:function(){return Zt},ywz:function(){return be},yxD:function(){return Ip},z$h:function(){return It},z81:function(){return Rt},z8B:function(){return Bl},zHn:function(){return Fi},zbs:function(){return hp},zf8:function(){return Vc},zob:function(){return Od}});const i="144dev",n={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,u=0,p=1,h=2,d=3,f=0,g=1,m=2,_=0,v=1,x=2,A=3,b=4,y=5,w=100,E=101,S=102,C=103,M=104,T=200,I=201,k=202,D=203,P=204,B=205,R=206,L=207,O=208,F=209,U=210,N=0,j=1,G=2,z=3,V=4,Q=5,H=6,W=7,q=0,X=1,Y=2,K=0,J=1,Z=2,$=3,ee=4,te=5,re=300,ie=301,ne=302,se=303,oe=304,ae=306,le=1e3,ce=1001,ue=1002,pe=1003,he=1004,de=1004,fe=1005,ge=1005,me=1006,_e=1007,ve=1007,xe=1008,Ae=1008,be=1009,ye=1010,we=1011,Ee=1012,Se=1013,Ce=1014,Me=1015,Te=1016,Ie=1017,ke=1018,De=1020,Pe=1021,Be=1022,Re=1023,Le=1024,Oe=1025,Fe=1026,Ue=1027,Ne=1028,je=1029,Ge=1030,ze=1031,Ve=1033,Qe=33776,He=33777,We=33778,qe=33779,Xe=35840,Ye=35841,Ke=35842,Je=35843,Ze=36196,$e=37492,et=37496,tt=37808,rt=37809,it=37810,nt=37811,st=37812,ot=37813,at=37814,lt=37815,ct=37816,ut=37817,pt=37818,ht=37819,dt=37820,ft=37821,gt=36492,mt=2200,_t=2201,vt=2202,xt=2300,At=2301,bt=2302,yt=2400,wt=2401,Et=2402,St=2500,Ct=2501,Mt=0,Tt=1,It=2,kt=3e3,Dt=3001,Pt=3004,Bt=3005,Rt=3200,Lt=3201,Ot=0,Ft=1,Ut="",Nt="srgb",jt="srgb-linear",Gt=0,zt=7680,Vt=7681,Qt=7682,Ht=7683,Wt=34055,qt=34056,Xt=5386,Yt=512,Kt=513,Jt=514,Zt=515,$t=516,er=517,tr=518,rr=519,ir=35044,nr=35048,sr=35040,or=35045,ar=35049,lr=35041,cr=35046,ur=35050,pr=35042,hr="100",dr="300 es",fr=1035;class gr{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e);e.target=null}}}const mr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _r=1234567;const vr=Math.PI/180,xr=180/Math.PI;function Ar(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(mr[255&e]+mr[e>>8&255]+mr[e>>16&255]+mr[e>>24&255]+"-"+mr[255&t]+mr[t>>8&255]+"-"+mr[t>>16&15|64]+mr[t>>24&255]+"-"+mr[63&r|128]+mr[r>>8&255]+"-"+mr[r>>16&255]+mr[r>>24&255]+mr[255&i]+mr[i>>8&255]+mr[i>>16&255]+mr[i>>24&255]).toLowerCase()}function br(e,t,r){return Math.max(t,Math.min(r,e))}function yr(e,t){return(e%t+t)%t}function wr(e,t,r){return(1-r)*e+r*t}function Er(e){return 0==(e&e-1)&&0!==e}function Sr(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Cr(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Mr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Tr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var Ir=Object.freeze({__proto__:null,DEG2RAD:vr,RAD2DEG:xr,generateUUID:Ar,clamp:br,euclideanModulo:yr,mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},inverseLerp:function(e,t,r){return e!==t?(r-e)/(t-e):0},lerp:wr,damp:function(e,t,r,i){return wr(e,t,1-Math.exp(-r*i))},pingpong:function(e,t=1){return t-Math.abs(yr(e,2*t)-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(_r=e);let t=_r+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*vr},radToDeg:function(e){return e*xr},isPowerOfTwo:Er,ceilPowerOfTwo:Sr,floorPowerOfTwo:Cr,setQuaternionFromProperEuler:function(e,t,r,i,n){const s=Math.cos,o=Math.sin,a=s(r/2),l=o(r/2),c=s((t+i)/2),u=o((t+i)/2),p=s((t-i)/2),h=o((t-i)/2),d=s((i-t)/2),f=o((i-t)/2);switch(n){case"XYX":e.set(a*u,l*p,l*h,a*c);break;case"YZY":e.set(l*h,a*u,l*p,a*c);break;case"ZXZ":e.set(l*p,l*h,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*d,a*c);break;case"YXY":e.set(l*d,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*d,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}},normalize:Tr,denormalize:Mr});class kr{constructor(e=0,t=0){kr.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*r-s*i+e.x,this.y=n*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dr{constructor(){Dr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,r,i,n,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=n,c[5]=a,c[6]=r,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,n=this.elements,s=r[0],o=r[3],a=r[6],l=r[1],c=r[4],u=r[7],p=r[2],h=r[5],d=r[8],f=i[0],g=i[3],m=i[6],_=i[1],v=i[4],x=i[7],A=i[2],b=i[5],y=i[8];return n[0]=s*f+o*_+a*A,n[3]=s*g+o*v+a*b,n[6]=s*m+o*x+a*y,n[1]=l*f+c*_+u*A,n[4]=l*g+c*v+u*b,n[7]=l*m+c*x+u*y,n[2]=p*f+h*_+d*A,n[5]=p*g+h*v+d*b,n[8]=p*m+h*x+d*y,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-r*n*c+r*o*a+i*n*l-i*s*a}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=c*s-o*l,p=o*a-c*n,h=l*n-s*a,d=t*u+r*p+i*h;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return e[0]=u*f,e[1]=(i*l-c*r)*f,e[2]=(o*r-i*s)*f,e[3]=p*f,e[4]=(c*t-i*a)*f,e[5]=(i*n-o*t)*f,e[6]=h*f,e[7]=(r*a-l*t)*f,e[8]=(s*t-r*n)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,s,o){const a=Math.cos(n),l=Math.sin(n);return this.set(r*a,r*l,-r*(a*s+l*o)+s+e,-i*l,i*a,-i*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.elements,n=i[0],s=i[3],o=i[6],a=i[1],l=i[4],c=i[7];return i[0]=t*n+r*a,i[3]=t*s+r*l,i[6]=t*o+r*c,i[1]=-r*n+t*a,i[4]=-r*s+t*l,i[7]=-r*o+t*c,this}translate(e,t){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Pr(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}const Br={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Rr(e,t){return new Br[e](t)}function Lr(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Or(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Fr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Ur={[Nt]:{[jt]:Or},[jt]:{[Nt]:Fr}},Nr={legacyMode:!0,get workingColorSpace(){return jt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,r){if(this.legacyMode||t===r||!t||!r)return e;if(Ur[t]&&void 0!==Ur[t][r]){const i=Ur[t][r];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},jr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gr={r:0,g:0,b:0},zr={h:0,s:0,l:0},Vr={h:0,s:0,l:0};function Qr(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function Hr(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class Wr{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Nt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Nr.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=jt){return this.r=e,this.g=t,this.b=r,Nr.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=jt){if(e=yr(e,1),t=br(t,0,1),r=br(r,0,1),0===t)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=Qr(n,i,e+1/3),this.g=Qr(n,i,e),this.b=Qr(n,i,e-1/3)}return Nr.toWorkingColorSpace(this,i),this}setStyle(e,t=Nt){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Nr.toWorkingColorSpace(this,t),r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Nr.toWorkingColorSpace(this,t),r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(e[1])/360,n=parseFloat(e[2])/100,s=parseFloat(e[3])/100;return r(e[4]),this.setHSL(i,n,s,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],r=e.length;if(3===r)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Nr.toWorkingColorSpace(this,t),this;if(6===r)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Nr.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Nt){const r=jr[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Or(e.r),this.g=Or(e.g),this.b=Or(e.b),this}copyLinearToSRGB(e){return this.r=Fr(e.r),this.g=Fr(e.g),this.b=Fr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Nt){return Nr.fromWorkingColorSpace(Hr(this,Gr),e),br(255*Gr.r,0,255)<<16^br(255*Gr.g,0,255)<<8^br(255*Gr.b,0,255)<<0}getHexString(e=Nt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=jt){Nr.fromWorkingColorSpace(Hr(this,Gr),t);const r=Gr.r,i=Gr.g,n=Gr.b,s=Math.max(r,i,n),o=Math.min(r,i,n);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const e=s-o;switch(l=c<=.5?e/(s+o):e/(2-s-o),s){case r:a=(i-n)/e+(i<n?6:0);break;case i:a=(n-r)/e+2;break;case n:a=(r-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=jt){return Nr.fromWorkingColorSpace(Hr(this,Gr),t),e.r=Gr.r,e.g=Gr.g,e.b=Gr.b,e}getStyle(e=Nt){return Nr.fromWorkingColorSpace(Hr(this,Gr),e),e!==Nt?`color(${e} ${Gr.r} ${Gr.g} ${Gr.b})`:`rgb(${255*Gr.r|0},${255*Gr.g|0},${255*Gr.b|0})`}offsetHSL(e,t,r){return this.getHSL(zr),zr.h+=e,zr.s+=t,zr.l+=r,this.setHSL(zr.h,zr.s,zr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(zr),e.getHSL(Vr);const r=wr(zr.h,Vr.h,t),i=wr(zr.s,Vr.s,t),n=wr(zr.l,Vr.l,t);return this.setHSL(r,i,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let qr;Wr.NAMES=jr;class Xr{static getDataURL(e,t=!1){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{void 0===qr&&(qr=Lr("canvas")),qr.width=e.width,qr.height=e.height;const t=qr.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),r=qr}return!t&&(r.width>2048||r.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),r.toDataURL("image/jpeg",.6)):r.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Lr("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),n=i.data;for(let e=0;e<n.length;e++)n[e]=255*Or(n[e]/255);return r.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Or(t[e]/255)):t[e]=Or(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Yr{constructor(e=null){this.isSource=!0,this.uuid=Ar(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,r=i.length;t<r;t++)i[t].isDataTexture?e.push(Kr(i[t].image)):e.push(Kr(i[t]))}else e=Kr(i);r.url=e}return t||(e.images[this.uuid]=r),r}}function Kr(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return Xr.getDataURL(e);if(e.data){let t=[];try{t=Array.from(e.data)}catch(r){r.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(r),t=e.data}return{data:t,width:e.width,height:e.height,type:e.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let Jr=0;class Zr extends gr{constructor(e=Zr.DEFAULT_IMAGE,t=Zr.DEFAULT_MAPPING,r=ce,i=ce,n=me,s=xe,o=Re,a=be,l=1,c=kt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Jr++}),this.uuid=Ar(),this.name="",this.source=new Yr(e),this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new kr(0,0),this.repeat=new kr(1,1),this.center=new kr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==re)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case le:e.x=e.x-Math.floor(e.x);break;case ce:e.x=e.x<0?0:1;break;case ue:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case le:e.y=e.y-Math.floor(e.y);break;case ce:e.y=e.y<0?0:1;break;case ue:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Zr.DEFAULT_IMAGE=null,Zr.DEFAULT_MAPPING=re;class $r{constructor(e=0,t=0,r=0,i=1){$r.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*n,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*n,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*n,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,n;const s=.01,o=e.elements,a=o[0],l=o[4],c=o[8],u=o[1],p=o[5],h=o[9],d=o[2],f=o[6],g=o[10];if(Math.abs(l-u)<s&&Math.abs(c-d)<s&&Math.abs(h-f)<s){if(Math.abs(l+u)<.1&&Math.abs(c+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+p+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const e=(a+1)/2,o=(p+1)/2,m=(g+1)/2,_=(l+u)/4,v=(c+d)/4,x=(h+f)/4;return e>o&&e>m?e<s?(r=0,i=.707106781,n=.707106781):(i=_/(r=Math.sqrt(e)),n=v/r):o>m?o<s?(r=.707106781,i=0,n=.707106781):(r=_/(i=Math.sqrt(o)),n=x/i):m<s?(r=.707106781,i=.707106781,n=0):(r=v/(n=Math.sqrt(m)),i=x/n),this.set(r,i,n,t),this}let m=Math.sqrt((f-h)*(f-h)+(c-d)*(c-d)+(u-l)*(u-l));return Math.abs(m)<.001&&(m=1),this.x=(f-h)/m,this.y=(c-d)/m,this.z=(u-l)/m,this.w=Math.acos((a+p+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ei extends gr{constructor(e,t,r={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new $r(0,0,e,t),this.scissorTest=!1,this.viewport=new $r(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new Zr(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:me,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,this.samples=void 0!==r.samples?r.samples:0}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Yr(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ti extends Zr{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=pe,this.minFilter=pe,this.wrapR=ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ri extends ei{constructor(e,t,r){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new ti(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class ii extends Zr{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=pe,this.minFilter=pe,this.wrapR=ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ni extends ei{constructor(e,t,r){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new ii(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class si extends ei{constructor(e,t,r,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const n=this.texture;this.texture=[];for(let s=0;s<r;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,n=this.texture.length;i<n;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class oi{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,n,s,o){let a=r[i+0],l=r[i+1],c=r[i+2],u=r[i+3];const p=n[s+0],h=n[s+1],d=n[s+2],f=n[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=p,e[t+1]=h,e[t+2]=d,void(e[t+3]=f);if(u!==f||a!==p||l!==h||c!==d){let e=1-o;const t=a*p+l*h+c*d+u*f,r=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const n=Math.sqrt(i),s=Math.atan2(n,t*r);e=Math.sin(e*s)/n,o=Math.sin(o*s)/n}const n=o*r;if(a=a*e+p*n,l=l*e+h*n,c=c*e+d*n,u=u*e+f*n,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,r,i,n,s){const o=r[i],a=r[i+1],l=r[i+2],c=r[i+3],u=n[s],p=n[s+1],h=n[s+2],d=n[s+3];return e[t]=o*d+c*u+a*h-l*p,e[t+1]=a*d+c*p+l*u-o*h,e[t+2]=l*d+c*h+o*p-a*u,e[t+3]=c*d-o*u-a*p-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,i=e._y,n=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(r/2),c=o(i/2),u=o(n/2),p=a(r/2),h=a(i/2),d=a(n/2);switch(s){case"XYZ":this._x=p*c*u+l*h*d,this._y=l*h*u-p*c*d,this._z=l*c*d+p*h*u,this._w=l*c*u-p*h*d;break;case"YXZ":this._x=p*c*u+l*h*d,this._y=l*h*u-p*c*d,this._z=l*c*d-p*h*u,this._w=l*c*u+p*h*d;break;case"ZXY":this._x=p*c*u-l*h*d,this._y=l*h*u+p*c*d,this._z=l*c*d+p*h*u,this._w=l*c*u-p*h*d;break;case"ZYX":this._x=p*c*u-l*h*d,this._y=l*h*u+p*c*d,this._z=l*c*d-p*h*u,this._w=l*c*u+p*h*d;break;case"YZX":this._x=p*c*u+l*h*d,this._y=l*h*u+p*c*d,this._z=l*c*d-p*h*u,this._w=l*c*u-p*h*d;break;case"XZY":this._x=p*c*u-l*h*d,this._y=l*h*u-p*c*d,this._z=l*c*d+p*h*u,this._w=l*c*u+p*h*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],n=t[8],s=t[1],o=t[5],a=t[9],l=t[2],c=t[6],u=t[10],p=r+o+u;if(p>0){const e=.5/Math.sqrt(p+1);this._w=.25/e,this._x=(c-a)*e,this._y=(n-l)*e,this._z=(s-i)*e}else if(r>o&&r>u){const e=2*Math.sqrt(1+r-o-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(n+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-r-u);this._w=(n-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-r-o);this._w=(s-i)/e,this._x=(n+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(br(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,n=e._z,s=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=r*c+s*o+i*l-n*a,this._y=i*c+s*a+n*o-r*l,this._z=n*c+s*l+r*a-i*o,this._w=s*c-r*o-i*a-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,i=this._y,n=this._z,s=this._w;let o=s*e._w+r*e._x+i*e._y+n*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=r,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*r+t*this._x,this._y=e*i+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,p=Math.sin(t*c)/l;return this._w=s*u+this._w*p,this._x=r*u+this._x*p,this._y=i*u+this._y*p,this._z=n*u+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(n),r*Math.cos(n),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ai{constructor(e=0,t=0,r=0){ai.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(ci.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ci.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,n=e.elements,s=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*s,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*s,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,n=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*i-o*r,c=a*r+o*t-n*i,u=a*i+n*r-s*t,p=-n*t-s*r-o*i;return this.x=l*a+p*-n+c*-o-u*-s,this.y=c*a+p*-s+u*-n-l*-o,this.z=u*a+p*-o+l*-s-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,n=e.z,s=t.x,o=t.y,a=t.z;return this.x=i*a-n*o,this.y=n*s-r*a,this.z=r*o-i*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return li.copy(this).projectOnVector(e),this.sub(li)}reflect(e){return this.sub(li.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(br(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const li=new ai,ci=new oi;class ui{constructor(e=new ai(1/0,1/0,1/0),t=new ai(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<r&&(r=c),u<i&&(i=u),l>n&&(n=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(t,r,i),this.max.set(n,s,o),this}setFromBufferAttribute(e){let t=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),u=e.getZ(a);l<t&&(t=l),c<r&&(r=c),u<i&&(i=u),l>n&&(n=l),c>s&&(s=c),u>o&&(o=u)}return this.min.set(t,r,i),this.max.set(n,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=hi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(void 0!==r)if(t&&null!=r.attributes&&void 0!==r.attributes.position){const t=r.attributes.position;for(let r=0,i=t.count;r<i;r++)hi.fromBufferAttribute(t,r).applyMatrix4(e.matrixWorld),this.expandByPoint(hi)}else null===r.boundingBox&&r.computeBoundingBox(),di.copy(r.boundingBox),di.applyMatrix4(e.matrixWorld),this.union(di);const i=e.children;for(let n=0,s=i.length;n<s;n++)this.expandByObject(i[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,hi),hi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ai),bi.subVectors(this.max,Ai),fi.subVectors(e.a,Ai),gi.subVectors(e.b,Ai),mi.subVectors(e.c,Ai),_i.subVectors(gi,fi),vi.subVectors(mi,gi),xi.subVectors(fi,mi);let t=[0,-_i.z,_i.y,0,-vi.z,vi.y,0,-xi.z,xi.y,_i.z,0,-_i.x,vi.z,0,-vi.x,xi.z,0,-xi.x,-_i.y,_i.x,0,-vi.y,vi.x,0,-xi.y,xi.x,0];return!!Ei(t,fi,gi,mi,bi)&&(!!Ei(t=[1,0,0,0,1,0,0,0,1],fi,gi,mi,bi)&&(yi.crossVectors(_i,vi),Ei(t=[yi.x,yi.y,yi.z],fi,gi,mi,bi)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return hi.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(hi).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(pi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),pi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),pi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),pi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),pi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),pi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),pi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),pi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(pi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const pi=[new ai,new ai,new ai,new ai,new ai,new ai,new ai,new ai],hi=new ai,di=new ui,fi=new ai,gi=new ai,mi=new ai,_i=new ai,vi=new ai,xi=new ai,Ai=new ai,bi=new ai,yi=new ai,wi=new ai;function Ei(e,t,r,i,n){for(let s=0,o=e.length-3;s<=o;s+=3){wi.fromArray(e,s);const o=n.x*Math.abs(wi.x)+n.y*Math.abs(wi.y)+n.z*Math.abs(wi.z),a=t.dot(wi),l=r.dot(wi),c=i.dot(wi);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const Si=new ui,Ci=new ai,Mi=new ai,Ti=new ai;class Ii{constructor(e=new ai,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):Si.setFromPoints(e).getCenter(r);let i=0;for(let n=0,s=e.length;n<s;n++)i=Math.max(i,r.distanceToSquared(e[n]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Ti.subVectors(e,this.center);const t=Ti.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),r=.5*(e-this.radius);this.center.add(Ti.multiplyScalar(r/e)),this.radius+=r}return this}union(e){return!0===this.center.equals(e.center)?Mi.set(0,0,1).multiplyScalar(e.radius):Mi.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Ci.copy(e.center).add(Mi)),this.expandByPoint(Ci.copy(e.center).sub(Mi)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ki=new ai,Di=new ai,Pi=new ai,Bi=new ai,Ri=new ai,Li=new ai,Oi=new ai;class Fi{constructor(e=new ai,t=new ai(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ki)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ki.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ki.copy(this.direction).multiplyScalar(t).add(this.origin),ki.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){Di.copy(e).add(t).multiplyScalar(.5),Pi.copy(t).sub(e).normalize(),Bi.copy(this.origin).sub(Di);const n=.5*e.distanceTo(t),s=-this.direction.dot(Pi),o=Bi.dot(this.direction),a=-Bi.dot(Pi),l=Bi.lengthSq(),c=Math.abs(1-s*s);let u,p,h,d;if(c>0)if(p=s*o-a,d=n*c,(u=s*a-o)>=0)if(p>=-d)if(p<=d){const e=1/c;h=(u*=e)*(u+s*(p*=e)+2*o)+p*(s*u+p+2*a)+l}else p=n,h=-(u=Math.max(0,-(s*p+o)))*u+p*(p+2*a)+l;else p=-n,h=-(u=Math.max(0,-(s*p+o)))*u+p*(p+2*a)+l;else p<=-d?h=-(u=Math.max(0,-(-s*n+o)))*u+(p=u>0?-n:Math.min(Math.max(-n,-a),n))*(p+2*a)+l:p<=d?(u=0,h=(p=Math.min(Math.max(-n,-a),n))*(p+2*a)+l):h=-(u=Math.max(0,-(s*n+o)))*u+(p=u>0?n:Math.min(Math.max(-n,-a),n))*(p+2*a)+l;else p=s>0?-n:n,h=-(u=Math.max(0,-(s*p+o)))*u+p*(p+2*a)+l;return r&&r.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(Pi).multiplyScalar(p).add(Di),h}intersectSphere(e,t){ki.subVectors(e.center,this.origin);const r=ki.dot(this.direction),i=ki.dot(ki)-r*r,n=e.radius*e.radius;if(i>n)return null;const s=Math.sqrt(n-i),o=r-s,a=r+s;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,n,s,o,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,p=this.origin;return l>=0?(r=(e.min.x-p.x)*l,i=(e.max.x-p.x)*l):(r=(e.max.x-p.x)*l,i=(e.min.x-p.x)*l),c>=0?(n=(e.min.y-p.y)*c,s=(e.max.y-p.y)*c):(n=(e.max.y-p.y)*c,s=(e.min.y-p.y)*c),r>s||n>i?null:((n>r||r!=r)&&(r=n),(s<i||i!=i)&&(i=s),u>=0?(o=(e.min.z-p.z)*u,a=(e.max.z-p.z)*u):(o=(e.max.z-p.z)*u,a=(e.min.z-p.z)*u),r>a||o>i?null:((o>r||r!=r)&&(r=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(r>=0?r:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,ki)}intersectTriangle(e,t,r,i,n){Ri.subVectors(t,e),Li.subVectors(r,e),Oi.crossVectors(Ri,Li);let s,o=this.direction.dot(Oi);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Bi.subVectors(this.origin,e);const a=s*this.direction.dot(Li.crossVectors(Bi,Li));if(a<0)return null;const l=s*this.direction.dot(Ri.cross(Bi));if(l<0)return null;if(a+l>o)return null;const c=-s*Bi.dot(Oi);return c<0?null:this.at(c/o,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ui{constructor(){Ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,r,i,n,s,o,a,l,c,u,p,h,d,f,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=n,m[5]=s,m[9]=o,m[13]=a,m[2]=l,m[6]=c,m[10]=u,m[14]=p,m[3]=h,m[7]=d,m[11]=f,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ui).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Ni.setFromMatrixColumn(e,0).length(),n=1/Ni.setFromMatrixColumn(e,1).length(),s=1/Ni.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,n=e.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(i),l=Math.sin(i),c=Math.cos(n),u=Math.sin(n);if("XYZ"===e.order){const e=s*c,r=s*u,i=o*c,n=o*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=r+i*l,t[5]=e-n*l,t[9]=-o*a,t[2]=n-e*l,t[6]=i+r*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*c,r=a*u,i=l*c,n=l*u;t[0]=e+n*o,t[4]=i*o-r,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-o,t[2]=r*o-i,t[6]=n+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*c,r=a*u,i=l*c,n=l*u;t[0]=e-n*o,t[4]=-s*u,t[8]=i+r*o,t[1]=r+i*o,t[5]=s*c,t[9]=n-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*c,r=s*u,i=o*c,n=o*u;t[0]=a*c,t[4]=i*l-r,t[8]=e*l+n,t[1]=a*u,t[5]=n*l+e,t[9]=r*l-i,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,r=s*l,i=o*a,n=o*l;t[0]=a*c,t[4]=n-e*u,t[8]=i*u+r,t[1]=u,t[5]=s*c,t[9]=-o*c,t[2]=-l*c,t[6]=r*u+i,t[10]=e-n*u}else if("XZY"===e.order){const e=s*a,r=s*l,i=o*a,n=o*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+n,t[5]=s*c,t[9]=r*u-i,t[2]=i*u-r,t[6]=o*c,t[10]=n*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Gi,e,zi)}lookAt(e,t,r){const i=this.elements;return Hi.subVectors(e,t),0===Hi.lengthSq()&&(Hi.z=1),Hi.normalize(),Vi.crossVectors(r,Hi),0===Vi.lengthSq()&&(1===Math.abs(r.z)?Hi.x+=1e-4:Hi.z+=1e-4,Hi.normalize(),Vi.crossVectors(r,Hi)),Vi.normalize(),Qi.crossVectors(Hi,Vi),i[0]=Vi.x,i[4]=Qi.x,i[8]=Hi.x,i[1]=Vi.y,i[5]=Qi.y,i[9]=Hi.y,i[2]=Vi.z,i[6]=Qi.z,i[10]=Hi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,n=this.elements,s=r[0],o=r[4],a=r[8],l=r[12],c=r[1],u=r[5],p=r[9],h=r[13],d=r[2],f=r[6],g=r[10],m=r[14],_=r[3],v=r[7],x=r[11],A=r[15],b=i[0],y=i[4],w=i[8],E=i[12],S=i[1],C=i[5],M=i[9],T=i[13],I=i[2],k=i[6],D=i[10],P=i[14],B=i[3],R=i[7],L=i[11],O=i[15];return n[0]=s*b+o*S+a*I+l*B,n[4]=s*y+o*C+a*k+l*R,n[8]=s*w+o*M+a*D+l*L,n[12]=s*E+o*T+a*P+l*O,n[1]=c*b+u*S+p*I+h*B,n[5]=c*y+u*C+p*k+h*R,n[9]=c*w+u*M+p*D+h*L,n[13]=c*E+u*T+p*P+h*O,n[2]=d*b+f*S+g*I+m*B,n[6]=d*y+f*C+g*k+m*R,n[10]=d*w+f*M+g*D+m*L,n[14]=d*E+f*T+g*P+m*O,n[3]=_*b+v*S+x*I+A*B,n[7]=_*y+v*C+x*k+A*R,n[11]=_*w+v*M+x*D+A*L,n[15]=_*E+v*T+x*P+A*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],s=e[1],o=e[5],a=e[9],l=e[13],c=e[2],u=e[6],p=e[10],h=e[14];return e[3]*(+n*a*u-i*l*u-n*o*p+r*l*p+i*o*h-r*a*h)+e[7]*(+t*a*h-t*l*p+n*s*p-i*s*h+i*l*c-n*a*c)+e[11]*(+t*l*u-t*o*h-n*s*u+r*s*h+n*o*c-r*l*c)+e[15]*(-i*o*c-t*a*u+t*o*p+i*s*u-r*s*p+r*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],p=e[10],h=e[11],d=e[12],f=e[13],g=e[14],m=e[15],_=u*g*l-f*p*l+f*a*h-o*g*h-u*a*m+o*p*m,v=d*p*l-c*g*l-d*a*h+s*g*h+c*a*m-s*p*m,x=c*f*l-d*u*l+d*o*h-s*f*h-c*o*m+s*u*m,A=d*u*a-c*f*a-d*o*p+s*f*p+c*o*g-s*u*g,b=t*_+r*v+i*x+n*A;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const y=1/b;return e[0]=_*y,e[1]=(f*p*n-u*g*n-f*i*h+r*g*h+u*i*m-r*p*m)*y,e[2]=(o*g*n-f*a*n+f*i*l-r*g*l-o*i*m+r*a*m)*y,e[3]=(u*a*n-o*p*n-u*i*l+r*p*l+o*i*h-r*a*h)*y,e[4]=v*y,e[5]=(c*g*n-d*p*n+d*i*h-t*g*h-c*i*m+t*p*m)*y,e[6]=(d*a*n-s*g*n-d*i*l+t*g*l+s*i*m-t*a*m)*y,e[7]=(s*p*n-c*a*n+c*i*l-t*p*l-s*i*h+t*a*h)*y,e[8]=x*y,e[9]=(d*u*n-c*f*n-d*r*h+t*f*h+c*r*m-t*u*m)*y,e[10]=(s*f*n-d*o*n+d*r*l-t*f*l-s*r*m+t*o*m)*y,e[11]=(c*o*n-s*u*n-c*r*l+t*u*l+s*r*h-t*o*h)*y,e[12]=A*y,e[13]=(c*f*i-d*u*i+d*r*p-t*f*p-c*r*g+t*u*g)*y,e[14]=(d*o*i-s*f*i-d*r*a+t*f*a+s*r*g-t*o*g)*y,e[15]=(s*u*i-c*o*i+c*r*a-t*u*a-s*r*p+t*o*p)*y,this}scale(e){const t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),n=1-r,s=e.x,o=e.y,a=e.z,l=n*s,c=n*o;return this.set(l*s+r,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+r,c*a-i*s,0,l*a-i*o,c*a+i*s,n*a*a+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,n,s){return this.set(1,r,n,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,n=t._x,s=t._y,o=t._z,a=t._w,l=n+n,c=s+s,u=o+o,p=n*l,h=n*c,d=n*u,f=s*c,g=s*u,m=o*u,_=a*l,v=a*c,x=a*u,A=r.x,b=r.y,y=r.z;return i[0]=(1-(f+m))*A,i[1]=(h+x)*A,i[2]=(d-v)*A,i[3]=0,i[4]=(h-x)*b,i[5]=(1-(p+m))*b,i[6]=(g+_)*b,i[7]=0,i[8]=(d+v)*y,i[9]=(g-_)*y,i[10]=(1-(p+f))*y,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let n=Ni.set(i[0],i[1],i[2]).length();const s=Ni.set(i[4],i[5],i[6]).length(),o=Ni.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],ji.copy(this);const a=1/n,l=1/s,c=1/o;return ji.elements[0]*=a,ji.elements[1]*=a,ji.elements[2]*=a,ji.elements[4]*=l,ji.elements[5]*=l,ji.elements[6]*=l,ji.elements[8]*=c,ji.elements[9]*=c,ji.elements[10]*=c,t.setFromRotationMatrix(ji),r.x=n,r.y=s,r.z=o,this}makePerspective(e,t,r,i,n,s){const o=this.elements,a=2*n/(t-e),l=2*n/(r-i),c=(t+e)/(t-e),u=(r+i)/(r-i),p=-(s+n)/(s-n),h=-2*s*n/(s-n);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=p,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,r,i,n,s){const o=this.elements,a=1/(t-e),l=1/(r-i),c=1/(s-n),u=(t+e)*a,p=(r+i)*l,h=(s+n)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-p,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Ni=new ai,ji=new Ui,Gi=new ai(0,0,0),zi=new ai(1,1,1),Vi=new ai,Qi=new ai,Hi=new ai,Wi=new Ui,qi=new oi;class Xi{constructor(e=0,t=0,r=0,i=Xi.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,n=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],u=i[2],p=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(br(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(p,l),this._z=0);break;case"YXZ":this._x=Math.asin(-br(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(br(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-br(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,h),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(br(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-br(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(p,l),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return Wi.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Wi,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return qi.setFromEuler(this),this.setFromQuaternion(qi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Xi.DefaultOrder="XYZ",Xi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Yi{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Ki=0;const Ji=new ai,Zi=new oi,$i=new Ui,en=new ai,tn=new ai,rn=new ai,nn=new oi,sn=new ai(1,0,0),on=new ai(0,1,0),an=new ai(0,0,1),ln={type:"added"},cn={type:"removed"};class un extends gr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ki++}),this.uuid=Ar(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=un.DefaultUp.clone();const e=new ai,t=new Xi,r=new oi,i=new ai(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ui},normalMatrix:{value:new Dr}}),this.matrix=new Ui,this.matrixWorld=new Ui,this.matrixAutoUpdate=un.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=un.DefaultMatrixWorldAutoUpdate,this.layers=new Yi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(e,t,r,i,n,s){this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:r,geometry:i,material:n,group:s})}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Zi.setFromAxisAngle(e,t),this.quaternion.multiply(Zi),this}rotateOnWorldAxis(e,t){return Zi.setFromAxisAngle(e,t),this.quaternion.premultiply(Zi),this}rotateX(e){return this.rotateOnAxis(sn,e)}rotateY(e){return this.rotateOnAxis(on,e)}rotateZ(e){return this.rotateOnAxis(an,e)}translateOnAxis(e,t){return Ji.copy(e).applyQuaternion(this.quaternion),this.position.add(Ji.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(sn,e)}translateY(e){return this.translateOnAxis(on,e)}translateZ(e){return this.translateOnAxis(an,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4($i.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?en.copy(e):en.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),tn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$i.lookAt(tn,en,this.up):$i.lookAt(en,tn,this.up),this.quaternion.setFromRotationMatrix($i),i&&($i.extractRotation(i.matrixWorld),Zi.setFromRotationMatrix($i),this.quaternion.premultiply(Zi.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ln)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(cn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(cn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),$i.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),$i.multiply(e.parent.matrixWorld)),e.applyMatrix4($i),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tn,e,rn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tn,nn,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++){const i=t[r];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(!0===e&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,r=e.length;t<r;t++){const r=e[t];!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function n(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const r=t.shapes;if(Array.isArray(r))for(let t=0,i=r.length;t<i;t++){const i=r[t];n(e.shapes,i)}else n(e.shapes,r)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let r=0,i=this.material.length;r<i;r++)t.push(n(e.materials,this.material[r]));i.material=t}else i.material=n(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const r=this.animations[t];i.animations.push(n(e.animations,r))}}if(t){const t=s(e.geometries),i=s(e.materials),n=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),c=s(e.animations),u=s(e.nodes);t.length>0&&(r.geometries=t),i.length>0&&(r.materials=i),n.length>0&&(r.textures=n),o.length>0&&(r.images=o),a.length>0&&(r.shapes=a),l.length>0&&(r.skeletons=l),c.length>0&&(r.animations=c),u.length>0&&(r.nodes=u)}return r.object=i,r;function s(e){const t=[];for(const r in e){const i=e[r];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData={};for(const[r,i]of Object.entries(e.userData))this.userData[r]=!i||i&&(i.isTexture||i.isObject3D)?i:JSON.parse(JSON.stringify(i));if(!0===t)for(let r=0;r<e.children.length;r++){const t=e.children[r];this.add(t.clone())}return this}}un.DefaultUp=new ai(0,1,0),un.DefaultMatrixAutoUpdate=!0,un.DefaultMatrixWorldAutoUpdate=!0;const pn=new ai,hn=new ai,dn=new ai,fn=new ai,gn=new ai,mn=new ai,_n=new ai,vn=new ai,xn=new ai,An=new ai;class bn{constructor(e=new ai,t=new ai,r=new ai){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),pn.subVectors(e,t),i.cross(pn);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(e,t,r,i,n){pn.subVectors(i,t),hn.subVectors(r,t),dn.subVectors(e,t);const s=pn.dot(pn),o=pn.dot(hn),a=pn.dot(dn),l=hn.dot(hn),c=hn.dot(dn),u=s*l-o*o;if(0===u)return n.set(-2,-1,-1);const p=1/u,h=(l*a-o*c)*p,d=(s*c-o*a)*p;return n.set(1-h-d,d,h)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,fn),fn.x>=0&&fn.y>=0&&fn.x+fn.y<=1}static getUV(e,t,r,i,n,s,o,a){return this.getBarycoord(e,t,r,i,fn),a.set(0,0),a.addScaledVector(n,fn.x),a.addScaledVector(s,fn.y),a.addScaledVector(o,fn.z),a}static isFrontFacing(e,t,r,i){return pn.subVectors(r,t),hn.subVectors(e,t),pn.cross(hn).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pn.subVectors(this.c,this.b),hn.subVectors(this.a,this.b),.5*pn.cross(hn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return bn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return bn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,n){return bn.getUV(e,this.a,this.b,this.c,t,r,i,n)}containsPoint(e){return bn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return bn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,n=this.c;let s,o;gn.subVectors(i,r),mn.subVectors(n,r),vn.subVectors(e,r);const a=gn.dot(vn),l=mn.dot(vn);if(a<=0&&l<=0)return t.copy(r);xn.subVectors(e,i);const c=gn.dot(xn),u=mn.dot(xn);if(c>=0&&u<=c)return t.copy(i);const p=a*u-c*l;if(p<=0&&a>=0&&c<=0)return s=a/(a-c),t.copy(r).addScaledVector(gn,s);An.subVectors(e,n);const h=gn.dot(An),d=mn.dot(An);if(d>=0&&h<=d)return t.copy(n);const f=h*l-a*d;if(f<=0&&l>=0&&d<=0)return o=l/(l-d),t.copy(r).addScaledVector(mn,o);const g=c*d-h*u;if(g<=0&&u-c>=0&&h-d>=0)return _n.subVectors(n,i),o=(u-c)/(u-c+(h-d)),t.copy(i).addScaledVector(_n,o);const m=1/(g+f+p);return s=f*m,o=p*m,t.copy(r).addScaledVector(gn,s).addScaledVector(mn,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let yn=0;class wn extends gr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:yn++}),this.uuid=Ar(),this.name="",this.type="Material",this.blending=v,this.side=f,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=P,this.blendDst=B,this.blendEquation=w,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=z,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=rr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zt,this.stencilZFail=zt,this.stencilZPass=zt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];void 0!==i&&(i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const r in e){const i=e[r];delete i.metadata,t.push(i)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==v&&(r.blending=this.blending),this.side!==f&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){const t=i(e.textures),n=i(e.images);t.length>0&&(r.textures=t),n.length>0&&(r.images=n)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const e=t.length;r=new Array(e);for(let i=0;i!==e;++i)r[i]=t[i].clone()}this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData={};for(const[i,n]of Object.entries(e.userData))this.userData[i]=!n||n&&(n.isTexture||n.isObject3D)?n:JSON.parse(JSON.stringify(n));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class En extends wn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Wr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Sn=new ai,Cn=new kr;class Mn{constructor(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=ir,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)Cn.fromBufferAttribute(this,t),Cn.applyMatrix3(e),this.setXY(t,Cn.x,Cn.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)Sn.fromBufferAttribute(this,t),Sn.applyMatrix3(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Sn.fromBufferAttribute(this,t),Sn.applyMatrix4(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Sn.fromBufferAttribute(this,t),Sn.applyNormalMatrix(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Sn.fromBufferAttribute(this,t),Sn.transformDirection(e),this.setXYZ(t,Sn.x,Sn.y,Sn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Mr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Tr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Mr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Tr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Mr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Tr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Mr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Tr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Tr(t,this.array),r=Tr(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Tr(t,this.array),r=Tr(r,this.array),i=Tr(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=Tr(t,this.array),r=Tr(r,this.array),i=Tr(i,this.array),n=Tr(n,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ir&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Tn extends Mn{constructor(e,t,r){super(new Int8Array(e),t,r)}}class In extends Mn{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class kn extends Mn{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class Dn extends Mn{constructor(e,t,r){super(new Int16Array(e),t,r)}}class Pn extends Mn{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class Bn extends Mn{constructor(e,t,r){super(new Int32Array(e),t,r)}}class Rn extends Mn{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Ln extends Mn{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}}class On extends Mn{constructor(e,t,r){super(new Float32Array(e),t,r)}}class Fn extends Mn{constructor(e,t,r){super(new Float64Array(e),t,r)}}let Un=0;const Nn=new Ui,jn=new un,Gn=new ai,zn=new ui,Vn=new ui,Qn=new ai;class Hn extends gr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Un++}),this.uuid=Ar(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Pr(e)?Rn:Pn)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const t=(new Dr).getNormalMatrix(e);r.applyNormalMatrix(t),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Nn.makeRotationFromQuaternion(e),this.applyMatrix4(Nn),this}rotateX(e){return Nn.makeRotationX(e),this.applyMatrix4(Nn),this}rotateY(e){return Nn.makeRotationY(e),this.applyMatrix4(Nn),this}rotateZ(e){return Nn.makeRotationZ(e),this.applyMatrix4(Nn),this}translate(e,t,r){return Nn.makeTranslation(e,t,r),this.applyMatrix4(Nn),this}scale(e,t,r){return Nn.makeScale(e,t,r),this.applyMatrix4(Nn),this}lookAt(e){return jn.lookAt(e),jn.updateMatrix(),this.applyMatrix4(jn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Gn).negate(),this.translate(Gn.x,Gn.y,Gn.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new On(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ui);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ai(-1/0,-1/0,-1/0),new ai(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const e=t[r];zn.setFromBufferAttribute(e),this.morphTargetsRelative?(Qn.addVectors(this.boundingBox.min,zn.min),this.boundingBox.expandByPoint(Qn),Qn.addVectors(this.boundingBox.max,zn.max),this.boundingBox.expandByPoint(Qn)):(this.boundingBox.expandByPoint(zn.min),this.boundingBox.expandByPoint(zn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ii);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ai,1/0);if(e){const r=this.boundingSphere.center;if(zn.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const r=t[e];Vn.setFromBufferAttribute(r),this.morphTargetsRelative?(Qn.addVectors(zn.min,Vn.min),zn.expandByPoint(Qn),Qn.addVectors(zn.max,Vn.max),zn.expandByPoint(Qn)):(zn.expandByPoint(Vn.min),zn.expandByPoint(Vn.max))}zn.getCenter(r);let i=0;for(let t=0,n=e.count;t<n;t++)Qn.fromBufferAttribute(e,t),i=Math.max(i,r.distanceToSquared(Qn));if(t)for(let n=0,s=t.length;n<s;n++){const s=t[n],o=this.morphTargetsRelative;for(let t=0,n=s.count;t<n;t++)Qn.fromBufferAttribute(s,t),o&&(Gn.fromBufferAttribute(e,t),Qn.add(Gn)),i=Math.max(i,r.distanceToSquared(Qn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.array,i=t.position.array,n=t.normal.array,s=t.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Mn(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let S=0;S<o;S++)l[S]=new ai,c[S]=new ai;const u=new ai,p=new ai,h=new ai,d=new kr,f=new kr,g=new kr,m=new ai,_=new ai;function v(e,t,r){u.fromArray(i,3*e),p.fromArray(i,3*t),h.fromArray(i,3*r),d.fromArray(s,2*e),f.fromArray(s,2*t),g.fromArray(s,2*r),p.sub(u),h.sub(u),f.sub(d),g.sub(d);const n=1/(f.x*g.y-g.x*f.y);isFinite(n)&&(m.copy(p).multiplyScalar(g.y).addScaledVector(h,-f.y).multiplyScalar(n),_.copy(h).multiplyScalar(f.x).addScaledVector(p,-g.x).multiplyScalar(n),l[e].add(m),l[t].add(m),l[r].add(m),c[e].add(_),c[t].add(_),c[r].add(_))}let x=this.groups;0===x.length&&(x=[{start:0,count:r.length}]);for(let S=0,C=x.length;S<C;++S){const e=x[S],t=e.start;for(let i=t,n=t+e.count;i<n;i+=3)v(r[i+0],r[i+1],r[i+2])}const A=new ai,b=new ai,y=new ai,w=new ai;function E(e){y.fromArray(n,3*e),w.copy(y);const t=l[e];A.copy(t),A.sub(y.multiplyScalar(y.dot(t))).normalize(),b.crossVectors(w,t);const r=b.dot(c[e])<0?-1:1;a[4*e]=A.x,a[4*e+1]=A.y,a[4*e+2]=A.z,a[4*e+3]=r}for(let S=0,C=x.length;S<C;++S){const e=x[S],t=e.start;for(let i=t,n=t+e.count;i<n;i+=3)E(r[i+0]),E(r[i+1]),E(r[i+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new Mn(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);const i=new ai,n=new ai,s=new ai,o=new ai,a=new ai,l=new ai,c=new ai,u=new ai;if(e)for(let p=0,h=e.count;p<h;p+=3){const h=e.getX(p+0),d=e.getX(p+1),f=e.getX(p+2);i.fromBufferAttribute(t,h),n.fromBufferAttribute(t,d),s.fromBufferAttribute(t,f),c.subVectors(s,n),u.subVectors(i,n),c.cross(u),o.fromBufferAttribute(r,h),a.fromBufferAttribute(r,d),l.fromBufferAttribute(r,f),o.add(c),a.add(c),l.add(c),r.setXYZ(h,o.x,o.y,o.z),r.setXYZ(d,a.x,a.y,a.z),r.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,p=t.count;e<p;e+=3)i.fromBufferAttribute(t,e+0),n.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,n),u.subVectors(i,n),c.cross(u),r.setXYZ(e+0,c.x,c.y,c.z),r.setXYZ(e+1,c.x,c.y,c.z),r.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Qn.fromBufferAttribute(e,t),Qn.normalize(),e.setXYZ(t,Qn.x,Qn.y,Qn.z)}toNonIndexed(){function e(e,t){const r=e.array,i=e.itemSize,n=e.normalized,s=new r.constructor(t.length*i);let o=0,a=0;for(let l=0,c=t.length;l<c;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)s[a++]=r[o++]}return new Mn(s,i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Hn,r=this.index.array,i=this.attributes;for(const o in i){const n=e(i[o],r);t.setAttribute(o,n)}const n=this.morphAttributes;for(const o in n){const i=[],s=n[o];for(let t=0,n=s.length;t<n;t++){const n=e(s[t],r);i.push(n)}t.morphAttributes[o]=i}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,a=s.length;o<a;o++){const e=s[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const a in r){const t=r[a];e.data.attributes[a]=t.toJSON(e.data)}const i={};let n=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],r=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];r.push(n.toJSON(e.data))}r.length>0&&(i[a]=r,n=!0)}n&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const n=e.morphAttributes;for(const l in n){const e=[],r=n[l];for(let i=0,n=r.length;i<n;i++)e.push(r[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let l=0,c=s.length;l<c;l++){const e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Wn=new Ui,qn=new Fi,Xn=new Ii,Yn=new ai,Kn=new ai,Jn=new ai,Zn=new ai,$n=new ai,es=new ai,ts=new ai,rs=new ai,is=new ai,ns=new kr,ss=new kr,os=new kr,as=new ai,ls=new ai;class cs extends un{constructor(e=new Hn,t=new En){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}raycast(e,t){const r=this.geometry,i=this.material,n=this.matrixWorld;if(void 0===i)return;if(null===r.boundingSphere&&r.computeBoundingSphere(),Xn.copy(r.boundingSphere),Xn.applyMatrix4(n),!1===e.ray.intersectsSphere(Xn))return;if(Wn.copy(n).invert(),qn.copy(e.ray).applyMatrix4(Wn),null!==r.boundingBox&&!1===qn.intersectsBox(r.boundingBox))return;let s;const o=r.index,a=r.attributes.position,l=r.morphAttributes.position,c=r.morphTargetsRelative,u=r.attributes.uv,p=r.attributes.uv2,h=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(i))for(let f=0,g=h.length;f<g;f++){const r=h[f],n=i[r.materialIndex];for(let i=Math.max(r.start,d.start),h=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));i<h;i+=3){const h=o.getX(i),d=o.getX(i+1),f=o.getX(i+2);(s=us(this,n,e,qn,a,l,c,u,p,h,d,f))&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}}else for(let f=Math.max(0,d.start),g=Math.min(o.count,d.start+d.count);f<g;f+=3){const r=o.getX(f),n=o.getX(f+1),h=o.getX(f+2);(s=us(this,i,e,qn,a,l,c,u,p,r,n,h))&&(s.faceIndex=Math.floor(f/3),t.push(s))}else if(void 0!==a)if(Array.isArray(i))for(let f=0,g=h.length;f<g;f++){const r=h[f],n=i[r.materialIndex];for(let i=Math.max(r.start,d.start),o=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));i<o;i+=3)(s=us(this,n,e,qn,a,l,c,u,p,i,i+1,i+2))&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}else for(let f=Math.max(0,d.start),g=Math.min(a.count,d.start+d.count);f<g;f+=3)(s=us(this,i,e,qn,a,l,c,u,p,f,f+1,f+2))&&(s.faceIndex=Math.floor(f/3),t.push(s))}}function us(e,t,r,i,n,s,o,a,l,c,u,p){Yn.fromBufferAttribute(n,c),Kn.fromBufferAttribute(n,u),Jn.fromBufferAttribute(n,p);const h=e.morphTargetInfluences;if(s&&h){ts.set(0,0,0),rs.set(0,0,0),is.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=h[e],r=s[e];0!==t&&(Zn.fromBufferAttribute(r,c),$n.fromBufferAttribute(r,u),es.fromBufferAttribute(r,p),o?(ts.addScaledVector(Zn,t),rs.addScaledVector($n,t),is.addScaledVector(es,t)):(ts.addScaledVector(Zn.sub(Yn),t),rs.addScaledVector($n.sub(Kn),t),is.addScaledVector(es.sub(Jn),t)))}Yn.add(ts),Kn.add(rs),Jn.add(is)}e.isSkinnedMesh&&(e.boneTransform(c,Yn),e.boneTransform(u,Kn),e.boneTransform(p,Jn));const d=function(e,t,r,i,n,s,o,a){let l;if(null===(l=t.side===g?i.intersectTriangle(o,s,n,!0,a):i.intersectTriangle(n,s,o,t.side!==m,a)))return null;ls.copy(a),ls.applyMatrix4(e.matrixWorld);const c=r.ray.origin.distanceTo(ls);return c<r.near||c>r.far?null:{distance:c,point:ls.clone(),object:e}}(e,t,r,i,Yn,Kn,Jn,as);if(d){a&&(ns.fromBufferAttribute(a,c),ss.fromBufferAttribute(a,u),os.fromBufferAttribute(a,p),d.uv=bn.getUV(as,Yn,Kn,Jn,ns,ss,os,new kr)),l&&(ns.fromBufferAttribute(l,c),ss.fromBufferAttribute(l,u),os.fromBufferAttribute(l,p),d.uv2=bn.getUV(as,Yn,Kn,Jn,ns,ss,os,new kr));const e={a:c,b:u,c:p,normal:new ai,materialIndex:0};bn.getNormal(Yn,Kn,Jn,e.normal),d.face=e}return d}class ps extends Hn{constructor(e=1,t=1,r=1,i=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:s};const o=this;i=Math.floor(i),n=Math.floor(n),s=Math.floor(s);const a=[],l=[],c=[],u=[];let p=0,h=0;function d(e,t,r,i,n,s,d,f,g,m,_){const v=s/g,x=d/m,A=s/2,b=d/2,y=f/2,w=g+1,E=m+1;let S=0,C=0;const M=new ai;for(let o=0;o<E;o++){const s=o*x-b;for(let a=0;a<w;a++){const p=a*v-A;M[e]=p*i,M[t]=s*n,M[r]=y,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[r]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(a/g),u.push(1-o/m),S+=1}}for(let o=0;o<m;o++)for(let e=0;e<g;e++){const t=p+e+w*o,r=p+e+w*(o+1),i=p+(e+1)+w*(o+1),n=p+(e+1)+w*o;a.push(t,r,n),a.push(r,i,n),C+=6}o.addGroup(h,C,_),h+=C,p+=S}d("z","y","x",-1,-1,r,t,e,s,n,0),d("z","y","x",1,-1,r,t,-e,s,n,1),d("x","z","y",1,1,e,r,t,i,s,2),d("x","z","y",1,-1,e,r,-t,i,s,3),d("x","y","z",1,-1,e,t,r,i,n,4),d("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(a),this.setAttribute("position",new On(l,3)),this.setAttribute("normal",new On(c,3)),this.setAttribute("uv",new On(u,2))}static fromJSON(e){return new ps(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function hs(e){const t={};for(const r in e){t[r]={};for(const i in e[r]){const n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}function ds(e){const t={};for(let r=0;r<e.length;r++){const i=hs(e[r]);for(const e in i)t[e]=i[e]}return t}const fs={clone:hs,merge:ds};class gs extends wn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=hs(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const r={};for(const i in this.extensions)!0===this.extensions[i]&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class ms extends un{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ui,this.projectionMatrix=new Ui,this.projectionMatrixInverse=new Ui}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class _s extends ms{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*xr*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*vr*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*xr*Math.atan(Math.tan(.5*vr*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*vr*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;n+=s.offsetX*i/e,t-=s.offsetY*r/o,i*=s.width/e,r*=s.height/o}const o=this.filmOffset;0!==o&&(n+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const vs=90;class xs extends un{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r;const i=new _s(vs,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new ai(1,0,0)),this.add(i);const n=new _s(vs,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new ai(-1,0,0)),this.add(n);const s=new _s(vs,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new ai(0,1,0)),this.add(s);const o=new _s(vs,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new ai(0,-1,0)),this.add(o);const a=new _s(vs,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new ai(0,0,1)),this.add(a);const l=new _s(vs,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ai(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const r=this.renderTarget,[i,n,s,o,a,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,p=e.xr.enabled;e.toneMapping=K,e.xr.enabled=!1;const h=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,n),e.setRenderTarget(r,2),e.render(t,s),e.setRenderTarget(r,3),e.render(t,o),e.setRenderTarget(r,4),e.render(t,a),r.texture.generateMipmaps=h,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class As extends Zr{constructor(e,t,r,i,n,s,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ie,r,i,n,s,o,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class bs extends ei{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new As(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:me}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r=new ps(5,5,5),i=new gs({name:"CubemapFromEquirect",uniforms:hs({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",side:g,blending:_});i.uniforms.tEquirect.value=t;const n=new cs(r,i),s=t.minFilter;return t.minFilter===xe&&(t.minFilter=me),new xs(1,10,this).update(e,n),t.minFilter=s,n.geometry.dispose(),n.material.dispose(),this}clear(e,t,r,i){const n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,i);e.setRenderTarget(n)}}const ys=new ai,ws=new ai,Es=new Dr;class Ss{constructor(e=new ai(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=ys.subVectors(r,t).cross(ws.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const r=e.delta(ys),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const n=-(e.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:t.copy(r).multiplyScalar(n).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||Es.getNormalMatrix(e),i=this.coplanarPoint(ys).applyMatrix4(e),n=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Cs=new Ii,Ms=new ai;class Ts{constructor(e=new Ss,t=new Ss,r=new Ss,i=new Ss,n=new Ss,s=new Ss){this.planes=[e,t,r,i,n,s]}set(e,t,r,i,n,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){const t=this.planes,r=e.elements,i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],l=r[5],c=r[6],u=r[7],p=r[8],h=r[9],d=r[10],f=r[11],g=r[12],m=r[13],_=r[14],v=r[15];return t[0].setComponents(o-i,u-a,f-p,v-g).normalize(),t[1].setComponents(o+i,u+a,f+p,v+g).normalize(),t[2].setComponents(o+n,u+l,f+h,v+m).normalize(),t[3].setComponents(o-n,u-l,f-h,v-m).normalize(),t[4].setComponents(o-s,u-c,f-d,v-_).normalize(),t[5].setComponents(o+s,u+c,f+d,v+_).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Cs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Cs)}intersectsSprite(e){return Cs.center.set(0,0,0),Cs.radius=.7071067811865476,Cs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Cs)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(Ms.x=i.normal.x>0?e.max.x:e.min.x,Ms.y=i.normal.y>0?e.max.y:e.min.y,Ms.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Ms)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Is(){let e=null,t=!1,r=null,i=null;function n(t,s){r(t,s),i=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==r&&(i=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function ks(e,t){const r=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const r=i.get(t);r&&(e.deleteBuffer(r.buffer),i.delete(t))},update:function(t,n){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,function(t,i){const n=t.array,s=t.usage,o=e.createBuffer();let a;if(e.bindBuffer(i,o),e.bufferData(i,n,s),t.onUploadCallback(),n instanceof Float32Array)a=5126;else if(n instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!r)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(n instanceof Int16Array)a=5122;else if(n instanceof Uint32Array)a=5125;else if(n instanceof Int32Array)a=5124;else if(n instanceof Int8Array)a=5120;else if(n instanceof Uint8Array)a=5121;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);a=5121}return{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,n)):s.version<t.version&&(function(t,i,n){const s=i.array,o=i.updateRange;e.bindBuffer(n,t),-1===o.count?e.bufferSubData(n,0,s):(r?e.bufferSubData(n,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(n,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,t,n),s.version=t.version)}}}class Ds extends Hn{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const n=e/2,s=t/2,o=Math.floor(r),a=Math.floor(i),l=o+1,c=a+1,u=e/o,p=t/a,h=[],d=[],f=[],g=[];for(let m=0;m<c;m++){const e=m*p-s;for(let t=0;t<l;t++){const r=t*u-n;d.push(r,-e,0),f.push(0,0,1),g.push(t/o),g.push(1-m/a)}}for(let m=0;m<a;m++)for(let e=0;e<o;e++){const t=e+l*m,r=e+l*(m+1),i=e+1+l*(m+1),n=e+1+l*m;h.push(t,r,n),h.push(r,i,n)}this.setIndex(h),this.setAttribute("position",new On(d,3)),this.setAttribute("normal",new On(f,3)),this.setAttribute("uv",new On(g,2))}static fromJSON(e){return new Ds(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ps={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\t#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1\n\tdiffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;\n\t#else\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\t#endif\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\treflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 transformDirection1( in vec3 dir, in mat4 matrix ) {\n\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\t}\n\tmat4 rotationMatrix(vec3 axis, float angle) {\n\t\taxis = normalize(axis);\n\t\tfloat s = sin(angle);\n\t\tfloat c = cos(angle);\n\t\tfloat oc = 1.0 - c;\n\t\treturn mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n\t\t\t\t\toc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n\t\t\t\t\toc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n\t\t\t\t\t0.0,                                0.0,                                0.0,                                1.0);\n\t}\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform float envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tworldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\treflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )\t(0)",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\ndiffuseColor.a = min(max(diffuseColor.a, 0.), 1.);\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );\n\t\t#else\n\t\t\treturn transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nuniform bool flipX;\nuniform bool flipY;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;\n    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Bs={common:{diffuse:{value:new Wr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Dr},uv2Transform:{value:new Dr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new kr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Wr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Wr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Dr}},sprite:{diffuse:{value:new Wr(16777215)},opacity:{value:1},center:{value:new kr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Dr}}},Rs={basic:{uniforms:ds([Bs.common,Bs.specularmap,Bs.envmap,Bs.aomap,Bs.lightmap,Bs.fog]),vertexShader:Ps.meshbasic_vert,fragmentShader:Ps.meshbasic_frag},lambert:{uniforms:ds([Bs.common,Bs.specularmap,Bs.envmap,Bs.aomap,Bs.lightmap,Bs.emissivemap,Bs.bumpmap,Bs.normalmap,Bs.displacementmap,Bs.fog,Bs.lights,{emissive:{value:new Wr(0)}}]),vertexShader:Ps.meshlambert_vert,fragmentShader:Ps.meshlambert_frag},phong:{uniforms:ds([Bs.common,Bs.specularmap,Bs.envmap,Bs.aomap,Bs.lightmap,Bs.emissivemap,Bs.bumpmap,Bs.normalmap,Bs.displacementmap,Bs.fog,Bs.lights,{emissive:{value:new Wr(0)},specular:{value:new Wr(1118481)},shininess:{value:30}}]),vertexShader:Ps.meshphong_vert,fragmentShader:Ps.meshphong_frag},standard:{uniforms:ds([Bs.common,Bs.envmap,Bs.aomap,Bs.lightmap,Bs.emissivemap,Bs.bumpmap,Bs.normalmap,Bs.displacementmap,Bs.roughnessmap,Bs.metalnessmap,Bs.fog,Bs.lights,{emissive:{value:new Wr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ps.meshphysical_vert,fragmentShader:Ps.meshphysical_frag},toon:{uniforms:ds([Bs.common,Bs.aomap,Bs.lightmap,Bs.emissivemap,Bs.bumpmap,Bs.normalmap,Bs.displacementmap,Bs.gradientmap,Bs.fog,Bs.lights,{emissive:{value:new Wr(0)}}]),vertexShader:Ps.meshtoon_vert,fragmentShader:Ps.meshtoon_frag},matcap:{uniforms:ds([Bs.common,Bs.bumpmap,Bs.normalmap,Bs.displacementmap,Bs.fog,{matcap:{value:null}}]),vertexShader:Ps.meshmatcap_vert,fragmentShader:Ps.meshmatcap_frag},points:{uniforms:ds([Bs.points,Bs.fog]),vertexShader:Ps.points_vert,fragmentShader:Ps.points_frag},dashed:{uniforms:ds([Bs.common,Bs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ps.linedashed_vert,fragmentShader:Ps.linedashed_frag},depth:{uniforms:ds([Bs.common,Bs.displacementmap]),vertexShader:Ps.depth_vert,fragmentShader:Ps.depth_frag},normal:{uniforms:ds([Bs.common,Bs.bumpmap,Bs.normalmap,Bs.displacementmap,{opacity:{value:1}}]),vertexShader:Ps.meshnormal_vert,fragmentShader:Ps.meshnormal_frag},sprite:{uniforms:ds([Bs.sprite,Bs.fog]),vertexShader:Ps.sprite_vert,fragmentShader:Ps.sprite_frag},background:{uniforms:{uvTransform:{value:new Dr},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:Ps.background_vert,fragmentShader:Ps.background_frag},cube:{uniforms:ds([Bs.envmap,{opacity:{value:1}}]),vertexShader:Ps.cube_vert,fragmentShader:Ps.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ps.equirect_vert,fragmentShader:Ps.equirect_frag},distanceRGBA:{uniforms:ds([Bs.common,Bs.displacementmap,{referencePosition:{value:new ai},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ps.distanceRGBA_vert,fragmentShader:Ps.distanceRGBA_frag},shadow:{uniforms:ds([Bs.lights,Bs.fog,{color:{value:new Wr(0)},opacity:{value:1}}]),vertexShader:Ps.shadow_vert,fragmentShader:Ps.shadow_frag}};function Ls(e,t,r,i,n,s){const o=new Wr(0);let a,l,c=!0===n?0:1,u=null,p=0,h=null;function d(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,s)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),d(o,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){d(o,c=e)},getPlaneMesh:function(){return a},getBoxMesh:function(){return l},getBoxMesh2:function(){return void 0===l&&((l=new cs(new ps(1,1,1),new gs({name:"BackgroundCubeMaterial",uniforms:hs(Rs.cube.uniforms),vertexShader:Rs.cube.vertexShader,fragmentShader:Rs.cube.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l},render:function(r,n){let s=!1,m=!0===n.isScene?n.background:null;m&&m.isTexture&&(m=t.get(m));const _=e.xr,v=_.getSession&&_.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(o,c):m&&m.isColor&&(d(m,1),s=!0),(e.autoClear||s)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===ae)?(void 0===l&&((l=new cs(new ps(1,1,1),new gs({name:"BackgroundCubeMaterial",uniforms:hs(Rs.cube.uniforms),vertexShader:Rs.cube.vertexShader,fragmentShader:Rs.cube.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.envMapRotation.value=m.rotation||0,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,u===m&&p===m.version&&h===e.toneMapping||(l.material.needsUpdate=!0,u=m,p=m.version,h=e.toneMapping),l.layers.enableAll(),r.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===a&&((a=new cs(new Ds(2,2),new gs({name:"BackgroundMaterial",uniforms:hs(Rs.background.uniforms),vertexShader:Rs.background.vertexShader,fragmentShader:Rs.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=m,a.material.uniforms.flipX.value=m.userData.flipX||!1,a.material.uniforms.flipY.value=m.userData.flipY||!1,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&p===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,u=m,p=m.version,h=e.toneMapping),a.layers.enableAll(),r.unshift(a,a.geometry,a.material,0,0,null))}}}function Os(e,t,r,i){const n=e.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=d(null);let c=l,u=!1;function p(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function d(e){const t=[],r=[],i=[];for(let s=0;s<n;s++)t[s]=0,r[s]=0,i[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,r=e.length;t<r;t++)e[t]=0}function g(e){m(e,0)}function m(r,n){const s=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;s[r]=1,0===o[r]&&(e.enableVertexAttribArray(r),o[r]=1),a[r]!==n&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,n),a[r]=n)}function _(){const t=c.newAttributes,r=c.enabledAttributes;for(let i=0,n=r.length;i<n;i++)r[i]!==t[i]&&(e.disableVertexAttribArray(i),r[i]=0)}function v(t,r,n,s,o,a){!0!==i.isWebGL2||5124!==n&&5125!==n?e.vertexAttribPointer(t,r,n,s,o,a):e.vertexAttribIPointer(t,r,n,o,a)}function x(){A(),u=!0,c!==l&&p((c=l).object)}function A(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(n,l,h,x,A){let b=!1;if(o){const t=function(t,r,n){const o=!0===n.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[r.id];void 0===c&&(c={},l[r.id]=c);let u=c[o];return void 0===u&&(u=d(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[o]=u),u}(x,h,l);c!==t&&p((c=t).object),(b=function(e,t,r,i){const n=c.attributes,s=t.attributes;let o=0;const a=r.getAttributes();for(const l in a)if(a[l].location>=0){const t=n[l];let r=s[l];if(void 0===r&&("instanceMatrix"===l&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(r=e.instanceColor)),void 0===t)return!0;if(t.attribute!==r)return!0;if(r&&t.data!==r.data)return!0;o++}return c.attributesNum!==o||c.index!==i}(n,x,h,A))&&function(e,t,r,i){const n={},s=x.attributes;let o=0;const a=r.getAttributes();for(const l in a)if(a[l].location>=0){let t=s[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));const r={};r.attribute=t,t&&t.data&&(r.data=t.data),n[l]=r,o++}c.attributes=n,c.attributesNum=o,c.index=i}(n,0,h,A)}else{const e=!0===l.wireframe;c.geometry===x.id&&c.program===h.id&&c.wireframe===e||(c.geometry=x.id,c.program=h.id,c.wireframe=e,b=!0)}null!==A&&r.update(A,34963),(b||u)&&(u=!1,function(n,s,o,a){if(!1===i.isWebGL2&&(n.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=o.getAttributes(),u=s.defaultAttributeValues;for(const t in c){const i=c[t];if(i.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&n.instanceMatrix&&(s=n.instanceMatrix),"instanceColor"===t&&n.instanceColor&&(s=n.instanceColor)),void 0!==s){const t=s.normalized,o=s.itemSize,l=r.get(s);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const r=s.data,l=r.stride,h=s.offset;if(r.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)m(i.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)g(i.location+e);e.bindBuffer(34962,c);for(let e=0;e<i.locationSize;e++)v(i.location+e,o/i.locationSize,u,t,l*p,(h+o/i.locationSize*e)*p)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)m(i.location+e,s.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<i.locationSize;e++)g(i.location+e);e.bindBuffer(34962,c);for(let e=0;e<i.locationSize;e++)v(i.location+e,o/i.locationSize,u,t,o*p,o/i.locationSize*e*p)}}else if(void 0!==u){const r=u[t];if(void 0!==r)switch(r.length){case 2:e.vertexAttrib2fv(i.location,r);break;case 3:e.vertexAttrib3fv(i.location,r);break;case 4:e.vertexAttrib4fv(i.location,r);break;default:e.vertexAttrib1fv(i.location,r)}}}}_()}(n,l,h,x),null!==A&&e.bindBuffer(34963,r.get(A).buffer))},reset:x,resetDefaultState:A,dispose:function(){x();for(const e in a){const t=a[e];for(const e in t){const r=t[e];for(const e in r)h(r[e].object),delete r[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const r in t){const e=t[r];for(const t in e)h(e[t].object),delete e[t];delete t[r]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const r=a[t];if(void 0===r[e.id])continue;const i=r[e.id];for(const e in i)h(i[e].object),delete i[e];delete r[e.id]}},initAttributes:f,enableAttribute:g,disableUnusedAttributes:_}}function Fs(e,t,r,i){const n=i.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,i){e.drawArrays(s,t,i),r.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,c;if(n)l=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,i,o,a),r.update(o,s,a)}}function Us(e,t,r){let i;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==r.precision?r.precision:"highp";const a=n(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),c=!0===r.logarithmicDepthBuffer,u=e.getParameter(34930),p=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),g=e.getParameter(36347),m=e.getParameter(36348),_=e.getParameter(36349),v=p>0,x=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const r=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:p,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:g,maxVaryings:m,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:x,floatVertexTextures:v&&x,maxSamples:s?e.getParameter(36183):0}}function Ns(e){const t=this;let r=null,i=0,n=!1,s=!1;const o=new Ss,a=new Dr,l={value:null,needsUpdate:!1};function c(){l.value!==r&&(l.value=r,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,r,i,n){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==n||null===c){const t=i+4*s,n=r.matrixWorldInverse;a.getNormalMatrix(n),(null===c||c.length<t)&&(c=new Float32Array(t));for(let r=0,l=i;r!==s;++r,l+=4)o.copy(e[r]).applyMatrix4(n,a),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const o=0!==e.length||t||0!==i||n;return n=t,r=u(e,s,0),i=e.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(t,o,a){const p=t.clippingPlanes,h=t.clipIntersection,d=t.clipShadows,f=e.get(t);if(!n||null===p||0===p.length||s&&!d)s?u(null):c();else{const e=s?0:i,t=4*e;let n=f.clippingState||null;l.value=n,n=u(p,o,t,a);for(let i=0;i!==t;++i)n[i]=r[i];f.clippingState=n,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function js(e){let t=new WeakMap;function r(e,t){return t===se?e.mapping=ie:t===oe&&(e.mapping=ne),e}function i(e){const r=e.target;r.removeEventListener("dispose",i);const n=t.get(r);void 0!==n&&(t.delete(r),n.dispose())}return{get:function(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){const s=n.mapping;if(s===se||s===oe){if(t.has(n)){const e=t.get(n).texture;return e.rotation=n.rotation,r(e,n.mapping)}{const s=n.image;if(s&&s.height>0){const o=new bs(s.height/2);return o.fromEquirectangularTexture(e,n),o.texture.rotation=n.rotation,t.set(n,o),n.addEventListener("dispose",i),r(o.texture,n.mapping)}return null}}}return n},dispose:function(){t=new WeakMap}}}Rs.physical={uniforms:ds([Rs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new kr(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Wr(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new kr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Wr(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Wr(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ps.meshphysical_vert,fragmentShader:Ps.meshphysical_frag};class Gs extends ms{constructor(e=-1,t=1,r=1,i=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,n,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let n=r-e,s=r+e,o=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s=(n+=e*this.view.offsetX)+e*this.view.width,a=(o-=t*this.view.offsetY)-t*this.view.height}this.projectionMatrix.makeOrthographic(n,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const zs=[.125,.215,.35,.446,.526,.582],Vs=new Gs,Qs=new Wr;let Hs=null;const Ws=(1+Math.sqrt(5))/2,qs=1/Ws,Xs=[new ai(1,1,1),new ai(-1,1,1),new ai(1,1,-1),new ai(-1,1,-1),new ai(0,Ws,qs),new ai(0,Ws,-qs),new ai(qs,0,Ws),new ai(-qs,0,Ws),new ai(Ws,qs,0),new ai(-Ws,qs,0)];class Ys{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){Hs=this._renderer.getRenderTarget(),this._setSize(256);const n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,r,i,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=$s(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Zs(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Hs),e.scissorTest=!1,Js(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ie||e.mapping===ne?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Hs=this._renderer.getRenderTarget();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:me,minFilter:me,generateMipmaps:!1,type:Te,format:Re,encoding:kt,depthBuffer:!1},i=Ks(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ks(e,t,r);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],r=[],i=[];let n=e;const s=e-4+1+zs.length;for(let o=0;o<s;o++){const s=Math.pow(2,n);r.push(s);let a=1/s;o>e-4?a=zs[o-e+4-1]:0===o&&(a=0),i.push(a);const l=1/(s-2),c=-l,u=1+l,p=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,d=6,f=3,g=2,m=1,_=new Float32Array(f*d*h),v=new Float32Array(g*d*h),x=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,r=e>2?0:-1,i=[t,r,0,t+2/3,r,0,t+2/3,r+1,0,t,r,0,t+2/3,r+1,0,t,r+1,0];_.set(i,f*d*e),v.set(p,g*d*e);const n=[e,e,e,e,e,e];x.set(n,m*d*e)}const A=new Hn;A.setAttribute("position",new Mn(_,f)),A.setAttribute("uv",new Mn(v,g)),A.setAttribute("faceIndex",new Mn(x,m)),t.push(A),n>4&&n--}return{lodPlanes:t,sizeLods:r,sigmas:i}}(i)),this._blurMaterial=function(e,t,r){const i=new Float32Array(20),n=new ai(0,1,0);return new gs({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/r,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:_,depthTest:!1,depthWrite:!1})}(i,e,t)}return i}_compileMaterial(e){const t=new cs(this._lodPlanes[0],e);this._renderer.compile(t,Vs)}_sceneToCubeUV(e,t,r,i){const n=new _s(90,1,t,r),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(Qs),a.toneMapping=K,a.autoClear=!1;const u=new En({name:"PMREM.Background",side:g,depthWrite:!1,depthTest:!1}),p=new cs(new ps,u);let h=!1;const d=e.background;d?d.isColor&&(u.color.copy(d),e.background=null,h=!0):(u.color.copy(Qs),h=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(n.up.set(0,s[f],0),n.lookAt(o[f],0,0)):1===t?(n.up.set(0,0,s[f]),n.lookAt(0,o[f],0)):(n.up.set(0,s[f],0),n.lookAt(0,0,o[f]));const r=this._cubeSize;Js(i,t*r,f>2?r:0,r,r),a.setRenderTarget(i),h&&a.render(p,n),a.render(e,n)}p.geometry.dispose(),p.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=d}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===ie||e.mapping===ne;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=$s()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Zs());const n=i?this._cubemapMaterial:this._equirectMaterial,s=new cs(this._lodPlanes[0],n);n.uniforms.envMap.value=e;const o=this._cubeSize;Js(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(s,Vs)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),r=Xs[(i-1)%Xs.length];this._blur(e,i-1,i,t,r)}t.autoClear=r}_blur(e,t,r,i,n){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,i,"latitudinal",n),this._halfBlur(s,e,r,r,i,"longitudinal",n)}_halfBlur(e,t,r,i,n,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new cs(this._lodPlanes[i],l),u=l.uniforms,p=this._sizeLods[r]-1,h=isFinite(n)?Math.PI/(2*p):2*Math.PI/39,d=n/h,f=isFinite(n)?1+Math.floor(3*d):20;f>20&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const g=[];let m=0;for(let x=0;x<20;++x){const e=x/d,t=Math.exp(-e*e/2);g.push(t),0===x?m+=t:x<f&&(m+=2*t)}for(let x=0;x<g.length;x++)g[x]=g[x]/m;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=g,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=h,u.mipInt.value=_-r;const v=this._sizeLods[i];Js(t,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(t),a.render(c,Vs)}}function Ks(e,t,r){const i=new ei(e,t,r);return i.texture.mapping=ae,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Js(e,t,r,i,n){e.viewport.set(t,r,i,n),e.scissor.set(t,r,i,n)}function Zs(){return new gs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:_,depthTest:!1,depthWrite:!1})}function $s(){return new gs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:_,depthTest:!1,depthWrite:!1})}function eo(e){let t=new WeakMap,r=null;function i(e){const r=e.target;r.removeEventListener("dispose",i);const n=t.get(r);void 0!==n&&(t.delete(r),n.dispose())}return{get:function(n){if(n&&n.isTexture){const s=n.mapping,o=s===se||s===oe,a=s===ie||s===ne;if(o||a){if(n.isRenderTargetTexture&&!0===n.needsPMREMUpdate){n.needsPMREMUpdate=!1;let i=t.get(n);return null===r&&(r=new Ys(e)),i=o?r.fromEquirectangular(n,i):r.fromCubemap(n,i),t.set(n,i),i.texture}if(t.has(n))return t.get(n).texture;{const s=n.image;if(o&&s&&s.height>0||a&&s&&function(e){let t=0;for(let r=0;r<6;r++)void 0!==e[r]&&t++;return 6===t}(s)){null===r&&(r=new Ys(e));const s=o?r.fromEquirectangular(n):r.fromCubemap(n);return t.set(n,s),n.addEventListener("dispose",i),s.texture}return null}}}return n},dispose:function(){t=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function to(e){const t={};function r(r){if(void 0!==t[r])return t[r];let i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return t[r]=i,i}return{has:function(e){return null!==r(e)},init:function(e){e.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture")},get:function(e){const t=r(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ro(e,t,r,i){const n={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const r in a.attributes)t.remove(a.attributes[r]);a.removeEventListener("dispose",o),delete n[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,r.memory.geometries--}function a(e){const r=[],i=e.index,n=e.attributes.position;let o=0;if(null!==i){const e=i.array;o=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],n=e[t+1],s=e[t+2];r.push(i,n,n,s,s,i)}}else{const e=n.array;o=n.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,n=t+2;r.push(e,i,i,n,n,e)}}const a=new(Pr(r)?Rn:Pn)(r,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===n[t.id]||(t.addEventListener("dispose",o),n[t.id]=!0,r.memory.geometries++),t},update:function(e){const r=e.attributes;for(const n in r)t.update(r[n],34962);const i=e.morphAttributes;for(const n in i){const e=i[n];for(let r=0,i=e.length;r<i;r++)t.update(e[r],34962)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const r=e.index;null!==r&&t.version<r.version&&a(e)}else a(e);return s.get(e)}}}function io(e,t,r,i){const n=i.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(s,i,o,t*a),r.update(i,s,1)},this.renderInstances=function(i,l,c){if(0===c)return;let u,p;if(n)u=e,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[p](s,l,o,i*a,c),r.update(l,s,c)}}function no(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,i){switch(t.calls++,r){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function so(e,t){return e[0]-t[0]}function oo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ao(e,t,r){const i={},n=new Float32Array(8),s=new WeakMap,o=new $r,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function(l,c,u,p){const h=l.morphTargetInfluences;if(!0===t.isWebGL2){const i=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,n=void 0!==i?i.length:0;let a=s.get(c);if(void 0===a||a.count!==n){void 0!==a&&a.texture.dispose();const e=void 0!==c.morphAttributes.position,r=void 0!==c.morphAttributes.normal,i=void 0!==c.morphAttributes.color,l=c.morphAttributes.position||[],u=c.morphAttributes.normal||[],p=c.morphAttributes.color||[];let h=0;!0===e&&(h=1),!0===r&&(h=2),!0===i&&(h=3);let d=c.attributes.position.count*h,f=1;d>t.maxTextureSize&&(f=Math.ceil(d/t.maxTextureSize),d=t.maxTextureSize);const g=new Float32Array(d*f*4*n),m=new ti(g,d,f,n);m.type=Me,m.needsUpdate=!0;const _=4*h;for(let t=0;t<n;t++){const n=l[t],s=u[t],a=p[t],c=d*f*4*t;for(let t=0;t<n.count;t++){const l=t*_;!0===e&&(o.fromBufferAttribute(n,t),g[c+l+0]=o.x,g[c+l+1]=o.y,g[c+l+2]=o.z,g[c+l+3]=0),!0===r&&(o.fromBufferAttribute(s,t),g[c+l+4]=o.x,g[c+l+5]=o.y,g[c+l+6]=o.z,g[c+l+7]=0),!0===i&&(o.fromBufferAttribute(a,t),g[c+l+8]=o.x,g[c+l+9]=o.y,g[c+l+10]=o.z,g[c+l+11]=4===a.itemSize?o.w:1)}}a={count:n,texture:m,size:new kr(d,f)},s.set(c,a),c.addEventListener("dispose",function e(){m.dispose(),s.delete(c),c.removeEventListener("dispose",e)})}let l=0;for(let e=0;e<h.length;e++)l+=h[e];const u=c.morphTargetsRelative?1:1-l;p.getUniforms().setValue(e,"morphTargetBaseInfluence",u),p.getUniforms().setValue(e,"morphTargetInfluences",h),p.getUniforms().setValue(e,"morphTargetsTexture",a.texture,r),p.getUniforms().setValue(e,"morphTargetsTextureSize",a.size)}else{const t=void 0===h?0:h.length;let r=i[c.id];if(void 0===r||r.length!==t){r=[];for(let e=0;e<t;e++)r[e]=[e,0];i[c.id]=r}for(let e=0;e<t;e++){const t=r[e];t[0]=e,t[1]=h[e]}r.sort(oo);for(let e=0;e<8;e++)e<t&&r[e][1]?(a[e][0]=r[e][0],a[e][1]=r[e][1]):(a[e][0]=Number.MAX_SAFE_INTEGER,a[e][1]=0);a.sort(so);const s=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=a[e],r=t[0],i=t[1];r!==Number.MAX_SAFE_INTEGER&&i?(s&&c.getAttribute("morphTarget"+e)!==s[r]&&c.setAttribute("morphTarget"+e,s[r]),o&&c.getAttribute("morphNormal"+e)!==o[r]&&c.setAttribute("morphNormal"+e,o[r]),n[e]=i,l+=i):(s&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),o&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),n[e]=0)}const u=c.morphTargetsRelative?1:1-l;p.getUniforms().setValue(e,"morphTargetBaseInfluence",u),p.getUniforms().setValue(e,"morphTargetInfluences",n)}}}}function lo(e,t,r,i){let n=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),r.remove(t.instanceMatrix),null!==t.instanceColor&&r.remove(t.instanceColor)}return{update:function(e){const o=i.render.frame,a=e.geometry,l=t.get(e,a);return n.get(l)!==o&&(t.update(l),n.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),r.update(e.instanceMatrix,34962),null!==e.instanceColor&&r.update(e.instanceColor,34962)),l},dispose:function(){n=new WeakMap}}}const co=new Zr,uo=new ti,po=new ii,ho=new As,fo=[],go=[],mo=new Float32Array(16),_o=new Float32Array(9),vo=new Float32Array(4);function xo(e,t,r){const i=e[0];if(i<=0||i>0)return e;const n=t*r;let s=fo[n];if(void 0===s&&(s=new Float32Array(n),fo[n]=s),0!==t){i.toArray(s,0);for(let i=1,n=0;i!==t;++i)n+=r,e[i].toArray(s,n)}return s}function Ao(e,t){if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function bo(e,t){for(let r=0,i=t.length;r<i;r++)e[r]=t[r]}function yo(e,t){let r=go[t];void 0===r&&(r=new Int32Array(t),go[t]=r);for(let i=0;i!==t;++i)r[i]=e.allocateTextureUnit();return r}function wo(e,t){const r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function Eo(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Ao(r,t))return;e.uniform2fv(this.addr,t),bo(r,t)}}function So(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(Ao(r,t))return;e.uniform3fv(this.addr,t),bo(r,t)}}function Co(e,t){const r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Ao(r,t))return;e.uniform4fv(this.addr,t),bo(r,t)}}function Mo(e,t){const r=this.cache,i=t.elements;if(void 0===i){if(Ao(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),bo(r,t)}else{if(Ao(r,i))return;vo.set(i),e.uniformMatrix2fv(this.addr,!1,vo),bo(r,i)}}function To(e,t){const r=this.cache,i=t.elements;if(void 0===i){if(Ao(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),bo(r,t)}else{if(Ao(r,i))return;_o.set(i),e.uniformMatrix3fv(this.addr,!1,_o),bo(r,i)}}function Io(e,t){const r=this.cache,i=t.elements;if(void 0===i){if(Ao(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),bo(r,t)}else{if(Ao(r,i))return;mo.set(i),e.uniformMatrix4fv(this.addr,!1,mo),bo(r,i)}}function ko(e,t){const r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Do(e,t){const r=this.cache;Ao(r,t)||(e.uniform2iv(this.addr,t),bo(r,t))}function Po(e,t){const r=this.cache;Ao(r,t)||(e.uniform3iv(this.addr,t),bo(r,t))}function Bo(e,t){const r=this.cache;Ao(r,t)||(e.uniform4iv(this.addr,t),bo(r,t))}function Ro(e,t){const r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function Lo(e,t){const r=this.cache;Ao(r,t)||(e.uniform2uiv(this.addr,t),bo(r,t))}function Oo(e,t){const r=this.cache;Ao(r,t)||(e.uniform3uiv(this.addr,t),bo(r,t))}function Fo(e,t){const r=this.cache;Ao(r,t)||(e.uniform4uiv(this.addr,t),bo(r,t))}function Uo(e,t,r){const i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||co,n)}function No(e,t,r){const i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||po,n)}function jo(e,t,r){const i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||ho,n)}function Go(e,t,r){const i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(t||uo,n)}function zo(e,t){e.uniform1fv(this.addr,t)}function Vo(e,t){const r=xo(t,this.size,2);e.uniform2fv(this.addr,r)}function Qo(e,t){const r=xo(t,this.size,3);e.uniform3fv(this.addr,r)}function Ho(e,t){const r=xo(t,this.size,4);e.uniform4fv(this.addr,r)}function Wo(e,t){const r=xo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function qo(e,t){const r=xo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function Xo(e,t){const r=xo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function Yo(e,t){e.uniform1iv(this.addr,t)}function Ko(e,t){e.uniform2iv(this.addr,t)}function Jo(e,t){e.uniform3iv(this.addr,t)}function Zo(e,t){e.uniform4iv(this.addr,t)}function $o(e,t){e.uniform1uiv(this.addr,t)}function ea(e,t){e.uniform2uiv(this.addr,t)}function ta(e,t){e.uniform3uiv(this.addr,t)}function ra(e,t){e.uniform4uiv(this.addr,t)}function ia(e,t,r){const i=t.length,n=yo(r,i);e.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)r.setTexture2D(t[s]||co,n[s])}function na(e,t,r){const i=t.length,n=yo(r,i);e.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)r.setTexture3D(t[s]||po,n[s])}function sa(e,t,r){const i=t.length,n=yo(r,i);e.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)r.setTextureCube(t[s]||ho,n[s])}function oa(e,t,r){const i=t.length,n=yo(r,i);e.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)r.setTexture2DArray(t[s]||uo,n[s])}class aa{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(t.type){case 5126:return wo;case 35664:return Eo;case 35665:return So;case 35666:return Co;case 35674:return Mo;case 35675:return To;case 35676:return Io;case 5124:case 35670:return ko;case 35667:case 35671:return Do;case 35668:case 35672:return Po;case 35669:case 35673:return Bo;case 5125:return Ro;case 36294:return Lo;case 36295:return Oo;case 36296:return Fo;case 35678:case 36198:case 36298:case 36306:case 35682:return Uo;case 35679:case 36299:case 36307:return No;case 35680:case 36300:case 36308:case 36293:return jo;case 36289:case 36303:case 36311:case 36292:return Go}}()}}class la{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(t.type){case 5126:return zo;case 35664:return Vo;case 35665:return Qo;case 35666:return Ho;case 35674:return Wo;case 35675:return qo;case 35676:return Xo;case 5124:case 35670:return Yo;case 35667:case 35671:return Ko;case 35668:case 35672:return Jo;case 35669:case 35673:return Zo;case 5125:return $o;case 36294:return ea;case 36295:return ta;case 36296:return ra;case 35678:case 36198:case 36298:case 36306:case 35682:return ia;case 35679:case 36299:case 36307:return na;case 35680:case 36300:case 36308:case 36293:return sa;case 36289:case 36303:case 36311:case 36292:return oa}}()}}class ca{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let n=0,s=i.length;n!==s;++n){const s=i[n];s.setValue(e,t[s.id],r)}}}const ua=/(\w+)(\])?(\[|\.)?/g;function pa(e,t){e.seq.push(t),e.map[t.id]=t}function ha(e,t,r){const i=e.name,n=i.length;for(ua.lastIndex=0;;){const s=ua.exec(i),o=ua.lastIndex;let a=s[1];const l="]"===s[2],c=s[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===n){pa(r,void 0===c?new aa(a,e,t):new la(a,e,t));break}{let e=r.map[a];void 0===e&&pa(r,e=new ca(a)),r=e}}}class da{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,35718);for(let i=0;i<r;++i){const r=e.getActiveUniform(t,i);ha(r,e.getUniformLocation(t,r.name),this)}}setValue(e,t,r,i){const n=this.map[t];void 0!==n&&n.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];void 0!==i&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let n=0,s=t.length;n!==s;++n){const s=t[n],o=r[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,n=e.length;i!==n;++i){const n=e[i];n.id in t&&r.push(n)}return r}}function fa(e,t,r){const i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}let ga=0;function ma(e){switch(e){case kt:return["Linear","( value )"];case Dt:return["sRGB","( value )"];case Bt:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function _a(e,t,r){const i=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(i&&""===n)return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const i=parseInt(s[1]);return r.toUpperCase()+"\n\n"+n+"\n\n"+function(e,t){const r=e.split("\n"),i=[],n=Math.max(t-6,0),s=Math.min(t+6,r.length);for(let o=n;o<s;o++){const e=o+1;i.push(`${e===t?">":" "} ${e}: ${r[o]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return n}function va(e,t){const r=ma(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function xa(e,t){const r=ma(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function Aa(e,t){let r;switch(t){case J:r="Linear";break;case Z:r="Reinhard";break;case $:r="OptimizedCineon";break;case ee:r="ACESFilmic";break;case te:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function ba(e){return""!==e}function ya(e,t){const r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function wa(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ea=/^[ \t]*#include +<([\w\d./]+)>/gm;function Sa(e){return e.replace(Ea,Ca)}function Ca(e,t){const r=Ps[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return Sa(r)}const Ma=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ta(e){return e.replace(Ma,Ia)}function Ia(e,t,r,i){let n="";for(let s=parseInt(t);s<parseInt(r);s++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function ka(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Da(e,t,r,i){const n=e.getContext(),s=r.defines;let o=r.vertexShader,a=r.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===p?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===d&&(t="SHADOWMAP_TYPE_VSM"),t}(r),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ie:case ne:t="ENVMAP_TYPE_CUBE";break;case ae:t="ENVMAP_TYPE_CUBE_UV"}return t}(r),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===ne&&(t="ENVMAP_MODE_REFRACTION"),t}(r),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case q:t="ENVMAP_BLENDING_MULTIPLY";break;case X:t="ENVMAP_BLENDING_MIX";break;case Y:t="ENVMAP_BLENDING_ADD"}return t}(r),g=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const r=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,r),112)),texelHeight:i,maxMip:r}}(r),m=r.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ba).join("\n")}(r),_=function(e){const t=[];for(const r in e){const i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}(s),v=n.createProgram();let x,A,b=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?((x=[_].filter(ba).join("\n")).length>0&&(x+="\n"),(A=[m,_].filter(ba).join("\n")).length>0&&(A+="\n")):(x=[ka(r),"#define SHADER_NAME "+r.shaderName,_,r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphColors&&r.isWebGL2?"#define USE_MORPHCOLORS":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+r.morphTextureStride:"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ba).join("\n"),A=[m,ka(r),"#define SHADER_NAME "+r.shaderName,_,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+c:"",r.envMap?"#define "+u:"",r.envMap?"#define "+f:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==K?"#define TONE_MAPPING":"",r.toneMapping!==K?Ps.tonemapping_pars_fragment:"",r.toneMapping!==K?Aa("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",Ps.encodings_pars_fragment,xa("linearToOutputTexel",r.outputEncoding),r.transmissionSamplerMapEncoding?va("transmissionSamplerMapTexelToLinear",r.transmissionSamplerMapEncoding):"",r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(ba).join("\n")),o=wa(o=ya(o=Sa(o),r),r),a=wa(a=ya(a=Sa(a),r),r),o=Ta(o),a=Ta(a),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(b="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,A=["#define varying in",r.glslVersion===dr?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===dr?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+A);const y=b+A+a,w=fa(n,35633,b+x+o),E=fa(n,35632,y);if(n.attachShader(v,w),n.attachShader(v,E),void 0!==r.index0AttributeName?n.bindAttribLocation(v,0,r.index0AttributeName):!0===r.morphTargets&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),e.debug.checkShaderErrors){const e=n.getProgramInfoLog(v).trim(),t=n.getShaderInfoLog(w).trim(),r=n.getShaderInfoLog(E).trim();let i=!0,s=!0;if(!1===n.getProgramParameter(v,35714)){i=!1;const t=_a(n,w,"vertex"),r=_a(n,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+r)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==r||(s=!1);s&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:x},fragmentShader:{log:r,prefix:A}})}let S,C;return n.deleteShader(w),n.deleteShader(E),this.getUniforms=function(){return void 0===S&&(S=new da(n,v)),S},this.getAttributes=function(){return void 0===C&&(C=function(e,t){const r={},i=e.getProgramParameter(t,35721);for(let n=0;n<i;n++){const i=e.getActiveAttrib(t,n),s=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),r[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:o}}return r}(n,v)),C},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=r.shaderName,this.id=ga++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=E,this}let Pa=0;class Ba{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),n=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(n)&&(s.add(n),n.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new Ra(e),t.set(e,r)),r}}class Ra{constructor(e){this.id=Pa++,this.code=e,this.usedTimes=0}}function La(e,t,r,i,n,s,o){const a=new Yi,l=new Ba,c=[],u=n.isWebGL2,p=n.logarithmicDepthBuffer,h=n.vertexTextures;let d=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,c,_,x){const A=_.fog,b=x.geometry,y=s.isMeshStandardMaterial?_.environment:null,w=(s.isMeshStandardMaterial?r:t).get(s.envMap||y),E=w&&w.mapping===ae?w.image.height:null,S=f[s.type];null!==s.precision&&((d=n.getMaxPrecision(s.precision))!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",d,"instead."));const C=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,M=void 0!==C?C.length:0;let T,I,k,D,P=0;if(void 0!==b.morphAttributes.position&&(P=1),void 0!==b.morphAttributes.normal&&(P=2),void 0!==b.morphAttributes.color&&(P=3),S){const e=Rs[S];T=e.vertexShader,I=e.fragmentShader}else T=s.vertexShader,I=s.fragmentShader,l.update(s),k=l.getVertexShaderID(s),D=l.getFragmentShaderID(s);const B=e.getRenderTarget(),R=e.userData&&e.userData.transmissionRenderTarget,L=s.alphaTest>0,O=s.clearcoat>0,F=s.iridescence>0;return{isWebGL2:u,shaderID:S,shaderName:s.type,vertexShader:T,fragmentShader:I,defines:s.defines,customVertexShaderID:k,customFragmentShaderID:D,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:d,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:h,outputEncoding:null===B?e.outputEncoding:!0===B.isXRRenderTarget||B.texture.encoding!==Dt?B.texture.encoding:kt,map:!!s.map,matcap:!!s.matcap,envMap:!!w,envMapMode:w&&w.mapping,envMapCubeUVHeight:E,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===Ft,tangentSpaceNormalMap:s.normalMapType===Ot,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===Dt,clearcoat:O,clearcoatMap:O&&!!s.clearcoatMap,clearcoatRoughnessMap:O&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:O&&!!s.clearcoatNormalMap,iridescence:F,iridescenceMap:F&&!!s.iridescenceMap,iridescenceThicknessMap:F&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&s.blending===v&&!(s.transmission>0),alphaMap:!!s.alphaMap,alphaTest:L,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,transmissionSamplerMapEncoding:R?R.texture.encoding:kt,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!b.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!A,useFog:!0===s.fog,fogExp2:A&&A.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:p,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:M,morphTextureStride:P,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:K,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===m,flipSided:s.side===g,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.customVertexShaderID),r.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)r.push(e),r.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(r,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0),t.supportsVertexTextures&&a.enable(1),t.instancing&&a.enable(2),t.instancingColor&&a.enable(3),t.map&&a.enable(4),t.matcap&&a.enable(5),t.envMap&&a.enable(6),t.lightMap&&a.enable(7),t.aoMap&&a.enable(8),t.emissiveMap&&a.enable(9),t.bumpMap&&a.enable(10),t.normalMap&&a.enable(11),t.objectSpaceNormalMap&&a.enable(12),t.tangentSpaceNormalMap&&a.enable(13),t.clearcoat&&a.enable(14),t.clearcoatMap&&a.enable(15),t.clearcoatRoughnessMap&&a.enable(16),t.clearcoatNormalMap&&a.enable(17),t.iridescence&&a.enable(18),t.iridescenceMap&&a.enable(19),t.iridescenceThicknessMap&&a.enable(20),t.displacementMap&&a.enable(21),t.specularMap&&a.enable(22),t.roughnessMap&&a.enable(23),t.metalnessMap&&a.enable(24),t.gradientMap&&a.enable(25),t.alphaMap&&a.enable(26),t.alphaTest&&a.enable(27),t.vertexColors&&a.enable(28),t.vertexAlphas&&a.enable(29),t.vertexUvs&&a.enable(30),t.vertexTangents&&a.enable(31),t.uvsVertexOnly&&a.enable(32),e.push(a.mask),a.disableAll(),t.fog&&a.enable(0),t.useFog&&a.enable(1),t.flatShading&&a.enable(2),t.logarithmicDepthBuffer&&a.enable(3),t.skinning&&a.enable(4),t.morphTargets&&a.enable(5),t.morphNormals&&a.enable(6),t.morphColors&&a.enable(7),t.premultipliedAlpha&&a.enable(8),t.shadowMapEnabled&&a.enable(9),t.physicallyCorrectLights&&a.enable(10),t.doubleSided&&a.enable(11),t.flipSided&&a.enable(12),t.useDepthPacking&&a.enable(13),t.dithering&&a.enable(14),t.specularIntensityMap&&a.enable(15),t.specularColorMap&&a.enable(16),t.transmission&&a.enable(17),t.transmissionMap&&a.enable(18),t.thicknessMap&&a.enable(19),t.sheen&&a.enable(20),t.sheenColorMap&&a.enable(21),t.sheenRoughnessMap&&a.enable(22),t.decodeVideoTexture&&a.enable(23),t.opaque&&a.enable(24),e.push(a.mask)}(r,t),r.push(e.outputEncoding)),r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){const t=f[e.type];let r;if(t){const e=Rs[t];r=fs.clone(e.uniforms)}else r=e.uniforms;return r},acquireProgram:function(t,r){let i;for(let e=0,n=c.length;e<n;e++){const t=c[e];if(t.cacheKey===r){++(i=t).usedTimes;break}}return void 0===i&&(i=new Da(e,r,t,s),c.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Oa(){let e=new WeakMap;return{get:function(t){let r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,i){e.get(t)[r]=i},dispose:function(){e=new WeakMap}}}function Fa(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ua(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Na(){const e=[];let t=0;const r=[],i=[],n=[];function s(r,i,n,s,o,a){let l=e[t];return void 0===l?(l={id:r.id,object:r,geometry:i,material:n,groupOrder:s,renderOrder:r.renderOrder,z:o,group:a},e[t]=l):(l.id=r.id,l.object=r,l.geometry=i,l.material=n,l.groupOrder=s,l.renderOrder=r.renderOrder,l.z=o,l.group=a),t++,l}return{opaque:r,transmissive:i,transparent:n,init:function(){t=0,r.length=0,i.length=0,n.length=0},push:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?i.push(u):!0===o.transparent?n.push(u):r.push(u)},unshift:function(e,t,o,a,l,c){const u=s(e,t,o,a,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?n.unshift(u):r.unshift(u)},finish:function(){for(let r=t,i=e.length;r<i;r++){const t=e[r];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Fa),i.length>1&&i.sort(t||Ua),n.length>1&&n.sort(t||Ua)}}}function ja(){let e=new WeakMap;return{get:function(t,r){const i=e.get(t);let n;return void 0===i?(n=new Na,e.set(t,[n])):r>=i.length?(n=new Na,i.push(n)):n=i[r],n},dispose:function(){e=new WeakMap}}}function Ga(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":r={direction:new ai,color:new Wr};break;case"SpotLight":r={position:new ai,direction:new ai,color:new Wr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new ai,color:new Wr,distance:0,decay:0};break;case"HemisphereLight":r={direction:new ai,skyColor:new Wr,groundColor:new Wr};break;case"RectAreaLight":r={color:new Wr,position:new ai,halfWidth:new ai,halfHeight:new ai}}return e[t.id]=r,r}}}let za=0;function Va(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Qa(e,t){const r=new Ga,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kr};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kr,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)n.probe.push(new ai);const s=new ai,o=new Ui,a=new Ui;return{setup:function(s,o){let a=0,l=0,c=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let u=0,p=0,h=0,d=0,f=0,g=0,m=0,_=0,v=0,x=0;s.sort(Va);const A=!0!==o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,b=t.intensity,y=t.distance,w=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*b*A,l+=o.g*b*A,c+=o.b*b*A;else if(t.isLightProbe)for(let e=0;e<9;e++)n.probe[e].addScaledVector(t.sh.coefficients[e],b);else if(t.isDirectionalLight){const e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),t.castShadow){const e=t.shadow,r=i.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,n.directionalShadow[u]=r,n.directionalShadowMap[u]=w,n.directionalShadowMatrix[u]=t.shadow.matrix,g++}n.directional[u]=e,u++}else if(t.isSpotLight){const e=r.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(b*A),e.distance=y,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,n.spot[h]=e;const s=t.shadow;if(t.map&&(n.spotLightMap[v]=t.map,v++,s.updateMatrices(t),t.castShadow&&x++),n.spotLightMatrix[h]=s.matrix,t.castShadow){const e=i.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,n.spotShadow[h]=e,n.spotShadowMap[h]=w,_++}h++}else if(t.isRectAreaLight){const e=r.get(t);e.color.copy(o).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),n.rectArea[d]=e,d++}else if(t.isPointLight){const e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,r=i.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,r.shadowCameraNear=e.camera.near,r.shadowCameraFar=e.camera.far,n.pointShadow[p]=r,n.pointShadowMap[p]=w,n.pointShadowMatrix[p]=t.shadow.matrix,m++}n.point[p]=e,p++}else if(t.isHemisphereLight){const e=r.get(t);e.skyColor.copy(t.color).multiplyScalar(b*A),e.groundColor.copy(t.groundColor).multiplyScalar(b*A),n.hemi[f]=e,f++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=Bs.LTC_FLOAT_1,n.rectAreaLTC2=Bs.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(n.rectAreaLTC1=Bs.LTC_HALF_1,n.rectAreaLTC2=Bs.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=a,n.ambient[1]=l,n.ambient[2]=c;const b=n.hash;b.directionalLength===u&&b.pointLength===p&&b.spotLength===h&&b.rectAreaLength===d&&b.hemiLength===f&&b.numDirectionalShadows===g&&b.numPointShadows===m&&b.numSpotShadows===_&&b.numSpotMaps===v||(n.directional.length=u,n.spot.length=h,n.rectArea.length=d,n.point.length=p,n.hemi.length=f,n.directionalShadow.length=g,n.directionalShadowMap.length=g,n.pointShadow.length=m,n.pointShadowMap.length=m,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=g,n.pointShadowMatrix.length=m,n.spotLightMatrix.length=_+v-x,n.spotLightMap.length=v,n.numSpotLightShadowsWithMaps=x,b.directionalLength=u,b.pointLength=p,b.spotLength=h,b.rectAreaLength=d,b.hemiLength=f,b.numDirectionalShadows=g,b.numPointShadows=m,b.numSpotShadows=_,b.numSpotMaps=v,n.version=za++)},setupView:function(e,t){let r=0,i=0,l=0,c=0,u=0;const p=t.matrixWorldInverse;for(let h=0,d=e.length;h<d;h++){const t=e[h];if(t.isDirectionalLight){const e=n.directional[r];e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(p),r++}else if(t.isSpotLight){const e=n.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(p),e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(p),l++}else if(t.isRectAreaLight){const e=n.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(p),a.identity(),o.copy(t.matrixWorld),o.premultiply(p),a.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(t.isPointLight){const e=n.point[i];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(p),i++}else if(t.isHemisphereLight){const e=n.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(p),u++}}},state:n}}function Ha(e,t){const r=new Qa(e,t),i=[],n=[];return{init:function(){i.length=0,n.length=0},state:{lightsArray:i,shadowsArray:n,lights:r},setupLights:function(e){r.setup(i,e)},setupLightsView:function(e){r.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){n.push(e)}}}function Wa(e,t){let r=new WeakMap;return{get:function(i,n=0){const s=r.get(i);let o;return void 0===s?(o=new Ha(e,t),r.set(i,[o])):n>=s.length?(o=new Ha(e,t),s.push(o)):o=s[n],o},dispose:function(){r=new WeakMap}}}class qa extends wn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Rt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Xa extends wn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new ai,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Ya(e,t,r){let i=new Ts;const n=new kr,s=new kr,o=new $r,a=new qa({depthPacking:Lt}),l=new Xa,c={},u=r.maxTextureSize,h={0:g,1:f,2:m},v=new gs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new kr},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),x=v.clone();x.defines.HORIZONTAL_PASS=1;const A=new Hn;A.setAttribute("position",new Mn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new cs(A,v),y=this;function w(r,i){const s=t.update(b);v.defines.VSM_SAMPLES!==r.blurSamples&&(v.defines.VSM_SAMPLES=r.blurSamples,x.defines.VSM_SAMPLES=r.blurSamples,v.needsUpdate=!0,x.needsUpdate=!0),null===r.mapPass&&(r.mapPass=new ei(n.x,n.y)),v.uniforms.shadow_pass.value=r.map.texture,v.uniforms.resolution.value=r.mapSize,v.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(i,null,s,v,b,null),x.uniforms.shadow_pass.value=r.mapPass.texture,x.uniforms.resolution.value=r.mapSize,x.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(i,null,s,x,b,null)}function E(t,r,i,n,s,o){let u=null;const p=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(u=void 0!==p?p:!0===i.isPointLight?l:a,e.localClippingEnabled&&!0===r.clipShadows&&Array.isArray(r.clippingPlanes)&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0){const e=u.uuid,t=r.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let n=i[t];void 0===n&&(n=u.clone(),i[t]=n),u=n}return u.visible=r.visible,u.wireframe=r.wireframe,u.side=o===d?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],u.alphaMap=r.alphaMap,u.alphaTest=r.alphaTest,u.clipShadows=r.clipShadows,u.clippingPlanes=r.clippingPlanes,u.clipIntersection=r.clipIntersection,u.displacementMap=r.displacementMap,u.displacementScale=r.displacementScale,u.displacementBias=r.displacementBias,u.wireframeLinewidth=r.wireframeLinewidth,u.linewidth=r.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=n,u.farDistance=s),u}function S(r,n,s,o,a){if(!1===r.visible)return;if(r.layers.test(n.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&a===d)&&(!r.frustumCulled||i.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,r.matrixWorld);const i=t.update(r),n=r.material;if(Array.isArray(n)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=n[c.materialIndex];if(u&&u.visible){const t=E(r,u,o,s.near,s.far,a);e.renderBufferDirect(s,null,i,t,r,c)}}}else if(n.visible){const t=E(r,n,o,s.near,s.far,a);e.renderBufferDirect(s,null,i,t,r,null)}}const l=r.children;for(let e=0,t=l.length;e<t;e++)S(l[e],n,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=p,this.render=function(t,r,a){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),h=e.state;h.setBlending(_),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(let f=0,g=t.length;f<g;f++){const l=t[f],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;n.copy(c.mapSize);const p=c.getFrameExtents();if(n.multiply(p),s.copy(c.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/p.x),n.x=s.x*p.x,c.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/p.y),n.y=s.y*p.y,c.mapSize.y=s.y)),null===c.map){const e=this.type!==d?{minFilter:pe,magFilter:pe}:{};c.map=new ei(n.x,n.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);o.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),h.viewport(o),c.updateMatrices(l,e),i=c.getFrustum(),S(r,a,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===d&&w(c,a),c.needsUpdate=!1}y.needsUpdate=!1,e.setRenderTarget(l,c,p)}}function Ka(e,t,r){const i=r.isWebGL2,n=new function(){let t=!1;const r=new $r;let i=null;const n=new $r(0,0,0,0);return{setMask:function(r){i===r||t||(e.colorMask(r,r,r,r),i=r)},setLocked:function(e){t=e},setClear:function(t,i,s,o,a){!0===a&&(t*=o,i*=o,s*=o),r.set(t,i,s,o),!1===n.equals(r)&&(e.clearColor(t,i,s,o),n.copy(r))},reset:function(){t=!1,i=null,n.set(-1,0,0,0)}}},s=new function(){let t=!1,r=null,i=null,n=null;return{setTest:function(e){e?be(2929):ye(2929)},setMask:function(i){r===i||t||(e.depthMask(i),r=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case N:e.depthFunc(512);break;case j:e.depthFunc(519);break;case G:e.depthFunc(513);break;case z:e.depthFunc(515);break;case V:e.depthFunc(514);break;case Q:e.depthFunc(518);break;case H:e.depthFunc(516);break;case W:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,r=null,i=null,n=null}}},c=new function(){let t=!1,r=null,i=null,n=null,s=null,o=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?be(2960):ye(2960))},setMask:function(i){r===i||t||(e.stencilMask(i),r=i)},setFunc:function(t,r,o){i===t&&n===r&&s===o||(e.stencilFunc(t,r,o),i=t,n=r,s=o)},setOp:function(t,r,i){o===t&&a===r&&l===i||(e.stencilOp(t,r,i),o=t,a=r,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,r=null,i=null,n=null,s=null,o=null,a=null,l=null,c=null}}},u=new WeakMap,p=new WeakMap;let h={},d={},f=new WeakMap,q=[],X=null,Y=!1,K=null,J=null,Z=null,$=null,ee=null,te=null,re=null,ie=!1,ne=null,se=null,oe=null,ae=null,le=null;const ce=e.getParameter(35661);let ue=!1,pe=0;const he=e.getParameter(7938);-1!==he.indexOf("WebGL")?(pe=parseFloat(/^WebGL (\d)/.exec(he)[1]),ue=pe>=1):-1!==he.indexOf("OpenGL ES")&&(pe=parseFloat(/^OpenGL ES (\d)/.exec(he)[1]),ue=pe>=2);let de=null,fe={};const ge=e.getParameter(3088),me=e.getParameter(2978),_e=(new $r).fromArray(ge),ve=(new $r).fromArray(me);function xe(t,r,i){const n=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let o=0;o<i;o++)e.texImage2D(r+o,0,6408,1,1,0,6408,5121,n);return s}const Ae={};function be(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function ye(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}Ae[3553]=xe(3553,3553,1),Ae[34067]=xe(34067,34069,6),n.setClear(0,0,0,1),s.setClear(1),c.setClear(0),be(2929),s.setFunc(z),Ce(!1),Me(a),be(2884),Se(_);const we={[w]:32774,[E]:32778,[S]:32779};if(i)we[C]=32775,we[M]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(we[C]=e.MIN_EXT,we[M]=e.MAX_EXT)}const Ee={[T]:0,[I]:1,[k]:768,[P]:770,[U]:776,[O]:774,[R]:772,[D]:769,[B]:771,[F]:775,[L]:773};function Se(t,r,i,n,s,o,a,l){if(t!==_){if(!1===Y&&(be(3042),Y=!0),t===y)s=s||r,o=o||i,a=a||n,r===J&&s===ee||(e.blendEquationSeparate(we[r],we[s]),J=r,ee=s),i===Z&&n===$&&o===te&&a===re||(e.blendFuncSeparate(Ee[i],Ee[n],Ee[o],Ee[a]),Z=i,$=n,te=o,re=a),K=t,ie=null;else if(t!==K||l!==ie){if(J===w&&ee===w||(e.blendEquation(32774),J=w,ee=w),l)switch(t){case v:e.blendFuncSeparate(1,771,1,771);break;case x:e.blendFunc(1,1);break;case A:e.blendFuncSeparate(0,769,0,1);break;case b:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case v:e.blendFuncSeparate(770,771,1,771);break;case x:e.blendFunc(770,1);break;case A:e.blendFuncSeparate(0,769,0,1);break;case b:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,$=null,te=null,re=null,K=t,ie=l}}else!0===Y&&(ye(3042),Y=!1)}function Ce(t){ne!==t&&(t?e.frontFace(2304):e.frontFace(2305),ne=t)}function Me(t){t!==o?(be(2884),t!==se&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):ye(2884),se=t}function Te(t,r,i){t?(be(32823),ae===r&&le===i||(e.polygonOffset(r,i),ae=r,le=i)):ye(32823)}function Ie(t){void 0===t&&(t=33984+ce-1),de!==t&&(e.activeTexture(t),de=t)}return{buffers:{color:n,depth:s,stencil:c},enable:be,disable:ye,bindFramebuffer:function(t,r){return d[t]!==r&&(e.bindFramebuffer(t,r),d[t]=r,i&&(36009===t&&(d[36160]=r),36160===t&&(d[36009]=r)),!0)},drawBuffers:function(i,n){let s=q,o=!1;if(i)if(void 0===(s=f.get(n))&&(s=[],f.set(n,s)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(s.length!==e.length||36064!==s[0]){for(let t=0,r=e.length;t<r;t++)s[t]=36064+t;s.length=e.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(r.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return X!==t&&(e.useProgram(t),X=t,!0)},setBlending:Se,setMaterial:function(e,t){e.side===m?ye(2884):be(2884);let r=e.side===g;t&&(r=!r),Ce(r),e.blending===v&&!1===e.transparent?Se(_):Se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),n.setMask(e.colorWrite);const i=e.stencilWrite;c.setTest(i),i&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Te(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?be(32926):ye(32926)},setFlipSided:Ce,setCullFace:Me,setLineWidth:function(t){t!==oe&&(ue&&e.lineWidth(t),oe=t)},setPolygonOffset:Te,setScissorTest:function(e){e?be(3089):ye(3089)},activeTexture:Ie,bindTexture:function(t,r){null===de&&Ie();let i=fe[de];void 0===i&&(i={type:void 0,texture:void 0},fe[de]=i),i.type===t&&i.texture===r||(e.bindTexture(t,r||Ae[t]),i.type=t,i.texture=r)},unbindTexture:function(){const t=fe[de];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,r){let i=p.get(r);void 0===i&&(i=new WeakMap,p.set(r,i));let n=i.get(t);void 0===n&&(n=e.getUniformBlockIndex(r,t.name),i.set(t,n))},uniformBlockBinding:function(t,r){const i=p.get(r).get(t);u.get(t)!==i&&(e.uniformBlockBinding(r,i,t.__bindingPointIndex),u.set(t,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===_e.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),_e.copy(t))},viewport:function(t){!1===ve.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ve.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},de=null,fe={},d={},f=new WeakMap,q=[],X=null,Y=!1,K=null,J=null,Z=null,$=null,ee=null,te=null,re=null,ie=!1,ne=null,se=null,oe=null,ae=null,le=null,_e.set(0,0,e.canvas.width,e.canvas.height),ve.set(0,0,e.canvas.width,e.canvas.height),n.reset(),s.reset(),c.reset()}}}function Ja(e,t,r,i,n,s,o){const a=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,p=n.maxSamples,h=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,d=/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let g;const m=new WeakMap;let _=!1;try{_="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return _?new OffscreenCanvas(e,t):Lr("canvas")}function x(e,t,r,i){let n=1;if((e.width>i||e.height>i)&&(n=i/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Cr:Math.floor,s=i(n*e.width),o=i(n*e.height);void 0===g&&(g=v(s,o));const a=r?v(s,o):g;return a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function A(e){return Er(e.width)&&Er(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==pe&&e.minFilter!==me}function y(t){e.generateMipmap(t)}function w(r,i,n,s,o=!1){if(!1===a)return i;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let l=i;return 6403===i&&(5126===n&&(l=33326),5131===n&&(l=33325),5121===n&&(l=33321)),33319===i&&(5126===n&&(l=33328),5131===n&&(l=33327),5121===n&&(l=33323)),6408===i&&(5126===n&&(l=34836),5131===n&&(l=34842),5121===n&&(l=s===Dt&&!1===o?35907:32856),32819===n&&(l=32854),32820===n&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||t.get("EXT_color_buffer_float"),l}function E(e,t,r){return!0===b(e,r)||e.isFramebufferTexture&&e.minFilter!==pe&&e.minFilter!==me?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){return e===pe||e===he||e===fe?9728:9729}function C(e){const t=e.target;t.removeEventListener("dispose",C),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const r=e.source,n=m.get(r);if(n){const i=n[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&T(e),0===Object.keys(n).length&&m.delete(r)}i.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function M(t){const r=t.target;r.removeEventListener("dispose",M),function(t){const r=t.texture,n=i.get(t),s=i.get(r);if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)e.deleteFramebuffer(n.__webglFramebuffer[i]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i]);else{if(e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let a=0,l=r.length;a<l;a++){const t=i.get(r[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),i.remove(r[a])}i.remove(r),i.remove(t)}(r)}function T(t){const r=i.get(t);e.deleteTexture(r.__webglTexture);const n=t.source;delete m.get(n)[r.__cacheKey],o.memory.textures--}let I=0;function k(e,t){const n=i.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&n.__version!==e.version){const r=e.image;if(null===r)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==r.complete)return void L(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,n.__webglTexture)}const D={[le]:10497,[ce]:33071,[ue]:33648},P={[pe]:9728,[he]:9984,[fe]:9986,[me]:9729,[_e]:9985,[xe]:9987};function B(r,s,o){if(o?(e.texParameteri(r,10242,D[s.wrapS]),e.texParameteri(r,10243,D[s.wrapT]),32879!==r&&35866!==r||e.texParameteri(r,32882,D[s.wrapR]),e.texParameteri(r,10240,P[s.magFilter]),e.texParameteri(r,10241,P[s.minFilter])):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),32879!==r&&35866!==r||e.texParameteri(r,32882,33071),s.wrapS===ce&&s.wrapT===ce||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,S(s.magFilter)),e.texParameteri(r,10241,S(s.minFilter)),s.minFilter!==pe&&s.minFilter!==me&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.type===Me&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===Te&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(r,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,n.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function R(t,r){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",C));const n=r.source;let s=m.get(n);void 0===s&&(s={},m.set(n,s));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(r);if(a!==t.__cacheKey){void 0===s[a]&&(s[a]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const n=s[t.__cacheKey];void 0!==n&&(s[t.__cacheKey].usedTimes--,0===n.usedTimes&&T(r)),t.__cacheKey=a,t.__webglTexture=s[a].texture}return i}function L(t,i,n){let o=3553;i.isDataArrayTexture&&(o=35866),i.isData3DTexture&&(o=32879);const l=R(t,i),c=i.source;if(r.activeTexture(33984+n),r.bindTexture(o,t.__webglTexture),c.version!==c.__currentVersion||!0===l){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!a&&(e.wrapS!==ce||e.wrapT!==ce||e.minFilter!==pe&&e.minFilter!==me)}(i)&&!1===A(i.image);let n=x(i.image,t,!1,u);const p=A(n=G(i,n))||a,h=s.convert(i.format,i.encoding);let d,f=s.convert(i.type),g=w(i.internalFormat,h,f,i.encoding,i.isVideoTexture);B(o,i,p);const m=i.mipmaps,_=a&&!0!==i.isVideoTexture,v=void 0===c.__currentVersion||!0===l,S=E(i,n,p);if(i.isDepthTexture)g=6402,a?g=i.type===Me?36012:i.type===Ce?33190:i.type===De?35056:33189:i.type===Me&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Fe&&6402===g&&i.type!==Ee&&i.type!==Ce&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Ce,f=s.convert(i.type)),i.format===Ue&&6402===g&&(g=34041,i.type!==De&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=De,f=s.convert(i.type))),v&&(_?r.texStorage2D(3553,1,g,n.width,n.height):r.texImage2D(3553,0,g,n.width,n.height,0,h,f,null));else if(i.isDataTexture)if(m.length>0&&p){_&&v&&r.texStorage2D(3553,S,g,m[0].width,m[0].height);for(let e=0,t=m.length;e<t;e++)d=m[e],_?r.texSubImage2D(3553,e,0,0,d.width,d.height,h,f,d.data):r.texImage2D(3553,e,g,d.width,d.height,0,h,f,d.data);i.generateMipmaps=!1}else _?(v&&r.texStorage2D(3553,S,g,n.width,n.height),r.texSubImage2D(3553,0,0,0,n.width,n.height,h,f,n.data)):r.texImage2D(3553,0,g,n.width,n.height,0,h,f,n.data);else if(i.isCompressedTexture){_&&v&&r.texStorage2D(3553,S,g,m[0].width,m[0].height);for(let e=0,t=m.length;e<t;e++)d=m[e],i.format!==Re?null!==h?_?r.compressedTexSubImage2D(3553,e,0,0,d.width,d.height,h,d.data):r.compressedTexImage2D(3553,e,g,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?r.texSubImage2D(3553,e,0,0,d.width,d.height,h,f,d.data):r.texImage2D(3553,e,g,d.width,d.height,0,h,f,d.data)}else if(i.isDataArrayTexture)_?(v&&r.texStorage3D(35866,S,g,n.width,n.height,n.depth),r.texSubImage3D(35866,0,0,0,0,n.width,n.height,n.depth,h,f,n.data)):r.texImage3D(35866,0,g,n.width,n.height,n.depth,0,h,f,n.data);else if(i.isData3DTexture)_?(v&&r.texStorage3D(32879,S,g,n.width,n.height,n.depth),r.texSubImage3D(32879,0,0,0,0,n.width,n.height,n.depth,h,f,n.data)):r.texImage3D(32879,0,g,n.width,n.height,n.depth,0,h,f,n.data);else if(i.isFramebufferTexture){if(v)if(_)r.texStorage2D(3553,S,g,n.width,n.height);else{let e=n.width,t=n.height;for(let i=0;i<S;i++)r.texImage2D(3553,i,g,e,t,0,h,f,null),e>>=1,t>>=1}}else if(m.length>0&&p){_&&v&&r.texStorage2D(3553,S,g,m[0].width,m[0].height);for(let e=0,t=m.length;e<t;e++)d=m[e],_?r.texSubImage2D(3553,e,0,0,h,f,d):r.texImage2D(3553,e,g,h,f,d);i.generateMipmaps=!1}else _?(v&&r.texStorage2D(3553,S,g,n.width,n.height),r.texSubImage2D(3553,0,0,0,h,f,n)):r.texImage2D(3553,0,g,h,f,n);b(i,p)&&y(o),c.__currentVersion=c.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function O(t,n,o,a,l){const c=s.convert(o.format,o.encoding),u=s.convert(o.type),p=w(o.internalFormat,c,u,o.encoding);i.get(n).__hasExternalTextures||(32879===l||35866===l?r.texImage3D(l,0,p,n.width,n.height,n.depth,0,c,u,null):r.texImage2D(l,0,p,n.width,n.height,0,c,u,null)),r.bindFramebuffer(36160,t),j(n)?h.framebufferTexture2DMultisampleEXT(36160,a,l,i.get(o).__webglTexture,0,N(n)):e.framebufferTexture2D(36160,a,l,i.get(o).__webglTexture,0),r.bindFramebuffer(36160,null)}function F(t,r,i){if(e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){let n=33189;if(i||j(r)){const t=r.depthTexture;t&&t.isDepthTexture&&(t.type===Me?n=36012:t.type===Ce&&(n=33190));const i=N(r);j(r)?h.renderbufferStorageMultisampleEXT(36161,i,n,r.width,r.height):e.renderbufferStorageMultisample(36161,i,n,r.width,r.height)}else e.renderbufferStorage(36161,n,r.width,r.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(r.depthBuffer&&r.stencilBuffer){const n=N(r);i&&!1===j(r)?e.renderbufferStorageMultisample(36161,n,35056,r.width,r.height):j(r)?h.renderbufferStorageMultisampleEXT(36161,n,35056,r.width,r.height):e.renderbufferStorage(36161,34041,r.width,r.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let n=0;n<t.length;n++){const o=t[n],a=s.convert(o.format,o.encoding),l=s.convert(o.type),c=w(o.internalFormat,a,l,o.encoding),u=N(r);i&&!1===j(r)?e.renderbufferStorageMultisample(36161,u,c,r.width,r.height):j(r)?h.renderbufferStorageMultisampleEXT(36161,u,c,r.width,r.height):e.renderbufferStorage(36161,c,r.width,r.height)}}e.bindRenderbuffer(36161,null)}function U(t){const n=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),k(n.depthTexture,0);const s=i.get(n.depthTexture).__webglTexture,o=N(n);if(n.depthTexture.format===Fe)j(n)?h.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):e.framebufferTexture2D(36160,36096,3553,s,0);else{if(n.depthTexture.format!==Ue)throw new Error("Unknown depthTexture format");j(n)?h.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):e.framebufferTexture2D(36160,33306,3553,s,0)}}(n.__webglFramebuffer,t)}else if(s){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)r.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=e.createRenderbuffer(),F(n.__webglDepthbuffer[i],t,!1)}else r.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),F(n.__webglDepthbuffer,t,!1);r.bindFramebuffer(36160,null)}function N(e){return Math.min(p,e.samples)}function j(e){const r=i.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==r.__useRenderToTexture}function G(e,r){const i=e.encoding,n=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===fr||i!==kt&&(i===Dt?!1===a?!0===t.has("EXT_sRGB")&&n===Re?(e.format=fr,e.minFilter=me,e.generateMipmaps=!1):r=Xr.sRGBToLinear(r):n===Re&&s===be||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):i===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),r}this.allocateTextureUnit=function(){const e=I;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),I+=1,e},this.resetTextureUnits=function(){I=0},this.setTexture2D=k,this.setTexture2DArray=function(e,t){const n=i.get(e);e.version>0&&n.__version!==e.version?L(n,e,t):(r.activeTexture(33984+t),r.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){const n=i.get(e);e.version>0&&n.__version!==e.version?L(n,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,n.__webglTexture))},this.setTextureCube=function(t,n){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,n){if(6!==i.image.length)return;const o=R(t,i),l=i.source;if(r.activeTexture(33984+n),r.bindTexture(34067,t.__webglTexture),l.version!==l.__currentVersion||!0===o){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const t=i.isCompressedTexture||i.image[0].isCompressedTexture,n=i.image[0]&&i.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=t||n?n?i.image[e].image:i.image[e]:x(i.image[e],!1,!0,c),u[e]=G(i,u[e]);const p=u[0],h=A(p)||a,d=s.convert(i.format,i.encoding),f=s.convert(i.type),g=w(i.internalFormat,d,f,i.encoding),m=a&&!0!==i.isVideoTexture,_=void 0===l.__currentVersion||!0===o;let v,S=E(i,p,h);if(B(34067,i,h),t){m&&_&&r.texStorage2D(34067,S,g,p.width,p.height);for(let e=0;e<6;e++){v=u[e].mipmaps;for(let t=0;t<v.length;t++){const n=v[t];i.format!==Re?null!==d?m?r.compressedTexSubImage2D(34069+e,t,0,0,n.width,n.height,d,n.data):r.compressedTexImage2D(34069+e,t,g,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):m?r.texSubImage2D(34069+e,t,0,0,n.width,n.height,d,f,n.data):r.texImage2D(34069+e,t,g,n.width,n.height,0,d,f,n.data)}}}else{v=i.mipmaps,m&&_&&(v.length>0&&S++,r.texStorage2D(34067,S,g,u[0].width,u[0].height));for(let e=0;e<6;e++)if(n){m?r.texSubImage2D(34069+e,0,0,0,u[e].width,u[e].height,d,f,u[e].data):r.texImage2D(34069+e,0,g,u[e].width,u[e].height,0,d,f,u[e].data);for(let t=0;t<v.length;t++){const i=v[t].image[e].image;m?r.texSubImage2D(34069+e,t+1,0,0,i.width,i.height,d,f,i.data):r.texImage2D(34069+e,t+1,g,i.width,i.height,0,d,f,i.data)}}else{m?r.texSubImage2D(34069+e,0,0,0,d,f,u[e]):r.texImage2D(34069+e,0,g,d,f,u[e]);for(let t=0;t<v.length;t++){const i=v[t];m?r.texSubImage2D(34069+e,t+1,0,0,d,f,i.image[e]):r.texImage2D(34069+e,t+1,g,d,f,i.image[e])}}}b(i,h)&&y(34067),l.__currentVersion=l.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(o,t,n):(r.activeTexture(33984+n),r.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(e,t,r){const n=i.get(e);void 0!==t&&O(n.__webglFramebuffer,e,e.texture,36064,3553),void 0!==r&&U(e)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),u=i.get(l);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,o.memory.textures++);const p=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,d=A(t)||a;if(p){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),h)if(n.drawBuffers){const r=t.texture;for(let t=0,n=r.length;t<n;t++){const n=i.get(r[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===j(t)){const i=h?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],r.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let r=0;r<i.length;r++){const n=i[r];c.__webglColorRenderbuffer[r]=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer[r]);const o=s.convert(n.format,n.encoding),a=s.convert(n.type),l=w(n.internalFormat,o,a,n.encoding),u=N(t);e.renderbufferStorageMultisample(36161,u,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+r,36161,c.__webglColorRenderbuffer[r])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),F(c.__webglDepthRenderbuffer,t,!0)),r.bindFramebuffer(36160,null)}}if(p){r.bindTexture(34067,u.__webglTexture),B(34067,l,d);for(let e=0;e<6;e++)O(c.__webglFramebuffer[e],t,l,36064,34069+e);b(l,d)&&y(34067),r.unbindTexture()}else if(h){const e=t.texture;for(let n=0,s=e.length;n<s;n++){const s=e[n],o=i.get(s);r.bindTexture(3553,o.__webglTexture),B(3553,s,d),O(c.__webglFramebuffer,t,s,36064+n,3553),b(s,d)&&y(3553)}r.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),r.bindTexture(e,u.__webglTexture),B(e,l,d),O(c.__webglFramebuffer,t,l,36064,e),b(l,d)&&y(e),r.unbindTexture()}t.depthBuffer&&U(t)},this.updateRenderTargetMipmap=function(e){const t=A(e)||a,n=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.isWebGLCubeRenderTarget?34067:3553;for(let o=0,a=n.length;o<a;o++){const e=n[o],a=i.get(e),l=a.__webglTexture;a.__version!==e.version&&(r.bindTexture(s,l),B(s,e,t),r.unbindTexture(),a.__version=e.version),b(e,t)&&(r.bindTexture(s,l),y(s),r.unbindTexture())}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===j(t)){const n=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,o=t.height;let a=16384;const l=[],c=t.stencilBuffer?33306:36096,u=i.get(t),p=!0===t.isWebGLMultipleRenderTargets;if(p)for(let t=0;t<n.length;t++)r.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),r.bindFramebuffer(36160,u.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);r.bindFramebuffer(36008,u.__webglMultisampledFramebuffer),r.bindFramebuffer(36009,u.__webglFramebuffer);for(let r=0;r<n.length;r++){l.push(36064+r),t.depthBuffer&&l.push(c);const h=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===h&&(t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024)),p&&e.framebufferRenderbuffer(36008,36064,36161,u.__webglColorRenderbuffer[r]),!0===h&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),p){const t=i.get(n[r]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,s,o,0,0,s,o,a,9728),d&&e.invalidateFramebuffer(36008,l)}if(r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),p)for(let t=0;t<n.length;t++){r.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,u.__webglColorRenderbuffer[t]);const s=i.get(n[t]).__webglTexture;r.bindFramebuffer(36160,u.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,s,0)}r.bindFramebuffer(36009,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=O,this.useMultisampledRTT=j}function Za(e,t,r){const i=r.isWebGL2;return{convert:function(r,n=null){let s;if(r===be)return 5121;if(r===Ie)return 32819;if(r===ke)return 32820;if(r===ye)return 5120;if(r===we)return 5122;if(r===Ee)return 5123;if(r===Se)return 5124;if(r===Ce)return 5125;if(r===Me)return 5126;if(r===Te)return i?5131:null!==(s=t.get("OES_texture_half_float"))?s.HALF_FLOAT_OES:null;if(r===Pe)return 6406;if(r===Re)return 6408;if(r===Le)return 6409;if(r===Oe)return 6410;if(r===Fe)return 6402;if(r===Ue)return 34041;if(r===Ne)return 6403;if(r===Be)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===fr)return null!==(s=t.get("EXT_sRGB"))?s.SRGB_ALPHA_EXT:null;if(r===je)return 36244;if(r===Ge)return 33319;if(r===ze)return 33320;if(r===Ve)return 36249;if(r===Qe||r===He||r===We||r===qe)if(n===Dt){if(null===(s=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(r===Qe)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===He)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===We)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===qe)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(s=t.get("WEBGL_compressed_texture_s3tc")))return null;if(r===Qe)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===He)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===We)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===qe)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(r===Xe||r===Ye||r===Ke||r===Je){if(null===(s=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(r===Xe)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Ye)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Ke)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Je)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===Ze)return null!==(s=t.get("WEBGL_compressed_texture_etc1"))?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===$e||r===et){if(null===(s=t.get("WEBGL_compressed_texture_etc")))return null;if(r===$e)return n===Dt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===et)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(r===tt||r===rt||r===it||r===nt||r===st||r===ot||r===at||r===lt||r===ct||r===ut||r===pt||r===ht||r===dt||r===ft){if(null===(s=t.get("WEBGL_compressed_texture_astc")))return null;if(r===tt)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===rt)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===it)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===nt)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===st)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===ot)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===at)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===lt)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===ct)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===ut)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===pt)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===ht)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===dt)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===ft)return n===Dt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(r===gt){if(null===(s=t.get("EXT_texture_compression_bptc")))return null;if(r===gt)return n===Dt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return r===De?i?34042:null!==(s=t.get("WEBGL_depth_texture"))?s.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[r]?e[r]:null}}}class $a extends _s{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class el extends un{constructor(){super(),this.isGroup=!0,this.type="Group"}}const tl={type:"move"};class rl{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new el,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new el,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ai,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ai),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new el,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ai,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ai),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,n=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const s of e.hand.values()){const e=t.getJointPose(s,r);if(void 0===l.joints[s.jointName]){const e=new el;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[s.jointName]=e,l.add(e)}const i=l.joints[s.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],n=l.joints["thumb-tip"],o=i.position.distanceTo(n.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(null!==(n=t.getPose(e.gripSpace,r))&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(null===(i=t.getPose(e.targetRaySpace,r))&&null!==n&&(i=n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(tl)))}return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==n),null!==l&&(l.visible=null!==s),this}}class il extends Zr{constructor(e,t,r,i,n,s,o,a,l,c){if((c=void 0!==c?c:Fe)!==Fe&&c!==Ue)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===Fe&&(r=Ce),void 0===r&&c===Ue&&(r=De),super(null,i,n,s,o,a,c,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:pe,this.minFilter=void 0!==a?a:pe,this.flipY=!1,this.generateMipmaps=!1}}class nl extends gr{constructor(e,t){super();const r=this;let i=null,n=1,s=null,o="local-floor",a=null,l=null,c=null,u=null,p=null,h=null;const d=t.getContextAttributes();let f=null,g=null;const m=[],_=[],v=new _s;v.layers.enable(1),v.viewport=new $r;const x=new _s;x.layers.enable(2),x.viewport=new $r;const A=[v,x],b=new $a;b.layers.enable(1),b.layers.enable(2);let y=null,w=null;function E(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const r=m[t];void 0!==r&&r.dispatchEvent({type:e.type,data:e.inputSource})}function S(){i.removeEventListener("select",E),i.removeEventListener("selectstart",E),i.removeEventListener("selectend",E),i.removeEventListener("squeeze",E),i.removeEventListener("squeezestart",E),i.removeEventListener("squeezeend",E),i.removeEventListener("end",S),i.removeEventListener("inputsourceschange",C);for(let e=0;e<m.length;e++){const t=_[e];null!==t&&(_[e]=null,m[e].disconnect(t))}y=null,w=null,e.setRenderTarget(f),p=null,u=null,c=null,i=null,g=null,D.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function C(e){for(let t=0;t<e.removed.length;t++){const r=e.removed[t],i=_.indexOf(r);i>=0&&(_[i]=null,m[i].dispatchEvent({type:"disconnected",data:r}))}for(let t=0;t<e.added.length;t++){const r=e.added[t];let i=_.indexOf(r);if(-1===i){for(let e=0;e<m.length;e++){if(e>=_.length){_.push(r),i=e;break}if(null===_[e]){_[e]=r,i=e;break}}if(-1===i)break}const n=m[i];n&&n.dispatchEvent({type:"connected",data:r})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=m[e];return void 0===t&&(t=new rl,m[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=m[e];return void 0===t&&(t=new rl,m[e]=t),t.getGripSpace()},this.getHand=function(e){let t=m[e];return void 0===t&&(t=new rl,m[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a||s},this.setReferenceSpace=function(e){a=e},this.getBaseLayer=function(){return null!==u?u:p},this.getBinding=function(){return c},this.getFrame=function(){return h},this.getSession=function(){return i},this.setSession=async function(l){if(null!==(i=l)){if(f=e.getRenderTarget(),i.addEventListener("select",E),i.addEventListener("selectstart",E),i.addEventListener("selectend",E),i.addEventListener("squeeze",E),i.addEventListener("squeezestart",E),i.addEventListener("squeezeend",E),i.addEventListener("end",S),i.addEventListener("inputsourceschange",C),!0!==d.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const r={antialias:void 0!==i.renderState.layers||d.antialias,alpha:d.alpha,depth:d.depth,stencil:d.stencil,framebufferScaleFactor:n};p=new XRWebGLLayer(i,t,r),i.updateRenderState({baseLayer:p}),g=new ei(p.framebufferWidth,p.framebufferHeight,{format:Re,type:be,encoding:e.outputEncoding,stencilBuffer:d.stencil})}else{let r=null,s=null,o=null;d.depth&&(o=d.stencil?35056:33190,r=d.stencil?Ue:Fe,s=d.stencil?De:Ce);const a={colorFormat:32856,depthFormat:o,scaleFactor:n};c=new XRWebGLBinding(i,t),u=c.createProjectionLayer(a),i.updateRenderState({layers:[u]}),g=new ei(u.textureWidth,u.textureHeight,{format:Re,type:be,depthTexture:new il(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,r),stencilBuffer:d.stencil,encoding:e.outputEncoding,samples:d.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),a=null,s=await i.requestReferenceSpace(o),D.setContext(i),D.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};const M=new ai,T=new ai;function I(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;b.near=x.near=v.near=e.near,b.far=x.far=v.far=e.far,y===b.near&&w===b.far||(i.updateRenderState({depthNear:b.near,depthFar:b.far}),y=b.near,w=b.far);const t=e.parent,r=b.cameras;I(b,t);for(let i=0;i<r.length;i++)I(r[i],t);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),e.matrix.copy(b.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const n=e.children;for(let i=0,s=n.length;i<s;i++)n[i].updateMatrixWorld(!0);2===r.length?function(e,t,r){M.setFromMatrixPosition(t.matrixWorld),T.setFromMatrixPosition(r.matrixWorld);const i=M.distanceTo(T),n=t.projectionMatrix.elements,s=r.projectionMatrix.elements,o=n[14]/(n[10]-1),a=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],u=(n[8]-1)/n[0],p=(s[8]+1)/s[0],h=o*u,d=o*p,f=i/(-u+p),g=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(g),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const m=o+f,_=a+f,v=h-g,x=d+(i-g),A=l*a/_*m,b=c*a/_*m;e.projectionMatrix.makePerspective(v,x,A,b,m,_)}(b,v,x):b.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==p?p.fixedFoveation:void 0},this.setFoveation=function(e){null!==u&&(u.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)};let k=null;this.onPreAnimationFrameCallback=null;const D=new Is;D.setAnimationLoop(function(t,i){if(r.onPreAnimationFrameCallback&&r.onPreAnimationFrameCallback(t,i),l=i.getViewerPose(a||s),h=i,null!==l){const t=l.views;null!==p&&(e.setRenderTargetFramebuffer(g,p.framebuffer),e.setRenderTarget(g));let r=!1;t.length!==b.cameras.length&&(b.cameras.length=0,r=!0);for(let i=0;i<t.length;i++){const n=t[i];let s=null;if(null!==p)s=p.getViewport(n);else{const t=c.getViewSubImage(u,n);s=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let o=A[i];void 0===o&&((o=new _s).layers.enable(i),o.viewport=new $r,A[i]=o),o.matrix.fromArray(n.transform.matrix),o.projectionMatrix.fromArray(n.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&b.matrix.copy(o.matrix),!0===r&&b.cameras.push(o)}}for(let e=0;e<m.length;e++){const t=_[e],r=m[e];null!==t&&void 0!==r&&r.update(t,i,a||s)}k&&k(t,i),h=null}),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function sl(e,t){function r(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map),i.alphaMap&&(r.alphaMap.value=i.alphaMap),i.bumpMap&&(r.bumpMap.value=i.bumpMap,r.bumpScale.value=i.bumpScale,i.side===g&&(r.bumpScale.value*=-1)),i.displacementMap&&(r.displacementMap.value=i.displacementMap,r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap),i.normalMap&&(r.normalMap.value=i.normalMap,r.normalScale.value.copy(i.normalScale),i.side===g&&r.normalScale.value.negate()),i.specularMap&&(r.specularMap.value=i.specularMap),i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const n=t.get(i).envMap;if(n){r.envMap.value=n;const e=t.get(i).environment||n;r.envMapRotation.value=e?e.rotation:0,r.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio}if(i.lightMap){r.lightMap.value=i.lightMap;const t=!0!==e.physicallyCorrectLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*t}let s,o;i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap?s=i.clearcoatRoughnessMap:i.iridescenceMap?s=i.iridescenceMap:i.iridescenceThicknessMap?s=i.iridescenceThicknessMap:i.specularIntensityMap?s=i.specularIntensityMap:i.specularColorMap?s=i.specularColorMap:i.transmissionMap?s=i.transmissionMap:i.thicknessMap?s=i.thicknessMap:i.sheenColorMap?s=i.sheenColorMap:i.sheenRoughnessMap&&(s=i.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),r.uvTransform.value.copy(s.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),r.uv2Transform.value.copy(o.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,n,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,r){e.roughness.value=r.roughness,e.metalness.value=r.metalness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap),r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap),t.get(r).envMap&&(e.envMapIntensity.value=r.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===g&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap)),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i,n,s):i.isSpriteMaterial?function(e,t){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(void 0!==i.transmission&&(e.transmission&&(e.transmission.value=i.transmission),e.transmissionSamplerMap&&o&&(e.transmissionSamplerMap.value=o?o.texture:null),e.transmissionSamplerSize&&o&&e.transmissionSamplerSize.value.set(o.width,o.height)),i.uniformsNeedUpdate=!1)}}}function ol(e,t,r,i){let n={},s={},o=[];const a=r.isWebGL2?e.getParameter(35375):0;function l(e,t,r){const i=e.value;if(void 0===r[t])return r[t]="number"==typeof i?i:i.clone(),!0;if("number"==typeof i){if(r[t]!==i)return r[t]=i,!0}else{const e=r[t];if(!1===e.equals(i))return e.copy(i),!0}return!1}function c(e){const t=e.value,r={boundary:0,storage:0};return"number"==typeof t?(r.boundary=4,r.storage=4):t.isVector2?(r.boundary=8,r.storage=8):t.isVector3||t.isColor?(r.boundary=16,r.storage=12):t.isVector4?(r.boundary=16,r.storage=16):t.isMatrix3?(r.boundary=48,r.storage=48):t.isMatrix4?(r.boundary=64,r.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),r}function u(t){const r=t.target;r.removeEventListener("dispose",u);const i=o.indexOf(r.__bindingPointIndex);o.splice(i,1),e.deleteBuffer(n[r.id]),delete n[r.id],delete s[r.id]}return{bind:function(e,t){const r=t.program;i.uniformBlockBinding(e,r)},update:function(r,p){let h=n[r.id];void 0===h&&(function(e){const t=e.uniforms;let r=0,i=0;for(let n=0,s=t.length;n<s;n++){const e=t[n],s=c(e);if(e.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=r,n>0){const t=16-(i=r%16);0!==i&&t-s.boundary<0&&(r+=16-i,e.__offset=r)}r+=s.storage}(i=r%16)>0&&(r+=16-i),e.__size=r,e.__cache={}}(r),h=function(t){const r=function(){for(let e=0;e<a;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=r;const i=e.createBuffer(),n=t.__size,s=t.usage;return e.bindBuffer(35345,i),e.bufferData(35345,n,s),e.bindBuffer(35345,null),e.bindBufferBase(35345,r,i),i}(r),n[r.id]=h,r.addEventListener("dispose",u));const d=p.program;i.updateUBOMapping(r,d);const f=t.render.frame;s[r.id]!==f&&(function(t){const r=n[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(35345,r);for(let n=0,o=i.length;n<o;n++){const t=i[n];if(!0===l(t,n,s)){const r=t.value,i=t.__offset;"number"==typeof r?(t.__data[0]=r,e.bufferSubData(35345,i,t.__data)):(t.value.isMatrix3?(t.__data[0]=t.value.elements[0],t.__data[1]=t.value.elements[1],t.__data[2]=t.value.elements[2],t.__data[3]=t.value.elements[0],t.__data[4]=t.value.elements[3],t.__data[5]=t.value.elements[4],t.__data[6]=t.value.elements[5],t.__data[7]=t.value.elements[0],t.__data[8]=t.value.elements[6],t.__data[9]=t.value.elements[7],t.__data[10]=t.value.elements[8],t.__data[11]=t.value.elements[0]):r.toArray(t.__data),e.bufferSubData(35345,i,t.__data))}}e.bindBuffer(35345,null)}(r),s[r.id]=f)},dispose:function(){for(const t in n)e.deleteBuffer(n[t]);o=[],n={},s={}}}}function al(e={}){this.isWebGLRenderer=!0;const t=void 0!==e.canvas?e.canvas:function(){const e=Lr("canvas");return e.style.display="block",e}(),r=void 0!==e.context?e.context:null,n=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let p;p=null!==r?r.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let h=null,d=null;const _=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=kt,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const x=this;let A=!1,b=0,y=0,w=null,E=-1,S=null;const C=new $r,M=new $r;let T=null,I=t.width,k=t.height,D=1,P=null,B=null;const R=new $r(0,0,I,k),L=new $r(0,0,I,k);let O=!1;const F=new Ts;let U=!1,N=!1,j=null;const G=new Ui,z=new kr,V=new ai,Q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===w?D:1}let W,q,X,Y,J,Z,$,ee,te,re,ie,ne,se,oe,ae,le,ce,ue,pe,he,de,fe,ge,me,_e=r;function ve(e,r){for(let i=0;i<e.length;i++){const n=e[i],s=t.getContext(n,r);if(null!==s)return s}return null}try{const r={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${i}`),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Ee,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===_e){const e=["webgl2","webgl","experimental-webgl"];if(!0===x.isWebGL1Renderer&&e.shift(),null===(_e=ve(e,r)))throw ve(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Ae(){W=new to(_e),q=new Us(_e,W,e),W.init(q),fe=new Za(_e,W,q),X=new Ka(_e,W,q),Y=new no,J=new Oa,Z=new Ja(_e,W,X,J,q,fe,Y),$=new js(x),ee=new eo(x),te=new ks(_e,q),ge=new Os(_e,W,te,q),re=new ro(_e,te,Y,ge),ie=new lo(_e,re,te,Y),pe=new ao(_e,q,Z),le=new Ns(J),ne=new La(x,$,ee,W,q,ge,le),se=new sl(x,J),oe=new ja,ae=new Wa(W,q),ue=new Ls(x,$,X,ie,p,a),ce=new Ya(x,ie,q),me=new ol(_e,Y,q,X),he=new Fs(_e,W,Y,q),de=new io(_e,W,Y,q),Y.programs=ne.programs,x.capabilities=q,x.extensions=W,x.properties=J,x.renderLists=oe,x.shadowMap=ce,x.state=X,x.info=Y,x.background=ue,x.cubeuvmaps=ee}Ae();const ye=new nl(x,_e);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function Ee(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const e=Y.autoReset,t=ce.enabled,r=ce.autoUpdate,i=ce.needsUpdate,n=ce.type;Ae(),Y.autoReset=e,ce.enabled=t,ce.autoUpdate=r,ce.needsUpdate=i,ce.type=n}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ce(e){const t=e.target;t.removeEventListener("dispose",Ce),function(e){(function(e){const t=J.get(e).programs;void 0!==t&&(t.forEach(function(e){ne.releaseProgram(e)}),e.isShaderMaterial&&ne.releaseShaderCache(e))})(e),J.remove(e)}(t)}this.xr=ye,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(e){void 0!==e&&(D=e,this.setSize(I,k,!1))},this.getSize=function(e){return e.set(I,k)},this.setSize=function(e,r,i){ye.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(I=e,k=r,t.width=Math.floor(e*D),t.height=Math.floor(r*D),!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return e.set(I*D,k*D).floor()},this.setDrawingBufferSize=function(e,r,i){I=e,k=r,D=i,t.width=Math.floor(e*i),t.height=Math.floor(r*i),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(R)},this.setViewport=function(e,t,r,i){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,r,i),X.viewport(C.copy(R).multiplyScalar(D).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,r,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,r,i),X.scissor(M.copy(L).multiplyScalar(D).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(e){X.setScissorTest(O=e)},this.setOpaqueSort=function(e){P=e},this.setTransparentSort=function(e){B=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,r=!0){let i=0;e&&(i|=16384),t&&(i|=256),r&&(i|=1024),_e.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Ee,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),oe.dispose(),ae.dispose(),J.dispose(),$.dispose(),ee.dispose(),ie.dispose(),ge.dispose(),me.dispose(),ne.dispose(),ye.dispose(),ye.removeEventListener("sessionstart",ke),ye.removeEventListener("sessionend",De),j&&(j.dispose(),j=null),Pe.stop()},this.renderBufferDirect=function(e,t,r,i,n,s){null===t&&(t=Q);const o=n.isMesh&&n.matrixWorld.determinant()<0,a=function(e,t,r,i,n){!0!==t.isScene&&(t=Q),Z.resetTextureUnits();const s=t.fog,o=i.isMeshStandardMaterial?t.environment:null,a=null===w?x.outputEncoding:!0===w.isXRRenderTarget||w.texture.encoding&&w.texture.encoding!==Dt?w.texture.encoding:kt,l=(i.isMeshStandardMaterial?ee:$).get(i.envMap||o),c=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,u=!!i.normalMap&&!!r.attributes.tangent,p=!!r.morphAttributes.position,h=!!r.morphAttributes.normal,f=!!r.morphAttributes.color,g=i.toneMapped?x.toneMapping:K,m=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,_=void 0!==m?m.length:0,v=J.get(i),A=d.state.lights;if(!0===U&&(!0===N||e!==S)){const t=e===S&&i.id===E;le.setState(i,e,t)}let b=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==A.state.version||v.outputEncoding!==a||n.isInstancedMesh&&!1===v.instancing?b=!0:n.isInstancedMesh||!0!==v.instancing?n.isSkinnedMesh&&!1===v.skinning?b=!0:n.isSkinnedMesh||!0!==v.skinning?v.envMap!==l||!0===i.fog&&v.fog!==s?b=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===le.numPlanes&&v.numIntersection===le.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==p||v.morphNormals!==h||v.morphColors!==f||v.toneMapping!==g||!0===q.isWebGL2&&v.morphTargetsCount!==_)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,v.__version=i.version);let y=v.currentProgram;!0===b&&(y=Fe(i,t,n));let C=!1,M=!1,T=!1;const I=y.getUniforms(),P=v.uniforms;if(X.useProgram(y.program)&&(C=!0,M=!0,T=!0),i.id!==E&&(E=i.id,M=!0),C||S!==e){if(I.setValue(_e,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&I.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),S!==e&&(S=e,M=!0,T=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=I.map.cameraPosition;void 0!==t&&t.setValue(_e,V.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&I.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&I.setValue(_e,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){I.setOptional(_e,n,"bindMatrix"),I.setOptional(_e,n,"bindMatrixInverse");const e=n.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),I.setValue(_e,"boneTexture",e.boneTexture,Z),I.setValue(_e,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const B=r.morphAttributes;var R,L;(void 0!==B.position||void 0!==B.normal||void 0!==B.color&&!0===q.isWebGL2)&&pe.update(n,r,i,y),(M||v.receiveShadow!==n.receiveShadow)&&(v.receiveShadow=n.receiveShadow,I.setValue(_e,"receiveShadow",n.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),M&&(I.setValue(_e,"toneMappingExposure",x.toneMappingExposure),v.needsLights&&(L=T,(R=P).ambientLightColor.needsUpdate=L,R.lightProbe.needsUpdate=L,R.directionalLights.needsUpdate=L,R.directionalLightShadows.needsUpdate=L,R.pointLights.needsUpdate=L,R.pointLightShadows.needsUpdate=L,R.spotLights.needsUpdate=L,R.spotLightShadows.needsUpdate=L,R.rectAreaLights.needsUpdate=L,R.hemisphereLights.needsUpdate=L),s&&!0===i.fog&&se.refreshFogUniforms(P,s),se.refreshMaterialUniforms(P,i,D,k,x.userData.transmissionRenderTarget||j),da.upload(_e,v.uniformsList,P,Z)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(da.upload(_e,v.uniformsList,P,Z),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&I.setValue(_e,"center",n.center),I.setValue(_e,"modelViewMatrix",n.modelViewMatrix),I.setValue(_e,"normalMatrix",n.normalMatrix),I.setValue(_e,"modelMatrix",n.matrixWorld);const O=i.extraUniformsToUpload;if(O&&Object.entries(O).forEach(([e,t])=>I.setValue(_e,e,t.value,Z)),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,r=e.length;t<r;t++)if(q.isWebGL2){const r=e[t];me.update(r,y),me.bind(r,y)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return y}(e,t,r,i,n);X.setMaterial(i,o);let l=r.index;const c=r.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,p=1;!0===i.wireframe&&(l=re.getWireframeAttribute(r),p=2),ge.setup(n,i,a,r,l);let h=he;null!==l&&(u=te.get(l),(h=de).setIndex(u));const f=null!==l?l.count:c.count,g=r.drawRange.start*p,m=r.drawRange.count*p,_=null!==s?s.start*p:0,v=null!==s?s.count*p:1/0,A=Math.max(g,_),b=Math.min(f,g+m,_+v)-1,y=Math.max(0,b-A+1);if(0!==y){if(n.isMesh)!0===i.wireframe?(X.setLineWidth(i.wireframeLinewidth*H()),h.setMode(1)):h.setMode(4);else if(n.isLine){let e=i.linewidth;void 0===e&&(e=1),X.setLineWidth(e*H()),n.isLineSegments?h.setMode(1):n.isLineLoop?h.setMode(2):h.setMode(3)}else n.isPoints?h.setMode(0):n.isSprite&&h.setMode(4);if(n.isInstancedMesh)h.renderInstances(A,y,n.count);else if(r.isInstancedBufferGeometry){const e=Math.min(r.instanceCount,r._maxInstanceCount);h.renderInstances(A,y,e)}else h.render(A,y)}},this.compile=function(e,t){function r(e,t,r){!0===e.transparent&&e.side===m?(e.side=g,e.needsUpdate=!0,Fe(e,t,r),e.side=f,e.needsUpdate=!0,Fe(e,t,r),e.side=m):Fe(e,t,r)}(d=ae.get(e)).init(),v.push(d),e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))}),d.setupLights(x.physicallyCorrectLights),e.traverse(function(t){const i=t.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++)r(i[n],e,t);else r(i,e,t)}),v.pop(),d=null};let Ie=null;function ke(){Pe.stop()}function De(){Pe.start()}const Pe=new Is;function Be(e,t,r,i){const n=e.opaque,s=e.transmissive,a=e.transparent;if(d.setupLightsView(r),void 0===x.userData.transmissionRender&&!1!==x.userData.renderTransmissionPass&&s.length>0&&function(e,t,r){console.error("three.js internal render transmission pass should not be called");const i=q.isWebGL2;null===j&&(j=new ei(1,1,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?Te:be,minFilter:xe,samples:i&&!0===o?4:0})),x.getDrawingBufferSize(z),i?j.setSize(z.x,z.y):j.setSize(Cr(z.x),Cr(z.y));const n=x.getRenderTarget();x.setRenderTarget(j),x.clear();const s=x.toneMapping;x.toneMapping=K,Le(e,t,r),x.toneMapping=s,Z.updateMultisampleRenderTarget(j),Z.updateRenderTargetMipmap(j),x.setRenderTarget(n)}([...n,...a],t,r),i&&X.viewport(C.copy(i)),!1!==x.userData.opaqueRender&&n.length>0&&Le(n,t,r),!1!==x.userData.transparentRender&&a.length>0&&Le(a,t,r),!1!==x.userData.transmissionRender&&s.length>0){j||(j=new ei(1,1));const e=x.userData.transmissionRenderTarget.texture,i=q.isWebGL2,n=e.generateMipmaps,o=e.minFilter;i&&x.userData.blurTransmissionTarget&&(e.generateMipmaps=!0,e.minFilter=xe,e.needsUpdate=!0,Z.updateRenderTargetMipmap(x.userData.transmissionRenderTarget)),Le(s,t,r),i&&x.userData.blurTransmissionTarget&&(e.generateMipmaps=n,e.minFilter=o,e.needsUpdate=!0,Z.updateRenderTargetMipmap(x.userData.transmissionRenderTarget))}X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1)}function Le(e,t,r){const i={...x.userData};x.userData.opaqueRender=void 0,x.userData.transparentRender=void 0,x.userData.transmissionRender=void 0,x.userData.backgroundRender=void 0;const n=!0===t.isScene?t.overrideMaterial:null;for(let s=0,o=e.length;s<o;s++){const i=e[s],o=i.object,a=i.geometry,l=null===n?i.material:n,c=i.group;o.layers.test(r.layers)&&Oe(o,t,r,a,l,c)}Object.assign(x.userData,i)}function Oe(e,t,r,i,n,s){e.onBeforeRender(x,t,r,i,n,s),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(x,t,r,i,e,s),!0===n.transparent&&n.side===m?(n.side=g,n.needsUpdate=!0,x.renderBufferDirect(r,t,i,n,e,s),n.side=f,n.needsUpdate=!0,x.renderBufferDirect(r,t,i,n,e,s),n.side=m):x.renderBufferDirect(r,t,i,n,e,s),e.onAfterRender(x,t,r,i,n,s),n.onAfterRender(x,t,r,i,e,s)}function Fe(e,t,r){!0!==t.isScene&&(t=Q);const i=J.get(e),n=d.state.lights,s=d.state.shadowsArray,o=n.state.version,a=ne.getParameters(e,n.state,s,t,r),l=ne.getProgramCacheKey(a);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ee:$).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Ce),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Ue(e,a),u}else a.uniforms=ne.getUniforms(e),e.onBuild(r,a,x),e.onBeforeCompile(a,x),u=ne.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const p=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(p.clippingPlanes=le.uniform),Ue(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(p.ambientLightColor.value=n.state.ambient,p.lightProbe.value=n.state.probe,p.directionalLights.value=n.state.directional,p.directionalLightShadows.value=n.state.directionalShadow,p.spotLights.value=n.state.spot,p.spotLightShadows.value=n.state.spotShadow,p.rectAreaLights.value=n.state.rectArea,p.ltc_1.value=n.state.rectAreaLTC1,p.ltc_2.value=n.state.rectAreaLTC2,p.pointLights.value=n.state.point,p.pointLightShadows.value=n.state.pointShadow,p.hemisphereLights.value=n.state.hemi,p.directionalShadowMap.value=n.state.directionalShadowMap,p.directionalShadowMatrix.value=n.state.directionalShadowMatrix,p.spotShadowMap.value=n.state.spotShadowMap,p.spotLightMatrix.value=n.state.spotLightMatrix,p.spotLightMap.value=n.state.spotLightMap,p.pointShadowMap.value=n.state.pointShadowMap,p.pointShadowMatrix.value=n.state.pointShadowMatrix);const h=u.getUniforms(),f=da.seqWithValue(h.seq,p);return i.currentProgram=u,i.uniformsList=f,u}function Ue(e,t){const r=J.get(e);r.outputEncoding=t.outputEncoding,r.instancing=t.instancing,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphColors=t.morphColors,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents,r.toneMapping=t.toneMapping}Pe.setAnimationLoop(function(e){Ie&&Ie(e)}),"undefined"!=typeof self&&Pe.setContext(self),this.setAnimationLoop=function(e){Ie=e,ye.setAnimationLoop(e),null===e?Pe.stop():Pe.start()},ye.addEventListener("sessionstart",ke),ye.addEventListener("sessionend",De),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==A){if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===ye.enabled&&!0===ye.isPresenting&&(!0===ye.cameraAutoUpdate&&ye.updateCamera(t),t=ye.getCamera()),!0===e.isScene&&e.onBeforeRender(x,e,t,w),(d=ae.get(e,v.length)).init(),v.push(d),G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),F.setFromProjectionMatrix(G),N=this.localClippingEnabled,U=le.init(this.clippingPlanes,N,t),(h=oe.get(e,_.length)).init(),_.push(h),function e(t,r,i,n){if(!1===t.visible)return;if(t.layers.test(r.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(r);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||F.intersectsSprite(t)){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(G);const e=ie.update(t),r=t.material;r.visible&&h.push(t,e,r,i,V.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==Y.render.frame&&(t.skeleton.update(),t.skeleton.frame=Y.render.frame),!t.frustumCulled||F.intersectsObject(t))){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(G);const e=ie.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&h.push(t,e,a,i,V.z,o)}}else r.visible&&h.push(t,e,r,i,V.z,null)}const s=t.children;for(let o=0,a=s.length;o<a;o++)e(s[o],r,i,n)}(e,t,0,x.sortObjects),h.finish(),!0===x.sortObjects&&h.sort(P,B),x.userData.shadowMapRender){!0===U&&le.beginShadows();const r=d.state.shadowsArray;r.length>0&&ce.render(r,e,t),!0===U&&le.endShadows()}if(!0===this.info.autoReset&&this.info.reset(),!1!==x.userData.backgroundRender&&ue.render(h,e),!1!==x.userData.sceneRender)if(d.setupLights(x.physicallyCorrectLights),t.isArrayCamera){const r=t.cameras;for(let t=0,i=r.length;t<i;t++){const i=r[t];Be(h,e,i,i.viewport)}}else Be(h,e,t);null!==w&&(Z.updateMultisampleRenderTarget(w),Z.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(x,e,t),ge.resetDefaultState(),E=-1,S=null,v.pop(),d=v.length>0?v[v.length-1]:null,_.pop(),h=_.length>0?_[_.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,r){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=r;const i=J.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===r,i.__autoAllocateDepthBuffer||!0===W.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const r=J.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){w=e,b=t,y=r;let i=!0;if(e){const t=J.get(e);void 0!==t.__useDefaultFramebuffer?(X.bindFramebuffer(36160,null),i=!1):void 0===t.__webglFramebuffer?Z.setupRenderTarget(e):t.__hasExternalTextures&&Z.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture)}let n=null,s=!1,o=!1;if(e){const r=e.texture;(r.isData3DTexture||r.isDataArrayTexture)&&(o=!0);const i=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=i[t],s=!0):n=q.isWebGL2&&e.samples>0&&!1===Z.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:i,C.copy(e.viewport),M.copy(e.scissor),T=e.scissorTest}else C.copy(R).multiplyScalar(D).floor(),M.copy(L).multiplyScalar(D).floor(),T=O;if(X.bindFramebuffer(36160,n)&&q.drawBuffers&&i&&X.drawBuffers(e,n),X.viewport(C),X.scissor(M),X.setScissorTest(T),s){const i=J.get(e.texture);_e.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,r)}else if(o){const i=J.get(e.texture),n=t||0;_e.framebufferTextureLayer(36160,36064,i.__webglTexture,r||0,n)}E=-1},this.readRenderTargetPixels=function(e,t,r,i,n,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){X.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==Re&&fe.convert(a)!==_e.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Te&&(W.has("EXT_color_buffer_half_float")||q.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===be||fe.convert(l)===_e.getParameter(35738)||l===Me&&(q.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&r>=0&&r<=e.height-n&&_e.readPixels(t,r,i,n,fe.convert(a),fe.convert(l),s)}finally{const e=null!==w?J.get(w).__webglFramebuffer:null;X.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,r=0){const i=Math.pow(2,-r),n=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);Z.setTexture2D(t,0),_e.copyTexSubImage2D(3553,r,0,0,e.x,e.y,n,s),X.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){const n=t.image.width,s=t.image.height,o=fe.convert(r.format),a=fe.convert(r.type);Z.setTexture2D(r,0),_e.pixelStorei(37440,r.flipY),_e.pixelStorei(37441,r.premultiplyAlpha),_e.pixelStorei(3317,r.unpackAlignment),t.isDataTexture?_e.texSubImage2D(3553,i,e.x,e.y,n,s,o,a,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):_e.texSubImage2D(3553,i,e.x,e.y,o,a,t.image),0===i&&r.generateMipmaps&&_e.generateMipmap(3553),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r,i,n=0){if(x.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=fe.convert(i.format),c=fe.convert(i.type);let u;if(i.isData3DTexture)Z.setTexture3D(i,0),u=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Z.setTexture2DArray(i,0),u=35866}_e.pixelStorei(37440,i.flipY),_e.pixelStorei(37441,i.premultiplyAlpha),_e.pixelStorei(3317,i.unpackAlignment);const p=_e.getParameter(3314),h=_e.getParameter(32878),d=_e.getParameter(3316),f=_e.getParameter(3315),g=_e.getParameter(32877),m=r.isCompressedTexture?r.mipmaps[0]:r.image;_e.pixelStorei(3314,m.width),_e.pixelStorei(32878,m.height),_e.pixelStorei(3316,e.min.x),_e.pixelStorei(3315,e.min.y),_e.pixelStorei(32877,e.min.z),r.isDataTexture||r.isData3DTexture?_e.texSubImage3D(u,n,t.x,t.y,t.z,s,o,a,l,c,m.data):r.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(u,n,t.x,t.y,t.z,s,o,a,l,m.data)):_e.texSubImage3D(u,n,t.x,t.y,t.z,s,o,a,l,c,m),_e.pixelStorei(3314,p),_e.pixelStorei(32878,h),_e.pixelStorei(3316,d),_e.pixelStorei(3315,f),_e.pixelStorei(32877,g),0===n&&i.generateMipmaps&&_e.generateMipmap(u),X.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?Z.setTextureCube(e,0):e.isData3DTexture?Z.setTexture3D(e,0):e.isDataArrayTexture?Z.setTexture2DArray(e,0):Z.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){b=0,y=0,w=null,X.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class ll extends al{}ll.prototype.isWebGL1Renderer=!0;class cl{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Wr(e),this.density=t}clone(){return new cl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class ul{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new Wr(e),this.near=t,this.far=r}clone(){return new ul(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class pl extends un{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class hl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ir,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ar()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ar()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ar()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const dl=new ai;class fl{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)dl.fromBufferAttribute(this,t),dl.applyMatrix4(e),this.setXYZ(t,dl.x,dl.y,dl.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)dl.fromBufferAttribute(this,t),dl.applyNormalMatrix(e),this.setXYZ(t,dl.x,dl.y,dl.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)dl.fromBufferAttribute(this,t),dl.transformDirection(e),this.setXYZ(t,dl.x,dl.y,dl.z);return this}setX(e,t){return this.normalized&&(t=Tr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Tr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Tr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Tr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Mr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Mr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Mr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Mr(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tr(t,this.array),r=Tr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tr(t,this.array),r=Tr(r,this.array),i=Tr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tr(t,this.array),r=Tr(r,this.array),i=Tr(i,this.array),n=Tr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return new Mn(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new fl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class gl extends wn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Wr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ml;const _l=new ai,vl=new ai,xl=new ai,Al=new kr,bl=new kr,yl=new Ui,wl=new ai,El=new ai,Sl=new ai,Cl=new kr,Ml=new kr,Tl=new kr;class Il extends un{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===ml){ml=new Hn;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new hl(e,5);ml.setIndex([0,1,2,0,2,3]),ml.setAttribute("position",new fl(t,3,0,!1)),ml.setAttribute("uv",new fl(t,2,3,!1))}this.geometry=ml,this.material=void 0!==e?e:new gl,this.center=new kr(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),vl.setFromMatrixScale(this.matrixWorld),yl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),xl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&vl.multiplyScalar(-xl.z);const r=this.material.rotation;let i,n;0!==r&&(n=Math.cos(r),i=Math.sin(r));const s=this.center;kl(wl.set(-.5,-.5,0),xl,s,vl,i,n),kl(El.set(.5,-.5,0),xl,s,vl,i,n),kl(Sl.set(.5,.5,0),xl,s,vl,i,n),Cl.set(0,0),Ml.set(1,0),Tl.set(1,1);let o=e.ray.intersectTriangle(wl,El,Sl,!1,_l);if(null===o&&(kl(El.set(-.5,.5,0),xl,s,vl,i,n),Ml.set(0,1),null===(o=e.ray.intersectTriangle(wl,Sl,El,!1,_l))))return;const a=e.ray.origin.distanceTo(_l);a<e.near||a>e.far||t.push({distance:a,point:_l.clone(),uv:bn.getUV(_l,wl,El,Sl,Cl,Ml,Tl,new kr),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function kl(e,t,r,i,n,s){Al.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(bl.x=s*Al.x-n*Al.y,bl.y=n*Al.x+s*Al.y):bl.copy(Al),e.copy(t),e.x+=bl.x,e.y+=bl.y,e.applyMatrix4(yl)}const Dl=new ai,Pl=new ai;class Bl extends un{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,i=t.length;r<i;r++){const e=t[r];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,i;for(r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){Dl.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(Dl);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Dl.setFromMatrixPosition(e.matrixWorld),Pl.setFromMatrixPosition(this.matrixWorld);const r=Dl.distanceTo(Pl)/e.zoom;let i,n;for(t[0].object.visible=!0,i=1,n=t.length;i<n&&r>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<n;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let i=0,n=r.length;i<n;i++){const e=r[i];t.object.levels.push({object:e.object.uuid,distance:e.distance})}return t}}const Rl=new ai,Ll=new $r,Ol=new $r,Fl=new ai,Ul=new Ui;class Nl extends cs{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ui,this.bindMatrixInverse=new Ui}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new $r,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const r=this.skeleton,i=this.geometry;Ll.fromBufferAttribute(i.attributes.skinIndex,e),Ol.fromBufferAttribute(i.attributes.skinWeight,e),Rl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){const e=Ol.getComponent(n);if(0!==e){const i=Ll.getComponent(n);Ul.multiplyMatrices(r.bones[i].matrixWorld,r.boneInverses[i]),t.addScaledVector(Fl.copy(Rl).applyMatrix4(Ul),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class jl extends un{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Gl extends Zr{constructor(e=null,t=1,r=1,i,n,s,o,a,l=pe,c=pe,u,p){super(null,s,o,a,l,c,i,n,u,p),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const zl=new Ui,Vl=new Ui;class Ql{constructor(e=[],t=[]){this.uuid=Ar(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ui;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let n=0,s=e.length;n<s;n++){const i=e[n]?e[n].matrixWorld:Vl;zl.multiplyMatrices(i,t[n]),zl.toArray(r,16*n)}null!==i&&(i.needsUpdate=!0)}clone(){return new Ql(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Sr(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new Gl(t,e,e,Re,Me);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){const i=e.bones[r];let n=t[i];void 0===n&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),n=new jl),this.bones.push(n),this.boneInverses.push((new Ui).fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let i=0,n=t.length;i<n;i++){const n=t[i];e.bones.push(n.uuid);const s=r[i];e.boneInverses.push(s.toArray())}return e}}class Hl extends Mn{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Wl=new Ui,ql=new Ui,Xl=[],Yl=new cs;class Kl extends cs{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Hl(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const r=this.matrixWorld,i=this.count;if(Yl.geometry=this.geometry,Yl.material=this.material,void 0!==Yl.material)for(let n=0;n<i;n++){this.getMatrixAt(n,Wl),ql.multiplyMatrices(r,Wl),Yl.matrixWorld=ql,Yl.raycast(e,Xl);for(let e=0,r=Xl.length;e<r;e++){const r=Xl[e];r.instanceId=n,r.object=this,t.push(r)}Xl.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Hl(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Jl extends wn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Wr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Zl=new ai,$l=new ai,ec=new Ui,tc=new Fi,rc=new Ii;class ic extends un{constructor(e=new Hn,t=new Jl){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[0];for(let e=1,i=t.count;e<i;e++)Zl.fromBufferAttribute(t,e-1),$l.fromBufferAttribute(t,e),r[e]=r[e-1],r[e]+=Zl.distanceTo($l);e.setAttribute("lineDistance",new On(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,s=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),rc.copy(r.boundingSphere),rc.applyMatrix4(i),rc.radius+=n,!1===e.ray.intersectsSphere(rc))return;ec.copy(i).invert(),tc.copy(e.ray).applyMatrix4(ec);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new ai,c=new ai,u=new ai,p=new ai,h=this.isLineSegments?2:1,d=r.index,f=r.attributes.position;if(null!==d)for(let g=Math.max(0,s.start),m=Math.min(d.count,s.start+s.count)-1;g<m;g+=h){const r=d.getX(g),i=d.getX(g+1);if(l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,i),tc.distanceSqToSegment(l,c,p,u)>a)continue;p.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(p);n<e.near||n>e.far||t.push({distance:n,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}else for(let g=Math.max(0,s.start),m=Math.min(f.count,s.start+s.count)-1;g<m;g+=h){if(l.fromBufferAttribute(f,g),c.fromBufferAttribute(f,g+1),tc.distanceSqToSegment(l,c,p,u)>a)continue;p.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(p);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const nc=new ai,sc=new ai;class oc extends ic{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,r=[];for(let e=0,i=t.count;e<i;e+=2)nc.fromBufferAttribute(t,e),sc.fromBufferAttribute(t,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+nc.distanceTo(sc);e.setAttribute("lineDistance",new On(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ac extends ic{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class lc extends wn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Wr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const cc=new Ui,uc=new Fi,pc=new Ii,hc=new ai;class dc extends un{constructor(e=new Hn,t=new lc){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,n=e.params.Points.threshold,s=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),pc.copy(r.boundingSphere),pc.applyMatrix4(i),pc.radius+=n,!1===e.ray.intersectsSphere(pc))return;cc.copy(i).invert(),uc.copy(e.ray).applyMatrix4(cc);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=r.index,c=r.attributes.position;if(null!==l)for(let u=Math.max(0,s.start),p=Math.min(l.count,s.start+s.count);u<p;u++){const r=l.getX(u);hc.fromBufferAttribute(c,r),fc(hc,r,a,i,e,t,this)}else for(let u=Math.max(0,s.start),p=Math.min(c.count,s.start+s.count);u<p;u++)hc.fromBufferAttribute(c,u),fc(hc,u,a,i,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function fc(e,t,r,i,n,s,o){const a=uc.distanceSqToPoint(e);if(a<r){const r=new ai;uc.closestPointToPoint(e,r),r.applyMatrix4(i);const l=n.ray.origin.distanceTo(r);if(l<n.near||l>n.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:r,index:t,face:null,object:o})}}class gc extends Zr{constructor(e,t,r,i,n,s,o,a,l){super(e,t,r,i,n,s,o,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:me,this.magFilter=void 0!==n?n:me,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class mc extends Zr{constructor(e,t,r){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=r,this.magFilter=pe,this.minFilter=pe,this.generateMipmaps=!1,this.needsUpdate=!0}}class _c extends Zr{constructor(e,t,r,i,n,s,o,a,l,c,u,p){super(null,s,o,a,l,c,i,n,u,p),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class vc extends Zr{constructor(e,t,r,i,n,s,o,a,l){super(e,t,r,i,n,s,o,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class xc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)n+=(r=this.getPoint(s/e)).distanceTo(i),t.push(n),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let i=0;const n=r.length;let s;s=t||e*r[n-1];let o,a=0,l=n-1;for(;a<=l;)if((o=r[i=Math.floor(a+(l-a)/2)]-s)<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(r[i=l]===s)return i/(n-1);const c=r[i];return(i+(s-c)/(r[i+1]-c))/(n-1)}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),i>1&&(i=1);const n=this.getPoint(r),s=this.getPoint(i),o=t||(n.isVector2?new kr:new ai);return o.copy(s).sub(n).normalize(),o}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new ai,i=[],n=[],s=[],o=new ai,a=new Ui;for(let h=0;h<=e;h++){const t=h/e;i[h]=this.getTangentAt(t,new ai)}n[0]=new ai,s[0]=new ai;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),p=Math.abs(i[0].z);c<=l&&(l=c,r.set(1,0,0)),u<=l&&(l=u,r.set(0,1,0)),p<=l&&r.set(0,0,1),o.crossVectors(i[0],r).normalize(),n[0].crossVectors(i[0],o),s[0].crossVectors(i[0],n[0]);for(let h=1;h<=e;h++){if(n[h]=n[h-1].clone(),s[h]=s[h-1].clone(),o.crossVectors(i[h-1],i[h]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(br(i[h-1].dot(i[h]),-1,1));n[h].applyMatrix4(a.makeRotationAxis(o,e))}s[h].crossVectors(i[h],n[h])}if(!0===t){let t=Math.acos(br(n[0].dot(n[e]),-1,1));t/=e,i[0].dot(o.crossVectors(n[0],n[e]))>0&&(t=-t);for(let r=1;r<=e;r++)n[r].applyMatrix4(a.makeRotationAxis(i[r],t*r)),s[r].crossVectors(i[r],n[r])}return{tangents:i,normals:n,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ac extends xc{constructor(e=0,t=0,r=1,i=1,n=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const r=t||new kr,i=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;const s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(n=s?0:i),!0!==this.aClockwise||s||(n===i?n=-i:n-=i);const o=this.aStartAngle+e*n;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),r=a-this.aX,i=l-this.aY;a=r*e-i*t+this.aX,l=r*t+i*e+this.aY}return r.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class bc extends Ac{constructor(e,t,r,i,n,s){super(e,t,r,r,i,n,s),this.isArcCurve=!0,this.type="ArcCurve"}}function yc(){let e=0,t=0,r=0,i=0;function n(n,s,o,a){e=n,t=o,r=-3*n+3*s-2*o-a,i=2*n-2*s+o+a}return{initCatmullRom:function(e,t,r,i,s){n(t,r,s*(r-e),s*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,s,o,a){let l=(t-e)/s-(r-e)/(s+o)+(r-t)/o,c=(r-t)/o-(i-t)/(o+a)+(i-r)/a;n(t,r,l*=o,c*=o)},calc:function(n){const s=n*n;return e+t*n+r*s+i*(s*n)}}}const wc=new ai,Ec=new yc,Sc=new yc,Cc=new yc;class Mc extends xc{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new ai){const r=t,i=this.points,n=i.length,s=(n-(this.closed?0:1))*e;let o,a,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/n)+1)*n:0===c&&l===n-1&&(l=n-2,c=1),this.closed||l>0?o=i[(l-1)%n]:(wc.subVectors(i[0],i[1]).add(i[0]),o=wc);const u=i[l%n],p=i[(l+1)%n];if(this.closed||l+2<n?a=i[(l+2)%n]:(wc.subVectors(i[n-1],i[n-2]).add(i[n-1]),a=wc),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),r=Math.pow(u.distanceToSquared(p),e),i=Math.pow(p.distanceToSquared(a),e);r<1e-4&&(r=1),t<1e-4&&(t=r),i<1e-4&&(i=r),Ec.initNonuniformCatmullRom(o.x,u.x,p.x,a.x,t,r,i),Sc.initNonuniformCatmullRom(o.y,u.y,p.y,a.y,t,r,i),Cc.initNonuniformCatmullRom(o.z,u.z,p.z,a.z,t,r,i)}else"catmullrom"===this.curveType&&(Ec.initCatmullRom(o.x,u.x,p.x,a.x,this.tension),Sc.initCatmullRom(o.y,u.y,p.y,a.y,this.tension),Cc.initCatmullRom(o.z,u.z,p.z,a.z,this.tension));return r.set(Ec.calc(c),Sc.calc(c),Cc.calc(c)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push((new ai).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Tc(e,t,r,i,n){const s=.5*(i-t),o=.5*(n-r),a=e*e;return(2*r-2*i+s+o)*(e*a)+(-3*r+3*i-2*s-o)*a+s*e+r}function Ic(e,t,r,i){return function(e,t){const r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*r}(e)+function(e,t){return e*e*i}(e)}function kc(e,t,r,i,n){return function(e,t){const r=1-e;return r*r*r*t}(e,t)+function(e,t){const r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*i}(e)+function(e,t){return e*e*e*n}(e)}class Dc extends xc{constructor(e=new kr,t=new kr,r=new kr,i=new kr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new kr){const r=t,i=this.v0,n=this.v1,s=this.v2,o=this.v3;return r.set(kc(e,i.x,n.x,s.x,o.x),kc(e,i.y,n.y,s.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Pc extends xc{constructor(e=new ai,t=new ai,r=new ai,i=new ai){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new ai){const r=t,i=this.v0,n=this.v1,s=this.v2,o=this.v3;return r.set(kc(e,i.x,n.x,s.x,o.x),kc(e,i.y,n.y,s.y,o.y),kc(e,i.z,n.z,s.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Bc extends xc{constructor(e=new kr,t=new kr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new kr){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const r=t||new kr;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Rc extends xc{constructor(e=new ai,t=new ai){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ai){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Lc extends xc{constructor(e=new kr,t=new kr,r=new kr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new kr){const r=t,i=this.v0,n=this.v1,s=this.v2;return r.set(Ic(e,i.x,n.x,s.x),Ic(e,i.y,n.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Oc extends xc{constructor(e=new ai,t=new ai,r=new ai){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new ai){const r=t,i=this.v0,n=this.v1,s=this.v2;return r.set(Ic(e,i.x,n.x,s.x),Ic(e,i.y,n.y,s.y),Ic(e,i.z,n.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Fc extends xc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new kr){const r=t,i=this.points,n=(i.length-1)*e,s=Math.floor(n),o=n-s,a=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],u=i[s>i.length-3?i.length-1:s+2];return r.set(Tc(o,a.x,l.x,c.x,u.x),Tc(o,a.y,l.y,c.y,u.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const r=e.points[t];this.points.push((new kr).fromArray(r))}return this}}var Uc=Object.freeze({__proto__:null,ArcCurve:bc,CatmullRomCurve3:Mc,CubicBezierCurve:Dc,CubicBezierCurve3:Pc,EllipseCurve:Ac,LineCurve:Bc,LineCurve3:Rc,QuadraticBezierCurve:Lc,QuadraticBezierCurve3:Oc,SplineCurve:Fc});class Nc extends xc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Bc(t,e))}getPoint(e,t){const r=e*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=r){const e=i[n]-r,s=this.curves[n],o=s.getLength(),a=0===o?0:1-e/o;return s.getPointAt(a,t)}n++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let i=0,n=this.curves;i<n.length;i++){const s=n[i],o=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const i=a[e];r&&r.equals(i)||(t.push(i),r=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const r=e.curves[t];this.curves.push((new Uc[r.type]).fromJSON(r))}return this}}class jc extends Nc{constructor(e){super(),this.type="Path",this.currentPoint=new kr,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new Bc(this.currentPoint.clone(),new kr(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){const n=new Lc(this.currentPoint.clone(),new kr(e,t),new kr(r,i));return this.curves.push(n),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,n,s){const o=new Dc(this.currentPoint.clone(),new kr(e,t),new kr(r,i),new kr(n,s));return this.curves.push(o),this.currentPoint.set(n,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new Fc(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,n,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,r,i,n,s),this}absarc(e,t,r,i,n,s){return this.absellipse(e,t,r,r,i,n,s),this}ellipse(e,t,r,i,n,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,r,i,n,s,o,a),this}absellipse(e,t,r,i,n,s,o,a){const l=new Ac(e,t,r,i,n,s,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Gc extends Hn{constructor(e=[new kr(0,-.5),new kr(.5,0),new kr(0,.5)],t=12,r=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t),i=br(i,0,2*Math.PI);const n=[],s=[],o=[],a=[],l=[],c=1/t,u=new ai,p=new kr,h=new ai,d=new ai,f=new ai;let g=0,m=0;for(let _=0;_<=e.length-1;_++)switch(_){case 0:g=e[_+1].x-e[_].x,m=e[_+1].y-e[_].y,h.x=1*m,h.y=-g,h.z=0*m,f.copy(h),h.normalize(),a.push(h.x,h.y,h.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:g=e[_+1].x-e[_].x,m=e[_+1].y-e[_].y,h.x=1*m,h.y=-g,h.z=0*m,d.copy(h),h.x+=f.x,h.y+=f.y,h.z+=f.z,h.normalize(),a.push(h.x,h.y,h.z),f.copy(d)}for(let _=0;_<=t;_++){const n=r+_*c*i,h=Math.sin(n),d=Math.cos(n);for(let r=0;r<=e.length-1;r++){u.x=e[r].x*h,u.y=e[r].y,u.z=e[r].x*d,s.push(u.x,u.y,u.z),p.x=_/t,p.y=r/(e.length-1),o.push(p.x,p.y);const i=a[3*r+0]*h,n=a[3*r+1],c=a[3*r+0]*d;l.push(i,n,c)}}for(let _=0;_<t;_++)for(let t=0;t<e.length-1;t++){const r=t+_*e.length,i=r,s=r+e.length,o=r+e.length+1,a=r+1;n.push(i,s,a),n.push(o,a,s)}this.setIndex(n),this.setAttribute("position",new On(s,3)),this.setAttribute("uv",new On(o,2)),this.setAttribute("normal",new On(l,3))}static fromJSON(e){return new Gc(e.points,e.segments,e.phiStart,e.phiLength)}}class zc extends Gc{constructor(e=1,t=1,r=4,i=8){const n=new jc;n.absarc(0,-t/2,e,1.5*Math.PI,0),n.absarc(0,t/2,e,0,.5*Math.PI),super(n.getPoints(r),i),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:r,radialSegments:i}}static fromJSON(e){return new zc(e.radius,e.length,e.capSegments,e.radialSegments)}}class Vc extends Hn{constructor(e=1,t=8,r=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},t=Math.max(3,t);const n=[],s=[],o=[],a=[],l=new ai,c=new kr;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let u=0,p=3;u<=t;u++,p+=3){const n=r+u/t*i;l.x=e*Math.cos(n),l.y=e*Math.sin(n),s.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(s[p]/e+1)/2,c.y=(s[p+1]/e+1)/2,a.push(c.x,c.y)}for(let u=1;u<=t;u++)n.push(u,u+1,0);this.setIndex(n),this.setAttribute("position",new On(s,3)),this.setAttribute("normal",new On(o,3)),this.setAttribute("uv",new On(a,2))}static fromJSON(e){return new Vc(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Qc extends Hn{constructor(e=1,t=1,r=1,i=8,n=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:o,thetaLength:a};const l=this;i=Math.floor(i),n=Math.floor(n);const c=[],u=[],p=[],h=[];let d=0;const f=[],g=r/2;let m=0;function _(r){const n=d,s=new kr,f=new ai;let _=0;const v=!0===r?e:t,x=!0===r?1:-1;for(let e=1;e<=i;e++)u.push(0,g*x,0),p.push(0,x,0),h.push(.5,.5),d++;const A=d;for(let e=0;e<=i;e++){const t=e/i*a+o,r=Math.cos(t),n=Math.sin(t);f.x=v*n,f.y=g*x,f.z=v*r,u.push(f.x,f.y,f.z),p.push(0,x,0),s.x=.5*r+.5,s.y=.5*n*x+.5,h.push(s.x,s.y),d++}for(let e=0;e<i;e++){const t=n+e,i=A+e;!0===r?c.push(i,i+1,t):c.push(i+1,i,t),_+=3}l.addGroup(m,_,!0===r?1:2),m+=_}!function(){const s=new ai,_=new ai;let v=0;const x=(t-e)/r;for(let l=0;l<=n;l++){const c=[],m=l/n,v=m*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,n=t*a+o,l=Math.sin(n),f=Math.cos(n);_.x=v*l,_.y=-m*r+g,_.z=v*f,u.push(_.x,_.y,_.z),s.set(l,x,f).normalize(),p.push(s.x,s.y,s.z),h.push(t,1-m),c.push(d++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<n;t++){const r=f[t][e],i=f[t+1][e],n=f[t+1][e+1],s=f[t][e+1];c.push(r,i,s),c.push(i,n,s),v+=6}l.addGroup(m,v,0),m+=v}(),!1===s&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new On(u,3)),this.setAttribute("normal",new On(p,3)),this.setAttribute("uv",new On(h,2))}static fromJSON(e){return new Qc(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hc extends Qc{constructor(e=1,t=1,r=8,i=1,n=!1,s=0,o=2*Math.PI){super(0,e,t,r,i,n,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:s,thetaLength:o}}static fromJSON(e){return new Hc(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Wc extends Hn{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const n=[],s=[];function o(e,t,r,i){const n=i+1,s=[];for(let o=0;o<=n;o++){s[o]=[];const i=e.clone().lerp(r,o/n),a=t.clone().lerp(r,o/n),l=n-o;for(let e=0;e<=l;e++)s[o][e]=0===e&&o===n?i:i.clone().lerp(a,e/l)}for(let o=0;o<n;o++)for(let e=0;e<2*(n-o)-1;e++){const t=Math.floor(e/2);e%2==0?(a(s[o][t+1]),a(s[o+1][t]),a(s[o][t])):(a(s[o][t+1]),a(s[o+1][t+1]),a(s[o+1][t]))}}function a(e){n.push(e.x,e.y,e.z)}function l(t,r){const i=3*t;r.x=e[i+0],r.y=e[i+1],r.z=e[i+2]}function c(e,t,r,i){i<0&&1===e.x&&(s[t]=e.x-1),0===r.x&&0===r.z&&(s[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const r=new ai,i=new ai,n=new ai;for(let s=0;s<t.length;s+=3)l(t[s+0],r),l(t[s+1],i),l(t[s+2],n),o(r,i,n,e)}(i),function(e){const t=new ai;for(let r=0;r<n.length;r+=3)t.x=n[r+0],t.y=n[r+1],t.z=n[r+2],t.normalize().multiplyScalar(e),n[r+0]=t.x,n[r+1]=t.y,n[r+2]=t.z}(r),function(){const e=new ai;for(let r=0;r<n.length;r+=3){e.x=n[r+0],e.y=n[r+1],e.z=n[r+2];const i=u(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(i,1-o)}var t;(function(){const e=new ai,t=new ai,r=new ai,i=new ai,o=new kr,a=new kr,l=new kr;for(let p=0,h=0;p<n.length;p+=9,h+=6){e.set(n[p+0],n[p+1],n[p+2]),t.set(n[p+3],n[p+4],n[p+5]),r.set(n[p+6],n[p+7],n[p+8]),o.set(s[h+0],s[h+1]),a.set(s[h+2],s[h+3]),l.set(s[h+4],s[h+5]),i.copy(e).add(t).add(r).divideScalar(3);const d=u(i);c(o,h+0,e,d),c(a,h+2,t,d),c(l,h+4,r,d)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],r=s[e+2],i=s[e+4],n=Math.max(t,r,i),o=Math.min(t,r,i);n>.9&&o<.1&&(t<.2&&(s[e+0]+=1),r<.2&&(s[e+2]+=1),i<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new On(n,3)),this.setAttribute("normal",new On(n.slice(),3)),this.setAttribute("uv",new On(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Wc(e.vertices,e.indices,e.radius,e.details)}}class qc extends Wc{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qc(e.radius,e.detail)}}const Xc=new ai,Yc=new ai,Kc=new ai,Jc=new bn;class Zc extends Hn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const r=4,i=Math.pow(10,r),n=Math.cos(vr*t),s=e.getIndex(),o=e.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),p={},h=[];for(let e=0;e<a;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:r,c:a}=Jc;if(t.fromBufferAttribute(o,l[0]),r.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),Jc.getNormal(Kc),u[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,u[1]=`${Math.round(r.x*i)},${Math.round(r.y*i)},${Math.round(r.z*i)}`,u[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,r=u[e],i=u[t],s=Jc[c[e]],o=Jc[c[t]],a=`${r}_${i}`,d=`${i}_${r}`;d in p&&p[d]?(Kc.dot(p[d].normal)<=n&&(h.push(s.x,s.y,s.z),h.push(o.x,o.y,o.z)),p[d]=null):a in p||(p[a]={index0:l[e],index1:l[t],normal:Kc.clone()})}}for(const e in p)if(p[e]){const{index0:t,index1:r}=p[e];Xc.fromBufferAttribute(o,t),Yc.fromBufferAttribute(o,r),h.push(Xc.x,Xc.y,Xc.z),h.push(Yc.x,Yc.y,Yc.z)}this.setAttribute("position",new On(h,3))}}}class $c extends jc{constructor(e){super(e),this.uuid=Ar(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const r=e.holes[t];this.holes.push((new jc).fromJSON(r))}return this}}function eu(e,t,r,i,n){let s,o;if(n===function(e,t,r,i){let n=0;for(let s=t,o=r-i;s<r;s+=i)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}(e,t,r,i)>0)for(s=t;s<r;s+=i)o=bu(s,e[s],e[s+1],o);else for(s=r-i;s>=t;s-=i)o=bu(s,e[s],e[s+1],o);return o&&gu(o,o.next)&&(yu(o),o=o.next),o}function tu(e,t){if(!e)return e;t||(t=e);let r,i=e;do{if(r=!1,i.steiner||!gu(i,i.next)&&0!==fu(i.prev,i,i.next))i=i.next;else{if(yu(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function ru(e,t,r,i,n,s,o){if(!e)return;!o&&s&&function(e,t,r,i){let n=e;do{null===n.z&&(n.z=uu(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,r,i,n,s,o,a,l,c=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,i=r,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,c*=2}while(o>1)}(n)}(e,i,n,s);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,s?nu(e,i,n,s):iu(e))t.push(a.i/r),t.push(e.i/r),t.push(l.i/r),yu(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?ru(e=su(tu(e),t,r),t,r,i,n,s,2):2===o&&ou(e,t,r,i,n,s):ru(tu(e),t,r,i,n,s,1);break}}function iu(e){const t=e.prev,r=e,i=e.next;if(fu(t,r,i)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(hu(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&fu(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function nu(e,t,r,i){const n=e.prev,s=e,o=e.next;if(fu(n,s,o)>=0)return!1;const a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,p=uu(a,l,t,r,i),h=uu(c,u,t,r,i);let d=e.prevZ,f=e.nextZ;for(;d&&d.z>=p&&f&&f.z<=h;){if(d!==e.prev&&d!==e.next&&hu(n.x,n.y,s.x,s.y,o.x,o.y,d.x,d.y)&&fu(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&hu(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&fu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=p;){if(d!==e.prev&&d!==e.next&&hu(n.x,n.y,s.x,s.y,o.x,o.y,d.x,d.y)&&fu(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=h;){if(f!==e.prev&&f!==e.next&&hu(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&fu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function su(e,t,r){let i=e;do{const n=i.prev,s=i.next.next;!gu(n,s)&&mu(n,i,i.next,s)&&xu(n,s)&&xu(s,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(s.i/r),yu(i),yu(i.next),i=e=s),i=i.next}while(i!==e);return tu(i)}function ou(e,t,r,i,n,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&du(o,e)){let a=Au(o,e);return o=tu(o,o.next),a=tu(a,a.next),ru(o,t,r,i,n,s),void ru(a,t,r,i,n,s)}e=e.next}o=o.next}while(o!==e)}function au(e,t){return e.x-t.x}function lu(e,t){if(t=function(e,t){let r=t;const i=e.x,n=e.y;let s,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const e=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=i&&e>o){if(o=e,e===i){if(n===r.y)return r;if(n===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!s)return null;if(i===o)return s;const a=s,l=s.x,c=s.y;let u,p=1/0;r=s;do{i>=r.x&&r.x>=l&&i!==r.x&&hu(n<c?i:o,n,l,c,n<c?o:i,n,r.x,r.y)&&(u=Math.abs(n-r.y)/(i-r.x),xu(r,e)&&(u<p||u===p&&(r.x>s.x||r.x===s.x&&cu(s,r)))&&(s=r,p=u)),r=r.next}while(r!==a);return s}(e,t)){const r=Au(t,e);tu(t,t.next),tu(r,r.next)}}function cu(e,t){return fu(e.prev,e,t.prev)<0&&fu(t.next,e,e.next)<0}function uu(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pu(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function hu(e,t,r,i,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(r-o)*(t-a)>=0&&(r-o)*(s-a)-(n-o)*(i-a)>=0}function du(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&mu(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(xu(e,t)&&xu(t,e)&&function(e,t){let r=e,i=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(fu(e.prev,e,t.prev)||fu(e,t.prev,t))||gu(e,t)&&fu(e.prev,e,e.next)>0&&fu(t.prev,t,t.next)>0)}function fu(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function gu(e,t){return e.x===t.x&&e.y===t.y}function mu(e,t,r,i){const n=vu(fu(e,t,r)),s=vu(fu(e,t,i)),o=vu(fu(r,i,e)),a=vu(fu(r,i,t));return n!==s&&o!==a||!(0!==n||!_u(e,r,t))||!(0!==s||!_u(e,i,t))||!(0!==o||!_u(r,e,i))||!(0!==a||!_u(r,t,i))}function _u(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function vu(e){return e>0?1:e<0?-1:0}function xu(e,t){return fu(e.prev,e,e.next)<0?fu(e,t,e.next)>=0&&fu(e,e.prev,t)>=0:fu(e,t,e.prev)<0||fu(e,e.next,t)<0}function Au(e,t){const r=new wu(e.i,e.x,e.y),i=new wu(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function bu(e,t,r,i){const n=new wu(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function yu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function wu(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Eu{static area(e){const t=e.length;let r=0;for(let i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r}static isClockWise(e){return Eu.area(e)<0}static triangulateShape(e,t){const r=[],i=[],n=[];Su(e),Cu(r,e);let s=e.length;t.forEach(Su);for(let a=0;a<t.length;a++)i.push(s),s+=t[a].length,Cu(r,t[a]);const o=function(e,t,r=2){const i=t&&t.length,n=i?t[0]*r:e.length;let s=eu(e,0,n,r,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,p,h,d;if(i&&(s=function(e,t,r,i){const n=[];let s,o,a,l,c;for(s=0,o=t.length;s<o;s++)(c=eu(e,a=t[s]*i,l=s<o-1?t[s+1]*i:e.length,i,!1))===c.next&&(c.steiner=!0),n.push(pu(c));for(n.sort(au),s=0;s<n.length;s++)lu(n[s],r),r=tu(r,r.next);return r}(e,t,s,r)),e.length>80*r){a=c=e[0],l=u=e[1];for(let t=r;t<n;t+=r)(p=e[t])<a&&(a=p),(h=e[t+1])<l&&(l=h),p>c&&(c=p),h>u&&(u=h);d=0!==(d=Math.max(c-a,u-l))?1/d:0}return ru(s,o,r,a,l,d),o}(r,i);for(let a=0;a<o.length;a+=3)n.push(o.slice(a,a+3));return n}}function Su(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Cu(e,t){for(let r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}class Mu extends Hn{constructor(e=new $c([new kr(.5,.5),new kr(-.5,.5),new kr(-.5,-.5),new kr(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,i=[],n=[];for(let o=0,a=e.length;o<a;o++)s(e[o]);function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,p=void 0!==t.bevelSize?t.bevelSize:u-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:Tu;let m,_,v,x,A,b=!1;f&&(m=f.getSpacedPoints(a),b=!0,c=!1,_=f.computeFrenetFrames(a,!1),v=new ai,x=new ai,A=new ai),c||(d=0,u=0,p=0,h=0);const y=e.extractPoints(o);let w=y.shape;const E=y.holes;if(!Eu.isClockWise(w)){w=w.reverse();for(let e=0,t=E.length;e<t;e++){const t=E[e];Eu.isClockWise(t)&&(E[e]=t.reverse())}}const S=Eu.triangulateShape(w,E),C=w;for(let t=0,r=E.length;t<r;t++){const e=E[t];w=w.concat(e)}function M(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}const T=w.length,I=S.length;function k(e,t,r){let i,n,s;const o=e.x-t.x,a=e.y-t.y,l=r.x-e.x,c=r.y-e.y,u=o*o+a*a,p=o*c-a*l;if(Math.abs(p)>Number.EPSILON){const p=Math.sqrt(u),h=Math.sqrt(l*l+c*c),d=t.x-a/p,f=t.y+o/p,g=((r.x-c/h-d)*c-(r.y+l/h-f)*l)/(o*c-a*l),m=(i=d+o*g-e.x)*i+(n=f+a*g-e.y)*n;if(m<=2)return new kr(i,n);s=Math.sqrt(m/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(i=-a,n=o,s=Math.sqrt(u)):(i=o,n=a,s=Math.sqrt(u/2))}return new kr(i/s,n/s)}const D=[];for(let t=0,r=C.length,i=r-1,n=t+1;t<r;t++,i++,n++)i===r&&(i=0),n===r&&(n=0),D[t]=k(C[t],C[i],C[n]);const P=[];let B,R=D.concat();for(let t=0,r=E.length;t<r;t++){const e=E[t];B=[];for(let t=0,r=e.length,i=r-1,n=t+1;t<r;t++,i++,n++)i===r&&(i=0),n===r&&(n=0),B[t]=k(e[t],e[i],e[n]);P.push(B),R=R.concat(B)}for(let t=0;t<d;t++){const e=t/d,r=u*Math.cos(e*Math.PI/2),i=p*Math.sin(e*Math.PI/2)+h;for(let t=0,n=C.length;t<n;t++){const e=M(C[t],D[t],i);F(e.x,e.y,-r)}for(let t=0,n=E.length;t<n;t++){const e=E[t];B=P[t];for(let t=0,n=e.length;t<n;t++){const n=M(e[t],B[t],i);F(n.x,n.y,-r)}}}const L=p+h;for(let t=0;t<T;t++){const e=c?M(w[t],R[t],L):w[t];b?(x.copy(_.normals[0]).multiplyScalar(e.x),v.copy(_.binormals[0]).multiplyScalar(e.y),A.copy(m[0]).add(x).add(v),F(A.x,A.y,A.z)):F(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<T;e++){const r=c?M(w[e],R[e],L):w[e];b?(x.copy(_.normals[t]).multiplyScalar(r.x),v.copy(_.binormals[t]).multiplyScalar(r.y),A.copy(m[t]).add(x).add(v),F(A.x,A.y,A.z)):F(r.x,r.y,l/a*t)}for(let t=d-1;t>=0;t--){const e=t/d,r=u*Math.cos(e*Math.PI/2),i=p*Math.sin(e*Math.PI/2)+h;for(let t=0,n=C.length;t<n;t++){const e=M(C[t],D[t],i);F(e.x,e.y,l+r)}for(let t=0,n=E.length;t<n;t++){const e=E[t];B=P[t];for(let t=0,n=e.length;t<n;t++){const n=M(e[t],B[t],i);b?F(n.x,n.y+m[a-1].y,m[a-1].x+r):F(n.x,n.y,l+r)}}}function O(e,t){let r=e.length;for(;--r>=0;){const i=r;let n=r-1;n<0&&(n=e.length-1);for(let e=0,r=a+2*d;e<r;e++){const r=T*e,s=T*(e+1);N(t+i+r,t+n+r,t+n+s,t+i+s)}}}function F(e,t,r){s.push(e),s.push(t),s.push(r)}function U(e,t,n){j(e),j(t),j(n);const s=i.length/3,o=g.generateTopUV(r,i,s-3,s-2,s-1);G(o[0]),G(o[1]),G(o[2])}function N(e,t,n,s){j(e),j(t),j(s),j(t),j(n),j(s);const o=i.length/3,a=g.generateSideWallUV(r,i,o-6,o-3,o-2,o-1);G(a[0]),G(a[1]),G(a[3]),G(a[1]),G(a[2]),G(a[3])}function j(e){i.push(s[3*e+0]),i.push(s[3*e+1]),i.push(s[3*e+2])}function G(e){n.push(e.x),n.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=T*e;for(let r=0;r<I;r++){const e=S[r];U(e[2]+t,e[1]+t,e[0]+t)}t=T*(e=a+2*d);for(let r=0;r<I;r++){const e=S[r];U(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<I;e++){const t=S[e];U(t[2],t[1],t[0])}for(let e=0;e<I;e++){const t=S[e];U(t[0]+T*a,t[1]+T*a,t[2]+T*a)}}r.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;O(C,t),t+=C.length;for(let r=0,i=E.length;r<i;r++){const e=E[r];O(e,t),t+=e.length}r.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new On(i,3)),this.setAttribute("uv",new On(n,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,r){if(r.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const t=e[i];r.shapes.push(t.uuid)}else r.shapes.push(e.uuid);return r.options=Object.assign({},t),void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const r=[];for(let n=0,s=e.shapes.length;n<s;n++){const i=t[e.shapes[n]];r.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Uc[i.type]).fromJSON(i)),new Mu(r,e.options)}}const Tu={generateTopUV:function(e,t,r,i,n){const s=t[3*r],o=t[3*r+1],a=t[3*i],l=t[3*i+1],c=t[3*n],u=t[3*n+1];return[new kr(s,o),new kr(a,l),new kr(c,u)]},generateSideWallUV:function(e,t,r,i,n,s){const o=t[3*r],a=t[3*r+1],l=t[3*r+2],c=t[3*i],u=t[3*i+1],p=t[3*i+2],h=t[3*n],d=t[3*n+1],f=t[3*n+2],g=t[3*s],m=t[3*s+1],_=t[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new kr(o,1-l),new kr(c,1-p),new kr(h,1-f),new kr(g,1-_)]:[new kr(a,1-l),new kr(u,1-p),new kr(d,1-f),new kr(m,1-_)]}};class Iu extends Wc{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Iu(e.radius,e.detail)}}class ku extends Wc{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ku(e.radius,e.detail)}}class Du extends Hn{constructor(e=.5,t=1,r=8,i=1,n=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:s},r=Math.max(3,r);const o=[],a=[],l=[],c=[];let u=e;const p=(t-e)/(i=Math.max(1,i)),h=new ai,d=new kr;for(let f=0;f<=i;f++){for(let e=0;e<=r;e++){const i=n+e/r*s;h.x=u*Math.cos(i),h.y=u*Math.sin(i),a.push(h.x,h.y,h.z),l.push(0,0,1),d.x=(h.x/t+1)/2,d.y=(h.y/t+1)/2,c.push(d.x,d.y)}u+=p}for(let f=0;f<i;f++){const e=f*(r+1);for(let t=0;t<r;t++){const i=t+e,n=i,s=i+r+1,a=i+r+2,l=i+1;o.push(n,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new On(a,3)),this.setAttribute("normal",new On(l,3)),this.setAttribute("uv",new On(c,2))}static fromJSON(e){return new Du(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Pu extends Hn{constructor(e=new $c([new kr(0,.5),new kr(-.5,-.5),new kr(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],i=[],n=[],s=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(o,a,c),o+=a,a=0;function l(e){const o=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Eu.isClockWise(c)&&(c=c.reverse());for(let t=0,r=u.length;t<r;t++){const e=u[t];!0===Eu.isClockWise(e)&&(u[t]=e.reverse())}const p=Eu.triangulateShape(c,u);for(let t=0,r=u.length;t<r;t++){const e=u[t];c=c.concat(e)}for(let t=0,r=c.length;t<r;t++){const e=c[t];i.push(e.x,e.y,0),n.push(0,0,1),s.push(e.x,e.y)}for(let t=0,i=p.length;t<i;t++){const e=p[t],i=e[0]+o,n=e[1]+o,s=e[2]+o;r.push(i,n,s),a+=3}}this.setIndex(r),this.setAttribute("position",new On(i,3)),this.setAttribute("normal",new On(n,3)),this.setAttribute("uv",new On(s,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let r=0,i=e.length;r<i;r++){const i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const r=[];for(let i=0,n=e.shapes.length;i<n;i++){const n=t[e.shapes[i]];r.push(n)}return new Pu(r,e.curveSegments)}}class Bu extends Hn{constructor(e=1,t=32,r=16,i=0,n=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const a=Math.min(s+o,Math.PI);let l=0;const c=[],u=new ai,p=new ai,h=[],d=[],f=[],g=[];for(let m=0;m<=r;m++){const h=[],_=m/r;let v=0;0==m&&0==s?v=.5/t:m==r&&a==Math.PI&&(v=-.5/t);for(let r=0;r<=t;r++){const a=r/t;u.x=-e*Math.cos(i+a*n)*Math.sin(s+_*o),u.y=e*Math.cos(s+_*o),u.z=e*Math.sin(i+a*n)*Math.sin(s+_*o),d.push(u.x,u.y,u.z),p.copy(u).normalize(),f.push(p.x,p.y,p.z),g.push(a+v,1-_),h.push(l++)}c.push(h)}for(let m=0;m<r;m++)for(let e=0;e<t;e++){const t=c[m][e+1],i=c[m][e],n=c[m+1][e],o=c[m+1][e+1];(0!==m||s>0)&&h.push(t,i,o),(m!==r-1||a<Math.PI)&&h.push(i,n,o)}this.setIndex(h),this.setAttribute("position",new On(d,3)),this.setAttribute("normal",new On(f,3)),this.setAttribute("uv",new On(g,2))}static fromJSON(e){return new Bu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ru extends Wc{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ru(e.radius,e.detail)}}class Lu extends Hn{constructor(e=1,t=.4,r=8,i=6,n=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},r=Math.floor(r),i=Math.floor(i);const s=[],o=[],a=[],l=[],c=new ai,u=new ai,p=new ai;for(let h=0;h<=r;h++)for(let s=0;s<=i;s++){const d=s/i*n,f=h/r*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(d),u.y=(e+t*Math.cos(f))*Math.sin(d),u.z=t*Math.sin(f),o.push(u.x,u.y,u.z),c.x=e*Math.cos(d),c.y=e*Math.sin(d),p.subVectors(u,c).normalize(),a.push(p.x,p.y,p.z),l.push(s/i),l.push(h/r)}for(let h=1;h<=r;h++)for(let e=1;e<=i;e++){const t=(i+1)*h+e-1,r=(i+1)*(h-1)+e-1,n=(i+1)*(h-1)+e,o=(i+1)*h+e;s.push(t,r,o),s.push(r,n,o)}this.setIndex(s),this.setAttribute("position",new On(o,3)),this.setAttribute("normal",new On(a,3)),this.setAttribute("uv",new On(l,2))}static fromJSON(e){return new Lu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ou extends Hn{constructor(e=1,t=.4,r=64,i=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:s},r=Math.floor(r),i=Math.floor(i);const o=[],a=[],l=[],c=[],u=new ai,p=new ai,h=new ai,d=new ai,f=new ai,g=new ai,m=new ai;for(let v=0;v<=r;++v){const o=v/r*n*Math.PI*2;_(o,n,s,e,h),_(o+.01,n,s,e,d),g.subVectors(d,h),m.addVectors(d,h),f.crossVectors(g,m),m.crossVectors(f,g),f.normalize(),m.normalize();for(let e=0;e<=i;++e){const n=e/i*Math.PI*2,s=-t*Math.cos(n),o=t*Math.sin(n);u.x=h.x+(s*m.x+o*f.x),u.y=h.y+(s*m.y+o*f.y),u.z=h.z+(s*m.z+o*f.z),a.push(u.x,u.y,u.z),p.subVectors(u,h).normalize(),l.push(p.x,p.y,p.z),c.push(v/r),c.push(e/i)}}for(let v=1;v<=r;v++)for(let e=1;e<=i;e++){const t=(i+1)*(v-1)+(e-1),r=(i+1)*v+(e-1),n=(i+1)*v+e,s=(i+1)*(v-1)+e;o.push(t,r,s),o.push(r,n,s)}function _(e,t,r,i,n){const s=Math.cos(e),o=Math.sin(e),a=r/t*e,l=Math.cos(a);n.x=i*(2+l)*.5*s,n.y=i*(2+l)*o*.5,n.z=i*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new On(a,3)),this.setAttribute("normal",new On(l,3)),this.setAttribute("uv",new On(c,2))}static fromJSON(e){return new Ou(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Fu extends Hn{constructor(e=new Oc(new ai(-1,-1,0),new ai(-1,1,0),new ai(1,1,0)),t=64,r=1,i=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n};const s=e.computeFrenetFrames(t,n);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new ai,a=new ai,l=new kr;let c=new ai;const u=[],p=[],h=[],d=[];function f(n){c=e.getPointAt(n/t,c);const l=s.normals[n],h=s.binormals[n];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,n=Math.sin(t),s=-Math.cos(t);a.x=s*l.x+n*h.x,a.y=s*l.y+n*h.y,a.z=s*l.z+n*h.z,a.normalize(),p.push(a.x,a.y,a.z),o.x=c.x+r*a.x,o.y=c.y+r*a.y,o.z=c.z+r*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===n?t:0),function(){for(let e=0;e<=t;e++)for(let r=0;r<=i;r++)l.x=e/t,l.y=r/i,h.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const r=(i+1)*(e-1)+(t-1),n=(i+1)*e+(t-1),s=(i+1)*e+t,o=(i+1)*(e-1)+t;d.push(r,n,o),d.push(n,s,o)}}()}(),this.setIndex(d),this.setAttribute("position",new On(u,3)),this.setAttribute("normal",new On(p,3)),this.setAttribute("uv",new On(h,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Fu((new Uc[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Uu extends Hn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],r=new Set,i=new ai,n=new ai;if(null!==e.index){const s=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let l=0;l<3;l++){const a=o.getX(e+l),c=o.getX(e+(l+1)%3);i.fromBufferAttribute(s,a),n.fromBufferAttribute(s,c),!0===Nu(i,n,r)&&(t.push(i.x,i.y,i.z),t.push(n.x,n.y,n.z))}}}else{const s=e.attributes.position;for(let e=0,o=s.count/3;e<o;e++)for(let a=0;a<3;a++){const o=3*e+a,l=3*e+(a+1)%3;i.fromBufferAttribute(s,o),n.fromBufferAttribute(s,l),!0===Nu(i,n,r)&&(t.push(i.x,i.y,i.z),t.push(n.x,n.y,n.z))}}this.setAttribute("position",new On(t,3))}}}function Nu(e,t,r){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==r.has(i)&&!0!==r.has(n)&&(r.add(i),r.add(n),!0)}var ju=Object.freeze({__proto__:null,BoxGeometry:ps,CapsuleGeometry:zc,CircleGeometry:Vc,ConeGeometry:Hc,CylinderGeometry:Qc,DodecahedronGeometry:qc,EdgesGeometry:Zc,ExtrudeGeometry:Mu,IcosahedronGeometry:Iu,LatheGeometry:Gc,OctahedronGeometry:ku,PlaneGeometry:Ds,PolyhedronGeometry:Wc,RingGeometry:Du,ShapeGeometry:Pu,SphereGeometry:Bu,TetrahedronGeometry:Ru,TorusGeometry:Lu,TorusKnotGeometry:Ou,TubeGeometry:Fu,WireframeGeometry:Uu});class Gu extends wn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Wr(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class zu extends gs{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Vu extends wn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Wr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ot,this.normalScale=new kr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Qu extends Vu{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new kr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return br(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Wr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Wr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Wr(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Hu extends wn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Wr(16777215),this.specular=new Wr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ot,this.normalScale=new kr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Wu extends wn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Wr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ot,this.normalScale=new kr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class qu extends wn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ot,this.normalScale=new kr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Xu extends wn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Wr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ot,this.normalScale=new kr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=q,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Yu extends wn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Wr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ot,this.normalScale=new kr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ku extends Jl{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Ju(e,t,r){return $u(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)}function Zu(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function $u(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ep(e){const t=e.length,r=new Array(t);for(let i=0;i!==t;++i)r[i]=i;return r.sort(function(t,r){return e[t]-e[r]}),r}function tp(e,t,r){const i=e.length,n=new e.constructor(i);for(let s=0,o=0;o!==i;++s){const i=r[s]*t;for(let r=0;r!==t;++r)n[o++]=e[i+r]}return n}function rp(e,t,r,i){let n=1,s=e[0];for(;void 0!==s&&void 0===s[i];)s=e[n++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=s[i])&&(t.push(s.time),r.push.apply(r,o)),s=e[n++]}while(void 0!==s);else if(void 0!==o.toArray)do{void 0!==(o=s[i])&&(t.push(s.time),o.toArray(r,r.length)),s=e[n++]}while(void 0!==s);else do{void 0!==(o=s[i])&&(t.push(s.time),r.push(o)),s=e[n++]}while(void 0!==s)}var ip=Object.freeze({__proto__:null,arraySlice:Ju,convertArray:Zu,isTypedArray:$u,getKeyframeOrder:ep,sortedArray:tp,flattenJSON:rp,subclip:function(e,t,r,i,n=30){const s=e.clone();s.name=t;const o=[];for(let l=0;l<s.tracks.length;++l){const e=s.tracks[l],t=e.getValueSize(),a=[],c=[];for(let s=0;s<e.times.length;++s){const o=e.times[s]*n;if(!(o<r||o>=i)){a.push(e.times[s]);for(let r=0;r<t;++r)c.push(e.values[s*t+r])}}0!==a.length&&(e.times=Zu(a,e.times.constructor),e.values=Zu(c,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,r=e,i=30){i<=0&&(i=30);const n=r.tracks.length,s=t/i;for(let o=0;o<n;++o){const t=r.tracks[o],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const n=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===i});if(void 0===n)continue;let a=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const p=t.times.length-1;let h;if(s<=t.times[0]){const e=a,r=l-a;h=Ju(t.values,e,r)}else if(s>=t.times[p]){const e=p*l+a,r=e+l-a;h=Ju(t.values,e,r)}else{const e=t.createInterpolant(),r=a,i=l-a;e.evaluate(s),h=Ju(e.resultBuffer,r,i)}"quaternion"===i&&(new oi).fromArray(h).normalize().conjugate().toArray(h);const d=n.times.length;for(let e=0;e<d;++e){const t=e*u+c;if("quaternion"===i)oi.multiplyQuaternionsFlat(n.values,t,h,0,n.values,t);else{const e=u-2*c;for(let r=0;r<e;++r)n.values[t+r]-=h[r]}}}return e.blendMode=Ct,e}});class np{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{let s;r:{i:if(!(e<i)){for(let s=r+2;;){if(void 0===i){if(e<n)break i;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===s)break;if(n=i,e<(i=t[++r]))break t}s=t.length;break r}if(e>=n)break e;{const o=t[1];e<o&&(r=2,n=o);for(let s=r-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(r===s)break;if(i=n,e>=(n=t[--r-1]))break t}s=r,r=0}}for(;r<s;){const i=r+s>>>1;e<t[i]?s=i:r=i+1}if(i=t[r],void 0===(n=t[r-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i;for(let s=0;s!==i;++s)t[s]=r[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class sp extends np{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:yt,endingEnd:yt}}intervalChanged_(e,t,r){const i=this.parameterPositions;let n=e-2,s=e+1,o=i[n],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case wt:n=e,o=2*t-r;break;case Et:o=t+i[n=i.length-2]-i[n+1];break;default:n=e,o=r}if(void 0===a)switch(this.getSettings_().endingEnd){case wt:s=e,a=2*r-t;break;case Et:s=1,a=r+i[1]-i[0];break;default:s=e-1,a=t}const l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-r),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(e,t,r,i){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,u=this._offsetNext,p=this._weightPrev,h=this._weightNext,d=(r-t)/(i-t),f=d*d,g=f*d,m=-p*g+2*p*f-p*d,_=(1+p)*g+(-1.5-2*p)*f+(-.5+p)*d+1,v=(-1-h)*g+(1.5+h)*f+.5*d,x=h*g-h*f;for(let A=0;A!==o;++A)n[A]=m*s[c+A]+_*s[l+A]+v*s[a+A]+x*s[u+A];return n}}class op extends np{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(r-t)/(i-t),u=1-c;for(let p=0;p!==o;++p)n[p]=s[l+p]*u+s[a+p]*c;return n}}class ap extends np{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class lp{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Zu(t,this.TimeBufferType),this.values=Zu(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Zu(e.times,Array),values:Zu(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(r.interpolation=t)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new ap(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new op(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new sp(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case xt:t=this.InterpolantFactoryMethodDiscrete;break;case At:t=this.InterpolantFactoryMethodLinear;break;case bt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xt;case this.InterpolantFactoryMethodLinear:return At;case this.InterpolantFactoryMethodSmooth:return bt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let n=0,s=i-1;for(;n!==i&&r[n]<e;)++n;for(;-1!==s&&r[s]>t;)--s;if(++s,0!==n||s!==i){n>=s&&(n=(s=Math.max(s,1))-1);const e=this.getValueSize();this.times=Ju(r,n,s),this.values=Ju(this.values,n*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let o=0;o!==n;o++){const t=r[o];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==s&&s>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,t,s),e=!1;break}s=t}if(void 0!==i&&$u(i))for(let o=0,a=i.length;o!==a;++o){const t=i[o];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=Ju(this.times),t=Ju(this.values),r=this.getValueSize(),i=this.getInterpolation()===bt,n=e.length-1;let s=1;for(let o=1;o<n;++o){let n=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(i)n=!0;else{const e=o*r,i=e-r,s=e+r;for(let o=0;o!==r;++o){const r=t[e+o];if(r!==t[i+o]||r!==t[s+o]){n=!0;break}}}if(n){if(o!==s){e[s]=e[o];const i=o*r,n=s*r;for(let e=0;e!==r;++e)t[n+e]=t[i+e]}++s}}if(n>0){e[s]=e[n];for(let e=n*r,i=s*r,o=0;o!==r;++o)t[i+o]=t[e+o];++s}return s!==e.length?(this.times=Ju(e,0,s),this.values=Ju(t,0,s*r)):(this.times=e,this.values=t),this}clone(){const e=Ju(this.times,0),t=Ju(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}lp.prototype.TimeBufferType=Float32Array,lp.prototype.ValueBufferType=Float32Array,lp.prototype.DefaultInterpolation=At;class cp extends lp{}cp.prototype.ValueTypeName="bool",cp.prototype.ValueBufferType=Array,cp.prototype.DefaultInterpolation=xt,cp.prototype.InterpolantFactoryMethodLinear=void 0,cp.prototype.InterpolantFactoryMethodSmooth=void 0;class up extends lp{}up.prototype.ValueTypeName="color";class pp extends lp{}pp.prototype.ValueTypeName="number";class hp extends np{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(r-t)/(i-t);let l=e*o;for(let c=l+o;l!==c;l+=4)oi.slerpFlat(n,0,s,l-o,s,l,a);return n}}class dp extends lp{InterpolantFactoryMethodLinear(e){return new hp(this.times,this.values,this.getValueSize(),e)}}dp.prototype.ValueTypeName="quaternion",dp.prototype.DefaultInterpolation=At,dp.prototype.InterpolantFactoryMethodSmooth=void 0;class fp extends lp{}fp.prototype.ValueTypeName="string",fp.prototype.ValueBufferType=Array,fp.prototype.DefaultInterpolation=xt,fp.prototype.InterpolantFactoryMethodLinear=void 0,fp.prototype.InterpolantFactoryMethodSmooth=void 0;class gp extends lp{}gp.prototype.ValueTypeName="vector";class mp{constructor(e,t=-1,r,i=St){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=Ar(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,i=1/(e.fps||1);for(let s=0,o=r.length;s!==o;++s)t.push(_p(r[s]).scale(i));const n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){const t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=r.length;n!==s;++n)t.push(lp.toJSON(r[n]));return i}static CreateFromMorphTargetSequence(e,t,r,i){const n=t.length,s=[];for(let o=0;o<n;o++){let e=[],a=[];e.push((o+n-1)%n,o,(o+1)%n),a.push(0,1,0);const l=ep(e);e=tp(e,1,l),a=tp(a,1,l),i||0!==e[0]||(e.push(n),a.push(a[0])),s.push(new pp(".morphTargetInfluences["+t[o].name+"]",e,a).scale(1/r))}return new this(e,-1,s)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const t=e;r=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const i={},n=/^([\w-]*?)([\d]+)$/;for(let o=0,a=e.length;o<a;o++){const t=e[o],r=t.name.match(n);if(r&&r.length>1){const e=r[1];let n=i[e];n||(i[e]=n=[]),n.push(t)}}const s=[];for(const o in i)s.push(this.CreateFromMorphTargetSequence(o,i[o],t,r));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(e,t,r,i,n){if(0!==r.length){const s=[],o=[];rp(r,s,o,i),0!==s.length&&n.push(new e(t,s,o))}},i=[],n=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let r;for(r=0;r<e.length;r++)if(e[r].morphTargets)for(let i=0;i<e[r].morphTargets.length;i++)t[e[r].morphTargets[i]]=-1;for(const n in t){const t=[],s=[];for(let i=0;i!==e[r].morphTargets.length;++i){const i=e[r];t.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new pp(".morphTargetInfluence["+n+"]",t,s))}a=t.length*s}else{const n=".bones["+t[c].name+"]";r(gp,n+".position",e,"pos",i),r(dp,n+".quaternion",e,"rot",i),r(gp,n+".scale",e,"scl",i)}}return 0===i.length?null:new this(n,a,i,o)}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){const r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function _p(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pp;case"vector":case"vector2":case"vector3":case"vector4":return gp;case"color":return up;case"quaternion":return dp;case"bool":case"boolean":return cp;case"string":return fp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],r=[];rp(e.keys,t,r,"value"),e.times=t,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const vp={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e,t){return!1===this.enabled?t?Promise.resolve():void 0:t?Promise.resolve(this.files[e]):this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class xp{constructor(e,t,r){const i=this;let n,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===s&&void 0!==i.onStart&&i.onStart(e,o,a),s=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,r=l.length;t<r;t+=2){const r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}}const Ap=new xp;class bp{constructor(e){this.manager=void 0!==e?e:Ap,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,n){r.load(e,i,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const yp={};class wp extends Error{constructor(e,t){super(e),this.response=t}}class Ep extends bp{constructor(e){super(e),this.responseType="text"}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),vp.get(e,this.responseType,this.mimeType).then(n=>{if(void 0!==n)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(void 0!==yp[e])return void yp[e].push({onLoad:t,onProgress:r,onError:i});yp[e]=[],yp[e].push({onLoad:t,onProgress:r,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const r=yp[e],i=t.body.getReader(),n=t.headers.get("Content-Length"),s=n?parseInt(n):0,o=0!==s;let a=0;const l=new ReadableStream({start(e){!function t(){i.read().then(({done:i,value:n})=>{if(i)e.close();else{a+=n.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onProgress&&t.onProgress(i)}e.enqueue(n),t()}})}()}});return new Response(l)}throw new wp(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,o));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),r=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(r);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(t=>{vp.add(e,t,this.responseType);const r=yp[e];delete yp[e];for(let e=0,i=r.length;e<i;e++){const i=r[e];i.onLoad&&i.onLoad(t)}}).catch(t=>{const r=yp[e];if(void 0===r)throw this.manager.itemError(e),t;delete yp[e];for(let e=0,i=r.length;e<i;e++){const i=r[e];i.onError&&i.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)})}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Sp extends bp{constructor(e){super(e)}load(e,t,r,i){const n=this,s=new Ep(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){const t=[];for(let r=0;r<e.length;r++){const i=mp.parse(e[r]);t.push(i)}return t}}class Cp extends bp{constructor(e){super(e)}load(e,t,r,i){const n=this,s=[],o=new _c,a=new Ep(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(n.withCredentials);let l=0;function c(c){a.load(e[c],function(e){const r=n.parse(e,!0);s[c]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(l+=1)&&(1===r.mipmapCount&&(o.minFilter=me),o.image=s,o.format=r.format,o.needsUpdate=!0,t&&t(o))},r,i)}if(Array.isArray(e))for(let u=0,p=e.length;u<p;++u)c(u);else a.load(e,function(e){const r=n.parse(e,!0);if(r.isCubemap){const e=r.mipmaps.length/r.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)s[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),s[t].format=r.format,s[t].width=r.width,s[t].height=r.height}o.image=s}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=me),o.format=r.format,o.needsUpdate=!0,t&&t(o)},r,i);return o}}class Mp extends bp{constructor(e){super(e)}load(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,s=vp.get(e);if(void 0!==s)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;const o=Lr("img");function a(){c(),vp.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){c(),i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(e),o.src=e,o}}class Tp extends bp{constructor(e){super(e)}load(e,t,r,i){const n=new As,s=new Mp(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(r){s.load(e[r],function(e){n.images[r]=e,6===++o&&(n.needsUpdate=!0,t&&t(n))},void 0,i)}for(let l=0;l<e.length;++l)a(l);return n}}class Ip extends bp{constructor(e){super(e)}load(e,t,r,i){const n=this,s=new Gl,o=new Ep(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(n.withCredentials),o.load(e,function(e){const r=n.parse(e);r&&(void 0!==r.image?s.image=r.image:void 0!==r.data&&(s.image.width=r.width,s.image.height=r.height,s.image.data=r.data,s.image.complete=!0),s.wrapS=void 0!==r.wrapS?r.wrapS:ce,s.wrapT=void 0!==r.wrapT?r.wrapT:ce,s.magFilter=void 0!==r.magFilter?r.magFilter:me,s.minFilter=void 0!==r.minFilter?r.minFilter:me,s.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.encoding&&(s.encoding=r.encoding),void 0!==r.flipY&&(s.flipY=r.flipY),void 0!==r.format&&(s.format=r.format),void 0!==r.type&&(s.type=r.type),void 0!==r.mipmaps&&(s.mipmaps=r.mipmaps,s.minFilter=xe),1===r.mipmapCount&&(s.minFilter=me),void 0!==r.generateMipmaps&&(s.generateMipmaps=r.generateMipmaps),s.needsUpdate=!0,t&&t(s,r))},r,i),s}}class kp extends bp{constructor(e){super(e)}load(e,t,r,i){const n=new Zr,s=new Mp(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n}}class Dp extends un{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Wr(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class Pp extends Dp{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(un.DefaultUp),this.updateMatrix(),this.groundColor=new Wr(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Bp=new Ui,Rp=new ai,Lp=new ai;class Op{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new kr(512,512),this.map=null,this.mapPass=null,this.matrix=new Ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ts,this._frameExtents=new kr(1,1),this._viewportCount=1,this._viewports=[new $r(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;Rp.setFromMatrixPosition(e.matrixWorld),t.position.copy(Rp),Lp.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Lp),t.updateMatrixWorld(),Bp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bp),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.normalBias=e.normalBias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Fp extends Op{constructor(){super(new _s(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*xr*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;r===t.fov&&i===t.aspect&&n===t.far||(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Up extends Dp{constructor(e,t,r=0,i=Math.PI/3,n=0,s=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(un.DefaultUp),this.updateMatrix(),this.target=new un,this.distance=r,this.angle=i,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new Fp}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Np=new Ui,jp=new ai,Gp=new ai;class zp extends Op{constructor(){super(new _s(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new kr(4,2),this._viewportCount=6,this._viewports=[new $r(2,1,1,1),new $r(0,1,1,1),new $r(3,1,1,1),new $r(1,1,1,1),new $r(3,0,1,1),new $r(1,0,1,1)],this._cubeDirections=[new ai(1,0,0),new ai(-1,0,0),new ai(0,0,1),new ai(0,0,-1),new ai(0,1,0),new ai(0,-1,0)],this._cubeUps=[new ai(0,1,0),new ai(0,1,0),new ai(0,1,0),new ai(0,1,0),new ai(0,0,1),new ai(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),jp.setFromMatrixPosition(e.matrixWorld),r.position.copy(jp),Gp.copy(r.position),Gp.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(Gp),r.updateMatrixWorld(),i.makeTranslation(-jp.x,-jp.y,-jp.z),Np.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Np)}}class Vp extends Dp{constructor(e,t,r=0,i=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new zp}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Qp extends Op{constructor(){super(new Gs(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Hp extends Dp{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(un.DefaultUp),this.updateMatrix(),this.target=new un,this.shadow=new Qp}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Wp extends Dp{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class qp extends Dp{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Xp{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ai)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,i=e.y,n=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*n),t.addScaledVector(s[3],.488603*r),t.addScaledVector(s[4],r*i*1.092548),t.addScaledVector(s[5],i*n*1.092548),t.addScaledVector(s[6],.315392*(3*n*n-1)),t.addScaledVector(s[7],r*n*1.092548),t.addScaledVector(s[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){const r=e.x,i=e.y,n=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*i),t.addScaledVector(s[2],1.023328*n),t.addScaledVector(s[3],1.023328*r),t.addScaledVector(s[4],.858086*r*i),t.addScaledVector(s[5],.858086*i*n),t.addScaledVector(s[6],.743125*n*n-.247708),t.addScaledVector(s[7],.858086*r*n),t.addScaledVector(s[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const r=e.x,i=e.y,n=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*n,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*r*n,t[8]=.546274*(r*r-i*i)}}class Yp extends Dp{constructor(e=new Xp,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Kp extends bp{constructor(e){super(e),this.textures={}}load(e,t,r,i){const n=this,s=new Ep(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){const t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=Kp.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new Wr).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const n in e.uniforms){const t=e.uniforms[n];switch(i.uniforms[n]={},t.type){case"t":i.uniforms[n].value=r(t.value);break;case"c":i.uniforms[n].value=(new Wr).setHex(t.value);break;case"v2":i.uniforms[n].value=(new kr).fromArray(t.value);break;case"v3":i.uniforms[n].value=(new ai).fromArray(t.value);break;case"v4":i.uniforms[n].value=(new $r).fromArray(t.value);break;case"m3":i.uniforms[n].value=(new Dr).fromArray(t.value);break;case"m4":i.uniforms[n].value=(new Ui).fromArray(t.value);break;default:i.uniforms[n].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const n in e.extensions)i.extensions[n]=e.extensions[n];if(void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=r(e.map)),void 0!==e.matcap&&(i.matcap=r(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new kr).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=r(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=r(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=r(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=r(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new kr).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=r(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=r(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=r(e.thicknessMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=r(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Gu,SpriteMaterial:gl,RawShaderMaterial:zu,ShaderMaterial:gs,PointsMaterial:lc,MeshPhysicalMaterial:Qu,MeshStandardMaterial:Vu,MeshPhongMaterial:Hu,MeshToonMaterial:Wu,MeshNormalMaterial:qu,MeshLambertMaterial:Xu,MeshDepthMaterial:qa,MeshDistanceMaterial:Xa,MeshBasicMaterial:En,MeshMatcapMaterial:Yu,LineDashedMaterial:Ku,LineBasicMaterial:Jl,Material:wn}[e]}}class Jp{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Zp extends Hn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class $p extends bp{constructor(e){super(e)}load(e,t,r,i){const n=this,s=new Ep(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){const t={},r={};function i(e,i){if(void 0!==t[i])return t[i];const n=e.interleavedBuffers[i],s=function(e,t){if(void 0!==r[t])return r[t];const i=e.arrayBuffers[t],n=new Uint32Array(i).buffer;return r[t]=n,n}(e,n.buffer),o=Rr(n.type,s),a=new hl(o,n.stride);return a.uuid=n.uuid,t[i]=a,a}const n=e.isInstancedBufferGeometry?new Zp:new Hn,s=e.data.index;if(void 0!==s){const e=Rr(s.type,s.array);n.setIndex(new Mn(e,1))}const o=e.data.attributes;for(const u in o){const t=o[u];let r;if(t.isInterleavedBufferAttribute){const n=i(e.data,t.data);r=new fl(n,t.itemSize,t.offset,t.normalized)}else{const e=Rr(t.type,t.array);r=new(t.isInstancedBufferAttribute?Hl:Mn)(e,t.itemSize,t.normalized)}void 0!==t.name&&(r.name=t.name),void 0!==t.usage&&r.setUsage(t.usage),void 0!==t.updateRange&&(r.updateRange.offset=t.updateRange.offset,r.updateRange.count=t.updateRange.count),n.setAttribute(u,r)}const a=e.data.morphAttributes;if(a)for(const u in a){const t=a[u],r=[];for(let n=0,s=t.length;n<s;n++){const s=t[n];let o;if(s.isInterleavedBufferAttribute){const t=i(e.data,s.data);o=new fl(t,s.itemSize,s.offset,s.normalized)}else{const e=Rr(s.type,s.array);o=new Mn(e,s.itemSize,s.normalized)}void 0!==s.name&&(o.name=s.name),r.push(o)}n.morphAttributes[u]=r}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,p=l.length;u!==p;++u){const e=l[u];n.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new ai;void 0!==c.center&&e.fromArray(c.center),n.boundingSphere=new Ii(e,c.radius)}return e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}}class eh extends bp{constructor(e){super(e)}load(e,t,r,i){const n=this,s=""===this.path?Jp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new Ep(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){let s=null;try{s=JSON.parse(r)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?n.parse(s,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,i)}async loadAsync(e,t){const r=""===this.path?Jp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const i=new Ep(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const n=await i.loadAsync(e,t),s=JSON.parse(n),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,function(){void 0!==t&&t(l)}),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,n,a,o,r),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),n=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,s),a=this.parseObject(e.object,i,o,s,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(void 0!==e)for(let r=0,i=e.length;r<i;r++){const i=(new $c).fromJSON(e[r]);t[i.uuid]=i}return t}parseSkeletons(e,t){const r={},i={};if(t.traverse(function(e){e.isBone&&(i[e.uuid]=e)}),void 0!==e)for(let n=0,s=e.length;n<s;n++){const t=(new Ql).fromJSON(e[n],i);r[t.uuid]=t}return r}parseGeometries(e,t){const r={};if(void 0!==e){const i=new $p;for(let n=0,s=e.length;n<s;n++){let s;const o=e[n];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(o);break;default:o.type in ju?s=ju[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),r[o.uuid]=s}}return r}parseMaterials(e,t){const r={},i={};if(void 0!==e){const n=new Kp;n.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===r[s.uuid]&&(r[s.uuid]=n.parse(s)),i[s.uuid]=r[s.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let r=0;r<e.length;r++){const i=e[r],n=mp.parse(i);t[n.uuid]=n}return t}parseImages(e,t){const r=this,i={};let n;function s(e){if("string"==typeof e){const t=e;return function(e){return r.manager.itemStart(e),n.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t)}return e.data?{data:Rr(e.type,e.data),width:e.width,height:e.height,complete:!0}:null}if(void 0!==e&&e.length>0){const r=new xp(t);(n=new Mp(r)).setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const r=e[t],n=r.url;if(Array.isArray(n)){const e=[];for(let t=0,r=n.length;t<r;t++){const r=s(n[t]);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new Gl(r.data,r.width,r.height)))}i[r.uuid]=new Yr(e)}else{const e=s(r.url);i[r.uuid]=new Yr(e)}}}return i}async parseImagesAsync(e){const t=this,r={};let i;async function n(e){if("string"==typeof e){const r=e,n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:t.resourcePath+r;return await i.loadAsync(n)}return e.data?{data:Rr(e.type,e.data),width:e.width,height:e.height,complete:!0}:null}if(void 0!==e&&e.length>0){(i=new Mp(this.manager)).setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){const e=[];for(let t=0,r=s.length;t<r;t++){const r=s[t],i=await n(r);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new Gl(i.data,i.width,i.height)))}r[i.uuid]=new Yr(e)}else{const e=await n(i.url);r[i.uuid]=new Yr(e)}}}return r}parseTextures(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let n=0,s=e.length;n<s;n++){const s=e[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=t[s.image],a=o?o.data:void 0;let l;Array.isArray(a)?(l=new As,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new Gl:new Zr,a&&a.complete&&(l.needsUpdate=!0)),l.source=o,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=r(s.mapping,th)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=r(s.wrap[0],rh),l.wrapT=r(s.wrap[1],rh)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=r(s.minFilter,ih)),void 0!==s.magFilter&&(l.magFilter=r(s.magFilter,ih)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),i[s.uuid]=l}return i}parseObject(e,t,r,i,n){let s,o,a;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];void 0===r[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(r[n])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}function u(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":s=new pl,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new Wr(e.background):s.background=u(e.background)),void 0!==e.environment&&(s.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new ul(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new cl(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new _s(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new Gs(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new Wp(e.color,e.intensity);break;case"DirectionalLight":s=new Hp(e.color,e.intensity);break;case"PointLight":s=new Vp(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new qp(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Up(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new Pp(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new Yp).fromJSON(e);break;case"SkinnedMesh":o=l(e.geometry),a=c(e.material),s=new Nl(o,a),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":o=l(e.geometry),a=c(e.material),s=new cs(o,a);break;case"InstancedMesh":o=l(e.geometry),a=c(e.material);const t=e.count,r=e.instanceMatrix,i=e.instanceColor;(s=new Kl(o,a,t)).instanceMatrix=new Hl(new Float32Array(r.array),16),void 0!==i&&(s.instanceColor=new Hl(new Float32Array(i.array),i.itemSize));break;case"LOD":s=new Bl;break;case"Line":s=new ic(l(e.geometry),c(e.material));break;case"LineLoop":s=new ac(l(e.geometry),c(e.material));break;case"LineSegments":s=new oc(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":s=new dc(l(e.geometry),c(e.material));break;case"Sprite":s=new Il(c(e.material));break;case"Group":s=new el;break;case"Bone":s=new jl;break;default:s=new un}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)s.add(this.parseObject(o[e],t,r,i,n))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const r=t[e];s.animations.push(n[r])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const r=t[e],i=s.getObjectByProperty("uuid",r.object);void 0!==i&&s.addLevel(i,r.distance)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const r=t[e.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(r,e.bindMatrix)}})}}const th={UVMapping:re,CubeReflectionMapping:ie,CubeRefractionMapping:ne,EquirectangularReflectionMapping:se,EquirectangularRefractionMapping:oe,CubeUVReflectionMapping:ae},rh={RepeatWrapping:le,ClampToEdgeWrapping:ce,MirroredRepeatWrapping:ue},ih={NearestFilter:pe,NearestMipmapNearestFilter:he,NearestMipmapLinearFilter:fe,LinearFilter:me,LinearMipmapNearestFilter:_e,LinearMipmapLinearFilter:xe};class nh extends bp{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,s=vp.get(e);if(void 0!==s)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(r){vp.add(e,r),t&&t(r),n.manager.itemEnd(e)}).catch(function(t){i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)}),n.manager.itemStart(e)}}let sh;const oh={getContext:function(){return void 0===sh&&(sh=new(window.AudioContext||window.webkitAudioContext)),sh},setContext:function(e){sh=e}};class ah extends bp{constructor(e){super(e)}load(e,t,r,i){const n=this,s=new Ep(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(e){try{const r=e.slice(0);oh.getContext().decodeAudioData(r,function(e){t(e)})}catch(t){i?i(t):console.error(t),n.manager.itemError(r)}},r,i)}}class lh extends Yp{constructor(e,t,r=1){super(void 0,r),this.isHemisphereLightProbe=!0;const i=(new Wr).set(e),n=(new Wr).set(t),s=new ai(i.r,i.g,i.b),o=new ai(n.r,n.g,n.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(l)}}class ch extends Yp{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const r=(new Wr).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const uh=new Ui,ph=new Ui,hh=new Ui;class dh{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new _s,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new _s,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,hh.copy(e.projectionMatrix);const r=t.eyeSep/2,i=r*t.near/t.focus,n=t.near*Math.tan(vr*t.fov*.5)/t.zoom;let s,o;ph.elements[12]=-r,uh.elements[12]=r,s=-n*t.aspect+i,o=n*t.aspect+i,hh.elements[0]=2*t.near/(o-s),hh.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(hh),s=-n*t.aspect-i,o=n*t.aspect-i,hh.elements[0]=2*t.near/(o-s),hh.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(hh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(ph),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(uh)}}class fh{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=gh();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function gh(){return("undefined"==typeof performance?Date:performance).now()}const mh=new ai,_h=new oi,vh=new ai,xh=new ai;class Ah extends un{constructor(){super(),this.type="AudioListener",this.context=oh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new fh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(mh,_h,vh),xh.set(0,0,-1).applyQuaternion(_h),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(mh.x,e),t.positionY.linearRampToValueAtTime(mh.y,e),t.positionZ.linearRampToValueAtTime(mh.z,e),t.forwardX.linearRampToValueAtTime(xh.x,e),t.forwardY.linearRampToValueAtTime(xh.y,e),t.forwardZ.linearRampToValueAtTime(xh.z,e),t.upX.linearRampToValueAtTime(r.x,e),t.upY.linearRampToValueAtTime(r.y,e),t.upZ.linearRampToValueAtTime(r.z,e)}else t.setPosition(mh.x,mh.y,mh.z),t.setOrientation(xh.x,xh.y,xh.z,r.x,r.y,r.z)}}class bh extends un{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const yh=new ai,wh=new oi,Eh=new ai,Sh=new ai;class Ch extends bh{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(yh,wh,Eh),Sh.set(0,0,1).applyQuaternion(wh);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(yh.x,e),t.positionY.linearRampToValueAtTime(yh.y,e),t.positionZ.linearRampToValueAtTime(yh.z,e),t.orientationX.linearRampToValueAtTime(Sh.x,e),t.orientationY.linearRampToValueAtTime(Sh.y,e),t.orientationZ.linearRampToValueAtTime(Sh.z,e)}else t.setPosition(yh.x,yh.y,yh.z),t.setOrientation(Sh.x,Sh.y,Sh.z)}}class Mh{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}class Th{constructor(e,t,r){let i,n,s;switch(this.binding=e,this.valueSize=r,t){case"quaternion":i=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,i=this.valueSize,n=e*i+i;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==i;++e)r[n+e]=r[e];s=t}else{const e=t/(s+=t);this._mixBufferRegion(r,n,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const e=t*this._origIndex;this._mixBufferRegion(r,i,e,1-n,t)}s>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(r[a]!==r[a+t]){o.setValue(r,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let n=r,s=i;n!==s;++n)t[n]=t[i+n%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,n){if(i>=.5)for(let s=0;s!==n;++s)e[t+s]=e[r+s]}_slerp(e,t,r,i){oi.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,n){const s=this._workIndex*n;oi.multiplyQuaternionsFlat(e,s,e,t,e,r),oi.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,r,i,n){const s=1-i;for(let o=0;o!==n;++o){const n=t+o;e[n]=e[n]*s+e[r+o]*i}}_lerpAdditive(e,t,r,i,n){for(let s=0;s!==n;++s){const n=t+s;e[n]=e[n]+e[r+s]*i}}}const Ih=new RegExp("[\\[\\]\\.:\\/]","g"),kh="[^\\[\\]\\.:\\/]",Dh="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ph=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",kh)+/(WCOD+)?/.source.replace("WCOD",Dh)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",kh)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",kh)+"$"),Bh=["material","materials","bones","map"];class Rh{constructor(e,t,r){this.path=t,this.parsedPath=r||Rh.parseTrackName(t),this.node=Rh.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Rh.Composite(e,t,r):new Rh(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Ih,"")}static parseTrackName(e){const t=Ph.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=r.nodeName.substring(i+1);-1!==Bh.indexOf(e)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=e)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){const r=function(e){for(let i=0;i<e.length;i++){const n=e[i];if(n.name===t||n.uuid===t)return n;const s=r(n.children);if(s)return s}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,i=t.propertyName;let n=t.propertyIndex;if(e||(e=Rh.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let i=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const s=e[i];if(void 0===s){const r=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r+"."+i+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Rh.Composite=class{constructor(e,t,r){const i=r||Rh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}},Rh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Rh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Rh.prototype.GetterByBindingType=[Rh.prototype._getValue_direct,Rh.prototype._getValue_array,Rh.prototype._getValue_arrayElement,Rh.prototype._getValue_toArray],Rh.prototype.SetterByBindingTypeAndVersioning=[[Rh.prototype._setValue_direct,Rh.prototype._setValue_direct_setNeedsUpdate,Rh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Rh.prototype._setValue_array,Rh.prototype._setValue_array_setNeedsUpdate,Rh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Rh.prototype._setValue_arrayElement,Rh.prototype._setValue_arrayElement_setNeedsUpdate,Rh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Rh.prototype._setValue_fromArray,Rh.prototype._setValue_fromArray_setNeedsUpdate,Rh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Lh{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ar(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,i=arguments.length;r!==i;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,r=this._paths,i=this._parsedPaths,n=this._bindings,s=n.length;let o,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],p=u.uuid;let h=t[p];if(void 0===h){h=a++,t[p]=h,e.push(u);for(let e=0,t=s;e!==t;++e)n[e].push(new Rh(u,r[e],i[e]))}else if(h<l){o=e[h];const a=--l,c=e[a];t[c.uuid]=h,e[h]=c,t[p]=a,e[a]=u;for(let e=0,t=s;e!==t;++e){const t=n[e],s=t[a];let o=t[h];t[h]=s,void 0===o&&(o=new Rh(u,r[e],i[e])),t[a]=o}}else e[h]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let n=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,l=t[a];if(void 0!==l&&l>=n){const s=n++,c=e[s];t[c.uuid]=l,e[l]=c,t[a]=s,e[s]=o;for(let e=0,t=i;e!==t;++e){const t=r[e],i=t[s],n=t[l];t[l]=i,t[s]=n}}}this.nCachedObjects_=n}uncache(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let n=this.nCachedObjects_,s=e.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<n){const o=--n,a=e[o],c=--s,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=o,e[o]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=r[e],i=t[o],n=t[c];t[l]=i,t[o]=n,t.pop()}}else{const n=--s,o=e[n];n>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=i;e!==t;++e){const t=r[e];t[l]=t[n],t.pop()}}}this.nCachedObjects_=n}subscribe_(e,t){const r=this._bindingsIndicesByPath;let i=r[e];const n=this._bindings;if(void 0!==i)return n[i];const s=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);i=n.length,r[e]=i,s.push(e),o.push(t),n.push(u);for(let p=c,h=a.length;p!==h;++p){const r=a[p];u[p]=new Rh(r,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){const i=this._paths,n=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];t[e[o]]=r,s[r]=a,s.pop(),n[r]=n[o],n.pop(),i[r]=i[o],i.pop()}}}class Oh{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;const n=t.tracks,s=n.length,o=new Array(s),a={endingStart:yt,endingEnd:yt};for(let l=0;l!==s;++l){const e=n[l].createInterpolant(null);o[l]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=_t,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const r=this._clip.duration,i=e._clip.duration,n=i/r,s=r/i;e.warp(1,n,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const i=this._mixer,n=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=n,a[1]=n+r,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled)return void this._updateWeight(e);const n=this._startTime;if(null!==n){const i=(e-n)*r;i<0||0===r?t=0:(this._startTime=null,t=r*i)}t*=this._updateTimeScale(e);const s=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Ct)for(let r=0,i=e.length;r!==i;++r)e[r].evaluate(s),t[r].accumulateAdditive(o);else for(let r=0,n=e.length;r!==n;++r)e[r].evaluate(s),t[r].accumulate(i,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(null!==r){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;null!==r&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let i=this.time+e,n=this._loopCount;const s=r===vt;if(0===e)return-1===n?i:s&&1==(1&n)?t-i:i;if(r===mt){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0){const r=Math.floor(i/t);i-=t*r,n+=Math.abs(r);const o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=i;if(s&&1==(1&n))return t-i}return i}_setEndings(e,t,r){const i=this._interpolantSettings;r?(i.endingStart=wt,i.endingEnd=wt):(i.endingStart=e?this.zeroSlopeAtStart?wt:yt:Et,i.endingEnd=t?this.zeroSlopeAtEnd?wt:yt:Et)}_scheduleFading(e,t,r){const i=this._mixer,n=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=n,a[0]=t,o[1]=n+e,a[1]=r,this}}const Fh=new Float32Array(1);class Uh extends gr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,s=e._propertyBindings,o=e._interpolants,a=r.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==n;++u){const e=i[u],n=e.name;let l=c[n];if(void 0!==l)++l.referenceCount,s[u]=l;else{if(void 0!==(l=s[u])){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,n));continue}const i=t&&t._propertyBindings[u].binding.parsedPath;++(l=new Th(Rh.create(r,n,i),e.ValueTypeName,e.getValueSize())).referenceCount,this._addInactiveBinding(l,a,n),s[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}const t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){const r=t[e];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){const r=t[e];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,r){const i=this._actions,n=this._actionsByClip;let s=n[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;const n=e._clip.uuid,s=this._actionsByClip,o=s[n],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const e=t[r];0==--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_addInactiveBinding(e,t,r){const i=this._bindingsByRootAndName,n=this._bindings;let s=i[t];void 0===s&&(s={},i[t]=s),s[r]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,s=this._bindingsByRootAndName,o=s[i],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[n],0===Object.keys(o).length&&delete s[i]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return void 0===r&&((r=new op(new Float32Array(2),new Float32Array(2),1,Fh)).__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n}clipAction(e,t,r){const i=t||this._root,n=i.uuid;let s="string"==typeof e?mp.findByName(i,e):e;const o=null!==s?s.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===r&&(r=null!==s?s.blendMode:St),void 0!==a){const e=a.actionByRoot[n];if(void 0!==e&&e.blendMode===r)return e;l=a.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Oh(this,s,t,r);return this._bindAction(c,l),this._addInactiveAction(c,o,n),c}existingAction(e,t){const r=t||this._root,i=r.uuid,n="string"==typeof e?mp.findByName(r,e):e,s=n?n.uuid:e,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==r;++l)t[l]._update(i,e,n,s);const o=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)o[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){const e=n.knownActions;for(let r=0,i=e.length;r!==i;++r){const i=e[r];this._deactivateAction(i);const n=i._cacheIndex,s=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=n,t[n]=s,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const n in r){const e=r[n].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const n in i){const e=i[n];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Nh{constructor(e){this.value=e}clone(){return new Nh(void 0===this.value.clone?this.value:this.value.clone())}}let jh=0;class Gh extends gr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:jh++}),this.name="",this.usage=ir,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let r=0,i=t.length;r<i;r++)this.uniforms.push(t[r].clone());return this}clone(){return(new this.constructor).copy(this)}}class zh extends hl{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Vh{constructor(e,t,r,i,n){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=n,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class Qh{constructor(e,t,r=0,i=1/0){this.ray=new Fi(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Yi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return Wh(e,this,r,t),r.sort(Hh),r}intersectObjects(e,t=!0,r=[]){for(let i=0,n=e.length;i<n;i++)Wh(e[i],this,r,t);return r.sort(Hh),r}}function Hh(e,t){return e.distance-t.distance}function Wh(e,t,r,i){if(e.layers.test(t.layers)&&e.raycast(t,r),!0===i){const i=e.children;for(let e=0,n=i.length;e<n;e++)Wh(i[e],t,r,!0)}}class qh{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(br(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Xh{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Yh=new kr;class Kh{constructor(e=new kr(1/0,1/0),t=new kr(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Yh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Yh.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Jh=new ai,Zh=new ai;class $h{constructor(e=new ai,t=new ai){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Jh.subVectors(e,this.start),Zh.subVectors(this.end,this.start);const r=Zh.dot(Zh);let i=Zh.dot(Jh)/r;return t&&(i=br(i,0,1)),i}closestPointToPoint(e,t,r){const i=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const ed=new ai;class td extends un{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const r=new Hn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,o=1,a=32;s<a;s++,o++){const e=s/a*Math.PI*2,t=o/a*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}r.setAttribute("position",new On(i,3));const n=new Jl({fog:!1,toneMapped:!1});this.cone=new oc(r,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ed.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ed),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const rd=new ai,id=new Ui,nd=new Ui;class sd extends oc{constructor(e){const t=function e(t){const r=[];!0===t.isBone&&r.push(t);for(let i=0;i<t.children.length;i++)r.push.apply(r,e(t.children[i]));return r}(e),r=new Hn,i=[],n=[],s=new Wr(0,0,1),o=new Wr(0,1,0);for(let a=0;a<t.length;a++){const e=t[a];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(s.r,s.g,s.b),n.push(o.r,o.g,o.b))}r.setAttribute("position",new On(i,3)),r.setAttribute("color",new On(n,3)),super(r,new Jl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,r=this.geometry,i=r.getAttribute("position");nd.copy(this.root.matrixWorld).invert();for(let n=0,s=0;n<t.length;n++){const e=t[n];e.parent&&e.parent.isBone&&(id.multiplyMatrices(nd,e.matrixWorld),rd.setFromMatrixPosition(id),i.setXYZ(s,rd.x,rd.y,rd.z),id.multiplyMatrices(nd,e.parent.matrixWorld),rd.setFromMatrixPosition(id),i.setXYZ(s+1,rd.x,rd.y,rd.z),s+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}class od extends cs{constructor(e,t,r){super(new Bu(t,4,2),new En({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ad=new ai,ld=new Wr,cd=new Wr;class ud extends un{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;const i=new ku(t);i.rotateY(.5*Math.PI),this.material=new En({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const n=i.getAttribute("position"),s=new Float32Array(3*n.count);i.setAttribute("color",new Mn(s,3)),this.add(new cs(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");ld.copy(this.light.color),cd.copy(this.light.groundColor);for(let e=0,r=t.count;e<r;e++){const i=e<r/2?ld:cd;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(ad.setFromMatrixPosition(this.light.matrixWorld).negate())}}class pd extends oc{constructor(e=10,t=10,r=4473924,i=8947848){r=new Wr(r),i=new Wr(i);const n=t/2,s=e/t,o=e/2,a=[],l=[];for(let u=0,p=0,h=-o;u<=t;u++,h+=s){a.push(-o,0,h,o,0,h),a.push(h,0,-o,h,0,o);const e=u===n?r:i;e.toArray(l,p),p+=3,e.toArray(l,p),p+=3,e.toArray(l,p),p+=3,e.toArray(l,p),p+=3}const c=new Hn;c.setAttribute("position",new On(a,3)),c.setAttribute("color",new On(l,3)),super(c,new Jl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class hd extends oc{constructor(e=10,t=16,r=8,i=64,n=4473924,s=8947848){n=new Wr(n),s=new Wr(s);const o=[],a=[];if(t>1)for(let c=0;c<t;c++){const r=c/t*(2*Math.PI),i=Math.sin(r)*e,l=Math.cos(r)*e;o.push(0,0,0),o.push(i,0,l);const u=1&c?n:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let c=0;c<r;c++){const t=1&c?n:s,l=e-e/r*c;for(let e=0;e<i;e++){let r=e/i*(2*Math.PI),n=Math.sin(r)*l,s=Math.cos(r)*l;o.push(n,0,s),a.push(t.r,t.g,t.b),r=(e+1)/i*(2*Math.PI),n=Math.sin(r)*l,s=Math.cos(r)*l,o.push(n,0,s),a.push(t.r,t.g,t.b)}}const l=new Hn;l.setAttribute("position",new On(o,3)),l.setAttribute("color",new On(a,3)),super(l,new Jl({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const dd=new ai,fd=new ai,gd=new ai;class md extends un{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);let i=new Hn;i.setAttribute("position",new On([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const n=new Jl({fog:!1,toneMapped:!1});this.lightPlane=new ic(i,n),this.add(this.lightPlane),(i=new Hn).setAttribute("position",new On([0,0,0,0,0,1],3)),this.targetLine=new ic(i,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){dd.setFromMatrixPosition(this.light.matrixWorld),fd.setFromMatrixPosition(this.light.target.matrixWorld),gd.subVectors(fd,dd),this.lightPlane.lookAt(fd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(fd),this.targetLine.scale.z=gd.length()}}const _d=new ai,vd=new ms;class xd extends oc{constructor(e){const t=new Hn,r=new Jl({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],n=[],s={};function o(e,t){a(e),a(t)}function a(e){i.push(0,0,0),n.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(i.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),t.setAttribute("position",new On(i,3)),t.setAttribute("color",new On(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new Wr(16755200),c=new Wr(16711680),u=new Wr(43775),p=new Wr(16777215),h=new Wr(3355443);this.setColors(l,c,u,p,h)}setColors(e,t,r,i,n){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,r.r,r.g,r.b),s.setXYZ(33,r.r,r.g,r.b),s.setXYZ(34,r.r,r.g,r.b),s.setXYZ(35,r.r,r.g,r.b),s.setXYZ(36,r.r,r.g,r.b),s.setXYZ(37,r.r,r.g,r.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;vd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ad("c",t,e,vd,0,0,-1),Ad("t",t,e,vd,0,0,1),Ad("n1",t,e,vd,-1,-1,-1),Ad("n2",t,e,vd,1,-1,-1),Ad("n3",t,e,vd,-1,1,-1),Ad("n4",t,e,vd,1,1,-1),Ad("f1",t,e,vd,-1,-1,1),Ad("f2",t,e,vd,1,-1,1),Ad("f3",t,e,vd,-1,1,1),Ad("f4",t,e,vd,1,1,1),Ad("u1",t,e,vd,.7,1.1,-1),Ad("u2",t,e,vd,-.7,1.1,-1),Ad("u3",t,e,vd,0,2,-1),Ad("cf1",t,e,vd,-1,0,1),Ad("cf2",t,e,vd,1,0,1),Ad("cf3",t,e,vd,0,-1,1),Ad("cf4",t,e,vd,0,1,1),Ad("cn1",t,e,vd,-1,0,-1),Ad("cn2",t,e,vd,1,0,-1),Ad("cn3",t,e,vd,0,-1,-1),Ad("cn4",t,e,vd,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ad(e,t,r,i,n,s,o){_d.set(n,s,o).unproject(i);const a=t[e];if(void 0!==a){const e=r.getAttribute("position");for(let t=0,r=a.length;t<r;t++)e.setXYZ(a[t],_d.x,_d.y,_d.z)}}const bd=new ui;class yd extends oc{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new Hn;n.setIndex(new Mn(r,1)),n.setAttribute("position",new Mn(i,3)),super(n,new Jl({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&bd.setFromObject(this.object),bd.isEmpty())return;const t=bd.min,r=bd.max,i=this.geometry.attributes.position,n=i.array;n[0]=r.x,n[1]=r.y,n[2]=r.z,n[3]=t.x,n[4]=r.y,n[5]=r.z,n[6]=t.x,n[7]=t.y,n[8]=r.z,n[9]=r.x,n[10]=t.y,n[11]=r.z,n[12]=r.x,n[13]=r.y,n[14]=t.z,n[15]=t.x,n[16]=r.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=r.x,n[22]=t.y,n[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}}class wd extends oc{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Hn;i.setIndex(new Mn(r,1)),i.setAttribute("position",new On([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Jl({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Ed extends ic{constructor(e,t=1,r=16776960){const i=r,n=new Hn;n.setAttribute("position",new On([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere(),super(n,new Jl({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new Hn;s.setAttribute("position",new On([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new cs(s,new En({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}}const Sd=new ai;let Cd,Md;class Td extends un{constructor(e=new ai(0,0,1),t=new ai(0,0,0),r=1,i=16776960,n=.2*r,s=.2*n){super(),this.type="ArrowHelper",void 0===Cd&&((Cd=new Hn).setAttribute("position",new On([0,0,0,0,1,0],3)),(Md=new Qc(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new ic(Cd,new Jl({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new cs(Md,new En({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Sd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Sd,t)}}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Id extends oc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Hn;r.setAttribute("position",new On(t,3)),r.setAttribute("color",new On([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new Jl({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){const i=new Wr,n=this.geometry.attributes.color.array;return i.set(e),i.toArray(n,0),i.toArray(n,3),i.set(t),i.toArray(n,6),i.toArray(n,9),i.set(r),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class kd{constructor(){this.type="ShapePath",this.color=new Wr,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new jc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,n,s){return this.currentPath.bezierCurveTo(e,t,r,i,n,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function r(e){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r],n=new $c;n.curves=i.curves,t.push(n)}return t}function i(e,t){const r=t.length;let i=!1;for(let n=r-1,s=0;s<r;n=s++){let r=t[n],o=t[s],a=o.x-r.x,l=o.y-r.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(r=t[s],a=-a,o=t[n],l=-l),e.y<r.y||e.y>o.y)continue;if(e.y===r.y){if(e.x===r.x)return!0}else{const t=l*(e.x-r.x)-a*(e.y-r.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==r.y)continue;if(o.x<=e.x&&e.x<=r.x||r.x<=e.x&&e.x<=o.x)return!0}}return i}const n=Eu.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===t)return r(s);let o,a,l;const c=[];if(1===s.length)return a=s[0],(l=new $c).curves=a.curves,c.push(l),c;let u=!n(s[0].getPoints());u=e?!u:u;const p=[],h=[];let d,f,g=[],m=0;h[m]=void 0,g[m]=[];for(let _=0,v=s.length;_<v;_++)o=n(d=(a=s[_]).getPoints()),(o=e?!o:o)?(!u&&h[m]&&m++,h[m]={s:new $c,p:d},h[m].s.curves=a.curves,u&&m++,g[m]=[]):g[m].push({h:a,p:d[0]});if(!h[0])return r(s);if(h.length>1){let e=!1,t=0;for(let r=0,i=h.length;r<i;r++)p[r]=[];for(let r=0,n=h.length;r<n;r++){const n=g[r];for(let s=0;s<n.length;s++){const o=n[s];let a=!0;for(let n=0;n<h.length;n++)i(o.p,h[n].p)&&(r!==n&&t++,a?(a=!1,p[n].push(o)):e=!0);a&&p[r].push(o)}}t>0&&!1===e&&(g=p)}for(let _=0,v=h.length;_<v;_++){l=h[_].s,c.push(l),f=g[_];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return c}}const Dd=function(){const e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),i=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(i[l]=0,i[256|l]=32768,n[l]=24,n[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,n[l]=-e-1,n[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,n[l]=13,n[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,n[l]=24,n[256|l]=24):(i[l]=31744,i[256|l]=64512,n[l]=13,n[256|l]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0==(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,s[l]=e|t}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:t,uint32View:r,baseTable:i,shiftTable:n,mantissaTable:s,exponentTable:o,offsetTable:a}}();var Pd=Object.freeze({__proto__:null,toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=br(e,-65504,65504),Dd.floatView[0]=e;const t=Dd.uint32View[0],r=t>>23&511;return Dd.baseTable[r]+((8388607&t)>>Dd.shiftTable[r])},fromHalfFloat:function(e){const t=e>>10;return Dd.uint32View[0]=Dd.mantissaTable[Dd.offsetTable[t]+(1023&e)]+Dd.exponentTable[t],Dd.floatView[0]}});function Bd(){console.error("THREE.ImmediateRenderObject has been removed.")}class Rd extends ei{constructor(e,t,r){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,r),this.samples=4}}class Ld extends ti{constructor(e,t,r,i){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,r,i)}}class Od extends ii{constructor(e,t,r,i){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,r,i)}}class Fd extends ps{constructor(e,t,r,i,n,s){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,r,i,n,s)}}class Ud extends zc{constructor(e,t,r,i){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,r,i)}}class Nd extends Vc{constructor(e,t,r,i){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,r,i)}}class jd extends Hc{constructor(e,t,r,i,n,s,o){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,r,i,n,s,o)}}class Gd extends Qc{constructor(e,t,r,i,n,s,o,a){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,r,i,n,s,o,a)}}class zd extends qc{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class Vd extends Mu{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class Qd extends Iu{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class Hd extends Gc{constructor(e,t,r,i){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,r,i)}}class Wd extends ku{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class qd extends Ds{constructor(e,t,r,i){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,r,i)}}class Xd extends Wc{constructor(e,t,r,i){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,r,i)}}class Yd extends Du{constructor(e,t,r,i,n,s){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,r,i,n,s)}}class Kd extends Pu{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class Jd extends Bu{constructor(e,t,r,i,n,s,o){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,r,i,n,s,o)}}class Zd extends Ru{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class $d extends Lu{constructor(e,t,r,i,n){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,r,i,n)}}class ef extends Ou{constructor(e,t,r,i,n,s){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,r,i,n,s)}}class tf extends Fu{constructor(e,t,r,i,n){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,r,i,n)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},553:function(e,t,r){r.d(t,{_:function(){return s}});var i=r(988);const n=new WeakMap;class s extends i.aNw{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,n){const s=new i.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,e=>{this.decodeDracoFile(e,t).catch(n)},r,n)}decodeDracoFile(e,t,r,i){const n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){const r=JSON.stringify(t);if(n.has(e)){const t=n.get(e);if(t.key===r)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(s,o).then(r=>(i=r,new Promise((r,n)=>{i._callbacks[s]={resolve:r,reject:n},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return a.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),n.set(e,{key:r,promise:a}),a}_createGeometry(e){const t=new i.u9r;e.index&&t.setIndex(new i.TlE(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r],s=n.name,o=n.array,a=n.itemSize;t.setAttribute(s,new i.TlE(o,a))}return t}_loadLibrary(e,t){const r=new i.hH6(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((t,i)=>{r.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=function(){let e,t;function r(e,t,r,i,n,s){const o=s.num_components(),a=r.num_points()*o,l=a*n.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,s,c,l,u);const p=new n(e.HEAPF32.buffer,u,a).slice();return e._free(u),{name:i,array:p,itemSize:o}}onmessage=function(i){const n=i.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":const i=n.buffer,s=n.taskConfig;t.then(e=>{const t=e.draco,o=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(i),i.byteLength);try{const i=function(e,t,i,n){const s=n.attributeIDs,o=n.attributeTypes;let a,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,l=t.DecodeBufferToMesh(i,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,l=t.DecodeBufferToPointCloud(i,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const p in s){const i=self[o[p]];let l,c;if(n.useUniqueIDs)c=s[p],l=t.GetAttributeByUniqueId(a,c);else{if(-1===(c=t.GetAttributeId(a,e[s[p]])))continue;l=t.GetAttribute(a,c)}u.attributes.push(r(e,t,a,p,i,l))}return c===e.TRIANGULAR_MESH&&(u.index=function(e,t,r){const i=3*r.num_faces(),n=4*i,s=e._malloc(n);t.GetTrianglesUInt32Array(r,n,s);const o=new Uint32Array(e.HEAPF32.buffer,s,i).slice();return e._free(s),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),u}(t,o,a,s),l=i.attributes.map(e=>e.array.buffer);i.index&&l.push(i.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:i},l)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{t.destroy(a),t.destroy(o)}})}}}.toString(),n=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}}},__webpackgi_module_cache__={};function __webpackgi_require__(e){var t=__webpackgi_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpackgi_module_cache__[e]={id:e,exports:{}};return __webpackgi_modules__[e].call(r.exports,r,r.exports,__webpackgi_require__),r.exports}__webpackgi_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpackgi_require__.d(t,{a:t}),t},__webpackgi_require__.d=function(e,t){for(var r in t)__webpackgi_require__.o(t,r)&&!__webpackgi_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpackgi_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpackgi_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};!function(){__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return dh},LY2:function(){return i.LY2},GYo:function(){return OM},HRj:function(){return or},li4:function(){return Gb},FO5:function(){return zb},Nlh:function(){return Ob},Mp4:function(){return Gt},QvI:function(){return oo},JHp:function(){return To},bGH:function(){return i.bGH},NDo:function(){return i.NDo},gSk:function(){return i.gSk},WMw:function(){return i.WMw},OTo:function(){return i.OTo},Se2:function(){return i.Se2},cum:function(){return i.cum},Mig:function(){return i.Mig},B$7:function(){return Zs},i_9:function(){return i.i_9},m7l:function(){return i.m7l},sYA:function(){return i.sYA},Xcj:function(){return i.Xcj},mzJ:function(){return i.mzJ},ZZA:function(){return i.ZZA},$Ph:function(){return Au},T__:function(){return i.T__},HkE:function(){return i.HkE},tGC:function(){return i.tGC},g1S:function(){return s_},I$C:function(){return o_},QIH:function(){return to},_JE:function(){return fh},SwW:function(){return Jh},ksm:function(){return so},jl_:function(){return es},b7R:function(){return ms},BDV:function(){return Wn},Ea_:function(){return ns},qff:function(){return es},tmC:function(){return Kn},BON:function(){return Vs},P40:function(){return hs},wLL:function(){return Fs},iHO:function(){return ls},BbS:function(){return i.BbS},kqm:function(){return i.kqm},Hmr:function(){return i.Hmr},SJI:function(){return i.SJI},mTL:function(){return i.mTL},y8_:function(){return i.y8_},_Li:function(){return i._Li},g56:function(){return hu},bj3:function(){return K},z81:function(){return i.z81},_MY:function(){return i._MY},yEv:function(){return Em},dFZ:function(){return vu},N$j:function(){return i.N$j},_YM:function(){return i._YM},TUj:function(){return i.TUj},ZzF:function(){return i.ZzF},qzb:function(){return k},GQ:function(){return i.GQ},nvb:function(){return i.nvb},DvJ:function(){return i.DvJ},fQA:function(){return i.fQA},cPz:function(){return ja},TlE:function(){return i.TlE},u9r:function(){return i.u9r},s4_:function(){return i.s4_},T95:function(){return i.T95},F5w:function(){return hS},NlP:function(){return LM},$8Z:function(){return uS},YYN:function(){return wb},CtF:function(){return i.CtF},V1s:function(){return i.V1s},jOv:function(){return gt},Rki:function(){return i.Rki},pzV:function(){return HT},itZ:function(){return ep},qKx:function(){return tp},vlJ:function(){return Wb},nPO:function(){return Xb},zcQ:function(){return Yu},GH1:function(){return Ju},ROQ:function(){return i.ROQ},YN5:function(){return i.YN5},BVQ:function(){return i.BVQ},YT8:function(){return i.YT8},_DE:function(){return jh},YGz:function(){return i.YGz},trn:function(){return i.trn},zf8:function(){return i.zf8},uWy:function(){return i.uWy},wYQ:function(){return Nu},SUY:function(){return i.SUY},Ilk:function(){return i.Ilk},R2R:function(){return i.R2R},epp:function(){return i.epp},xmJ:function(){return mh},GD$:function(){return $n},EB7:function(){return i.EB7},DqL:function(){return i.DqL},_3:function(){return i._3},b_z:function(){return i.b_z},OCn:function(){return Zb},_am:function(){return i._am},kB7:function(){return Yo},fY$:function(){return i.fY$},vxC:function(){return i.vxC},BtG:function(){return i.BtG},cBK:function(){return i.cBK},g8_:function(){return i.g8_},AXT:function(){return i.AXT},yj7:function(){return i.yj7},dYG:function(){return i.dYG},tm_:function(){return i.tm_},S2y:function(){return i.S2y},B02:function(){return i.B02},PeU:function(){return i.PeU},Hyl:function(){return i.Hyl},Wqd:function(){return i.Wqd},Xaj:function(){return i.Xaj},DUb:function(){return Lu},dZ3:function(){return i.dZ3},m_w:function(){return i.m_w},fHI:function(){return i.fHI},LBq:function(){return i.LBq},dHf:function(){return Bb},Qww:function(){return Si.Q},CGV:function(){return Rb},JUT:function(){return i.JUT},p3g:function(){return i.p3g},IEO:function(){return i.IEO},CN8:function(){return i.CN8},zob:function(){return i.zob},yxD:function(){return i.yxD},CUS:function(){return Sm},A5E:function(){return i.A5E},zqG:function(){return qc},PfX:function(){return Es},Q1o:function(){return gs},jfJ:function(){return i.jfJ},T_J:function(){return i.T_J},tEQ:function(){return i.tEQ},gb4:function(){return Hn},qkB:function(){return i.qkB},cvk:function(){return gp},HWo:function(){return _p},brP:function(){return i.brP},$YQ:function(){return i.$YQ},X8d:function(){return QM},Zdt:function(){return HM},yNB:function(){return ra},h7x:function(){return jc},Ox3:function(){return i.Ox3},qtn:function(){return Ys},cBI:function(){return i.cBI},cU9:function(){return i.cU9},DT1:function(){return i.DT1},Kgo:function(){return i.Kgo},ehD:function(){return i.ehD},fhJ:function(){return Co},y1s:function(){return Mo},fSK:function(){return i.fSK},Vdb:function(){return i.Vdb},l8J:function(){return i.l8J},dj0:function(){return i.dj0},QM0:function(){return i.QM0},OIS:function(){return Mg},q8b:function(){return Mc},TOt:function(){return i.TOt},xaN:function(){return d},Ny0:function(){return i.Ny0},NeD:function(){return NE},Zof:function(){return Ss},eD:function(){return i.eD},jwo:function(){return i.jwo},dSO:function(){return i.dSO},Bf4:function(){return i.Bf4},USm:function(){return i.USm},pBf:function(){return i.pBf},eBg:function(){return dI},$Vf:function(){return i.$Vf},O7d:function(){return i.O7d},ksq:function(){return $g},gXf:function(){return su},hH6:function(){return i.hH6},kpi:function(){return Qh},DwZ:function(){return JM},kN3:function(){return ZM},e62:function(){return i.e62},a$l:function(){return i.a$l},OM3:function(){return i.OM3},VzW:function(){return i.VzW},ybr:function(){return i.ybr},yo9:function(){return i.yo9},$Bt:function(){return Rc},Wzm:function(){return i.Wzm},Wl3:function(){return i.Wl3},iWj:function(){return i.iWj},DNz:function(){return So},m1M:function(){return ho},ylh:function(){return i.ylh},v9Y:function(){return i.v9Y},LSk:function(){return i.LSk},LHE:function(){return Qc},KE0:function(){return XA},KCF:function(){return qA},a4n:function(){return Xm},zIH:function(){return oi},Hfk:function(){return xi},png:function(){return _i},tAj:function(){return vi},Eb_:function(){return Ai},BT2:function(){return nm},_8p:function(){return qm},V5Z:function(){return xh},s5b:function(){return Ah},hkn:function(){return qt},GFY:function(){return lo},w$m:function(){return i.w$m},ksN:function(){return i.ksN},j4z:function(){return i.j4z},OAl:function(){return i.OAl},VLJ:function(){return i.VLJ},C73:function(){return fu},ZAu:function(){return i.ZAu},ibP:function(){return is},_fI:function(){return $n},hUN:function(){return pp},cLu:function(){return i.cLu},vmT:function(){return i.vmT},Qpg:function(){return i.Qpg},So8:function(){return i.So8},eOv:function(){return NT},Wjw:function(){return i.Wjw},cJO:function(){return i.cJO},QRU:function(){return i.QRU},S3k:function(){return i.S3k},PpQ:function(){return i.PpQ},AHu:function(){return i.AHu},q_9:function(){return lr},ZRs:function(){return i.ZRs},oqc:function(){return i.oqc},T_x:function(){return Yn},lb7:function(){return i.lb7},L5s:function(){return i.L5s},$TI:function(){return i.$TI},SPe:function(){return i.SPe},aVm:function(){return i.aVm},j87:function(){return i.j87},RNb:function(){return i.RNb},Kz5:function(){return i.Kz5},vpT:function(){return i.vpT},kB5:function(){return i.kB5},_C8:function(){return i._C8},Syv:function(){return i.Syv},NMF:function(){return i.NMF},pIN:function(){return i.pIN},eMJ:function(){return i.eMJ},rN7:function(){return Np},iUp:function(){return jp},GFd:function(){return wm},x5V:function(){return i.x5V},tUh:function(){return i.tUh},z8B:function(){return i.z8B},vcl:function(){return Ph},GZb:function(){return i.GZb},p7y:function(){return i.p7y},S9g:function(){return i.S9g},Zr5:function(){return i.Zr5},vCF:function(){return i.vCF},yt0:function(){return i.yt0},uXU:function(){return i.uXU},_kC:function(){return i._kC},lk7:function(){return i.lk7},USc:function(){return jT},x12:function(){return i.x12},Zzh:function(){return i.Zzh},nls:function(){return i.nls},g_z:function(){return i.g_z},U7:function(){return i.U7},FT0:function(){return i.FT0},blk:function(){return i.blk},ejS:function(){return i.ejS},rnI:function(){return i.rnI},wem:function(){return i.wem},lfu:function(){return i.lfu},FDw:function(){return i.FDw},lRj:function(){return i.lRj},D1R:function(){return i.D1R},qyh:function(){return i.qyh},GUF:function(){return i.GUF},EoG:function(){return i.EoG},aNw:function(){return i.aNw},Zp0:function(){return i.Zp0},lLk:function(){return i.lLk},jAl:function(){return i.jAl},uEv:function(){return i.uEv},YKA:function(){return i.YKA},cRx:function(){return i.cRx},Y8D:function(){return i.Y8D},RsA:function(){return i.RsA},Y0m:function(){return am},F5T:function(){return i.F5T},EDU:function(){return ry},z$Q:function(){return AE},KA8:function(){return jt},XUj:function(){return bE},Me$:function(){return yE},u7G:function(){return i.u7G},PEk:function(){return ar},BG4:function(){return ty},M8C:function(){return i.M8C},Vkp:function(){return i.Vkp},yGw:function(){return i.yGw},Sm8:function(){return i.Sm8},Kj0:function(){return i.Kj0},vBJ:function(){return i.vBJ},QfV:function(){return rr},lRF:function(){return i.lRF},Lun:function(){return i.Lun},YBo:function(){return i.YBo},kaV:function(){return i.kaV},RSm:function(){return i.RSm},xoR:function(){return i.xoR},EJi:function(){return i.EJi},Wid:function(){return i.Wid},iuj:function(){return er},IKL:function(){return i.IKL},r_:function(){return i.r_},OoA:function(){return i.OoA},qhX:function(){return i.qhX},qPT:function(){return Io},M5h:function(){return i.M5h},Ns1:function(){return i.Ns1},TyD:function(){return i.TyD},vZf:function(){return i.vZf},HTd:function(){return i.HTd},aH4:function(){return i.aH4},YLQ:function(){return i.YLQ},BVF:function(){return i.BVF},MyG:function(){return i.MyG},jFi:function(){return i.jFi},aCh:function(){return i.aCh},uL9:function(){return i.uL9},TNj:function(){return Iu},IFH:function(){return i.IFH},bdR:function(){return i.bdR},RPs:function(){return GA},kM_:function(){return Ko},M6v:function(){return i.M6v},RvT:function(){return i.RvT},dUE:function(){return i.dUE},oe_:function(){return xm},BuN:function(){return Am},Tme:function(){return i.Tme},N9P:function(){return pr},Gql:function(){return i.Gql},$XY:function(){return li},O9d:function(){return ia},zEO:function(){return dr},qfx:function(){return ME},PA7:function(){return i.PA7},REq:function(){return i.REq},pQR:function(){return i.pQR},ghN:function(){return i.ghN},Hy8:function(){return i.Hy8},Wpd:function(){return i.Wpd},LgZ:function(){return i.LgZ},iWC:function(){return i.iWC},mqn:function(){return CI},SKe:function(){return dt},iKG:function(){return i.iKG},rCq:function(){return Db},_iA:function(){return i._iA},ntZ:function(){return i.ntZ},anP:function(){return i.anP},X2e:function(){return db},FCo:function(){return kE},y$t:function(){return i.y$t},cPb:function(){return i.cPb},lmx:function(){return Fc},JOQ:function(){return i.JOQ},BKK:function(){return i.BKK},_12:function(){return i._12},tJx:function(){return i.tJx},cek:function(){return i.cek},qD0:function(){return Js},xG9:function(){return i.xG9},wI8:function(){return oT},Sgv:function(){return aT},woe:function(){return i.woe},UY4:function(){return i.UY4},aq0:function(){return i.aq0},ujx:function(){return i.ujx},Uol:function(){return i.Uol},JiH:function(){return jE},VYz:function(){return i.VYz},_Pm:function(){return Xp},EsW:function(){return Po},iUV:function(){return i.iUV},tf:function(){return i.tf},ZQ6:function(){return i.ZQ6},mXe:function(){return i.mXe},_fP:function(){return i._fP},iLg:function(){return i.iLg},zbs:function(){return i.zbs},UZH:function(){return i.UZH},mSO:function(){return i.mSO},wk1:function(){return i.wk1},E2K:function(){return i.E2K},FUD:function(){return i.FUD},pKu:function(){return i.pKu},GG6:function(){return i.GG6},Gih:function(){return i.Gih},iiP:function(){return i.iiP},SvJ:function(){return i.SvJ},ptH:function(){return i.ptH},jZA:function(){return i.jZA},y2t:function(){return i.y2t},gi4:function(){return i.gi4},Djp:function(){return i.Djp},BG$:function(){return i.BG$},NYV:function(){return i.NYV},xJs:function(){return i.xJs},bsb:function(){return i.bsb},ekQ:function(){return i.ekQ},CaW:function(){return i.CaW},eaV:function(){return i.eaV},BFQ:function(){return i.BFQ},v3W:function(){return i.v3W},ILR:function(){return i.ILR},UCm:function(){return i.UCm},Inb:function(){return i.Inb},U1$:function(){return R},LgE:function(){return i.LgE},fto:function(){return i.fto},l0P:function(){return i.l0P},vCx:function(){return i.vCx},_AM:function(){return i._AM},wuA:function(){return i.wuA},av9:function(){return i.av9},CtA:function(){return i.CtA},BvQ:function(){return iu},FZJ:function(){return lp},FIo:function(){return i.FIo},zHn:function(){return i.zHn},iMs:function(){return i.iMs},T_f:function(){return i.T_f},hEm:function(){return i.hEm},D9w:function(){return i.D9w},sHH:function(){return uu},CdI:function(){return i.CdI},rkc:function(){return QT},rpg:function(){return i.rpg},ce8:function(){return i.ce8},rOj:function(){return i.rOj},P6m:function(){return im},JA6:function(){return rm},V4E:function(){return i.V4E},o8S:function(){return i.o8S},flB:function(){return _t},DUH:function(){return Pb},KI_:function(){return i.KI_},iLN:function(){return Xo},rz_:function(){return QA},jsw:function(){return Ap},srG:function(){return BE},i6Z:function(){return Vo},vfv:function(){return om},xsS:function(){return i.xsS},or:function(){return GT},EQj:function(){return Kp},ov0:function(){return Na},WdD:function(){return i.WdD},Vj0:function(){return i.Vj0},jyz:function(){return i.jyz},mTM:function(){return zt},Mn1:function(){return Vt},Hlq:function(){return Ht},Fi7:function(){return au},Tn7:function(){return i.Tn7},bnF:function(){return i.bnF},HW6:function(){return i.HW6},oa8:function(){return i.oa8},T_1:function(){return i.T_1},zHJ:function(){return UE},iDF:function(){return i.iDF},iAb:function(){return i.iAb},d4E:function(){return rd},lBg:function(){return LT},JeJ:function(){return id},FKY:function(){return r},zlZ:function(){return Cm},vkg:function(){return fr},brh:function(){return Mm},kZK:function(){return $E},puG:function(){return OT},OdW:function(){return i.OdW},_YX:function(){return i._YX},TUv:function(){return i.TUv},Hw6:function(){return i.Hw6},aLr:function(){return i.aLr},Aip:function(){return i.Aip},xo$:function(){return i.xo$},bIn:function(){return MI},$V:function(){return i.$V},lDi:function(){return i.lDi},gti:function(){return i.gti},PMe:function(){return i.PMe},iwP:function(){return Ks},FvO:function(){return i.FvO},jyi:function(){return i.jyi},xeV:function(){return i.xeV},k74:function(){return i.k74},RlZ:function(){return i.RlZ},KhW:function(){return i.KhW},HgB:function(){return i.HgB},W2J:function(){return i.W2J},JWc:function(){return i.JWc},u37:function(){return i.u37},Z6B:function(){return i.Z6B},QZ1:function(){return i.QZ1},Ir4:function(){return i.Ir4},NwF:function(){return i.NwF},Wbm:function(){return i.Wbm},N4l:function(){return i.N4l},ej9:function(){return RE},QmN:function(){return i.QmN},IOt:function(){return i.IOt},NOD:function(){return Xu},L5g:function(){return i.L5g},H$k:function(){return i.H$k},cuP:function(){return KE},xEZ:function(){return i.xEZ},dpR:function(){return i.dpR},wOD:function(){return Eu},KNb:function(){return no},IiN:function(){return Mh},Cne:function(){return i.Cne},XvJ:function(){return i.XvJ},XZw:function(){return i.XZw},FE5:function(){return i.FE5},lVp:function(){return Uc},CJI:function(){return i.CJI},z$h:function(){return i.z$h},UlW:function(){return i.UlW},WwZ:function(){return i.WwZ},Lcc:function(){return i.Lcc},WXh:function(){return i.WXh},Vjr:function(){return LE},LuM:function(){return RT},LP5:function(){return xT},xfE:function(){return i.xfE},qlB:function(){return i.qlB},lCJ:function(){return i.lCJ},WTc:function(){return i.WTc},rAo:function(){return i.rAo},LZj:function(){return Sh},xWb:function(){return i.xWb},gH0:function(){return i.gH0},rBU:function(){return i.rBU},rDY:function(){return i.rDY},ywz:function(){return i.ywz},wJv:function(){return i.wJv},JQ4:function(){return i.JQ4},k0A:function(){return i.k0A},irR:function(){return i.irR},LsT:function(){return i.LsT},q5h:function(){return Qs},TKh:function(){return zs},tyg:function(){return Gs},Ro5:function(){return ps},dwk:function(){return i.dwk},FM8:function(){return i.FM8},Pa4:function(){return i.Pa4},Ltg:function(){return i.Ltg},yC1:function(){return i.yC1},lHq:function(){return Wu},fO1:function(){return i.fO1},oMA:function(){return bo},JzW:function(){return e},QEt:function(){return Oh},b5g:function(){return i.b5g},Ywn:function(){return i.Ywn},GVz:function(){return i.GVz},oAp:function(){return i.oAp},kFz:function(){return i.kFz},p7A:function(){return i.p7A},dd2:function(){return i.dd2},CP7:function(){return i.CP7},fQK:function(){return i.fQK},Wd$:function(){return td},t1_:function(){return hI},Uk6:function(){return i.Uk6},_sL:function(){return i._sL},Pnf:function(){return i.Pnf},c8b:function(){return i.c8b},_lf:function(){return i._lf},ad5:function(){return i.ad5},sZV:function(){return Us},TfA:function(){return Os},sKX:function(){return qs},UdM:function(){return Ls},P0y:function(){return as},L_r:function(){return i.L_r},Bve:function(){return Zh},UeO:function(){return Ci},$nx:function(){return Jm},Bk6:function(){return ui},EER:function(){return Dh},y4l:function(){return mr},pQ0:function(){return Xs},wXW:function(){return Yy},r5x:function(){return Wy},MSI:function(){return Zy},EUu:function(){return OI},jtH:function(){return Cc},T0T:function(){return Pc},gAb:function(){return kI},iwT:function(){return Bc},je_:function(){return DI},wBP:function(){return Dc},LU2:function(){return rl},wQL:function(){return FI},Zs7:function(){return gw},sMc:function(){return Rt},x7s:function(){return kw},Mnd:function(){return jI},A0_:function(){return GI},d73:function(){return Ry},HCD:function(){return q},RG9:function(){return X},G2P:function(){return $a},XLf:function(){return tl},CGN:function(){return el},RGi:function(){return Lt},mvg:function(){return Ly},Hiy:function(){return tr},XMc:function(){return qy},N7M:function(){return Qy},iv:function(){return Ky},n55:function(){return bt},IaC:function(){return Dy},h9t:function(){return nl},yDW:function(){return sl},gJv:function(){return il},l$g:function(){return pS},vQi:function(){return RM},$MY:function(){return vo},wJl:function(){return mo},Z7Y:function(){return Ka},X7D:function(){return Za},BnX:function(){return Ja},uZ5:function(){return ll},zVI:function(){return Uy},DpF:function(){return dp},nNb:function(){return ts},cqZ:function(){return rs},pKN:function(){return Sb},d_$:function(){return $o},DdI:function(){return Cb},rrX:function(){return Mb},KlC:function(){return Zo},KVn:function(){return B},oau:function(){return fw},aw9:function(){return ye},Aap:function(){return je},Dxg:function(){return A},MjT:function(){return Ee},F7Q:function(){return Ha},IFq:function(){return NI},IJl:function(){return Qa},O5A:function(){return vt},wCn:function(){return Et},gGT:function(){return Va},pEc:function(){return Eb},Bi6:function(){return St},fi_:function(){return Rw},TT:function(){return nw},q2Z:function(){return fI},NyK:function(){return J},bgu:function(){return Mt},kcS:function(){return Ct},rRN:function(){return cS},ivY:function(){return E},_s1:function(){return ok},_HO:function(){return Q},tpL:function(){return H},DMK:function(){return ac},LjN:function(){return _s},iFs:function(){return vs},qTg:function(){return _},Wtl:function(){return qn},DmK:function(){return Xn},Htt:function(){return zI},Hx7:function(){return De},imt:function(){return Ie},US6:function(){return Cw},vZs:function(){return ea},TE$:function(){return WI},lmu:function(){return At},SvO:function(){return yt},YQY:function(){return qa},mZN:function(){return Ya},VvG:function(){return Xa},omp:function(){return zE},utz:function(){return Fy},TFV:function(){return yo},hrz:function(){return b},JKM:function(){return ow},jZf:function(){return TI},RjL:function(){return AT},RRI:function(){return Mw},RUq:function(){return JE},_t4:function(){return nt},YHh:function(){return st},R8g:function(){return L},Bbl:function(){return ur},V9r:function(){return v},PZ2:function(){return x},w7A:function(){return f},N6S:function(){return U},Uxp:function(){return N},tAz:function(){return F},R$F:function(){return G},N33:function(){return j},gw2:function(){return ro},KlU:function(){return O},rfc:function(){return Nt},wo6:function(){return Pt},H4P:function(){return w},swA:function(){return ss},_Z3:function(){return os},ivc:function(){return ts},rZ1:function(){return rs},CpZ:function(){return Bw},dyc:function(){return S},MxZ:function(){return QE},btp:function(){return HE},mXy:function(){return VE},Ej0:function(){return Ue},ep4:function(){return be},DQP:function(){return Ne},VNr:function(){return we},V7q:function(){return Tt},zEk:function(){return Ft},qfq:function(){return It},piB:function(){return T},IIc:function(){return RI},rrF:function(){return Jn},naq:function(){return Zn},sXR:function(){return sc},p5I:function(){return kc},wps:function(){return VI},wuo:function(){return QI},GpE:function(){return g},F4b:function(){return oc},t$v:function(){return By},tdn:function(){return ip},Y9t:function(){return np},GEo:function(){return Wa},DH3:function(){return Xy},uxM:function(){return iy},zH3:function(){return ny},MLs:function(){return ao},xXG:function(){return Ae},YM4:function(){return Ic},B3r:function(){return II},iAx:function(){return sy},lDn:function(){return V},oaQ:function(){return za},CD7:function(){return ml},Rc0:function(){return Ul},iPG:function(){return ic},TIc:function(){return Dt},xsC:function(){return $y},zOc:function(){return kt},r46:function(){return mw},z2C:function(){return M},_X$:function(){return cr},_yn:function(){return Qt},Dyg:function(){return xt},cUc:function(){return $t},zGw:function(){return Zl},Ctq:function(){return Vy},$ch:function(){return qI},k5b:function(){return jy},kZl:function(){return iw},OCg:function(){return pw},YjH:function(){return Iw},Ui8:function(){return Ym},YD2:function(){return gl},vi9:function(){return LI},ij3:function(){return Hy},YPW:function(){return Gy},Bg1:function(){return _I},kon:function(){return y},M3g:function(){return Ga},F2z:function(){return Py},pJF:function(){return EE},knz:function(){return i.knz},Ejo:function(){return m},BgY:function(){return Be},qCG:function(){return Ce},HD9:function(){return ke},fEB:function(){return Me},Udc:function(){return Fe},ZQg:function(){return Oe},ofC:function(){return W},yRy:function(){return Bt},_NL:function(){return $h},LCA:function(){return Le},j1w:function(){return hr},i8J:function(){return lk},p7C:function(){return Jt},ZAS:function(){return op},ipH:function(){return KI},$TF:function(){return YI},uZI:function(){return JI},VWG:function(){return ey},pQ7:function(){return rp},STw:function(){return dl},jc8:function(){return Zt},BL_:function(){return Oy},S6:function(){return ak},T8U:function(){return Ms},TD6:function(){return Cs},akS:function(){return oy},QKE:function(){return ay},dKx:function(){return C},OvX:function(){return PI},VsW:function(){return Tc},YMc:function(){return XI},aPg:function(){return Y},LFn:function(){return Ot},wey:function(){return ky},MaE:function(){return et},s4x:function(){return rt},FJA:function(){return Xe},vIA:function(){return $e},Spv:function(){return ot},w8l:function(){return it},riG:function(){return tt},Kbh:function(){return Ke},BFq:function(){return at},t8K:function(){return Je},Q7n:function(){return Ye},KGF:function(){return Ze},e5:function(){return z},Rik:function(){return Hs},GZo:function(){return Ws},Bds:function(){return ds},HTu:function(){return fs},cTq:function(){return wt},X_Y:function(){return _o},dA8:function(){return go},bwS:function(){return zy},Lks:function(){return ZI},Rvq:function(){return BI},P4F:function(){return Hb},Pd0:function(){return ci},Pjo:function(){return Ny},Tum:function(){return pi},dRH:function(){return di},RX0:function(){return hi},reQ:function(){return $I},cWm:function(){return Jy},NC9:function(){return Qb},$Re:function(){return Ns},Xo9:function(){return js},LNO:function(){return cs},iZP:function(){return us}});var e,t={};__webpackgi_require__.r(t),__webpackgi_require__.d(t,{AsyncCompress:function(){return Bf},AsyncDecompress:function(){return Yf},AsyncDeflate:function(){return Sf},AsyncGunzip:function(){return Ff},AsyncGzip:function(){return Bf},AsyncInflate:function(){return If},AsyncUnzipInflate:function(){return yg},AsyncUnzlib:function(){return Hf},AsyncZipDeflate:function(){return mg},AsyncZlib:function(){return Gf},Compress:function(){return Pf},DecodeUTF8:function(){return ig},Decompress:function(){return Xf},Deflate:function(){return Ef},EncodeUTF8:function(){return ng},Gunzip:function(){return Of},Gzip:function(){return Pf},Inflate:function(){return Tf},Unzip:function(){return wg},UnzipInflate:function(){return bg},UnzipPassThrough:function(){return Ag},Unzlib:function(){return Qf},Zip:function(){return _g},ZipDeflate:function(){return gg},ZipPassThrough:function(){return fg},Zlib:function(){return jf},compress:function(){return Rf},compressSync:function(){return Lf},decompress:function(){return Kf},decompressSync:function(){return Jf},deflate:function(){return Cf},deflateSync:function(){return Mf},gunzip:function(){return Uf},gunzipSync:function(){return Nf},gzip:function(){return Rf},gzipSync:function(){return Lf},inflate:function(){return kf},inflateSync:function(){return Df},strFromU8:function(){return og},strToU8:function(){return sg},unzip:function(){return Eg},unzipSync:function(){return Sg},unzlib:function(){return Wf},unzlibSync:function(){return qf},zip:function(){return vg},zipSync:function(){return xg},zlib:function(){return zf},zlibSync:function(){return Vf}}),function(e){e[e.Error=-2]="Error",e[e.Destroyed=-1]="Destroyed",e[e.None=0]="None",e[e.Running=1]="Running",e[e.Paused=2]="Paused"}(e||(e={}));class r{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const r=this._eventListeners;void 0===r[e]&&(r[e]=[]),r[e].includes(t)||r[e].push(t)}hasEventListener(e,t){const r=this._eventListeners;return void 0!==r[e]&&r[e].includes(t)}removeEventListener(e,t){const r=this._eventListeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){const t=this._eventListeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e)}}}var i=__webpackgi_require__(988);const n={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class s{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const o=new i.iKG(-1,1,1,-1,0,1),a=new i.u9r;a.setAttribute("position",new i.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),a.setAttribute("uv",new i.a$l([0,2,0,0,2,0],2));class l{constructor(e){this._mesh=new i.Kj0(a,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,o)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class c extends s{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof i.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=i.rDY.clone(e.uniforms),this.material=new i.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new l(this.material),this.useExistingRenderTarget=!1}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class u extends s{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),n=e.state;let s,o;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),n.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),n.buffers.stencil.setClear(o),n.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(i.EQUAL,1,4294967295),n.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),n.buffers.stencil.setLocked(!0)}}class p extends s{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new i.iKG(-1,1,1,-1,0,1);const h=new i.u9r;h.setAttribute("position",new i.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),h.setAttribute("uv",new i.a$l([0,2,0,0,2,0],2));class d extends class{constructor(e,t){if(this.renderer=e,void 0===t){const r=e.getSize(new i.FM8);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new i.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===n&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===c&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new c(n),this.clock=new i.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,n=this.passes.length;i<n;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){const t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==u&&(t instanceof u?r=!0:t instanceof p&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new i.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const r=this.setSize;t||(this.setSize=(()=>{})),super.setPixelRatio(e),t||(this.setSize=r)}}function f(e,t){let r;do{r=Object.getOwnPropertyDescriptor(e,t)}while(!r&&(e=Object.getPrototypeOf(e)));return r}function g(e,t,r=!1,i=!1){const n=f(e,t);return!!(null==n?void 0:n.set)||r&&!1!==(null==n?void 0:n.writable)&&void 0===(null==n?void 0:n.get)||i&&!n}function m(e,t,r,i=!1,n=!1){return!(!e||!g(e,t,i,n)||(e[t]=r,0))}function _(e,t){for(;e.length>0;){if(!t)return;const r=e.splice(0,1)[0];if(!(r.length<1)){if(!(r in t))return console.error("invalid access, check",r,t),t;t=t[r]}}return t}function v(e,t){return Object.keys(e).find(r=>e[r]===t)}function x(e,...t){return"function"==typeof e&&(e=e(...t)),e}function A(e,t,r){for(const i of r){const r=e[i];void 0!==r&&m(t,i,r,!0)}}function b(e){return e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function y(e,t,r){return e.replace(new RegExp(b(t),"g"),r)}String.raw;const w=(e,...t)=>String.raw({raw:e},...t),E=(e,...t)=>String.raw({raw:e},...t),S=(e,...t)=>String.raw({raw:e},...t),C=(e,...t)=>{let r=String.raw({raw:e},...t);return r=y(r,"%","%25"),r=y(r,"> <","><"),r=y(r,"; }",";}"),r=y(r,"<","%3c"),r=y(r,">","%3e"),r=y(r,'"',"'"),r=y(r,"#","%23"),r=y(r,"{","%7b"),r=y(r,"}","%7d"),r=y(r,"|","%7c"),r=y(r,"^","%5e"),r=y(r,"`","%60"),r=y(r,"@","%40"),r=y(r,"&","&amp;"),"data:image/svg+xml;charset=UTF-8,"+(r=y(r,"\n","%0A"))};function M(e){if(!e)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(t,r)=>{let i=t[r];Object.defineProperty(t,r,{get:()=>i,set(t){var n;if(i===t)return;i=t;const s=[r,t];if("string"==typeof e)null===(n=this[e])||void 0===n||n.call(this,...s);else if("function"==typeof e){let t=!1;if(e.name){let r=this;for(;r;){if(r[e.name]===e){e.call(this,...s),t=!0;break}r=Object.getPrototypeOf(r)}}t||(e.name&&this[e.name].name===`bound ${e.name}`?this[e.name](...s):e(...s))}}})}}function T(e,t){for(const r of t)if(!e.includes(r))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)});class I{constructor(e=0,t=0){I.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*r-s*i+e.x,this.y=n*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class k extends i.ZzF{expandByObject(e,t=!1,r=!1){var i;if(!1===(null===(i=e.userData)||void 0===i?void 0:i.bboxVisible))return this;if(!e.visible&&r)return this;e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let r=0,i=t.count;r<i;r++)P.fromBufferAttribute(t,r).applyMatrix4(e.matrixWorld),this.expandByPoint(P)}else null===n.boundingBox&&n.computeBoundingBox(),D.copy(n.boundingBox),D.applyMatrix4(e.matrixWorld),this.union(D);const s=e.children;for(let o=0,a=s.length;o<a;o++)this.expandByObject(s[o],t,r);return this}expandByObjects(e,t=!1,r=!1){for(let i=0,n=e.length;i<n;i++)this.expandByObject(e[i],t,r);return this}getPoints(){return[new i.Pa4(this.min.x,this.min.y,this.min.z),new i.Pa4(this.min.x,this.min.y,this.max.z),new i.Pa4(this.min.x,this.max.y,this.min.z),new i.Pa4(this.min.x,this.max.y,this.max.z),new i.Pa4(this.max.x,this.min.y,this.min.z),new i.Pa4(this.max.x,this.min.y,this.max.z),new i.Pa4(this.max.x,this.max.y,this.min.z),new i.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),r=new i.TUj;for(const i of t){const t=i.project(e);r.min.min(t),r.max.max(t)}return r}}const D=new k,P=new i.Pa4;function B(e,t){let r,n;if(Array.isArray(e))for(const i of e){const e=B(i,t);void 0===r||void 0===n?(r=e.min.clone(),n=e.max.clone()):(r.min(e.min),n.max(e.max))}const s=e;if(void 0!==s.geometry){const o=s.geometry.vertices;if(void 0===o&&void 0!==s.geometry.attributes&&"position"in s.geometry.attributes){const o=new i.Pa4,a=s.geometry.attributes.position;for(let i=0;i<a.count*a.itemSize;i+=a.itemSize){o.set(a.array[i],a.array[i+1],a.array[3]);const s=o.applyMatrix4(e.matrixWorld).project(t),l=new I(s.x,s.y);void 0===r||void 0===n?(r=l.clone(),n=l.clone()):(r.min(l),n.max(l))}}else for(const i of o){const s=i.clone().applyMatrix4(e.matrixWorld).project(t),o=new I(s.x,s.y);void 0===r||void 0===n?(r=o.clone(),n=o.clone()):(r.min(o),n.max(o))}}if(void 0!==e.children)for(const i of e.children){const e=B(i,t);void 0===r||void 0===n?(r=e.min.clone(),n=e.max.clone()):(r.min(e.min),n.max(e.max))}return new i.TUj(r,n)}const R=3005;function L(e){switch(e){case i.rnI:return["Linear","( value )"];case i.knz:return["sRGB","( value )"];case R:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",e),["Linear","( value )"]}}function O(e,t){let r;return e&&e.isTexture?r=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=i.rnI,t&&e&&e.isTexture&&e.format===i.wk1&&e.type===i.ywz&&e.encoding===i.knz&&(r=i.rnI),r}function F(e,t){const r=L(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function U(e,t,r){return F(e+"TexelToLinear",O(t,r))+"\n"}function N(e,t){return F(e+"TexelToLinear",t)+"\n"}function j(e,t){const r=L(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function G(e,t,r){return j(e,O(t,r))}function z({uniforms:e,propKey:t,thisTarget:r=!1}={}){const i=!!e,n=!!t,s=r;return(r,o)=>{const a=r=>{const a=s?r:i?e:r.uniforms||r._uniforms;let l=n?t:o;s&&(l="_"+l);let c=a[l];return c||(c={value:null},a[l]=c),c};Object.defineProperty(r,o,{get(){return a(this).value},set(e){a(this).value=e,m(this,"uniformsNeedUpdate",!0,!0)}})}}function V(e,t,r=!1,i){const n=!!t,s=!!e;return(o,a)=>{const l=r=>({t:n?t:r.defines||r._defines,p:s?e:a});Object.defineProperty(o,a,{get(){const{t:e,p:t}=l(r?this:this.material);return e[t]},set(e){const{t:t,p:n}=l(r?this:this.material);if(m(t,n,e,!0),"function"==typeof i){const t=[n,e];if(i.name){const e=this[i.name];e===i?i.call(this,...t):e.name===`bound ${i.name}`?e(...t):i(...t)}else i(...t)}else m(r?this:this.material,"needsUpdate",!0,!0)}})}}function Q(e){const t=new i.IEO(new Uint8Array([Math.floor(255*e.r),Math.floor(255*e.g),Math.floor(255*e.b),255]),1,1,i.wk1,i.ywz);return t.needsUpdate=!0,t.encoding=i.rnI,t}function H(e){const t=new i.IEO(new Uint8Array([Math.floor(255*e.x),Math.floor(255*e.y),Math.floor(255*e.z),Math.floor(255*e.w)]),1,1,i.wk1,i.ywz);return t.needsUpdate=!0,t}function W(e,t,r){const i=e.userData,{backgroundRender:n,transparentRender:s,shadowMapRender:o,mainRenderPass:a,opaqueRender:l,transmissionRender:c,sceneRender:u,screenSpaceRendering:p}=i;void 0!==t.backgroundRender&&(i.backgroundRender=t.backgroundRender),void 0!==t.transparentRender&&(i.transparentRender=t.transparentRender),void 0!==t.shadowMapRender&&(i.shadowMapRender=t.shadowMapRender),void 0!==t.mainRenderPass&&(i.mainRenderPass=t.mainRenderPass),void 0!==t.opaqueRender&&(i.opaqueRender=t.opaqueRender),void 0!==t.sceneRender&&(i.sceneRender=t.sceneRender),void 0!==t.transmissionRender&&(i.transmissionRender=t.transmissionRender),void 0!==t.screenSpaceRendering&&(i.screenSpaceRendering=t.screenSpaceRendering),r(),i.backgroundRender=n,i.transparentRender=s,i.shadowMapRender=o,i.mainRenderPass=a,i.opaqueRender=l,i.sceneRender=u,i.transmissionRender=c,i.screenSpaceRendering=p}function q(e){const t=(new k).expandByObject(e,!0,!0).getCenter(new i.Pa4);e.position.sub(t),e.updateMatrix(),e.userData.autoCentered=!0,e.userData.isCentered=!0}function X(e,t){const r=.5*(new k).expandByObject(e,!0,!0).getSize(new i.Pa4).length();void 0===t&&(t=e.userData.autoScaleRadius||1);const n=t/r;return isFinite(n)&&(e.userData.pseudoCentered?e.children.forEach(e=>{e.scale.multiplyScalar(n)}):e.scale.multiplyScalar(n),e.userData.isCentered&&e.position.multiplyScalar(n),e.traverse(e=>{var t,r;e.isLight&&(null===(r=null===(t=e.shadow)||void 0===t?void 0:t.camera)||void 0===r?void 0:r.right)&&(e.shadow.camera.right*=n,e.shadow.camera.left*=n,e.shadow.camera.top*=n,e.shadow.camera.bottom*=n),e.isCamera&&e.right&&(e.right*=n,e.left*=n,e.top*=n,e.bottom*=n)}),e.userData.autoScaled=!0,e.userData.autoScaleRadius=t,e.dispatchEvent({type:"objectUpdate"})),e}function Y(e,t=-1){return function(e,t=1e-4){const r=t>0;t=Math.max(t,Number.EPSILON);const n={},s=e.getIndex(),o=e.getAttribute("position"),a=s?s.count:o.count;let l=0;const c=Object.keys(e.attributes),u={},p={},h=[],d=["getX","getY","getZ","getW"];for(let i=0,_=c.length;i<_;i++){const t=c[i];u[t]=[];const r=e.morphAttributes[t];r&&(p[t]=new Array(r.length).fill().map(()=>[]))}const f=Math.log10(1/t),g=Math.pow(10,f);for(let i=0;i<a;i++){const t=s?s.getX(i):i;let o="";for(let i=0,n=c.length;i<n&&r;i++){const r=c[i],n=e.getAttribute(r),s=n.itemSize;for(let e=0;e<s;e++)o+=~~(n[d[e]](t)*g)+","}if(r&&o in n)h.push(n[o]);else{for(let r=0,i=c.length;r<i;r++){const i=c[r],n=e.getAttribute(i),s=e.morphAttributes[i],o=n.itemSize,a=u[i],l=p[i];for(let e=0;e<o;e++){const r=d[e];if(a.push(n[r](t)),s)for(let e=0,i=s.length;e<i;e++)l[e].push(s[e][r](t))}}r&&(n[o]=l),h.push(l),l++}}const m=e.clone();for(let _=0,v=c.length;_<v;_++){const t=c[_],r=e.getAttribute(t),n=new r.array.constructor(u[t]),s=new i.TlE(n,r.itemSize,r.normalized);if(m.setAttribute(t,s),t in p)for(let o=0;o<p[t].length;o++){const r=e.morphAttributes[t][o],n=new r.array.constructor(p[t][o]),s=new i.TlE(n,r.itemSize,r.normalized);m.morphAttributes[t][o]=s}}return m.setIndex(h),m}(e,t)}class K extends r{constructor({animationLoop:e,canvas:t,alpha:r=!0,targetOptions:n}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new i.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new i.CP7({canvas:t,antialias:!0,alpha:r,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new i.FM8(t.clientWidth,t.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=i.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=i.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=i._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(n,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new d(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,t,r;const i=this._passes,n=[],s={};for(const o of i){if(!1===o.enabled)continue;const i={after:null!==(e=o.after)&&void 0!==e?e:[],before:null!==(t=o.before)&&void 0!==t?t:[],dependencies:new Set(null!==(r=o.required)&&void 0!==r?r:[])};s[o.passId]=i}for(const[o,a]of Object.entries(s)){const e=new Set([...a.after,...a.before]);a.dependencies.forEach(t=>e.has(t)&&e.delete(t)),e.forEach(e=>{const t=s[e];if(t){if(t.dependencies.has(o))throw console.error("cyclic",o,e),"Cyclic dependency";a.dependencies.add(e)}})}for(;;){let e=!1;const t=[...Object.entries(s)];for(const[r,o]of t)if(!n.includes(r)&&T(n,o.dependencies.values())){const t=Math.max(-1,...o.after.map(e=>n.indexOf(e))),a=Math.min(n.length,...o.before.map(e=>{const t=n.indexOf(e);return t<0?n.length:t}));if(t>=a)throw console.error(o,i,n,t,a),"Not possible";n.splice(o.after.length>0?t+1:a,0,r),e=!0,delete s[r]}if(Object.keys(s).length<1)break;if(!e)throw console.error(t,s,n),"Not possible 2"}return this.pipeline=n,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,t){const r=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=r,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:r,time:e,renderer:this,xrFrame:t}))}get clock(){return this._composer.clock}registerPass(e,t=!0){var r;if(t)for(const i of[...this._passes])e.passId===i.passId&&this.unregisterPass(i);this._passes.push(e),null===(r=e.onRegister)||void 0===r||r.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var t;const r=this._passes.indexOf(e);r>=0&&(null===(t=e.onUnregister)||void 0===t||t.call(e,this),this._passes.splice(r,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,t,r=!1){!r&&(e?Math.abs(e-this._renderSize.width):0)+(t?Math.abs(t-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),t&&(this._renderSize.height=t),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(e=>{const t=e,r=t.sizeMultiplier;if(r){const e=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*r);t.setSize(e.width,e.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,t,{viewport:r,material:n,shader:s,pass:o,clear:a=!0}={}){const l=this._composer.copyPass,{renderToScreen:c,material:u,uniforms:p,clear:h}=l;n&&(l.material=n);const d=this._renderer.getViewport(new i.Ltg),f=this._renderer.autoClear,g=this._renderer.getRenderTarget();r&&this._renderer.setViewport((new i.Ltg).fromArray(r)),this._renderer.autoClear=!1,l.uniforms=l.material.uniforms,l.renderToScreen=!1,l.clear=a,W(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{l.render(this._renderer,null!=t?t:null,{texture:e},0,!1)}),l.renderToScreen=c,l.clear=h,l.material=u,l.uniforms=p,this._renderer.autoClear=f,r&&this._renderer.setViewport(d),this._renderer.setRenderTarget(g)}clearColor({r:e,g:t,b:r,a:n,target:s,depth:o=!0,stencil:a=!0}){var l;const c=this._renderer.getClearColor(new i.Ilk),u=this._renderer.getClearAlpha();this._renderer.setClearAlpha(null!=n?n:u),this._renderer.setClearColor(new i.Ilk(null!=e?e:c.r,null!=t?t:c.g,null!=r?r:c.b));const p=this._renderer.getRenderTarget(),h=this._renderer.getActiveCubeFace(),d=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(null!==(l=s)&&void 0!==l?l:null),this._renderer.clear(!0,o,a),this._renderer.setRenderTarget(p,h,d),this._renderer.setClearColor(c),this._renderer.setClearAlpha(u)}renderModel(e,t){this._renderer.render(e.modelObject,t.cameraObject)}renderScene(e){const t=e.activeCamera;t&&this.renderModel(e,t)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const t of this._passes)t.passObject.enabled&&(null===(e=t.update)||void 0===e||e.call(t));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const t of this._pipeline){const r=this._passes.find(e=>e.passId===t);r?e.push(r.passObject):console.warn("Unable to find pass: ",t)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),e.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const t=this._trackedTargets.indexOf(e);t>=0&&this._trackedTargets.splice(t,1)}createTarget({sizeMultiplier:e,samples:t=0,encoding:r=i.rnI,type:n=i.ywz,format:s=i.wk1,depthBuffer:o=!0,depthTexture:a=!1,size:l,textureCount:c=1,...u}={},p=!0){this.isWebGL2||(t=0),void 0!==e&&void 0!==l&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),l=l||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const h=a?new i.$YQ(l.width,l.height,i.ywz):void 0,d=this.createTargetCustom(c>1?{width:l.width,height:l.height,count:c}:l,{samples:t,encoding:r,type:n,format:s,depthBuffer:o,depthTexture:h},c>1?i.kFz:i.dd2);return this._processNewTarget(d,e,p),this._setTargetOptions(d,u),d}_processNewTarget(e,t,r){return void 0!==t&&(e.sizeMultiplier=t),r&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:t,count:r},n={},s){var o;const a=this._processNewTarget;let l=[e,t];if(r&&r>1&&l.push(r),(null==s?void 0:s.prototype)===i.oAp.prototype){if(e!==t)throw"Width and height of cube render target must be equal";l=[e]}return n={format:i.wk1,minFilter:i.wem,magFilter:i.wem,generateMipmaps:!1,type:i.ywz,encoding:i.rnI,...n},new class extends(null!==(o=s)&&void 0!==o?o:i.dd2){constructor(...e){super(...e),Array.isArray(this.texture)?this.texture.forEach(e=>{e.encoding=n.encoding,e.toJSON=(()=>({}))}):this.texture.toJSON=(()=>({}))}clone(e=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const t=super.clone();return t.texture.isRenderTargetTexture=!0,a(t,this.sizeMultiplier||1,e)}}(...[...l,n])}getTempTarget(e={}){var t;const r=J(e);let i;return(null===(t=this._tempTargets[r])||void 0===t?void 0:t.length)&&(i=this._tempTargets[r].pop()),i?this._setTargetOptions(i,e):(i=this.createTarget(e),this._processNewTempTarget(i,r)),i}_processNewTempTarget(e,t){return e.isTemporary=!0,e.targetKey=t,void 0===this._tempTargets[t]&&(this._tempTargets[t]=[]),e}releaseTempTarget(e){const t=e.targetKey;if(!t||!e.isTemporary)throw"Not a temp target";this._tempTargets[t].length>this.maxTempPerKey?e.dispose():this._tempTargets[t].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,t){var r,n,s;e.texture.minFilter=null!==(r=t.minFilter)&&void 0!==r?r:i.wem,e.texture.magFilter=null!==(n=t.magFilter)&&void 0!==n?n:i.wem,e.texture.generateMipmaps=null!==(s=t.generateMipmaps)&&void 0!==s&&s,e.texture.generateMipmaps&&e.texture.minFilter===i.wem&&(e.texture.minFilter=i.FDw),e.texture.generateMipmaps||e.texture.minFilter!==i.FDw||(e.texture.minFilter=i.wem)}}function J(e={}){var t,r;return[e.sizeMultiplier,e.samples,e.encoding,e.type,e.format,e.depthBuffer,e.depthTexture,null===(t=e.size)||void 0===t?void 0:t.width,null===(r=e.size)||void 0===r?void 0:r.height].join(";")}const Z=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function $(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Z[255&e]+Z[e>>8&255]+Z[e>>16&255]+Z[e>>24&255]+"-"+Z[255&t]+Z[t>>8&255]+"-"+Z[t>>16&15|64]+Z[t>>24&255]+"-"+Z[63&r|128]+Z[r>>8&255]+"-"+Z[r>>16&255]+Z[r>>24&255]+Z[255&i]+Z[i>>8&255]+Z[i>>16&255]+Z[i>>24&255]).toLowerCase()}function ee(e,t,r){return Math.max(t,Math.min(r,e))}function te(e,t,r){return(1-r)*e+r*t}Math.PI,Math.PI;const re=0,ie=1,ne=3,se=4,oe=1006,ae="srgb",le="srgb-linear";function ce(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ue(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const pe={[ae]:{[le]:ce},[le]:{[ae]:ue}},he={legacyMode:!0,get workingColorSpace(){return le},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,r){if(this.legacyMode||t===r||!t||!r)return e;if(pe[t]&&void 0!==pe[t][r]){const i=pe[t][r];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},de={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fe={r:0,g:0,b:0},ge={h:0,s:0,l:0},me={h:0,s:0,l:0};function _e(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function ve(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class xe{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,he.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i="srgb-linear"){return this.r=e,this.g=t,this.b=r,he.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i="srgb-linear"){if(e=function(e,t){return(e%1+1)%1}(e),t=ee(t,0,1),r=ee(r,0,1),0===t)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=_e(n,i,e+1/3),this.g=_e(n,i,e),this.b=_e(n,i,e-1/3)}return he.toWorkingColorSpace(this,i),this}setStyle(e,t="srgb"){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,he.toWorkingColorSpace(this,t),r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,he.toWorkingColorSpace(this,t),r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(e[1])/360,n=parseFloat(e[2])/100,s=parseFloat(e[3])/100;return r(e[4]),this.setHSL(i,n,s,t)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],r=e.length;if(3===r)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,he.toWorkingColorSpace(this,t),this;if(6===r)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,he.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const r=de[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ce(e.r),this.g=ce(e.g),this.b=ce(e.b),this}copyLinearToSRGB(e){return this.r=ue(e.r),this.g=ue(e.g),this.b=ue(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return he.fromWorkingColorSpace(ve(this,fe),e),ee(255*fe.r,0,255)<<16^ee(255*fe.g,0,255)<<8^ee(255*fe.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){he.fromWorkingColorSpace(ve(this,fe),t);const r=fe.r,i=fe.g,n=fe.b,s=Math.max(r,i,n),o=Math.min(r,i,n);let a,l;const c=(o+s)/2;if(o===s)a=0,l=0;else{const e=s-o;switch(l=c<=.5?e/(s+o):e/(2-s-o),s){case r:a=(i-n)/e+(i<n?6:0);break;case i:a=(n-r)/e+2;break;case n:a=(r-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t="srgb-linear"){return he.fromWorkingColorSpace(ve(this,fe),t),e.r=fe.r,e.g=fe.g,e.b=fe.b,e}getStyle(e="srgb"){return he.fromWorkingColorSpace(ve(this,fe),e),e!==ae?`color(${e} ${fe.r} ${fe.g} ${fe.b})`:`rgb(${255*fe.r|0},${255*fe.g|0},${255*fe.b|0})`}offsetHSL(e,t,r){return this.getHSL(ge),ge.h+=e,ge.s+=t,ge.l+=r,this.setHSL(ge.h,ge.s,ge.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(ge),e.getHSL(me);const r=te(ge.h,me.h,t),i=te(ge.s,me.s,t),n=te(ge.l,me.l,t);return this.setHSL(r,i,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function Ae(e,t){const r="map"===t;return{type:"folder",label:t+" Sampler",hidden:()=>!e[t],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!r&&e.map,bounds:[-100,100],stepSize:.001,property:[e[t],"repeat"],onChange:null==e?void 0:e.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!r&&e.map,bounds:[-2,2],property:[e[t],"offset"],onChange:null==e?void 0:e.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!r&&e.map,bounds:[-2,2],property:[e[t],"center"],onChange:null==e?void 0:e.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!r&&e.map,bounds:[-Math.PI,Math.PI],property:[e[t],"rotation"],onChange:null==e?void 0:e.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[e[t],"encoding"],children:[["Linear",i.rnI],["sRGB",i.knz]].map(e=>({label:e[0],value:e[1]})),onChange:[()=>{const r=e[t];r&&(r.needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var r,i;return null!==(i=null===(r=e[t])||void 0===r?void 0:r.flipY)&&void 0!==i&&i},setValue:r=>{var i;const n=e[t];if(n&&n.flipY!==r)if(n.image&&ImageBitmap&&n.image instanceof ImageBitmap){const t=n,i=n.source.data;createImageBitmap(i,{imageOrientation:"flipY"}).then(n=>{var s;i.close&&i.close(),t.flipY=r,t.source.data=n,t.source.needsUpdate=!0,t.needsUpdate=!0,null===(s=null==e?void 0:e.setDirty)||void 0===s||s.call(e)})}else n.flipY=r,n.needsUpdate=!0,null===(i=null==e?void 0:e.setDirty)||void 0===i||i.call(e)}}),()=>({type:"dropdown",label:"Wrap S",property:[e[t],"wrapS"],children:[["ClampToEdge",i.uWy],["MirroredRepeat",i.OoA],["Repeat",i.rpg]].map(e=>({label:e[0],value:e[1]})),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[e[t],"wrapT"],children:[["ClampToEdge",i.uWy],["MirroredRepeat",i.OoA],["Repeat",i.rpg]].map(e=>({label:e[0],value:e[1]})),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[e[t],"anisotropy"],onChange:[()=>{e[t]&&(e[t].needsUpdate=!0),e.needsUpdate=!0},null==e?void 0:e.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[e[t],"minFilter"],children:[["Linear",oe],["Nearest",i.TyD],["NearestMipmapNearest",i.YLQ],["NearestMipmapLinear",i.vZf],["LinearMipmapNearest",i.qyh],["LinearMipmapLinear",i.D1R]].map(e=>({label:e[0],value:e[1]})),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[e[t],"magFilter"],children:[["Linear",oe],["Nearest",i.TyD]].map(e=>({label:e[0],value:e[1]})),onChange:[()=>{e[t]&&(e[t].needsUpdate=!0)},null==e?void 0:e.setDirty]})]}}xe.NAMES=de;const be=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function ye(e,t){if(t)for(const r of Object.keys(t))be.includes(r)||r.startsWith("__")||"function"!=typeof e[r]&&"function"!=typeof t[r]&&(e[r]=t[r]);return e}const we=["appliedMaterials","uuid"];function Ee(e,t){if(t)for(const r of Object.keys(t))we.includes(r)||r.startsWith("__")||"function"!=typeof e[r]&&"function"!=typeof t[r]&&(e[r]=t[r]);return e}const Se=new Map;function Ce(e){return(t,r)=>{const i=t.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");Se.has(i)||Se.set(i,[]),Se.get(i).push([e||r,r])}}const Me={obj:(e,t)=>Object.fromEntries(Object.entries(e).map(([e,r])=>[e,ke(r,!1,t)])),vec4:e=>({x:e.x,y:e.y,z:e.z,w:e.w,isVector4:!0}),vec3:e=>({x:e.x,y:e.y,z:e.z,isVector3:!0}),vec2:e=>({x:e.x,y:e.y,isVector2:!0}),color:e=>({r:e.r,g:e.g,b:e.b,isColor:!0}),quat:e=>({x:e.x,y:e.y,z:e.z,w:e.w,isQuaternion:!0}),texture:(e,t)=>{if(!(null==e?void 0:e.isTexture))throw new Error("Expected a texture");if(e.isRenderTargetTexture)return;if(null==t?void 0:t.textures[e.uuid])return{uuid:e.uuid,resource:"textures"};const r=e.source.data;e.userData.rootPath&&(e.source.data=null);const i=e.userData;e.userData={};let n=e.toJSON(t);return e.userData=i,n.userData=ke(Ee({},i),!1,t),e.userData.rootPath&&(delete t.images[e.source.uuid],e.source.data=r),(null==t?void 0:t.textures)&&(t.textures[n.uuid]||(t.textures[n.uuid]=n),n={uuid:n.uuid,resource:"textures"}),n},material:(e,t)=>{var r;if(!(null==e?void 0:e.isMaterial))throw new Error("Expected a material");if(null==t?void 0:t.materials[e.uuid])return{uuid:e.uuid,resource:"materials"};e.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const i=null!=t?t:{textures:{},images:{}},n={},s={};for(const[a,l]of Object.entries(e))if((null===(r=l)||void 0===r?void 0:r.isTexture)&&!a.startsWith("__")){const t=Me.texture(l,i);n[a]=t,s[a]=l,e[a]=t?{isTexture:!0,toJSON:()=>t}:null}let o=e.toJSON(t);for(const[a,l]of Object.entries(s))e[a]=l,delete s[a];if(t){for(const[e,t]of Object.entries(n))t&&(o[e]=t);(null==t?void 0:t.materials)&&(t.materials[o.uuid]||(t.materials[o.uuid]=o),o={uuid:o.uuid,resource:"materials"})}else{for(const[e,t]of Object.entries(n))o[e]=t.uuid;o.textures=Object.values(i.textures),o.images=Object.values(i.images)}return o}},Te=e=>(t,r)=>{var i,n;return null!==(n=null===(i=null==r?void 0:r.copy)||void 0===i?void 0:i.call(r,t))&&void 0!==n?n:(new e).copy(t)},Ie={obj:(e,t,r)=>Object.assign(t,Object.fromEntries(Object.entries(e).map(([e,i])=>[e,De(i,null==t?void 0:t[e],!1,r)]))),vec4:Te(i.Ltg),vec3:Te(i.Pa4),vec2:Te(I),color:Te(xe),quat:Te(i._fP)};function ke(e,t,r){var i,n;if("function"==typeof e)return;if(Array.isArray(e))return e.map(e=>ke(e,!1,r));if("object"!=typeof e){if("number"==typeof e){if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN"}return e}if(!e)return e;let s=null!==(i=e.constructor)&&void 0!==i?i:Object;if(s===Object)return Me.obj(e,r);if(e.isVector2)return Me.vec2(e);if(e.isVector3)return Me.vec3(e);if(e.isVector4)return Me.vec4(e);if(e.isColor)return Me.color(e);if(e.isQuaternion)return Me.quat(e);if(e.isTexture)return Me.texture(e,r);if(e.isMaterial)return Me.material(e,r);if(!t&&"function"==typeof e.toJSON)return e.toJSON(r);const o={};for(;s&&s!==Object;)null===(n=Se.get(s))||void 0===n||n.forEach(([t,i])=>{const n=e[i];o[t]=ke(n,!1,r)}),s=Object.getPrototypeOf(s);return e.serializableClassId&&(o.serializableClassId=e.serializableClassId),o}function De(e,t,r,i){var n,s,o;let a=t;if(void 0===e)return a;if("number"==typeof t){if("Infinity"===e)return 1/0;if("-Infinity"===e)return-1/0;if("NaN"===e)return NaN;if("number"==typeof e||!e)return e}if(Array.isArray(e)){const t=e.length;Array.isArray(a)||(a=[]);for(let r=0;r<t;r++){const t=e[r],n=a.length>r?De(t,a[r],!1,i):De(t,void 0,!1,i);a.length<=r?a.push(n):a[r]=n}return a}let l=!1;if(e&&e.resource&&"string"==typeof e.resource&&(e=null===(n=i[e.resource])||void 0===n?void 0:n[e.uuid],l=!0),!a&&e&&!l)if(e.serializableClassId){const t=Pe.get(e.serializableClassId);t&&(a=new t)}else"object"!=typeof e||e.constructor&&e.constructor!==Object||(a={});if("function"==typeof a)return console.error("cannot deserialize over function",a,e),a;if(e&&"object"==typeof e&&!l){if(e.isVector2)return Ie.vec2(e,a);if(e.isVector3)return Ie.vec3(e,a);if(e.isVector4)return Ie.vec4(e,a);if(e.isColor)return Ie.color(e,a);if(e.isQuaternion)return Ie.quat(e,a)}if(null==e||null==a||"object"!=typeof a||a.isTexture)return l&&(e?e.__useCount=e.__useCount?e.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),e;let c=null!==(s=a.constructor)&&void 0!==s?s:Object;if(c===Object)return Ie.obj(e,a,i);if(!r&&"function"==typeof a.fromJSON)return a.isMaterial&&(Object.entries(e).forEach(([t,r])=>{var n;if(!r||!r.resource||"string"!=typeof r.resource)return;const s=null===(n=i[r.resource])||void 0===n?void 0:n[r.uuid];e[t]=s||null}),e.userData&&(e.userData=De(e.userData,void 0,!1,i))),a.fromJSON(e,i),a;for(;c&&c!==Object;)null===(o=Se.get(c))||void 0===o||o.forEach(([t,r])=>{const n=a[r],s=De(e[t],n,!1,i);s!==n&&m(a,r,s,!0)}),c=Object.getPrototypeOf(c);return a}const Pe=new Map;function Be(e){return t=>(t=class extends t{constructor(){super(...arguments),this.serializableClassId=e}},Pe.set(e,t),t)}function Re(e,t){if(e.uiConfig)return e.uiConfig;const r={type:"folder",label:e.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[e,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{e.dispatchEvent({type:"select",ui:!0,value:e,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!e.parent,value:()=>{const t=e.parent;t&&t.dispatchEvent({type:"select",ui:!0,value:t})}},{type:"input",label:"Name",property:[e,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!e.isMesh,property:[e,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!e.isMesh,property:[e,"receiveShadow"]},{type:"vec3",label:"Position",property:[e,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[e,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[e,"scale"]},{type:"input",label:"Render Order",property:[e,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",e.userData.autoScaleRadius||"2",!0],value:t=>{if(!t)return;const r=parseFloat(t);Math.abs(r)>0&&X(e,r)}},void 0!==e.userData.license?{type:"input",label:"License/Credits",property:[e.userData,"license"],limitedUi:!0}:{}]},i=e;if((null==i?void 0:i.isMesh)&&!1!==t){const e=[()=>{var e;return null===(e=i.geometry)||void 0===e?void 0:e.uiConfig},()=>{var e;return Array.isArray(i.material)?i.material.length<1?void 0:{label:"Materials",type:"folder",children:i.material.map(e=>null==e?void 0:e.uiConfig).filter(e=>e)}:null===(e=i.material)||void 0===e?void 0:e.uiConfig}];r.children.push(...e)}if(null==e?void 0:e.isCamera){const t=[{type:"button",label:"Set View",value:()=>{var t;e.dispatchEvent({type:"setView",ui:!0,camera:e}),null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var t;return null===(t=e.userData.iCamera)||void 0===t?void 0:t.isActiveCamera},value:()=>{var t;e.dispatchEvent({type:"activateMain",ui:!0,camera:e}),null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var t;return!(null===(t=e.userData.iCamera)||void 0===t?void 0:t.isActiveCamera)},value:()=>{var t;e.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>{var t;return null===(t=e.userData.autoLookAtTarget)||void 0===t||t},setValue:t=>{var i;e.userData.autoLookAtTarget=t,null===(i=r.uiRefresh)||void 0===i||i.call(r,"postFrame",!0)}}];r.children.push(...t)}return e.uiConfig=r,r}function Le(e,t,r){var i;if(!e)return void console.warn("setupIModel: object is undefined");if(e.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",e),delete e.__disposed),e.userData||(e.userData={}),e.userData.__iModelSetup&&e.modelObject)return e;e.userData.__iModelSetup=!0;let n=[];n.push(()=>{[...e.children].forEach(e=>{var t;null===(t=null==e?void 0:e.dispose)||void 0===t||t.call(e)}),e.children=[],e.parent&&e.removeFromParent()}),e.isLight&&!e.assetType?(e.assetType="light",e.lightObject=e):e.isCamera?(e.assetType="camera",e.cameraObject=e):e.assetType||(e.assetType="model"),e.modelObject||(e.modelObject=e),e.setDirty||(e.setDirty=((t={})=>{e.dispatchEvent({...t,type:"objectUpdate",object:e})}),e.userData.setDirty&&console.warn("userData.setDirty already defined",e.userData.setDirty,e),e.userData.setDirty=(t=>{var r;console.warn("userData.setDirty is deprecated, use setDirty directly"),null===(r=e.setDirty)||void 0===r||r.call(e,t)}));const s=t=>{var r,i,n;const s=null!==(i=null===(r=e.parent)||void 0===r?void 0:r.userData.parentRoot)&&void 0!==i?i:e.parent;s!==e.userData.parentRoot&&e.traverse(e=>{e.userData.parentRoot=s}),null===(n=e.setDirty)||void 0===n||n.call(e,{change:"addedToParent"})},o=()=>{var t;null===(t=e.setDirty)||void 0===t||t.call(e,{change:"removedFromParent"}),void 0!==e.userData.parentRoot&&e.traverse(e=>{e.userData.parentRoot=void 0})};e.addEventListener("added",s),e.addEventListener("removed",o),n.push(()=>{e.removeEventListener("added",s),e.removeEventListener("removed",o)});const a=e.dispose;e.dispose=(()=>{e.dispatchEvent({type:"dispose"}),null==a||a.call(e)}),e.userData.dispose&&console.warn("userData.dispose already defined"),e.userData.dispose=(()=>{var t;console.warn("userData.dispose is deprecated, use dispose directly"),null===(t=e.dispose)||void 0===t||t.call(e)});const l=e;!l.isMesh&&!l.isLine||l.userData.__meshSetup||(l.userData.__meshSetup=!0,l.setMaterial||(l.setMaterial=(e=>Oe(l,e))),l.setGeometry||(l.setGeometry=((e,t=!1)=>Fe(l,e,t)),l.setGeometry(l.geometry,!0)),e.userData.setMaterial&&console.warn("userData.setMaterial already defined"),e.userData.setMaterial=(t=>{var r;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),null===(r=e.setMaterial)||void 0===r||r.call(e,t)}),e.userData.setGeometry&&console.warn("userData.setGeometry already defined"),e.userData.setGeometry=((t,...r)=>{var i;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),null===(i=e.setGeometry)||void 0===i||i.call(e,t,...r)}),e.userData.__keepShadowDef||(e.castShadow=!0,e.receiveShadow=!0,e.userData.__keepShadowDef=!0),n.push(()=>{var e,t;const r=(null===(e=l.setMaterial)||void 0===e?void 0:e.call(l,void 0))||[],i=null===(t=l.setGeometry)||void 0===t?void 0:t.call(l,void 0);for(const n of r)n&&0===n.userData.__appliedMeshes.size&&!1!==n.userData.disposeOnIdle&&n.dispose();i&&0===i.userData.__appliedMeshes.size&&!1!==i.userData.disposeOnIdle&&i.dispose()})),e.uiConfig||"model"!==e.assetType&&"camera"!==e.assetType||(Re(e),n.push(()=>{e.uiConfig=void 0}));const c=()=>{var t,r;return null===(r=null===(t=e.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===r?void 0:r.call(t,"postFrame",!0,1)};e.addEventListener("objectUpdate",c),n.push(()=>e.removeEventListener("objectUpdate",c)),e.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(e.userData.__autoParentDispatchEvents=e.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],e.isCamera&&e.userData.__autoParentDispatchEvents.push("activateMain","setView")),t&&(e.userData.parentRoot=t),n.push(()=>{delete e.userData.parentRoot});const u=e.dispatchEvent;e.dispatchEvent=(t=>{var r;(null===(r=e.userData.__autoParentDispatchEvents)||void 0===r?void 0:r.includes(t.type))&&(t.parentDispatch=!0),t.parentDispatch&&(t=>{var r;const i=null!==(r=e.userData.parentRoot)&&void 0!==r?r:e.parent;(null==i?void 0:i.modelObject)&&i.dispatchEvent(t)})(t),u.call(e,t)}),n.push(()=>{e.dispatchEvent=u});const p=e.clone;e.clone=((...t)=>{const i=e.userData;e.userData={};let n=p.call(e,...t);e.userData=i,je(n.userData,i);const s=e.userData.parentRoot;return s&&"model"!==s.assetType&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),(n=Le(n,s,r)).userData.cloneParent=e.uuid,n}),n.push(()=>{e.clone=p});const h=e.copy;e.copy=((t,...r)=>{const i=t.userData;t.userData={};const n=h.call(e,t,...r);return t.userData=i,je(e.userData,t),n}),n.push(()=>{e.copy=h});const d=e.add;return e.add=((...t)=>(t.forEach(t=>Le(t,e.userData.parentRoot||e,r)),d.call(e,...t))),n.push(()=>{e.add=d}),e=null!==(i=null==r?void 0:r(e))&&void 0!==i?i:e,n.push(()=>{m(e,"modelObject",void 0,!0),e.userData={}}),e.addEventListener("dispose",()=>{e.__disposed?console.warn("Object already disposed",e):(e.__disposed=!0,n.forEach(e=>e()),n=[])}),[...e.children].forEach(t=>Le(t,e,r)),e}function Oe(e,t){var r,i,n,s,o;const a=(Array.isArray(t)?t:[t]).map(e=>null==e?void 0:e.materialObject).filter(e=>e);if(e.material==a||1===a.length&&e.material===a[0])return[];e.userData.__materialUpdater||(e.userData.__materialUpdater=(()=>{e.dispatchEvent({type:"materialUpdate"})}));const l=Array.isArray(e.material)?[...e.material]:[e.material];for(const u of l)u&&(u.removeEventListener("materialUpdate",e.userData.__materialUpdater),null===(i=null===(r=u.userData)||void 0===r?void 0:r.__appliedMeshes)||void 0===i||i.delete(e));const c=[];for(const u of a)u.userData.__appliedMeshes||(u.userData.__appliedMeshes=new Set),c.push(u),u&&(u.addEventListener("materialUpdate",e.userData.__materialUpdater),u.userData.__appliedMeshes.add(e));return e.material=1!==c.length?c:null!==(n=c[0])&&void 0!==n?n:void 0,e.traverseAncestors(t=>{t.isRootScene&&t.refreshEnvMapIntensity(e)}),e.dispatchEvent({type:"materialChanged",material:t}),null===(o=null===(s=e.uiConfig)||void 0===s?void 0:s.uiRefresh)||void 0===o||o.call(s,"postFrame",!0),l}function Fe(e,t,r=!1){var i,n,s,o,a,l,c;e.userData.__objectUpdater||(e.userData.__objectUpdater=(t=>{e.dispatchEvent({...t,type:"objectUpdate"})}));let u=e.geometry;const p=u;return(u!==t||r)&&(u&&(u.removeEventListener("geometryUpdate",e.userData.__objectUpdater),null===(n=null===(i=u.userData)||void 0===i?void 0:i.__appliedMeshes)||void 0===n||n.delete(e)),(u=t)&&!u.userData.__appliedMeshes&&(u.userData.__appliedMeshes=new Set),e.geometry=null!==(s=u)&&void 0!==s?s:void 0,u&&(u.addEventListener("geometryUpdate",e.userData.__objectUpdater),null===(a=null===(o=u.userData)||void 0===o?void 0:o.__appliedMeshes)||void 0===a||a.add(e))),t&&!t.uiConfig&&(t.uiConfig=function(e){return{label:"Geometry",type:"folder",children:[{type:"input",property:[e,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{e.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||e.setAttribute("uv2",e.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var t,r,i;return null!==(i=null===(r=null===(t=e.userData)||void 0===t?void 0:t.__appliedMeshes)||void 0===r?void 0:r.size)&&void 0!==i?i:0},set value(e){},disabled:!0}]}}(e.geometry)),e.dispatchEvent({type:"geometryChanged",geometry:t}),null===(c=null===(l=e.uiConfig)||void 0===l?void 0:l.uiRefresh)||void 0===c||c.call(l,"postFrame",!0),p===u?void 0:p||void 0}const Ue=["appliedMeshes"],Ne=["parentRoot","iCamera","iModel"];function je(e,t){if(t)for(const r of Object.keys(t))Ne.includes(r)||r.startsWith("__")||"function"!=typeof e[r]&&"function"!=typeof t[r]&&(e[r]=t[r]);return e}var Ge,ze=new Uint8Array(16);for(var Ve=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Qe=[],He=0;He<256;++He)Qe.push((He+256).toString(16).substr(1));var We=function(e,t,r){var i=(e=e||{}).random||(e.rng||function(){if(!Ge&&!(Ge="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ge(ze)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(Qe[e[t+0]]+Qe[e[t+1]]+Qe[e[t+2]]+Qe[e[t+3]]+"-"+Qe[e[t+4]]+Qe[e[t+5]]+"-"+Qe[e[t+6]]+Qe[e[t+7]]+"-"+Qe[e[t+8]]+Qe[e[t+9]]+"-"+Qe[e[t+10]]+Qe[e[t+11]]+Qe[e[t+12]]+Qe[e[t+13]]+Qe[e[t+14]]+Qe[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Ve.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r}(i)};const qe=new Map;function Xe(e,t){return(r,i)=>{const n=r.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");qe.has(n)||qe.set(n,[]);const s=qe.get(n);if(!(s.findIndex(e=>e.propKey===i)<0))throw new Error(`Property ${i} already has a uiConfig decorator`);s.push({params:t||{},propKey:i,uiType:e})}}function Ye(e,t){return Xe("checkbox",{label:e,params:t})}function Ke(e,t){return Xe("monitor",{label:e,params:t})}function Je(e,t,r,i){return Xe("slider",{label:e,bounds:t,stepSize:r,params:i})}function Ze(e,t,r,i){return Xe("vec",{label:e,bounds:t,stepSize:r,params:i})}function $e(e,t,r){return Xe("dropdown",{label:e,children:t,params:r})}function et(e,t){return Xe("button",{label:e,params:t})}function tt(e,t){return Xe("input",{label:e,params:t})}function rt(e,t){return Xe("color",{label:e,params:t})}function it(e,t){return Xe("image",{label:e,params:t})}function nt(e){let t=null==e?void 0:e.constructor;if(!e||!t)return[];const r=[],i=[];for(;t&&t!==Object;)i.push(t),t=Object.getPrototypeOf(t);return i.reverse().forEach(t=>{var i;null===(i=qe.get(t))||void 0===i||i.forEach(({params:t,propKey:i,uiType:n})=>{var s;let o;if(n||(o=null===(s=e[i])||void 0===s?void 0:s.uiConfig),o||(o={property:[e,i],type:n||"input"}),t){const r="function"==typeof t.params?t.params(e):t.params||{};delete t.params,Object.assign(o,{...t,...r})}r.push(o)})}),r}function st(e,t,r={},i="folder"){return{type:i,label:e,children:nt(t),uuid:We(),...r}}function ot(e,t,r="folder"){return i=>(class extends i{constructor(){super(...arguments),this.uiConfig=st(e,this,t||{},r)}})}function at(e,t){return ot(e,t,"panel")}const lt={type:"change"},ct={type:"start"},ut={type:"end"};class pt extends i.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new i.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.RsA.ROTATE,MIDDLE:i.RsA.DOLLY,RIGHT:i.RsA.PAN},this.touches={ONE:i.QmN.ROTATE,TWO:i.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",Q),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(lt),r.update(),s=n.NONE},this.update=function(){const t=new i.Pa4,h=(new i._fP).setFromUnitVectors(e.up,new i.Pa4(0,1,0)),d=h.clone().invert(),f=new i.Pa4,g=new i._fP,m=2*Math.PI;return function(){const e=r.object.position;t.copy(e).sub(r.target),t.applyQuaternion(h),a.setFromVector3(t),r.autoRotate&&s===n.NONE&&E(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(a.theta+=l.theta*r.dampingFactor,a.phi+=l.phi*r.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let i=r.minAzimuthAngle,_=r.maxAzimuthAngle;isFinite(i)&&isFinite(_)&&(i<-Math.PI?i+=m:i>Math.PI&&(i-=m),_<-Math.PI?_+=m:_>Math.PI&&(_-=m),a.theta=i<=_?Math.max(i,Math.min(_,a.theta)):a.theta>(i+_)/2?Math.max(i,a.theta):Math.min(_,a.theta)),a.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,a.phi)),a.makeSafe(),Math.abs(l.radius)>0&&(r.dollyZoom&&(r.object.zoom=Math.max(Math.max(r.minZoom,.1),Math.min(Math.min(r.maxZoom,20),r.object.zoom*(1+l.radius*(r.enableDamping?r.dampingFactor:1)))),r.object.updateProjectionMatrix(),(r.object.zoom>=Math.min(r.maxZoom,20)||r.object.zoom<=Math.max(r.minZoom,.1))&&(l.radius=0)),a.radius*=1+l.radius*(r.enableDamping?r.dampingFactor:1)),Math.abs(c-1)>1e-5&&(r.dollyZoom&&(r.object.zoom=Math.max(Math.max(r.minZoom,.1),Math.min(Math.min(r.maxZoom,20),r.object.zoom*c)),r.object.updateProjectionMatrix(),(r.object.zoom>=Math.min(r.maxZoom,20)||r.object.zoom<=Math.max(r.minZoom,.1))&&(c=1)),a.radius*=c);let v=0;r.autoPushTarget&&a.radius<r.minDistance&&(v=r.minDistance-a.radius),a.radius=Math.max(r.minDistance,Math.min(r.maxDistance,a.radius)),!0===r.enableDamping?r.target.addScaledVector(u,r.dampingFactor):r.target.add(u),t.setFromSpherical(a),t.applyQuaternion(d),e.copy(r.target).add(t),r.target.add(t.normalize().multiplyScalar(-v)),r.object.lookAt(r.target);let x=!1;return!0===r.enableDamping&&Math.abs(l.theta)+Math.abs(l.phi)+Math.abs(l.radius)+u.length()>.001?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,l.radius*=1-r.dampingFactor,u.multiplyScalar(1-r.dampingFactor),x=!0):(l.set(0,0,0),u.set(0,0,0)),c=1,!!(p||x||f.distanceToSquared(r.object.position)>o||8*(1-g.dot(r.object.quaternion))>o)&&(r.dispatchEvent(lt),f.copy(r.object.position),g.copy(r.object.quaternion),p=!1,!0)}}(),this.stopDamping=function(){l.set(0,0,0),u.set(0,0,0)},this.dispose=function(){r.domElement.removeEventListener("contextmenu",H),r.domElement.removeEventListener("pointerdown",N),r.domElement.removeEventListener("pointercancel",z),r.domElement.removeEventListener("wheel",V),r.domElement.removeEventListener("pointermove",j),r.domElement.removeEventListener("pointerup",G),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",Q)};const r=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=n.NONE;const o=1e-6,a=new i.$V,l=new i.$V(0,0,0);let c=1;const u=new i.Pa4;let p=!1;const h=new i.FM8,d=new i.FM8,f=new i.FM8,g=new i.FM8,m=new i.FM8,_=new i.FM8,v=new i.FM8,x=new i.FM8,A=new i.FM8,b=[],y={};function w(){return r.enableDamping?1:Math.pow(.95,r.zoomSpeed)}function E(e){l.theta-=e}function S(e){l.phi-=e}this.rotateUp=S,this.rotateLeft=E;const C=function(){const e=new i.Pa4;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),u.add(e)}}(),M=function(){const e=new i.Pa4;return function(t,i){!0===r.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),u.add(e)}}(),T=function(){const e=new i.Pa4;return function(t,i){const n=r.domElement;if(r.object.isPerspectiveCamera){const s=r.object.position;e.copy(s).sub(r.target);let o=e.length();o*=Math.tan(r.object.fov/2*Math.PI/180),C(2*t*o/n.clientHeight,r.object.matrix),M(2*i*o/n.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(C(t*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),M(i*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function I(e,t=0){r.object.isPerspectiveCamera?(c/=e,l.radius=Math.max(-r.maxZoomSpeed,Math.min(r.maxZoomSpeed,l.radius-t))):r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function k(e,t=0){r.object.isPerspectiveCamera?(c*=e,l.radius=Math.max(-r.maxZoomSpeed,Math.min(r.maxZoomSpeed,l.radius+t))):r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function D(e){h.set(e.clientX,e.clientY)}function P(e){g.set(e.clientX,e.clientY)}function B(){if(1===b.length)h.set(b[0].pageX,b[0].pageY);else{const e=.5*(b[0].pageX+b[1].pageX),t=.5*(b[0].pageY+b[1].pageY);h.set(e,t)}}function R(){if(1===b.length)g.set(b[0].pageX,b[0].pageY);else{const e=.5*(b[0].pageX+b[1].pageX),t=.5*(b[0].pageY+b[1].pageY);g.set(e,t)}}function L(){const e=b[0].pageX-b[1].pageX,t=b[0].pageY-b[1].pageY,r=Math.sqrt(e*e+t*t);v.set(0,r)}function O(e){if(1==b.length)d.set(e.pageX,e.pageY);else{const t=X(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);d.set(r,i)}f.subVectors(d,h).multiplyScalar(r.rotateSpeed);const t=r.domElement;E(2*Math.PI*f.x/t.clientHeight),S(2*Math.PI*f.y/t.clientHeight),h.copy(d)}function F(e){if(1===b.length)m.set(e.pageX,e.pageY);else{const t=X(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);m.set(r,i)}_.subVectors(m,g).multiplyScalar(r.panSpeed),T(_.x,_.y),g.copy(m)}function U(e){const t=X(e),i=e.pageX-t.x,n=e.pageY-t.y,s=Math.sqrt(i*i+n*n);x.set(0,s),A.set(0,Math.pow(x.y/v.y,6*r.zoomSpeed)),I(A.y),v.copy(x)}function N(e){!1!==r.enabled&&(0===b.length&&(r.domElement.setPointerCapture(e.pointerId),r.domElement.addEventListener("pointermove",j),r.domElement.addEventListener("pointerup",G)),function(e){b.push(e)}(e),"touch"===e.pointerType?function(e){switch(q(e),b.length){case 1:switch(r.touches.ONE){case i.QmN.ROTATE:if(!1===r.enableRotate)return;B(),s=n.TOUCH_ROTATE;break;case i.QmN.PAN:if(!1===r.enablePan)return;R(),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(r.touches.TWO){case i.QmN.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&L(),r.enablePan&&R(),s=n.TOUCH_DOLLY_PAN;break;case i.QmN.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&L(),r.enableRotate&&B(),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&r.dispatchEvent(ct)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.RsA.DOLLY:if(!1===r.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(e),s=n.DOLLY;break;case i.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;P(e),s=n.PAN}else{if(!1===r.enableRotate)return;D(e),s=n.ROTATE}break;case i.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;D(e),s=n.ROTATE}else{if(!1===r.enablePan)return;P(e),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&r.dispatchEvent(ct)}(e))}function j(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(q(e),s){case n.TOUCH_ROTATE:if(!1===r.enableRotate)return;O(e),r.update();break;case n.TOUCH_PAN:if(!1===r.enablePan)return;F(e),r.update();break;case n.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&U(e),r.enablePan&&F(e)}(e),r.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&U(e),r.enableRotate&&O(e)}(e),r.update();break;default:s=n.NONE}}(e):function(e){switch(s){case n.ROTATE:if(!1===r.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),f.subVectors(d,h).multiplyScalar(r.rotateSpeed);const t=r.domElement;E(2*Math.PI*f.x/t.clientHeight),S(2*Math.PI*f.y/t.clientHeight),h.copy(d),r.update()}(e);break;case n.DOLLY:if(!1===r.enableZoom)return;!function(e){x.set(e.clientX,e.clientY),A.subVectors(x,v),A.y>0?I(w()):A.y<0&&k(w()),v.copy(x),r.update()}(e);break;case n.PAN:if(!1===r.enablePan)return;!function(e){m.set(e.clientX,e.clientY),_.subVectors(m,g).multiplyScalar(r.panSpeed),T(_.x,_.y),g.copy(m),r.update()}(e)}}(e))}function G(e){W(e),0===b.length&&(r.domElement.releasePointerCapture(e.pointerId),r.domElement.removeEventListener("pointermove",j),r.domElement.removeEventListener("pointerup",G)),r.dispatchEvent(ut),s=n.NONE}function z(e){W(e)}function V(e){!1!==r.enabled&&!1!==r.enableZoom&&s===n.NONE&&(e.preventDefault(),r.dispatchEvent(ct),function(e){let t=0;switch(e.deltaMode){case 2:t+=1*e.deltaY;break;case 1:t+=.4*e.deltaY;break;default:t+=.01*e.deltaY}e.deltaY<0?k(1,t*r.zoomSpeed):e.deltaY>0&&I(1,-t*r.zoomSpeed),r.update()}(e),r.dispatchEvent(ut))}function Q(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:T(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:T(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:T(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:T(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function H(e){!1!==r.enabled&&e.preventDefault()}function W(e){delete y[e.pointerId];for(let t=0;t<b.length;t++)if(b[t].pointerId==e.pointerId)return void b.splice(t,1)}function q(e){let t=y[e.pointerId];void 0===t&&(t=new i.FM8,y[e.pointerId]=t),t.set(e.pageX,e.pageY)}function X(e){const t=e.pointerId===b[0].pointerId?b[1]:b[0];return y[t.pointerId]}this.zoomIn=function(e){I(1,e*r.zoomSpeed)},this.zoomOut=function(e){k(1,e*r.zoomSpeed)},r.domElement.addEventListener("contextmenu",H),r.domElement.addEventListener("pointerdown",N),r.domElement.addEventListener("pointercancel",z),r.domElement.addEventListener("wheel",V,{passive:!1}),this.update()}}var ht=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let dt=class extends pt{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(e){super.zoomIn(e)}zoomOut(e){super.zoomOut(e)}dispatchEvent(e){super.dispatchEvent(e)}};ht([Ce()],dt.prototype,"type",void 0),ht([Ye()],dt.prototype,"enabled",void 0),ht([Ye(),Ce()],dt.prototype,"dollyZoom",void 0),ht([Ye(),Ce()],dt.prototype,"enableDamping",void 0),ht([tt(),Ce()],dt.prototype,"dampingFactor",void 0),ht([Ye(),Ce()],dt.prototype,"autoRotate",void 0),ht([tt(),Ce()],dt.prototype,"autoRotateSpeed",void 0),ht([Ye(),Ce()],dt.prototype,"enableZoom",void 0),ht([tt(),Ce()],dt.prototype,"zoomSpeed",void 0),ht([tt(),Ce()],dt.prototype,"maxZoomSpeed",void 0),ht([Ye(),Ce()],dt.prototype,"enableRotate",void 0),ht([tt(),Ce()],dt.prototype,"rotateSpeed",void 0),ht([Ye(),Ce()],dt.prototype,"enablePan",void 0),ht([tt(),Ce()],dt.prototype,"panSpeed",void 0),ht([tt(),Ce()],dt.prototype,"autoPushTarget",void 0),ht([tt(),Ce()],dt.prototype,"minDistance",void 0),ht([tt(),Ce()],dt.prototype,"maxDistance",void 0),ht([tt(),Ce()],dt.prototype,"minZoom",void 0),ht([tt(),Ce()],dt.prototype,"maxZoom",void 0),ht([tt(),Ce()],dt.prototype,"minPolarAngle",void 0),ht([tt(),Ce()],dt.prototype,"maxPolarAngle",void 0),ht([tt(),Ce()],dt.prototype,"minAzimuthAngle",void 0),ht([tt(),Ce()],dt.prototype,"maxAzimuthAngle",void 0),ht([Ce()],dt.prototype,"screenSpacePanning",void 0),ht([Ce()],dt.prototype,"keyPanSpeed",void 0),dt=ht([at("Orbit Controls")],dt);var ft=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class gt extends r{constructor(e,t,r){var n;super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=(e=>{this.setDirty(e)}),this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new i.Pa4(0,0,10),this._target=new i.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(e,t)=>{const r=new dt(e,t.ownerDocument?t:t.documentElement);return r.screenSpacePanning=!0,r}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(e=>({label:""===e?"none":e,value:e})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var e;return(null===(e=this._controls)||void 0===e?void 0:e.zoomIn)?{type:"button",label:"Zoom in",value:()=>{var e;null===(e=this._controls)||void 0===e||e.zoomIn(1)}}:{}},()=>{var e;return(null===(e=this._controls)||void 0===e?void 0:e.zoomOut)?{type:"button",label:"Zoom out",value:()=>{var e;null===(e=this._controls)||void 0===e||e.zoomOut(1)}}:{}},()=>{var e;return null===(e=this._controls)||void 0===e?void 0:e.uiConfig}]},this.assetType="model",this.uuid=$(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=null!=r?r:document.body;const s=null!==(n={...t})&&void 0!==n?n:this._options;this._camera=this._setCameraObject(null!=e?e:"OrthographicCamera"===s.type?new i.iKG(-1,1,1,-1):new i.cPb),this._camera.modelObject.userData.iCamera=this;const o=e;e&&(o.isPerspectiveCamera?(s.fov=o.fov,s.focus=o.focus,s.aspect=o.aspect<=0||o.userData.autoAspect?"auto":o.aspect,s.zoom=o.zoom):o.isOrthographicCamera&&(s.left=o.left,s.right=o.right,s.top=o.top,s.bottom=o.bottom,s.zoom=o.zoom),s.near=o.near,s.far=o.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(s)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>1e-5;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>1e-5;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var r,i;const n={...e};(null===(r=n.position)||void 0===r?void 0:r.isVector3)&&(n.position=[n.position.x,n.position.y,n.position.z]),(null===(i=n.target)||void 0===i?void 0:i.isVector3)&&(n.target=[n.target.x,n.target.y,n.target.z]),Object.keys(n).forEach(e=>"frustumSize"!==e&&void 0===n[e]&&delete n[e]),Object.assign(this._options,n),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const e="PerspectiveCamera"===this._options.type?new i.cPb:new i.iKG;e.name=this._camera.name,e.near=this._camera.modelObject.near,e.far=this._camera.modelObject.far,e.zoom=this._camera.modelObject.zoom,e.scale.copy(this._camera.modelObject.scale);const r=this._isActiveCamera;r&&this.deactivateMain(),this._camera=this._setCameraObject(e),t=this._camera.modelObject,r&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let r=this._options.aspect;if("auto"===r&&(r=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),"PerspectiveCamera"===this._options.type&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=r),"OrthographicCamera"===this._options.type){const e=this._options.frustumSize;void 0!==e?(t.top=e/2,t.bottom=-e/2,t.left=r*e/2,t.right=-r*e/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Le(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){"auto"===this._options.aspect&&this._refreshCameraOptions(e)}refreshTarget(e=4){var t;(null===(t=this._controls)||void 0===t?void 0:t.enabled)&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this._position)}setControlsCtor(e,t,r=!1){r||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,t,r;const i=this._options.controlsMode;this._controls=null!==(t=null===(e=this._controlsCtors.get(i))||void 0===e?void 0:e(this._camera.modelObject,this._container))&&void 0!==t?t:void 0,this._controls||console.error("Unable to create controls with mode "+i+". Are you missing a plugin?"),null===(r=this._controls)||void 0===r||r.addEventListener("change",this.setDirty),this._controlsMode=this._controls?i:""}_disposeCameraControls(){var e,t;this._controlsMode,null===(e=this._controls)||void 0===e||e.removeEventListener("change",this.setDirty),null===(t=this._controls)||void 0===t||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,r;if(this._options.controlsEnabled){const e=this._options.controlsMode;this._controls?this._controlsMode===e&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=e}if(this._controls){const e=this.interactionsEnabled;this._controls.enabled=e,e&&this._camera.modelObject.up.copy(i.Tme.DefaultUp)}e&&this.setDirty(),null===(r=(t=this.uiConfig).uiRefresh)||void 0===r||r.call(t,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),void 0!==this._camera.modelObject.fov&&(this._options.fov=this._camera.modelObject.fov),void 0!==this._camera.modelObject.focus&&(this._options.focus=this._camera.modelObject.focus),void 0!==this._camera.modelObject.zoom&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e,"postFrame",!1,1)})}activateMain(e=!0){var t,r;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new i.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),null===(r=(t=this._camera).setDirty)||void 0===r||r.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var t,r;const i=this.target;null===(r=null===(t=this._controls)||void 0===t?void 0:t.target)||void 0===r||r.set(i.x,i.y,i.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(void 0!==this._camera.userData.autoLookAtTarget&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(i),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t;return(null===(t=e.uniforms.cameraPositionWorld)||void 0===t?void 0:t.value)&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA="PerspectiveCamera"===this._camera.modelObject.type?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA="OrthographicCamera"===this._camera.modelObject.type?"1":"0",this}toJSON(e){return Object.assign({},ke(this,!0,e))}fromJSON(e,t){return De(e,this,!0,t),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}ft([Ce("camControls")],gt.prototype,"_controls",void 0),ft([Ce()],gt.prototype,"userData",void 0),ft([M(gt.prototype._nearFarChanged)],gt.prototype,"near",void 0),ft([M(gt.prototype._nearFarChanged)],gt.prototype,"far",void 0),ft([Ce("camOptions")],gt.prototype,"_options",void 0),ft([Ce("position")],gt.prototype,"_position",void 0),ft([Ce("target")],gt.prototype,"_target",void 0);var mt=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class _t extends i.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new k,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new gt(new i.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Le(new i.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new i.GQ(this.getBounds())}refreshEnvMapIntensity(e){return(null==e?void 0:e.isObject3D)||(e=this),(null!=e?e:this).traverse(e=>{(Array.isArray(e.material)?e.material:[e.material]).forEach(e=>{e&&void 0!==e.envMapIntensity&&!e.userData.separateEnvMapIntensity&&(e.envMapIntensity=this.envMapIntensity,e.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let t=this._cameras.indexOf(e);t<0&&(this._cameras.push(e),t=this._cameras.length-1),this._activeCamera=t}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,t={}){return"model"!==e.assetType&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){"widget"!==e.assetType&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(null==e?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const r=e.assetType;let i=!1;switch(r){case"model":(i=e.modelObject.isCamera)&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,r)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:r=2,addToRoot:i=!1}={}){const n=e;n?(t&&!n.userData.autoScaled&&X(n,n.userData.autoScaleRadius||r),n.traverse(e=>{e.isMesh&&!e.userData.__keepShadowDef&&(e.castShadow=!0,e.receiveShadow=!0,e.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(n),i?this.modelObject.add(n):this.modelRoot.add(n),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var t,r;(null!==(t=e.dispose)&&void 0!==t?t:null===(r=e.modelObject)||void 0===r?void 0:r.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(e=>Le(e))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if("texture"!==(null==e?void 0:e.assetType))return void console.error("Unknown Environment type",e);e.mapping===i.xfE&&(e.mapping=i.dSO,e.needsUpdate=!0);const t=e.textureObject||e;this.environment=t,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var t;let r;if(!e||"texture"===e.assetType||e.isColor||e.isVector4)r="texture"===(null===(t=e)||void 0===t?void 0:t.assetType)&&e.textureObject||e;else{if("string"!=typeof e&&"number"!=typeof e)return void console.error("Unknown Background type",e);r=new i.Ilk(e)}this.background=r,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return(null==e?void 0:e.sceneUpdate)?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var t,r,n;return!1===e.sceneUpdate?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),null===(n=null===(r=null===(t=this.boxHelper)||void 0===t?void 0:t.box)||void 0===r?void 0:r.copy)||void 0===n||n.call(r,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new i.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,t){const r=[];return(null!=t?t:this.modelObject).traverse(t=>{t.name===e&&r.push(t)}),r}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var r;const i=e.lightObject;i&&(null===(r=i.children)||void 0===r||r.length,t?this.add(i):this.modelRoot.add(i))}getBounds(e=!1,t=!0){return(new k).expandByObject(this.modelObject,e,t)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const t=this.getBounds(!1),r=e.cameraObject.getWorldPosition(new i.Pa4).sub(t.getCenter(new i.Pa4)),n=1.5*t.getSize(new i.Pa4).length()/2,s=r.length(),o=Math.max(this.minNearDistance,s-n),a=Math.max(o+1,s+n);e.near=o,e.far=a}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return ke(this,!0,e)}fromJSON(e,t){const r=e.environment;return void 0!==r&&(this.setEnvironment(De(r,this.getEnvironment(),!1,t)),delete e.environment),De(e,this,!0,t),e.environment=r,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}}function vt(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}function xt(e,t){const r=t||"/";return new RegExp(r+"{1,}","g"),e.join(r)}function At(e,t){const r=window.URL.createObjectURL(e),i=document.createElement("a");i.style.display="none",i.href=r,i.download=t,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(r)},1e3)}async function bt(e){return new Promise((t,r)=>{const i=new FileReader;i.onload=(e=>t(i.result)),i.onerror=(e=>r(i.error)),i.onabort=(e=>r(new Error("Read aborted"))),i.readAsDataURL(e)})}function yt(e,t){return At(e,null!=t?t:e.name)}async function wt(e=!1,t=!1,r){const i=document.createElement("input");i.type="file",i.multiple=e,i.accept=r||"*",i.webkitdirectory=t,i.style.display="none",document.body.appendChild(i),i.click();const n=await new Promise(e=>{i.onchange=(t=>{e(Array.from(i.files||[]))})});return document.body.removeChild(i),n}function Et({innerHTML:e="",id:t,classList:r,addToBody:i=!0,elementTag:n="div"}){const s=document.createElement(n);return t&&(s.id=t),s.innerHTML=e,r&&s.classList.add(...r),i&&document.body.appendChild(s),s}async function St(e){return new Promise((t,r)=>{const i=new Image;i.onload=(()=>t(i)),i.onerror=r,i.crossOrigin="anonymous",i.decoding="sync",i.src=e})}function Ct(e){const t=document.createElement("style");return t.type="text/css",t.innerText=e,document.head.appendChild(t),t}async function Mt(e){return new Promise((t,r)=>{const i=document.createElement("script");i.setAttribute("src",e),i.addEventListener("load",t),i.addEventListener("error",r),document.body.appendChild(i)})}function Tt(e,t=8192,r=!1){var i;if(!e.width||!e.height)return"";const n=document.createElement("canvas");n.width=Math.min(t,e.width),n.height=Math.floor(1+n.width*e.height/e.width);const s=e instanceof ImageBitmap,o=s&&r&&Math.abs(n.width-e.width)<.5?n.getContext("bitmaprenderer"):void 0;o?o.transferFromImageBitmap(e):null===(i=n.getContext("2d"))||void 0===i||i.drawImage(e,0,0,n.width,n.height);const a=n.toDataURL("image/png");return n.remove(),s&&r&&e.close(),a}async function It(e){return new Promise((t,r)=>{const i=new Image;i.addEventListener("load",()=>{const e=document.createElement("canvas");e.width=i.width,e.height=i.height;const n=e.getContext("2d");if(!n)return void r(new Error("Could not get 2d context"));n.drawImage(i,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height);t(s),e.remove(),i.remove()},!1),i.addEventListener("error",e=>{i.remove(),r(e)},!1),i.src=e})}function kt(){return("undefined"==typeof performance?Date:performance).now()}function Dt(){let e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e;var t}function Pt(e,t=null){var r;return null!==(r=new URL(window.location.href).searchParams.get(e))&&void 0!==r?r:t}function Bt(e,t,r=!1){const i=new URLSearchParams(location.search);null==t?i.has(e)&&i.delete(e):i.set(e,t),r?window.location.search=i.toString():window.history.replaceState({},"","?"+i.toString())}function Rt(e){if(!window)return console.warn("window is required"),"";let t="";const r=new Uint8Array(e),i=r.byteLength;for(let n=0;n<i;n++)t+=String.fromCharCode(r[n]);return window.btoa(t)}function Lt(e){if(!window)return console.warn("window is required"),new Uint8Array(0);const t=window.atob(e),r=t.length,i=new Uint8Array(r);for(let n=0;n<r;n++)i[n]=t.charCodeAt(n);return i.buffer}function Ot(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function Ft(e,{backgroundColor:t="",displayPixelRatio:r=1,width:i=512,height:n=512}){const s=document.createElement("canvas"),o=s.getContext("2d"),a=r,l=i,c=n;return s.width=l*a,s.height=c*a,s.style.width=`${l}`,s.style.height=`${c}`,(null==t?void 0:t.length)>0&&(o.fillStyle=t,o.fillRect(0,0,s.width,s.height)),o.drawImage(e,0,0,s.width,s.height),s}mt([Ce()],_t.prototype,"defaultCamera",void 0),mt([M(_t.prototype.refreshEnvMapIntensity),Ce()],_t.prototype,"envMapIntensity",void 0),mt([Ce()],_t.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){const r=new Uint8Array(this);null==t&&(t=r.length);const i=new ArrayBuffer(t-e),n=new Uint8Array(i);for(let s=0;s<n.length;s++)n[s]=r[s+e];return i});const Ut={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Nt(e,t){return new Ut[e](t)}class jt{static ApplyMaterialExtensions(e,t,r,i){for(const n of r)this.ApplyMaterialExtension(e,t,n,i)}static ApplyMaterialExtension(e,t,r,i){var n,s;let o=null!==(n=x(r.parsFragmentSnippet,i,e))&&void 0!==n?n:"";o.length&&(t.fragmentShader=t.fragmentShader.replace(this.FragVoidMain,`\n${o}\n${this.FragVoidMain}`)),(o=null!==(s=x(r.parsVertexSnippet,i,e))&&void 0!==s?s:"").length&&(t.vertexShader=t.vertexShader.replace(this.VertVoidMain,`\n${o}\n${this.VertVoidMain}`)),r.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,r.extraUniforms)),r.shaderExtender&&r.shaderExtender(t,e,i),e.lastShader=t}static CacheKeyForExtensions(e,t){let r="";for(const i of t)r+=this.CacheKeyForExtension(e,i);return r}static CacheKeyForExtension(e,t){let r="";return t.customCacheKey&&(r+=t.customCacheKey),t.computeCacheKey&&(r+=t.computeCacheKey(e)),r}static RegisterExtensions(e,t){const r=[];if(t)for(const i of t)i.isCompatible&&i.isCompatible(e)&&(r.push(i),i.uuid||(i.uuid=We()),i.__setDirty||(i.__setDirty=(()=>{i.updateVersion||(i.updateVersion=0),i.updateVersion++})),i.setDirty||(i.setDirty=i.__setDirty));return e.materialExtensions=r,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",t=>(function(e,{object:t,renderer:r}){var i;null===(i=e.materialExtensions)||void 0===i||i.forEach(i=>{var n,s;if(null===(n=i.onObjectRender)||void 0===n||n.call(i,t,e,r),i.extraDefines){let t=!1;Object.entries(i.extraDefines).forEach(([r,i])=>{void 0===i?void 0!==e.materialObject.defines[r]&&(delete e.materialObject.defines[r],t=!0):e.materialObject.defines[r]!==i&&(e.materialObject.defines[r]=i,t=!0)}),t&&(e.materialObject.needsUpdate=!0)}e.lastShader&&(null===(s=x(i.updaters))||void 0===s||s.forEach(t=>null==t?void 0:t.updateShaderProperties(e.lastShader))),i.updateVersion!==e.materialObject.userData["_"+i.uuid+"_version"]&&(e.materialObject.userData["_"+i.uuid+"_version"]=i.updateVersion,e.materialObject.needsUpdate=!0)})})(e,t))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",t=>(function(e,{object:t,renderer:r}){var i;null===(i=e.materialExtensions)||void 0===i||i.forEach(i=>{var n;null===(n=i.onAfterRender)||void 0===n||n.call(i,t,e,r)})})(e,t))),r}}jt.FragVoidMain="void main() {",jt.VertVoidMain="void main() {";class Gt extends i.jyz{constructor(e,t=!1){var r;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=jt.RegisterExtensions(this,null!==(r=null==e?void 0:e.customMaterialExtensions)&&void 0!==r?r:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...jt.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){jt.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+jt.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,r,i,n){super.onBeforeRender(e,t,r,i,n),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:r,geometry:i,object:n})}onAfterRender(e,t,r,i,n){super.onAfterRender(e,t,r,i,n),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:r,geometry:i,object:n})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class zt extends Gt{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class Vt extends zt{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(e=>e.id).join(";")!==e.join(";")&&(this.textures=e.map(e=>({id:e,encoding:i.rnI})),this.setDirty())}_setUniformTexSize(e,t){var r,i,n,s;if(!t||!e)return;const o=null!==(i=null===(r=t.image)||void 0===r?void 0:r.width)&&void 0!==i?i:512,a=null!==(s=null===(n=t.image)||void 0===n?void 0:n.height)&&void 0!==s?s:512,l=e.value;l.isVector2||console.warn("uniform is not a Vector2"),l&&Math.abs(l.x-o)+Math.abs(l.y-a)>.1&&(l.x=o,l.y=a,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,r,i,n){var s,o;this._setUniformTexSize(this.uniforms.screenSize,null===(s=e.getRenderTarget())||void 0===s?void 0:s.texture);for(const a of this.textures){const e=a.id,t=null===(o=this.uniforms[e])||void 0===o?void 0:o.value;t&&(this._setUniformTexSize(this.uniforms[e+"Size"],t),t.encoding!==a.encoding&&(a.encoding=t.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,t,r,i,n)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(e=>{var t,r;return`uniform sampler2D ${e.id}; \n`+N(null!==(t=e.id)&&void 0!==t?t:"input",null!==(r=e.encoding)&&void 0!==r?r:i.rnI)}).join("\n")+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}}function Qt(e,...t){const r=e.fragmentShader;return new Vt({defines:Object.assign({},e.defines),uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:r},t)}class Ht extends c{constructor(e,...t){super(e.isMaterial?e:Qt(e,...t),t.length<1?Ht.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,r,i;null===(t=null===(e=this.material)||void 0===e?void 0:e.dispose)||void 0===t||t.call(e),null===(i=null===(r=this.fsQuad)||void 0===r?void 0:r.dispose)||void 0===i||i.call(r),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(e=>null==e?void 0:e.updateShaderProperties(this.material)))}render(e,t,r,i,n){this.enabled&&super.render(e,t,r,i,n)}}Ht.DEFAULT_TEX_ID="tDiffuse",function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ye("Enabled"),Ce()],Ht.prototype,"enabled",void 0);class Wt extends s{constructor(e,t,r,n,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==s?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new i.Ilk}render(e,t,r,i,n,s){const o=e.autoClear;let a,l;if(e.autoClear=!1,void 0!==this.overrideMaterial&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),a=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),s){const t=e.getContext();t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,s)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),s){const t=e.getContext();t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,a),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=l),e.autoClear=o}}class qt extends Ht{constructor(e,t="c = a + b;",r="",i){super({vertexShader:n.vertexShader,fragmentShader:w`
                varying vec2 vUv;
                
                ${r}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:i},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class Xt extends i.jyz{constructor(e=!0){super({vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <uv_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nout vec3 vViewPosition;void main(){\n#include <uv_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition=-mvPosition.xyz;}",fragmentShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#include <packing>\nuniform float alphaTest;\n#endif\n#ifndef gl_FragColor \nlayout(location=0)out vec4 A;layout(location=1)out vec4 B;\n#endif\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <alphamap_pars_fragment>\nuniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){\n#ifdef USE_ALPHAMAP\n#ifdef ALPHA_I_RGBA_PACKING\nif(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)\n#else\nif(texture2D(alphaMap,vUv).g<alphaTest)\n#endif\ndiscard;\n#endif\n#include <normal_fragment_begin>\n#ifdef FORCED_LINEAR_DEPTH\nfloat linearZ=float(FORCED_LINEAR_DEPTH);\n#else\nfloat linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);\n#endif\nvec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);\n#ifndef gl_FragColor \nA=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;\n#else\ngl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);\n#endif\n}",uniforms:{cameraNearFar:{value:new i.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new i.Ltg(1,1,1,1)}},glslVersion:e?i.LSk:i.v9Y}),this._updaters=[]}onBeforeRender(e,t,r,n,s){var o,a,l;let c=s.material;Array.isArray(c)&&(c=c[0]),this.uniforms.alphaMap.value=null!==(o=null==c?void 0:c.alphaMap)&&void 0!==o?o:null,this.uniforms.alphaTest.value=!c||!c.alphaTest||c.alphaTest<1e-7?.001:c.alphaTest,this.uniforms.flags.value.z=((null==c?void 0:c.userData.matId)?null==c?void 0:c.userData.matId:0)/255,this._updaters.forEach(e=>{e(s,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let u=this.uniforms.alphaMap.value?1:void 0;u!==this.defines.USE_ALPHAMAP&&(void 0===u?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=u,this.needsUpdate=!0),(u=c.userData.ALPHA_I_RGBA_PACKING?1:void 0)!==this.defines.ALPHA_I_RGBA_PACKING&&(void 0===u?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=u,this.needsUpdate=!0),(u=null!==(a=c.userData.forcedLinearDepth)&&void 0!==a?a:void 0)!==this.defines.FORCED_LINEAR_DEPTH&&(void 0===u?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=u,this.needsUpdate=!0),this.side=null!==(l=c.side)&&void 0!==l?l:i.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){}}var Yt="#ifndef UNPACK_GBUFFER_SNIPPET\n#define UNPACK_GBUFFER_SNIPPET \nuniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}\n#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1\nuniform sampler2D tGBufferFlags;\n#endif\nvec4 getGBufferFlags(const in vec2 uv){\n#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1\nreturn texture2D(tGBufferFlags,uv);\n#else\nreturn vec4(1.);\n#endif\n}\n#endif\n";const Kt={name:"",fog:!0,blending:i.bdR,side:i.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:i.k74,blendDst:i.LgZ,blendEquation:i.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:i.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:i.cum,stencilRef:0,stencilFuncMask:255,stencilFail:i.x5V,stencilZFail:i.x5V,stencilZPass:i.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function Jt(e,t,r,{replaceAll:i=!1,prepend:n=!1,append:s=!1}={}){if(!e.includes(t))return console.error(`${t} not found in shader`),e;let o=r;return n?o=r+t:s&&(o=t+r),i?e.replaceAll(t,o):e.replace(t,o)}const Zt={...Kt,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:i.IOt,normalScale:new i.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new xe(0),specularColorMap:null},$t={...Zt,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new i.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new xe(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new xe(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new xe(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class er extends i.EJi{constructor(e){var t;super(e),this.typeSlug=er.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=(e=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)}),this.fog=!1,this.materialExtensions=jt.RegisterExtensions(this,null!==(t=null==e?void 0:e.customMaterialExtensions)&&void 0!==t?t:[])}setDirty(e){var t,r;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),null===(r=null===(t=this._uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===r||r.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...jt.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ae(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Ae(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Ae(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Ae(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",i.IOt],["ObjectSpace",i.PA7]].map(e=>({label:e[0],value:e[1]}))},Ae(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Ae(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Ae(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Ae(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Ae(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Ae(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Ae(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Ae(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Ae(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Ae(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",i.BVF],["Always",i.Se2],["Less",i.Zr5],["LessEqual",i.vCF],["Equal",i.eD],["GreaterEqual",i.ksN],["Greater",i.w$m],["NotEqual",i.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",re],["Normal",ie],["Additive",i.WMw],["Subtractive",ne],["Multiply",se]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Ae(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>!0===this.userData.renderToDepth,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>!0===this.userData.inverseAlphaMap,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ae(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ae(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",i.Wl3],["Back",i._Li],["Double",i.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,t,r;return null!==(r=null===(t=null===(e=this.userData)||void 0===e?void 0:e.__appliedMeshes)||void 0===t?void 0:t.size)&&void 0!==r?r:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{At(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return null===(t=e.getUiConfig)||void 0===t?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const r=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const n of i)e.vertexShader=Jt(e.vertexShader,n[0],"#glMarker "+n[1]+"\n"+n[0]);for(const n of r)e.fragmentShader=Jt(e.fragmentShader,n[0],"#glMarker "+n[1]+"\n"+n[0]);jt.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+jt.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,r,i,n){super.onBeforeRender(e,t,r,i,n),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:r,geometry:i,object:n});const s=this.userData.inverseAlphaMap?1:0;s!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=s,this.needsUpdate=!0)}copyProps(e,t=!1){if(!t&&!["MeshStandardMaterial",er.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const r={};A(e,r,Array.from(Object.keys($t)));const i=r.userData;delete r.userData;for(const n of Object.keys(r))void 0===r[n]&&delete r[n];return this.setValues(r),i&&ye(this.userData,i),this.setDirty(),this}toJSON(e){var t,r;const i=this.userData;this.userData={};const n=super.toJSON(e);this.userData=i,n.userData={},ye(n.userData,i),n.userData.uuid=this.userData.uuid;const s=e||{textures:Object.fromEntries((null===(t=n.textures)||void 0===t?void 0:t.map(e=>[e.uuid,e]))||[]),images:Object.fromEntries((null===(r=n.images)||void 0===r?void 0:r.map(e=>[e.uuid,e]))||[])};n.userData=ke(n.userData,!1,s),e||(Object.keys(s.textures).length>0&&(n.textures=Object.values(s.textures)),Object.keys(s.images).length>0&&(n.images=Object.values(s.images))),n.type=er.TYPE;for(const o of Object.keys(n))void 0===n[o]&&delete n[o];return n}fromJSON(e,t,r=!1){return Array.isArray(e.normalScale)&&(e.normalScale=(new i.FM8).fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=(new i.FM8).fromArray(e.clearcoatNormalScale)),this.copyProps(e,r)}clone(){return super.clone()}}er.TypeSlug="pmat",er.TYPE="MeshStandardMaterial2";const tr={...Kt,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:i.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class rr extends i.vBJ{constructor(e){var t;super(e),this.typeSlug=rr.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=(e=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)}),this.materialExtensions=jt.RegisterExtensions(this,null!==(t=null==e?void 0:e.customMaterialExtensions)&&void 0!==t?t:[])}setDirty(e){var t,r;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),null===(r=null===(t=this._uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===r||r.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...jt.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ae(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",re],["Normal",ie],["Additive",i.WMw],["Subtractive",ne],["Multiply",se]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Ae(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>!0===this.userData.renderToDepth,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ae(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ae(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",i.Wl3],["Back",i._Li],["Double",i.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t,r;return null!==(r=null===(t=null===(e=this.userData)||void 0===e?void 0:e.__appliedMeshes)||void 0===t?void 0:t.size)&&void 0!==r?r:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{At(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return null===(t=e.getUiConfig)||void 0===t?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const r=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const n of i)e.vertexShader=Jt(e.vertexShader,n[0],"#glMarker "+n[1]+"\n"+n[0]);for(const n of r)e.fragmentShader=Jt(e.fragmentShader,n[0],"#glMarker "+n[1]+"\n"+n[0]);jt.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+jt.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,r,i,n){super.onBeforeRender(e,t,r,i,n),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:r,geometry:i,object:n})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",rr.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const r={};A(e,r,Array.from(Object.keys(tr)));const i=r.userData;delete r.userData;for(const n of Object.keys(r))void 0===r[n]&&delete r[n];return this.setValues(r),i&&ye(this.userData,i),this.setDirty(),this}toJSON(e){var t,r;const i=this.userData;this.userData={};const n=super.toJSON(e);this.userData=i,n.userData={},ye(n.userData,i),n.userData.uuid=this.userData.uuid;const s=e||{textures:Object.fromEntries((null===(t=n.textures)||void 0===t?void 0:t.map(e=>[e.uuid,e]))||[]),images:Object.fromEntries((null===(r=n.images)||void 0===r?void 0:r.map(e=>[e.uuid,e]))||[])};n.userData=ke(n.userData,!1,s),e||(Object.keys(s.textures).length>0&&(n.textures=Object.values(s.textures)),Object.keys(s.images).length>0&&(n.images=Object.values(s.images))),n.type=rr.TYPE;for(const o of Object.keys(n))void 0===n[o]&&delete n[o];return n}fromJSON(e,t,r=!1){return this.copyProps(e,r)}clone(){return super.clone()}}rr.TypeSlug="bmat",rr.TYPE="MeshBasicMaterial2";const ir={materialType:er.TYPE,name:"standard",color:"#ffffff"},nr={materialType:rr.TYPE,name:"basic",color:"#ffffff"},sr={[er.TYPE]:ir.name,MeshStandardMaterial:ir.name,MeshPhysicalMaterial:ir.name,[rr.TYPE]:nr.name,MeshBasicMaterial:nr.name};class or extends r{constructor(){super(),this._templates=[ir,nr],this._materials=[],this._disposeMaterial=(e=>{const t=e.target;if(!t||"material"!==t.assetType)return;this._refreshTextureRefs();const r=this._getMapsForMaterial(t),i=[];r.forEach(e=>{const r=e.userData.__appliedMaterials;null==r||r.delete(t),r&&!1!==e.userData.disposeOnIdle&&0===r.size&&i.push(e)}),i.forEach(e=>{e.dispose()}),this.unregisterMaterial(t)}),this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let r=this.findMaterial(e);return r||(r=this.generateFromTemplate(e,t)),r}generateFromTemplate(e,t){const r=this.findTemplate(e);if(r)return this._generateFromTemplate(r,null!=t?t:{})}generateFromTemplateType(e,t){const r=this._templates.find(t=>t.materialType===e);if(r)return this._generateFromTemplate(r,null!=t?t:{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(t=>{let r=t.userData.__appliedMaterials;r||(t.userData.__appliedMaterials=r=new Set),r.add(e)})})}_getMapsForMaterial(e){var t;const r=new Set;for(const i of Object.values(e))i&&i.isTexture&&r.add(i);for(const i of Object.values(null!==(t=e.userData)&&void 0!==t?t:{}))i&&i.isTexture&&r.add(i);return r}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=We());const t=this._templates.find(t=>t.templateUUID===e.templateUUID);t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(t=>t.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){return m(e,"modelObject",this._processModel(e,t)),e}_processMaterial(e,t){var r,i,n;if(!e)return;if(null===(r=e.materialObject)||void 0===r?void 0:r.isMaterial)return e;let s=e.mmMaterial;if(!s){const r=(null===(i=e.userData)||void 0===i?void 0:i.uuid)||e.uuid;if(s=this.findMaterial(r))s.copyProps(e);else{const r=!1===t.useSourceMaterial||!e.isMaterial,i=null!==(n=t.materialTemplate)&&void 0!==n?n:r?"standard":sr[e.type]||"standard";s=this.generateFromTemplate(i,r?{}:e)}e.mmMaterial=s}return s}processMaterial(e,t){return!1!==t.register&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,r=!0,i=!1){const n=ke(e,!1),s=JSON.stringify(n,null,r?0:2),o=(t||e.name||"physical_material")+"."+e.typeSlug,a=new File([s],o,{type:"application/json"});return i&&yt(a),a}}class ar extends or{_generateFromTemplate(e,t){var r,i,n,s,o,a;let l;const c={...e};c.customMaterialExtensions=[...null!==(r=c.customMaterialExtensions)&&void 0!==r?r:[],...this._materialExtensions];let u={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&A(t,c,Array.from(Object.keys($t))),"MeshBasicMaterial"===(null==t?void 0:t.type)&&(c.roughness=.9,c.metalness=0,(null===(i=c.userData)||void 0===i?void 0:i.uuid)&&delete c.userData.uuid),(u=null===(n=c.userData)||void 0===n?void 0:n.uuid)&&delete c.userData.uuid,l=new er({customMaterialExtensions:c.customMaterialExtensions}).fromJSON(c,void 0,!0),u&&(l.uuid=u),l.userData.uuid=l.uuid,l.setDirty(),(null==t?void 0:t.isMaterial)&&void 0!==t.userData&&(t.userData.iMaterial=l);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&A(t,c,Array.from(Object.keys(tr))),(u=null===(s=c.userData)||void 0===s?void 0:s.uuid)&&delete c.userData.uuid,l=new rr({customMaterialExtensions:c.customMaterialExtensions}).fromJSON(c,void 0,!0),u&&(l.uuid=u),l.userData.uuid=l.uuid,l.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:u=null,t&&t.userData&&(u=t.userData,delete t.userData),l=(null===(o=e.generator)||void 0===o?void 0:o.call(e,c,t))||void 0,t&&u&&(t.userData=u),u&&l&&(ye(l.userData,u),(null==u?void 0:u.uuid)&&(l.uuid=u.uuid),u=null),l&&(l.userData.uuid=l.uuid)}if(l){t.runtimeMaterial&&(l.userData.__runtimeMaterial=!0);const r=l;if(l.clone=(()=>{r.userData.cloneId||(r.userData.cloneId="0",r.userData.cloneCount=0),r.userData.cloneCount+=1;const t=this.generateFromTemplate(e.name);return t&&(t.copyProps(r),t.userData.cloneId=t.userData.cloneId+"_"+r.userData.cloneCount,t.userData.cloneCount=0,t.name=t.name+"_"+t.userData.cloneId),null==t?void 0:t.materialObject}),t){let e=this.findMaterial(null==t?void 0:t.uuid);e&&this.unregisterMaterial(e),(e=this.findMaterial(null===(a=null==t?void 0:t.materialObject)||void 0===a?void 0:a.uuid))&&this.unregisterMaterial(e)}return this.registerMaterialObject(r)}}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let r=e.material;if(!r&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),r=this._defaultMaterial,e.material=r),r){let i=!0;Array.isArray(r)||(r=[r],i=!1);const n=[];for(const e of r){const r=this._processMaterial(e,t);n.push(null==r?void 0:r.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(i?n:n[0]))}if(!1!==t.recursive)for(let i=0;i<e.modelObject.children.length;i++)e.modelObject.children[i]=this._processModel(e.modelObject.children[i],t);return e}}class lr{constructor(e,t,r,i){this.cls=e,this.ext=t,this.root=r,this.onCtor=i}ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return"function"==typeof this.onCtor?this.onCtor(t,e):t}}function cr(e){var t;if(!e||""===e||e.match(/__MACOSX\/.*\._/))return"";const r=null!==(t=(e=e.replace(/\?.*$/,"")).split(/[\\/]/).pop())&&void 0!==t?t:"",i=r.lastIndexOf(".");return""===r||i<1?"":r.slice(i+1)}function ur(e){return e.substring(e.lastIndexOf("/")+1)}class pr{constructor(e,{pseudoCenter:t=!1,autoCenter:r=!1,autoScale:n=!1,autoScaleRadius:s=2,license:o=""}={}){if(this.assetType="model",this._modelObject=Le(new i.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!r||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||r||(e.userData.isCentered=!0):q(e),this._modelObject=e;else{r&&console.error("cannot use pseudoCenter and autoCenter at the same time");const t=(new k).expandByObject(e,!0,!0).getCenter(new i.Pa4);this._modelObject.position.copy(t).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}n&&!this._modelObject.userData.autoScaled?X(this._modelObject,e.userData.autoScaleRadius||s):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=o}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&"function"==typeof e?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,r,i,n;null===(r=null===(t=this._modelObject)||void 0===t?void 0:t.setDirty)||void 0===r||r.call(t,e),null===(n=null===(i=this._uiConfig)||void 0===i?void 0:i.uiRefresh)||void 0===n||n.call(i,"postFrame",!0)}setMaterial(e){var t,r;return this._modelObject.isMesh?(null===(r=(t=this._modelObject).setMaterial)||void 0===r?void 0:r.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var r,i;if(this._modelObject.isMesh)return null===(i=(r=this._modelObject).setGeometry)||void 0===i?void 0:i.call(r,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Re(this._modelObject,!1)),this._uiConfig}clone(){return new pr(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function hr(e,t){return[e.modelObject,...e.modelObject.children].forEach(r=>{Le(r,r!==e.modelObject?e:void 0,t)}),e}class dr{constructor(){this._processors=new Map}add(e,t){var r;this._processors.has(e)||this._processors.set(e,[]),null===(r=this._processors.get(e))||void 0===r||r.push(t)}remove(e,t){const r=this._processors.get(e),i=(null==r?void 0:r.indexOf(t))||(null==r?void 0:r.findIndex(e=>e.process&&e.process===t.process||e.processAsync&&e.processAsync===t.processAsync));!r||!i||i<0||r.splice(i,1)}get(e){var t;return null!==(t=this._processors.get(e))&&void 0!==t?t:[]}async process(e,t,r){var i,n,s,o;const a=this.get(e),l=t.assetType;for(const c of a)c.forAssetType===l&&(t=null!==(n=null===(i=c.process)||void 0===i?void 0:i.call(c,t,r))&&void 0!==n?n:t,t=null!==(o=await(null===(s=c.processAsync)||void 0===s?void 0:s.call(c,t,r)))&&void 0!==o?o:t);return t}dispose(){this._processors.clear()}}class fr extends i.hH6{load(e,t,r,i){return super.load(e,e=>{try{if("string"!=typeof e)throw new Error("Invalid JSON");null==t||t(JSON.parse(e))}catch(e){null==i||i(e)}},r,i)}}class gr extends i.yxD{constructor(e){super(e),this.type=i.cLu}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;let i=e.pos,n=-1,s=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(n=a.indexOf("\n"))&&s<t&&i<e.byteLength;)o+=a,s+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<n&&(!1!==r&&(e.pos+=s+n+1),o+a.slice(0,n))},n=function(e,t,r,i){const n=e[t+3],s=Math.pow(2,n-128)/255;r[i+0]=e[t+0]*s,r[i+1]=e[t+1]*s,r[i+2]=e[t+2]*s,r[i+3]=1},s=function(e,t,r,n){const s=e[t+3],o=Math.pow(2,s-128)/255;r[n+0]=i.A5E.toHalfFloat(Math.min(e[t+0]*o,65504)),r[n+1]=i.A5E.toHalfFloat(Math.min(e[t+1]*o,65504)),r[n+2]=i.A5E.toHalfFloat(Math.min(e[t+2]*o,65504)),r[n+3]=i.A5E.toHalfFloat(1)},o=new Uint8Array(e);o.pos=0;const a=function(e){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=r(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(a.valid|=1,a.programtype=c[1],a.string+=l+"\n";!1!==(l=r(e));)if(a.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(i))&&(a.gamma=parseFloat(c[1])),(c=l.match(n))&&(a.exposure=parseFloat(c[1])),(c=l.match(s))&&(a.valid|=2,a.format=c[1]),(c=l.match(o))&&(a.valid|=4,a.height=parseInt(c[1],10),a.width=parseInt(c[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=l+"\n";return 2&a.valid?4&a.valid?a:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==a){const e=a.width,r=a.height,l=function(e,r,i){const n=r;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(n!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const s=new Uint8Array(4*r*i);if(!s.length)return t(4,"unable to allocate buffer space");let o=0,a=0;const l=4*n,c=new Uint8Array(4),u=new Uint8Array(l);let p=i;for(;p>0&&a<e.byteLength;){if(a+4>e.byteLength)return t(1);if(c[0]=e[a++],c[1]=e[a++],c[2]=e[a++],c[3]=e[a++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=n)return t(3,"bad rgbe scanline format");let r,i=0;for(;i<l&&a<e.byteLength;){const n=(r=e[a++])>128;if(n&&(r-=128),0===r||i+r>l)return t(3,"bad scanline data");if(n){const t=e[a++];for(let e=0;e<r;e++)u[i++]=t}else u.set(e.subarray(a,a+r),i),i+=r,a+=r}const h=n;for(let e=0;e<h;e++){let t=0;s[o]=u[e+t],t+=n,s[o+1]=u[e+t],t+=n,s[o+2]=u[e+t],t+=n,s[o+3]=u[e+t],o+=4}p--}return s}(o.subarray(o.pos),e,r);if(-1!==l){let t,o,c;switch(this.type){case i.VzW:c=l.length/4;const e=new Float32Array(4*c);for(let t=0;t<c;t++)n(l,4*t,e,4*t);t=e,o=i.VzW;break;case i.cLu:c=l.length/4;const r=new Uint16Array(4*c);for(let t=0;t<c;t++)s(l,4*t,r,4*t);t=r,o=i.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:r,data:t,header:a.string,gamma:a.gamma,exposure:a.exposure,type:o}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){switch(e.type){case i.VzW:case i.cLu:e.encoding=i.rnI,e.minFilter=i.wem,e.magFilter=i.wem,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}}function mr(e){to.Importers.push(new lr(class extends gr{constructor(t){super(t),this.setDataType(ro(e))}},["hdr"],!1))}class _r extends i.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new wr(e)}),this.register(function(e){return new kr(e)}),this.register(function(e){return new Dr(e)}),this.register(function(e){return new Sr(e)}),this.register(function(e){return new Cr(e)}),this.register(function(e){return new Mr(e)}),this.register(function(e){return new Tr(e)}),this.register(function(e){return new yr(e)}),this.register(function(e){return new Ir(e)}),this.register(function(e){return new Er(e)}),this.register(function(e){return new Ar(e)}),this.register(function(e){return new Pr(e)})}load(e,t,r,n){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:i.Zp0.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){n?n(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},l=new i.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(r){try{s.parse(r,o,function(r){t(r),s.manager.itemEnd(e)},a)}catch(e){a(e)}},r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let s;const o={},a={};if("string"==typeof e)s=e;else if(i.Zp0.decodeText(new Uint8Array(e,0,4))===Br){try{o[xr.KHR_BINARY_GLTF]=new Rr(e)}catch(e){return void(n&&n(e))}s=o[xr.KHR_BINARY_GLTF].content}else s=i.Zp0.decodeText(new Uint8Array(e));const l=JSON.parse(s);if(void 0===l.asset||l.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new ri(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let i=0;i<this.pluginCallbacks.length;i++){const e=this.pluginCallbacks[i](c);a[e.name]=e,o[e.name]=!0}if(l.extensionsUsed)for(let i=0;i<l.extensionsUsed.length;++i){const e=l.extensionsUsed[i],t=l.extensionsRequired||[];switch(e){case xr.KHR_MATERIALS_UNLIT:o[e]=new br;break;case xr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[e]=new Ur;break;case xr.KHR_DRACO_MESH_COMPRESSION:o[e]=new Lr(l,this.dracoLoader);break;case xr.KHR_TEXTURE_TRANSFORM:o[e]=new Or;break;case xr.KHR_MESH_QUANTIZATION:o[e]=new Nr;break;default:t.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(r,n)}parseAsync(e,t){const r=this;return new Promise(function(i,n){r.parse(e,t,i,n)})}}function vr(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const xr={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Ar{constructor(e){this.parser=e,this.name=xr.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){const i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let n=t.cache.get(r);if(n)return n;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const l=new i.Ilk(16777215);void 0!==o.color&&l.fromArray(o.color);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":(a=new i.Ox3(l)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new i.cek(l)).distance=c;break;case"spot":(a=new i.PMe(l)).distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),n=Promise.resolve(a),t.cache.add(r,n),n}createNodeAttachment(e){const t=this,r=this.parser,i=r.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return r._getNodeRef(t.cache,n,e)})}}class br{constructor(){this.name=xr.KHR_MATERIALS_UNLIT}getMaterialType(){return i.vBJ}extendParams(e,t,r){const n=[];e.color=new i.Ilk(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==s.baseColorTexture&&n.push(r.assignTexture(e,"map",s.baseColorTexture,i.knz))}return Promise.all(n)}}class yr{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class wr{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.FM8(e,e)}return Promise.all(s)}}class Er{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&n.push(r.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&n.push(r.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(n)}}class Sr{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new i.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(r.assignTexture(t,"sheenColorMap",o.sheenColorTexture,i.knz)),void 0!==o.sheenRoughnessTexture&&s.push(r.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),n.extras&&void 0!==n.extras.sheenFactor&&(t.sheen=n.extras.sheenFactor,delete n.extras.sheenFactor),Promise.all(s)}}class Cr{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&n.push(r.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(n)}}class Mr{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(r.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new i.Ilk(a[0],a[1],a[2]),Promise.all(s)}}class Tr{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Ir{constructor(e){this.parser=e,this.name=xr.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(r.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new i.Ilk(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(r.assignTexture(t,"specularColorMap",o.specularColorTexture,i.knz)),Promise.all(s)}}class kr{constructor(e){this.parser=e,this.name=xr.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const n=i.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,s)}}class Dr{constructor(e){this.parser=e,this.name=xr.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const s=n.extensions[t],o=i.images[s.source];let a=r.textureLoader;if(o.uri){const e=r.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,s.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Pr{constructor(e){this.name=xr.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const r=e.byteOffset||0,i=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,r,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){const t=new ArrayBuffer(s*o);return n.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t})})}return null}}const Br="glTF";class Rr{constructor(e){this.name=xr.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:i.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Br)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,n=new DataView(e,12);let s=0;for(;s<r;){const t=n.getUint32(s,!0);s+=4;const r=n.getUint32(s,!0);if(s+=4,1313821514===r){const r=new Uint8Array(e,12+s,t);this.content=i.Zp0.decodeText(r)}else if(5130562===r){const r=12+s;this.body=e.slice(r,r+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Lr{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=xr.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const c in s){const e=qr[c]||c.toLowerCase();o[e]=s[c]}for(const c in e.attributes){const t=qr[c]||c.toLowerCase();if(void 0!==s[c]){const i=r.accessors[e.attributes[c]],n=Vr[i.componentType];l[t]=n.name,a[t]=!0===i.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const r=e.attributes[t],i=a[t];void 0!==i&&(r.normalized=i)}t(e)},o,l)})})}}class Or{constructor(){this.name=xr.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Fr extends i.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new i.Ilk).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Ur{constructor(){this.name=xr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Fr}extendParams(e,t,r){const n=t.extensions[this.name];e.color=new i.Ilk(1,1,1),e.opacity=1;const s=[];if(Array.isArray(n.diffuseFactor)){const t=n.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==n.diffuseTexture&&s.push(r.assignTexture(e,"map",n.diffuseTexture,i.knz)),e.emissive=new i.Ilk(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new i.Ilk(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){const t=n.specularGlossinessTexture;s.push(r.assignTexture(e,"glossinessMap",t)),s.push(r.assignTexture(e,"specularMap",t,i.knz))}return Promise.all(s)}createMaterial(e){const t=new Fr(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=i.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class Nr{constructor(){this.name=xr.KHR_MESH_QUANTIZATION}}class jr extends i._C8{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let s=0;s!==i;s++)t[s]=r[n+s];return t}interpolate_(e,t,r,i){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=i-t,u=(r-t)/c,p=u*u,h=p*u,d=e*l,f=d-l,g=-2*h+3*p,m=h-p,_=1-g,v=m-p+u;for(let x=0;x!==o;x++){const e=s[f+x+o],t=s[f+x+a]*c,r=s[d+x+o],i=s[d+x]*c;n[x]=_*e+v*t+g*r+m*i}return n}}const Gr=new i._fP;class zr extends jr{interpolate_(e,t,r,i){const n=super.interpolate_(e,t,r,i);return Gr.fromArray(n).normalize().toArray(n),n}}const Vr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qr={9728:i.TyD,9729:i.wem,9984:i.YLQ,9985:i.qyh,9986:i.aH4,9987:i.D1R},Hr={33071:i.uWy,33648:i.OoA,10497:i.rpg},Wr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Xr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Yr={CUBICSPLINE:void 0,LINEAR:i.NMF,STEP:i.Syv};function Kr(e,t,r){for(const i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function Jr(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Zr(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,i=r.length;t<i;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function $r(e){const t=e.extensions&&e.extensions[xr.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+ei(t.attributes):e.indices+":"+ei(e.attributes)+":"+e.mode}function ei(e){let t="";const r=Object.keys(e).sort();for(let i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function ti(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ri{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new vr,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||r||n&&s<98?this.textureLoader=new i.dpR(this.options.manager):this.textureLoader=new i.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,i=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){const s={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:r,userData:{}};Kr(n,s,i),Jr(s,i),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(s)})).then(function(){e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i].joints;for(let t=0,i=r.length;t<i;t++)e[r[t]].isBone=!0}for(let i=0,n=e.length;i<n;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(r[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const i=r.clone(),n=(e,t)=>{const r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(const[i,s]of e.children.entries())n(s,t.children[i])};return n(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const i=e(t[r]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let i=0;i<t.length;i++){const n=e(t[i]);n&&r.push(n)}return r}getDependency(e,t){const r=e+":"+t;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[xr.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(e,s){r.load(i.Zp0.resolveURL(t.uri,n.path),e,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})}loadAccessor(e){const t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);const s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(e){const s=e[0],o=Wr[n.type],a=Vr[n.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,u=n.byteOffset||0,p=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,h=!0===n.normalized;let d,f;if(p&&p!==c){const e=Math.floor(u/p),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let c=t.cache.get(r);c||(d=new a(s,e*p,n.count*p/l),c=new i.vpT(d,p/l),t.cache.add(r,c)),f=new i.kB5(c,o,u%p/l,h)}else d=null===s?new a(n.count*o):new a(s,u,n.count*o),f=new i.TlE(d,o,h);if(void 0!==n.sparse){const t=Wr.SCALAR,r=Vr[n.sparse.indices.componentType],l=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0,u=new r(e[1],l,n.sparse.count*t),p=new a(e[2],c,n.sparse.count*o);null!==s&&(f=new i.TlE(f.array.slice(),f.itemSize,f.normalized));for(let e=0,i=u.length;e<i;e++){const t=u[e];if(f.setX(t,p[e*o]),o>=2&&f.setY(t,p[e*o+1]),o>=3&&f.setZ(t,p[e*o+2]),o>=4&&f.setW(t,p[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})}loadTexture(e){const t=this.json,r=this.options,i=t.textures[e].source,n=t.images[i];let s=this.textureLoader;if(n.uri){const e=r.manager.getHandler(n.uri);null!==e&&(s=e)}return this.loadTextureImage(e,i,s)}loadTextureImage(e,t,r){const n=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then(function(t){o.name&&(t.name=o.name);const r=(s.samplers||{})[o.sampler]||{};return t.magFilter=Qr[r.magFilter]||i.wem,t.minFilter=Qr[r.minFilter]||i.D1R,t.wrapS=Hr[r.wrapS]||i.rpg,t.wrapT=Hr[r.wrapT]||i.rpg,r.extras&&void 0!==r.extras.uuid&&(t.uuid=r.extras.uuid),n.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this,n=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const o=n.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1,u=null;if(void 0!==o.bufferView)l=r.getDependency("bufferView",o.bufferView).then(function(e){c=!0;const t=new Blob([e],{type:o.mimeType});return l=a.createObjectURL(t),u=t,l});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const p=Promise.resolve(l).then(function(e){return new Promise(function(n,o){let a=n;!0===t.isImageBitmapLoader&&(a=function(e){const t=new i.xEZ(e);t.needsUpdate=!0,n(t)}),t.load(i.Zp0.resolveURL(e,s.path),a,void 0,function(l){!0===t.isImageBitmapLoader?(t=new i.dpR(r.options.manager),a=n,t.setCrossOrigin(r.options.crossOrigin),t.setRequestHeader(r.options.requestHeader),t.load(i.Zp0.resolveURL(e,s.path),a,void 0,o)):o(l)})})}).then(function(e){var r;if(!0===c&&a.revokeObjectURL(l),e.userData.mimeType=o.mimeType||((r=o.uri).search(/\.jpe?g($|\?)/i)>0||0===r.search(/^data\:image\/jpeg/)?"image/jpeg":r.search(/\.webp($|\?)/i)>0||0===r.search(/^data\:image\/webp/)?"image/webp":"image/png"),e.flipY=!1,o.extras){if(void 0!==o.extras.flipY){if(!0===t.isImageBitmapLoader&&void 0!==typeof createImageBitmap){const t=e,r=o.extras.flipY&&!t.flipY;createImageBitmap(t.source.data,{imageOrientation:r?"flipY":"none"}).then(function(e){t.source.data.close&&t.source.data.close(),t.source.data=e,t.source.needsUpdate=!0,t.needsUpdate=!0})}e.flipY=o.extras.flipY,e.needsUpdate=!0,delete o.extras.flipY}void 0!==o.extras.uuid&&(e.source.uuid=o.extras.uuid),void 0!==o.extras.t_uuid&&(e.uuid=o.extras.t_uuid)}return o.uri&&"string"==typeof o.uri&&(e.userData.rootPath=o.uri),u&&(e.userData.__sourceBlob=u),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),e});return this.sourceCache[e]=p,p}assignTexture(e,t,r,i){const n=this;return this.getDependency("texture",r.index).then(function(s){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),n.extensions[xr.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[xr.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(s);s=n.extensions[xr.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),n.associations.set(s,t)}}return void 0!==i&&(s.encoding=i),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const n=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new i.UY4,i.F5T.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new i.nls,i.F5T.prototype.copy.call(t,r),t.color.copy(r.color),this.cache.add(e,t)),r=t}if(n||s||o){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),n&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return i.Wid}loadMaterial(e){const t=this,r=this.json,n=this.extensions,s=r.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[xr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=n[xr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=e.getMaterialType(),c.push(e.extendParams(a,s,t))}else if(l[xr.KHR_MATERIALS_UNLIT]){const e=n[xr.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),c.push(e.extendParams(a,s,t))}else{const r=s.pbrMetallicRoughness||{};if(a.color=new i.Ilk(1,1,1),a.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==r.baseColorTexture&&c.push(t.assignTexture(a,"map",r.baseColorTexture,i.knz)),a.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,a.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(c.push(t.assignTexture(a,"metalnessMap",r.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",r.metallicRoughnessTexture))),o=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=i.ehD);const u=s.alphaMode||"OPAQUE";if("BLEND"===u?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===u&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==i.vBJ&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new i.FM8(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&o!==i.vBJ&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==i.vBJ&&(a.emissive=(new i.Ilk).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==i.vBJ&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,i.knz)),Promise.all(c).then(function(){let r;return r=o===Fr?n[xr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new o(a),s.name&&(r.name=s.name),Jr(r,s),t.associations.set(r,{materials:e}),s.extensions&&Kr(n,r,s),r})}createUniqueName(e){const t=i.iUV.sanitizeNodeName(e||"");let r=t;for(let i=1;this.nodeNamesUsed[r];++i)r=t+"_"+i;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const t=this,r=this.extensions,n=this.primitiveCache;function s(e){return r[xr.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return ni(r,e,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const r=e[a],l=$r(r),c=n[l];if(c)o.push(c.promise);else{let e;e=r.extensions&&r.extensions[xr.KHR_DRACO_MESH_COMPRESSION]?s(r):ni(new i.u9r,r,t),n[l]={primitive:r,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.json,n=this.extensions,s=r.meshes[e],o=s.primitives,a=[];for(let c=0,u=o.length;c<u;c++){const e=void 0===o[c].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new i.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.Wl3})),l.DefaultMaterial):this.getDependency("material",o[c].material);a.push(e)}var l;return a.push(t.loadGeometries(o)),Promise.all(a).then(function(r){const a=r.slice(0,r.length-1),l=r[r.length-1],c=[];for(let p=0,h=l.length;p<h;p++){const r=l[p],u=o[p];let h;const d=a[p];if(4===u.mode||5===u.mode||6===u.mode||void 0===u.mode)!0!==(h=!0===s.isSkinnedMesh?new i.TUv(r,d):new i.Kj0(r,d)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),5===u.mode?h.geometry=si(h.geometry,i.UlW):6===u.mode&&(h.geometry=si(h.geometry,i.z$h));else if(1===u.mode)h=new i.ejS(r,d);else if(3===u.mode)h=new i.x12(r,d);else if(2===u.mode)h=new i.blk(r,d);else{if(0!==u.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new i.woe(r,d)}Object.keys(h.geometry.morphAttributes).length>0&&Zr(h,s),h.name=t.createUniqueName(s.name||"mesh_"+e),Jr(h,s),u.extensions&&Kr(n,h,u),t.assignFinalMaterial(h),c.push(h)}s.extensions&&c.forEach(e=>Kr(n,e,s));for(let i=0,n=c.length;i<n;i++)t.associations.set(c[i],{meshes:e,primitives:i});if(1===c.length)return c[0];const u=new i.ZAu;t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u})}loadCamera(e){let t;const r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new i.cPb(i.M8C.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new i.iKG(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),Jr(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})}loadAnimation(e){const t=this.json.animations[e],r=[],n=[],s=[],o=[],a=[];for(let i=0,l=t.channels.length;i<l;i++){const e=t.channels[i],l=t.samplers[e.sampler],c=e.target,u=c.node,p=void 0!==t.parameters?t.parameters[l.input]:l.input,h=void 0!==t.parameters?t.parameters[l.output]:l.output;r.push(this.getDependency("node",u)),n.push(this.getDependency("accessor",p)),s.push(this.getDependency("accessor",h)),o.push(l),a.push(c)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(s),Promise.all(o),Promise.all(a)]).then(function(r){const n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],r=s[e],u=o[e],p=a[e],h=l[e];if(void 0===t)continue;let d;switch(t.updateMatrix(),Xr[h.path]){case Xr.weights:d=i.dUE;break;case Xr.rotation:d=i.iLg;break;default:d=i.yC1}const f=t.name?t.name:t.uuid,g=void 0!==p.interpolation?Yr[p.interpolation]:i.NMF,m=[];Xr[h.path]===Xr.weights?t.traverse(function(e){e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)}):m.push(f);let _=u.array;if(u.normalized){const e=ti(_.constructor),t=new Float32Array(_.length);for(let r=0,i=_.length;r<i;r++)t[r]=_[r]*e;_=t}for(let e=0,n=m.length;e<n;e++){const t=new d(m[e]+"."+Xr[h.path],r.array,_,g);"CUBICSPLINE"===p.interpolation&&(t.createInterpolant=function(e){return new(this instanceof i.iLg?zr:jr)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const u=t.name?t.name:"animation_"+e;return new i.m7l(u,void 0,c)})}createNodeMesh(e){const t=this.json,r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(e){const t=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=i.weights.length;t<r;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this.json,r=this.extensions,n=this,s=t.nodes[e],o=s.name?n.createUniqueName(s.name):"";return function(){const t=[],r=n._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return r&&t.push(r),void 0!==s.camera&&t.push(n.getDependency("camera",s.camera).then(function(e){return n._getNodeRef(n.cameraCache,s.camera,e)})),n._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){t.push(e)}),Promise.all(t)}().then(function(t){let a;if((a=!0===s.isBone?new i.N$j:t.length>1?new i.ZAu:1===t.length?t[0]:new i.Tme)!==t[0])for(let e=0,r=t.length;e<r;e++)a.add(t[e]);if(s.name&&(a.userData.name=s.name,a.name=o),Jr(a,s),s.extensions&&Kr(r,a,s),void 0!==s.matrix){const e=new i.yGw;e.fromArray(s.matrix),a.applyMatrix4(e)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=e,a})}loadScene(e){const t=this.json,r=this.extensions,n=this.json.scenes[e],s=this,o=new i.ZAu;n.name&&(o.name=s.createUniqueName(n.name)),Jr(o,n),n.extensions&&Kr(r,o,n);const a=n.nodes||[],l=[];for(let i=0,c=a.length;i<c;i++)l.push(ii(a[i],o,t,s));return Promise.all(l).then(function(){return s.associations=(e=>{const t=new Map;for(const[r,n]of s.associations)(r instanceof i.F5T||r instanceof i.xEZ)&&t.set(r,n);return e.traverse(e=>{const r=s.associations.get(e);null!=r&&t.set(e,r)}),t})(o),o})}}function ii(e,t,r,n){const s=r.nodes[e];return n.getDependency("node",e).then(function(e){if(void 0===s.skin)return e;let t;return n.getDependency("skin",s.skin).then(function(e){t=e;const r=[];for(let i=0,s=t.joints.length;i<s;i++)r.push(n.getDependency("node",t.joints[i]));return Promise.all(r)}).then(function(r){return e.traverse(function(e){if(!e.isMesh)return;const n=[],s=[];for(let o=0,a=r.length;o<a;o++){const e=r[o];if(e){n.push(e);const r=new i.yGw;void 0!==t.inverseBindMatrices&&r.fromArray(t.inverseBindMatrices.array,16*o),s.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new i.OdW(n,s),e.matrixWorld)}),e})}).then(function(e){t.add(e);const i=[];if(s.children){const t=s.children;for(let s=0,o=t.length;s<o;s++){const o=t[s];i.push(ii(o,e,r,n))}}return Promise.all(i)})}function ni(e,t,r){const n=t.attributes,s=[];function o(t,i){return r.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const i in n){const t=qr[i]||i.toLowerCase();t in e.attributes||s.push(o(n[i],t))}if(void 0!==t.indices&&!e.index){const i=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});s.push(i)}return Jr(e,t),function(e,t,r){const n=t.attributes,s=new i.ZzF;if(void 0===n.POSITION)return;{const e=r.json.accessors[n.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new i.Pa4(t[0],t[1],t[2]),new i.Pa4(o[0],o[1],o[2])),e.normalized){const t=ti(Vr[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new i.Pa4,t=new i.Pa4;for(let i=0,n=o.length;i<n;i++){const n=o[i];if(void 0!==n.POSITION){const i=r.json.accessors[n.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const e=ti(Vr[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const a=new i.aLr;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}(e,t,r),Promise.all(s).then(function(){return void 0!==t.targets?function(e,t,r){let i=!1,n=!1,s=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(n=!0),void 0!==e.COLOR_0&&(s=!0),i&&n&&s)break}if(!i&&!n&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(i){const t=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):e.attributes.position;o.push(t)}if(n){const t=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==u.COLOR_0?r.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(t){const r=t[0],o=t[1],a=t[2];return i&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}function si(e,t){let r=e.getIndex();if(null===r){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const n=r.count-2,s=[];if(t===i.z$h)for(let i=1;i<=n;i++)s.push(r.getX(0)),s.push(r.getX(i)),s.push(r.getX(i+1));else for(let i=0;i<n;i++)i%2==0?(s.push(r.getX(i)),s.push(r.getX(i+1)),s.push(r.getX(i+2))):(s.push(r.getX(i+2)),s.push(r.getX(i+1)),s.push(r.getX(i)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(s),o}class oi extends _r{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,t){const r=await super.loadAsync(e,t),i=r?r.scene||r.scenes&&r.scenes.length>0&&r.scenes[0]:void 0;return i&&r.animations.length>0&&(i.animations=r.animations),i.traverse(e=>{e.userData.gltfUUID&&(e.uuid=e.userData.gltfUUID,delete e.userData.gltfUUID)}),i}register(e){return super.register(e)}}class ai extends i.hH6{constructor(e){super(e),this.type=i.cLu}async loadAsync(e,t){const r=await this.parseAsync(e,t,!1),n=new i.IEO(r.data,r.width,r.height,i.wk1,this.type);return n.needsUpdate=!0,n.flipY=!0,n.encoding=i.rnI,n.minFilter=i.wem,n.magFilter=i.wem,n.source.data.complete=!0,n}async parseAsync(e,t,r=!1){if(!e.startsWith("data:")){this.responseType="blob";const r=await super.loadAsync(e,t);e=(e=await bt(r)).replace("application/octet-stream","image/png")}const n=await It(e);let s=Uint8Array;return this.type===i.cLu?s=Uint16Array:this.type===i.VzW&&(s=Uint32Array),{data:function(e,t=3,r=Uint16Array,n=!1){let s;const o=e.byteLength>>2,a=new r(o*t);for(let l=0;l<o;l++)s=Math.pow(2,e[4*l+3]-136),n?(a[l*t]=Math.min(e[4*l]*s,65504),a[l*t+1]=Math.min(e[4*l+1]*s,65504),a[l*t+2]=Math.min(e[4*l+2]*s,65504)):(a[l*t]=i.A5E.toHalfFloat(Math.min(e[4*l]*s,65504)),a[l*t+1]=i.A5E.toHalfFloat(Math.min(e[4*l+1]*s,65504)),a[l*t+2]=i.A5E.toHalfFloat(Math.min(e[4*l+2]*s,65504))),4===t&&(a[l*t+3]=i.A5E.toHalfFloat(1));return a}(n.data,4,s,r),width:n.width,height:n.height}}setDataType(e){return this.type=e,this}}class li extends i.Gql{constructor(e){super(e),this._imageLoader=new i.S3k(e)}parseTextures2(e,t,r){var n;for(const s of e){const e=null===(n=null==s?void 0:s.userData)||void 0===n?void 0:n.rootPath;if(e&&(!s.image||!t[s.image])){const n=new i.Hw6(this._imageLoader.load(e,r));if(!n)continue;s.image&&(n.uuid=s.image),t[n.uuid]=n,s.image=n.uuid}s.userData=De(s.userData,void 0,!1,{images:t})}return super.parseTextures(e,t)}parseMaterials2(e,t,r){const i={};return e.forEach(e=>{if(!e)return;const n={...e},s=Object.keys(n);for(const r of s)if("map"===r||r.endsWith("Map")){const e=n[r];"string"==typeof e&&(t[e]?n[r]=t[e]:(console.warn(`Texture ${e} not found`),delete n[r]))}n.userData&&(n.userData=De(n.userData,void 0,!1,{textures:t}));const o=r.generateFromTemplateType(n.type,n);o&&(i[e.uuid]=o)}),i}}const ci="WEBGI_viewer";function ui(e){to.Importers.push(new lr(oi,["gltf","glb","data:model/gltf"],!0,(t,r)=>{if(!t)return t;const i=t,n=new li(r.loadingManager);return i.register(gi(n,e)),i.register(fi(n)),i.register(mi(n)),i.register(e=>new bi(e)),i.register(e=>new yi(e)),i.register(e=>new wi(e)),i.register(e=>new Ei(e)),i.register(t=>{var s,o,a,l,c,u,p,h,d;const f=We()+".drc",g=We()+".ktx2",m=null===(a=null===(o=null===(s=t.json)||void 0===s?void 0:s.extensionsRequired)||void 0===o?void 0:o.includes)||void 0===a?void 0:a.call(o,"KHR_draco_mesh_compression");if(m){const e=r.registerFile(f);e&&i.setDRACOLoader(e)}(null===(u=null===(c=null===(l=t.json)||void 0===l?void 0:l.extensionsUsed)||void 0===c?void 0:c.includes)||void 0===u?void 0:u.call(c,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(i.setMeshoptDecoder(window.MeshoptDecoder),t.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const _=null===(d=null===(h=null===(p=t.json)||void 0===p?void 0:p.extensionsUsed)||void 0===h?void 0:h.includes)||void 0===d?void 0:d.call(h,"KHR_texture_basisu");if(_){const e=r.registerFile(g);e&&(i.setKTX2Loader(e),t.options.ktx2Loader=e)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async i=>{m&&r.unregisterFile(f),_&&r.unregisterFile(g);const s=await async function e(t,r,i,n){var s;if(!n){const i=t.json.scenes||[];if(1!==i.length){for(const n of i)await e(t,r,n);return}n=i[0]}const o=null===(s=n.extensions)||void 0===s?void 0:s[ci];if(!o)return;const a=[];Object.values(o.resources).forEach(e=>{Object.values(e).forEach(e=>{e.url&&("Uint16Array"===e.url.type&&e.url.data&&a.push(e.url),"Uint8Array"===e.url.type&&e.url.data&&a.push(e.url))})});for(const c of a){const e=c.data.image,r=t.json.images[e],i=await t.getDependency("bufferView",r.bufferView);if(r.mimeType.startsWith("image/")&&"Uint16Array"===c.type&&"rgbe"===c.encoding){const e=new Blob([i],{type:r.mimeType}),t="data:image/png;base64,"+btoa(await e.text());c.data=(await(new ai).parseAsync(t,void 0,!0)).data,delete c.encoding}else c.data=i}const l={textures:{}};if(o.resources.textures&&t.json.textures)for(const[c,u]of Object.entries(o.resources.textures)){if(u.uuid||!c)continue;delete o.resources.textures[c];const e=t.json.textures.findIndex(e=>{var r,i,n,s,o,a,l;return(null===(r=e.extras)||void 0===r?void 0:r.uuid)===c||(null===(s=null===(n=null===(i=t.json.samplers)||void 0===i?void 0:i[e.sampler])||void 0===n?void 0:n.extras)||void 0===s?void 0:s.uuid)===c||(null===(l=null===(a=null===(o=t.json.images)||void 0===o?void 0:o[e.source])||void 0===a?void 0:a.extras)||void 0===l?void 0:l.t_uuid)===c});e>=0&&(l.textures[c]=await t.getDependency("texture",e))}if(o.resources.materials&&t.json.materials)for(const[c,u]of Object.entries(o.resources.materials)){if(u.uuid||!c)continue;delete o.resources.materials[c];const e=t.json.materials.findIndex(e=>{var t;return(null===(t=e.extras)||void 0===t?void 0:t.uuid)===c});e>=0&&(l.materials[c]=await t.getDependency("material",e))}return o.resources=await r.getPlugin(so).importConfigResources(o.resources||{},i,l),o}(t,e,n);i.scene.__importedViewerConfig=s}}}),i}))}const pi="WEBGI_light_extras",hi="WEBGI_object3d_extras",di="WEBGI_material_extras",fi=e=>e=>({name:"__"+hi,afterRoot:async e=>{(e.scenes||(e.scene?[e.scene]:[])).forEach(e=>{e.traverse(e=>{var t,r;if(!e.isObject3D)return;const i=null===(r=null===(t=e.userData)||void 0===t?void 0:t.gltfExtensions)||void 0===r?void 0:r[hi];if(!i)return void(e.isLight&&!e.isAmbientLight&&(e.castShadow=!0));const n=void 0!==i.castShadow||void 0!==i.receiveShadow;void 0!==i.castShadow&&(e.castShadow=i.castShadow),void 0!==i.receiveShadow&&(e.receiveShadow=i.receiveShadow),void 0!==i.visible&&(e.visible=i.visible),void 0!==i.frustumCulled&&(e.frustumCulled=i.frustumCulled),void 0!==i.renderOrder&&(e.renderOrder=i.renderOrder),void 0!==i.layers&&(e.layers.mask=i.layers),n&&(e.userData.__keepShadowDef=!0),delete e.userData.gltfExtensions[hi]})})}}),gi=(e,t)=>e=>({name:"__"+di,afterRoot:async e=>{var r,i,n;const s=e.scenes||(e.scene?[e.scene]:[]);for(const o of s){const e=null===(i=null===(r=o.userData)||void 0===r?void 0:r.gltfExtensions)||void 0===i?void 0:i[di],s=e&&await(null===(n=t.getPlugin(so))||void 0===n?void 0:n.importConfigResources(e.resources||{}))||{};o.traverse(e=>{var t,r;const i=null==e?void 0:e.material;if(!(null==i?void 0:i.isMaterial))return;const n=null===(r=null===(t=i.userData)||void 0===t?void 0:t.gltfExtensions)||void 0===r?void 0:r[di];n&&(void 0!==n.emissiveIntensity&&(i.emissiveIntensity=n.emissiveIntensity),void 0!==n.fog&&(i.fog=n.fog),void 0!==n.flatShading&&(i.flatShading=n.flatShading),void 0!==n.blending&&(i.blending=n.blending),void 0!==n.side&&(i.side=n.side),void 0!==n.shadowSide&&(i.shadowSide=n.shadowSide),void 0!==n.depthFunc&&(i.depthFunc=n.depthFunc),void 0!==n.depthTest&&(i.depthTest=n.depthTest),void 0!==n.depthWrite&&(i.depthWrite=n.depthWrite),void 0!==n.colorWrite&&(i.colorWrite=n.colorWrite),void 0!==n.wireframe&&(i.wireframe=n.wireframe),void 0!==n.wireframeLinewidth&&(i.wireframeLinewidth=n.wireframeLinewidth),void 0!==n.wireframeLinecap&&(i.wireframeLinecap=n.wireframeLinecap),void 0!==n.wireframeLinejoin&&(i.wireframeLinejoin=n.wireframeLinejoin),void 0!==n.rotation&&(i.rotation=n.rotation),void 0!==n.polygonOffset&&(i.polygonOffset=n.polygonOffset),void 0!==n.polygonOffsetFactor&&(i.polygonOffsetFactor=n.polygonOffsetFactor),void 0!==n.polygonOffsetUnits&&(i.polygonOffsetUnits=n.polygonOffsetUnits),void 0!==n.dithering&&(i.dithering=n.dithering),void 0!==n.alphaToCoverage&&(i.alphaToCoverage=n.alphaToCoverage),void 0!==n.premultipliedAlpha&&(i.premultipliedAlpha=n.premultipliedAlpha),void 0!==n.toneMapped&&(i.toneMapped=n.toneMapped),void 0!==n.reflectivity&&(i.reflectivity=n.reflectivity),Object.entries(n).forEach(([e,t])=>{e.startsWith("_")||t&&t.resource&&"string"==typeof t.resource&&(i[e]=De(t,i[e],!1,s))}),delete i.userData.gltfExtensions[di])}),e&&delete o.userData.gltfExtensions[di]}}}),mi=e=>t=>({name:"__"+pi,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(t=>{t.traverse(t=>{var r,i;if(!t.isLight)return;const n=null===(i=null===(r=t.userData)||void 0===r?void 0:r.gltfExtensions)||void 0===i?void 0:i[pi];n&&(!t.shadow&&n.shadow&&console.error("Light has no shadow, cannot import",t,n),n.shadow&&t.shadow&&(void 0!==n.shadow.bias&&(t.shadow.bias=n.shadow.bias),void 0!==n.shadow.normalBias&&(t.shadow.normalBias=n.shadow.normalBias),void 0!==n.shadow.radius&&(t.shadow.radius=n.shadow.radius),void 0!==n.shadow.mapSize&&t.shadow.mapSize.fromArray(n.shadow.mapSize),void 0!==n.shadow.camera&&(t.shadow.camera=e.parseObject(n.shadow.camera))),delete t.userData.gltfExtensions[pi])})})}});const _i="WEBGI_materials_bumpmap",vi="WEBGI_materials_displacementmap",xi="WEBGI_materials_alphamap",Ai="WEBGI_materials_lightmap";class bi{constructor(e){this.parser=e,this.name=_i}async extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return void 0!==s.bumpScale&&(t.bumpScale=s.bumpScale),void 0!==s.bumpTexture&&n.push(r.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(n)}}class yi{constructor(e){this.parser=e,this.name=vi}async extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return void 0!==s.displacementScale&&(t.displacementScale=s.displacementScale),void 0!==s.displacementBias&&(t.displacementBias=s.displacementBias),void 0!==s.displacementTexture&&n.push(r.assignTexture(t,"displacementMap",s.displacementTexture)),Promise.all(n)}}class wi{constructor(e){this.parser=e,this.name=Ai}async extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return void 0!==s.lightMapIntensity&&(t.lightMapIntensity=s.lightMapIntensity),void 0!==s.lightMapTexture&&n.push(r.assignTexture(t,"lightMap",s.lightMapTexture)),Promise.all(n)}}class Ei{constructor(e){this.parser=e,this.name=xi}async extendMaterialParams(e,t){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],s=i.extensions[this.name];return void 0!==s.alphaTexture&&n.push(r.assignTexture(t,"alphaMap",s.alphaTexture)),Promise.all(n)}}var Si=__webpackgi_require__(23);function Ci(){to.Importers.push(new lr(Si.Q,["drc"],!0))}var Mi={},Ti=Uint8Array,Ii=Uint16Array,ki=Uint32Array,Di=new Ti([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Pi=new Ti([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bi=new Ti([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ri=function(e,t){for(var r=new Ii(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];var n=new ki(r[30]);for(i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return[r,n]},Li=Ri(Di,2),Oi=Li[0],Fi=Li[1];Oi[28]=258,Fi[258]=28;for(var Ui=Ri(Pi,0),Ni=Ui[0],ji=Ui[1],Gi=new Ii(32768),zi=0;zi<32768;++zi){var Vi=(43690&zi)>>>1|(21845&zi)<<1;Vi=(61680&(Vi=(52428&Vi)>>>2|(13107&Vi)<<2))>>>4|(3855&Vi)<<4,Gi[zi]=((65280&Vi)>>>8|(255&Vi)<<8)>>>1}var Qi=function(e,t,r){for(var i=e.length,n=0,s=new Ii(t);n<i;++n)++s[e[n]-1];var o,a=new Ii(t);for(n=0;n<t;++n)a[n]=a[n-1]+s[n-1]<<1;if(r){o=new Ii(1<<t);var l=15-t;for(n=0;n<i;++n)if(e[n])for(var c=n<<4|e[n],u=t-e[n],p=a[e[n]-1]++<<u,h=p|(1<<u)-1;p<=h;++p)o[Gi[p]>>>l]=c}else for(o=new Ii(i),n=0;n<i;++n)e[n]&&(o[n]=Gi[a[e[n]-1]++]>>>15-e[n]);return o},Hi=new Ti(288);for(zi=0;zi<144;++zi)Hi[zi]=8;for(zi=144;zi<256;++zi)Hi[zi]=9;for(zi=256;zi<280;++zi)Hi[zi]=7;for(zi=280;zi<288;++zi)Hi[zi]=8;var Wi=new Ti(32);for(zi=0;zi<32;++zi)Wi[zi]=5;var qi=Qi(Hi,9,0),Xi=Qi(Hi,9,1),Yi=Qi(Wi,5,0),Ki=Qi(Wi,5,1),Ji=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Zi=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},$i=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},en=function(e){return(e/8|0)+(7&e&&1)},tn=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof Ii?Ii:e instanceof ki?ki:Ti)(r-t);return i.set(e.subarray(t,r)),i},rn=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new Ti(0);var n=!t||r,s=!r||r.i;r||(r={}),t||(t=new Ti(3*i));var o=function(e){var r=t.length;if(e>r){var i=new Ti(Math.max(2*r,e));i.set(t),t=i}},a=r.f||0,l=r.p||0,c=r.b||0,u=r.l,p=r.d,h=r.m,d=r.n,f=8*i;do{if(!u){r.f=a=Zi(e,l,1);var g=Zi(e,l+1,3);if(l+=3,!g){var m=e[(M=en(l)+4)-4]|e[M-3]<<8,_=M+m;if(_>i){if(s)throw"unexpected EOF";break}n&&o(c+m),t.set(e.subarray(M,_),c),r.b=c+=m,r.p=l=8*_;continue}if(1==g)u=Xi,p=Ki,h=9,d=5;else{if(2!=g)throw"invalid block type";var v=Zi(e,l,31)+257,x=Zi(e,l+10,15)+4,A=v+Zi(e,l+5,31)+1;l+=14;for(var b=new Ti(A),y=new Ti(19),w=0;w<x;++w)y[Bi[w]]=Zi(e,l+3*w,7);l+=3*x;var E=Ji(y),S=(1<<E)-1,C=Qi(y,E,1);for(w=0;w<A;){var M,T=C[Zi(e,l,S)];if(l+=15&T,(M=T>>>4)<16)b[w++]=M;else{var I=0,k=0;for(16==M?(k=3+Zi(e,l,3),l+=2,I=b[w-1]):17==M?(k=3+Zi(e,l,7),l+=3):18==M&&(k=11+Zi(e,l,127),l+=7);k--;)b[w++]=I}}var D=b.subarray(0,v),P=b.subarray(v);h=Ji(D),d=Ji(P),u=Qi(D,h,1),p=Qi(P,d,1)}if(l>f){if(s)throw"unexpected EOF";break}}n&&o(c+131072);for(var B=(1<<h)-1,R=(1<<d)-1,L=l;;L=l){var O=(I=u[$i(e,l)&B])>>>4;if((l+=15&I)>f){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(O<256)t[c++]=O;else{if(256==O){L=l,u=null;break}var F=O-254;if(O>264){var U=Di[w=O-257];F=Zi(e,l,(1<<U)-1)+Oi[w],l+=U}var N=p[$i(e,l)&R],j=N>>>4;if(!N)throw"invalid distance";if(l+=15&N,P=Ni[j],j>3&&(U=Pi[j],P+=$i(e,l)&(1<<U)-1,l+=U),l>f){if(s)throw"unexpected EOF";break}n&&o(c+131072);for(var G=c+F;c<G;c+=4)t[c]=t[c-P],t[c+1]=t[c+1-P],t[c+2]=t[c+2-P],t[c+3]=t[c+3-P];c=G}}r.l=u,r.p=L,r.b=c,u&&(a=1,r.m=h,r.d=p,r.n=d)}while(!a);return c==t.length?t:tn(t,0,c)},nn=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8},sn=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},on=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,s=r.slice();if(!n)return[dn,0];if(1==n){var o=new Ti(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var a=r[0],l=r[1],c=0,u=1,p=2;for(r[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=n-1;)a=r[r[c].f<r[p].f?c++:p++],l=r[c!=u&&r[c].f<r[p].f?c++:p++],r[u++]={s:-1,f:a.f+l.f,l:a,r:l};var h=s[0].s;for(i=1;i<n;++i)s[i].s>h&&(h=s[i].s);var d=new Ii(h+1),f=an(r[u-1],d,0);if(f>t){i=0;var g=0,m=f-t,_=1<<m;for(s.sort(function(e,t){return d[t.s]-d[e.s]||e.f-t.f});i<n;++i){var v=s[i].s;if(!(d[v]>t))break;g+=_-(1<<f-d[v]),d[v]=t}for(g>>>=m;g>0;){var x=s[i].s;d[x]<t?g-=1<<t-d[x]++-1:++i}for(;i>=0&&g;--i){var A=s[i].s;d[A]==t&&(--d[A],++g)}f=t}return[new Ti(d),f]},an=function(e,t,r){return-1==e.s?Math.max(an(e.l,t,r+1),an(e.r,t,r+1)):t[e.s]=r},ln=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new Ii(++t),i=0,n=e[0],s=1,o=function(e){r[i++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++s;else{if(!n&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(n),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(n);s=1,n=e[a]}return[r.subarray(0,i),t]},cn=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},un=function(e,t,r){var i=r.length,n=en(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var s=0;s<i;++s)e[n+s+4]=r[s];return 8*(n+4+i)},pn=function(e,t,r,i,n,s,o,a,l,c,u){nn(t,u++,r),++n[256];for(var p=on(n,15),h=p[0],d=p[1],f=on(s,15),g=f[0],m=f[1],_=ln(h),v=_[0],x=_[1],A=ln(g),b=A[0],y=A[1],w=new Ii(19),E=0;E<v.length;++E)w[31&v[E]]++;for(E=0;E<b.length;++E)w[31&b[E]]++;for(var S=on(w,7),C=S[0],M=S[1],T=19;T>4&&!C[Bi[T-1]];--T);var I,k,D,P,B=c+5<<3,R=cn(n,Hi)+cn(s,Wi)+o,L=cn(n,h)+cn(s,g)+o+14+3*T+cn(w,C)+(2*w[16]+3*w[17]+7*w[18]);if(B<=R&&B<=L)return un(t,u,e.subarray(l,l+c));if(nn(t,u,1+(L<R)),u+=2,L<R){I=Qi(h,d,0),k=h,D=Qi(g,m,0),P=g;var O=Qi(C,M,0);for(nn(t,u,x-257),nn(t,u+5,y-1),nn(t,u+10,T-4),u+=14,E=0;E<T;++E)nn(t,u+3*E,C[Bi[E]]);u+=3*T;for(var F=[v,b],U=0;U<2;++U){var N=F[U];for(E=0;E<N.length;++E){var j=31&N[E];nn(t,u,O[j]),u+=C[j],j>15&&(nn(t,u,N[E]>>>5&127),u+=N[E]>>>12)}}}else I=qi,k=Hi,D=Yi,P=Wi;for(E=0;E<a;++E)if(i[E]>255){j=i[E]>>>18&31,sn(t,u,I[j+257]),u+=k[j+257],j>7&&(nn(t,u,i[E]>>>23&31),u+=Di[j]);var G=31&i[E];sn(t,u,D[G]),u+=P[G],G>3&&(sn(t,u,i[E]>>>5&8191),u+=Pi[G])}else sn(t,u,I[i[E]]),u+=k[i[E]];return sn(t,u,I[256]),u+k[256]},hn=new ki([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),dn=new Ti(0),fn=function(e,t,r,i,n,s){var o=e.length,a=new Ti(i+o+5*(1+Math.ceil(o/7e3))+n),l=a.subarray(i,a.length-n),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var p=u+65535;p<o?c=un(l,c,e.subarray(u,p)):(l[u]=s,c=un(l,c,e.subarray(u,o)))}else{for(var h=hn[t-1],d=h>>>13,f=8191&h,g=(1<<r)-1,m=new Ii(32768),_=new Ii(g+1),v=Math.ceil(r/3),x=2*v,A=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<x)&g},b=new ki(25e3),y=new Ii(288),w=new Ii(32),E=0,S=0,C=(u=0,0),M=0,T=0;u<o;++u){var I=A(u),k=32767&u,D=_[I];if(m[k]=D,_[I]=k,M<=u){var P=o-u;if((E>7e3||C>24576)&&P>423){c=pn(e,l,0,b,y,w,S,C,T,u-T,c),C=E=S=0,T=u;for(var B=0;B<286;++B)y[B]=0;for(B=0;B<30;++B)w[B]=0}var R=2,L=0,O=f,F=k-D&32767;if(P>2&&I==A(u-F))for(var U=Math.min(d,P)-1,N=Math.min(32767,u),j=Math.min(258,P);F<=N&&--O&&k!=D;){if(e[u+R]==e[u+R-F]){for(var G=0;G<j&&e[u+G]==e[u+G-F];++G);if(G>R){if(R=G,L=F,G>U)break;var z=Math.min(F,G-2),V=0;for(B=0;B<z;++B){var Q=u-F+B+32768&32767,H=Q-m[Q]+32768&32767;H>V&&(V=H,D=Q)}}}F+=(k=D)-(D=m[k])+32768&32767}if(L){b[C++]=268435456|Fi[R]<<18|ji[L];var W=31&Fi[R],q=31&ji[L];S+=Di[W]+Pi[q],++y[257+W],++w[q],M=u+R,++E}else b[C++]=e[u],++y[e[u]]}}c=pn(e,l,s,b,y,w,S,C,T,u-T,c),!s&&7&c&&(c=un(l,c+1,dn))}return tn(a,0,i+en(c)+n)},gn=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,i=9;--i;)r=(1&r&&-306674912)^r>>>1;e[t]=r}return e}(),mn=function(){var e=-1;return{p:function(t){for(var r=e,i=0;i<t.length;++i)r=gn[255&r^t[i]]^r>>>8;e=r},d:function(){return~e}}},_n=function(){var e=1,t=0;return{p:function(r){for(var i=e,n=t,s=r.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)n+=i+=r[o];i=(65535&i)+15*(i>>16),n=(65535&n)+15*(n>>16)}e=i,t=n},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},vn=function(e,t,r,i,n){return fn(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,i,!n)},xn=function(e,t){var r={};for(var i in e)r[i]=e[i];for(var i in t)r[i]=t[i];return r},An=function(e,t,r){for(var i=e(),n=e.toString(),s=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=s[o];if("function"==typeof a){t+=";"+l+"=";var c=a.toString();if(a.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else for(var p in t+=c,a.prototype)t+=";"+l+".prototype."+p+"="+a.prototype[p].toString();else t+=c}else r[l]=a}return[t,r]},bn=[],yn=function(e,t,r,i){var n;if(!bn[r]){for(var s="",o={},a=e.length-1,l=0;l<a;++l)s=(n=An(e[l],s,o))[0],o=n[1];bn[r]=An(e[a],s,o)}var c=xn({},bn[r][1]);return function(e,t,r,i,n){var s=new Worker(Mi[t]||(Mi[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))));return s.onerror=function(e){return n(e.error,null)},s.onmessage=function(e){return n(null,e.data)},s.postMessage(r,i),s}(bn[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,c,function(e){var t=[];for(var r in e)(e[r]instanceof Ti||e[r]instanceof Ii||e[r]instanceof ki)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(c),i)},wn=function(){return[Ti,Ii,ki,Di,Pi,Bi,Oi,Ni,Xi,Ki,Gi,Qi,Ji,Zi,$i,en,tn,rn,Zn,In,kn]},En=function(){return[Ti,Ii,ki,Di,Pi,Bi,Fi,ji,qi,Hi,Yi,Wi,Gi,hn,dn,Qi,nn,sn,on,an,ln,cn,un,pn,en,tn,fn,vn,Xn,In]},Sn=function(){return[Un,Gn,Fn,mn,gn]},Cn=function(){return[Nn,jn]},Mn=function(){return[zn,Fn,_n]},Tn=function(){return[Vn]},In=function(e){return postMessage(e,[e.buffer])},kn=function(e){return e&&e.size&&new Ti(e.size)},Dn=function(e,t,r,i,n,s){var o=yn(r,i,n,function(e,t){o.terminate(),s(e,t)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},Pn=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Bn=function(e,t,r,i,n){var s,o=yn(e,i,n,function(e,r){e?(o.terminate(),t.ondata.call(t,e)):(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1]))});o.postMessage(r),t.push=function(e,r){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,s=r],[e.buffer])},t.terminate=function(){o.terminate()}},Rn=function(e,t){return e[t]|e[t+1]<<8},Ln=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},On=function(e,t){return Ln(e,t)+4294967296*Ln(e,t+4)},Fn=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},Un=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Fn(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var i=0;i<=r.length;++i)e[i+10]=r.charCodeAt(i)}},Nn=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[r++]);return r+(2&t)},jn=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Gn=function(e){return 10+(e.filename&&e.filename.length+1||0)},zn=function(e,t){var r=t.level,i=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},Vn=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Qn(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Hn=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(vn(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Wn=function(e,t){Bn([En,function(){return[Pn,Hn]}],this,Qn.call(this,e,t),function(e){var t=new Hn(e.data);onmessage=Pn(t)},6)};function qn(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Dn(e,t,[En],function(e){return In(Xn(e.data[0],e.data[1]))},0,r)}function Xn(e,t){return vn(e,t||{},0,0)}var Yn=function(){function e(e){this.s={},this.p=new Ti(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new Ti(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=rn(this.p,this.o,this.s);this.ondata(tn(r,t,this.s.b),this.d),this.o=tn(r,this.s.b-32768),this.s.b=this.o.length,this.p=tn(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Kn=function(e){this.ondata=e,Bn([wn,function(){return[Pn,Yn]}],this,0,function(){var e=new Yn;onmessage=Pn(e)},7)};function Jn(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Dn(e,t,[wn],function(e){return In(Zn(e.data[0],kn(e.data[1])))},1,r)}function Zn(e,t){return rn(e,t)}var $n=function(){function e(e,t){this.c=mn(),this.l=0,this.v=1,Hn.call(this,e,t)}return e.prototype.push=function(e,t){Hn.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=vn(e,this.o,this.v&&Gn(this.o),t&&8,!t);this.v&&(Un(r,this.o),this.v=0),t&&(Fn(r,r.length-8,this.c.d()),Fn(r,r.length-4,this.l)),this.ondata(r,t)},e}(),es=function(e,t){Bn([En,Sn,function(){return[Pn,Hn,$n]}],this,Qn.call(this,e,t),function(e){var t=new $n(e.data);onmessage=Pn(t)},8)};function ts(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Dn(e,t,[En,Sn,function(){return[rs]}],function(e){return In(rs(e.data[0],e.data[1]))},2,r)}function rs(e,t){t||(t={});var r=mn(),i=e.length;r.p(e);var n=vn(e,t,Gn(t),8),s=n.length;return Un(n,t),Fn(n,s-8,r.d()),Fn(n,s-4,i),n}var is=function(){function e(e){this.v=1,Yn.call(this,e)}return e.prototype.push=function(e,t){if(Yn.prototype.e.call(this,e),this.v){var r=this.p.length>3?Nn(this.p):4;if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Yn.prototype.c.call(this,t)},e}(),ns=function(e){this.ondata=e,Bn([wn,Cn,function(){return[Pn,Yn,is]}],this,0,function(){var e=new is;onmessage=Pn(e)},9)};function ss(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Dn(e,t,[wn,Cn,function(){return[os]}],function(e){return In(os(e.data[0]))},3,r)}function os(e,t){return rn(e.subarray(Nn(e),-8),t||new Ti(jn(e)))}var as=function(){function e(e,t){this.c=_n(),this.v=1,Hn.call(this,e,t)}return e.prototype.push=function(e,t){Hn.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=vn(e,this.o,this.v&&2,t&&4,!t);this.v&&(zn(r,this.o),this.v=0),t&&Fn(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),ls=function(e,t){Bn([En,Mn,function(){return[Pn,Hn,as]}],this,Qn.call(this,e,t),function(e){var t=new as(e.data);onmessage=Pn(t)},10)};function cs(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Dn(e,t,[En,Mn,function(){return[us]}],function(e){return In(us(e.data[0],e.data[1]))},4,r)}function us(e,t){t||(t={});var r=_n();r.p(e);var i=vn(e,t,2,4);return zn(i,t),Fn(i,i.length-4,r.d()),i}var ps=function(){function e(e){this.v=1,Yn.call(this,e)}return e.prototype.push=function(e,t){if(Yn.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Yn.prototype.c.call(this,t)},e}(),hs=function(e){this.ondata=e,Bn([wn,Tn,function(){return[Pn,Yn,ps]}],this,0,function(){var e=new ps;onmessage=Pn(e)},11)};function ds(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return Dn(e,t,[wn,Tn,function(){return[fs]}],function(e){return In(fs(e.data[0],kn(e.data[1])))},5,r)}function fs(e,t){return rn((Vn(e),e.subarray(2,-4)),t)}var gs=function(){function e(e){this.G=is,this.I=Yn,this.Z=ps,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new Ti(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,n=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(n):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(n):new this.Z(n),this.s.push(this.p,t),this.p=null}}},e}(),ms=function(){function e(e){this.G=ns,this.I=Kn,this.Z=hs,this.ondata=e}return e.prototype.push=function(e,t){gs.prototype.push.call(this,e,t)},e}();function _s(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?ss(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Jn(e,t,r):ds(e,t,r)}function vs(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?os(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Zn(e,t):fs(e,t)}var xs=function(e,t,r,i){for(var n in e){var s=e[n],o=t+n;s instanceof Ti?r[o]=[s,i]:Array.isArray(s)?r[o]=[s[0],xn(i,s[1])]:xs(s,o+"/",r,i)}},As="undefined"!=typeof TextEncoder&&new TextEncoder,bs="undefined"!=typeof TextDecoder&&new TextDecoder,ys=0;try{bs.decode(dn,{stream:!0}),ys=1}catch(eu){}var ws=function(e){for(var t="",r=0;;){var i=e[r++],n=(i>127)+(i>223)+(i>239);if(r+n>e.length)return[t,tn(e,r-1)];n?3==n?(i=((15&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|i>>10,56320|1023&i)):t+=1&n?String.fromCharCode((31&i)<<6|63&e[r++]):String.fromCharCode((15&i)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(i)}},Es=function(){function e(e){this.ondata=e,ys?this.t=new TextDecoder:this.p=dn}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var r=new Ti(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var i=ws(r),n=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(n,t)}},e}(),Ss=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Cs(e),this.d=t||!1)},e}();function Cs(e,t){if(t){for(var r=new Ti(e.length),i=0;i<e.length;++i)r[i]=e.charCodeAt(i);return r}if(As)return As.encode(e);var n=e.length,s=new Ti(e.length+(e.length>>1)),o=0,a=function(e){s[o++]=e};for(i=0;i<n;++i){if(o+5>s.length){var l=new Ti(o+8+(n-i<<1));l.set(s),s=l}var c=e.charCodeAt(i);c<128||t?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(a(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++i))>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return tn(s,0,o)}function Ms(e,t){if(t){for(var r="",i=0;i<e.length;i+=16384)r+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return r}if(bs)return bs.decode(e);var n=ws(e),s=n[0];if(n[1].length)throw"invalid utf-8 data";return s}var Ts=function(e){return 1==e?3:e<6?2:9==e?1:0},Is=function(e,t){return t+30+Rn(e,t+26)+Rn(e,t+28)},ks=function(e,t,r){var i=Rn(e,t+28),n=Ms(e.subarray(t+46,t+46+i),!(2048&Rn(e,t+8))),s=t+46+i,o=Ln(e,t+20),a=r&&4294967295==o?Ds(e,s):[o,Ln(e,t+24),Ln(e,t+42)],l=a[0],c=a[1],u=a[2];return[Rn(e,t+10),l,c,n,s+Rn(e,t+30)+Rn(e,t+32),u]},Ds=function(e,t){for(;1!=Rn(e,t);t+=4+Rn(e,t+2));return[On(e,t+12),On(e,t+4),On(e,t+20)]},Ps=function(e){var t=0;if(e)for(var r in e){var i=e[r].length;if(i>65535)throw"extra field too long";t+=i+4}return t},Bs=function(e,t,r,i,n,s,o,a){var l=i.length,c=r.extra,u=a&&a.length,p=Ps(c);Fn(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==s&&8),e[t++]=n&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var h=new Date(null==r.mtime?Date.now():r.mtime),d=h.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(Fn(e,t,d<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),t+=4,null!=s&&(Fn(e,t,r.crc),Fn(e,t+4,s),Fn(e,t+8,r.size)),Fn(e,t+12,l),Fn(e,t+14,p),t+=16,null!=o&&(Fn(e,t,u),Fn(e,t+6,r.attrs),Fn(e,t+10,o),t+=14),e.set(i,t),t+=l,p)for(var f in c){var g=c[f],m=g.length;Fn(e,t,+f),Fn(e,t+2,m),e.set(g,t+4),t+=4+m}return u&&(e.set(a,t),t+=u),t},Rs=function(e,t,r,i,n){Fn(e,t,101010256),Fn(e,t+8,r),Fn(e,t+10,r),Fn(e,t+12,i),Fn(e,t+16,n)},Ls=function(){function e(e){this.filename=e,this.c=mn(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Os=function(){function e(e,t){var r=this;t||(t={}),Ls.call(this,e),this.d=new Hn(t,function(e,t){r.ondata(null,e,t)}),this.compression=8,this.flag=Ts(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Ls.prototype.push.call(this,e,t)},e}(),Fs=function(){function e(e,t){var r=this;t||(t={}),Ls.call(this,e),this.d=new Wn(t,function(e,t,i){r.ondata(e,t,i)}),this.compression=8,this.flag=Ts(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Ls.prototype.push.call(this,e,t)},e}(),Us=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=Cs(e.filename),i=r.length,n=e.comment,s=n&&Cs(n),o=i!=e.filename.length||s&&n.length!=s.length,a=i+Ps(e.extra)+30;if(i>65535)throw"filename too long";var l=new Ti(a);Bs(l,0,e,r,o);var c=[l],u=function(){for(var e=0,r=c;e<r.length;e++){var i=r[e];t.ondata(null,i,!1)}c=[]},p=this.d;this.d=0;var h=this.u.length,d=xn(e,{f:r,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),p){var e=t.u[h+1];e?e.r():t.d=1}p=1}}),f=0;e.ondata=function(r,i,n){if(r)t.ondata(r,i,n),t.terminate();else if(f+=i.length,c.push(i),n){var s=new Ti(16);Fn(s,0,134695760),Fn(s,4,e.crc),Fn(s,8,f),Fn(s,12,e.size),c.push(s),d.c=f,d.b=a+f+16,d.crc=e.crc,d.size=e.size,p&&d.r(),p=1}else p&&u()},this.u.push(d)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,i=0,n=this.u;i<n.length;i++)r+=46+(l=n[i]).f.length+Ps(l.extra)+(l.o?l.o.length:0);for(var s=new Ti(r+22),o=0,a=this.u;o<a.length;o++){var l=a[o];Bs(s,e,l,l.f,l.u,l.c,t,l.o),e+=46+l.f.length+Ps(l.extra)+(l.o?l.o.length:0),t+=l.b}Rs(s,e,this.u.length,r,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();function Ns(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var i={};xs(e,"",i,t);var n=Object.keys(i),s=n.length,o=0,a=0,l=s,c=new Array(s),u=[],p=function(){for(var e=0;e<u.length;++e)u[e]()},h=function(){var e=new Ti(a+22),t=o,i=a-o;a=0;for(var n=0;n<l;++n){var s=c[n];try{var u=s.c.length;Bs(e,a,s,s.f,s.u,u);var p=30+s.f.length+Ps(s.extra),h=a+p;e.set(s.c,h),Bs(e,o,s,s.f,s.u,u,a,s.m),o+=16+p+(s.m?s.m.length:0),a=h+u}catch(e){return r(e,null)}}Rs(e,o,c.length,i,t),r(null,e)};s||h();for(var d=function(e){var t=n[e],l=i[t],d=l[0],f=l[1],g=mn(),m=d.length;g.p(d);var _=Cs(t),v=_.length,x=f.comment,A=x&&Cs(x),b=A&&A.length,y=Ps(f.extra),w=0==f.level?0:8,E=function(i,n){if(i)p(),r(i,null);else{var l=n.length;c[e]=xn(f,{size:m,crc:g.d(),c:n,f:_,m:A,u:v!=t.length||A&&x.length!=b,compression:w}),o+=30+v+y+l,a+=76+2*(v+y)+(b||0)+l,--s||h()}};if(v>65535&&E("filename too long",null),w)if(m<16e4)try{E(null,Xn(d,f))}catch(e){E(e,null)}else u.push(qn(d,f,E));else E(null,d)},f=0;f<l;++f)d(f);return p}function js(e,t){t||(t={});var r={},i=[];xs(e,"",r,t);var n=0,s=0;for(var o in r){var a=r[o],l=a[0],c=a[1],u=0==c.level?0:8,p=(w=Cs(o)).length,h=c.comment,d=h&&Cs(h),f=d&&d.length,g=Ps(c.extra);if(p>65535)throw"filename too long";var m=u?Xn(l,c):l,_=m.length,v=mn();v.p(l),i.push(xn(c,{size:l.length,crc:v.d(),c:m,f:w,m:d,u:p!=o.length||d&&h.length!=f,o:n,compression:u})),n+=30+p+g+_,s+=76+2*(p+g)+(f||0)+_}for(var x=new Ti(s+22),A=n,b=s-n,y=0;y<i.length;++y){var w=i[y];Bs(x,w.o,w,w.f,w.u,w.c.length);var E=30+w.f.length+Ps(w.extra);x.set(w.c,w.o+E),Bs(x,n,w,w.f,w.u,w.c.length,w.o,w.m),n+=16+E+(w.m?w.m.length:0)}return Rs(x,n,i.length,b,A),x}var Gs=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),zs=function(){function e(){var e=this;this.i=new Yn(function(t,r){e.ondata(null,t,r)})}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(r){this.ondata(r,e,t)}},e.compression=8,e}(),Vs=function(){function e(e,t){var r=this;t<32e4?this.i=new Yn(function(e,t){r.ondata(null,e,t)}):(this.i=new Kn(function(e,t,i){r.ondata(e,t,i)}),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=tn(e,0)),this.i.push(e,t)},e.compression=8,e}(),Qs=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Gs},this.p=dn}return e.prototype.push=function(e,t){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),n=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(n,!this.c):this.k[0].push(n),(e=e.subarray(i)).length)return this.push(e,t)}else{var s=0,o=0,a=void 0,l=void 0;this.p.length?e.length?((l=new Ti(this.p.length+e.length)).set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var c=l.length,u=this.c,p=u&&this.d,h=function(){var e,t=Ln(l,o);if(67324752==t){s=1,a=o,d.d=null,d.c=0;var i=Rn(l,o+6),n=Rn(l,o+8),p=2048&i,h=8&i,f=Rn(l,o+26),g=Rn(l,o+28);if(c>o+30+f+g){var m=[];d.k.unshift(m),s=2;var _,v=Ln(l,o+18),x=Ln(l,o+22),A=Ms(l.subarray(o+30,o+=30+f),!p);4294967295==v?(e=h?[-2]:Ds(l,o),v=e[0],x=e[1]):h&&(v=-1),o+=g,d.c=v;var b={name:A,compression:n,start:function(){if(!b.ondata)throw"no callback";if(v){var e=r.o[n];if(!e)throw"unknown compression type "+n;(_=v<0?new e(A):new e(A,v,x)).ondata=function(e,t,r){b.ondata(e,t,r)};for(var t=0,i=m;t<i.length;t++){var s=i[t];_.push(s,!1)}r.k[0]==m&&r.c?r.d=_:_.push(dn,!0)}else b.ondata(null,dn,!0)},terminate:function(){_&&_.terminate&&_.terminate()}};v>=0&&(b.size=v,b.originalSize=x),d.onfile(b)}return"break"}if(u){if(134695760==t)return a=o+=12+(-2==u&&8),s=3,d.c=0,"break";if(33639248==t)return a=o-=4,s=3,d.c=0,"break"}},d=this;o<c-4&&"break"!==h();++o);if(this.p=dn,u<0){var f=s?l.subarray(0,a-12-(-2==u&&8)-(134695760==Ln(l,a-16)&&4)):l.subarray(0,o);p?p.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(o),t);this.p=l.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function Hs(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],i=function(){for(var e=0;e<r.length;++e)r[e]()},n={},s=e.length-22;101010256!=Ln(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var o=Rn(e,s+8);o||t(null,{});var a=o,l=Ln(e,s+16),c=4294967295==l;if(c){if(s=Ln(e,s-12),101075792!=Ln(e,s))return void t("invalid zip file",null);a=o=Ln(e,s+32),l=Ln(e,s+48)}for(var u=function(s){var a=ks(e,l,c),u=a[0],p=a[1],h=a[2],d=a[3],f=a[4],g=a[5],m=Is(e,g);l=f;var _=function(e,r){e?(i(),t(e,null)):(n[d]=r,--o||t(null,n))};if(u)if(8==u){var v=e.subarray(m,m+p);if(p<32e4)try{_(null,Zn(v,new Ti(h)))}catch(e){_(e,null)}else r.push(Jn(v,{size:h},_))}else _("unknown compression type "+u,null);else _(null,tn(e,m,m+p))},p=0;p<a;++p)u();return i}function Ws(e){for(var t={},r=e.length-22;101010256!=Ln(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var i=Rn(e,r+8);if(!i)return{};var n=Ln(e,r+16),s=4294967295==n;if(s){if(r=Ln(e,r-12),101075792!=Ln(e,r))throw"invalid zip file";i=Ln(e,r+32),n=Ln(e,r+48)}for(var o=0;o<i;++o){var a=ks(e,n,s),l=a[0],c=a[1],u=a[2],p=a[3],h=a[4],d=a[5],f=Is(e,d);if(n=h,l){if(8!=l)throw"unknown compression type "+l;t[p]=Zn(e.subarray(f,f+c),new Ti(u))}else t[p]=tn(e,f,f+c)}return t}class qs extends i.hH6{load(e,t,r,i){return this.setResponseType("arraybuffer"),super.load(e,e=>{const r=Ws(new Uint8Array(e)),i=new Map(Object.entries(r).map(([e,t])=>[e,new File([t],e)]));null==t||t(i)},r,i)}}function Xs(){to.Importers.push(new lr(qs,["zip"],!0))}class Ys extends i.Ox3{constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new i.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,t){const r=this.target,i=e.userData;return e.userData={},super.copy(e,t),je(this.userData,i),r.position.copy(this.target.position),r.updateMatrixWorld(),this.target=r,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[null==this?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;null===(e=this.shadow.map)||void 0===e||e.dispose(),null===(t=this.shadow.mapPass)||void 0===t||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[null==this?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[null==this?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[null==this?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:r}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=ke(je({},t),!1),this.userData={},this.children=r,i.type="DirectionalLight2",i.target=this.target.position.toArray(),Object.assign(i,ke(this,!0,e))}fromJSON(e,t){if("DirectionalLight2"!==e.type)return null;const r=e.target,i=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,De(e,this,!0,t),r&&(e.target=r),i&&(void 0!==i.color&&this.color.set(i.color),void 0!==i.intensity&&(this.intensity=i.intensity),e.object=i),this}}class Ks extends i.PMe{constructor(e,t,r,i,n,s){super(e,t,r,i,n,s),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,t){const r=this.target,i=e.userData;return e.userData={},super.copy(e,t),je(this.userData,i),r.position.copy(this.target.position),r.updateMatrixWorld(),this.target=r,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[null==this?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;null===(e=this.shadow.map)||void 0===e||e.dispose(),null===(t=this.shadow.mapPass)||void 0===t||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[null==this?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[null==this?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:r}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=ke(je({},t),!1),this.userData={},this.children=r,i.type="SpotLight2",i.target=this.target.position.toArray(),Object.assign(i,ke(this,!0,e))}fromJSON(e,t){return"SpotLight2"!==e.type?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),void 0!==e.object.distance&&(this.distance=e.object.distance),void 0!==e.object.angle&&(this.angle=e.object.angle),void 0!==e.object.decay&&(this.decay=e.object.decay),void 0!==e.object.penumbra&&(this.penumbra=e.object.penumbra),De(e,this,!0,t),this):this)}}class Js extends i.cek{constructor(e,t,r,i){super(e,t,r,i),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,t){const r=e.userData;return e.userData={},super.copy(e,t),je(this.userData,r),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[null==this?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;null===(e=this.shadow.map)||void 0===e||e.dispose(),null===(t=this.shadow.mapPass)||void 0===t||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[null==this?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[null==this?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const r=super.toJSON(e);return r.userData=ke(je({},t),!1),this.userData={},r.type="PointLight2",Object.assign(r,ke(this,!0,e))}fromJSON(e,t){return"PointLight2"!==e.type?null:e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),void 0!==e.object.distance&&(this.distance=e.object.distance),void 0!==e.object.decay&&(this.decay=e.object.decay),De(e,this,!0,t),this):this}}class Zs extends i.Mig{constructor(e,t){super(e,t),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,t){const r=e.userData;return e.userData={},super.copy(e,t),je(this.userData,r),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const r=super.toJSON(e);return r.userData=ke(je({},t),!1),this.userData={},r.type="AmbientLight2",Object.assign(r,ke(this,!0,e))}fromJSON(e,t){return"AmbientLight2"!==e.type?null:e.object?(void 0!==e.object.color&&this.color.set(e.object.color),void 0!==e.object.intensity&&(this.intensity=e.object.intensity),De(e,this,!0,t),this):this}}class $s extends i.aNw{load(e,t,r,n){const s=new i.hH6(this.manager);s.setPath(this.path),s.setResponseType("text"),s.load(e,r=>{try{t(this.parse(r))}catch(t){n?n(t):console.error(t),this.manager.itemError(e)}},r,n)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,r=null;const n=new i.Pa4(0,0,0),s=new i.Pa4(1,1,1),o=e.split(/[\n\r]+/g);let a=null,l=0;for(let i=0,p=o.length;i<p;i++){const e=o[i].trim(),c=e.split(/\s/g);switch(c[0]){case"TITLE":t=e.substring(7,e.length-1);break;case"LUT_3D_SIZE":const i=c[1];r=parseFloat(i),a=new Uint8Array(r*r*r*4);break;case"DOMAIN_MIN":n.x=parseFloat(c[1]),n.y=parseFloat(c[2]),n.z=parseFloat(c[3]);break;case"DOMAIN_MAX":s.x=parseFloat(c[1]),s.y=parseFloat(c[2]),s.z=parseFloat(c[3]);break;default:const o=parseFloat(c[0]),u=parseFloat(c[1]),p=parseFloat(c[2]);if(o>1||o<0||u>1||u<0||p>1||p<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");a[l+0]=255*o,a[l+1]=255*u,a[l+2]=255*p,a[l+3]=255,l+=4}}const c=new i.IEO;c.image.data=a,c.image.width=r,c.image.height=r*r,c.type=i.ywz,c.magFilter=i.wem,c.minFilter=i.wem,c.wrapS=i.uWy,c.wrapT=i.uWy,c.generateMipmaps=!1,c.needsUpdate=!0;const u=new i.JUT;return u.image.data=a,u.image.width=r,u.image.height=r,u.image.depth=r,u.type=i.ywz,u.magFilter=i.wem,u.minFilter=i.wem,u.wrapS=i.uWy,u.wrapT=i.uWy,u.wrapR=i.uWy,u.generateMipmaps=!1,u.needsUpdate=!0,{title:t,size:r,domainMin:n,domainMax:s,texture:c,texture3D:u}}}class eo{constructor({domainMax:e,domainMin:t,size:r,texture:i,texture3D:n,title:s}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=e,this.domainMin=t,this.size=r,this.texture=i,this.texture3D=n,this.title=s,this.uuid=$(),this.userData.__needsSourceBuffer=!0}fromJSON(e,t){return e.type!==this.type&&console.warn("type mismatch while import",e,this),console.error("not supported"),this}toJSON(e){var t;if(null==e?void 0:e.textures[this.uuid])return{uuid:this.uuid,resource:"extras"};let r="";if(this.userData.__sourceBuffer){const e=new Uint8Array(this.userData.__sourceBuffer);r={data:Array.from(e),type:e.constructor.name,path:(null===(t=this.userData.__sourceBlob)||void 0===t?void 0:t.name)||this.userData.rootPath}}else this.userData.rootPath?r=this.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const i={uuid:this.uuid,url:r,userData:Ee({},this.userData),type:this.type,name:this.texture.name};return(null==e?void 0:e.extras)?(e.extras[this.uuid]=i,{uuid:this.uuid,resource:"extras"}):i}}class to extends r{constructor(e,t=!1){super(),this._processors=new dr,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=(()=>{})),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new i.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),Xs(),mr(e.renderer.rendererObject),ui(e),Ci()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,r){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:r})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,r){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:r})}_urlModifier(e){var t;let r=decodeURI(e);const i=null===(t=this._rootContext)||void 0===t?void 0:t.rootUrl;r.includes("://")||!i||r.startsWith(i)||(r=i+r),r=(r=(r=r.replace("./","")).replace(/^(\/\/)/,"/")).replace(/\?.*$/,"");const n=this._fileDatabase.get(r);return n?n.ext?(n.objectUrl||(n.objectUrl=URL.createObjectURL(n)+"#"+r),n.objectUrl):(console.error("Unable to determine file extension",n),e):e}_createLoader(e){const t=this._getImporter(e),r=null==t?void 0:t.ctor(this);return r&&(null==t||t.ext.forEach(e=>{const t=new RegExp(e.startsWith("data:")?"^"+e+"\\/":"\\."+e+"$","i");this._loadingManager.addHandler(t,r)})),r&&(this._loaderCache.push({loader:r,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:r})),r}async importFiles(e,t={}){const r=new Map;let{allowedExtensions:i}=t;if(i&&i.length<1&&(i=void 0),0===e.size)return r;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const n=[],s=[];if(e.forEach((e,t)=>{var r;this.registerFile(t,e);const o=e.ext;o&&(null===(r=null==i?void 0:i.includes(o.toLowerCase()))||void 0===r||r)&&(this._isRootFileExtension(o)?n.push(t):s.push(t))}),n.length>0)for(const o of n){let e=await this._importFile(o,void 0,t);e&&(e=await this.processImported(e,t)),r.set(o,e)}else for(const o of s){let e=await this._importFile(o,void 0,t);e&&(e=await this.processImported(e,t)),r.set(o,e)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((e,t)=>{this.unregisterFile(t)}),r}registerFile(e,t){var r,i,n;e=e.replace(/\?.*$/,"");const s=null!==(r=null==t?void 0:t.ext)&&void 0!==r?r:null===(n=cr(null!==(i=null==t?void 0:t.name)&&void 0!==i?i:e))||void 0===n?void 0:n.toLowerCase();t&&(t.ext||(t.ext=s),this._fileDatabase.set(e,t));let o=this._getLoader(e);if(o||(o=this._createLoader(null!=t?t:{name:e,ext:s})),o)for(const a of this._loaderCache)if(a.loader===o){a.files.push(e);break}return o}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);(null==t?void 0:t.objectUrl)&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return null!=to.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,r={},n){var s,o;if(null===(s=t)||void 0===s?void 0:s.__imported)return t.__imported;let a;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const s=this.resolveURL(e),l=e.replace(/\?.*$/,""),c=null!==(o=r.fileHandler)&&void 0!==o?o:await this._loadingManager.getHandler(l)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0);if(!c)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:s,rootUrl:i.Zp0.extractUrlBase(e),baseUrl:i.Zp0.extractUrlBase(s)},a=await c.loadAsync(e+(r.queryString?(e.includes("?")?"&":"?")+r.queryString:""),t=>{n&&n(t),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:t.loaded/t.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(r){return console.error("AssetImporter: Unable to import file",e,t),console.error(r),console.error(null==r?void 0:r.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:r}),t&&this.unregisterFile(e),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),t&&(t.__imported=a),a&&"object"==typeof a&&(a.__rootPath=e,t&&(a.__rootBlob=t)),a}_getImporter(e,t=!1){return to.Importers.find(r=>{if(t&&!r.root)return!1;const i=r.ext.find(t=>{var r,i,n;return e.ext&&t===e.ext.toLowerCase()||(null===(i=null===(r=e.name)||void 0===r?void 0:r.toLowerCase())||void 0===i?void 0:i.endsWith("."+t.toLowerCase()))||(null==t?void 0:t.startsWith("data:"))&&(null===(n=e.name)||void 0===n?void 0:n.startsWith(t))});return!!i&&(e.ext=i,!0)})}_getLoader(e){var t;return null!==(t=this._loadingManager.getHandler(e))&&void 0!==t?t:void 0}async importAsset(e,t={},r){var i;if(!e)return[];if(!this._cachedAssets.includes(e)){if(1===Object.entries(e).length&&e.path){const t=this._cachedAssets.find(t=>t.path===e.path);t&&Object.assign(e,t)}const t=this._cachedAssets.findIndex(t=>t.path===e.path);t>=0&&this._cachedAssets.splice(t,1),this._cachedAssets.push(e)}let n;if((null==e?void 0:e.preImported)&&(n=await e.preImported),!t.forceImport&&n){const e=await this.processImported(n,t);let r=!1;for(const t of e)if(t.__disposed){r=!0;break}if(!r||!1===t.reimportDisposed)return e}return e.preImported=this._importFile(t.pathOverride||e.path,"function"==typeof(null===(i=e.file)||void 0===i?void 0:i.arrayBuffer)?e.file:void 0,t,r),(n=await e.preImported)&&(n=await this.processImported(n,t)),n}async importSingle(e,t={}){var r;return null===(r=await this.importAsset(e,t))||void 0===r?void 0:r[0]}async importSinglePath(e,t){var r;return null===(r=await this.importPath(e,t))||void 0===r?void 0:r[0]}async importPath(e,t={}){const r={...t};delete r.pathOverride,delete r.forceImport,delete r.reimportDisposed;const i=JSON.stringify(r);let n;return(n=this._cachedAssets.find(t=>t.path===e&&t._options===i)||{path:e})._options=i,await this.importAsset(n,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var r,n,s,o,a,l,c,u;let p=e;if(!p)return[];if(!1===t.processImported)return[p];if(Array.isArray(p)){const e=[];for(const r of p)e.push(...await this.processImported(r,t));return e}if(null===(r=p.userData)||void 0===r?void 0:r.rootSceneModelRoot){if(t._rootSceneImported=!0,p.__processedChildren&&!t.forceImporterReprocess)return p.__processedChildren;if(!(p.children.length<1))return p.animations&&(p.children[0].animations||(p.children[0].animations=[]),p.children[0].animations.push(...p.animations)),p.__importedViewerConfig&&(p.children[0].__importedViewerConfig=p.__importedViewerConfig),p.__processedChildren=await this.processImported([...p.children],t),p.__processedChildren;if((null===(n=p.animations)||void 0===n?void 0:n.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",p.animations),!p.__importedViewerConfig)return[];p=p.__importedViewerConfig}if((null===(s=p.userData)||void 0===s?void 0:s.iModel)&&(p=p.userData.iModel),(null===(o=p.userData)||void 0===o?void 0:o.iMaterial)&&(p=p.userData.iMaterial),p.assetImporterProcessed&&!t.forceImporterReprocess)return[p];const h=p.__rootPath,d=p.__rootBlob;if(!p.assetType){if(p.isBufferGeometry&&(p=new i.Kj0(p,new i.Wid)),p.isObject3D)if(p.isLight)p=io(p);else{const e=[];p.traverse(t=>{t!==p&&t.isLight&&e.push(t)});for(const t of e)io(t);p=new pr(p,t)}p.isTexture&&(p.assetType="texture",t._testDataTextureComplete&&(p.isDataTexture&&(null===(a=p.image)||void 0===a?void 0:a.data)&&(p.image.complete=!0),(null===(l=p.image)||void 0===l?void 0:l.complete)&&(p.needsUpdate=!0)),void 0!==t.generateMipmaps&&(p.generateMipmaps=t.generateMipmaps),p.generateMipmaps||p.isRenderTargetTexture||(p.minFilter=p.minFilter===i.D1R?i.wem:p.minFilter,p.magFilter=p.magFilter===i.D1R?i.wem:p.magFilter)),p.isMaterial&&(p.assetType="material")}if(null!=p.assetType)return p.userData&&(p.userData.rootPath||!h||h.startsWith("blob:")||h.startsWith("/")||(p.userData.rootPath=h),d&&(p.userData.__sourceBlob=d,p.userData.__needsSourceBuffer&&(p.userData.__sourceBuffer=await d.arrayBuffer(),delete p.userData.__needsSourceBuffer))),(p=await this._processors.process(p.assetType,p,{})).assetImporterProcessed=!0,[p];if(p instanceof Map)return[...(await this.importFiles(p,t)).values()].flat();if(p.type){const e=this._viewer.getPluginByType(p.type);if(e){let t=p._importedResources||{};return p.resources&&(t=await(null===(c=this._viewer.getManager())||void 0===c?void 0:c.importConfigResources(p.resources)),delete p.resources,p._importedResources=t),"function"==typeof e.fromJSON&&(await Promise.resolve(e.fromJSON(p,t)),p.assetImporterProcessed=!1),[]}}else if(p.plugins)return p.resources=await(null===(u=this._viewer.getManager())||void 0===u?void 0:u.importConfigResources(p.resources)),await this._viewer.getManager().importViewerConfig(p),p.assetImporterProcessed=!1,[];return console.warn("unknown/null asset type: ",p),[p]}dispose(){var e;null===(e=this._processors)||void 0===e||e.dispose()}}function ro(e){if(!e)return i.ywz;const t=e.extensions.has("EXT_color_buffer_half_float")||e.capabilities.isWebGL2&&e.extensions.has("EXT_color_buffer_float"),r=e.capabilities.isWebGL2||e.extensions.has("OES_texture_float")||e.extensions.has("WEBGL_color_buffer_float");return t?i.cLu:r?i.VzW:i.ywz}function io(e){var t,r,i;if(!e.isLight)return e;if("light"===e.assetType)return e;if(e.uiConfig)return console.warn("ui config already exists, not supported",e),e;let n;if(e.children.length,e.isDirectionalLight&&(n=new Ys),e.isAmbientLight&&(n=new Zs),e.isSpotLight&&(n=new Ks),e.isPointLight&&(n=new Js),n){null===(r=(t=n.lightObject).copy)||void 0===r||r.call(t,e);const s=e.parent;(null===(i=s)||void 0===i?void 0:i.isObject3D)&&(s.remove(e),e.dispose(),e.userData.iModel=n,s.add(n.lightObject),n.uuid=e.uuid),Le(n.lightObject,s)}else console.warn("unknown light type: ",e);return n}to.Importers=[new lr(fr,["json"],!1),new lr(i.hH6,["txt"],!1),new lr(ai,["rgbe.png","hdr.png","hdrpng"],!1),new lr(i.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new lr(class extends $s{parse(e){const t=super.parse(e);return new eo(t)}},["cube"],!1)];class no extends i.u7G{constructor(e){super(e)}async loadAsync(e,t){var r;const n=new i.hH6(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const s=await n.loadAsync(e,t);try{const e=JSON.parse(s);if(e.images&&this.importer){const t={};let n=e.images;Array.isArray(n)||(n=Object.values(n));for(const s of e.images){if(!s.url||!s.uuid)continue;const e=null===(r=await this.importer.importPath(s.url,{processImported:!1}))||void 0===r?void 0:r[0],n=null==e?void 0:e.source;if(!e||!n)continue;const o=new i.Hw6(n.data);o.uuid=s.uuid,t[o.uuid]=o,e.dispose()}return this.parse(e,t)}return this.parse(e)}catch(t){throw console.error(t),this.manager.itemError(e),t}}parse(e,t){var r,n;let s;const o={p:new Promise(e=>{s=e})};if(e.images||e.textures){const r=new li(this.manager);let i={};const n=e=>{s(),o.p=void 0,Object.values(i).forEach(e=>{var t;e.isTexture&&(null===(t=e.image)||void 0===t?void 0:t.complete)&&(e.needsUpdate=!0)})};let a=e.images||[];Array.isArray(a)||(a=Object.values(a));const l=t||r.parseImages(a,n);let c=e.textures;Array.isArray(c)||(c=Object.values(c)),i=r.parseTextures2(c,l,n),this.setTextures(i)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const a={...e};if(Object.entries(a).forEach(([e,t])=>{t&&"string"==typeof t&&this.textures[t]&&(a[e]=this.textures[t])}),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?a.vertexColors=e.vertexColors>0:a.vertexColors=e.vertexColors),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),a.normalScale=(new i.FM8).fromArray(t)}let l=e.type;"MeshPhysicalMaterial"!==l&&"MeshStandardMaterial"!==l||(l=er.TYPE),a.userData=De(a.userData,void 0,!1,this);const c=null!==(n=null===(r=this.materials)||void 0===r?void 0:r.generateFromTemplateType(l,a))&&void 0!==n?n:super.parse(e);return this.setTextures({}),c.userData.imageLoadAwaiter=o,c}}class so extends r{constructor(e,t,{simpleCache:r=!1,storage:n}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(r||n)&&(r&&(i.CtF.enabled=!0),n&&window.Cache&&"function"==typeof window.Cache&&n instanceof window.Cache)){const e={...i.CtF};i.CtF.get=((t,r,i)=>r?t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")?Promise.resolve(void 0):n.match(t).then(e=>{if(e)switch(r){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,null!=i?i:"text/html"));case"json":return e.json();default:if(void 0===i)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(i),r=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(r);return e.arrayBuffer().then(e=>n.decode(e))}}}):e.get(t)),i.CtF.add=((t,r,i)=>{i||e.add(t,r),t.startsWith("data:")||t.startsWith("blob")||t.startsWith("chrome-extension")||n.put(t,new Response(r,{status:200}))}),i.CtF.remove=((t,r)=>{r||e.remove(t),n.delete(t)})}this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const r=await this._importer.importAsset(e,t);return r?(this.addProcessedAssets(r,t),r):(console.warn("Unable to import",e,r),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const r=await this._importer.importPath(e,t);return r?(this.addProcessedAssets(r,t),r):(console.warn("Unable to import",e,r),[])}addProcessedAssets(e,t){return e.map(e=>{var r;return null===(r=this._viewer)||void 0===r?void 0:r.scene.addSceneObject(e,t)})}async addAssetSingle(e,t={}){var r;return e?null===(r=await("string"==typeof e?this.addFromPath:this.addAsset)(e,t))||void 0===r?void 0:r[0]:void 0}async addImported(e,t={}){var r;return null===(r=this._importer)||void 0===r?void 0:r.processImported(e,t).then(e=>(this.addProcessedAssets(e,t),e))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(e=>null==e?void 0:e[0])}_sceneUpdated(e){var t;if("addSceneObject"===e.type){const r=e.object;"material"===r.assetType&&(null===(t=this._materials)||void 0===t||t.processMaterial(r,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new ar,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new to(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(e,t)=>(hr(e,e=>{var t;return null===(t=this._materials)||void 0===t?void 0:t.processModel(e,{recursive:!1})}),e)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(e,t)=>{var r;return(null===(r=this.materials)||void 0===r?void 0:r.findMaterial(e.uuid))&&(console.warn("imported material uuid already exists, creating new uuid"),e.uuid=$(),e.userData.uuid&&(e.userData.uuid=e.uuid)),this._materials.processMaterial(e,t)}})),to.Importers.push(new lr(no,[er.TypeSlug],!1,e=>(e&&(e.materials=this._materials),e&&(e.importer=this._importer),e)));const t=this.importViewerConfig.bind(this);to.Importers.push(new lr(class extends fr{async loadAsync(e,r){return t(await super.loadAsync(e,r))}},[so.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var t,r;e===this._viewer&&(null===(t=this._importer)||void 0===t||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),null===(r=this._materials)||void 0===r||r.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("AssetExporterPlugin"))||void 0===t?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,t){if(!this._viewer)return{};const r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...t},i=this._viewer.toJSON(r);return e||Object.values(r).forEach(e=>{e&&Object.values(e).forEach(e=>{e.url&&(console.log(e.url),(e.url.data instanceof ArrayBuffer||Array.isArray(e.url.data))&&("Uint16Array"===e.url.type?(e.url.data instanceof Uint16Array||(e.url.data=new Uint16Array(e.url.data)),e.url.data="data:application/octet-stream;base64,"+Rt(e.url.data.buffer)):"Uint8Array"===e.url.type?(e.url.data instanceof Uint8Array||(e.url.data=new Uint8Array(e.url.data)),e.url.data="data:application/octet-stream;base64,"+Rt(e.url.data.buffer)):e.url.data instanceof ArrayBuffer?e.url.data="data:application/octet-stream;base64,"+Rt(e.url.data.buffer):console.warn("Unsupported buffer type",e.url.type)))})}),i.resources=r,i}exportPluginPresets(e){var t;const r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:null===(t=this._viewer)||void 0===t?void 0:t.serializePlugins(r,e),resources:r}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},r=e.toJSON(t);return r.resources=t,r}async importPluginPreset(e,t){var r;const i=e.type;if(!(t=t||(null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType(i))))return void console.warn(`No plugin found for type ${i} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${i} does not support importing presets`);const n=e.resources||{};return e.resources&&delete e.resources,await t.fromJSON(e,n),n&&(e.resources=n),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const r=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,r)}applyViewerConfig(e,t){var r;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const e of Object.values(t.materials))e.__useCount?delete e.__useCount:null===(r=this._materials)||void 0===r||r.unregisterMaterial(e);for(const e of Object.values(t.textures))e.__useCount&&delete e.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,t,r){var n,s,o,a,l;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const c={};Object.values(e).forEach(e=>{e&&Object.values(e).forEach(e=>{if(!e||!e.url)return;if("string"!=typeof e.url.data)return;const t=e.url.data.match(/^data:.*;base64,(.*)$/);(null==t?void 0:t[1])?e.url.data=Lt(null==t?void 0:t[1]):("Uint8Array"!==e.url.type&&console.error("Unsupported buffer type string for ",e.url.type,"use base64"),e.url.data=(new TextEncoder).encode(e.url.data).buffer)})}),t=null!=t?t:new li(this._importer.loadingManager),c.animations=e.animations?t.parseAnimations(e.animations):{},r&&r.animations&&(c.animations={...c.animations,...r.animations}),c.shapes=e.shapes?t.parseShapes(e.shapes):{},r&&r.shapes&&(c.shapes={...c.shapes,...r.shapes}),c.geometries=e.geometries?t.parseGeometries(e.geometries,c.shapes):{},r&&r.geometries&&(c.geometries={...c.geometries,...r.geometries}),c.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},r&&r.images&&(c.images={...c.images,...r.images});for(const p of Object.values(e.textures)){const e=null===(n=null==p?void 0:p.userData)||void 0===n?void 0:n.rootPath;if(e&&(!p.image||!c.images[p.image])){const t=null===(s=await this._importer.importPath(e,{processImported:!1}))||void 0===s?void 0:s[0],r=null==t?void 0:t.source;if(!t||!r)continue;const n=new i.Hw6(r.data);p.image&&(n.uuid=p.image),c.images[n.uuid]=n,p.image=n.uuid,t.dispose()}}c.textures=e.textures?t.parseTextures2(Object.values(e.textures),c.images,()=>{Object.values(c.textures).forEach(e=>{var t;e.isTexture&&(null===(t=e.image)||void 0===t?void 0:t.complete)&&(e.needsUpdate=!0)})}):{};for(const i of Object.entries(c.textures))i[1]=null===(o=await this._importer.processImported(i[1],{}))||void 0===o?void 0:o[0],i[1]?c.textures[i[0]]=i[1]:delete c.textures[i[0]];r&&r.textures&&(c.textures={...c.textures,...r.textures});const u=e.materials?Object.values(e.materials):[];for(const i of u)Object.entries(i).forEach(([e,t])=>{t&&t.resource&&t.uuid&&"textures"===t.resource&&(i[e]=t.uuid)});if(c.materials=t.parseMaterials2(u,c.textures,this._materials),r&&r.materials&&(c.materials={...c.materials,...r.materials}),e.object&&(c.object=t.parseObject(e.object,c.geometries,c.materials,c.textures,c.animations),e.skeletons&&(c.skeletons=t.parseSkeletons(e.skeletons,c.object),t.bindSkeletons(c.object,c.skeletons))),e.extras){c.extras=e.extras;for(const t of Object.values(e.extras))if(t.uuid&&t.url)if("string"==typeof t.url){const e=await(null===(a=this._importer)||void 0===a?void 0:a.importPath(t.url));(null==e?void 0:e.length)>0&&(c.extras[t.uuid]=e[0])}else if(t.url.data){const e=new File([Nt(t.url.type,t.url.data)],t.url.path),r=await(null===(l=this._importer)||void 0===l?void 0:l.importAsset({path:e.name,file:e}));(null==r?void 0:r.length)>0&&(c.extras[t.uuid]=r[0])}else console.warn("invalid URL type while loading extra resource")}return r&&r.extras&&(c.extras={...c.extras,...r.extras}),c.__isLoadedResources=!0,c}}so.PluginType="AssetManager",so.ViewerTypeSlug="vjson";class oo extends r{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=ke(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(De(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e}),this)}}function ao(e,t,r){return{...t,get dirty(){return t.dirty||!1},set dirty(e){m(t,"dirty",e,!0)},update(){var e,i,n;this.passObject.enabled&&(null===(i=(e=this.passObject).updateShaderProperties)||void 0===i||i.call(e,x(r)),null===(n=t.update)||void 0===n||n.call(this))},onRegister(r){var i,n,s;this.passObject.materialExtension&&(null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.materials)||void 0===n||n.registerMaterialExtension(this.passObject.materialExtension)),null===(s=t.onRegister)||void 0===s||s.call(this,r)},onUnregister(r){var i,n,s;this.passObject.materialExtension&&(null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.materials)||void 0===n||n.unregisterMaterialExtension(this.passObject.materialExtension)),null===(s=t.onUnregister)||void 0===s||s.call(this,r)},dispose(){var e,r,i;null===(r=(e=this.passObject).dispose)||void 0===r||r.call(e),null===(i=t.dispose)||void 0===i||i.call(this)}}}class lo extends oo{constructor(){super(),this._enabledTemp=!0}_update(e){var t;return(null===(t=this._pass)||void 0===t?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t;return(null===(t=null===(e=this._pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)||this._enabledTemp}set enabled(e){var t;(null===(t=this._pass)||void 0===t?void 0:t.passObject)&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(t){t&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=ao(e,t),void 0!==t.passObject.onDirty&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,r;this._pass&&e.renderer.unregisterPass(this._pass),null===(r=null===(t=this._pass)||void 0===t?void 0:t.dispose)||void 0===r||r.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var t,r;const i=super.toJSON(e);if(!i.type)return i;const n=this.pass;return n&&(i.pass=ke(null!==(r=null===(t=n)||void 0===t?void 0:t.passObject)&&void 0!==r?r:n,!1,e)),i}fromJSON(e,t){var r,i;if(!super.fromJSON(e,t))return null;if(e.pass){const n=this.pass;n&&De(e.pass,null!==(i=null===(r=n)||void 0===r?void 0:r.passObject)&&void 0!==i?i:n,!1,t)}return this}}!function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ce()],lo.prototype,"enabled",null);const co=new Set,uo=new Set;class po extends Wt{constructor(e,t,r=new xe(1,1,1),i=1){super(void 0,void 0,t,r,i),this.target=e}render(e,t,r,i,n){const s=e.getRenderTarget(),o=e.getActiveCubeFace(),a=e.getActiveMipmapLevel();this.scene.traverse(({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(co.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(uo.add([e,e.transmission]),e.transmission=0))}),W(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,i,n)),co.forEach(e=>e.transparent=!e.transparent),co.clear(),uo.forEach(([e,t])=>e.transmission=t),uo.clear(),e.setRenderTarget(s,o,a)}}class ho extends lo{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var t,r;const n=(null===(t=this._viewer)||void 0===t?void 0:t.renderer.isWebGL2)&&this.renderFlagsBuffer,s=e.renderer.createTarget({depthBuffer:!0,type:i.ywz,textureCount:n?2:1});Array.isArray(s.texture)?(s.texture[0].name="gbufferDepthNormal",s.texture[1].name="gbufferFlags",this._gbufferTextures=s.texture):(s.texture.name="gbufferDepthNormal",this._gbufferTextures.push(s.texture)),this._gbufferTarget=s;const o=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("debug");return o&&(o.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&o.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),this._material=new Xt(n),new po(s,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Yt}updateShaderProperties(e){var t,r;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=null!==(t=this.getDepthNormal())&&void 0!==t?t:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=null!==(r=this.getFlagsTexture())&&void 0!==r?r:void 0;const t=e.uniforms.tGBufferFlags.value?1:0;t!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=t,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}ho.PluginType="GBuffer";class fo extends Wt{constructor(e,t=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new xe(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new qt({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:i.rnI,type:i.cLu,format:i.wk1,minFilter:i.wem,magFilter:i.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,t,r,i,n){var s;let o=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,r,i,n),this.needsSwap=o,void(e.userData.mainRenderPass=void 0);const a=e.userData;a||console.error("threejs is not patched?");const l=this._viewer.useGBufferDepth;let c;if(l){const t=null===(s=this._viewer.getPlugin(ho))||void 0===s?void 0:s.getTarget();if(t){const r=e.properties.get(t);c=r.__webglDepthRenderbuffer||r.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let u=()=>{super.render(e,void 0,r,i,n,c)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(o=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const t=e.autoClearDepth;e.autoClearDepth=!l,W(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},u),e.autoClearDepth=t}if(!l){const t=e.properties.get(r);c=t.__webglDepthRenderbuffer||t.__webglDepthbuffer}u=(()=>{super.render(e,void 0,this.transparentTarget,i,n,c)});{const t=this.clear,r=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,W(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},u),this.clear=t,e.autoClearDepth=r}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,r,i,n),o=!0);{const i=this.clear;this.clear=!1,a.transmissionRenderTarget=o?t:r,a.blurTransmissionTarget=this.blurTransmissionTarget,W(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},u),a.blurTransmissionTarget=void 0,a.transmissionRenderTarget=void 0,this.clear=i}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,r,i,n),o=!0)}}else{{const t=this.clear,r=e.autoClearDepth;e.autoClearDepth=!l,this.clear=!0,W(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},u),this.clear=t,e.autoClearDepth=r}{this._viewer.renderer.blit(r.texture,t,{clear:!0});const i=this.clear;this.clear=!1,a.transmissionRenderTarget=t,a.blurTransmissionTarget=this.blurTransmissionTarget,W(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},u),a.blurTransmissionTarget=void 0,a.transmissionRenderTarget=void 0,this.clear=i}o=!1}this._releaseTransparentTarget(),this.needsSwap=o,e.userData.mainRenderPass=void 0}}function go(e,t){return e.multiplyScalar(e.w*t),e.w=1,e}function mo(e,t){return go(e,t),new xe(e.x,e.y,e.z)}function _o(e,t){const r=Math.max(e.x,Math.max(e.y,e.z));let i=Math.max(Math.min(r/t,1),0);return i=Math.ceil(255*i)/255,e.divideScalar(i*t),e.w=i,e}function vo(e,t){return _o(new i.Ltg(e.r,e.g,e.b,1),t)}var xo=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};function Ao(e){return Object.getPrototypeOf(e).constructor.PluginType}i.Vj0.background.fragmentShader=i.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;","uniform sampler2D t2D;\nuniform float intensity;"),i.Vj0.background.fragmentShader=i.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class bo extends r{constructor({isAntialiased:t=!1,useRgbm:r=!0,useGBufferDepth:n=!1,screenShader:s="",...o}){var a;super(),this.console=console,this._state=e.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(e=>this.resize()):void 0,this._lastSize=new i.FM8,this._onContextRestore=(e=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})}),this._onContextLost=(e=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1}),this.resize=(()=>{this._needsResize=!0,this.setDirty()}),this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=(()=>{this._rawBackground===yo&&this.scene.setBackground(this.scene.getEnvironment())}),this._addSceneObject=(e=>{var t;if(!e||!e.object)return;const r=e.object.__importedViewerConfig||(null===(t=e.object.modelObject)||void 0===t?void 0:t.__importedViewerConfig);if(!r)return;const i=this.getManager();i?i.applyViewerConfig(r,r.resources):this.fromJSON(r,r.resources)}),this.alert=(async e=>alert(e)),this.confirm=(async e=>confirm(e)),this.prompt=(async(e,t,r=!0)=>prompt(e,t)),this._useRgbm=r,this._useGBufferDepth=n,this._screenShader=s,this._canvas=o.canvas||vt();let l=o.container;if(l&&!o.canvas&&l.appendChild(this._canvas),l||(l=null!==(a=this._canvas.parentElement)&&void 0!==a?a:void 0),!l)throw new Error("No container.");this._container=l,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var e;const t=window.location.href,r="https://dev-sandbox.pixotronics.com/webgi/";if(!t.startsWith(r))return!0;if(null!==Pt("noUpdate"))return!0;const i=null===(e=t.match(/\/webgi\/([0-9.a-zA-Z]+)/))||void 0===e?void 0:e[1],n=(await(await fetch(r+"version.txt")).text()).split("\n")[0];if(i&&i!==n){if(confirm(`New version ${n} is available, do you want to open?`)){const e=window.location.href.replace(i,n);return window.location.href=e,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const c=new gt(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var e,t;const r=p.scene.activeCamera;if(r&&r.interactionsEnabled){const i=null===(e=this.getPluginByType("Progressive"))||void 0===e?void 0:e.postFrameConvergedRecordingDelta();if(void 0!==i&&0===i)return;null===(t=r.controls)||void 0===t||t.update()}}),this.scene=new _t(c),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new K({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:t?4:0,encoding:r?R:i.rnI,type:r?i.ywz:i.cLu,depthBuffer:!n}}),this._isAntialiased=t&&this._renderer.isWebGL2;let u=!0;this._renderer.rendererObject.userData||(u=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!u;const p=this;this.renderFilter={passId:"render",passObject:new fo(this,u),update(){const e=this.passObject;e.scene=p.scene.modelObject,e.camera=p.scene.activeCamera.cameraObject}};const h={passId:"screen",after:["render"],required:["render"],passObject:wo(s)};[this.renderFilter,h].forEach(e=>this._renderer.registerPass(e)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",e=>this.setDirty(this.scene,e)),this.scene.addEventListener("sceneUpdate",e=>{this.setDirty(this.scene,e),!1!==e.geometryChanged&&this.renderer.resetShadows()}),this.scene.addEventListener("update",e=>this.setDirty(this.scene,e)),this._renderer.addEventListener("update",e=>this.setDirty(this._renderer,e)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",bo.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,t){this._needsReset=!0,e=null!=e?e:this,this.dispatchEvent({...null!=t?t:{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),null===(e=window.webGiViewers)||void 0===e||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:t,xrFrame:r}){var i,n;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let s=0;s<this.maxFramePerLoop;s++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const e=[this._canvas.clientWidth,this._canvas.clientHeight];if(r){const t=null===(n=null===(i=this._renderer.rendererObject.xr.getCamera())||void 0===i?void 0:i.cameras[0])||void 0===n?void 0:n.viewport;t?(0===t.x&&0===t.y||this.console.warn("x and y must be 0?"),e[0]=t.width,e[1]=t.height,this.console.log("resize for xr",e)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...e),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:r});const s=Object.values(this.plugins).filter(e=>e.dirty);s.length>0&&this.setDirty(s),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const o=this._renderer.dirty;if(o){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(e){this.console.error(e),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!o)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...t){var r;let i;const n=Ao(i=e.prototype?new e(...t):e);return n?(null===(r=i.dependencies)||void 0===r||r.forEach(e=>{this.getPlugin(e)||this.addPlugin(e)}),this.plugins[n]&&this.console.error(`Plugin of type ${n} already exists`,this.plugins[n],i),this.plugins[n]=i,await i.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:i}),this.setDirty(i),i):(this.console.error("PluginType is not defined for",i),i)}async removePlugin(e,t=!0){const r=Ao(e);this.plugins[r]&&(await e.onRemove(this),delete this.plugins[r],t&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var t;const r=null!==(t=e.userData.iCamera)&&void 0!==t?t:new gt(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return r.autoLookAtTarget=!1,r}setSize(e){this._canvas.style.width=(null==e?void 0:e.width)?e.width+"px":"100%",this._canvas.style.height=(null==e?void 0:e.height)?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,t,r,n;const s=null!==(n=null===(r=null===(t=null===(e=this._renderer)||void 0===e?void 0:e.rendererObject)||void 0===t?void 0:t.background.getPlaneMesh())||void 0===r?void 0:r.material.uniforms)&&void 0!==n?n:i.Vj0.background.uniforms;s.intensity||(s.intensity={value:1}),s.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const t=(new xe).set(e).convertSRGBToLinear();return this.setBackground(t)}setBackground(e){if(this._rawBackground=e,null!=e&&("string"==typeof e||"number"==typeof e||e.isVector4||e.isColor)){if(e===yo)return this._sceneEnvironmentChanged();const t=e.isVector4?H(e):Q(e.isColor?e:new xe(e));return t.assetType="texture",this.scene.setBackground(t)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var t,r,i;if(e)return this._rawBackground;let n=null!==(t=this._rawBackground)&&void 0!==t?t:this.scene.getBackground();return n?((null===(r=n)||void 0===r?void 0:r.isVector4)&&(n=mo(n,7).getHexString()),(null===(i=n)||void 0===i?void 0:i.isColor)?n.getHexString():this._rawBackground===yo?this.scene.getEnvironment():n):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:t=new i.Pa4(1,1,1),targetOffset:r=new i.Pa4(0,0,0),...n}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const n=e?(new k).expandByObject(e,!0,!0):this.scene.getBounds(!0),s=n.getCenter(new i.Pa4),o=.5*n.getSize(new i.Pa4).length();s.add(r.clone().multiplyScalar(o)),this.scene.activeCamera.position=new i.Pa4(s.x+t.x*o,s.y+t.y*o,s.z+t.z*o),this.scene.activeCamera.target=s,this.setDirty()}}async createObject3D(e){var t;return null===(t=this.getManager())||void 0===t?void 0:t.addImportedSingle(e||new i.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var r,i,n,s,o;if(null===(r=t)||void 0===r?void 0:r.isMaterial){const e=null===(n=null===(i=this.getManager())||void 0===i?void 0:i.materials)||void 0===n?void 0:n.findMaterial(t.uuid);if(e)return e}return null===(o=null===(s=this.getManager())||void 0===s?void 0:s.materials)||void 0===o?void 0:o.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(r=>{var i,n;if(!t||t.includes(r[1].constructor.PluginType))return!1!==r[1].serializeWithViewer?null===(n=(i=r[1]).toJSON)||void 0===n?void 0:n.call(i,e):void 0}).filter(e=>!!e)}deserializePlugins(e,t){return e.forEach(e=>{var r;if(!e.type)return void this.console.warn("Invalid plugin to import ",e);const i=this.getPluginByType(e.type);i&&(null===(r=i.fromJSON)||void 0===r||r.call(i,e,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){return Object.assign({version:bo.VERSION,plugins:this.serializePlugins(e,t)},ke(this,!0,e))}fromJSON(e,t){return De(e,this,!0,t),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,t),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if("setView"===e.type){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else"activateMain"===e.type&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}bo.VERSION="0.6.0",xo([Ce()],bo.prototype,"scene",void 0),xo([Ce("background")],bo.prototype,"_rawBackground",void 0),xo([Ce(),M(bo.prototype._backgroundIntensityChanged)],bo.prototype,"backgroundIntensity",void 0);const yo="envMapBackground";function wo(e){var t,r,i;return(null===(t=e)||void 0===t?void 0:t.isShaderPass2)?e:new Ht({...n,fragmentShader:`\n                       varying vec2 vUv;\n                       \n                       ${Array.isArray(e)?e[0]:(null===(r=e)||void 0===r?void 0:r.pars)||""}\n                       \n                       void main() {\n\n                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));\n                            \n                            ${Array.isArray(e)?e[1]:"string"==typeof e?e:(null===(i=e)||void 0===i?void 0:i.main)||""}\n                            \n                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var Eo=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let So=class extends oo{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=(e=>{var t;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const e=this._lastFsElement||(null===(t=this._viewer)||void 0===t?void 0:t.canvas);e&&(e.style.width=this._lastSize[0],e.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}}),this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(e){var t;if(this.isFullScreen())return;const r=e||(null===(t=this._viewer)||void 0===t?void 0:t.canvas);return r?(this._lastFsElement=r,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[r.style.width,r.style.height],r.style.width="100%",r.style.height="100%",r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.msRequestFullscreen?r.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(e){return this.isFullScreen()?this.exit():this.enter(e)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||void 0!==document.msFullscreenElement}};So.PluginType="FullScreenPlugin",Eo([et("Enter FullScreen")],So.prototype,"enter",null),Eo([et("Exit FullScreen")],So.prototype,"exit",null),Eo([et("Toggle FullScreen")],So.prototype,"toggle",null),So=Eo([ot("Full Screen")],So);class Co{constructor(e,t,r){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),null==e||e.addEventListener("dragover",this._onDragover,!1),null==e||e.addEventListener("drop",this._onDrop,!1),null==t||t.addEventListener("change",this._onSelect),r&&Object.entries(r).forEach(([e,t])=>t&&this.on(e,t))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(e=>e(t)),this}destroy(){const e=this._el,t=this._inputEl;null==e||e.removeEventListener("dragover",this._onDragover),null==e||e.removeEventListener("drop",this._onDrop),null==t||t.removeEventListener("change",this._onSelect)}_onDrop(e){var t,r;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const i=Array.from((null===(t=e.dataTransfer)||void 0===t?void 0:t.files)||[]),n=Array.from((null===(r=e.dataTransfer)||void 0===r?void 0:r.items)||[]);if(0!==i.length||0!==n.length)if(n.length>0){const e=n.map(e=>e.webkitGetAsEntry());this._loadNextEntry(new Map,e)}else this._emit("drop",{files:new Map(i.map(e=>(e.filePath=e.name,[e.filePath,e])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var t;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const r=[].slice.call(null!==(t=this._inputEl.files)&&void 0!==t?t:new FileList),i=new Map;r.forEach(e=>{e.filePath=e.webkitRelativePath||e.name,i.set(e.filePath,e)}),this._emit("drop",{files:i})}_loadNextEntry(e,t){const r=t.pop();if(r)if(r.isFile)r.file(i=>{i.filePath=r.fullPath,e.set(r.fullPath,i),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",r.fullPath));else if(r.isDirectory){const i=r.createReader(),n=r=>{r.length?(t=t.concat(r),i.readEntries(n)):this._loadNextEntry(e,t)};i.readEntries(n)}else console.warn("Unknown asset type: "+r.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Mo extends r{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new i.Pa4(.5,.5,3)},this.dependencies=[so],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new Co(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var t,r,i,n,s,o;if(!e)return;const a=this._viewer;if(!a)return;if(void 0!==this._allowedExtensions)for(const u of e.keys())this._allowedExtensions.includes(null!==(r=null===(t=u.split(".").pop())||void 0===t?void 0:t.toLowerCase())&&void 0!==r?r:"")||e.delete(u);if(e.size<1)return;const l=a.getPlugin(so),c={type:"drop",files:e};if(this.importerParams.autoImport){const t={allowedExtensions:this.allowedExtensions,...this.importerParams};if(c.imported=await(null===(i=l.importer)||void 0===i?void 0:i.importFiles(e,t)),this.importerParams.autoAdd){const e=null!==(o=[...null!==(s=null===(n=c.imported)||void 0===n?void 0:n.values())&&void 0!==s?s:[]].flat(2).filter(e=>!!e))&&void 0!==o?o:[];if(c.assets=l.addProcessedAssets(e,{...this.importerParams}),!t._rootSceneImported)for(const t of c.assets)t.modelObject&&t.modelObject.dispatchEvent({type:"select",value:t.modelObject})}}this.dispatchEvent(c)}promptForFile(){var e;null===(e=this._inputEl)||void 0===e||e.click()}async onDispose(e){}async onRemove(e){var t;null===(t=this._dropzone)||void 0===t||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(e=>"."+e).join(", "):"")}}Mo.PluginType="Dropzone";class To extends Ht{constructor(e){super({vertexShader:n.vertexShader,fragmentShader:w`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new i.Ltg(1,1,1,1)},weight2:{value:new i.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Io extends oo{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(t=>(t.passId||(console.warn("no id found for pass",t),t.passId=We()),e.renderer.registerPass(t,!0),[t.passId,t])))}async onRemove(e){var t;if(this._passes){for(const r of[...Object.values(this._passes)]){const i=r;e.renderer.unregisterPass(i),null===(t=null==i?void 0:i.dispose)||void 0===t||t.call(i)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var t,r;const i=super.toJSON(e);if(!i.type)return i;const n=Object.entries(this.passes);i.passes={};for(const[s,o]of n)i.passes[s]=ke(null!==(r=null===(t=o)||void 0===t?void 0:t.passObject)&&void 0!==r?r:o,!1,e);return i}fromJSON(e,t){var r,i;if(!super.fromJSON(e,t))return null;if(e.passes){const n=Object.entries(this.passes);for(const[s,o]of n)De(e.passes[s],null!==(i=null===(r=o)||void 0===r?void 0:r.passObject)&&void 0!==i?i:o,!1,t)}return this}}var ko=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const Do=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class Po extends Io{constructor(e=2*Do.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=(e=>{const t=e.object;(t.modelObject||t.lightObject)&&(t.modelObject||t.lightObject).traverse(e=>{var t;(null===(t=null==e?void 0:e.shadow)||void 0===t?void 0:t.camera)&&e.shadow.mapSize&&this.trackedJitterCameras.add([e.shadow.camera,e.shadow.mapSize])})}),this._jitterCamera=(e=>{var t;const r=e.target;if(this.jitter&&r.renderer.frameCount>2){const e=(e,t)=>{const i={...Do[r.renderer.frameCount%Do.length]};e.setViewOffset(t.width,t.height,i.x,i.y,t.width,t.height)},i=r.scene.activeCamera.cameraObject;e(i,{width:r.canvas.clientWidth*r.renderer.displayCanvasScaling,height:r.canvas.clientHeight*r.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(t=>e(...t)),this._hasSetOffset=!0,null===(t=this._viewer)||void 0===t||t.renderer.resetShadows()}}),this._resetCameraJitter=(e=>{const t=e.target;this._hasSetOffset&&(t.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)}),this.uiConfig=st("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[ao(e,{passId:"progressive",get dirty(){var e;return t.jitter&&((null===(e=t._viewer)||void 0===e?void 0:e.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends To{render(r,i,n,s,o){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((null==n?void 0:n.texture)&&e.renderer.blit(n.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(r,i,n,s,o),e.renderer.blit(i.texture,t.lastFrame,{})}},update(){if(!t.lastFrame)return void console.error("lastFrame render target undefined");let r=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(r,r,r,r),r=1-r,this.passObject.weights2.set(r,r,r,r),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return((null===(t=this._viewer)||void 0===t?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t,r;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=null!==(r=null===(t=this.lastFrame)||void 0===t?void 0:t.texture)&&void 0!==r?r:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}Po.PluginType="Progressive",ko([Ce(),tt("Frame count")],Po.prototype,"maxFrameCount",void 0),ko([Ce(),Ye("Jitter")],Po.prototype,"jitter",void 0);var Bo="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Ro="#ifndef BASIC_CAMERA_HELPERS\n#define BASIC_CAMERA_HELPERS \nuniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;\n#ifndef THREE_PACKING_INCLUDED\n#define THREE_PACKING_INCLUDED \n#include <packing>\n#endif\nfloat linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}\n#endif\n",Lo="#ifndef BASIC_HELPERS\n#define BASIC_HELPERS \nfloat saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}\n#endif\n",Oo="#ifndef BASIC_RANDOM_HELPERS\n#define BASIC_RANDOM_HELPERS \nuniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}\n#endif\n",Fo="#define PI  3.141592653589793\nmat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}",Uo="#ifndef SSRT_PARS_SNIP\n#define SSRT_PARS_SNIP \n#define pow2(a)a*a\nfloat getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}\n#define LOD_DEPTH  1.0\n#define LOD_COLOR  5.0\nvoid _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;\n#pragma unroll_loop_start\nfor(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}\n#pragma unroll_loop_end\n}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}\n#endif\n",No="uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;\n#ifndef D_sceneBoundingRadius\n#define D_sceneBoundingRadius \nuniform float sceneBoundingRadius;\n#endif\nvec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}",jo="#ifndef SIMPLE_CAMERA_HELPERS\n#define SIMPLE_CAMERA_HELPERS \n#ifndef USE_TRANSMISSION\nuniform mat4 projectionMatrix;\n#endif\nvec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}\n#endif\n",Go=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let zo=class extends Ht{constructor(e,t,r,n=!0){super({vertexShader:Bo,fragmentShader:`\n\nvarying vec2 vUv;\n\n${Lo}\n${Ro}\n${Oo}\n${Fo}\n${r}\n\n${Uo}\n\n${No}\n\nuniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}\n#include <encodings_fragment>\n}\n\n\n            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new i.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new i.yGw},cameraPositionWorld:{value:new i.Pa4},cameraNearFar:{value:new i.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:n?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(e,t,r)=>{if(!e.defines.SSR_ENABLED)return;const i="#glMarker beforeModulation";e.fragmentShader=e.fragmentShader.replace(i,`\n\n            \n            #if defined(SSR_ENABLED) && SSR_ENABLED > 0\nvec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;\n#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0\nalphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);\n#endif\n#ifdef USE_TRANSMISSION\nalphaModifier*=1.-transmission;\n#endif\nfloat vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){\n#if defined(SSR_INLINE) && SSR_INLINE > 0\nssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);\n#else\nssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));\n#endif \n}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);\n#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0\ndiffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);\n#else\nreflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);\n#endif\n#endif\n\n            \n            // reflectedLight.directDiffuse = vec3(0.);\n            // reflectedLight.indirectDiffuse = vec3(0.);\n            // reflectedLight.directSpecular = vec3(0.);\n            // reflectedLight.indirectSpecular = vec3(0.);\n            \n            \n${i}`)},onObjectRender:(e,t,r)=>{var i,n,s,o;let a=this.enabled&&!1!==r.userData.screenSpaceRendering&&!(null===(i=t.materialObject.userData)||void 0===i?void 0:i.ssreflDisabled)?1:0;t.materialObject.defines.SSR_ENABLED!==a&&(t.materialObject.defines.SSR_ENABLED=a,t.materialObject.needsUpdate=!0),a=this.material.defines.SSR_STEP_COUNT,t.materialObject.defines.SSR_STEP_COUNT!==a&&(t.materialObject.defines.SSR_STEP_COUNT=a,t.materialObject.needsUpdate=!0),a=this.material.defines.SSR_LOW_QUALITY_FRAMES,t.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==a&&(t.materialObject.defines.SSR_LOW_QUALITY_FRAMES=a,t.materialObject.needsUpdate=!0),a=this.material.defines.PERSPECTIVE_CAMERA,t.materialObject.defines.PERSPECTIVE_CAMERA!==a&&(t.materialObject.defines.PERSPECTIVE_CAMERA=a,t.materialObject.needsUpdate=!0),a=this.material.defines.SSR_INLINE,t.materialObject.defines.SSR_INLINE!==a&&(t.materialObject.defines.SSR_INLINE=a,t.materialObject.needsUpdate=!0),a=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,t.materialObject.defines.SSR_MASK_FRONT_RAYS!==a&&(t.materialObject.defines.SSR_MASK_FRONT_RAYS=a,t.materialObject.needsUpdate=!0),a=(null===(n=t.materialObject.userData)||void 0===n?void 0:n.ssreflNonPhysical)?"1":"0",t.materialObject.defines.SSR_NON_PHYSICAL!==a&&(t.materialObject.defines.SSR_NON_PHYSICAL=a,t.materialObject.needsUpdate=!0),a=null!==(o=null===(s=this._target)||void 0===s?void 0:s.texture)&&void 0!==o?o:null,this.materialExtension.extraUniforms.tSSRMap.value!==a&&(this.materialExtension.extraUniforms.tSSRMap.value=a,t.materialObject.needsUpdate=!0)},parsFragmentSnippet:e=>{var t;return"\nuniform float ssrPower;\nuniform float ssrIntensity;\nuniform float ssrMaskFrontFactor;\nuniform vec3 ssrBoost;\nuniform sampler2D tSSRMap;\nuniform sampler2D tLastFrame;\n"+U("tSSRMap",null===(t=this._target)||void 0===t?void 0:t.texture,e.capabilities.isWebGL2)+U("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,e.capabilities.isWebGL2)+(this._inline?`\n#if 1\n// #if SSR_INLINE\n    ${Lo}\n    \n    #define THREE_PACKING_INCLUDED\n    ${Ro}\n    \n    ${Oo}\n    ${Fo}\n    ${Yt}\n    \n    ${Uo}\n    \n    ${No}\n// #endif // SSR_INLINE\n#endif\n`:"")+`\n\n${jo}\n\n        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:e=>{var t,r;return this.enabled?"1":"0"+(null===(r=null===(t=this._target)||void 0===t?void 0:t.texture)||void 0===r?void 0:r.encoding)},isCompatible:e=>{var t;return!(null===(t=e.materialObject.userData)||void 0===t?void 0:t.ssreflDisabled)&&e.isMeshStandardMaterial2}},this.intensity=1,this.boost=new i.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=e,this._target=t,this.needsSwap=!1,this._inline=n}render(e,t,r,i,n){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,r,i,n),this.needsSwap=!1}}};Go([Je("Intensity",[0,4]),Ce(),z()],zo.prototype,"intensity",void 0),Go([Ze("Boost"),Ce(),z()],zo.prototype,"boost",void 0),Go([Je("Object Radius",[.01,2]),Ce(),z()],zo.prototype,"objectRadius",void 0),Go([Ye("Auto radius"),Ce(),z()],zo.prototype,"autoRadius",void 0),Go([Je("Power",[0,3]),Ce(),z()],zo.prototype,"power",void 0),Go([Je("Tolerance",[.1,5]),Ce(),z()],zo.prototype,"tolerance",void 0),Go([Je("Step count",[1,32],1),Ce(),V("SSR_STEP_COUNT")],zo.prototype,"stepCount",void 0),Go([Je("Low Quality Frames",[0,4],1),Ce(),V("SSR_LOW_QUALITY_FRAMES")],zo.prototype,"lowQualityFrames",void 0),Go([Ye("Ignore front rays"),Ce(),V("SSR_MASK_FRONT_RAYS")],zo.prototype,"maskFrontRays",void 0),Go([Je("Mask front rays factor",[-1,1],.01,e=>({hidden:()=>!e.maskFrontRays})),Ce(),z()],zo.prototype,"maskFrontFactor",void 0),zo=Go([ot("Screen Space Reflections")],zo);class Vo extends Io{constructor(){super(),this.dependencies=[so,ho,Po],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,t;return(null===(t=null===(e=this.passes.ssr)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)||!1}set enabled(e){var t;(null===(t=this.passes.ssr)||void 0===t?void 0:t.passObject)&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,r;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),null===(r=(t=this.uiConfig).uiRefresh)||void 0===r||r.call(t,"postFrame",!0)}createPasses(e){var t,r;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[ao(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new zo(e.renderer,this._ssrTarget,null!==(r=null===(t=e.getPlugin(ho))||void 0===t?void 0:t.getUnpackSnippet())&&void 0!==r?r:"",this.inlineSSR)},()=>[e.getPlugin(ho),e.getPlugin(Po),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get uiConfig(){var e,t,r,i,n;const s=null!==(r=null===(t=null===(e=this.passes.ssr)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig)&&void 0!==r?r:{};return null===(n=null===(i=s.children)||void 0===i?void 0:i.map(e=>x(e)))||void 0===n||n.flat(2).forEach(e=>e&&(e.onChange=this.setDirty)),s}}Vo.PluginType="SSReflection";var Qo=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class Ho extends Ht{constructor(e,t,r="rgba"){super({vertexShader:n.vertexShader,fragmentShader:t+"uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;\n#pragma unroll_loop_start\nfor(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}\n#pragma unroll_loop_end\nfinal_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}",uniforms:{bilDirection:{value:new i.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new i.FM8}},defines:{B_SRC_ACCESSOR:r}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,r,i,n){var s,o,a,l;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set((null===(s=this.uniforms.tDiffuse.value)||void 0===s?void 0:s.image.width)||0,(null===(o=this.uniforms.tDiffuse.value)||void 0===o?void 0:o.image.height)||0),super.render(e,t,this._target,i,n),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set((null===(a=this.uniforms.tDiffuse.value)||void 0===a?void 0:a.image.width)||0,(null===(l=this.uniforms.tDiffuse.value)||void 0===l?void 0:l.image.height)||0),super.render(e,this._target,t,i,n))}}Qo([Ce(),z()],Ho.prototype,"smoothEnabled",void 0),Qo([Ce(),z()],Ho.prototype,"edgeSharpness",void 0);var Wo=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class qo extends Ht{constructor(e,t,r){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new i.FM8(512,512)},saoData:{value:new i.Ltg},frameCount:{value:0},cameraNearFar:{value:new i.FM8(.1,1e3)},projection:{value:new i.yGw},saoBiasEpsilon:{value:new i.Pa4(1,1,1)}},vertexShader:Bo,fragmentShader:`\n\n${Oo}\n\n${r}\n\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){\n#if PERSPECTIVE_CAMERA == 1\nreturn perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);\n#endif\n}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;\n#if DEPTH_PACKING_MODE == 2\nuncodedDepth=texture2D(tNormalDepth,uv);\n#else\nuncodedDepth=texture2D(tDepth,uv);\n#endif\n#if DEPTH_PACKING_MODE == 0\nreturn uncodedDepth.x;\n#elif DEPTH_PACKING_MODE == 1\n#if LINEAR_DEPTH == 1\nreturn pow2(unpackRGBAToDepth(uncodedDepth));\n#else\nreturn unpackRGBAToDepth(uncodedDepth);\n#endif\n#else\nreturn pow2(unpack16(uncodedDepth.xy));\n#endif\n}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);\n#if LINEAR_DEPTH == 0\nfloat centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);\n#else\nd=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);\n#endif\n}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);\n#if LINEAR_DEPTH == 0\nfloat centerViewZ=getViewZFromNDCZ(centerDepth);\n#else\nfloat centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);\n#endif\nvec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#if NUM_SAMPLES > 1\nsum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 2\nsum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 3\nsum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 4\nsum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 5\nsum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 6\nsum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 7\nsum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 8\nsum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 9\nsum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\n#if NUM_SAMPLES > 10\nsum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);\n#endif\nfloat aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}\n\n            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(e,t,r)=>{e.defines.SSAO_ENABLED&&(e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>","#ifndef USE_TRANSMISSION\n#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0\nfloat ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined( USE_ENVMAP )\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);\n#endif\n#endif\n#endif\n"))},onObjectRender:(e,t,r)=>{var i,n;this.materialExtension.extraUniforms.tSSAOMap.value=null===(i=this._target)||void 0===i?void 0:i.texture;const s=t.materialObject,o=!s.transparent&&s.transmission<.001;let a=this.enabled&&o&&!1!==r.userData.screenSpaceRendering&&!(null===(n=t.materialObject.userData)||void 0===n?void 0:n.ssaoDisabled)?1:0;s.defines.SSAO_ENABLED!==a&&(s.defines.SSAO_ENABLED=a,s.needsUpdate=!0),a=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==a&&(this.materialExtension.extraUniforms.tSSAOMap.value=a,s.needsUpdate=!0)},parsFragmentSnippet:e=>{var t;return w`
             uniform sampler2D tSSAOMap;
             ${U("tSSAOMap",null===(t=this._target)||void 0===t?void 0:t.texture,e.capabilities.isWebGL2)}
            ${jo}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:e=>{var t,r;return this.enabled?"1":"0"+(null===(r=null===(t=this._target)||void 0===t?void 0:t.texture)||void 0===r?void 0:r.encoding)},isCompatible:e=>{var t;return!(null===(t=e.materialObject.userData)||void 0===t?void 0:t.ssaoDisabled)&&e.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new Ho(this._target,r,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,r,i,n){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,r,i,n),this._smoothEnabled&&this.bilateralPass.render(e,t,r,i,n))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}Wo([Ce()],qo.prototype,"bilateralPass",void 0),Wo([Ce()],qo.prototype,"parameters",void 0);class Xo extends Io{constructor(){super(),this.dependencies=[so,ho],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var t,r;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[ao(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new qo(e.renderer,this._aoTarget,null!==(r=null===(t=e.getPlugin(ho))||void 0===t?void 0:t.getUnpackSnippet())&&void 0!==r?r:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ho)])}},()=>[e.getPlugin(ho),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get enabled(){var e,t;return(null===(t=null===(e=this.passes.ssao)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)||!1}set enabled(e){var t;(null===(t=this.passes.ssao)||void 0===t?void 0:t.passObject)&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const t=this,r=t.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[r,"enabled"],onChange:t.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[r.parameters,"intensity"],onChange:t.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[r.parameters,"occlusionWorldRadius"],onChange:t.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[r.parameters,"bias"],onChange:t.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[r.parameters,"falloff"],onChange:t.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[null===(e=r.material)||void 0===e?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>r.material.needsUpdate=!0,t.setDirty]},{type:"checkbox",property:[r.bilateralPass,"smoothEnabled"],onChange:t.setDirty},{type:"vec4",property:[r.bilateralPass,"edgeSharpness"],onChange:t.setDirty}]}}}Xo.PluginType="SSAO";class Yo{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new i.xsS,this._mesh=new i.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new Ko}dispose(){this._mesh.material.dispose()}captureNormalMap(e,t,r=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const n=null==t?void 0:t.split(";").find(e=>this._normalsCache[e]);if(n){const i=this._normalsCache[n];return null==t||t.split(";").forEach(e=>e!==n&&(this._normalsCache[e]=i)),i.width!==r&&console.warn("last cacheKey normalMapRes mismatch, check model",r),e.userData._normalsCaptureMap=i,!1}const s=this._renderer.createTargetCustom({width:r,height:r},{minFilter:i.TyD,magFilter:i.TyD,generateMipmaps:!1,type:i.cLu},i.oAp);if(!s)throw"Unable to create render target";null==t||t.split(";").forEach(e=>this._normalsCache[e]=s),s.addEventListener("dispose",()=>delete this._normalsCache[t]);const o=new i._am(1e-4,100,s);this._scene.add(o);const a=e.userData._normalsCaptureOffsets;return void 0!==a.center&&this._mesh.material.uniforms.offsetCenter.value.copy(a.center),void 0!==a.offsetMatrixInv&&this._mesh.material.uniforms.offsetMatrixInv.value.copy(a.offsetMatrixInv),void 0!==a.radius&&(this._mesh.material.uniforms.radius.value=a.radius),this._mesh.geometry=e,o.update(this._renderer.rendererObject,this._scene),this._scene.remove(o),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=s,!0}}class Ko extends i.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:i.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:(new i.yGw).identity()},offsetCenter:{value:new i.Pa4}}})}}var Jo=__webpackgi_require__(654);function Zo(e){const t=new i.Pa4(0,0,0),r=new i.Pa4(0,0,0),n=new i.Pa4(0,0,0),s=new i.Pa4(0,0,0),o=e.getAttribute("position"),a=e.index;if(a)for(let i=Math.max(0,e.drawRange.start),d=Math.min(a.count,e.drawRange.start+e.drawRange.count)-1;i<d/3;i+=3){const e=a.getX(i),l=a.getX(i+1),c=a.getX(i+2);r.set(o.getX(e),o.getY(e),o.getZ(e)),n.set(o.getX(l),o.getY(l),o.getZ(l)),s.set(o.getX(c),o.getY(c),o.getZ(c)),n.sub(r),s.sub(r),s.cross(n),s.normalize(),t.add(s)}else for(let i=0;i<o.count;i+=3)r.set(o.getX(i),o.getY(i),o.getZ(i)),n.set(o.getX(i+1),o.getY(i+1),o.getZ(i+1)),s.set(o.getX(i+2),o.getY(i+2),o.getZ(i+2)),n.sub(r),s.sub(r),s.cross(n),s.normalize(),t.add(s);t.normalize();let l=!1,c=0;for(;!l;){const e=c/3,i=a?a.getX(e):e,s=a?a.getX(e+1):e+1;r.set(o.getX(i),o.getY(i),o.getZ(i)),n.set(o.getX(s),o.getY(s),o.getZ(s)),r.sub(n),r.normalize();const u=t.dot(r);Math.abs(u-1)>.001&&r.length()>.5&&(l=!0),c+=3}n.crossVectors(r,t),n.normalize(),r.crossVectors(t,n),r.normalize();const u=new i.yGw;u.elements[0]=r.x,u.elements[1]=r.y,u.elements[2]=r.z,u.elements[3]=0,u.elements[4]=t.x,u.elements[5]=t.y,u.elements[6]=t.z,u.elements[7]=0,u.elements[8]=n.x,u.elements[9]=n.y,u.elements[10]=n.z,u.elements[11]=0,u.elements[12]=0,u.elements[13]=0,u.elements[14]=0,u.elements[15]=1,e.computeBoundingSphere();const p=e.boundingSphere.radius,h=(new i.yGw).makeScale(p,p,p);return u.multiply(h),u}function $o(e){const t=e.getAttribute("position");if(t.count>0)return Zo(e);const r=new i.Pa4(0,0,0),n=new i.Pa4(0,0,0),s=new i.Pa4(0,0,0),o=e.index,a=[];if(o)for(let i=Math.max(0,e.drawRange.start),h=Math.min(o.count,e.drawRange.start+e.drawRange.count)-1;i<h/3;i+=3){const e=o.getX(i),l=o.getX(i+1),c=o.getX(i+2);r.set(t.getX(e),t.getY(e),t.getZ(e)),n.set(t.getX(l),t.getY(l),t.getZ(l)),s.set(t.getX(c),t.getY(c),t.getZ(c)),a.push(r.toArray(),n.toArray(),s.toArray())}else for(let i=0;i<t.count;i++)r.set(t.getX(i),t.getY(i),t.getZ(i)),a.push(r.toArray());const l=(0,Jo.getEigenVectors)(a),c=new i.yGw;c.elements[0]=l[0].vector[0],c.elements[1]=l[0].vector[1],c.elements[2]=l[0].vector[2],c.elements[3]=0,c.elements[4]=l[1].vector[0],c.elements[5]=l[1].vector[1],c.elements[6]=l[1].vector[2],c.elements[7]=0,c.elements[8]=l[2].vector[0],c.elements[9]=l[2].vector[1],c.elements[10]=l[2].vector[2],c.elements[11]=0,c.elements[12]=0,c.elements[13]=0,c.elements[14]=0,c.elements[15]=1,console.log(c.determinant()),e.computeBoundingSphere();const u=e.boundingSphere.radius,p=(new i.yGw).makeScale(u,u,u);return c.multiply(p),c}const ea={...Kt,color:new xe(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new i.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var ta=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class ra extends i.jyz{constructor(e){var t;super({side:i.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:"#ifndef USE_ENVMAP\n#define USE_ENVMAP  \n#endif\nvarying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;\n#include <begin_vertex>\n#include <project_vertex>\n#include <worldpos_vertex>\nvWorldPosition=worldPosition.xyz;}",fragmentShader:"varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;\n#if ENV_MAP_TYPE == 0\nuniform samplerCube envMap;\n#elif ENV_MAP_TYPE == 1\nuniform sampler2D envMap;\n#endif\nuniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){\n#if !defined(USE_ENVMAP)\nreturn vec4(direction,1);\n#else\nfloat cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;\n#if ENV_MAP_TYPE == 0\nreturn(textureCube(envMap,direction));\n#elif ENV_MAP_TYPE == 1\nreturn(texture2D(envMap,cartesianToPolar(direction)));\n#endif\nreturn vec4(1,0,1,1);\n#endif\n}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);\n#if DIA_ORIENT_ENVMAP < 1\ndir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;\n#endif\noutColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);\n#include <encodings_fragment>\n}",uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new i.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new i.Pa4(1,1,1)}}}),this.typeSlug=ra.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new xe(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new i.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:(new i.yGw).identity()},radius:{value:1},centerOffset:{value:new i.Pa4(0,0,0)},offsetMatrix:{value:(new i.yGw).identity()},offsetMatrixInv:{value:(new i.yGw).identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=(e=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(e)}),this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=jt.RegisterExtensions(this,null!==(t=null==e?void 0:e.customMaterialExtensions)&&void 0!==t?t:[])}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,r,i,n){var s,o;super.onBeforeRender(e,t,r,i,n),this.uniforms.envMapRotation.value=(null===(s=this.envMap)||void 0===s?void 0:s.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(n.matrixWorld).invert();const a=i.userData._normalsCaptureOffsets;a&&(this.extraUniformsToUpload.centerOffset.value.copy(a.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(a.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(a.offsetMatrixInv),this.extraUniformsToUpload.radius.value=a.radius);const l=null===(o=i.userData._normalsCaptureMap)||void 0===o?void 0:o.texture;this.normalsCaptureMap!==l&&(this.normalsCaptureMap=l),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:r,geometry:i,object:n})}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...jt.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){jt.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+jt.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var t,r;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),null===(r=null===(t=this._uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===r||r.call(t,"postFrame",!0,1)}set envMap(e){var t;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,(null===(t=this.__envMap)||void 0===t?void 0:t.isCubeTexture)?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const t={};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=ra.TYPE,t.userData={},ye(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...nt(this),{type:"input",label:"Mesh count",get value(){var t,r,i;return null!==(i=null===(r=null===(t=e.userData)||void 0===t?void 0:t.__appliedMeshes)||void 0===r?void 0:r.size)&&void 0!==i?i:0},set value(e){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(e){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>0===this.transmission,get value(){return!0===e.userData.renderToDepth},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{At(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return null===(t=e.getUiConfig)||void 0===t?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==ra.TYPE)return console.warn("Material type is not supported",e),this;const t={};A(e,t,Array.from(Object.keys(ea)));const r=t.userData;return delete t.userData,this.setValues(t),ye(this.userData,r),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}ra.TypeSlug="dmat",ra.TYPE="DiamondMaterial",ta([rt("Color",{limitedUi:!0}),z()],ra.prototype,"color",void 0),ta([Je("Env Intensity",[0,5],.01,{limitedUi:!0}),z()],ra.prototype,"envMapIntensity",void 0),ta([Je("Dispersion",[0,.1],1e-4,{limitedUi:!0}),z({propKey:"rIndexDelta"})],ra.prototype,"dispersion",void 0),ta([Je("Absorption",[0,15],.01,{limitedUi:!0}),z()],ra.prototype,"absorptionFactor",void 0),ta([Je("Refractive Index",[0,4],.01,{limitedUi:!0}),z()],ra.prototype,"refractiveIndex",void 0),ta([z()],ra.prototype,"squashFactor",void 0),ta([z()],ra.prototype,"geometryFactor",void 0),ta([z()],ra.prototype,"gammaFactor",void 0),ta([Ze("RGB Boost",void 0,void 0,{limitedUi:!0}),z()],ra.prototype,"boostFactors",void 0),ta([Je("Transmission",[0,1],.01,{limitedUi:!0}),z()],ra.prototype,"transmission",void 0),ta([Je("Reflectivity",[0,2],.01,{limitedUi:!0}),z()],ra.prototype,"reflectivity",void 0),ta([V("RAY_BOUNCES",void 0,!0),Je("Ray Bounces",[1,16],1)],ra.prototype,"rayBounces",void 0),ta([V("DIA_ORIENT_ENVMAP",void 0,!0),Je("Diamond Oriented Lighting",[0,1],1)],ra.prototype,"diamondOrientedEnvMap",void 0),ta([z({propKey:"tCubeMapNormals"})],ra.prototype,"normalsCaptureMap",void 0);class ia extends r{constructor(e,t,r,n){super(),this._scene=e,this._camera=null!=r?r:this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=null!=n?n:e=>!1!==e.userData.userSelectable&&!1!==e.userData.bboxVisible&&null!=e.material&&"ShadowMaterial"!==e.material.type,this.raycaster=new i.iMs,this.mouse=new i.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",e=>this.onPointerMove(e)),this.domElement.addEventListener("pointerleave",e=>this.onPointerLeave(e)),this.domElement.addEventListener("pointerout",e=>this.onPointerLeave(e)),this.domElement.addEventListener("pointercancel",e=>this.onPointerCancel(e)),this.domElement.addEventListener("pointerenter",e=>this.onPointerEnter(e)),this.domElement.addEventListener("pointerdown",e=>this.onPointerDown(e)),this.domElement.addEventListener("pointerup",e=>this.onPointerUp(e))}get scene(){return this._scene}set scene(e){var t;null===(t=this._scene)||void 0===t||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){1===this._selected.length&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=kt(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){!1!==e.isPrimary&&this.updateMouseFromEvent(e)}onPointerLeave(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){!1!==e.isPrimary&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(!1===e.isPrimary)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(null==t?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var e;const t=null===(e=this._camera)||void 0===e?void 0:e.cameraObject;if(!t)return null;this.raycaster.setFromCamera(this.mouse,t);let r=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const i=[],n=r.filter(e=>!i.includes(e.object.id)&&(i.push(e.object.id),!0));let s,o=null;if((r=n).length>0){if(o=r[0].object,s=r[0],this._firstHit&&o.id!==this._firstHit.id)o=s.object;else for(let e=0;e<r.length;e++)if(this.selectedObject&&this.selectedObject.id===r[e].object.id){const t=e+1;if(!(t<r.length))return null;o=(s=r[t]).object}this._firstHit=r[0].object}if(o&&s){for(;!(null==o||o.visible&&this.selectionCondition(o));)o=o.parent;return o?{selectedObject:o,intersect:s,intersects:r,mouse:this.mouse.toArray()}:null}return null}refreshOutlinePass(){var e;null!==(e=this.hoverObject)&&void 0!==e||this.selectedObject}isHovering(){return null!=this.hoverObject}isSelected(){return null!=this.selectedObject}}const na=new i.iMs,sa=new i.Pa4,oa=new i.Pa4,aa=new i._fP,la={X:new i.Pa4(1,0,0),Y:new i.Pa4(0,1,0),Z:new i.Pa4(0,0,1)},ca={type:"change"},ua={type:"mouseDown"},pa={type:"mouseUp",mode:null},ha={type:"objectChange"};class da extends i.Tme{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const r=new Ia;this._gizmo=r,this.add(r);const n=new ka;this._plane=n,this.add(n);const s=this;function o(e,t){let i=t;Object.defineProperty(s,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,n[e]=t,r[e]=t,s.dispatchEvent({type:e+"-changed",value:t}),s.dispatchEvent(ca))}}),s[e]=t,n[e]=t,r[e]=t}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new i.Pa4,l=new i.Pa4,c=new i._fP,u=new i._fP,p=new i.Pa4,h=new i._fP,d=new i.Pa4,f=new i.Pa4,g=new i.Pa4,m=new i.Pa4;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",p),o("cameraQuaternion",h),o("pointStart",d),o("pointEnd",f),o("rotationAxis",g),o("rotationAngle",0),o("eye",m),this._offset=new i.Pa4,this._startNorm=new i.Pa4,this._endNorm=new i.Pa4,this._cameraScale=new i.Pa4,this._parentPosition=new i.Pa4,this._parentQuaternion=new i._fP,this._parentQuaternionInv=new i._fP,this._parentScale=new i.Pa4,this._worldScaleStart=new i.Pa4,this._worldQuaternionInv=new i._fP,this._worldScale=new i.Pa4,this._positionStart=new i.Pa4,this._quaternionStart=new i._fP,this._scaleStart=new i.Pa4,this._getPointer=function(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}.bind(this),this._onPointerDown=function(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}.bind(this),this._onPointerHover=function(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}.bind(this),this._onPointerMove=function(e){this.enabled&&this.pointerMove(this._getPointer(e))}.bind(this),this._onPointerUp=function(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;na.setFromCamera(e,this.camera);const t=fa(this._gizmo.picker[this.mode],na);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){na.setFromCamera(e,this.camera);const t=fa(this._plane,na,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,ua.mode=this.mode,this.dispatchEvent(ua)}}pointerMove(e){const t=this.axis,r=this.mode,i=this.object;let n=this.space;if("scale"===r?n="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(n="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;na.setFromCamera(e,this.camera);const s=fa(this._plane,na,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===r)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===n&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===n&&(i.position.applyQuaternion(aa.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===n&&(i.parent&&i.position.add(sa.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(sa.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),oa.set(e,e,e)}else sa.copy(this.pointStart),oa.copy(this.pointEnd),sa.applyQuaternion(this._worldQuaternionInv),oa.applyQuaternion(this._worldQuaternionInv),oa.divide(sa),-1===t.search("X")&&(oa.x=1),-1===t.search("Y")&&(oa.y=1),-1===t.search("Z")&&(oa.z=1);i.scale.copy(this._scaleStart).multiply(oa),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(sa.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(sa.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(la[t]),sa.copy(la[t]),"local"===n&&sa.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(sa.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===n&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(aa.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(aa.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ca),this.dispatchEvent(ha)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(pa.mode=this.mode,this.dispatchEvent(pa)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ca),this.dispatchEvent(ha),this.pointStart.copy(this.pointEnd))}getRaycaster(){return na}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function fa(e,t,r){const i=t.intersectObject(e,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||r)return i[n];return!1}const ga=new i.USm,ma=new i.Pa4(0,1,0),_a=new i.Pa4(0,0,0),va=new i.yGw,xa=new i._fP,Aa=new i._fP,ba=new i.Pa4,ya=new i.yGw,wa=new i.Pa4(1,0,0),Ea=new i.Pa4(0,1,0),Sa=new i.Pa4(0,0,1),Ca=new i.Pa4,Ma=new i.Pa4,Ta=new i.Pa4;class Ia extends i.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new i.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new i.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const n=t.clone();n.opacity=.5;const s=e.clone();s.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const p=e.clone();p.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25,e.clone().color.setHex(16776960);const d=e.clone();d.color.setHex(7895160);const f=new i.fHI(0,.04,.1,12);f.translate(0,.05,0);const g=new i.DvJ(.08,.08,.08);g.translate(0,.04,0);const m=new i.u9r;m.setAttribute("position",new i.a$l([0,0,0,1,0,0],3));const _=new i.fHI(.0075,.0075,.5,3);function v(e,t){const r=new i.XvJ(e,.0075,3,64,t*Math.PI*2);return r.rotateY(Math.PI/2),r.rotateX(Math.PI/2),r}_.translate(0,.25,0);const x={X:[[new i.Kj0(f,s),[.5,0,0],[0,0,-Math.PI/2]],[new i.Kj0(f,s),[-.5,0,0],[0,0,Math.PI/2]],[new i.Kj0(_,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new i.Kj0(f,o),[0,.5,0]],[new i.Kj0(f,o),[0,-.5,0],[Math.PI,0,0]],[new i.Kj0(_,o)]],Z:[[new i.Kj0(f,a),[0,0,.5],[Math.PI/2,0,0]],[new i.Kj0(f,a),[0,0,-.5],[-Math.PI/2,0,0]],[new i.Kj0(_,a),null,[Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.pQR(.1,0),p.clone()),[0,0,0]]],XY:[[new i.Kj0(new i.DvJ(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},A={X:[[new i.Kj0(new i.fHI(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new i.Kj0(new i.fHI(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,.3,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.pQR(.2,0),r)]],XY:[[new i.Kj0(new i.DvJ(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},b={START:[[new i.Kj0(new i.pQR(.01,2),n),null,null,null,"helper"]],END:[[new i.Kj0(new i.pQR(.01,2),n),null,null,null,"helper"]],DELTA:[[new i.x12(function(){const e=new i.u9r;return e.setAttribute("position",new i.a$l([0,0,0,1,1,1],3)),e}(),n),null,null,null,"helper"]],X:[[new i.x12(m,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.x12(m,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.x12(m,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},y={XYZE:[[new i.Kj0(v(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new i.Kj0(v(.5,.5),s)]],Y:[[new i.Kj0(v(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new i.Kj0(v(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new i.Kj0(v(.75,1),h),null,[0,Math.PI/2,0]]]},w={AXIS:[[new i.x12(m,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new i.Kj0(new i.xo$(.25,10,8),r)]],X:[[new i.Kj0(new i.XvJ(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new i.Kj0(new i.XvJ(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new i.Kj0(new i.XvJ(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new i.Kj0(new i.XvJ(.75,.1,2,24),r)]]},S={X:[[new i.Kj0(g,s),[.5,0,0],[0,0,-Math.PI/2]],[new i.Kj0(_,s),[0,0,0],[0,0,-Math.PI/2]],[new i.Kj0(g,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new i.Kj0(g,o),[0,.5,0]],[new i.Kj0(_,o)],[new i.Kj0(g,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new i.Kj0(g,a),[0,0,.5],[Math.PI/2,0,0]],[new i.Kj0(_,a),[0,0,0],[Math.PI/2,0,0]],[new i.Kj0(g,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new i.Kj0(new i.DvJ(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.DvJ(.1,.1,.1),p.clone())]]},C={X:[[new i.Kj0(new i.fHI(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new i.Kj0(new i.fHI(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,.3,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new i.Kj0(new i.fHI(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new i.Kj0(new i.DvJ(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new i.Kj0(new i.DvJ(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new i.Kj0(new i.DvJ(.2,.2,.2),r),[0,0,0]]]},M={X:[[new i.x12(m,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new i.x12(m,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new i.x12(m,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function T(e){const t=new i.Tme;for(const r in e)for(let i=e[r].length;i--;){const n=e[r][i][0].clone(),s=e[r][i][1],o=e[r][i][2],a=e[r][i][3],l=e[r][i][4];n.name=r,n.tag=l,s&&n.position.set(s[0],s[1],s[2]),o&&n.rotation.set(o[0],o[1],o[2]),a&&n.scale.set(a[0],a[1],a[2]),n.updateMatrix();const c=n.geometry.clone();c.applyMatrix4(n.matrix),n.geometry=c,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=T(x)),this.add(this.gizmo.rotate=T(y)),this.add(this.gizmo.scale=T(S)),this.add(this.picker.translate=T(A)),this.add(this.picker.rotate=T(E)),this.add(this.picker.scale=T(C)),this.add(this.helper.translate=T(b)),this.add(this.helper.rotate=T(w)),this.add(this.helper.scale=T(M)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:Aa;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let i=0;i<r.length;i++){const e=r[i];let n;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(n*this.size/4),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const r=.99,i=.2;"X"===e.name&&Math.abs(ma.copy(wa).applyQuaternion(t).dot(this.eye))>r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"===e.name&&Math.abs(ma.copy(Ea).applyQuaternion(t).dot(this.eye))>r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"===e.name&&Math.abs(ma.copy(Sa).applyQuaternion(t).dot(this.eye))>r&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(ma.copy(Sa).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(ma.copy(wa).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(ma.copy(Ea).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)}else"rotate"===this.mode&&(xa.copy(t),ma.copy(this.eye).applyQuaternion(aa.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(va.lookAt(this.eye,_a,Ea)),"X"===e.name&&(aa.setFromAxisAngle(wa,Math.atan2(-ma.y,ma.z)),aa.multiplyQuaternions(xa,aa),e.quaternion.copy(aa)),"Y"===e.name&&(aa.setFromAxisAngle(Ea,Math.atan2(ma.x,ma.z)),aa.multiplyQuaternions(xa,aa),e.quaternion.copy(aa)),"Z"===e.name&&(aa.setFromAxisAngle(Sa,Math.atan2(ma.y,ma.x)),aa.multiplyQuaternions(xa,aa),e.quaternion.copy(aa)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some(function(t){return e.name===t}))&&(e.material.color.setHex(16776960),e.material.opacity=1)}else e.visible=!1,"AXIS"===e.name?(e.position.copy(this.worldPositionStart),e.visible=!!this.axis,"X"===this.axis&&(aa.setFromEuler(ga.set(0,0,0)),e.quaternion.copy(t).multiply(aa),Math.abs(ma.copy(wa).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(aa.setFromEuler(ga.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(aa),Math.abs(ma.copy(Ea).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(aa.setFromEuler(ga.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(aa),Math.abs(ma.copy(Sa).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(aa.setFromEuler(ga.set(0,Math.PI/2,0)),ma.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(va.lookAt(_a,ma,Ea)),e.quaternion.multiply(aa),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),sa.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),sa.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(sa),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld(e)}}class ka extends i.Kj0{constructor(){super(new i._12(1e5,1e5,2,2),new i.vBJ({visible:!1,wireframe:!0,side:i.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Ca.copy(wa).applyQuaternion("local"===t?this.worldQuaternion:Aa),Ma.copy(Ea).applyQuaternion("local"===t?this.worldQuaternion:Aa),Ta.copy(Sa).applyQuaternion("local"===t?this.worldQuaternion:Aa),ma.copy(Ma),this.mode){case"translate":case"scale":switch(this.axis){case"X":ma.copy(this.eye).cross(Ca),ba.copy(Ca).cross(ma);break;case"Y":ma.copy(this.eye).cross(Ma),ba.copy(Ma).cross(ma);break;case"Z":ma.copy(this.eye).cross(Ta),ba.copy(Ta).cross(ma);break;case"XY":ba.copy(Ta);break;case"YZ":ba.copy(Ca);break;case"XZ":ma.copy(Ta),ba.copy(Ma);break;case"XYZ":case"E":ba.set(0,0,0)}break;default:ba.set(0,0,0)}0===ba.length()?this.quaternion.copy(this.cameraQuaternion):(ya.lookAt(sa.set(0,0,0),ba,ma),this.quaternion.setFromRotationMatrix(ya)),super.updateMatrixWorld(e)}}const Da=new i.ZzF,Pa=new i.Pa4;class Ba extends i.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new i.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new i.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new i.$TI(t,6,1);return this.setAttribute("instanceStart",new i.kB5(r,3,0)),this.setAttribute("instanceEnd",new i.kB5(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new i.$TI(t,6,1);return this.setAttribute("instanceColorStart",new i.kB5(r,3,0)),this.setAttribute("instanceColorEnd",new i.kB5(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new i.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new i.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),Da.setFromBufferAttribute(t),this.boundingBox.union(Da))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new i.aLr),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let n=0,s=e.count;n<s;n++)Pa.fromBufferAttribute(e,n),i=Math.max(i,r.distanceToSquared(Pa)),Pa.fromBufferAttribute(t,n),i=Math.max(i,r.distanceToSquared(Pa));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class Ra extends Ba{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new i.Uk6(e))}}i.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new i.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},i.Vj0.line={uniforms:i.rDY.merge([i.rBU.common,i.rBU.fog,i.rBU.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class La extends i.jyz{constructor(e){super({type:"LineMaterial",uniforms:i.rDY.clone(i.Vj0.line.uniforms),vertexShader:i.Vj0.line.vertexShader,fragmentShader:i.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const Oa=new i.Pa4,Fa=new i.Pa4;class Ua extends i.Kj0{constructor(e=new Ba,t=new La({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let i=0,o=0,a=t.count;i<a;i++,o+=2)Oa.fromBufferAttribute(t,i),Fa.fromBufferAttribute(r,i),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+Oa.distanceTo(Fa);const s=new i.$TI(n,2,1);return e.setAttribute("instanceDistanceStart",new i.kB5(s,1,0)),e.setAttribute("instanceDistanceEnd",new i.kB5(s,1,1)),this}}class Na extends i.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const t=(new k).expandByObject(e,!1);t.getCenter(this.position);const r=t.getBoundingSphere(new i.aLr).radius;this.scale.setScalar(r*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const t=new Ra(e);this._geometry=t;const r=new La({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new i.FM8(1024,1024),dashed:!1,toneMapped:!1}),n=new Ua(t,r);n.computeLineDistances(),n.scale.set(1,1,1),n.visible=!0,this.add(n)}setVisible(e){var t;e!==this.visible&&(this.visible=e,null===(t=this.setDirty)||void 0===t||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?(null===(e=this._object)||void 0===e||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class ja extends Na{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new i.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&((new k).expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var Ga=function(e){return function(t){return 1-e(1-t)}},za=function(e){return function(t){return t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2}},Va=function(e){return function(t){return Math.pow(t,e)}},Qa=function(e){return function(t){return t*t*((e+1)*t-e)}},Ha=function(e){var t=Qa(e);return function(e){return(e*=2)<1?.5*t(e):.5*(2-Math.pow(2,-10*(e-1)))}},Wa=function(e){return e},qa=Va(2),Xa=Ga(qa),Ya=za(qa),Ka=function(e){return 1-Math.sin(Math.acos(e))},Ja=Ga(Ka),Za=za(Ja),$a=Qa(1.525),el=Ga($a),tl=za($a),rl=Ha(1.525),il=function(e){if(1===e||0===e)return e;var t=e*e;return e<.36363636363636365?7.5625*t:e<.7272727272727273?9.075*t-9.9*e+3.4:e<.9?12.066481994459833*t-19.63545706371191*e+8.898060941828255:10.8*e*e-20.52*e+10.72},nl=Ga(il),sl=function(e){return e<.5?.5*(1-il(1-2*e)):.5*il(2*e-1)+.5},ol=function(){return(ol=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function al(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}Object.create,Object.create;var ll=function(e,t,r){return Math.min(Math.max(r,e),t)};function cl(e,t){return e*Math.sqrt(1-t*t)}var ul=["duration","bounce"],pl=["stiffness","damping","mass"];function hl(e,t){return t.some(function(t){return void 0!==e[t]})}function dl(e){var t=e.from,r=void 0===t?0:t,i=e.to,n=void 0===i?1:i,s=e.restSpeed,o=void 0===s?2:s,a=e.restDelta,l=al(e,["from","to","restSpeed","restDelta"]),c={done:!1,value:r},u=function(e){var t=ol({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},e);if(!hl(e,pl)&&hl(e,ul)){var r=function(e){var t,r,i=e.duration,n=void 0===i?800:i,s=e.bounce,o=void 0===s?.25:s,a=e.velocity,l=void 0===a?0:a,c=e.mass,u=void 0===c?1:c,p=1-o;p=ll(.05,1,p),n=ll(.01,10,n/1e3),p<1?(t=function(e){var t=e*p,r=t*n;return.001-(t-l)/cl(e,p)*Math.exp(-r)},r=function(e){var r=e*p*n,i=r*l+l,s=Math.pow(p,2)*Math.pow(e,2)*n,o=Math.exp(-r),a=cl(Math.pow(e,2),p);return(.001-t(e)>0?-1:1)*((i-s)*o)/a}):(t=function(e){return Math.exp(-e*n)*((e-l)*n+1)-.001},r=function(e){return Math.exp(-e*n)*(n*n*(l-e))});var h=function(e,t,r){for(var i=r,n=1;n<12;n++)i-=e(i)/t(i);return i}(t,r,5/n);if(n*=1e3,isNaN(h))return{stiffness:100,damping:10,duration:n};var d=Math.pow(h,2)*u;return{stiffness:d,damping:2*p*Math.sqrt(u*d),duration:n}}(e);(t=ol(ol(ol({},t),r),{velocity:0,mass:1})).isResolvedFromDuration=!0}return t}(l),p=u.stiffness,h=u.damping,d=u.mass,f=u.velocity,g=u.duration,m=u.isResolvedFromDuration,_=fl,v=fl;function x(){var e=f?-f/1e3:0,t=n-r,i=h/(2*Math.sqrt(p*d)),s=Math.sqrt(p/d)/1e3;if(null!=a||(a=Math.abs(n-r)<=1?.01:.4),i<1){var o=cl(s,i);_=function(r){var a=Math.exp(-i*s*r);return n-a*((e+i*s*t)/o*Math.sin(o*r)+t*Math.cos(o*r))},v=function(r){var n=Math.exp(-i*s*r);return i*s*n*(Math.sin(o*r)*(e+i*s*t)/o+t*Math.cos(o*r))-n*(Math.cos(o*r)*(e+i*s*t)-o*t*Math.sin(o*r))}}else if(1===i)_=function(r){return n-Math.exp(-s*r)*(t+(e+s*t)*r)};else{var l=s*Math.sqrt(i*i-1);_=function(r){var o=Math.exp(-i*s*r),a=Math.min(l*r,300);return n-o*((e+i*s*t)*Math.sinh(a)+l*t*Math.cosh(a))/l}}}return x(),{next:function(e){var t=_(e);if(m)c.done=e>=g;else{var r=1e3*v(e),i=Math.abs(r)<=o,s=Math.abs(n-t)<=a;c.done=i&&s}return c.value=c.done?n:t,c},flipTarget:function(){var e;f=-f,r=(e=[n,r])[0],n=e[1],x()}}}dl.needsInterpolation=function(e,t){return"string"==typeof e||"string"==typeof t};var fl=function(e){return 0},gl=function(e,t,r){var i=t-e;return 0===i?1:(r-e)/i},ml=function(e,t,r){return-r*e+r*t+e},_l=function(e,t){return function(r){return Math.max(Math.min(r,t),e)}},vl=function(e){return e%1?Number(e.toFixed(5)):e},xl=/(-)?([\d]*\.?[\d])+/g,Al=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,bl=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function yl(e){return"string"==typeof e}var wl={test:function(e){return"number"==typeof e},parse:parseFloat,transform:function(e){return e}},El=ol(ol({},wl),{transform:_l(0,1)}),Sl=(ol(ol({},wl),{default:1}),function(e,t){return function(r){return Boolean(yl(r)&&bl.test(r)&&r.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(r,t))}}),Cl=function(e,t,r){return function(i){var n;if(!yl(i))return i;var s=i.match(xl),o=s[0],a=s[1],l=s[2],c=s[3];return(n={})[e]=parseFloat(o),n[t]=parseFloat(a),n[r]=parseFloat(l),n.alpha=void 0!==c?parseFloat(c):1,n}},Ml=_l(0,255),Tl=ol(ol({},wl),{transform:function(e){return Math.round(Ml(e))}}),Il={test:Sl("rgb","red"),parse:Cl("red","green","blue"),transform:function(e){var t=e.red,r=e.green,i=e.blue,n=e.alpha,s=void 0===n?1:n;return"rgba("+Tl.transform(t)+", "+Tl.transform(r)+", "+Tl.transform(i)+", "+vl(El.transform(s))+")"}},kl={test:Sl("#"),parse:function(e){var t="",r="",i="",n="";return e.length>5?(t=e.substr(1,2),r=e.substr(3,2),i=e.substr(5,2),n=e.substr(7,2)):(t=e.substr(1,1),r=e.substr(2,1),i=e.substr(3,1),n=e.substr(4,1),t+=t,r+=r,i+=i,n+=n),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(i,16),alpha:n?parseInt(n,16)/255:1}},transform:Il.transform},Dl=function(e){return{test:function(t){return yl(t)&&t.endsWith(e)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+e}}},Pl=(Dl("deg"),Dl("%")),Bl=(Dl("px"),Dl("vh"),Dl("vw"),ol(ol({},Pl),{parse:function(e){return Pl.parse(e)/100},transform:function(e){return Pl.transform(100*e)}}),{test:Sl("hsl","hue"),parse:Cl("hue","saturation","lightness"),transform:function(e){var t=e.hue,r=e.saturation,i=e.lightness,n=e.alpha,s=void 0===n?1:n;return"hsla("+Math.round(t)+", "+Pl.transform(vl(r))+", "+Pl.transform(vl(i))+", "+vl(El.transform(s))+")"}}),Rl=function(e,t,r){var i=e*e,n=t*t;return Math.sqrt(Math.max(0,r*(n-i)+i))},Ll=[kl,Il,Bl],Ol=function(e){return Ll.find(function(t){return t.test(e)})},Fl=function(e){return"'"+e+"' is not an animatable color. Use the equivalent color code instead."},Ul=function(e,t){var r=Ol(e),i=Ol(t);Fl(e),Fl(t),r.transform,i.transform;var n=r.parse(e),s=i.parse(t),o=ol({},n),a=r===Bl?ml:Rl;return function(e){for(var t in o)"alpha"!==t&&(o[t]=a(n[t],s[t],e));return o.alpha=ml(n.alpha,s.alpha,e),r.transform(o)}},Nl=function(e){return Il.test(e)||kl.test(e)||Bl.test(e)},jl=function(e){return Il.test(e)?Il.parse(e):Bl.test(e)?Bl.parse(e):kl.parse(e)},Gl=function(e){return yl(e)?e:e.hasOwnProperty("red")?Il.transform(e):Bl.transform(e)},zl="${c}",Vl="${n}";function Ql(e){var t=[],r=0,i=e.match(Al);i&&(r=i.length,e=e.replace(Al,zl),t.push.apply(t,i.map(jl)));var n=e.match(xl);return n&&(e=e.replace(xl,Vl),t.push.apply(t,n.map(wl.parse))),{values:t,numColors:r,tokenised:e}}function Hl(e){return Ql(e).values}function Wl(e){var t=Ql(e),r=t.values,i=t.numColors,n=t.tokenised,s=r.length;return function(e){for(var t=n,r=0;r<s;r++)t=t.replace(r<i?zl:Vl,r<i?Gl(e[r]):vl(e[r]));return t}}var ql=function(e){return"number"==typeof e?0:e},Xl={test:function(e){var t,r,i,n;return isNaN(e)&&yl(e)&&(null!==(r=null===(t=e.match(xl))||void 0===t?void 0:t.length)&&void 0!==r?r:0)+(null!==(n=null===(i=e.match(Al))||void 0===i?void 0:i.length)&&void 0!==n?n:0)>0},parse:Hl,createTransformer:Wl,getAnimatableNone:function(e){var t=Hl(e);return Wl(e)(t.map(ql))}},Yl={x:0,y:0,z:0},Kl=function(e){return"number"==typeof e},Jl=function(e,t){return function(r){return t(e(r))}},Zl=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce(Jl)};function $l(e,t){return Kl(e)?function(r){return ml(e,t,r)}:Nl(e)?Ul(e,t):ic(e,t)}var ec=function(e,t){var r=function(e,t){for(var r=0,i=t.length,n=e.length;r<i;r++,n++)e[n]=t[r];return e}([],e),i=r.length,n=e.map(function(e,r){return $l(e,t[r])});return function(e){for(var t=0;t<i;t++)r[t]=n[t](e);return r}},tc=function(e,t){var r=ol(ol({},e),t),i={};for(var n in r)void 0!==e[n]&&void 0!==t[n]&&(i[n]=$l(e[n],t[n]));return function(e){for(var t in i)r[t]=i[t](e);return r}};function rc(e){for(var t=Xl.parse(e),r=t.length,i=0,n=0,s=0,o=0;o<r;o++)i||"number"==typeof t[o]?i++:void 0!==t[o].hue?s++:n++;return{parsed:t,numNumbers:i,numRGB:n,numHSL:s}}var ic=function(e,t){var r=Xl.createTransformer(t),i=rc(e),n=rc(t);return i.numHSL===n.numHSL&&i.numRGB===n.numRGB&&(i.numNumbers,n.numNumbers),Zl(ec(i.parsed,n.parsed),r)},nc=function(e,t){return function(r){return ml(e,t,r)}};function sc(e,t,r){var i=void 0===r?{}:r,n=i.clamp,s=void 0===n||n,o=i.ease,a=i.mixer,l=e.length;t.length,!o||!Array.isArray(o)||o.length,e[0]>e[l-1]&&(e=[].concat(e),t=[].concat(t),e.reverse(),t.reverse());var c=function(e,t,r){for(var i=[],n=r||("number"==typeof(c=e[0])?nc:"string"==typeof c?Nl(c)?Ul:ic:Array.isArray(c)?ec:"object"==typeof c?tc:void 0),s=e.length-1,o=0;o<s;o++){var a=n(e[o],e[o+1]);if(t){var l=Array.isArray(t)?t[o]:t;a=Zl(l,a)}i.push(a)}var c;return i}(t,o,a),u=2===l?function(e,t){var r=e[0],i=e[1],n=t[0];return function(e){return n(gl(r,i,e))}}(e,c):function(e,t){var r=e.length,i=r-1;return function(n){var s=0,o=!1;if(n<=e[0]?o=!0:n>=e[i]&&(s=i-1,o=!0),!o){for(var a=1;a<r&&!(e[a]>n||a===i);a++);s=a-1}var l=gl(e[s],e[s+1],n);return t[s](l)}}(e,c);return s?function(t){return u(ll(e[0],e[l-1],t))}:u}function oc(e){var t=e.from,r=void 0===t?0:t,i=e.to,n=void 0===i?1:i,s=e.ease,o=e.offset,a=e.duration,l=void 0===a?300:a,c={done:!1,value:r},u=Array.isArray(n)?n:[r,n],p=function(e,t){return e.map(function(e){return e*t})}(o&&o.length===u.length?o:function(e){var t=e.length;return e.map(function(e,r){return 0!==r?r/(t-1):0})}(u),l);function h(){return sc(p,u,{ease:Array.isArray(s)?s:(e=u,t=s,e.map(function(){return t||Ya}).splice(0,e.length-1))});var e,t}var d=h();return{next:function(e){return c.value=d(e),c.done=e>=l,c},flipTarget:function(){u.reverse(),d=h()}}}function ac(e){var t=e.velocity,r=void 0===t?0:t,i=e.from,n=void 0===i?0:i,s=e.power,o=void 0===s?.8:s,a=e.timeConstant,l=void 0===a?350:a,c=e.restDelta,u=void 0===c?.5:c,p=e.modifyTarget,h={done:!1,value:n},d=o*r,f=n+d,g=void 0===p?f:p(f);return g!==f&&(d=g-n),{next:function(e){var t=-d*Math.exp(-e/l);return h.done=!(t>u||t<-u),h.value=h.done?g:g+t,h},flipTarget:function(){}}}var lc={keyframes:oc,spring:dl,decay:ac},cc="undefined"!=typeof performance?function(){return performance.now()}:function(){return Date.now()},uc="undefined"!=typeof window?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout(function(){return e(cc())},1/60*1e3)},pc=!0,hc=!1,dc=!1,fc={delta:0,timestamp:0},gc=["read","update","preRender","render","postRender"],mc=gc.reduce(function(e,t){return e[t]=function(e){var t=[],r=[],i=0,n=!1,s=new WeakSet,o={schedule:function(e,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);var l=a&&n,c=l?t:r;return o&&s.add(e),-1===c.indexOf(e)&&(c.push(e),l&&n&&(i=t.length)),e},cancel:function(e){var t=r.indexOf(e);-1!==t&&r.splice(t,1),s.delete(e)},process:function(e){var a;if(n=!0,t=(a=[r,t])[0],(r=a[1]).length=0,i=t.length)for(var l=0;l<i;l++){var c=t[l];c(e),s.has(c)&&(o.schedule(c),hc=!0)}n=!1}};return o}(),e},{}),_c=gc.reduce(function(e,t){var r=mc[t];return e[t]=function(e,t,i){return void 0===t&&(t=!1),void 0===i&&(i=!1),hc||bc(),r.schedule(e,t,i)},e},{}),vc=gc.reduce(function(e,t){return e[t]=mc[t].cancel,e},{}),xc=function(e){return mc[e].process(fc)},Ac=function(e){hc=!1,fc.delta=pc?1/60*1e3:Math.max(Math.min(e-fc.timestamp,40),1),fc.timestamp=e,dc=!0,gc.forEach(xc),dc=!1,hc&&(pc=!1,uc(Ac))},bc=function(){hc=!0,pc=!0,dc||uc(Ac)},yc=function(){return fc},wc=_c;function Ec(e,t,r){return void 0===r&&(r=0),e-t-r}var Sc=function(e){var t=function(t){var r=t.delta;return e(r)};return{start:function(){return wc.update(t,!0)},stop:function(){return vc.update(t)}}};function Cc(e){var t,r,i,n,s,o=e.from,a=e.autoplay,l=void 0===a||a,c=e.driver,u=void 0===c?Sc:c,p=e.elapsed,h=void 0===p?0:p,d=e.repeat,f=void 0===d?0:d,g=e.repeatType,m=void 0===g?"loop":g,_=e.repeatDelay,v=void 0===_?0:_,x=e.onPlay,A=e.onStop,b=e.onComplete,y=e.onRepeat,w=e.onUpdate,E=al(e,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),S=E.to,C=0,M=E.duration,T=!1,I=!0,k=function(e){if(Array.isArray(e.to))return oc;if(lc[e.type])return lc[e.type];var t=new Set(Object.keys(e));return t.has("ease")||t.has("duration")&&!t.has("dampingRatio")?oc:t.has("dampingRatio")||t.has("stiffness")||t.has("mass")||t.has("damping")||t.has("restSpeed")||t.has("restDelta")?dl:oc}(E);(null===(r=(t=k).needsInterpolation)||void 0===r?void 0:r.call(t,o,S))&&(s=sc([0,100],[o,S],{clamp:!1}),o=0,S=100);var D=k(ol(ol({},E),{from:o,to:S}));return l&&(null==x||x(),(i=u(function(e){if(I||(e=-e),h+=e,!T){var t=D.next(Math.max(0,h));n=t.value,s&&(n=s(n)),T=I?t.done:h<=0}null==w||w(n),T&&(0===C&&(null!=M||(M=h)),C<f?(I?h>=M+v:h<=-v)&&(C++,"reverse"===m?h=function(e,t,r,i){return void 0===r&&(r=0),void 0===i&&(i=!0),i?Ec(t+-e,t,r):t-(e-t)+r}(h,M,v,I=C%2==0):(h=Ec(h,M,v),"mirror"===m&&D.flipTarget()),T=!1,y&&y()):(i.stop(),b&&b()))})).start()),{stop:function(){null==A||A(),i.stop()}}}const Mc={linear:Wa,easeIn:qa,easeOut:Xa,easeInOut:Ya,circIn:Ka,circOut:Ja,circInOut:Za,backIn:$a,backOut:el,backInOut:tl,anticipate:rl,bounceOut:il,bounceIn:nl,bounceInOut:sl,easeInOutSine:function(e){return-(Math.cos(Math.PI*e)-1)/2}};async function Tc(e){return new Promise(t=>setTimeout(t,Math.max(0,e)))}function Ic(e,t,r){const i=e[t],n=()=>{"function"==typeof(null==e?void 0:e.setDirty)&&e.setDirty(),null==r||r()};return i.isVector3||i.isVector2||i.isVector4?e=>{i.copy(e),n()}:r=>{e[t]=r,n()}}function kc(e){return"boolean"!=typeof e}async function Dc(e,t,r){t in e||console.error("invalid key",t,e);const i=Ic(e,t),n=e[t],s=e=>{var t;i(e),null===(t=r.onUpdate)||void 0===t||t.call(r,e)};if(kc(n))return"function"==typeof r.to&&(r={...r,to:r.to(n,e)}),Pc({...r,from:n,onUpdate:s});{const{duration:e}=r;return Tc(null!=e?e:0).then(()=>s(r.to))}}async function Pc(e){return new Promise((t,r)=>{Cc({onComplete:()=>{var r;null===(r=e.onComplete)||void 0===r||r.call(e),t()},onStop:()=>{var r;null===(r=e.onStop)||void 0===r||r.call(e),t()},...e})})}async function Bc(e,t){const r=e.onComplete,i=e.onStop;return e={...e},new Promise((n,s)=>{e.onComplete=(()=>{null==r||r(),n()}),e.onStop=(()=>{null==i||i(),n()});const o=Cc(e);t.push(o)})}class Rc extends lo{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[Po],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=(e=>!1!==e.frameFade&&this.fadeOnActiveCameraChange&&this.startTransition(1e3)),this._fadeMat=(e=>{!1!==e.frameFade&&this.fadeOnMaterialUpdate&&this.startTransition(200)}),this._fadeScene=(e=>{!1!==e.frameFade&&this.fadeOnSceneUpdate&&this.startTransition(500)}),this._onPointerMove=(e=>{var t;const r=null===(t=this._viewer)||void 0===t?void 0:t.canvas;if(!r)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==r)return void(this.pointerEnabled=!0);const i=r.getBoundingClientRect(),n=(e.clientX-i.left)/i.width,s=(e.clientY-i.top)/i.height;this.pointerEnabled=n<0||n>1||s<0||s>1}),this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:i.wem,magFilter:i.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await Tc(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,r=e.getPlugin(Po),i=new class extends To{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=st("Frame Fade",this)}render(i,n,s,o,a){this.needsSwap=!1;const l=t._target;if(!l||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001)return;t._toSaveFrame&&r.lastFrame&&(e.renderer.blit(r.lastFrame.texture,l),this._lastTime=0,t._toSaveFrame=!1),this.blendTexture=null==l?void 0:l.texture;const c=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(c),this.weights2.w=1,this.weights1.setScalar(1-c),this.weights1.w=1,super.render(i,n,s,o,a),this.needsSwap=!0;const u=kt();this._lastTime<10&&(this._lastTime=u-10);const p=u-this._lastTime;this._lastTime=u,t._fadeTimeState-=p}};return i.enabled=!0,i}setDirty(){var e;this.enabled&&(null===(e=this._viewer)||void 0===e||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return null===(t=null===(e=this.pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}Rc.PluginType="FrameFade";var Lc=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},Oc=i.M8C.degToRad;class Fc extends oo{constructor(e=ja,t=!1,r=!0,i=!1){super(),this.enabled=!0,this._enableWidget=!1,this.autoFocus=!1,this._onObjectHit=(e=>{this._viewer&&(this.enabled?this.dispatchEvent(e):e.intersects.selectedObject=null)}),this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const e=this.getSelectedObject();this.autoFocus&&e&&this.setSelectedObject(e,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=r,this.autoFocus=i}get picker(){return this._picker}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return(null===(e=this._picker)||void 0===e?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled)return;if(!this._picker)return;const r=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=r,(r||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new ia(e.scene,e.canvas,void 0,e=>{var t,r;if(!e.material)return!1;let i=e,n=!1;for(;i;){if(!i.visible)return!1;if("model"===(null!==(t=i.userData.iModel)&&void 0!==t?t:i).assetType&&(n=!0),"widget"===(null!==(r=i.userData.iModel)&&void 0!==r?r:i).assetType)return!1;if(!1===i.userData.userSelectable)return!1;if(!1===i.userData.bboxVisible)return!1;i=i.parent}return n}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new Uc(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var r,i,n,s;this.dispatchEvent(t);const o=(null===(r=this._picker)||void 0===r?void 0:r.selectedObject)||void 0;if(this._pickUi){const e=null===(i=o)||void 0===i?void 0:i.uiConfig,t=this.uiConfig;t.children=[...this._uiConfigChildren],e&&t.children.push(e),null===(n=t.uiRefresh)||void 0===n||n.call(t)}const a=this._widget;a&&this._enableWidget&&(o?a.attach(o):a.detach());const l=this._transformControls;l&&(null===(s=this._viewer)||void 0===s?void 0:s.scene.activeCamera.controls)&&(o&&l.enabled?l.attach(o):l.detach()),e.setDirty(),this.autoFocus&&this.focusObject(o)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",e=>{void 0===e.value?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(e.value,this.autoFocus||e.focusCamera)}),e.scene.addEventListener("addSceneObject",async t=>{var r,i,n;const s=t.object,o=this.getSelectedObject();if(o&&"material"===(null==s?void 0:s.assetType)&&"function"==typeof(null==o?void 0:o.setMaterial)&&(null===(r=null==o?void 0:o.modelObject)||void 0===r?void 0:r.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const t=o.material;if(Array.isArray(t))console.warn("Dropping on material array not yet fully supported."),o.setMaterial(s);else{let r=Array.from(null!==(i=null==t?void 0:t.userData.__appliedMeshes)&&void 0!==i?i:[]);(r.length>1?!(await e.confirm("Applying material: Apply to all objects using this material?")):r.length<1)&&(r=[o]);for(const e of r)e&&(null===(n=e.setMaterial)||void 0===n||n.call(e,s))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const r=this.getSelectedObject();let i=!1;null==r||r.traverseAncestors(t=>{t===e.scene.modelObject&&(i=!0)}),i||this.setSelectedObject(void 0)})}async focusObject(e){var t,r,i,n;const s=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("CameraViews");await(null==s?void 0:s.animateToObject(e,4,1e3,"easeOut",{min:(null!==(n=null===(i=null===(r=this._viewer)||void 0===r?void 0:r.scene.activeCamera.getControls())||void 0===i?void 0:i.minDistance)&&void 0!==n?n:.5)+.5,max:5}))}enableWidget(e){var t,r,i;if(this._enableWidget=e,e){const e=(null===(t=this._picker)||void 0===t?void 0:t.selectedObject)||void 0;e&&(null===(r=this._widget)||void 0===r||r.attach(e))}else null===(i=this._widget)||void 0===i||i.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}Fc.PluginType="Picking",Lc([Ce()],Fc.prototype,"enabled",void 0),Lc([Ce()],Fc.prototype,"autoFocus",void 0);class Uc extends da{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var e;null===(e=null==this?void 0:this.object)||void 0===e||e.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const r=null==e?void 0:e.getPlugin(Rc);r&&(r.enabled=!t.value),this._scene.activeCamera.interactionsEnabled=!t.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace("local"===this.space?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(Oc(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(16===e.keyCode&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var Nc=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class jc extends oo{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=(()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:(null===(e=this._viewer)||void 0===e?void 0:e.scene.getEnvironment())||null}),this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const r=[];return e.modelObject.traverse(e=>{var t,i,n,s;const o=null===(i=null===(t=e.userData)||void 0===t?void 0:t.gltfExtensions)||void 0===i?void 0:i[jc.DIAMOND_GLTF_EXTENSION];o&&e.geometry&&(this.prepareDiamondMesh(e,o),delete e.userData.gltfExtensions[jc.DIAMOND_GLTF_EXTENSION]),e.material&&!r.includes(e.material)&&(null===(s=null===(n=e.material.userData)||void 0===n?void 0:n.gltfExtensions)||void 0===s?void 0:s[jc.DIAMOND_GLTF_EXTENSION])&&(e.material.materialObject||console.warn("material not processed",e.material),r.push(e.material))}),r.forEach(e=>{const t=e.userData.gltfExtensions[jc.DIAMOND_GLTF_EXTENSION];t&&this._convertToDiamondMaterial(e,t)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,t,r;const i=null===(r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject())||void 0===r?void 0:r.material;return!!Array.isArray(i)||(null==i?void 0:i.typeSlug)!==er.TypeSlug},value:async()=>{var e,t,r,i,n,s;const o=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject();if(!(null==o?void 0:o.material))return;const a=await(null===(r=this._viewer)||void 0===r?void 0:r.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let l=parseInt(await(null===(i=this._viewer)||void 0===i?void 0:i.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(l)||(l=512),l<64&&(l=64),(null===(n=o.material.userData)||void 0===n?void 0:n.__appliedMeshes.size)>1&&await(null===(s=this._viewer)||void 0===s?void 0:s.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(o.material,{cacheKey:a||void 0,normalMapRes:l},{}):this.makeDiamondMesh(o,{cacheKey:a||void 0,normalMapRes:l},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,t,r;const i=null===(r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject())||void 0===r?void 0:r.material;return!!Array.isArray(i)||(null==i?void 0:i.typeSlug)!==ra.TypeSlug},value:async()=>{var e,t,r,i,n,s,o,a;const l=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject(),c=null==l?void 0:l.material;if(!c)return;const u=c.userData._baseMaterial;let p=null===(n=null===(i=null===(r=this._viewer)||void 0===r?void 0:r.getManager())||void 0===i?void 0:i.materials)||void 0===n?void 0:n.findMaterial(u);if(p&&!p.isDiamondMaterial||(p=null===(s=this._viewer)||void 0===s?void 0:s.createPhysicalMaterial({color:c.color})),p){const e=c.userData.__appliedMeshes.size>1&&await(null===(o=this._viewer)||void 0===o?void 0:o.confirm("Convert all with this material?"))?Array.from(c.userData.__appliedMeshes):[l];for(const t of e)null===(a=null==t?void 0:t.setMaterial)||void 0===a||a.call(t,p)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,t;return null!==(t=null===(e=this.envMap)||void 0===e?void 0:e.rotation)&&void 0!==t?t:0}set envMapRotation(e){var t;const r=this.envMap;r&&(r.rotation=e,null===(t=this._viewer)||void 0===t||t.scene.setDirty())}refreshEnvMaps(){var e,t,r;if(!this._viewer)return;const i=this.getEnvMap(),n=(null===(t=null===(e=this._viewer.getPlugin(so))||void 0===e?void 0:e.materials)||void 0===t?void 0:t.getMaterialsOfType(ra.TypeSlug))||[];for(const s of n)s&&s.envMap!==i&&(s.envMap=i,s.needsUpdate=!0);null===(r=this._viewer)||void 0===r||r.scene.setDirty()}refreshUi(){var e,t,r;null===(e=this._viewer)||void 0===e||e.setDirty(),null===(r=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===r||r.call(t,"postFrame",!0)}async onAdded(e){var t,r,i,n,s,o;this._normalCapture=new Yo(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const a=e.getPlugin(so);null===(t=null==a?void 0:a.importer)||void 0===t||t.processors.add("model",this._modelProcessor),null===(r=e.getPlugin(Fc))||void 0===r||r.addEventListener("selectedObjectChanged",this.refreshUi);const l=this.getEnvMap,c=new lr(class extends fr{async loadAsync(e,t){var r;const i=await super.loadAsync(e,t);return i.type===ra.TYPE||i.isDiamondMaterialParameters?(i.envMap=l(),null===(r=null==a?void 0:a.materials)||void 0===r?void 0:r.generateFromTemplate("diamond",i)):(console.error("Invalid material type for Diamond Material.",i),null)}},[ra.TypeSlug],!1);return to.Importers.push(c),null===(s=null===(n=null===(i=null==a?void 0:a.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===n?void 0:n.extensions)||void 0===s||s.push(Gc),null===(o=null==a?void 0:a.materials)||void 0===o||o.registerMaterialTemplate({name:"diamond",materialType:ra.TYPE,isDiamondMaterialParameters:!0,generator:(e,t)=>{const r=new ra(e);return r.envMap=l(),t&&t!=={}&&r.copyProps(t),r}}),super.onAdded(e)}async onRemove(e){var t,r,i,n;return null===(t=this._normalCapture)||void 0===t||t.dispose(),this._normalCapture=void 0,this.offsetCache={},null===(i=null===(r=e.getPlugin(so))||void 0===r?void 0:r.importer)||void 0===i||i.processors.remove("model",this._modelProcessor),null===(n=e.getPlugin(Fc))||void 0===n||n.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:r}){var i,n,s;e.userData._diamondCacheKey=null!=t?t:e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=null!=r?r:e.userData._diamondNormalMapRes,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const o=null!==(n=null===(i=this._normalCapture)||void 0===i?void 0:i.captureNormalMap(e.geometry,t,r))&&void 0!==n?n:[void 0,!1],a=null===(s=this._viewer)||void 0===s?void 0:s.getPluginByType("debug");a&&o&&(a.counters.normalsCapture||(a.counters.normalsCapture=0),a.counters.normalsCapture++,console.log("DEBUG: new normal map captured",a.counters.normalsCapture,t),a.addTexture("normal"+a.counters.normalsCapture,()=>{var t;return null===(t=e.geometry.userData._normalsCaptureMap)||void 0===t?void 0:t.texture},[40,110*a.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,r){var i,n;Array.from(null!==(i=null==e?void 0:e.userData.__appliedMeshes)&&void 0!==i?i:[]).forEach(e=>{(null==e?void 0:e.isMesh)&&e.geometry&&this.prepareDiamondMesh(e,t)}),this._convertToDiamondMaterial(e,r),null===(n=this._viewer)||void 0===n||n.setDirty()}makeDiamondMesh(e,t,r){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const i=Array.isArray(e.material)?e.material[0]:e.material,n=this._convertToDiamondMaterial(i,r,!1);e.setMaterial(n)}_convertToDiamondMaterial(e,t={isDiamond:!0},r=!0){var n,s,o,a,l,c,u;let p={...null!=t?t:{}};p.isDiamond||p.isDiamondMaterialParameters?Array.isArray(p.boostFactors)&&(p.boostFactors=(new i.Pa4).fromArray(p.boostFactors)):p={isDiamondMaterialParameters:!0},p.color=null!==(o=null!==(n=p.color)&&void 0!==n?n:null===(s=null==e?void 0:e.materialObject)||void 0===s?void 0:s.color)&&void 0!==o?o:new xe(1,1,1);const h=null===(c=null===(l=null===(a=this._viewer)||void 0===a?void 0:a.getManager())||void 0===l?void 0:l.materials)||void 0===c?void 0:c.generateFromTemplate("diamond",p);if(h&&e&&!e.isDiamondMaterial&&(h.userData._baseMaterial=e.uuid),r){const r=e=>{var t;return null!==(t=e.setMaterial)&&void 0!==t?t:t=>{e.material=t.materialObject}};Array.from(null!==(u=null==e?void 0:e.userData.__appliedMeshes)&&void 0!==u?u:[]).forEach(e=>{r(e)(h),this.prepareDiamondMesh(e,t)})}return h}_computeOffsets(e,t,r=!1){const n=t.split(";").find(e=>this.offsetCache[e]);if(n&&!r){const r=this.offsetCache[n];return t.split(";").forEach(e=>e!==n&&(this.offsetCache[e]=r)),e.userData._normalsCaptureOffsets=r,r}e.computeBoundingBox();const s=e.boundingBox.getCenter(new i.Pa4),o=$o(e),a=o.clone().invert(),l={center:s,offsetMatrix:o,offsetMatrixInv:a,radius:1,centerOffset:(new i.Pa4).copy(s).applyMatrix4(a)};return t.split(";").forEach(e=>this.offsetCache[e]=l),e.userData._normalsCaptureOffsets=l,l}}jc.PluginType="Diamond",jc.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Nc([M(jc.prototype.refreshEnvMaps),Ce()],jc.prototype,"envMap",void 0),Nc([M(jc.prototype.refreshEnvMaps),Ce()],jc.prototype,"forceSceneEnvMap",void 0);const Gc=e=>({writeMaterial:(t,r)=>{t.isDiamondMaterial&&(r.extensions=r.extensions||{},r.extensions[jc.DIAMOND_GLTF_EXTENSION]=t.toJSON(),e.extensionsUsed[jc.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(t,r)=>{var i,n;if(!(null==t?void 0:t.material.isDiamondMaterial))return;r.extensions=r.extensions||{};const s={};null===(n=null===(i=t.userData)||void 0===i?void 0:i.gltfExtensions)||void 0===n||delete n[jc.DIAMOND_GLTF_EXTENSION],t.userData._diamondNormalMapRes&&(s.normalMapRes=t.userData._diamondNormalMapRes),t.userData._diamondCacheKey&&(s.cacheKey=t.userData._diamondCacheKey),r.extensions[jc.DIAMOND_GLTF_EXTENSION]=s,e.extensionsUsed[jc.DIAMOND_GLTF_EXTENSION]=!0}});var zc,Vc=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Qc=zc=class extends oo{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[so],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=(e=>{const t=e.object;"model"===t.assetType&&t.modelObject&&this._viewer&&t.modelObject.traverse(e=>{const t=e.animations;if(t.length<1)return;const r=Math.max(...t.map(e=>e.duration));t.forEach(e=>e.duration=r);const n=new i.Xcj(this._viewer.scene.modelRoot.modelObject),s=t.map(e=>n.clipAction(e).setLoop(this.loopAnimations?i.YKA:i.jAl,this.loopRepetitions));this.animations.push({mixer:n,clips:t,actions:s,duration:r}),this.onPropertyChange()})}),this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:e}){this.enabled&&Math.abs(e)>.001&&(this._scrollAnimationState=-1*Math.sign(e))}_postFrame(){var e,t;if(!this._viewer)return;const r=this._viewer,i=this.animateOnScroll;if(!this.enabled||this.animations.length<1||"playing"!==this._animationState&&!i)return this._lastFrameTime=0,void(this._fadeDisabled&&(null===(e=this._viewer.getPluginByType("FrameFade"))||void 0===e||e.enable(zc.PluginType),this._fadeDisabled=!1));this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"});const n=kt()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=n-1/30);let s=n-this._lastFrameTime;if(s*=this.animationSpeed,this._lastFrameTime=n,i&&(s*=this._scrollAnimationState),Math.abs(s)<1e-4)return;const o=null===(t=this._viewer.getPluginByType("Progressive"))||void 0===t?void 0:t.postFrameConvergedRecordingDelta();if(o&&o>0&&(s=o),0!==o){if(this.animations.map(e=>e.mixer.update(s)),this._animationTime+=s,this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this.dispatchEvent({type:"animationStep",delta:s,time:this._animationTime}),r.scene.activeCamera.cameraObject.userData.__animatingCamera&&r.scene.activeCamera.setDirty(),r.renderer.resetShadows(),r.setDirty(),!this._fadeDisabled){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(zc.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(e=>new Hc(e,this))}async onAdded(e){var t,r,i,n,s,o;null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),e.scene.addEventListener("addSceneObject",this._objectAdded),null===(o=null===(s=null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.exporter)||void 0===n?void 0:n.getExporter("gltf","glb"))||void 0===s?void 0:s.extensions)||void 0===o||o.push(Wc),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let a=-1;return Object.defineProperty(e.scene.modelRoot,"currentTimelineMarker",{get:()=>a,set:t=>e.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[a=t]})}),e.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:e})=>{var t;if(!this._viewer)return;if(!e)return this._viewer.scene.activeCamera=null===(t=this._viewer)||void 0===t?void 0:t.scene.defaultCamera,void this._viewer.setDirty();const r=e.camera;r&&(r.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(r))}),super.onAdded(e)}async onRemove(e){for(var t,r;this.animations.length;)this.animations.pop();return e.scene.removeEventListener("addSceneObject",this._objectAdded),null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(e)}onPropertyChange(){"playing"===this._animationState&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1)}onStateChange(){var e,t;null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.children)||void 0===t||t.map(e=>e&&x(e)).flat(2).forEach(e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e)})}playPauseAnimation(){"playing"===this._animationState?this.pauseAnimation():this.playAnimation()}async playClip(e,t=!1){return this.playClips([e],t)}async playClips(e,t=!1){const r=[];return this.animations.forEach(({actions:t})=>{t.forEach(t=>{e.includes(t.getClip().name)&&r.push(t)})}),this.playAnimation(t,r)}async playAnimation(e=!1,t){var r;if(!this.enabled)return;"playing"===this._animationState&&this.stopAnimation(!1);let n=0;const s=!t;t||(t=[],this.animations.forEach(({mixer:e,actions:r,clips:i})=>{t.push(...r)})),"paused"!==this._animationState&&this.resetAnimation();const o=We();this._lastAnimId=o;for(const a of t)this.timeScale>0&&(a.timeScale=this.timeScale),a.setLoop(this.loopAnimations?i.YKA:i.jAl,this.loopRepetitions),a.play(),n=Math.max(n,a.getClip().duration/a.timeScale);if(this._animationState="playing",null===(r=this._viewer)||void 0===r||r.setDirty(),s){if(!isFinite(this._animationDuration))return;await new Promise((e,t)=>{const r=()=>{this.removeEventListener("checkpointEnd",r),e()};this.addEventListener("checkpointEnd",r)})}else{const e=this.loopAnimations?this.loopRepetitions:1;if(n*=e,!isFinite(n))return;await new Promise((e,t)=>{const r=t=>{t.time>=n&&(this.removeEventListener("animationStep",r),e())};this.addEventListener("animationStep",r)})}o===this._lastAnimId&&this.stopAnimation(e)}pauseAnimation(){var e;this._animationState="paused",null===(e=this._viewer)||void 0===e||e.setDirty()}stopAnimation(e=!1){var t,r;this._animationState="stopped",e?this.resetAnimation():null===(t=this._viewer)||void 0===t||t.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&(null===(r=this._viewer.getPluginByType("FrameFade"))||void 0===r||r.enable(zc.PluginType),this._fadeDisabled=!1)}resetAnimation(){var e;"stopped"===this._animationState||"none"===this._animationState?(this.animations.forEach(({mixer:e,actions:t,clips:r})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,null===(e=this._viewer)||void 0===e||e.setDirty()):this.stopAnimation(!0)}};Qc.PluginType="GLTFAnimation",Qc.AnimationMarkersExtension="WEBGI_animation_markers",Vc([Ke()],Qc.prototype,"animationState",null),Vc([Ke()],Qc.prototype,"animationTime",null),Vc([Ke()],Qc.prototype,"animationDuration",null),Vc([M(zc.prototype.onPropertyChange),Ye("Loop",{limitedUi:!0})],Qc.prototype,"loopAnimations",void 0),Vc([M(zc.prototype.onPropertyChange)],Qc.prototype,"loopRepetitions",void 0),Vc([M(zc.prototype.onPropertyChange)],Qc.prototype,"timeScale",void 0),Vc([Ye(),Ce()],Qc.prototype,"animateOnScroll",void 0),Vc([Je("Speed",[.1,4],.1,{limitedUi:!0}),Ce()],Qc.prototype,"animationSpeed",void 0),Vc([M(zc.prototype.onStateChange)],Qc.prototype,"_animationState",void 0),Vc([et("Play/Pause",e=>({label:()=>"playing"===e.animationState?"Pause":"Play",limitedUi:!0}))],Qc.prototype,"playPauseAnimation",null),Vc([et("Stop",{limitedUi:!0})],Qc.prototype,"stopAnimation",null),Vc([et("Reset",{limitedUi:!0})],Qc.prototype,"resetAnimation",null),Qc=zc=Vc([ot("GLTF Animations")],Qc);class Hc{constructor(e,t){this.parser=e,this.name=Qc.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){var t;let r=[];for(const i of this.parser.json.scenes){if(!i.extensions)continue;const e=i.extensions[this.name];for(const t of(null==e?void 0:e.markers)||[]){const e=void 0!==t.camera?await this.parser.getDependency("camera",t.camera):void 0;if(void 0===t.time){const e=30;t.time=t.frame/e,console.error("Update timeline markers plugin for correct times.")}r.push({name:t.name,frame:t.frame,time:t.time,camera:e})}}if(r.length<1)return;r=r.sort((e,t)=>e.frame-t.frame);const n=null!==(t=e.scene)&&void 0!==t?t:e.scenes[0];if(!n)return;n.userData.__markers=r;const s=this.plugin.timelineMarkers,o=r.map(e=>e.time);let a=s.length;const l=r.map(e=>a++),c=Math.max(...o)+.01;s.push(...r);const u=new i.dUE(".currentTimelineMarker",o,l,2300),p=new i.m7l("animationTimelineMarker",c,[u]);p.__gltfExport=!1,e.animations.push(p)}}const Wc=e=>({afterParse(t){const r=e.json.scenes[e.json.scene||0];r.extensions=r.extensions||{};const i={markers:[]},n=[];if((Array.isArray(t)?t:[t]).forEach(e=>e.traverse(e=>{e.userData.__markers&&n.push(...e.userData.__markers)})),n.sort((e,t)=>e.frame-t.frame),!(n.length<1)){for(const t of n){const r=t.camera;if(r){const n=e.nodeMap.get(r);if(void 0===n){console.warn("Camera not found in gltf export",r,e.nodeMap);continue}const s=e.json.nodes[n].camera;t.camera=s,i.markers.push(t)}}r.extensions[Qc.AnimationMarkersExtension]=i,e.extensionsUsed[Qc.AnimationMarkersExtension]=!0}}});class qc extends r{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=(()=>this._showDebug("preRender")),this._postRender=(()=>this._showDebug("postRender"))}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,t,r,s,o,a="postRender",l=!1){var c;this._generators.has(a)||this._generators.set(a,[]),null===(c=this._generators.get(a))||void 0===c||c.push({key:e,fn:t,rect:r?[...r]:void 0,frag:o||s||l?new i.jyz({vertexShader:n.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:null!=o?o:`\n        #include <common>\n        #include <packing>\n        uniform float opacity;\n\t\tuniform ${l?"samplerCube":"sampler2D"} tDiffuse;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvec4 texel = ${l?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};\n\t\t\t${null!=s?s:""}\n\t\t\tgl_FragColor = opacity * texel;\n\t\t}\n            `}):void 0})}removeTexture(e,t="postRender"){var r,i;this._generators.set(t,null!==(i=null===(r=this._generators.get(t))||void 0===r?void 0:r.filter(t=>t.key!==e))&&void 0!==i?i:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var t;const r=this._viewer,i=null==r?void 0:r.renderer;i&&r&&(null===(t=this._generators.get(e))||void 0===t||t.forEach(({key:e,fn:t,rect:n,frag:s})=>{const o=t(r);if(o){if(o.image&&n){const e=o.image.width/o.image.height;n[2]<1&&n[3]<1&&(n[2]=200),n[2]<1&&(n[2]=n[3]*e),n[3]<1&&(n[3]=n[2]/e)}i.blit(o,void 0,{viewport:n,clear:!1,material:s})}}))}}qc.PluginType="debug";var Xc=function(e,t){return(Xc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function Yc(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Xc(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Kc,Jc=function(){function e(){}return e._xfnv1a=function(e){for(var t=2166136261,r=0;r<e.length;r++)t=Math.imul(t^e.charCodeAt(r),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},e}(),Zc=function(e){function t(r){var i=e.call(this)||this;return i.a=t._xfnv1a(r)(),i}return Yc(t,e),t.prototype.next=function(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296},t}(Jc),$c=function(e){function t(r){var i=e.call(this)||this,n=t._xfnv1a(r);return i.a=n(),i.b=n(),i.c=n(),i.d=n(),i}return Yc(t,e),t.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var e=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,e=e+this.d|0,this.c=this.c+e|0,(e>>>0)/4294967296},t}(Jc),eu=function(e){function t(r){var i=e.call(this)||this,n=t._xfnv1a(r);return i.a=n(),i.b=n(),i.c=n(),i.d=n(),i}return Yc(t,e),t.prototype.next=function(){var e=this.b<<9,t=5*this.a;return t=t<<7|9*(t>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=e,this.d=this.d<<11|this.d>>>21,(t>>>0)/4294967296},t}(Jc);!function(e){e.sfc32="sfc32",e.mulberry32="mulberry32",e.xoshiro128ss="xoshiro128ss"}(Kc||(Kc={}));var tu=function(){function e(e,t){void 0===t&&(t=Kc.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return e.prototype.next=function(){return this.generator.next()},e.prototype._initializeGenerator=function(){if(function(e){return null===e}(e=this.str)||function(e){return void 0===e}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new $c(this.str);case"mulberry32":return new Zc(this.str);case"xoshiro128ss":return new eu(this.str);default:return this.wrap()}},e.prototype.wrap=function(){return{next:function(){return Math.random()}}},e}(),ru=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class iu extends Ys{constructor(e,t,r,n){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new i.Pa4(10,10,10),normalDirection:new i.Pa4(.01,.98,.01).normalize(),direction:new i.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=null!=r?r:{},this.randomParams=null!=n?n:{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>void 0===e[t]&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>void 0===e[t]&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,r=null){const n=new tu(e.toString()),s=new i.FM8(n.next()*Math.PI*2,Math.asin(2*n.next()-1));let o=new i.Pa4(Math.cos(s.x)*Math.cos(s.y),Math.sin(s.y),Math.sin(s.x)*Math.cos(s.y));const a=new i.FM8;for(let i=0;i<5;i++){a.set(n.next(),n.next()),o=nu(a,this._randomParams.normalDirection,.4),n.next()<Math.sqrt(null!=t?t:this._randomParams.focus)&&(a.set(n.next(),n.next()),o=nu(a,this._randomParams.direction,Math.pow((null!=r?r:this._randomParams.spread)/2,2)));const e=o.dot(this._randomParams.normalDirection);if(e>0&&e<.4)break}o.normalize(),o.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(o.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=(new i.Pa4).subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function nu(e,t,r){t=t.clone().normalize();const n=new i.Pa4(0,-t.z,t.y).normalize(),s=(new i.Pa4).crossVectors(t,n).normalize(),o=e;o.x=2*o.x*Math.PI,o.y=1-o.y*r;const a=Math.sqrt(1-o.y*o.y);return n.multiplyScalar(Math.cos(o.x)*a).add(s.multiplyScalar(Math.sin(o.x)*a)).add(t.multiplyScalar(o.y))}ru([Ce("shadowParams")],iu.prototype,"_shadowParams",void 0),ru([Ce("randomParams")],iu.prototype,"_randomParams",void 0);class su extends i.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>","\n#include <project_vertex>\ngl_Position = vec4(uv*2.-1., 0, 1.); \n        "),e.vertexShader=e.vertexShader.replace("void main() {","\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n        "),e.fragmentShader=e.fragmentShader.replace("void main() {","\nvarying vec2 vUv;\nuniform sampler2D tLastThis;\nvoid main() {\n        "),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",w`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}!function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([z({propKey:"tLastThis"})],su.prototype,"lastFrameTexture",void 0);var ou=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class au{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={parsFragmentSnippet:(e,t)=>w`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(e,t,r)=>{"aoMap"===this.groundMapMode?e.fragmentShader=Jt(e.fragmentShader,"#include <aomap_fragment>",Jt(i.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):"map"===this.groundMapMode?e.fragmentShader=Jt(e.fragmentShader,"#include <map_fragment>",Jt(i.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = mix(1., unpackRGBAToDepth(sampledDiffuseColor), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):"alphaMap"===this.groundMapMode&&(e.fragmentShader=Jt(e.fragmentShader,"#include <alphamap_fragment>",Jt(i.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&r.capabilities.isWebGL2&&(e.fragmentShader=Jt(e.fragmentShader,"#include <output_fragment>",w`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(e,t)=>{t.materialObject.userData.gMapMode!==this.groundMapMode&&(t.materialObject.userData.gMapMode=this.groundMapMode,t.materialObject.needsUpdate=!0)},isCompatible:e=>e.isMeshStandardMaterial2},this._viewer=e;const t=new iu(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new i.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new i.Pa4(10,10,10),normalDirection:new i.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new su({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:i.jFi}),this._shadowBlurMat=new zt({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new i.FM8(.5,.5)},direction:{value:new i.FM8(.5,.5)}},vertexShader:Bo,fragmentShader:"#include <packing>\nuniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}"})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),"alphaMap"===this.groundMapMode?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,r;null===(t=null===(e=this.materialExtension)||void 0===e?void 0:e.setDirty)||void 0===t||t.call(e),null===(r=this._viewer)||void 0===r||r.setDirty()}fromJSON(e,t){return De(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:i.ywz,depthBuffer:!1,size:new i.FM8(t,t),sizeMultiplier:void 0,encoding:i.rnI,format:i.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const r=this._viewer.renderer.rendererObject,n=r.shadowMap,s=n.type,o=n.needsUpdate,a=n.autoUpdate;n.type=i._MY,n.needsUpdate=!0,n.autoUpdate=!1;const l=this._viewer.scene,c=new i.S9g;c.disableAll(),l.modelObject.traverse(e=>{e.isLight&&e!==this._light.lightObject&&(e.userData.__gp_layers=e.layers,e.layers=c)});const u=l.activeCamera.cameraObject;if(0!=(u.layers.mask&1<<this._lightLayer))throw"Camera can render pseudo directional light, check layers";u.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),W(r,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(l)),u.layers.disable(this._lightLayer);const p=u.layers.mask;u.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const h=this._viewer.renderer.getTempTarget({type:i.ywz,depthBuffer:!1,size:new i.FM8(t,t),encoding:i.rnI,format:i.wk1}),d=h.texture.encoding;h.texture.encoding=i.rnI,this._viewer.renderer.blit(this._target.texture,h,{clear:!0});{const t=l.modelObject.environment,i=l.modelObject.background,n=e.material,s=e.frustumCulled,o=r.getRenderTarget(),a=r.getActiveCubeFace(),c=r.getActiveMipmapLevel();l.modelObject.background=null,l.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,r.setRenderTarget(this._target);const u=!1;this._shadowMat.opacity=u?1/this.maxFrameNumber:Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=h.texture,this._shadowMat.needsUpdate=!0,W(r,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(l)),r.setRenderTarget(o,a,c),e.frustumCulled=s,e.material=n,l.modelObject.environment=t,l.modelObject.background=i,this.smoothShadow&&this._applySmoothFilter(this._target,h)}return h.texture.encoding=d,this._viewer.renderer.releaseTempTarget(h),e.layers.disable(this._lightLayer),u.layers.mask=p,l.modelObject.traverse(e=>{e.isLight&&e!==this._light.lightObject&&(e.layers=e.userData.__gp_layers,delete e.userData.__gp_layers)}),n.type=s,n.needsUpdate=o,n.autoUpdate=a,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,r,i;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===(null===(t=this._target)||void 0===t?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===(null===(r=this._target)||void 0===r?void 0:r.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===(null===(i=this._target)||void 0===i?void 0:i.texture)&&(this._attachedMesh.material.map=null)):this._target&&("alphaMap"===this.groundMapMode&&(this._attachedMesh.material.alphaMap=this._target.texture),"aoMap"===this.groundMapMode&&(this._attachedMesh.material.aoMap=this._target.texture),"map"===this.groundMapMode&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&"alphaMap"===this.groundMapMode,this._attachedMesh.material.alphaTest=e||"alphaMap"!==this.groundMapMode?0:.001,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}ou([Ce("randomizedLight")],au.prototype,"_light",void 0),ou([M(au.prototype.reset),Ce()],au.prototype,"maxFrameNumber",void 0),ou([M(au.prototype.reset),Ce()],au.prototype,"smoothShadow",void 0),ou([M(au.prototype._groundMapModeChanged),Ce()],au.prototype,"groundMapMode",void 0),ou([Ce(),M(au.prototype._alphaVignetteChanged)],au.prototype,"alphaVignette",void 0),ou([Ce(),M(au.prototype._alphaVignetteChanged)],au.prototype,"alphaVignetteAxis",void 0);var lu="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",cu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class uu extends i.Kj0{constructor(e,t,r=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new i.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(e,t,r)=>{if(this.enabled){e.vertexShader=e.vertexShader.replace("void main() {","void main() {\nvRefUv = refTextureMatrix * vec4( position, 1.0 );");const t="#glMarker beforeModulation";e.fragmentShader=e.fragmentShader.replace(t,"\n                    if(roughnessFactor < 0.95) {\n                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;\n                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));\n                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);\n                        // refBaseColor.rgb = vec3(refBaseColor.a);\n                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);\n                        "+(this.reflectorModePhysical?"\n                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 \n                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);\n                        #endif\n                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);\n                        ":"\n                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);\n                        diffuseColor.a *= refBaseColor.a;\n                        ")+"}\n"+t),e.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?"\n\t\tuniform mat4 refTextureMatrix;\n\t\tvarying vec4 vRefUv;\n":"",parsFragmentSnippet:()=>this.enabled?lu+"\n"+Oo+"\n#ifndef D_sceneBoundingRadius\n#define D_sceneBoundingRadius \nuniform float sceneBoundingRadius;\n#endif\nvarying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();\n#pragma unroll_loop_start\nfor(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}\n#pragma unroll_loop_end\nreturn vec4(colorSum/weightSum,1.);}":"",computeCacheKey:e=>this.enabled+" "+e.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(e,{materialObject:t})=>{t.userData.__lastTransparent!==t.transparent&&(t.needsUpdate=!0,t.userData.__lastTransparent=t.transparent)},isCompatible:e=>e.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const n=new i.JOQ,s=new i.Pa4,o=new i.Pa4,a=new i.Pa4,l=new i.yGw,c=new i.Pa4(0,0,-1),u=new i.Ltg,p=new i.Pa4,h=new i.Pa4,d=new i.Ltg,f=new i.yGw,g=new i.cPb;i.M8C.isPowerOfTwo(t.texture.image.width)&&i.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=((e,t,i)=>{if(!this.enabled||!e.userData.mainRenderPass)return;if(!this.reflectionTargetNeedsUpdate)return;const m=i.view?Object.assign({},i.view):null;if(m&&i.clearViewOffset&&i.clearViewOffset(),o.setFromMatrixPosition(this.matrixWorld),a.setFromMatrixPosition(i.matrixWorld),l.extractRotation(this.matrixWorld),s.set(0,0,1),s.applyMatrix4(l),p.subVectors(o,a),p.dot(s)>0)return;p.reflect(s).negate(),p.add(o),l.extractRotation(i.matrixWorld),c.set(0,0,-1),c.applyMatrix4(l),c.add(a),h.subVectors(o,c),h.reflect(s).negate(),h.add(o),g.position.copy(p),g.up.set(0,1,0),g.up.applyMatrix4(l),g.up.reflect(s),g.lookAt(h),g.far=2,g.near=0,g.updateMatrixWorld(),g.projectionMatrix.copy(i.projectionMatrix),f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(g.projectionMatrix),f.multiply(g.matrixWorldInverse),f.multiply(this.matrixWorld),n.setFromNormalAndCoplanarPoint(s,o),n.applyMatrix4(g.matrixWorldInverse),u.set(n.normal.x,n.normal.y,n.normal.z,n.constant);const _=g.projectionMatrix;d.x=(Math.sign(u.x)+_.elements[8])/_.elements[0],d.y=(Math.sign(u.y)+_.elements[9])/_.elements[5],d.z=-1,d.w=(1+_.elements[10])/_.elements[14],u.multiplyScalar(2/u.dot(d)),_.elements[2]=u.x,_.elements[6]=u.y,_.elements[10]=u.z+1-r,_.elements[14]=u.w,this.visible=!1;const v=e.getRenderTarget(),x=e.xr.enabled,A=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(this._renderTarget),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear();const b=t.background;this.transparentReflectionBackground&&(t.background=null);const y=!this.transparentReflectionBackground;b&&y&&(b.userData.flipX=!b.userData.flipX),W(e,{shadowMapRender:!1,backgroundRender:y,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>e.render(t,g)),b&&y&&(b.userData.flipX=!b.userData.flipX||void 0),this.transparentReflectionBackground&&(t.background=b),e.xr.enabled=x,e.shadowMap.autoUpdate=A,e.setRenderTarget(v),(null==m?void 0:m.enabled)&&i.setViewOffset&&i.setViewOffset(m.fullWidth,m.fullHeight,m.offsetX,m.offsetY,m.width,m.height);const w=i.viewport;void 0!==w&&e.state.viewport(w),this.visible=!0,this.reflectionTargetNeedsUpdate=!1}),this.textureMatrix=f,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new i.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=f}_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,null===(t=null===(e=this.materialExtension)||void 0===e?void 0:e.setDirty)||void 0===t||t.call(e)}getRenderTarget(){return this._renderTarget}}cu([M(uu.prototype._updateExtension)],uu.prototype,"enabled",void 0),cu([M(uu.prototype._updateExtension)],uu.prototype,"reflectorModePhysical",void 0),uu.prototype.isReflector=!0;var pu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class hu extends oo{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[so],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new i._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new i.Kj0(this._geometry)}async onAdded(e){var t,r;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(so);const i=this._createMesh();i.userData.physicsMass=0,this._iMesh=await(null===(t=this._manager)||void 0===t?void 0:t.addImportedSingle(i,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=null===(r=this._iMesh)||void 0===r?void 0:r.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,r;return this._geometry.dispose(),null===(r=null===(t=this._iMesh)||void 0===t?void 0:t.dispose)||void 0===r||r.call(t),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,t;this._material&&(null===(t=null===(e=this._manager)||void 0===e?void 0:e.materials)||void 0===t||t.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){!1!==e.geometryChanged&&!1!==e.updateGround&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const t=null===(e=this._viewer)||void 0===e?void 0:e.scene.activeCamera.controls;t&&(void 0!==t.maxPolarAngle?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=t.maxPolarAngle),t.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(t.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,t,r;if(!this._mesh)return;if(!this._viewer)return;let n=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,n=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const e=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const t=e.getCenter(new i.Pa4).sub(new i.Pa4(0,e.getSize(new i.Pa4).y/2+this.yOffset,0));(n=n||t.clone().sub(this._mesh.position).length()>1e-4)&&this._mesh.position.copy(t)}(n=n||Math.abs(this._mesh.scale.x-this.size)>1e-4)&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new i.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,null===(r=(t=this._mesh).setDirty)||void 0===r||r.call(t)),this._transformNeedRefresh=!1}else n&&(null===(e=this._viewer)||void 0===e||e.scene.setDirty())}_refreshMaterial(){var e,t,r,i,n,s,o,a;if(!this._viewer)return!1;if(!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const l=null===(t=null===(e=this._manager)||void 0===e?void 0:e.materials)||void 0===t?void 0:t.findOrCreate(null!==(i=null===(r=this._material)||void 0===r?void 0:r.uuid)&&void 0!==i?i:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let c=!1;return(null==l?void 0:l.uuid)!==(null===(n=this._material)||void 0===n?void 0:n.uuid)&&(this._removeMaterial(),l&&(this._material=l),(null===(s=this._material)||void 0===s?void 0:s.uuid)||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(null!==(a=null===(o=this._mesh)||void 0===o?void 0:o.setMaterial)&&void 0!==a?a:e=>{this._mesh&&(this._mesh.material=e.materialObject)})(this._material)),c=!0),this._material&&(void 0===this._material.userData.__renderToDepth&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),void 0===this._material.userData.__postTonemap&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),c}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return null===(e=this._material)||void 0===e?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}pu([Ce("material")],hu.prototype,"_material",void 0),pu([M(hu.prototype.refreshTransform),Ce()],hu.prototype,"visible",void 0),pu([M(hu.prototype._onSceneUpdate),Ce()],hu.prototype,"size",void 0),pu([M(hu.prototype._onSceneUpdate),Ce()],hu.prototype,"yOffset",void 0),pu([M(hu.prototype._refreshOptions2),Ce()],hu.prototype,"renderToDepth",void 0),pu([M(hu.prototype._refreshOptions2),Ce()],hu.prototype,"tonemapGround",void 0),pu([M(hu.prototype._refreshCameraLimits),Ce()],hu.prototype,"limitCameraAboveGround",void 0);var du=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class fu extends hu{constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=t,t&&this.dependencies.push(qc),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new uu(this._geometry,this._viewer.renderer.createTarget({type:i.ywz,format:i.wk1,encoding:i.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:i.D1R,magFilter:i.wem})),t=e.onBeforeRender;return e.onBeforeRender=((...e)=>{var r,i,n,s,o;let a=null===(i=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("SSReflection"))||void 0===i?void 0:i.passes.ssr.passObject;a&&!a.enabled&&(a=void 0),a&&(a.enabled=!1);let l=null===(o=null===(s=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("SSBevelPlugin"))||void 0===s?void 0:s.pass)||void 0===o?void 0:o.passObject;l&&!l.enabled&&(l=void 0),l&&(l.enabled=!1),t(...e),a&&(a.enabled=!0),l&&(l.enabled=!0)}),e}async onAdded(e){var t,r;await super.onAdded(e),this._showDebug&&(null===(t=e.getPlugin(qc))||void 0===t||t.addTexture("bake_ground_1",()=>{var e,t;return null===(t=null===(e=this._shadowBaker)||void 0===e?void 0:e.light.shadow.map)||void 0===t?void 0:t.texture},[100,100,200,200]),null===(r=e.getPlugin(qc))||void 0===r||r.addTexture("bake_ground_2",()=>{var e,t;return null===(t=null===(e=this._shadowBaker)||void 0===e?void 0:e.target)||void 0===t?void 0:t.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&(null===(e=this._shadowBaker)||void 0===e||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,r,i;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&(null===(t=(e=this._material).unregisterMaterialExtensions)||void 0===t||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const e=this._mesh.materialExtension;e||console.warn("unable to find the extension to unregister"),null===(i=(r=this._material).unregisterMaterialExtensions)||void 0===i||i.call(r,[e]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),!1!==e.geometryChanged&&(null===(t=this._shadowBaker)||void 0===t||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new au(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,t,r,i;if(!this._viewer)return!1;const n=super._refreshMaterial();if(!this._material)return n;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const r=this._mesh.materialExtension;r.updaters=[this._viewer.scene,this._viewer.renderer],null===(t=(e=this._material).registerMaterialExtensions)||void 0===t||t.call(e,[r]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&(null===(i=(r=this._material).registerMaterialExtensions)||void 0===i||i.call(r,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),n}_extraUiConfig(){var e,t,r,i,n,s,o,a,l,c,u,p,h,d,f,g,m,_,v,x,A,b,y,w,E,S,C,M,T,I;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var e,t;return null===(t=null===(e=this._uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var e;return!(null===(e=this._shadowBaker)||void 0===e?void 0:e.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(e=>({label:e,value:e})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[null===(e=this._shadowBaker)||void 0===e?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[null===(t=this._shadowBaker)||void 0===t?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[null===(i=null===(r=this._shadowBaker)||void 0===r?void 0:r.light)||void 0===i?void 0:i.shadowParams,"enabled"],onChange:[null===(s=null===(n=this._shadowBaker)||void 0===n?void 0:n.light)||void 0===s?void 0:s.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[null===(a=null===(o=this._shadowBaker)||void 0===o?void 0:o.light)||void 0===a?void 0:a.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[null===(c=null===(l=this._shadowBaker)||void 0===l?void 0:l.light)||void 0===c?void 0:c.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[null===(p=null===(u=this._shadowBaker)||void 0===u?void 0:u.light)||void 0===p?void 0:p.randomParams,"distanceScale"],onChange:[null===(d=null===(h=this._shadowBaker)||void 0===h?void 0:h.light)||void 0===d?void 0:d.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[null===(g=null===(f=this._shadowBaker)||void 0===f?void 0:f.light)||void 0===g?void 0:g.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[null===(_=null===(m=this._shadowBaker)||void 0===m?void 0:m.light)||void 0===_?void 0:_.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[null===(x=null===(v=this._shadowBaker)||void 0===v?void 0:v.light)||void 0===x?void 0:x.shadowParams,"radius"],onChange:[null===(b=null===(A=this._shadowBaker)||void 0===A?void 0:A.light)||void 0===b?void 0:b.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[null===(w=null===(y=this._shadowBaker)||void 0===y?void 0:y.light)||void 0===w?void 0:w.shadowParams,"frustumSize"],onChange:[null===(S=null===(E=this._shadowBaker)||void 0===E?void 0:E.light)||void 0===S?void 0:S.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[null===(M=null===(C=this._shadowBaker)||void 0===C?void 0:C.light)||void 0===M?void 0:M.shadowParams,"bias"],onChange:[null===(I=null===(T=this._shadowBaker)||void 0===T?void 0:T.light)||void 0===I?void 0:I.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}fu.PluginType="Ground",du([M(fu.prototype.refreshOptions),Ce()],fu.prototype,"bakedShadows",void 0),du([M(fu.prototype.refreshOptions),Ce()],fu.prototype,"groundReflection",void 0),du([M(fu.prototype.refreshOptions),Ce()],fu.prototype,"physicalReflections",void 0),du([Ce("shadowBaker")],fu.prototype,"_shadowBaker",void 0);var gu,mu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let _u=gu=class extends Ht{constructor(){super({vertexShader:n.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new i.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:Yt+"\nuniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;\n#if PASS_STEP == 0\nuniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}\n#endif\nvec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){\n#if PASS_STEP == 0 \ngl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;\n#elif PASS_STEP == 1 \ngl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;\n#elif PASS_STEP == 2 \ngl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;\n#elif PASS_STEP == 3 \nvec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;\n#elif PASS_STEP == 4 \nvec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;\n#endif\n#include <encodings_fragment>\n}"},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new i.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(e,t,r,n,s){const o=e.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const a=r;let l=.5,c=a.width*l,u=a.height*l;const p=[];let h=o.getTempTarget({sizeMultiplier:.5,type:i.cLu});p.push(h);let d=a;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(e,h,d,n,s),d=h;let f=1;for(;f<this.bloomIterations&&(l/=2,!((u/=2)<2||(c/=2)<2));f++){h=o.getTempTarget({sizeMultiplier:l,type:i.cLu}),p.push(h),this.material.defines.PASS_STEP=1;let t=this._weights[f];t=0!==this._weights[f-1]?this._weights[f]/this._weights[f-1]:this._weights[f],this.material.uniforms.weight.value=t,this.material.needsUpdate=!0,super.render(e,h,d,n,s),d=h}this.clear=!1;const g=e.autoClear;for(e.autoClear=!1,f-=2;f>=0;f--)h=p[f],p[f]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=i.WMw,this.material.needsUpdate=!0,e.autoClear=!1,super.render(e,h,d,n,s),this.material.blending=i.jFi,o.releaseTempTarget(d),d=h;this.clear=!0,e.autoClear=g,e.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(e,t,d,n,s)):(this.uniforms.tSource.value=a.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(e,t,d,n,s),this.uniforms.tSource.value=null),o.releaseTempTarget(d)}_updateWeights(){if(!this._weights)return;const e=Math.max(Math.min(this.radius,1),0),t=1/(this.bloomIterations-1);for(let r=0;r<this.bloomIterations;r++){let i=r*t+.1,n=1.2-i;i=Math.pow(i,this.power),n=Math.pow(n,this.power),this._weights[r]=n*(1-e)+i*e}this.setDirty()}};mu([z()],_u.prototype,"prefilter",void 0),mu([Je("Threshold",[0,2]),M(gu.prototype._thresholdsUpdated),Ce()],_u.prototype,"threshold",void 0),mu([Je("Soft Threshold",[0,1]),M(gu.prototype._thresholdsUpdated),Ce()],_u.prototype,"softThreshold",void 0),mu([Je("Intensity",[0,3]),Ce(),z()],_u.prototype,"intensity",void 0),mu([Je("Iterations",[0,7],1),M(gu.prototype._updateWeights),Ce()],_u.prototype,"bloomIterations",void 0),mu([Je("Radius",[0,1],.01),M(gu.prototype._updateWeights),Ce()],_u.prototype,"radius",void 0),mu([Je("Power",[.2,10],.01),M(gu.prototype._updateWeights),Ce()],_u.prototype,"power",void 0),mu([Ye("Debug")],_u.prototype,"bloomDebug",void 0),_u=gu=mu([ot("Bloom")],_u);class vu extends lo{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new _u}_update(e){var t,r;return null===(t=e.getPlugin(ho))||void 0===t||t.updateShaderProperties(null===(r=this.pass)||void 0===r?void 0:r.passObject.material),super._update(e)}get uiConfig(){var e;return null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig}}vu.PluginType="Bloom";var xu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Au=class extends oo{constructor(){super(),this.enabled=!0,this.dependencies=[so],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(e,t,r)=>{var n;if(!this.enabled||!t.materialObject.userData._isAnisotropic)return;const s=null===(n=t.materialObject.userData)||void 0===n?void 0:n._anisotropyDirectionMap,o=w`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${Oo}
                ${"uniform float anisotropyFactor;uniform float anisotropyNoise;\n#if ANISOTROPY_TEX_MODE == 0\nuniform float anisotropyDirection;\n#else\nuniform sampler2D anisotropyDirectionMap;\n#endif\nconst float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}"}
            `+(s?U("anisotropyDirectionMap",s,r.capabilities.isWebGL2):"");e.fragmentShader=e.fragmentShader.replace("#include <bsdfs>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",i.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("IncidentLight directLight;","float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;\n#if ANISOTROPY_TEX_MODE < 2\n#if ANISOTROPY_TEX_MODE == 0 \nfloat rot=saturate(anisotropyDirection);\n#else \nfloat rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);\n#endif\nrot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));\n#else \nvec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);\n#endif\nvec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;").replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const a=i.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_pars_fragment>",a);const l=w`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+i.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_maps>",l),e.vertexUvs=!0,e.vertexTangents=!0},onObjectRender:(e,t)=>{var r;const i=t.materialObject.userData;if(!(null==i?void 0:i._isAnisotropic))return;const n=e;if(!n.isMesh||!n.geometry)return;if(!n.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=i._anisotropyFactor,this._uniforms.anisotropyNoise.value=i._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(null===(r=i._anisotropyDirectionMap)||void 0===r?void 0:r.isTexture)?i._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=i._anisotropyDirection;let s=this.enabled?1:0;t.materialObject.defines.ANISOTROPY_ENABLED!==s&&(t.materialObject.defines.ANISOTROPY_ENABLED=s,t.materialObject.needsUpdate=!0),s=+this._defines.ANISOTROPY_DEBUG,t.materialObject.defines.ANISOTROPY_DEBUG!==s&&(t.materialObject.defines.ANISOTROPY_DEBUG=s,t.materialObject.needsUpdate=!0),s=i._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(s="CONSTANT"),s="DIRECTION"===s?2:"ROTATION"===s?1:0,t.materialObject.defines.ANISOTROPY_TEX_MODE!==s&&(t.materialObject.defines.ANISOTROPY_TEX_MODE=s,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,r,i;return(this.enabled?"1":"0")+((null===(t=e.materialObject.userData)||void 0===t?void 0:t._isAnisotropic)?"1":"0")+(null===(i=null===(r=e.materialObject.userData)||void 0===r?void 0:r._anisotropyDirectionMap)||void 0===i?void 0:i.uuid)},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e;return[null===(e=this._viewer)||void 0===e?void 0:e.renderer]},getUiConfig:e=>{const t=this._viewer,r=this.makeAnisotropic,i={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._isAnisotropic||!1},set value(n){var s;n!==e.materialObject.userData._isAnisotropic&&(n?r(e)||t.alert("One or more geometries cannot be made anisotropic."):(e.materialObject.userData._isAnisotropic=!1,e.materialObject.needsUpdate=!0),null===(s=i.uiRefresh)||void 0===s||s.call(i,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!e.materialObject.userData._isAnisotropic,property:[e.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(e=>({label:e})),onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}}]};return i}},this.setDirty=(()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()}),this.makeSelectedAnisotropic=(()=>{var e,t,r;const i=null===(r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject())||void 0===r?void 0:r.material;return"material"===(null==i?void 0:i.assetType)&&this.makeAnisotropic(i)}),this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(e){var t;const r=null===(t=e.materialObject)||void 0===t?void 0:t.userData;if(!r)return!1;if(void 0===r._isAnisotropic){const e=r.__appliedMeshes;let t=!0;if(e)for(const{geometry:r}of e)!r||r.index&&r.attributes.position&&r.attributes.normal&&r.attributes.uv||(t=!1),t&&!r.attributes.tangent&&r.computeTangents();if(!t)return!1}return r._isAnisotropic=!0,void 0===r._anisotropyFactor&&(r._anisotropyFactor=1),void 0===r._anisotropyNoise&&(r._anisotropyNoise=0),void 0===r._anisotropyDirectionMode&&(r._anisotropyDirectionMode="DIRECTION"),e.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(e=>new bu(e))}async onAdded(e){var t,r,i,n,s;await super.onAdded(e);const o=e.getPlugin(so);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(r=null==o?void 0:o.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(n=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===n?void 0:n.extensions)||void 0===s||s.push(yu)}async onRemove(e){var t,r,i,n;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.unregisterMaterialExtension(this.materialExtension),null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.importer)||void 0===n||n.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};Au.PluginType="AnisotropyPlugin",Au.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",xu([Ye("Enabled",e=>({onChange:e.setDirty})),Ce()],Au.prototype,"enabled",void 0),xu([et("Make Anisotropy",e=>({hidden:()=>{var t;return!(null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))}}))],Au.prototype,"makeSelectedAnisotropic",void 0),Au=xu([ot("Anisotropy Materials")],Au);class bu{constructor(e){this.parser=e,this.name=Au.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){var r,n,s;const o=this.parser,a=o.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const l=[],c=a.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=null!==(r=c.anisotropyFactor)&&void 0!==r?r:0,t.userData._anisotropyNoise=null!==(s=null!==(n=c.anisotropyNoiseFactor)&&void 0!==n?n:c.anisotropyNoise)&&void 0!==s?s:0;let{anisotropyDirectionMode:u,anisotropyDirection:p}=c;return u||(u=c.anisotropyTextureMode),p||(p=c.anisotropyRotation),t.userData._anisotropyDirectionMode=u&&"number"==typeof(null==p?void 0:p.index)?u:"CONSTANT","ROTATION"===u||"DIRECTION"===u?l.push(o.assignTexture(t.userData,"_anisotropyDirectionMap",p).then(e=>{e.encoding=i.knz})):t.userData._anisotropyDirection=null!=p?p:0,Promise.all(l)}afterRoot(e){return e.scene.traverse(e=>{var t,r;if(!(null===(r=null===(t=e.material)||void 0===t?void 0:t.userData)||void 0===r?void 0:r._isAnisotropic))return;const i=e.geometry;i.attributes.tangent||(i.computeTangents(),i.attributes.tangent.needsUpdate=!0)}),null}}const yu=e=>({writeMaterial:(t,r)=>{if(!t.isMeshStandardMaterial||!t.userData._isAnisotropic)return;if((t.userData._anisotropyFactor||0)<.001)return;r.extensions=r.extensions||{};const i={};if(i.anisotropyFactor=t.userData._anisotropyFactor||1,i.anisotropyNoiseFactor=t.userData._anisotropyNoise||0,i.anisotropyDirectionMode=t.userData._anisotropyDirectionMode||"CONSTANT",t.userData._anisotropyDirectionMap&&"CONSTANT"!==i.anisotropyDirectionMode){const r={index:e.processTexture(t.userData._anisotropyDirectionMap)};e.applyTextureTransform(r,t.userData._anisotropyDirectionMap),i.anisotropyDirection=r}else i.anisotropyDirectionMode="CONSTANT",i.anisotropyDirection=t.userData._anisotropyDirection||0;r.extensions[Au.ANISOTROPY_GLTF_EXTENSION]=i,e.extensionsUsed[Au.ANISOTROPY_GLTF_EXTENSION]=!0}});var wu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Eu=class extends oo{constructor(){super(),this.enabled=!0,this.dependencies=[so],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new i.Ltg},thinNoiseLayerFactors:{value:new i.Ltg},thinColorNoiseParams:{value:new i.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(e,t)=>{var r;return this.enabled&&(null===(r=null==t?void 0:t.materialObject.userData._thinFilmLayer)||void 0===r?void 0:r.hasThinFilm)?Oo+"\n#ifndef VORONOISE_HELPER\n#define VORONOISE_HELPER \nfloat voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}\n#endif\n\n#ifndef HSV_HELPERS\n#define HSV_HELPERS \nvec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}\n#endif \n\nuniform vec4 thinBaseLayerFactors;\nuniform vec4 thinNoiseLayerFactors;\nuniform vec4 thinColorNoiseParams;\nuniform float thinFilmFactor;\n        ":""},shaderExtender:(e,t,r)=>{var i;if(!this.enabled||!(null===(i=t.materialObject.userData._thinFilmLayer)||void 0===i?void 0:i.hasThinFilm))return;const n="#glMarker beforeAccumulation";e.fragmentShader=e.fragmentShader.replace(n,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+n),e.vertexUvs=!0},onObjectRender:(e,t)=>{var r;const i=null===(r=t.materialObject.userData)||void 0===r?void 0:r._thinFilmLayer;if(!(null==i?void 0:i.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(i.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(i.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(i.colorNoiseParams),this._uniforms.thinFilmFactor.value=i.filmFactor;const n=this.enabled?1:0;t.materialObject.defines.THIN_FILM_LAYER_ENABLED!==n&&(t.materialObject.defines.THIN_FILM_LAYER_ENABLED=n,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,r;return(this.enabled?"1":"0")+((null===(r=null===(t=e.materialObject.userData)||void 0===t?void 0:t._thinFilmLayer)||void 0===r?void 0:r.hasThinFilm)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,r={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)||!1},set value(i){var n,s;i!==(null===(n=e.materialObject.userData._thinFilmLayer)||void 0===n?void 0:n.hasThinFilm)&&(i?Su(e.materialObject)||t.alert("Cannot add thin film."):(e.materialObject.userData._thinFilmLayer.hasThinFilm=!1,e.materialObject.needsUpdate=!0),null===(s=r.uiRefresh)||void 0===s||s.call(r,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._thinFilmLayer)||void 0===t?void 0:t.hasThinFilm)},property:[e.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return r}},this.setDirty=(()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()}),this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(e){return Su(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(e=>new Cu(e))}async onAdded(e){var t,r,i,n,s;await super.onAdded(e);const o=e.getPlugin(so);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(r=null==o?void 0:o.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(n=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===n?void 0:n.extensions)||void 0===s||s.push(Mu)}async onRemove(e){var t,r,i,n;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.unregisterMaterialExtension(this.materialExtension),null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.importer)||void 0===n||n.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function Su(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._thinFilmLayer||(t._thinFilmLayer={});const r=t._thinFilmLayer;return r.hasThinFilm=!0,void 0===r.baseLayerFactors&&(r.baseLayerFactors=[.3,.6,1,.9]),void 0===r.noiseLayerFactors&&(r.noiseLayerFactors=[.7,.5,.9,.7]),void 0===r.colorNoiseParams&&(r.colorNoiseParams=[.5,.5,.5,.7]),void 0===r.filmFactor&&(r.filmFactor=.3),e.isMaterial&&(e.needsUpdate=!0),!0}Eu.PluginType="ThinFilmLayerPlugin",Eu.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",wu([Ye("Enabled",e=>({onChange:e.setDirty})),Ce()],Eu.prototype,"enabled",void 0),Eu=wu([ot("ThinFilmLayer Materials")],Eu);class Cu{constructor(e){this.parser=e,this.name=Eu.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.userData||(t.userData={}),Su(t),t.userData._thinFilmLayer=De(i,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const Mu=e=>({writeMaterial:(t,r)=>{if(!t.isMeshStandardMaterial||!t.userData._thinFilmLayer)return;if(!t.userData._thinFilmLayer.hasThinFilm)return;r.extensions=r.extensions||{};const i=ke(t.userData._thinFilmLayer,!1);r.extensions[Eu.THIN_FILM_LAYER_GLTF_EXTENSION]=i,e.extensionsUsed[Eu.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var Tu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Iu=class extends oo{constructor(){super(),this.enabled=!0,this.dependencies=[so],this._defines={},this._uniforms={noiseBumpParams:{value:new i.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(e,t)=>{var r;return this.enabled&&(null===(r=null==t?void 0:t.materialObject.userData._noiseBumpMat)||void 0===r?void 0:r.hasBump)?Oo+"\n#ifndef VORONOI_HELPER\n#define VORONOI_HELPER \nfloat voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}\n#endif\n\nuniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}\n":""},shaderExtender:(e,t,r)=>{var i;if(!this.enabled||!(null===(i=t.materialObject.userData._noiseBumpMat)||void 0===i?void 0:i.hasBump))return;const n="#glMarker beforeAccumulation";e.fragmentShader=e.fragmentShader.replace(n,"\n            vec3 outColor; \n            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);\n            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); \n            float avg = (outColor.r + outColor.g)*0.5; \n            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));\n            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);\n            roughnessFactor *= roughnessModifier;\n            \n"+n),e.vertexUvs=!0,e.extensionDerivatives=!0},onObjectRender:(e,t)=>{var r;const i=null===(r=t.materialObject.userData)||void 0===r?void 0:r._noiseBumpMat;if(!(null==i?void 0:i.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(i.bumpNoiseParams),this._uniforms.noiseBumpScale.value=i.bumpScale,this._uniforms.noiseBumpFlakeScale.value=i.flakeScale,this._uniforms.noiseFlakeClamp.value=i.flakeClamp,this._uniforms.noiseFlakeRadius.value=i.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=i.flakeRoughnessMod;const n=this.enabled?1:0;t.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==n&&(t.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=n,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,r;return(this.enabled?"1":"0")+((null===(r=null===(t=e.materialObject.userData)||void 0===t?void 0:t._noiseBumpMat)||void 0===r?void 0:r.hasBump)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,r={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)||!1},set value(i){var n,s;i!==(null===(n=e.materialObject.userData._noiseBumpMat)||void 0===n?void 0:n.hasBump)&&(i?ku(e.materialObject)||t.alert("Cannot add noise bump."):(e.materialObject.userData._noiseBumpMat.hasBump=!1,e.materialObject.needsUpdate=!0),null===(s=r.uiRefresh)||void 0===s||s.call(r,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var t;return!(null===(t=e.materialObject.userData._noiseBumpMat)||void 0===t?void 0:t.hasBump)},property:[e.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return r}},this.setDirty=(()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()}),this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(e){return ku(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(e=>new Du(e))}async onAdded(e){var t,r,i,n,s;await super.onAdded(e);const o=e.getPlugin(so);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(r=null==o?void 0:o.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(n=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===n?void 0:n.extensions)||void 0===s||s.push(Pu)}async onRemove(e){var t,r,i,n;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.unregisterMaterialExtension(this.materialExtension),null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.importer)||void 0===n||n.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function ku(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._noiseBumpMat||(t._noiseBumpMat={});const r=t._noiseBumpMat;return r.hasBump=!0,void 0===r.bumpNoiseParams&&(r.bumpNoiseParams=[.5,.5]),void 0===r.bumpScale&&(r.bumpScale=.05),void 0===r.flakeScale&&(r.flakeScale=.05),void 0===r.flakeClamp&&(r.flakeClamp=1),void 0===r.flakeRadius&&(r.flakeRadius=.3),void 0===r.flakeRoughnessMod&&(r.flakeRoughnessMod=1),e.isMaterial&&(e.needsUpdate=!0),!0}Iu.PluginType="NoiseBumpMaterialPlugin",Iu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",Tu([Ye("Enabled",e=>({onChange:e.setDirty})),Ce()],Iu.prototype,"enabled",void 0),Iu=Tu([ot("NoiseBumpMaterial Materials")],Iu);class Du{constructor(e){this.parser=e,this.name=Iu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.userData||(t.userData={}),ku(t),t.userData._noiseBumpMat=De(i,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const Pu=e=>({writeMaterial:(t,r)=>{if(!t.isMeshStandardMaterial||!t.userData._noiseBumpMat)return;if(!t.userData._noiseBumpMat.hasBump)return;r.extensions=r.extensions||{};const i=ke(t.userData._noiseBumpMat,!1);r.extensions[Iu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=i,e.extensionsUsed[Iu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var Bu,Ru=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Lu=Bu=class extends oo{constructor(){super(),this.enabled=!0,this.dependencies=[so],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new i.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(e,t)=>this.enabled&&(null==t?void 0:t.materialObject.userData._hasCustomBump)?"#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n#if CUSTOM_BUMP_MAP_BICUBIC > 0  \nvec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}\n#endif\nvarying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);\n#if CUSTOM_BUMP_MAP_BICUBIC > 0\nfloat Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;\n#else\nfloat Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;\n#endif\nreturn vec2(dBx,dBy);}\n#ifndef USE_BUMPMAP\nvec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}\n#endif\n#endif\n":"",shaderExtender:(e,t,r)=>{var i;this.enabled&&t.materialObject.userData._hasCustomBump&&(null===(i=t.materialObject.userData)||void 0===i?void 0:i._customBumpMap)&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker beforeAccumulation","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );\n#endif\n                ",{prepend:!0}),e.vertexShader=Jt(e.vertexShader,"#include <uv_pars_vertex>","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n                varying vec2 vCustomBumpUv;\n                uniform mat3 customBumpUvTransform;\n#endif\n                ",{prepend:!0}),e.vertexShader=Jt(e.vertexShader,"#include <uv_vertex>","\n#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0\n                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;\n#endif\n                ",{prepend:!0}),e.vertexUvs=!0)},onObjectRender:(e,t)=>{var r;const i=t.materialObject.userData;if(!(null==i?void 0:i._hasCustomBump))return;const n=e;if(!n.isMesh||!n.geometry)return;const s=(null===(r=i._customBumpMap)||void 0===r?void 0:r.isTexture)?i._customBumpMap:null;this._uniforms.customBumpMap.value=s,this._uniforms.customBumpScale.value=s?i._customBumpScale:0,s&&(s.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(s.matrix));let o=this.enabled&&s?1:0;t.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==o&&(t.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=o,t.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_DEBUG,t.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==o&&(t.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=o,t.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,t.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==o&&(t.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=o,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,r,i;return(this.enabled?"1":"0")+((null===(t=e.materialObject.userData)||void 0===t?void 0:t._hasCustomBump)?"1":"0")+(null===(i=null===(r=e.materialObject.userData)||void 0===r?void 0:r._customBumpMap)||void 0===i?void 0:i.uuid)},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,r=this.enableCustomBump,i={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return e.materialObject.userData._hasCustomBump||!1},set value(n){var s;n!==e.materialObject.userData._hasCustomBump&&(n?r(e)||t.alert("One or more geometries cannot be made anisotropic."):(e.materialObject.userData._hasCustomBump=!1,e.materialObject.needsUpdate=!0),null===(s=i.uiRefresh)||void 0===s||s.call(i,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!e.materialObject.userData._hasCustomBump,property:[e.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!e.materialObject.userData._hasCustomBump,property:[e.materialObject.userData,"_customBumpMap"],onChange:()=>{e.materialObject.needsUpdate=!0,this.setDirty()}},Ae(e.materialObject.userData,"_customBumpMap")]};return i}},this.setDirty=(()=>{var e,t,r;null===(t=(e=this.materialExtension).setDirty)||void 0===t||t.call(e),null===(r=this._viewer)||void 0===r||r.setDirty()}),this.enableCustomBumpSelected=(()=>{var e,t,r;const i=null===(r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject())||void 0===r?void 0:r.material;return"material"===(null==i?void 0:i.assetType)&&this.enableCustomBump(i)}),this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(e,t,r){var i,n;const s=null===(i=e.materialObject)||void 0===i?void 0:i.userData;if(!s)return!1;if(void 0===s._hasCustomBump){const e=s.__appliedMeshes;let t=!0;if(e)for(const{geometry:r}of e)!r||r.attributes.position&&r.attributes.normal&&r.attributes.uv||(t=!1);if(!t)return!1}return s._hasCustomBump=!0,s._customBumpScale=null!==(n=null!=r?r:s._customBumpScale)&&void 0!==n?n:.001,s._customBumpMap=null!=t?t:s._customBumpMap,e.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(e=>new Ou(e))}async onAdded(e){var t,r,i,n,s;await super.onAdded(e);const o=e.getPlugin(so);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(r=null==o?void 0:o.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(n=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===n?void 0:n.extensions)||void 0===s||s.push(Fu)}async onRemove(e){var t,r,i,n;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.unregisterMaterialExtension(this.materialExtension),null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.importer)||void 0===n||n.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};Lu.PluginType="CustomBumpMapPlugin",Lu.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",Ru([Ye("Enabled",e=>({onChange:e.setDirty})),Ce()],Lu.prototype,"enabled",void 0),Ru([Ye("Bicubic",e=>({onChange:e.setDirty})),V("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,Bu.prototype.setDirty),Ce()],Lu.prototype,"bicubicFiltering",void 0),Ru([et("Enable CustomBumpMap",e=>({hidden:()=>{var t;return!(null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))}}))],Lu.prototype,"enableCustomBumpSelected",void 0),Lu=Bu=Ru([ot("CustomBumpMap Materials")],Lu);class Ou{constructor(e){this.parser=e,this.name=Lu.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){var r;const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],a=s.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=null!==(r=a.customBumpScale)&&void 0!==r?r:0;const l=a.customBumpMap;return l&&o.push(n.assignTexture(t.userData,"_customBumpMap",l).then(e=>{e.encoding=i.knz})),Promise.all(o)}}const Fu=e=>({writeMaterial:(t,r)=>{if(!t.isMeshStandardMaterial||!t.userData._hasCustomBump)return;if((t.userData._customBumpScale||0)<.001)return;r.extensions=r.extensions||{};const i={};if(i.customBumpScale=t.userData._customBumpScale||1,t.userData._customBumpMap){const r={index:e.processTexture(t.userData._customBumpMap)};e.applyTextureTransform(r,t.userData._customBumpMap),i.customBumpMap=r}r.extensions[Lu.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=i,e.extensionsUsed[Lu.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var Uu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Nu=class extends oo{constructor(){super(),this.enabled=!0,this.dependencies=[so],this._defines={},this._uniforms={ccTintColor:{value:new xe},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(e,t)=>{var r;return this.enabled&&(null===(r=null==t?void 0:t.materialObject.userData._clearcoatTint)||void 0===r?void 0:r.enableTint)&&t.materialObject.clearcoat>0?"\nuniform vec3 ccTintColor;\nuniform float ccThickness;\nuniform float ccIor;\nvec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {\n    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.\n    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law\n    return mix(vec3(1.0), tint, clearcoat);\n}\n        ":""},shaderExtender:(e,t,r)=>{var i;if(!(this.enabled&&(null===(i=null==t?void 0:t.materialObject.userData._clearcoatTint)||void 0===i?void 0:i.enableTint)&&t.materialObject.clearcoat>0))return;const n="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",s="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";e.fragmentShader.includes(s)&&e.fragmentShader.includes(n)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),e.fragmentShader=e.fragmentShader.replace(s,"\n            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );\n            "),e.fragmentShader=e.fragmentShader.replace(n,"\n            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);\n            "+n),e.vertexUvs=!0},onObjectRender:(e,t)=>{var r;const i=null===(r=t.materialObject.userData)||void 0===r?void 0:r._clearcoatTint;if(!(null==i?void 0:i.enableTint))return;this._uniforms.ccTintColor.value.set(i.tintColor),this._uniforms.ccThickness.value=i.thickness,this._uniforms.ccIor.value=i.ior;const n=this.enabled?1:0;t.materialObject.defines.CLEARCOAT_TINT_ENABLED!==n&&(t.materialObject.defines.CLEARCOAT_TINT_ENABLED=n,t.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:e=>{var t,r;return(this.enabled?"1":"0")+((null===(r=null===(t=e.materialObject.userData)||void 0===t?void 0:t._clearcoatTint)||void 0===r?void 0:r.enableTint)?"1":"0")+(e.materialObject.clearcoat>0?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:e=>{const t=this._viewer,r={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)||!1},set value(i){var n,s;i!==(null===(n=e.materialObject.userData._clearcoatTint)||void 0===n?void 0:n.enableTint)&&(i?ju(e.materialObject)||t.alert("Cannot add clearcoat tint."):(e.materialObject.userData._clearcoatTint.enableTint=!1,e.materialObject.needsUpdate=!0),null===(s=r.uiRefresh)||void 0===s||s.call(r,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)},property:[e.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)},property:[e.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._clearcoatTint)||void 0===t?void 0:t.enableTint)},property:[e.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return r}},this.setDirty=(()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()}),this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(e){return ju(e.materialObject)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(e=>new Gu(e))}async onAdded(e){var t,r,i,n,s;await super.onAdded(e);const o=e.getPlugin(so);null===(t=null==o?void 0:o.materials)||void 0===t||t.registerMaterialExtension(this.materialExtension),null===(r=null==o?void 0:o.importer)||void 0===r||r.addEventListener("loaderCreate",this._loaderCreate),null===(s=null===(n=null===(i=null==o?void 0:o.exporter)||void 0===i?void 0:i.getExporter("gltf","glb"))||void 0===n?void 0:n.extensions)||void 0===s||s.push(zu)}async onRemove(e){var t,r,i,n;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.unregisterMaterialExtension(this.materialExtension),null===(n=null===(i=e.getPlugin(so))||void 0===i?void 0:i.importer)||void 0===n||n.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(e)}};function ju(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._clearcoatTint||(t._clearcoatTint={});const r=t._clearcoatTint;return r.enableTint=!0,void 0===r.tintColor&&(r.tintColor=16777215),void 0===r.thickness&&(r.thickness=.1),void 0===r.ior&&(r.ior=1.5),e.isMaterial&&(e.needsUpdate=!0),!0}Nu.PluginType="ClearcoatTintPlugin",Nu.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",Uu([Ye("Enabled",e=>({onChange:e.setDirty})),Ce()],Nu.prototype,"enabled",void 0),Nu=Uu([ot("ClearcoatTint Materials")],Nu);class Gu{constructor(e){this.parser=e,this.name=Nu.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.userData||(t.userData={}),ju(t),t.userData._clearcoatTint=De(i,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const zu=e=>({writeMaterial:(t,r)=>{if(!t.isMeshStandardMaterial||!t.userData._clearcoatTint)return;if(!t.userData._clearcoatTint.enableTint)return;r.extensions=r.extensions||{};const i=ke(t.userData._clearcoatTint,!1);r.extensions[Nu.CLEARCOAT_TINT_GLTF_EXTENSION]=i,e.extensionsUsed[Nu.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var Vu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Qu=class extends Wt{constructor(e,t,r){super(e,t,null!=r?r:new Hu,new xe(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(e,t,r,i,n){if(!this.enabled)return;const s=this.overrideMaterial;s.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(e,t,r,i,n),s.uniforms.lastProjectionViewMatrix.value.copy(s.uniforms.currentProjectionViewMatrix.value)}};Vu([Ye("Enabled")],Qu.prototype,"enabled",void 0),Qu=Vu([ot("Velocity Buffer (TAA)")],Qu);class Hu extends i.jyz{constructor(){super({vertexShader:"#ifdef USE_ALPHAMAP\n#define USE_UV \n#endif\n#include <uv_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){\n#include <uv_vertex>\n#include <skinbase_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\nvec4 mvPosition=vec4(transformed,1.);\n#ifdef USE_INSTANCING\nmvPosition=instanceMatrix*mvPosition;\n#endif\nvWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n}",fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new i.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new i.yGw},lastProjectionViewMatrix:{value:new i.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:(new i.yGw).identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,r,n,s){var o,a;const l=this._previousWorldMatrices[s.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(null!=l?l:s.matrixWorld),l?l.copy(s.matrixWorld):this._previousWorldMatrices[s.uuid]=s.matrixWorld.clone();let c=s.material;Array.isArray(c)&&(c=c[0]),this.uniforms.alphaMap.value=null!==(o=null==c?void 0:c.alphaMap)&&void 0!==o?o:null,this.uniforms.alphaTest.value=!c||!c.alphaTest||c.alphaTest<1e-7?.001:c.alphaTest;let u=this.uniforms.alphaMap.value?1:void 0;u!==this.defines.USE_ALPHAMAP&&(void 0===u?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=u,this.needsUpdate=!0),(u=c.userData.ALPHA_I_RGBA_PACKING?1:void 0)!==this.defines.ALPHA_I_RGBA_PACKING&&(void 0===u?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=u,this.needsUpdate=!0),this.side=null!==(a=c.side)&&void 0!==a?a:i.ehD}}class Wu extends lo{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:i.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const r=new Set,n=new Set;return new class extends Qu{render(i,s,o,a,l){if(e.renderer.frameCount>0)return;const c=i.getRenderTarget(),u=i.getActiveCubeFace(),p=i.getActiveMipmapLevel();this.scene.traverse(({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(r.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(n.add([e,e.transmission]),e.transmission=0))}),W(i,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(i,s,t,a,l)),r.forEach(e=>e.transparent=!e.transparent),r.clear(),n.forEach(([e,t])=>e.transmission=t),n.clear(),i.setRenderTarget(c,u,p)}}}_update(e){if(!super._update(e))return!1;if(e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var r;return e.renderer.disposeTarget(null===(r=null==t?void 0:t.dispose)||void 0===r?void 0:r.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t,r;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&null!==(r=null===(t=this.getVelocityBuffer())||void 0===t?void 0:t.texture)&&void 0!==r?r:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig}}Wu.PluginType="VelocityBuffer";class qu extends Ht{constructor(e,t){super({vertexShader:n.vertexShader,fragmentShader:t+"\n"+Ro+"\n#include <common>\nvarying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;\n#if HAS_VELOCITY_BUFFER == 1\nuniform sampler2D tVelocity;\n#endif\nvec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}\n#if HAS_VELOCITY_BUFFER == 0\nvec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}\n#endif\nvec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;\n#if QUALITY == 1\nvec3 c_frag=find_closest_fragment_3x3(vUv);\n#else\nvec3 c_frag=find_closest_fragment_5tap(vUv);\n#endif\nif(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);\n#if HAS_VELOCITY_BUFFER == 0\nvec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);\n#else\nvec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));\n#endif\ngl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}\n#include <encodings_fragment>\n}",uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new i.FM8},cameraNearFar:{value:new i.FM8},lastProjectionViewMatrix:{value:new i.yGw},currentProjectionViewMatrix:{value:new i.yGw},projection:{value:new i.yGw},inverseViewMatrix:{value:new i.yGw},jitterSample:{value:new i.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new i.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,r,i,n){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const s=this.uniforms.tVelocity.value?1:0;s!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=s,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,r,i,n),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}!function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ce(),z()],qu.prototype,"feedBack",void 0);class Xu extends lo{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[ho]}passCtor(e){if(!e.getPlugin(Po))throw"Add ProgressivePlugin before TAA";const t=new qu(e.getPlugin(Po).lastFrame,e.getPlugin(ho).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,r=this._pass.passObject;if(r.taaEnabled=t<1,!r.taaEnabled)return!1;const i=e.scene.activeCamera;return r.updateShaderProperties([e.getPlugin(ho),i,e.getPluginByType("VelocityBuffer")]),r.target=e.getPlugin(Po).lastFrame,r.updateCameraProperties(null==i?void 0:i.cameraObject),!0}get uiConfig(){var e;return null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig}}Xu.PluginType="TAA";class Yu{static async GetDataUrl(e,{mimeType:t="image/png",rect:r={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:i=1,scale:n=1}){var s,o,a;const l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");l.width=r.width*n*i,l.height=r.height*n*i,r.assumeClientRect&&(r.x*=e.width/(i*e.clientWidth),r.y*=e.height/(i*e.clientHeight),r.width*=e.width/(i*e.clientWidth),r.height*=e.height/(i*e.clientHeight));const c=l.getContext("2d");if(!c)return console.error("snapshot: cannot create context"),"";const u=e.style.background||(null===(s=e.parentElement)||void 0===s?void 0:s.style.background)||"";if(u.includes("url")){const t=null===(o=/url\("(.*)"\)/gi.exec(u))||void 0===o?void 0:o[1];if(t){const n=new Image;n.src=t,await new Promise((e,t)=>{n.onload=(()=>e()),n.onerror=(()=>t()),n.complete&&e()}),c.drawImage(n,n.width*r.x*i/e.width,n.height*r.y*i/e.height,n.width*r.width*i/e.width,n.height*r.height*i/e.height,0,0,l.width,l.height)}}else c.fillStyle=e.style.background||(null===(a=e.parentElement)||void 0===a?void 0:a.style.backgroundColor)||"#00000000",c.fillRect(0,0,l.width,l.height);null==c||c.drawImage(e,r.x*i,r.y*i,r.width*i,r.height*i,0,0,l.width,l.height);const p=c.canvas.toDataURL(t);return l.remove(),p}static async GetImage(e,t={}){const r=await this.GetDataUrl(e,t);return new Promise((e,t)=>{const i=new Image;i.onload=(()=>{e(i)}),i.src=r})}static async GetBlob(e,t={}){return await(await fetch(await this.GetDataUrl(e,t))).blob()}static async GetFile(e,t="image.png",r={}){var i;return r.getDataUrl?await this.GetDataUrl(e,r):new File([await this.GetBlob(e,r)],t,{type:null!==(i=r.mimeType)&&void 0!==i?i:"image/png",lastModified:kt()})}}var Ku=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Ju=class extends oo{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(e,t={}){return t.getDataUrl=!1,await this._getFile(e,t)}async getDataUrl(e={}){var t;return e.getDataUrl=!0,null!==(t=await this._getFile("",e))&&void 0!==t?t:""}async _getFile(e,t={}){var r,i,n;const s=null===(r=this._viewer)||void 0===r?void 0:r.canvas;if(s){const r=this._viewer.renderer.displayCanvasScaling;void 0!==t.displayPixelRatio&&t.displayPixelRatio!==r&&(this._viewer.renderer.displayCanvasScaling=t.displayPixelRatio);const o=null===(i=this._viewer)||void 0===i?void 0:i.getPlugin(Po);if(t.waitForProgressive&&o&&void 0===t.timeout)for(;!o.isConverged(!0);)await Tc(64);else await Tc(null!==(n=t.timeout)&&void 0!==n?n:200);t.displayPixelRatio=1;const a=await Yu.GetFile(s,e,t);return t.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=r,a}}async downloadSnapshot(e="snapshot.png",t={}){const r=await this.getFile(e,t);r&&yt(r)}};Ju.PluginType="CanvasSnipper",Ku([et("Download .png",{limitedUi:!0})],Ju.prototype,"downloadSnapshot",null),Ju=Ku([ot("Image Export")],Ju);var Zu=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let $u=1,ep=class{constructor(e,t,r,n,s){this.position=new i.Pa4,this.target=new i.Pa4,this.quaternion=new i._fP,this.up=new i.Pa4,this.name="Camera View",this.snap="",this.focusView=(()=>{}),this.deleteView=(()=>{}),this.uiConfig=st(this.name,this),e&&(this.position=e),t&&(this.target=t),r&&(this.up=r),n&&(this.quaternion=n),s&&(this.snap=s),this.name="Camera View"+$u++}_nameChanged(){var e,t;this.uiConfig&&(this.uiConfig.label=this.name,null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e))}};Zu([Ce(),Ze()],ep.prototype,"position",void 0),Zu([Ce(),Ze()],ep.prototype,"target",void 0),Zu([Ce(),Ze()],ep.prototype,"quaternion",void 0),Zu([Ce(),Ze()],ep.prototype,"up",void 0),Zu([Ce(),tt()],ep.prototype,"name",void 0),Zu([it()],ep.prototype,"snap",void 0),Zu([et()],ep.prototype,"focusView",void 0),Zu([et()],ep.prototype,"deleteView",void 0),ep=Zu([Be("CameraView")],ep);class tp extends oo{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=(e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)})),this.focusNext=((e=!0)=>{if(this._animating)return;if(this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(e=>e===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])}),this.focusPrevious=((e=!0)=>{if(this._animating)return;if(this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(e=>e===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])}),this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...nt(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const r=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera;if(!r)return;const n=new i.$V,s=r.position,o=r.target,a=(new i._fP).setFromUnitVectors(r.cameraObject.up,new i.Pa4(0,1,0)),l=a.clone().invert(),c=s.clone().sub(o);c.applyQuaternion(a),n.setFromVector3(c),n.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,n.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,n.makeSafe(),c.setFromSpherical(n),c.applyQuaternion(l),s.copy(o).add(c),r.positionUpdated(!1),r.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",e=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,t;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&(null===(e=this._viewer.getPluginByType("FrameFade"))||void 0===e||e.enable(tp.PluginType),this._fadeDisabled=!1));const r=kt()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=r-1/60);let i=r-this._lastFrameTime;this._lastFrameTime=r,i*=this.animateOnScroll?this._scrollAnimationState:1;const n=null===(t=this._viewer.getPluginByType("Progressive"))||void 0===t?void 0:t.postFrameConvergedRecordingDelta();if(n&&n>0&&(i=n),0!==n&&!((i*=1e3)<=0||(this._updaters.forEach(e=>{let t=i;e.time+t<0&&(t=-e.time),e.time+=t,Math.abs(t)>.001&&e.u(t)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled))){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(tp.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(0===this._viewQueue.length){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await Tc(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await Tc(2))}async recordAllViews(e){var t;if(!this.enabled)return;const r=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("CanvasRecorder");return r&&r.enabled&&!(this._cameraViews.length<1)&&(await this.resetToFirstView(),r.startRecording())?new Promise((t,i)=>{const n=()=>{r.removeEventListener("start",s),r.removeEventListener("stop",n),r.removeEventListener("error",o)},s=async()=>{n(),null==e||e(),await this.animateAllViews();const i=await r.stopRecording();i&&At(i,"recording.mp4"),t()},o=async()=>{n(),i()};r.addEventListener("start",s),r.addEventListener("stop",n),r.addEventListener("error",o)}):void 0}async addCurrentView(){var e,t,r,i,n;if(!this.enabled)return;const s=null===(e=this._viewer)||void 0===e?void 0:e.scene.activeCamera;if(!s)return;const o=this.getCurrentCameraView(s);o.snap=await(null===(r=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(Ju))||void 0===r?void 0:r.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push(o),null===(n=(i=this.uiConfig).uiRefresh)||void 0===n||n.call(i)}getCurrentCameraView(e){var t;if(e||(e=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera),!e)return new ep;const r=new i.Pa4,n=e.cameraObject.matrixWorld;r.x=n.elements[4],r.y=n.elements[5],r.z=n.elements[6];const s=new ep(e.position.clone(),e.target.clone(),r.normalize(),e.cameraObject.quaternion.clone(),"");return s.focusView=(async()=>this.focusView(s)),s.deleteView=(()=>this.deleteView(s)),s}async focusView(e){return this.animateToView(e)}deleteView(e){var t,r;const i=this._cameraViews.indexOf(e);i>=0&&this._cameraViews.splice(i,1),null===(r=(t=this.uiConfig).uiRefresh)||void 0===r||r.call(t)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return null===(t=null==e?void 0:e.stop)||void 0===t?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await Tc(100)}async animateToView(e,t,r){var n;const s=null===(n=this._viewer)||void 0===n?void 0:n.scene.activeCamera;if(!s)return;if(this._animating&&(this._popAnimations.forEach(e=>{var t;return null===(t=null==e?void 0:e.stop)||void 0===t?void 0:t.call(e)}),await Tc(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),void 0===t&&(t=this.animDuration);const o="function"==typeof r?r:Mc[r||this.animEase],a=this._driver,l=[];this._popAnimations=[];const c=this._popAnimations;if("spherical"===this.interpolateMode)l.push(async function(e,t,r,n,s,o){const a=e.target.clone(),l=new i.Pa4,c=new i.Pa4,u=rp(e.cameraObject,a),p=rp(t,t.target),h=new i.$V;return Bc({from:0,to:1,duration:r,ease:n,driver:s,onUpdate:r=>{h.phi=ip(u.phi,p.phi,r),h.theta=ip(u.theta,p.theta,r),h.radius=te(u.radius,p.radius,r),l.copy(a).lerp(t.target,r),c.setFromSpherical(h),c.add(l),e.position=c,e.target=l,e.positionUpdated(!1),e.targetUpdated()},onComplete:()=>{e.position=t.position,e.target=t.target,e.positionUpdated(!1),e.targetUpdated()}},o)}(s,e,t,o,a,c));else if("linear"===this.interpolateMode){l.push(Bc({from:s.position.clone(),to:e.position.clone(),duration:t,ease:o,driver:a,onUpdate:e=>s.position=e,onComplete:()=>s.position=e.position},c)),l.push(Bc({from:s.target.clone(),to:e.target.clone(),duration:t,ease:o,driver:a,onUpdate:e=>{s.target=e,s.targetUpdated()},onComplete:()=>{s.target=e.target,s.targetUpdated()}},c));const r=s.cameraObject.quaternion.clone(),n=new i._fP;l.push(Bc({from:0,to:1,duration:t,ease:o,driver:a,onUpdate:t=>{n.copy(r).slerp(e.quaternion,t),s.cameraObject.quaternion.copy(n),s.cameraObject.updateProjectionMatrix()},onComplete:()=>{s.cameraObject.quaternion.copy(e.quaternion),s.cameraObject.updateProjectionMatrix()}},c))}await Promise.all(l),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await Tc(10)}fromJSON(e,t){var r,i;return this._cameraViews.forEach(e=>this.deleteView(e)),super.fromJSON(e,t)?(this._cameraViews.forEach(e=>e.focusView=(async()=>this.focusView(e))),this._cameraViews.forEach(e=>e.deleteView=(()=>this.deleteView(e))),null===(i=(r=this.uiConfig).uiRefresh)||void 0===i||i.call(r),this):null}async animateToObject(e,t=4,r,n,s={min:.5,max:5}){if(!this._viewer)return;const o=(new k).expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),a=o.getCenter(new i.Pa4),l=o.getSize(new i.Pa4).length()/2;await this.animateToTarget(Math.min(s.max,Math.max(s.min,l*t)),a,r,n)}async animateToTarget(e,t,r,n){const s=this.getCurrentCameraView();s.target.copy(t);const o=(new i.Pa4).subVectors(s.target,s.position).normalize();s.position.copy(o.multiplyScalar(-e).add(s.target)),await this.animateToView(s,r,n)}}function rp(e,t){const r=e.position.clone();r.sub(t);const n=(new i.$V).setFromVector3(r);return n.makeSafe(),n}function ip(e,t,r){const i=t-e;return i>=Math.PI?e+(i-2*Math.PI)*r:i<=-Math.PI?e+(i+2*Math.PI)*r:e+i*r}function np(e,t,r){const i=(1-r)*Math.cos(e)+r*Math.cos(t),n=(1-r)*Math.sin(e)+r*Math.sin(t);return Math.atan2(n,i)}tp.PluginType="CameraViews",Zu([Ce("cameraViews")],tp.prototype,"_cameraViews",void 0),Zu([M(tp.prototype._animationLoop),Ce(),Ye("Loop All Views",{limitedUi:!0})],tp.prototype,"viewLooping",void 0),Zu([Ce(),tt("View Pause Time")],tp.prototype,"viewPauseTime",void 0),Zu([Ce(),$e("Ease",Object.keys(Mc).map(e=>({label:e})))],tp.prototype,"animEase",void 0),Zu([Ce(),Je("Duration",[10,1e4],10,{limitedUi:!0})],tp.prototype,"animDuration",void 0),Zu([Ce(),Je("RotationOffset",[.2,.75],.01)],tp.prototype,"rotationOffset",void 0),Zu([Ce(),$e("Interpolation",["spherical","linear"].map(e=>({label:e})))],tp.prototype,"interpolateMode",void 0),Zu([Ye(),Ce()],tp.prototype,"seekOnScroll",void 0),Zu([et("Animate All Views",{limitedUi:!0})],tp.prototype,"animateAllViews",null),Zu([et("Record All Views")],tp.prototype,"recordAllViews",null),Zu([et("Add Current View")],tp.prototype,"addCurrentView",null),Zu([et("Focus Next")],tp.prototype,"focusNext",void 0),Zu([et("Focus Previous")],tp.prototype,"focusPrevious",void 0);const sp=new i.Pa4;function op(e,t,r){let i=e.dot(t);i=Math.min(Math.max(i,-1),1);const n=Math.acos(i)*r;return sp.copy(e).multiplyScalar(i).sub(t).negate().normalize(),e.multiplyScalar(Math.cos(n)).add(sp.multiplyScalar(Math.sin(n)))}var ap=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class lp extends oo{constructor(e=!0){super(),this.enabled=!0,this.light=new iu("#cceeff",1),this.lightLayers=1,this._preRender=(()=>{var e,t,r;if(!this.enabled)return void(this.light.layers.mask=0);const i=null!==(t=null===(e=this._viewer)||void 0===e?void 0:e.renderer.frameCount)&&void 0!==t?t:0;(i<1||i>5)&&this.light.randomizePosition(i<5?0:i),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),null===(r=this._cameraHelper)||void 0===r||r.update()}),this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new i.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,r;e?null===(t=this._viewer)||void 0===t||t.scene.setDirty():null===(r=this._viewer)||void 0===r||r.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}lp.PluginType="RandomizedDirectionalLight",ap([Ce()],lp.prototype,"enabled",void 0),ap([Ce("rdLight")],lp.prototype,"light",void 0),ap([Ce()],lp.prototype,"lightLayers",void 0);var cp,up=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let pp=cp=class extends oo{constructor(e=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=e}_paramsChanged(){var e,t,r,n,s,o,a,l,c,u,p;const h=null===(e=this._viewer)||void 0===e?void 0:e.getBackground(!0);if(this.enabled&&h&&h!==yo)if(h.isDataTexture)h.mapping=i.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const e=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("SimpleBackgroundEnvUiPlugin1");e?(e.envmapBg=!0,null===(n=(r=e.uiConfig).uiRefresh)||void 0===n||n.call(r,"postFrame",!0)):null===(s=this._viewer)||void 0===s||s.setBackground(yo)}else this.enabled=!1;const d=null===(c=null===(l=null===(a=null===(o=this._viewer)||void 0===o?void 0:o.renderer)||void 0===a?void 0:a.rendererObject)||void 0===l?void 0:l.background.getBoxMesh2())||void 0===c?void 0:c.material,f=null!==(u=null==d?void 0:d.uniforms)&&void 0!==u?u:i.Vj0.cube.uniforms;f.tripodHeight||(f.tripodHeight={value:1}),f.worldRadius||(f.worldRadius={value:1}),f.tripodHeight.value=this.tripodHeight,f.worldRadius.value=this.worldRadius,d&&(!this.enabled&&d.defines.HDRi_GROUND_PROJ?delete d.defines.HDRi_GROUND_PROJ:this.enabled&&(d.defines.HDRi_GROUND_PROJ="1"),d.needsUpdate=!0),null===(p=this._viewer)||void 0===p||p.setDirty()}async onAdded(e){var t,r,n;await super.onAdded(e),(null===(n=null===(r=null===(t=this._viewer)||void 0===t?void 0:t.renderer)||void 0===r?void 0:r.rendererObject)||void 0===n?void 0:n.background.getBoxMesh())&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),i.Vj0.cube.fragmentShader=i.Vj0.cube.fragmentShader.replace("void main() {","\n#ifdef HDRi_GROUND_PROJ\nfloat intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}\n#define PI_HALF  1.5707963267948966\nuniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}\n#endif\n\nvoid main() {"),i.Vj0.cube.fragmentShader=i.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;","\nvec3 vReflect = \n#ifdef HDRi_GROUND_PROJ\nhdriProject()\n#else\nvWorldDirection\n#endif\n;\n"),e.scene.addEventListener("environmentChanged",this._paramsChanged)}};pp.PluginType="HDRiGroundPlugin",up([Ce(),M(cp.prototype._paramsChanged),Ye("Enabled")],pp.prototype,"enabled",void 0),up([Ce(),M(cp.prototype._paramsChanged),Je("World Radius",[1,1e3])],pp.prototype,"worldRadius",void 0),up([Ce(),M(cp.prototype._paramsChanged),Je("Tripod height",[0,50])],pp.prototype,"tripodHeight",void 0),pp=cp=up([ot("HDRi Ground")],pp);var hp=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const dp={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new i.FM8},cameraNearFar:{value:new i.FM8}},vertexShader:Bo,fragmentShader:Yt+"\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}\n#include <encodings_fragment>\n}"},fp=(Qt({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new i.FM8},direction:{value:new i.FM8}},vertexShader:Bo,fragmentShader:"#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);\n#include <encodings_fragment>\n}"},"colorTexture","cocTexture"),Qt({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new i.FM8},direction:{value:new i.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:Bo,fragmentShader:Oo+"\n"+lu+"\n#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));\n#ifdef DOF_MODE\nfloat blurDist=blurRadius*(2.*color.a-1.);\n#else\nfloat blurDist=blurRadius*color.a;\n#endif\nfloat rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();\n#pragma unroll_loop_start\nfor(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));\n#ifdef DOF_MODE\nsampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;\n#endif\ncolorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}\n#pragma unroll_loop_end\ncolorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();\n#include <encodings_fragment>\n}",defines:{DOF_MODE:1}},"colorTexture"));class gp extends Ht{constructor(){super(dp,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=fp,this.nearFarBlurScale=new i.FM8(.25,.25),this.focalDepthRange=new i.FM8(.5,1.5),this.crossCenter=new i.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new xe(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=Qt({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:Bo,fragmentShader:Yt+"\n#include <common>\n#include <packing>\nvarying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);\n#include <encodings_fragment>\n}"},"colorTexture"),this.expandCocMaterial=Qt({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new i.FM8},direction:{value:new i.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:Bo,fragmentShader:Yt+"\n#include <common>\nvarying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);\n#include <encodings_fragment>\n}"},"colorTexture")}render(e,t,r,n,s){if(!this.enabled)return;const o=e.baseRenderer,a={minFilter:i.TyD,magFilter:i.TyD,type:i.cLu,encoding:i.rnI,sizeMultiplier:.5,isAntialiased:!1,format:i.wk1,depthBuffer:!1,generateMipmaps:!1},l=o.getTempTarget(a),c=o.getTempTarget(a);if(this.computeCocMaterial.uniforms.colorTexture.value=r.texture,o.blit(void 0,l,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=l.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,c,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=c.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,l,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=l.texture,o.blit(void 0,c,{material:this.dofBlurMaterial});else{const e=o.getTempTarget(a);this.dofBlurMaterial.uniforms.cocTexture.value=l.texture,this.dofBlurMaterial.uniforms.colorTexture.value=l.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),o.blit(void 0,e,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=e.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),o.blit(void 0,c,{material:this.dofBlurMaterial}),o.releaseTempTarget(e)}this.material.uniforms.blurTexture.value=c.texture,this.material.uniforms.cocTexture.value=l.texture,super.render(e,t,r,n,s),o.releaseTempTarget(l),o.releaseTempTarget(c)}}hp([Ce(),z()],gp.prototype,"nearFarBlurScale",void 0),hp([Ce(),z()],gp.prototype,"focalDepthRange",void 0),hp([z()],gp.prototype,"crossCenter",void 0),hp([z()],gp.prototype,"crossRadius",void 0),hp([z()],gp.prototype,"crossAlpha",void 0),hp([z()],gp.prototype,"crossColor",void 0);var mp=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class _p extends lo{constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[ho],this.enableEdit=!1,this._focalPointHit=new i.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new i.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new gp}setFocalPoint(e,t=!0,r=!1){var i,n;this._focalPointHit.copy(e),t&&(null===(n=null===(i=this._viewer)||void 0===i?void 0:i.getPlugin(Rc))||void 0===n||n.startTransition(this._frameFadeTime)),r&&(this._focalPointHitTime=kt()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,t;return null!==(t=null===(e=this.pass)||void 0===e?void 0:e.passObject.focalDepthRange.y)&&void 0!==t?t:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,t;return null!==(t=null===(e=this.pass)||void 0===e?void 0:e.passObject.nearFarBlurScale.x)&&void 0!==t?t:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,t;return null!==(t=null===(e=this.pass)||void 0===e?void 0:e.passObject.nearFarBlurScale.y)&&void 0!==t?t:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,r;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,null===(r=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(Rc))||void 0===r||r.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPluginByType("Picking"))||void 0===t||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return null===(t=e.getPluginByType("Picking"))||void 0===t||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}_update(e){var t,r;if(!super._update(e))return!1;const n=null===(t=this.pass)||void 0===t?void 0:t.passObject;if(!n)return!1;const s=e.getPlugin(ho);null==s||s.updateShaderProperties(n.material),n.dofBlurMaterial.uniforms.frameCount&&(null===(r=e.renderer)||void 0===r||r.updateShaderProperties(n.dofBlurMaterial));const o=e.scene.activeCamera;if(!o)return!1;o.cameraObject.updateMatrixWorld(!0),o.updateShaderProperties(n.material),this._tempVec.subVectors(this._focalPointHit,o.cameraObject.position),n.focalDepthRange.x=this._tempVec.length(),n.focalDepthRange.x*=o.cameraObject.getWorldDirection(new i.Pa4).dot(this._tempVec.normalize());let a=(kt()-this._focalPointHitTime)/this.crossFadeTime;if(a=1-Math.min(1,Math.max(0,a)),Math.abs(a-n.crossAlpha)>.01&&(n.crossAlpha=a,this.setDirty()),a>0){const e=this._tempVec.copy(this._focalPointHit).project(o.cameraObject).addScalar(1).divideScalar(2);n.crossCenter.set(e.x,e.y),n.computeCocMaterial.uniformsNeedUpdate=!0,n.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,t,r,i,n;if(this._uiConfig)return this._uiConfig;const s=null===(t=null===(e=this._pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig;return s?(null===(i=null===(r=s.children)||void 0===r?void 0:r.map(e=>x(e)))||void 0===i||i.flat(2).forEach(e=>e&&(e.onChange=this.setDirty)),null===(n=s.children)||void 0===n||n.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=s,s):{}}}_p.PluginType="DepthOfField",mp([Ce()],_p.prototype,"enableEdit",void 0),mp([Ce("focalPoint")],_p.prototype,"_focalPointHit",void 0),mp([Ce()],_p.prototype,"crossFadeTime",void 0);var vp,xp=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Ap=vp=class extends oo{constructor(e=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[ho,so],this.materialExtension={shaderExtender:(e,t,r)=>{if(!e.defines.SSCS_ENABLED)return;const n=w`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,s=`\n#if SSCS_ENABLED\n\n    uniform float sscsIntensity;\n    uniform float sscsRadius;\n    uniform float sscsTolerance;\n\n    ${Lo}\n    \n    #define THREE_PACKING_INCLUDED\n    ${Ro}\n    \n    ${Yt}\n    ${Oo}\n    \n    ${Uo}\n\n#endif\n            \n            `+i.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${n}\n`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",s),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",i.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,r)=>{var i;const n=t.materialObject;let s=this.enabled&&!1!==r.userData.screenSpaceRendering&&!(null===(i=n.userData)||void 0===i?void 0:i.sscsDisabled)?1:0;n.defines.SSCS_ENABLED!==s&&(n.defines.SSCS_ENABLED=s,n.needsUpdate=!0),s=this._defines.SSCS_STEP_COUNT,n.defines.SSCS_STEP_COUNT!==s&&(n.defines.SSCS_STEP_COUNT=s,n.needsUpdate=!0),s=+this._defines.SSCS_DEBUG,n.defines.SSCS_DEBUG!==s&&(n.defines.SSCS_DEBUG=s,n.needsUpdate=!0)},parsFragmentSnippet:()=>"\n",extraUniforms:{...vp._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,r,i,n;return[null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(ho),null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(Po),null===(r=this._viewer)||void 0===r?void 0:r.scene.activeCamera,null===(i=this._viewer)||void 0===i?void 0:i.renderer,null===(n=this._viewer)||void 0===n?void 0:n.scene]}},this.enabled=e,this.userData={setDirty:()=>{var e;null===(e=this._viewer)||void 0===e||e.setDirty()}}}async onAdded(e){var t,r;await super.onAdded(e),null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.registerMaterialExtension(this.materialExtension)}async onRemove(e){var t,r;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.unregisterMaterialExtension(this.materialExtension),super.onRemove(e)}};Ap.PluginType="SSContactShadows",Ap._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new i.yGw},cameraPositionWorld:{value:new i.Pa4},cameraNearFar:{value:new i.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},xp([Ye("Enabled"),Ce()],Ap.prototype,"enabled",void 0),xp([z({uniforms:vp._uniforms,propKey:"sscsRadius"}),Je("Radius",[1e-4,.1],1e-4),Ce()],Ap.prototype,"radius",void 0),xp([z({uniforms:vp._uniforms,propKey:"sscsIntensity"}),Je("Intensity",[1e-4,1],1e-4),Ce()],Ap.prototype,"intensity",void 0),xp([z({uniforms:vp._uniforms,propKey:"sscsTolerance"}),Je("Tolerance",[.1,5]),Ce()],Ap.prototype,"tolerance",void 0),xp([V("SSCS_DEBUG",void 0,!0),Ye("Debug only SSCS"),Ce()],Ap.prototype,"onlySSCSDebug",void 0),xp([V("SSCS_STEP_COUNT",void 0,!0),Je("Step count",[1,8],1),Ce()],Ap.prototype,"stepCount",void 0),Ap=vp=xp([ot("Screen Space Contact Shadows")],Ap);class bp{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const r=this.workersResolve[e];if(r&&r(t),this.queue.length){const{resolve:t,msg:r,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(r=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=r,this.workers[i].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class yp{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class wp{constructor(e,t,r,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,i)}}new Uint8Array([0]);const Ep=[171,75,84,88,32,50,48,187,13,10,26,10];function Sp(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}let Cp,Mp,Tp;const Ip={env:{emscripten_notify_memory_growth:function(e){Tp=new Uint8Array(Mp.exports.memory.buffer)}}};class kp{init(){return Cp||(Cp="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Dp).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Ip)).then(this._init):WebAssembly.instantiate(Buffer.from(Dp,"base64"),Ip).then(this._init))}_init(e){Mp=e.instance,Ip.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Mp)throw new Error("ZSTDDecoder: Await .init() before decoding.");const r=e.byteLength,i=Mp.exports.malloc(r);Tp.set(e,i),t=t||Number(Mp.exports.ZSTD_findDecompressedSize(i,r));const n=Mp.exports.malloc(t),s=Mp.exports.ZSTD_decompress(n,t,i,r),o=Tp.slice(n,n+s);return Mp.exports.free(i),Mp.exports.free(n),o}}const Dp="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Pp=new WeakMap;let Bp,Rp=0;class Lp extends i.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new bp,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new i.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),r=new i.hH6(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const n=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([e,t])=>{const r=Lp.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(Lp.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Lp.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Lp.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator(()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})}),Rp>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Rp++}return this.transcoderPending}load(e,t,r,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new i.hH6(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,e=>{if(Pp.has(e))return Pp.get(e).promise.then(t).catch(n);this.createTexture(e).then(e=>t?t(e):null).catch(n)},r,n)}_createTextureFrom(e){const{mipmaps:t,width:r,height:n,format:s,type:o,error:a,dfdTransferFn:l,dfdFlags:c}=e;if("error"===o)return Promise.reject(a);const u=new i.EB7(t,r,n,s,i.ywz);return u.minFilter=1===t.length?i.wem:i.D1R,u.magFilter=i.wem,u.generateMipmaps=!1,u.needsUpdate=!0,u.encoding=2===l?i.knz:i.rnI,u.premultiplyAlpha=!!(1&c),u}createTexture(e,t={}){const r=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,Ep.length);if(t[0]!==Ep[0]||t[1]!==Ep[1]||t[2]!==Ep[2]||t[3]!==Ep[3]||t[4]!==Ep[4]||t[5]!==Ep[5]||t[6]!==Ep[6]||t[7]!==Ep[7]||t[8]!==Ep[8]||t[9]!==Ep[9]||t[10]!==Ep[10]||t[11]!==Ep[11])throw new Error("Missing KTX 2.0 identifier.");const r=new yp,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new wp(e,Ep.length,i,!0);r.vkFormat=n._nextUint32(),r.typeSize=n._nextUint32(),r.pixelWidth=n._nextUint32(),r.pixelHeight=n._nextUint32(),r.pixelDepth=n._nextUint32(),r.layerCount=n._nextUint32(),r.faceCount=n._nextUint32();const s=n._nextUint32();r.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),u=n._nextUint64(),p=n._nextUint64(),h=new wp(e,Ep.length+i,3*s*8,!0);for(let B=0;B<s;B++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+h._nextUint64(),h._nextUint64()),uncompressedByteLength:h._nextUint64()});const d=new wp(e,o,a,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},g=(f.descriptorBlockSize/4-6)/4;for(let B=0;B<g;B++){const e={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=d._nextInt32(),e.sampleUpper=d._nextInt32()):(e.sampleLower=d._nextUint32(),e.sampleUpper=d._nextUint32()),f.samples[B]=e}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(f);const m=new wp(e,l,c,!0);for(;m._offset<c;){const e=m._nextUint32(),t=m._scan(e),i=Sp(t),n=m._scan(e-t.byteLength);r.keyValue[i]=i.match(/^ktx/i)?Sp(n):n,m._offset%4&&m._skip(4-m._offset%4)}if(p<=0)return r;const _=new wp(e,u,p,!0),v=_._nextUint16(),x=_._nextUint16(),A=_._nextUint32(),b=_._nextUint32(),y=_._nextUint32(),w=_._nextUint32(),E=[];for(let B=0;B<s;B++)E.push({imageFlags:_._nextUint32(),rgbSliceByteOffset:_._nextUint32(),rgbSliceByteLength:_._nextUint32(),alphaSliceByteOffset:_._nextUint32(),alphaSliceByteLength:_._nextUint32()});const S=u+_._offset,C=S+A,M=C+b,T=M+y,I=new Uint8Array(e.buffer,e.byteOffset+S,A),k=new Uint8Array(e.buffer,e.byteOffset+C,b),D=new Uint8Array(e.buffer,e.byteOffset+M,y),P=new Uint8Array(e.buffer,e.byteOffset+T,w);return r.globalData={endpointCount:v,selectorCount:x,imageDescs:E,endpointsData:I,selectorsData:k,tablesData:D,extendedData:P},r}(new Uint8Array(e));if(0!==r.vkFormat)return async function(e){const{vkFormat:t,pixelWidth:r,pixelHeight:n,pixelDepth:s}=e;if(void 0===Op[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const o=e.levels[0];let a,l;if(0===e.supercompressionScheme)a=o.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Bp||(Bp=new Promise(async e=>{const t=new kp;await t.init(),e(t)})),a=(await Bp).decode(o.levelData,o.uncompressedByteLength)}l=Fp[t]===i.VzW?new Float32Array(a.buffer,a.byteOffset,a.byteLength/Float32Array.BYTES_PER_ELEMENT):Fp[t]===i.cLu?new Uint16Array(a.buffer,a.byteOffset,a.byteLength/Uint16Array.BYTES_PER_ELEMENT):a;const c=0===s?new i.IEO(l,r,n):new i.JUT(l,r,n,s);return c.type=Fp[t],c.format=Op[t],c.encoding=Up[t]||i.rnI,c.needsUpdate=!0,Promise.resolve(c)}(r);const n=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(e=>this._createTextureFrom(e.data));return Pp.set(e,{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Rp--,this}}Lp.BasisFormat={ETC1S:0,UASTC_4x4:1},Lp.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Lp.EngineFormat={RGBAFormat:i.wk1,RGBA_ASTC_4x4_Format:i.ptH,RGBA_BPTC_Format:i.bsb,RGBA_ETC2_EAC_Format:i.ekQ,RGBA_PVRTC_4BPPV1_Format:i.eaV,RGBA_S3TC_DXT5_Format:i.ILR,RGB_ETC1_Format:i.fto,RGB_ETC2_Format:i.l0P,RGB_PVRTC_4BPPV1_Format:i._AM,RGB_S3TC_DXT1_Format:i.wuA},Lp.BasisWorker=function(){let e,t,r;const i=_EngineFormat,n=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(o){const u=o.data;switch(u.type){case"init":e=u.config,p=u.transcoderBinary,t=new Promise(e=>{r={wasmBinary:p,onRuntimeInitialized:e},BASIS(r)}).then(()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(()=>{try{const{width:t,height:o,hasAlpha:p,mipmaps:h,format:d,dfdTransferFn:f,dfdFlags:g}=function(t){const o=new r.KTX2File(new Uint8Array(t));function u(){o.close(),o.delete()}if(!o.isValid())throw u(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const p=o.isUASTC()?s.UASTC_4x4:s.ETC1S,h=o.getWidth(),d=o.getHeight(),f=o.getLevels(),g=o.getHasAlpha(),m=o.getDFDTransferFunc(),_=o.getDFDFlags(),{transcoderFormat:v,engineFormat:x}=function(t,r,o,u){let p,h;const d=t===s.ETC1S?a:l;for(let i=0;i<d.length;i++){const n=d[i];if(e[n.if]&&n.basisFormat.includes(t)&&!(u&&n.transcoderFormat.length<2)&&(!n.needsPowerOfTwo||c(r)&&c(o)))return{transcoderFormat:p=n.transcoderFormat[u?1:0],engineFormat:h=n.engineFormat[u?1:0]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:p=n.RGBA32,engineFormat:h=i.RGBAFormat}}(p,h,d,g);if(!h||!d||!f)throw u(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw u(),new Error("THREE.KTX2Loader: .startTranscoding failed");const A=[];for(let e=0;e<f;e++){const t=o.getImageLevelInfo(e,0,0),r=t.origWidth,i=t.origHeight,n=new Uint8Array(o.getImageTranscodedSizeInBytes(e,0,0,v));if(!o.transcodeImage(n,e,0,0,v,0,-1,-1))throw u(),new Error("THREE.KTX2Loader: .transcodeImage failed.");A.push({data:n,width:r,height:i})}return u(),{width:h,height:d,hasAlpha:g,mipmaps:A,format:x,dfdTransferFn:m,dfdFlags:_}}(u.buffer),m=[];for(let e=0;e<h.length;++e)m.push(h[e].data.buffer);self.postMessage({type:"transcode",id:u.id,width:t,height:o,hasAlpha:p,mipmaps:h,format:d,dfdTransferFn:f,dfdFlags:g},m)}catch(e){console.error(e),self.postMessage({type:"error",id:u.id,error:e.message})}})}var p});const o=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),l=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||0==(e&e-1)&&0!==e}};const Op={109:i.wk1,97:i.wk1,37:i.wk1,43:i.wk1,103:i.av9,83:i.av9,16:i.av9,22:i.av9,100:i.hEm,76:i.hEm,15:i.hEm,9:i.hEm},Fp={109:i.VzW,97:i.cLu,37:i.ywz,43:i.ywz,103:i.VzW,83:i.cLu,16:i.ywz,22:i.ywz,100:i.VzW,76:i.cLu,15:i.ywz,9:i.ywz},Up={43:i.knz,22:i.knz,15:i.knz},Np="KHR_texture_basisu";class jp extends r{constructor(){super(...arguments),this.dependencies=[so]}async onAdded(e){var t,r,i,n;this._importer||(this._importer=new lr(class extends Lp{constructor(t){super(t),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(e,t){const r=e.map(e=>new Uint8Array(e.slice(0))),i=await super.createTexture(e,t);return i.source._sourceImgBuffer=r,i.userData.mimeType="image/ktx2",i}},["ktx2"],!1)),to.Importers.push(this._importer),null===(n=null===(i=null===(r=null===(t=e.getManager())||void 0===t?void 0:t.exporter)||void 0===r?void 0:r.getExporter("gltf","glb"))||void 0===i?void 0:i.extensions)||void 0===n||n.push(Gp)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&to.Importers.splice(to.Importers.indexOf(this._importer),1),this._importer=void 0}}jp.PluginType="KTX2LoadPlugin";const Gp=e=>({writeTexture:(t,r)=>{if("image/ktx2"!==t.userData.mimeType)return;if(void 0!==r.source)return void console.warn("ktx2 export: source already set");const i=t.source._sourceImgBuffer;if(!i||!i.length)return void console.warn("ktx2 export: no source buffer for ktx2");r.extensions=r.extensions||{};const n={},s=new Blob(Array.isArray(i)?i:[i],{type:"image/ktx2"});n.source=e.processImageBlob(s,t),r.extensions[Np]=n,e.extensionsUsed[Np]=!0}});class zp{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,t,r){var i,n;if(!t)return void(this.selected=void 0);let s=this.presets.find(e=>e.path===t.path);return s||(this.presets.push(t),s=t),this.selected=s,null===(n=null===(i=e.getManager())||void 0===i?void 0:i.importer)||void 0===n?void 0:n.importAsset(s,r)}}class Vp extends zp{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const r=await super.apply(e,t),n=null==r?void 0:r[0];return n&&(n.encoding=i.knz,await e.setBackground(n)),n}}class Qp extends zp{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const r=await super.apply(e,t),i=null==r?void 0:r[0];return i&&await e.scene.setEnvironment(i),i}}class Hp extends zp{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,t){const r=await super.apply(e,t),i=null==r?void 0:r[0];return m(e.getPluginByType("Diamond"),"envMap",i),i}}class Wp extends zp{async apply(e,t){var r,i;const n=await super.apply(e,t,{processImported:!1});return n?null===(i=null===(r=e.getManager())||void 0===r?void 0:r.importer)||void 0===i?void 0:i.processImported(n):void 0}}class qp extends Wp{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const r=await super.apply(e,t);return r&&await e.alert("Material Library successfully imported."),r}}class Xp extends oo{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(e=>({label:e.path.split("/").pop(),value:e.path}))],getValue:()=>{var t;return(null===(t=e.selected)||void 0===t?void 0:t.path)||""},setValue:t=>{e.apply(this._viewer,e.presets.find(e=>e.path===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();yt(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();yt(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,r;await super.onAdded(e),this.presetGroups.push(new Vp),this.presetGroups.push(new Qp),this.presetGroups.push(new Hp),this.presetGroups.push(new Wp("Ground")),this.presetGroups.push(new Wp("CameraViews")),this.presetGroups.push(new Wp("MaterialConfiguration")),this.presetGroups.push(new qp),null===(r=(t=this.uiConfig).uiRefresh)||void 0===r||r.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(e=>{var t;return[e.name,(null===(t=e.selected)||void 0===t?void 0:t.path)||void 0]}).filter(([,e])=>e));return e.type=Xp.PluginType,e}async fromJSON(e,t){var r,i;if(!super.fromJSON(e,t))return null;const n={...e};delete n.type;const s=[];for(const[o,a]of Object.entries(n)){const e=this.presetGroups.find(e=>e.name===o),t=null==e?void 0:e.presets;if(!e||!t)continue;const r="string"==typeof a?{path:a}:a;s.push(e.apply(this._viewer,r))}return await Promise.all(s),null===(i=(r=this.uiConfig).uiRefresh)||void 0===i||i.call(r,"postFrame",!0),this}loadPresetGroups(e){var t;for(const[r,i]of Object.entries(e)){const e=null===(t=this.presetGroups.find(e=>e.name===r))||void 0===t?void 0:t.presets;null==e||e.push(...i)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(e=>e.path)]).filter(([,e])=>e.length>0))}}Xp.PluginType="PresetLibraryPlugin";var Yp=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Kp=class extends oo{constructor(){super(),this.enabled=!0,this.dependencies=[so],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const e=await wt(!0,!1,"model/gltf");await this.loadScenes(e)}async loadScenes(e){var t,r;const i=await Promise.all(e.map(async e=>await e.arrayBuffer()));for(let n=0;n<e.length;n++){const t=e[n];this.scenes.push({[t.name]:new Uint8Array(i[n])}),this.assets[t.name]={path:t.name,file:t}}null===(r=null===(t=this.uiConfig)||void 0===t?void 0:t.uiRefresh)||void 0===r||r.call(t)}async play(){var e;if(!this._viewer)return;if(this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const t=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");null==t||t.enabled,t&&(t.enabled=!1);const r=this._viewer.getPluginByType("FrameFade"),i=this._viewer.getPluginByType("GLTFAnimation"),n=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const s of this.scenes){if(!this._isPlaying)break;const o=Object.keys(s);null==i||i.stopAnimation(!1),await(null==n?void 0:n.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const t of o){let r=this.assets[t];r||(r={path:t,file:new File([s[t]],t)},this.assets[t]=r),await(null===(e=this._viewer.getManager())||void 0===e?void 0:e.addAssetSingle(r,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,t&&(t.enabled=!1),r&&(r.enabled=!0,await r.startTransition(1e3));const a=[Tc(this.minSceneTime)];i&&a.push(i.playAnimation()),n&&a.push(n.animateAllViews()),await Promise.all(a)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const e={};for(const r of this.scenes)for(const t of Object.keys(r)){const i=e[t]?t+"_":t;e[i]=r[i]}const t=js(e);At(new Blob([t],{type:"application/zip"}),"scenes.glbloop")}async onAdded(e){await super.onAdded(e);const t=this;to.Importers.push(new lr(class extends qs{load(e,r,i,n){super.load(e,e=>{t.loadScenes([...e.values()]),null==r||r(null),Tc(100).then(t.play)},i,n)}},["glbloop"],!0))}};Kp.PluginType="SceneLoopPlugin",Yp([Ke("Loaded scenes")],Kp.prototype,"loadedScenes",null),Yp([et("Load Scenes")],Kp.prototype,"promptLoadScenes",null),Yp([Ke("Playing")],Kp.prototype,"_isPlaying",void 0),Yp([tt("Min Scene Time")],Kp.prototype,"minSceneTime",void 0),Yp([et("Play")],Kp.prototype,"play",null),Yp([et("Stop")],Kp.prototype,"stop",null),Yp([et("Download Scenes")],Kp.prototype,"downloadScenes",null),Kp=Yp([ot("Scene Loop")],Kp);var Jp=__webpackgi_require__(701),Zp=__webpackgi_require__.n(Jp),$p=__webpackgi_require__(236),eh=__webpackgi_require__.n($p),th=__webpackgi_require__(850),rh=__webpackgi_require__.n(th),ih=__webpackgi_require__(182),nh=__webpackgi_require__.n(ih),sh=__webpackgi_require__(213),oh=__webpackgi_require__.n(sh),ah=__webpackgi_require__(798),lh={};ah.Z&&ah.Z.locals&&(lh.locals=ah.Z.locals);var ch,uh=0,ph={};ph.styleTagTransform=oh(),ph.setAttributes=rh(),ph.insert=function(e,t){(t.target||document.head).appendChild(e)},ph.domAPI=eh(),ph.insertStyleElement=nh(),lh.use=function(e){return ph.options=e||{},uh++||(ch=Zp()(ah.Z,ph)),lh},lh.unuse=function(){uh>0&&!--uh&&(ch(),ch=null)};var hh=lh;class dh extends oo{constructor(e){super(),this.enabled=!0,this.dependencies=[so],this._mainDiv=Et({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=Et({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}async onAdded(e){var t,r,i,n;await super.onAdded(e),e.container.appendChild(this._mainDiv);const s=new Map;null===(r=null===(t=e.getManager())||void 0===t?void 0:t.importer)||void 0===r||r.addEventListener("importFile",e=>{"done"!==e.state?s.set(e.path,{state:e.state,progress:e.progress?100*e.progress:void 0}):s.delete(e.path),this._updateMainDiv(s)}),null===(n=null===(i=e.getManager())||void 0===i?void 0:i.exporter)||void 0===n||n.addEventListener("exportFile",e=>{"done"!==e.state?s.set(e.obj.name,{state:e.state,progress:e.progress?100*e.progress:void 0}):s.delete(e.obj.name),this._updateMainDiv(s)})}}!function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ye("Enabled"),M(dh.prototype._onEnabledChange),Ce()],dh.prototype,"enabled",void 0);let fh=class extends dh{constructor(){super("Popup");const e=Et({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});e.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(e)}_updateMainDiv(e){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let t="";e.forEach((e,r)=>{t+=`<span class="processState">${e.state}</span>: ${r.split("/").pop()} ${e.progress?" - "+e.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=t,0===e.size?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(e){hh.use({target:e.container}),await super.onAdded(e)}};fh.PluginType="AssetManagerBasicPopupPlugin",fh=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([ot("Asset manager popup")],fh);class gh extends Ht{constructor(e){super({vertexShader:n.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`\n                varying vec2 vUv;\n                ${e[0]}\n                void main() {\n                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));\n                    #glMarker\n                    ${e[1]}\n                }\n                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new zt}render(e,t,r,i,n){super.render(e,t,r,i,n),this.needsSwap=!0}}class mh extends lo{constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[ho],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}get renderToScreen(){return this._renderToScreen}async onAdded(e){var t,r;return(null===(r=null===(t=this._viewer)||void 0===t?void 0:t.screenShader)||void 0===r?void 0:r.isShaderPass2)&&(this._renderToScreen=!1),this._renderToScreen&&m(e.renderer.passes.find(e=>"screen"===e.passId),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var t,r,i,n;const s=e.screenShader,o=["",""];this._renderToScreen&&!s.isShaderPass2&&(o[0]=Array.isArray(s)?s[0]:(null===(t=s)||void 0===t?void 0:t.pars)||"",o[1]=Array.isArray(s)?s[1]:"string"==typeof s?s:(null===(r=s)||void 0===r?void 0:r.main)||"");const a=new gh(o);return m(null===(n=null===(i=a.uiConfig)||void 0===i?void 0:i.children)||void 0===n?void 0:n.find(e=>{var t;return"Enabled"===(null===(t=e)||void 0===t?void 0:t.label)}),"hidden",!0,!0),a}_update(e){var t;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties(null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(ho)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t,r;return null!==(r=null===(t=null===(e=this.pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig)&&void 0!==r?r:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}mh.PluginType="CombinedPostPlugin";var _h=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class vh extends oo{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[mh]}get uiConfig(){var e;return null===(e=this._extension)||void 0===e?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),null===(t=e.getPlugin(mh))||void 0===t||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}_h([Ce("extension")],vh.prototype,"_extension",void 0),_h([Ce()],vh.prototype,"enabled",void 0);class xh{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,r){this.enabled&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = LinearTosRGB(gl_FragColor);\n            #glMarker\n        "))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class Ah extends vh{generateExtension(e){return new xh}}function bh(e,t,r){return e&~(1<<t)|(r?1:0)<<t}function yh(e,t){return e&~(1<<t)}Ah.PluginType="GammaCorrection";var wh,Eh=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const Sh=i.dZ3;let Ch=wh=class{constructor(e,t=!0,r=!0){this.depthTonemap=t,this.toneMapping=i.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=((e,t)=>this.enabled?w`
            ${this.depthTonemap?Yt:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${"float getToneMapBit(in float number){return mod(floor(number/pow(2.,1.)),2.);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;\n#if USE_DEPTH_TONEMAP > 0\nbool doTonemap=getToneMapBit(getGBufferFlags(vUv).a*255.)>0.5;float depth=getDepth(vUv);\n#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0\nbool isBackground=depth>0.9999;if(isBackground)doTonemap=false;\n#endif\nif(doTonemap){\n#endif\n#if defined( TONE_MAPPING )\noutColor.rgb=toneMapping(outColor.rgb);\n#endif\n#if USE_DEPTH_TONEMAP > 0\n}else{\n#if TRANSPARENT_BACKGROUND > 0\nif(isBackground)outColor.a=0.;\n#endif\n}if(depth<0.00001)outColor.a=0.;\n#endif\nreturn outColor;}"}
        `:""),this._combinedPostPlugin=e.getPlugin(mh),this._setDirty=this._setDirty.bind(this),this._renderToScreen=r,this.depthTonemap=t}shaderExtender(e,t,r){this.enabled&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = ToneMapping(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,r){if(!this.enabled)return;const{toneMapping:n,toneMappingExposure:s,outputEncoding:o}=r;this._rendererState.toneMapping=n,this._rendererState.toneMappingExposure=s,this._rendererState.outputEncoding=o;let a=this.tonemapBackground?"1":"0";t.materialObject.defines.TONEMAP_BACKGROUND!==a&&(t.materialObject.defines.TONEMAP_BACKGROUND=a,t.materialObject.needsUpdate=!0),a=this.clipBackground?"1":"0",t.materialObject.defines.TRANSPARENT_BACKGROUND!==a&&(t.materialObject.defines.TRANSPARENT_BACKGROUND=a,t.materialObject.needsUpdate=!0),r.toneMapping=this.toneMapping,r.toneMappingExposure=this.exposure,r.outputEncoding=i.knz,t.materialObject.toneMapped=!0,t.materialObject.needsUpdate=!0}onAfterRender(e,t,r){r.toneMapping=this._rendererState.toneMapping,r.toneMappingExposure=this._rendererState.toneMappingExposure,r.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};Ch.PluginType="Tonemap",Eh([$e("Mode",[["Linear",i.EoG],["Reinhard",i.CdI],["Cineon",i.YGz],["ACESFilmic",i.LY2],["Uncharted2",Sh]].map(e=>({label:e[0],value:e[1]})),{limitedUi:!0}),M(wh.prototype._setDirty),Ce()],Ch.prototype,"toneMapping",void 0),Eh([M(wh.prototype._setDirty),Ye("Tonemap Background",{limitedUi:!0}),Ce()],Ch.prototype,"tonemapBackground",void 0),Eh([M(wh.prototype._setDirty),Ye("Clip Background"),Ce()],Ch.prototype,"clipBackground",void 0),Eh([M(wh.prototype._setDirty),Je("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Ce()],Ch.prototype,"exposure",void 0),Ch=wh=Eh([ot("Tonemapping")],Ch);class Mh extends vh{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPlugin(ho))||void 0===t||t.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new Ch(e,this.depthTonemap)}get exposure(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.exposure)&&void 0!==t?t:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.toneMapping)&&void 0!==t?t:i.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){var r,n;if(e instanceof i.Kj0&&(null===(r=e.material)||void 0===r?void 0:r.userData)){const r=!1===(null===(n=e.material)||void 0===n?void 0:n.userData.postTonemap)?0:1;t.w=bh(t.w,1,r)}}}Mh.PluginType="Tonemap",i.WdD.tonemapping_pars_fragment=i.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }","\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n\t// John Hable's filmic operator from Uncharted 2 video game\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }\n\n");var Th,Ih=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let kh=Th=class{constructor(e){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=((e,t)=>this.enabled?"#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)\nuniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;\n#if USE_3DTEXTURE == 1\nprecision highp sampler3D;\n#if USE_LUT == 1\nuniform sampler3D lut3d;\n#endif\n#if USE_LUT1 == 1\nuniform sampler3D lut3d1;\n#endif\n#if USE_LUT2 == 1\nuniform sampler3D lut3d2;\n#endif\n#else\n#if USE_LUT == 1\nuniform sampler2D lut2d;\n#endif\n#if USE_LUT1 == 1\nuniform sampler2D lut2d1;\n#endif\n#if USE_LUT2 == 1\nuniform sampler2D lut2d2;\n#endif\nvec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}\n#endif\nfloat getLUTBit(in float number){return mod(number,2.);}float getLUTIndex(in float number){return mod(number,8.);}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=step(0.0001,getLUTBit(getGBufferFlags(vUv).a*255.));float lutIndex=getLUTIndex(getGBufferFlags(vUv).g*255.);\n#if USE_3DTEXTURE == 1\nif(lutIndex==0.){\n#if USE_LUT == 1\noutColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);\n#endif\n}else if(lutIndex==1.){\n#if USE_LUT1 == 1\noutColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);\n#endif\n}else if(lutIndex==2.){\n#if USE_LUT2 == 1\noutColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);\n#endif\n}else{\n#if USE_LUT == 1\noutColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);\n#endif\n}\n#else\nif(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){\n#if USE_LUT1 == 1\noutColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);\n#endif\n}else if(lutIndex==2.){\n#if USE_LUT2 == 1\noutColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);\n#endif\n}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}\n#endif\noutColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}\n#endif\n":""),this._viewer=e,this._combinedPostPlugin=e.getPlugin(mh),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const e=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let t=e?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,t,this.extraUniforms.lutSize,e),this.extraDefines.USE_LUT=this.lutMap?1:0,t=e?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,t,this.extraUniforms.lutSize1,e),this.extraDefines.USE_LUT1=this.lutMap1?1:0,t=e?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,t,this.extraUniforms.lutSize2,e),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=e,this._setDirty()}_updateLUTMap(e,t,r,i){if(e){let n=1;1==i?(t.value=e.texture3D,n=e.texture3D.image.width):e.texture&&(t.value=e.texture,n=e.texture.image.width),t.value.needsUpdate=!0,r.value=n}}shaderExtender(e,t,r){this.enabled&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker"," \n            #if USE_LUT == 1\n                bool isBackground = getDepth(vUv)>0.9999;\n                #if LUT_BACKGROUND == 1\n                    gl_FragColor = colorLookUp(gl_FragColor);\n                #else\n                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);\n                #endif\n            #endif\n            #glMarker\n        "))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function Dh(e){const t=null==e?void 0:e.userData;if(!t)return!1;t[Ph.PluginType]||(t[Ph.PluginType]={});const r=t[Ph.PluginType];return r.enable=!0,void 0===r.index&&(r.index=0),e.isMaterial&&(e.needsUpdate=!0),!0}Ih([Ce(),M(Th.prototype._updateParams),Ye("Enable")],kh.prototype,"enabled",void 0),Ih([Ce(),M(Th.prototype._updateParams),Ye("LUT Background")],kh.prototype,"lutBackground",void 0),Ih([Ce(),M(Th.prototype._updateParams),Je("Intensity")],kh.prototype,"intensity",void 0),Ih([M(Th.prototype._updateParams),it("LUT"),Ce()],kh.prototype,"lutMap",void 0),Ih([M(Th.prototype._updateParams),it("LUT1"),Ce()],kh.prototype,"lutMap1",void 0),Ih([M(Th.prototype._updateParams),it("LUT2"),Ce()],kh.prototype,"lutMap2",void 0),kh=Th=Ih([ot("LUT")],kh);class Ph extends vh{constructor(){super(),this.materialExtension={uuid:We(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>{var t;return(this.enabled?"1":"0")+((null===(t=e.materialObject.userData[Ph.PluginType])||void 0===t?void 0:t.enable)?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}_getUiConfig(e){var t,r;const i={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var t,r;return null===(r=null===(t=e.materialObject.userData[Ph.PluginType])||void 0===t?void 0:t.enable)||void 0===r||r},set value(t){var r;const n=e.materialObject.userData[Ph.PluginType];t!==(null==n?void 0:n.enable)&&(n||Dh(e.materialObject),e.materialObject.userData[Ph.PluginType].enable=t,null===(r=i.uiRefresh)||void 0===r||r.call(i,"postFrame",!0))},onChange:null===(t=this._extension)||void 0===t?void 0:t.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(e=>({label:e[0],value:e[1]})),label:"index",hidden:()=>{const t=e.materialObject.userData[Ph.PluginType];return!!t&&!t.enable},get value(){var t,r;return null!==(r=null===(t=e.materialObject.userData[Ph.PluginType])||void 0===t?void 0:t.index)&&void 0!==r?r:0},set value(t){var r;e.materialObject.userData[Ph.PluginType]||Dh(e.materialObject),e.materialObject.userData[Ph.PluginType].index=t,null===(r=i.uiRefresh)||void 0===r||r.call(i,"postFrame",!0)},onChange:null===(r=this._extension)||void 0===r?void 0:r.setDirty}]};return i}async onAdded(e){var t,r;await super.onAdded(e),null===(t=e.getPlugin(ho))||void 0===t||t.registerGBufferUpdater(this.updateGBuffer);const i=e.getPlugin(so);null===(r=null==i?void 0:i.materials)||void 0===r||r.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new kh(e)}updateGBuffer(e,t){var r,n;if(e instanceof i.Kj0&&(null===(r=e.material)||void 0===r?void 0:r.userData)){const r=null===(n=e.material)||void 0===n?void 0:n.userData[Ph.PluginType];if(r){const e=!1===r.enable?0:1;t.w=bh(t.w,0,e);for(let r=0;r<3;r++)t.y=yh(t.y,r);let i=r.enable?r.index:0;i=Math.min(i,7),t.y=t.y|i}else t.w=bh(t.w,0,1)}}}Ph.PluginType="LUTPlugin1";var Bh,Rh=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Lh=Bh=class{constructor(e){this.enabled=!1,this.power=.5,this.bgcolor=new i.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new i.Ilk}},this.parsFragmentSnippet=((e,t)=>this.enabled?w`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:""),this._combinedPostPlugin=e.getPlugin(mh),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,r){this.enabled&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = Vignette(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,r){this.enabled&&(t.materialObject.uniforms.power.value=this.power,t.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};Lh.PluginType="Vignette",Rh([M(Bh.prototype._setDirty),Ye("Enable"),Ce()],Lh.prototype,"enabled",void 0),Rh([M(Bh.prototype._setDirty),Je("Power",[.1,4],.01,{limitedUi:!0}),Ce()],Lh.prototype,"power",void 0),Rh([M(Bh.prototype._setDirty),rt("Color"),Ce()],Lh.prototype,"bgcolor",void 0),Lh=Bh=Rh([ot("Vignette")],Lh);class Oh extends vh{constructor(){super()}generateExtension(e){return new Lh(e)}get power(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.power)&&void 0!==t?t:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.bgcolor)&&void 0!==t?t:new i.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}Oh.PluginType="Vignette";var Fh,Uh=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Nh=Fh=class{constructor(e){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=((e,t)=>this.enabled?w`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:""),this._combinedPostPlugin=e.getPlugin(mh),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,r){this.enabled&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = chromaticAberration();\n            #glMarker\n        "))}onObjectRender(e,t,r){this.enabled&&(t.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};Nh.PluginType="ChromaticAberration",Uh([M(Fh.prototype._setDirty),Ye("Enable"),Ce()],Nh.prototype,"enabled",void 0),Uh([M(Fh.prototype._setDirty),Je("Intensity",[0,.1],.001,{limitedUi:!0}),Ce()],Nh.prototype,"aberrationIntensity",void 0),Nh=Fh=Uh([ot("ChromaticAberration")],Nh);class jh extends vh{constructor(){super()}generateExtension(e){return new Nh(e)}get intensity(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.aberrationIntensity)&&void 0!==t?t:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}jh.PluginType="ChromaticAberration";var Gh,zh=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let Vh=Gh=class{constructor(e){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=((e,t)=>this.enabled?w`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:""),this._combinedPostPlugin=e.getPlugin(mh),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,r){this.enabled&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = grain(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,r){this.enabled&&(t.materialObject.uniforms.grainIntensity.value=this.grainIntensity,t.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}};zh([M(Gh.prototype._setDirty),Ye("Enable"),Ce()],Vh.prototype,"enabled",void 0),zh([M(Gh.prototype._setDirty),Ye("Multiply"),Ce()],Vh.prototype,"grainMultiply",void 0),zh([M(Gh.prototype._setDirty),Je("Intensity",[0,20],.01,{limitedUi:!0}),Ce()],Vh.prototype,"grainIntensity",void 0),Vh=Gh=zh([ot("FilmicGrain")],Vh);class Qh extends vh{constructor(){super()}generateExtension(e){return new Vh(e)}get intensity(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.grainIntensity)&&void 0!==t?t:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,t;return null!==(t=null===(e=this._extension)||void 0===e?void 0:e.grainMultiply)&&void 0!==t&&t}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}Qh.PluginType="FilmicGrain";var Hh=__webpackgi_require__(44),Wh={};Hh.Z&&Hh.Z.locals&&(Wh.locals=Hh.Z.locals);var qh,Xh=0,Yh={};Yh.styleTagTransform=oh(),Yh.setAttributes=rh(),Yh.insert=function(e,t){(t.target||document.head).appendChild(e)},Yh.domAPI=eh(),Yh.insertStyleElement=nh(),Wh.use=function(e){return Yh.options=e||{},Xh++||(qh=Zp()(Hh.Z,Yh)),Wh},Wh.unuse=function(){Xh>0&&!--Xh&&(qh(),qh=null)};var Kh=Wh;let Jh=class extends dh{constructor(e=!0){super("LoadingBar"),this.showText=e}_updateMainDiv(e){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let t=1,r=1;e.forEach((e,i)=>{var n;t+=null!==(n=e.progress)&&void 0!==n?n:99,r+=100}),this._contentDiv.innerHTML=this.showText?(100*t/r).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*t/r).toFixed(0)+"%",0===e.size?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(e){Kh.use({target:e.container}),await super.onAdded(e)}};async function Zh(e,{ground:t=!0,bloom:r=!0,depthTonemap:i=!0,enableDrop:n=!1}={}){await e.addPlugin(ho),await e.addPlugin(So),n&&await e.addPlugin(Mo),await e.addPlugin(new Po(32)),await e.addPlugin(new mh),await e.addPlugin(new jh),await e.addPlugin(new Mh(i||!e.useRgbm)),await e.addPlugin(new Ph),await e.addPlugin(new Oh),await e.addPlugin(new Qh),await e.addPlugin(new Ah),await e.addPlugin(Vo),await e.addPlugin(Xo),await e.addPlugin(jc),await e.addPlugin(Rc),await e.addPlugin(Qc),t&&await e.addPlugin(fu),r&&await e.addPlugin(vu),await e.addPlugin(Au),await e.addPlugin(Eu),await e.addPlugin(Iu),await e.addPlugin(Lu),await e.addPlugin(Nu),await e.addPlugin(Wu,!1),await e.addPlugin(Xu),await e.addPlugin(tp),await e.addPlugin(lp,!1),await e.addPlugin(pp,!1),await e.addPlugin(_p,!1),await e.addPlugin(Ap,!1),await e.addPlugin(jp),await e.addPlugin(Xp),await e.addPlugin(Kp)}async function $h(e,{debug:t=!1,ground:r=!0,bloom:i=!0,depthTonemap:n=!0,importPopup:s=!1,enableDrop:o=!1}={}){var a;const l=new bo(e);t&&await l.addPlugin(qc);const c=await l.addPlugin(so,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return s&&await l.addPlugin(fh),await l.addPlugin(Jh,!1),await Zh(l,{ground:r,bloom:i,depthTonemap:n,enableDrop:o}),l.renderer.refreshPipeline(),null===(a=c.importer)||void 0===a||a.processors.add("model",{forAssetType:"model",process:(e,t)=>e}),l}Jh.PluginType="AssetManagerLoadingBarPlugin",Jh=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([ot("Asset manager loading bar")],Jh);let ed=0;class td extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=ed++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=vt(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=E`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await $h({canvas:this.canvas,useRgbm:"true"===this._getAttr("rgbm","true"),useGBufferDepth:"true"===this._getAttr("depth-prepass","true")},{debug:"true"===this._getAttr("debug","false"),ground:"baked"===this._getAttr("ground","baked"),bloom:"true"===this._getAttr("bloom","true"),depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,t,r){console.log("WebGiViewerElement attributes changed.",e,t,r),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src)return;if(this._refreshingModels)return;this._refreshingModels=!0;const t=[e],r=[],i=[];for(const n of t)!this._models[n]&&n&&(this._models[n]=this.viewer.getManager().importer.importPath(n,{autoScale:"true"===this._getAttr("auto-scale","true"),autoCenter:"true"===this._getAttr("auto-center","true"),processImported:!1}));for(const[n,s]of Object.entries(this._models))t.includes(n)?r.push(s):i.push(s);await Promise.all([Promise.all(r).then(async e=>Promise.all(e.map(async e=>this.viewer.getManager().importer.processImported(e)))).then(e=>{for(const t of e)for(const e of t)e&&"model"===e.assetType&&this.viewer.scene.addSceneObject(e)}),Promise.all(i).then(e=>{for(const t of e)for(const e of t)e&&"model"===e.assetType&&e.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src)return;if(this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),r=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;r&&"texture"!==r.assetType||await this.viewer.scene.setEnvironment(r),null==t||t.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",td);class rd{constructor(e){var t,r,i;this._basePath=null!==(t=null==e?void 0:e.basePath)&&void 0!==t?t:"",this._assets=null!==(i=null===(r=null==e?void 0:e.assets)||void 0===r?void 0:r.map(e=>this._resolveAsset(e)))&&void 0!==i?i:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const t=this._assets.find(e);return null!=t?t:void 0}_resolveAsset(e){return{...e,path:xt([this._basePath,e.path])}}}class id extends r{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const r=t.find(t=>{var r,i;return t&&(e.test(t.path)||e.test(null!==(i=null===(r=t.file)||void 0===r?void 0:r.name)&&void 0!==i?i:""))});if(r)return r}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}var nd={},sd=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},od=function(e){return new Worker(e)};try{URL.revokeObjectURL(sd(""))}catch(eu){sd=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},od=function(e){return new Worker(e,{type:"module"})}}var ad=Uint8Array,ld=Uint16Array,cd=Uint32Array,ud=new ad([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pd=new ad([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hd=new ad([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dd=function(e,t){for(var r=new ld(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];var n=new cd(r[30]);for(i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return[r,n]},fd=dd(ud,2),gd=fd[0],md=fd[1];gd[28]=258,md[258]=28;for(var _d=dd(pd,0),vd=_d[0],xd=_d[1],Ad=new ld(32768),bd=0;bd<32768;++bd){var yd=(43690&bd)>>>1|(21845&bd)<<1;yd=(61680&(yd=(52428&yd)>>>2|(13107&yd)<<2))>>>4|(3855&yd)<<4,Ad[bd]=((65280&yd)>>>8|(255&yd)<<8)>>>1}var wd=function(e,t,r){for(var i=e.length,n=0,s=new ld(t);n<i;++n)++s[e[n]-1];var o,a=new ld(t);for(n=0;n<t;++n)a[n]=a[n-1]+s[n-1]<<1;if(r){o=new ld(1<<t);var l=15-t;for(n=0;n<i;++n)if(e[n])for(var c=n<<4|e[n],u=t-e[n],p=a[e[n]-1]++<<u,h=p|(1<<u)-1;p<=h;++p)o[Ad[p]>>>l]=c}else for(o=new ld(i),n=0;n<i;++n)e[n]&&(o[n]=Ad[a[e[n]-1]++]>>>15-e[n]);return o},Ed=new ad(288);for(bd=0;bd<144;++bd)Ed[bd]=8;for(bd=144;bd<256;++bd)Ed[bd]=9;for(bd=256;bd<280;++bd)Ed[bd]=7;for(bd=280;bd<288;++bd)Ed[bd]=8;var Sd=new ad(32);for(bd=0;bd<32;++bd)Sd[bd]=5;var Cd=wd(Ed,9,0),Md=wd(Ed,9,1),Td=wd(Sd,5,0),Id=wd(Sd,5,1),kd=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Dd=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},Pd=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Bd=function(e){return(e/8|0)+(7&e&&1)},Rd=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof ld?ld:e instanceof cd?cd:ad)(r-t);return i.set(e.subarray(t,r)),i},Ld=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new ad(0);var n=!t||r,s=!r||r.i;r||(r={}),t||(t=new ad(3*i));var o=function(e){var r=t.length;if(e>r){var i=new ad(Math.max(2*r,e));i.set(t),t=i}},a=r.f||0,l=r.p||0,c=r.b||0,u=r.l,p=r.d,h=r.m,d=r.n,f=8*i;do{if(!u){r.f=a=Dd(e,l,1);var g=Dd(e,l+1,3);if(l+=3,!g){var m=e[(M=Bd(l)+4)-4]|e[M-3]<<8,_=M+m;if(_>i){if(s)throw"unexpected EOF";break}n&&o(c+m),t.set(e.subarray(M,_),c),r.b=c+=m,r.p=l=8*_;continue}if(1==g)u=Md,p=Id,h=9,d=5;else{if(2!=g)throw"invalid block type";var v=Dd(e,l,31)+257,x=Dd(e,l+10,15)+4,A=v+Dd(e,l+5,31)+1;l+=14;for(var b=new ad(A),y=new ad(19),w=0;w<x;++w)y[hd[w]]=Dd(e,l+3*w,7);l+=3*x;var E=kd(y),S=(1<<E)-1,C=wd(y,E,1);for(w=0;w<A;){var M,T=C[Dd(e,l,S)];if(l+=15&T,(M=T>>>4)<16)b[w++]=M;else{var I=0,k=0;for(16==M?(k=3+Dd(e,l,3),l+=2,I=b[w-1]):17==M?(k=3+Dd(e,l,7),l+=3):18==M&&(k=11+Dd(e,l,127),l+=7);k--;)b[w++]=I}}var D=b.subarray(0,v),P=b.subarray(v);h=kd(D),d=kd(P),u=wd(D,h,1),p=wd(P,d,1)}if(l>f){if(s)throw"unexpected EOF";break}}n&&o(c+131072);for(var B=(1<<h)-1,R=(1<<d)-1,L=l;;L=l){var O=(I=u[Pd(e,l)&B])>>>4;if((l+=15&I)>f){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(O<256)t[c++]=O;else{if(256==O){L=l,u=null;break}var F=O-254;if(O>264){var U=ud[w=O-257];F=Dd(e,l,(1<<U)-1)+gd[w],l+=U}var N=p[Pd(e,l)&R],j=N>>>4;if(!N)throw"invalid distance";if(l+=15&N,P=vd[j],j>3&&(U=pd[j],P+=Pd(e,l)&(1<<U)-1,l+=U),l>f){if(s)throw"unexpected EOF";break}n&&o(c+131072);for(var G=c+F;c<G;c+=4)t[c]=t[c-P],t[c+1]=t[c+1-P],t[c+2]=t[c+2-P],t[c+3]=t[c+3-P];c=G}}r.l=u,r.p=L,r.b=c,u&&(a=1,r.m=h,r.d=p,r.n=d)}while(!a);return c==t.length?t:Rd(t,0,c)},Od=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8},Fd=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},Ud=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,s=r.slice();if(!n)return[Hd,0];if(1==n){var o=new ad(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var a=r[0],l=r[1],c=0,u=1,p=2;for(r[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=n-1;)a=r[r[c].f<r[p].f?c++:p++],l=r[c!=u&&r[c].f<r[p].f?c++:p++],r[u++]={s:-1,f:a.f+l.f,l:a,r:l};var h=s[0].s;for(i=1;i<n;++i)s[i].s>h&&(h=s[i].s);var d=new ld(h+1),f=Nd(r[u-1],d,0);if(f>t){i=0;var g=0,m=f-t,_=1<<m;for(s.sort(function(e,t){return d[t.s]-d[e.s]||e.f-t.f});i<n;++i){var v=s[i].s;if(!(d[v]>t))break;g+=_-(1<<f-d[v]),d[v]=t}for(g>>>=m;g>0;){var x=s[i].s;d[x]<t?g-=1<<t-d[x]++-1:++i}for(;i>=0&&g;--i){var A=s[i].s;d[A]==t&&(--d[A],++g)}f=t}return[new ad(d),f]},Nd=function(e,t,r){return-1==e.s?Math.max(Nd(e.l,t,r+1),Nd(e.r,t,r+1)):t[e.s]=r},jd=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new ld(++t),i=0,n=e[0],s=1,o=function(e){r[i++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++s;else{if(!n&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(n),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(n);s=1,n=e[a]}return[r.subarray(0,i),t]},Gd=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},zd=function(e,t,r){var i=r.length,n=Bd(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var s=0;s<i;++s)e[n+s+4]=r[s];return 8*(n+4+i)},Vd=function(e,t,r,i,n,s,o,a,l,c,u){Od(t,u++,r),++n[256];for(var p=Ud(n,15),h=p[0],d=p[1],f=Ud(s,15),g=f[0],m=f[1],_=jd(h),v=_[0],x=_[1],A=jd(g),b=A[0],y=A[1],w=new ld(19),E=0;E<v.length;++E)w[31&v[E]]++;for(E=0;E<b.length;++E)w[31&b[E]]++;for(var S=Ud(w,7),C=S[0],M=S[1],T=19;T>4&&!C[hd[T-1]];--T);var I,k,D,P,B=c+5<<3,R=Gd(n,Ed)+Gd(s,Sd)+o,L=Gd(n,h)+Gd(s,g)+o+14+3*T+Gd(w,C)+(2*w[16]+3*w[17]+7*w[18]);if(B<=R&&B<=L)return zd(t,u,e.subarray(l,l+c));if(Od(t,u,1+(L<R)),u+=2,L<R){I=wd(h,d,0),k=h,D=wd(g,m,0),P=g;var O=wd(C,M,0);for(Od(t,u,x-257),Od(t,u+5,y-1),Od(t,u+10,T-4),u+=14,E=0;E<T;++E)Od(t,u+3*E,C[hd[E]]);u+=3*T;for(var F=[v,b],U=0;U<2;++U){var N=F[U];for(E=0;E<N.length;++E){var j=31&N[E];Od(t,u,O[j]),u+=C[j],j>15&&(Od(t,u,N[E]>>>5&127),u+=N[E]>>>12)}}}else I=Cd,k=Ed,D=Td,P=Sd;for(E=0;E<a;++E)if(i[E]>255){j=i[E]>>>18&31,Fd(t,u,I[j+257]),u+=k[j+257],j>7&&(Od(t,u,i[E]>>>23&31),u+=ud[j]);var G=31&i[E];Fd(t,u,D[G]),u+=P[G],G>3&&(Fd(t,u,i[E]>>>5&8191),u+=pd[G])}else Fd(t,u,I[i[E]]),u+=k[i[E]];return Fd(t,u,I[256]),u+k[256]},Qd=new cd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Hd=new ad(0),Wd=function(e,t,r,i,n,s){var o=e.length,a=new ad(i+o+5*(1+Math.ceil(o/7e3))+n),l=a.subarray(i,a.length-n),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var p=u+65535;p<o?c=zd(l,c,e.subarray(u,p)):(l[u]=s,c=zd(l,c,e.subarray(u,o)))}else{for(var h=Qd[t-1],d=h>>>13,f=8191&h,g=(1<<r)-1,m=new ld(32768),_=new ld(g+1),v=Math.ceil(r/3),x=2*v,A=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<x)&g},b=new cd(25e3),y=new ld(288),w=new ld(32),E=0,S=0,C=(u=0,0),M=0,T=0;u<o;++u){var I=A(u),k=32767&u,D=_[I];if(m[k]=D,_[I]=k,M<=u){var P=o-u;if((E>7e3||C>24576)&&P>423){c=Vd(e,l,0,b,y,w,S,C,T,u-T,c),C=E=S=0,T=u;for(var B=0;B<286;++B)y[B]=0;for(B=0;B<30;++B)w[B]=0}var R=2,L=0,O=f,F=k-D&32767;if(P>2&&I==A(u-F))for(var U=Math.min(d,P)-1,N=Math.min(32767,u),j=Math.min(258,P);F<=N&&--O&&k!=D;){if(e[u+R]==e[u+R-F]){for(var G=0;G<j&&e[u+G]==e[u+G-F];++G);if(G>R){if(R=G,L=F,G>U)break;var z=Math.min(F,G-2),V=0;for(B=0;B<z;++B){var Q=u-F+B+32768&32767,H=Q-m[Q]+32768&32767;H>V&&(V=H,D=Q)}}}F+=(k=D)-(D=m[k])+32768&32767}if(L){b[C++]=268435456|md[R]<<18|xd[L];var W=31&md[R],q=31&xd[L];S+=ud[W]+pd[q],++y[257+W],++w[q],M=u+R,++E}else b[C++]=e[u],++y[e[u]]}}c=Vd(e,l,s,b,y,w,S,C,T,u-T,c),!s&&7&c&&(c=zd(l,c+1,Hd))}return Rd(a,0,i+Bd(c)+n)},qd=function(){for(var e=new cd(256),t=0;t<256;++t){for(var r=t,i=9;--i;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),Xd=function(){var e=-1;return{p:function(t){for(var r=e,i=0;i<t.length;++i)r=qd[255&r^t[i]]^r>>>8;e=r},d:function(){return~e}}},Yd=function(){var e=1,t=0;return{p:function(r){for(var i=e,n=t,s=r.length,o=0;o!=s;){for(var a=Math.min(o+2655,s);o<a;++o)n+=i+=r[o];i=(65535&i)+15*(i>>16),n=(65535&n)+15*(n>>16)}e=i,t=n},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},Kd=function(e,t,r,i,n){return Wd(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,i,!n)},Jd=function(e,t){var r={};for(var i in e)r[i]=e[i];for(var i in t)r[i]=t[i];return r},Zd=function(e,t,r){for(var i=e(),n=e.toString(),s=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=s[o];if("function"==typeof a){t+=";"+l+"=";var c=a.toString();if(a.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else for(var p in t+=c,a.prototype)t+=";"+l+".prototype."+p+"="+a.prototype[p].toString();else t+=c}else r[l]=a}return[t,r]},$d=[],ef=function(e,t,r,i){var n;if(!$d[r]){for(var s="",o={},a=e.length-1,l=0;l<a;++l)s=(n=Zd(e[l],s,o))[0],o=n[1];$d[r]=Zd(e[a],s,o)}var c=Jd({},$d[r][1]);return function(e,t,r,i,n){var s=od(nd[t]||(nd[t]=sd(e)));return s.onerror=function(e){return n(e.error,null)},s.onmessage=function(e){return n(null,e.data)},s.postMessage(r,i),s}($d[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,c,function(e){var t=[];for(var r in e)(e[r]instanceof ad||e[r]instanceof ld||e[r]instanceof cd)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(c),i)},tf=function(){return[ad,ld,cd,ud,pd,hd,gd,vd,Md,Id,Ad,wd,kd,Dd,Pd,Bd,Rd,Ld,Df,lf,cf]},rf=function(){return[ad,ld,cd,ud,pd,hd,md,xd,Cd,Ed,Td,Sd,Ad,Qd,Hd,wd,Od,Fd,Ud,Nd,jd,Gd,zd,Vd,Bd,Rd,Wd,Kd,Mf,lf]},nf=function(){return[_f,Af,mf,Xd,qd]},sf=function(){return[vf,xf]},of=function(){return[bf,mf,Yd]},af=function(){return[yf]},lf=function(e){return postMessage(e,[e.buffer])},cf=function(e){return e&&e.size&&new ad(e.size)},uf=function(e,t,r,i,n,s){var o=ef(r,i,n,function(e,t){o.terminate(),s(e,t)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},pf=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},hf=function(e,t,r,i,n){var s,o=ef(e,i,n,function(e,r){e?(o.terminate(),t.ondata.call(t,e)):(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1]))});o.postMessage(r),t.push=function(e,r){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,s=r],[e.buffer])},t.terminate=function(){o.terminate()}},df=function(e,t){return e[t]|e[t+1]<<8},ff=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},gf=function(e,t){return ff(e,t)+4294967296*ff(e,t+4)},mf=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},_f=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&mf(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var i=0;i<=r.length;++i)e[i+10]=r.charCodeAt(i)}},vf=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[r++]);return r+(2&t)},xf=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Af=function(e){return 10+(e.filename&&e.filename.length+1||0)},bf=function(e,t){var r=t.level,i=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},yf=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function wf(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Ef=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(Kd(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Sf=function(e,t){hf([rf,function(){return[pf,Ef]}],this,wf.call(this,e,t),function(e){var t=new Ef(e.data);onmessage=pf(t)},6)};function Cf(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uf(e,t,[rf],function(e){return lf(Mf(e.data[0],e.data[1]))},0,r)}function Mf(e,t){return Kd(e,t||{},0,0)}var Tf=function(){function e(e){this.s={},this.p=new ad(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new ad(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=Ld(this.p,this.o,this.s);this.ondata(Rd(r,t,this.s.b),this.d),this.o=Rd(r,this.s.b-32768),this.s.b=this.o.length,this.p=Rd(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),If=function(e){this.ondata=e,hf([tf,function(){return[pf,Tf]}],this,0,function(){var e=new Tf;onmessage=pf(e)},7)};function kf(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uf(e,t,[tf],function(e){return lf(Df(e.data[0],cf(e.data[1])))},1,r)}function Df(e,t){return Ld(e,t)}var Pf=function(){function e(e,t){this.c=Xd(),this.l=0,this.v=1,Ef.call(this,e,t)}return e.prototype.push=function(e,t){Ef.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=Kd(e,this.o,this.v&&Af(this.o),t&&8,!t);this.v&&(_f(r,this.o),this.v=0),t&&(mf(r,r.length-8,this.c.d()),mf(r,r.length-4,this.l)),this.ondata(r,t)},e}(),Bf=function(e,t){hf([rf,nf,function(){return[pf,Ef,Pf]}],this,wf.call(this,e,t),function(e){var t=new Pf(e.data);onmessage=pf(t)},8)};function Rf(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uf(e,t,[rf,nf,function(){return[Lf]}],function(e){return lf(Lf(e.data[0],e.data[1]))},2,r)}function Lf(e,t){t||(t={});var r=Xd(),i=e.length;r.p(e);var n=Kd(e,t,Af(t),8),s=n.length;return _f(n,t),mf(n,s-8,r.d()),mf(n,s-4,i),n}var Of=function(){function e(e){this.v=1,Tf.call(this,e)}return e.prototype.push=function(e,t){if(Tf.prototype.e.call(this,e),this.v){var r=this.p.length>3?vf(this.p):4;if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Tf.prototype.c.call(this,t)},e}(),Ff=function(e){this.ondata=e,hf([tf,sf,function(){return[pf,Tf,Of]}],this,0,function(){var e=new Of;onmessage=pf(e)},9)};function Uf(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uf(e,t,[tf,sf,function(){return[Nf]}],function(e){return lf(Nf(e.data[0]))},3,r)}function Nf(e,t){return Ld(e.subarray(vf(e),-8),t||new ad(xf(e)))}var jf=function(){function e(e,t){this.c=Yd(),this.v=1,Ef.call(this,e,t)}return e.prototype.push=function(e,t){Ef.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=Kd(e,this.o,this.v&&2,t&&4,!t);this.v&&(bf(r,this.o),this.v=0),t&&mf(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),Gf=function(e,t){hf([rf,of,function(){return[pf,Ef,jf]}],this,wf.call(this,e,t),function(e){var t=new jf(e.data);onmessage=pf(t)},10)};function zf(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uf(e,t,[rf,of,function(){return[Vf]}],function(e){return lf(Vf(e.data[0],e.data[1]))},4,r)}function Vf(e,t){t||(t={});var r=Yd();r.p(e);var i=Kd(e,t,2,4);return bf(i,t),mf(i,i.length-4,r.d()),i}var Qf=function(){function e(e){this.v=1,Tf.call(this,e)}return e.prototype.push=function(e,t){if(Tf.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Tf.prototype.c.call(this,t)},e}(),Hf=function(e){this.ondata=e,hf([tf,af,function(){return[pf,Tf,Qf]}],this,0,function(){var e=new Qf;onmessage=pf(e)},11)};function Wf(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uf(e,t,[tf,af,function(){return[qf]}],function(e){return lf(qf(e.data[0],cf(e.data[1])))},5,r)}function qf(e,t){return Ld((yf(e),e.subarray(2,-4)),t)}var Xf=function(){function e(e){this.G=Of,this.I=Tf,this.Z=Qf,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new ad(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,n=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(n):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(n):new this.Z(n),this.s.push(this.p,t),this.p=null}}},e}(),Yf=function(){function e(e){this.G=Ff,this.I=If,this.Z=Hf,this.ondata=e}return e.prototype.push=function(e,t){Xf.prototype.push.call(this,e,t)},e}();function Kf(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Uf(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?kf(e,t,r):Wf(e,t,r)}function Jf(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Nf(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Df(e,t):qf(e,t)}var Zf=function(e,t,r,i){for(var n in e){var s=e[n],o=t+n;s instanceof ad?r[o]=[s,i]:Array.isArray(s)?r[o]=[s[0],Jd(i,s[1])]:Zf(s,o+"/",r,i)}},$f="undefined"!=typeof TextEncoder&&new TextEncoder,eg="undefined"!=typeof TextDecoder&&new TextDecoder,tg=0;try{eg.decode(Hd,{stream:!0}),tg=1}catch(eu){}var rg=function(e){for(var t="",r=0;;){var i=e[r++],n=(i>127)+(i>223)+(i>239);if(r+n>e.length)return[t,Rd(e,r-1)];n?3==n?(i=((15&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|i>>10,56320|1023&i)):t+=1&n?String.fromCharCode((31&i)<<6|63&e[r++]):String.fromCharCode((15&i)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(i)}},ig=function(){function e(e){this.ondata=e,tg?this.t=new TextDecoder:this.p=Hd}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var r=new ad(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var i=rg(r),n=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(n,t)}},e}(),ng=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(sg(e),this.d=t||!1)},e}();function sg(e,t){if(t){for(var r=new ad(e.length),i=0;i<e.length;++i)r[i]=e.charCodeAt(i);return r}if($f)return $f.encode(e);var n=e.length,s=new ad(e.length+(e.length>>1)),o=0,a=function(e){s[o++]=e};for(i=0;i<n;++i){if(o+5>s.length){var l=new ad(o+8+(n-i<<1));l.set(s),s=l}var c=e.charCodeAt(i);c<128||t?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(a(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++i))>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return Rd(s,0,o)}function og(e,t){if(t){for(var r="",i=0;i<e.length;i+=16384)r+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return r}if(eg)return eg.decode(e);var n=rg(e),s=n[0];if(n[1].length)throw"invalid utf-8 data";return s}var ag=function(e){return 1==e?3:e<6?2:9==e?1:0},lg=function(e,t){return t+30+df(e,t+26)+df(e,t+28)},cg=function(e,t,r){var i=df(e,t+28),n=og(e.subarray(t+46,t+46+i),!(2048&df(e,t+8))),s=t+46+i,o=ff(e,t+20),a=r&&4294967295==o?ug(e,s):[o,ff(e,t+24),ff(e,t+42)],l=a[0],c=a[1],u=a[2];return[df(e,t+10),l,c,n,s+df(e,t+30)+df(e,t+32),u]},ug=function(e,t){for(;1!=df(e,t);t+=4+df(e,t+2));return[gf(e,t+12),gf(e,t+4),gf(e,t+20)]},pg=function(e){var t=0;if(e)for(var r in e){var i=e[r].length;if(i>65535)throw"extra field too long";t+=i+4}return t},hg=function(e,t,r,i,n,s,o,a){var l=i.length,c=r.extra,u=a&&a.length,p=pg(c);mf(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==s&&8),e[t++]=n&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var h=new Date(null==r.mtime?Date.now():r.mtime),d=h.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(mf(e,t,d<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),t+=4,null!=s&&(mf(e,t,r.crc),mf(e,t+4,s),mf(e,t+8,r.size)),mf(e,t+12,l),mf(e,t+14,p),t+=16,null!=o&&(mf(e,t,u),mf(e,t+6,r.attrs),mf(e,t+10,o),t+=14),e.set(i,t),t+=l,p)for(var f in c){var g=c[f],m=g.length;mf(e,t,+f),mf(e,t+2,m),e.set(g,t+4),t+=4+m}return u&&(e.set(a,t),t+=u),t},dg=function(e,t,r,i,n){mf(e,t,101010256),mf(e,t+8,r),mf(e,t+10,r),mf(e,t+12,i),mf(e,t+16,n)},fg=function(){function e(e){this.filename=e,this.c=Xd(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),gg=function(){function e(e,t){var r=this;t||(t={}),fg.call(this,e),this.d=new Ef(t,function(e,t){r.ondata(null,e,t)}),this.compression=8,this.flag=ag(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){fg.prototype.push.call(this,e,t)},e}(),mg=function(){function e(e,t){var r=this;t||(t={}),fg.call(this,e),this.d=new Sf(t,function(e,t,i){r.ondata(e,t,i)}),this.compression=8,this.flag=ag(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){fg.prototype.push.call(this,e,t)},e}(),_g=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=sg(e.filename),i=r.length,n=e.comment,s=n&&sg(n),o=i!=e.filename.length||s&&n.length!=s.length,a=i+pg(e.extra)+30;if(i>65535)throw"filename too long";var l=new ad(a);hg(l,0,e,r,o);var c=[l],u=function(){for(var e=0,r=c;e<r.length;e++){var i=r[e];t.ondata(null,i,!1)}c=[]},p=this.d;this.d=0;var h=this.u.length,d=Jd(e,{f:r,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),p){var e=t.u[h+1];e?e.r():t.d=1}p=1}}),f=0;e.ondata=function(r,i,n){if(r)t.ondata(r,i,n),t.terminate();else if(f+=i.length,c.push(i),n){var s=new ad(16);mf(s,0,134695760),mf(s,4,e.crc),mf(s,8,f),mf(s,12,e.size),c.push(s),d.c=f,d.b=a+f+16,d.crc=e.crc,d.size=e.size,p&&d.r(),p=1}else p&&u()},this.u.push(d)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,i=0,n=this.u;i<n.length;i++)r+=46+(l=n[i]).f.length+pg(l.extra)+(l.o?l.o.length:0);for(var s=new ad(r+22),o=0,a=this.u;o<a.length;o++){var l=a[o];hg(s,e,l,l.f,l.u,l.c,t,l.o),e+=46+l.f.length+pg(l.extra)+(l.o?l.o.length:0),t+=l.b}dg(s,e,this.u.length,r,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();function vg(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var i={};Zf(e,"",i,t);var n=Object.keys(i),s=n.length,o=0,a=0,l=s,c=new Array(s),u=[],p=function(){for(var e=0;e<u.length;++e)u[e]()},h=function(){var e=new ad(a+22),t=o,i=a-o;a=0;for(var n=0;n<l;++n){var s=c[n];try{var u=s.c.length;hg(e,a,s,s.f,s.u,u);var p=30+s.f.length+pg(s.extra),h=a+p;e.set(s.c,h),hg(e,o,s,s.f,s.u,u,a,s.m),o+=16+p+(s.m?s.m.length:0),a=h+u}catch(e){return r(e,null)}}dg(e,o,c.length,i,t),r(null,e)};s||h();for(var d=function(e){var t=n[e],l=i[t],d=l[0],f=l[1],g=Xd(),m=d.length;g.p(d);var _=sg(t),v=_.length,x=f.comment,A=x&&sg(x),b=A&&A.length,y=pg(f.extra),w=0==f.level?0:8,E=function(i,n){if(i)p(),r(i,null);else{var l=n.length;c[e]=Jd(f,{size:m,crc:g.d(),c:n,f:_,m:A,u:v!=t.length||A&&x.length!=b,compression:w}),o+=30+v+y+l,a+=76+2*(v+y)+(b||0)+l,--s||h()}};if(v>65535&&E("filename too long",null),w)if(m<16e4)try{E(null,Mf(d,f))}catch(e){E(e,null)}else u.push(Cf(d,f,E));else E(null,d)},f=0;f<l;++f)d(f);return p}function xg(e,t){t||(t={});var r={},i=[];Zf(e,"",r,t);var n=0,s=0;for(var o in r){var a=r[o],l=a[0],c=a[1],u=0==c.level?0:8,p=(w=sg(o)).length,h=c.comment,d=h&&sg(h),f=d&&d.length,g=pg(c.extra);if(p>65535)throw"filename too long";var m=u?Mf(l,c):l,_=m.length,v=Xd();v.p(l),i.push(Jd(c,{size:l.length,crc:v.d(),c:m,f:w,m:d,u:p!=o.length||d&&h.length!=f,o:n,compression:u})),n+=30+p+g+_,s+=76+2*(p+g)+(f||0)+_}for(var x=new ad(s+22),A=n,b=s-n,y=0;y<i.length;++y){var w=i[y];hg(x,w.o,w,w.f,w.u,w.c.length);var E=30+w.f.length+pg(w.extra);x.set(w.c,w.o+E),hg(x,n,w,w.f,w.u,w.c.length,w.o,w.m),n+=16+E+(w.m?w.m.length:0)}return dg(x,n,i.length,b,A),x}var Ag=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),bg=function(){function e(){var e=this;this.i=new Tf(function(t,r){e.ondata(null,t,r)})}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(r){this.ondata(r,e,t)}},e.compression=8,e}(),yg=function(){function e(e,t){var r=this;t<32e4?this.i=new Tf(function(e,t){r.ondata(null,e,t)}):(this.i=new If(function(e,t,i){r.ondata(e,t,i)}),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=Rd(e,0)),this.i.push(e,t)},e.compression=8,e}(),wg=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Ag},this.p=Hd}return e.prototype.push=function(e,t){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),n=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(n,!this.c):this.k[0].push(n),(e=e.subarray(i)).length)return this.push(e,t)}else{var s=0,o=0,a=void 0,l=void 0;this.p.length?e.length?((l=new ad(this.p.length+e.length)).set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var c=l.length,u=this.c,p=u&&this.d,h=function(){var e,t=ff(l,o);if(67324752==t){s=1,a=o,d.d=null,d.c=0;var i=df(l,o+6),n=df(l,o+8),p=2048&i,h=8&i,f=df(l,o+26),g=df(l,o+28);if(c>o+30+f+g){var m=[];d.k.unshift(m),s=2;var _,v=ff(l,o+18),x=ff(l,o+22),A=og(l.subarray(o+30,o+=30+f),!p);4294967295==v?(e=h?[-2]:ug(l,o),v=e[0],x=e[1]):h&&(v=-1),o+=g,d.c=v;var b={name:A,compression:n,start:function(){if(!b.ondata)throw"no callback";if(v){var e=r.o[n];if(!e)throw"unknown compression type "+n;(_=v<0?new e(A):new e(A,v,x)).ondata=function(e,t,r){b.ondata(e,t,r)};for(var t=0,i=m;t<i.length;t++){var s=i[t];_.push(s,!1)}r.k[0]==m&&r.c?r.d=_:_.push(Hd,!0)}else b.ondata(null,Hd,!0)},terminate:function(){_&&_.terminate&&_.terminate()}};v>=0&&(b.size=v,b.originalSize=x),d.onfile(b)}return"break"}if(u){if(134695760==t)return a=o+=12+(-2==u&&8),s=3,d.c=0,"break";if(33639248==t)return a=o-=4,s=3,d.c=0,"break"}},d=this;o<c-4&&"break"!==h();++o);if(this.p=Hd,u<0){var f=s?l.subarray(0,a-12-(-2==u&&8)-(134695760==ff(l,a-16)&&4)):l.subarray(0,o);p?p.push(f,!!s):this.k[+(2==s)].push(f)}if(2&s)return this.push(l.subarray(o),t);this.p=l.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function Eg(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],i=function(){for(var e=0;e<r.length;++e)r[e]()},n={},s=e.length-22;101010256!=ff(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var o=df(e,s+8);o||t(null,{});var a=o,l=ff(e,s+16),c=4294967295==l;if(c){if(s=ff(e,s-12),101075792!=ff(e,s))return void t("invalid zip file",null);a=o=ff(e,s+32),l=ff(e,s+48)}for(var u=function(s){var a=cg(e,l,c),u=a[0],p=a[1],h=a[2],d=a[3],f=a[4],g=a[5],m=lg(e,g);l=f;var _=function(e,r){e?(i(),t(e,null)):(n[d]=r,--o||t(null,n))};if(u)if(8==u){var v=e.subarray(m,m+p);if(p<32e4)try{_(null,Df(v,new ad(h)))}catch(e){_(e,null)}else r.push(kf(v,{size:h},_))}else _("unknown compression type "+u,null);else _(null,Rd(e,m,m+p))},p=0;p<a;++p)u();return i}function Sg(e){for(var t={},r=e.length-22;101010256!=ff(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var i=df(e,r+8);if(!i)return{};var n=ff(e,r+16),s=4294967295==n;if(s){if(r=ff(e,r-12),101075792!=ff(e,r))throw"invalid zip file";i=ff(e,r+32),n=ff(e,r+48)}for(var o=0;o<i;++o){var a=cg(e,n,s),l=a[0],c=a[1],u=a[2],p=a[3],h=a[4],d=a[5],f=lg(e,d);if(n=h,l){if(8!=l)throw"unknown compression type "+l;t[p]=Df(e.subarray(f,f+c),new ad(u))}else t[p]=Rd(e,f,f+c)}return t}class Cg extends i.yxD{constructor(e){super(e),this.type=i.cLu}parse(e){const r=65536,n=14,s=65537,o=Math.pow(2.7182818,2.2),a={l:0,c:0,lc:0};function l(e,t,r,i,n){for(;r<e;)t=t<<8|N(i,n),r+=8;r-=e,a.l=t>>r&(1<<e)-1,a.c=t,a.lc=r}const c=new Array(59);function u(e){return 63&e}function p(e){return e>>6}const h={c:0,lc:0};function d(e,t,r,i){e=e<<8|N(r,i),t+=8,h.c=e,h.lc=t}const f={c:0,lc:0};function g(e,t,r,i,n,s,o,a,l){if(e==t){i<8&&(d(r,i,n,s),r=h.c,i=h.lc);let e=r>>(i-=8);if(e=new Uint8Array([e])[0],a.value+e>l)return!1;const t=o[a.value-1];for(;e-- >0;)o[a.value++]=t}else{if(!(a.value<l))return!1;o[a.value++]=e}f.c=r,f.lc=i}function m(e){return 65535&e}function _(e){const t=m(e);return t>32767?t-65536:t}const v={a:0,b:0};function x(e,t){const r=_(e),i=_(t),n=r+(1&i)+(i>>1),s=n,o=n-i;v.a=s,v.b=o}function A(e,t){const r=m(e),i=m(t),n=r-(i>>1)&65535,s=i+n-32768&65535;v.a=s,v.b=n}function b(e,t,r,i,n,s,o){const a=o<16384,l=r>n?n:r;let c,u,p=1;for(;p<=l;)p<<=1;for(c=p>>=1,p>>=1;p>=1;){const o=(u=0)+s*(n-c),l=s*p,h=s*c,d=i*p,f=i*c;let g,m,_,b;for(;u<=o;u+=h){let n=u;const s=u+i*(r-c);for(;n<=s;n+=f){const r=n+d,i=n+l,s=i+d;a?(x(e[n+t],e[i+t]),g=v.a,_=v.b,x(e[r+t],e[s+t]),m=v.a,b=v.b,x(g,m),e[n+t]=v.a,e[r+t]=v.b,x(_,b),e[i+t]=v.a,e[s+t]=v.b):(A(e[n+t],e[i+t]),g=v.a,_=v.b,A(e[r+t],e[s+t]),m=v.a,b=v.b,A(g,m),e[n+t]=v.a,e[r+t]=v.b,A(_,b),e[i+t]=v.a,e[s+t]=v.b)}if(r&p){const r=n+l;a?x(e[n+t],e[r+t]):A(e[n+t],e[r+t]),g=v.a,e[r+t]=v.b,e[n+t]=g}}if(n&p){let n=u;const s=u+i*(r-c);for(;n<=s;n+=f){const r=n+d;a?x(e[n+t],e[r+t]):A(e[n+t],e[r+t]),g=v.a,e[r+t]=v.b,e[n+t]=g}}c=p,p>>=1}return u}function y(e,t,r,i,o,m){const _=r.value,v=U(t,r),x=U(t,r);r.value+=4;const A=U(t,r);if(r.value+=4,v<0||v>=s||x<0||x>=s)throw new Error("Something wrong with HUF_ENCSIZE");const b=new Array(s),y=new Array(16384);if(function(e){for(let t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(y),function(e,t,r,i,n,o){const u=t;let p=0,h=0;for(;i<=n;i++){if(u.value-t.value>r)return!1;l(6,p,h,e,u);const s=a.l;if(p=a.c,h=a.lc,o[i]=s,63==s){if(u.value-t.value>r)throw new Error("Something wrong with hufUnpackEncTable");l(8,p,h,e,u);let s=a.l+6;if(p=a.c,h=a.lc,i+s>n+1)throw new Error("Something wrong with hufUnpackEncTable");for(;s--;)o[i++]=0;i--}else if(s>=59){let e=s-59+2;if(i+e>n+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)o[i++]=0;i--}}!function(e){for(let r=0;r<=58;++r)c[r]=0;for(let r=0;r<s;++r)c[e[r]]+=1;let t=0;for(let r=58;r>0;--r){const e=t+c[r]>>1;c[r]=t,t=e}for(let r=0;r<s;++r){const t=e[r];t>0&&(e[r]=t|c[t]++<<6)}}(o)}(e,r,i-(r.value-_),v,x,b),A>8*(i-(r.value-_)))throw new Error("Something wrong with hufUncompress");!function(e,t,r,i){for(;t<=r;t++){const r=p(e[t]),s=u(e[t]);if(r>>s)throw new Error("Invalid table entry");if(s>n){const e=i[r>>s-n];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){const t=e.p;e.p=new Array(e.lit);for(let r=0;r<e.lit-1;++r)e.p[r]=t[r]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(s){let e=0;for(let o=1<<n-s;o>0;o--){const o=i[(r<<n-s)+e];if(o.len||o.p)throw new Error("Invalid table entry");o.len=s,o.lit=t,e++}}}}(b,v,x,y),function(e,t,r,i,s,o,a,l,c){let m=0,_=0;const v=a,x=Math.trunc(i.value+(s+7)/8);for(;i.value<x;)for(d(m,_,r,i),m=h.c,_=h.lc;_>=n;){const s=t[m>>_-n&16383];if(s.len)_-=s.len,g(s.lit,o,m,_,r,i,l,c,v),m=f.c,_=f.lc;else{if(!s.p)throw new Error("hufDecode issues");let t;for(t=0;t<s.lit;t++){const n=u(e[s.p[t]]);for(;_<n&&i.value<x;)d(m,_,r,i),m=h.c,_=h.lc;if(_>=n&&p(e[s.p[t]])==(m>>_-n&(1<<n)-1)){_-=n,g(s.p[t],o,m,_,r,i,l,c,v),m=f.c,_=f.lc;break}}if(t==s.lit)throw new Error("hufDecode issues")}}const A=8-s&7;for(m>>=A,_-=A;_>0;){const e=t[m<<n-_&16383];if(!e.len)throw new Error("hufDecode issues");_-=e.len,g(e.lit,o,m,_,r,i,l,c,v),m=f.c,_=f.lc}}(b,y,e,r,A,x,m,o,{value:0})}function w(e){for(let t=1;t<e.length;t++){const r=e[t-1]+e[t]-128;e[t]=r}}function E(e,t){let r=0,i=Math.floor((e.length+1)/2),n=0;const s=e.length-1;for(;!(n>s||(t[n++]=e[r++],n>s));)t[n++]=e[i++]}function S(e){let t=e.byteLength;const r=new Array;let i=0;const n=new DataView(e);for(;t>0;){const e=n.getInt8(i++);if(e<0){const s=-e;t-=s+1;for(let e=0;e<s;e++)r.push(n.getUint8(i++))}else{const s=e;t-=2;const o=n.getUint8(i++);for(let e=0;e<s+1;e++)r.push(o)}}return r}function C(e,t,r){let i,n=1;for(;n<64;)65280==(i=t[e.value])?n=64:i>>8==255?n+=255&i:(r[n]=i,n++),e.value++}function M(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(.196349375),i=.5*Math.cos(.39269875),n=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),a=.5*Math.cos(1.374445625),l=new Array(4),c=new Array(4),u=new Array(4),p=new Array(4);for(let h=0;h<8;++h){const d=8*h;l[0]=i*e[d+2],l[1]=o*e[d+2],l[2]=i*e[d+6],l[3]=o*e[d+6],c[0]=r*e[d+1]+n*e[d+3]+s*e[d+5]+a*e[d+7],c[1]=n*e[d+1]-a*e[d+3]-r*e[d+5]-s*e[d+7],c[2]=s*e[d+1]-r*e[d+3]+a*e[d+5]+n*e[d+7],c[3]=a*e[d+1]-s*e[d+3]+n*e[d+5]-r*e[d+7],u[0]=t*(e[d+0]+e[d+4]),u[3]=t*(e[d+0]-e[d+4]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],p[0]=u[0]+u[1],p[1]=u[3]+u[2],p[2]=u[3]-u[2],p[3]=u[0]-u[1],e[d+0]=p[0]+c[0],e[d+1]=p[1]+c[1],e[d+2]=p[2]+c[2],e[d+3]=p[3]+c[3],e[d+4]=p[3]-c[3],e[d+5]=p[2]-c[2],e[d+6]=p[1]-c[1],e[d+7]=p[0]-c[0]}for(let h=0;h<8;++h)l[0]=i*e[16+h],l[1]=o*e[16+h],l[2]=i*e[48+h],l[3]=o*e[48+h],c[0]=r*e[8+h]+n*e[24+h]+s*e[40+h]+a*e[56+h],c[1]=n*e[8+h]-a*e[24+h]-r*e[40+h]-s*e[56+h],c[2]=s*e[8+h]-r*e[24+h]+a*e[40+h]+n*e[56+h],c[3]=a*e[8+h]-s*e[24+h]+n*e[40+h]-r*e[56+h],u[0]=t*(e[h]+e[32+h]),u[3]=t*(e[h]-e[32+h]),u[1]=l[0]+l[3],u[2]=l[1]-l[2],p[0]=u[0]+u[1],p[1]=u[3]+u[2],p[2]=u[3]-u[2],p[3]=u[0]-u[1],e[0+h]=p[0]+c[0],e[8+h]=p[1]+c[1],e[16+h]=p[2]+c[2],e[24+h]=p[3]+c[3],e[32+h]=p[3]-c[3],e[40+h]=p[2]-c[2],e[48+h]=p[1]-c[1],e[56+h]=p[0]-c[0]}function T(e){for(let t=0;t<64;++t){const r=e[0][t],i=e[1][t],n=e[2][t];e[0][t]=r+1.5747*n,e[1][t]=r-.1873*i-.4682*n,e[2][t]=r+1.8556*i}}function I(e,t,r){for(let s=0;s<64;++s)t[r+s]=i.A5E.toHalfFloat((n=e[s])<=1?Math.sign(n)*Math.pow(Math.abs(n),2.2):Math.sign(n)*Math.pow(o,Math.abs(n)-1));var n}function k(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function D(e){const t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(S(t)),i=new Uint8Array(r.length);return w(r),E(r,i),new DataView(i.buffer)}function P(e){const r=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===t&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const i=qf(r),n=new Uint8Array(i.length);return w(i),E(i,n),new DataView(n.buffer)}function B(e){const t=e.viewer,i={value:e.offset.value},n=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192);let o=0;const a=new Array(e.channels);for(let r=0;r<e.channels;r++)a[r]={},a[r].start=o,a[r].end=a[r].start,a[r].nx=e.width,a[r].ny=e.lines,a[r].size=e.type,o+=a[r].nx*a[r].ny*a[r].size;const l=H(t,i),c=H(t,i);if(c>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=c)for(let r=0;r<c-l+1;r++)s[r+l]=j(t,i);const u=new Uint16Array(r),p=function(e,t){let i=0;for(let s=0;s<r;++s)(0==s||e[s>>3]&1<<(7&s))&&(t[i++]=s);const n=i-1;for(;i<r;)t[i++]=0;return n}(s,u),h=U(t,i);y(e.array,t,i,h,n,o);for(let r=0;r<e.channels;++r){const e=a[r];for(let t=0;t<a[r].size;++t)b(n,e.start+t,e.nx,e.size,e.ny,e.nx*e.size,p)}!function(e,t,r){for(let i=0;i<r;++i)t[i]=e[t[i]]}(u,n,o);let d=0;const f=new Uint8Array(n.buffer.byteLength);for(let r=0;r<e.lines;r++)for(let t=0;t<e.channels;t++){const e=a[t],r=e.nx*e.size,i=new Uint8Array(n.buffer,2*e.end,2*r);f.set(i,d),d+=2*r,e.end+=r}return new DataView(f.buffer)}function R(e){const r=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===t&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const i=qf(r),n=e.lines*e.channels*e.width,s=1==e.type?new Uint16Array(n):new Uint32Array(n);let o=0,a=0;const l=new Array(4);for(let t=0;t<e.lines;t++)for(let r=0;r<e.channels;r++){let t=0;switch(e.type){case 1:l[0]=o,l[1]=l[0]+e.width,o=l[1]+e.width;for(let r=0;r<e.width;++r)t+=i[l[0]++]<<8|i[l[1]++],s[a]=t,a++;break;case 2:l[0]=o,l[1]=l[0]+e.width,l[2]=l[1]+e.width,o=l[2]+e.width;for(let r=0;r<e.width;++r)t+=i[l[0]++]<<24|i[l[1]++]<<16|i[l[2]++]<<8,s[a]=t,a++}}return new DataView(s.buffer)}function L(e){const t=e.viewer,r={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),n={version:G(t,r),unknownUncompressedSize:G(t,r),unknownCompressedSize:G(t,r),acCompressedSize:G(t,r),dcCompressedSize:G(t,r),rleCompressedSize:G(t,r),rleUncompressedSize:G(t,r),rleRawSize:G(t,r),totalAcUncompressedCount:G(t,r),totalDcUncompressedCount:G(t,r),acCompression:G(t,r)};if(n.version<2)throw new Error("EXRLoader.parse: "+J.compression+" version "+n.version+" is unsupported");const s=new Array;let o=H(t,r)-2;for(;o>0;){const e=O(t.buffer,r),i=j(t,r),n=i>>2&3,a=new Int8Array([(i>>4)-1])[0],l=j(t,r);s.push({name:e,index:a,type:l,compression:n}),o-=e.length+3}const a=J.channels,l=new Array(e.channels);for(let g=0;g<e.channels;++g){const t=l[g]={},r=a[g];t.name=r.name,t.compression=0,t.decoded=!1,t.type=r.pixelType,t.pLinear=r.pLinear,t.width=e.width,t.height=e.lines}const c={idx:new Array(3)};for(let g=0;g<e.channels;++g){const e=l[g];for(let t=0;t<s.length;++t){const r=s[t];e.name==r.name&&(e.compression=r.compression,r.index>=0&&(c.idx[r.index]=g),e.offset=g)}}let u,p,h;if(n.acCompressedSize>0)switch(n.acCompression){case 0:u=new Uint16Array(n.totalAcUncompressedCount),y(e.array,t,r,n.acCompressedSize,u,n.totalAcUncompressedCount);break;case 1:const i=qf(e.array.slice(r.value,r.value+n.totalAcUncompressedCount));u=new Uint16Array(i.buffer),r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){const t={array:e.array,offset:r,size:n.dcCompressedSize};p=new Uint16Array(P(t).buffer),r.value+=n.dcCompressedSize}n.rleRawSize>0&&(h=S(qf(e.array.slice(r.value,r.value+n.rleCompressedSize)).buffer),r.value+=n.rleCompressedSize);let d=0;const f=new Array(l.length);for(let g=0;g<f.length;++g)f[g]=new Array;for(let g=0;g<e.lines;++g)for(let t=0;t<l.length;++t)f[t].push(d),d+=l[t].width*e.type*2;!function(e,t,r,i,n,s){let o=new DataView(s.buffer);const a=r[e.idx[0]].width,l=r[e.idx[0]].height,c=Math.floor(a/8),u=Math.ceil(a/8),p=Math.ceil(l/8),h=a-8*(u-1),d=l-8*(p-1),f={value:0},g=new Array(3),m=new Array(3),_=new Array(3),v=new Array(3),x=new Array(3);for(let w=0;w<3;++w)x[w]=t[e.idx[w]],g[w]=w<1?0:g[w-1]+u*p,m[w]=new Float32Array(64),_[w]=new Uint16Array(64),v[w]=new Uint16Array(64*u);for(let w=0;w<p;++w){let t=8;w==p-1&&(t=d);let s=8;for(let e=0;e<u;++e){e==u-1&&(s=h);for(let e=0;e<3;++e)_[e].fill(0),_[e][0]=n[g[e]++],C(f,i,_[e]),A=_[e],(b=m[e])[0]=Q(A[0]),b[1]=Q(A[1]),b[2]=Q(A[5]),b[3]=Q(A[6]),b[4]=Q(A[14]),b[5]=Q(A[15]),b[6]=Q(A[27]),b[7]=Q(A[28]),b[8]=Q(A[2]),b[9]=Q(A[4]),b[10]=Q(A[7]),b[11]=Q(A[13]),b[12]=Q(A[16]),b[13]=Q(A[26]),b[14]=Q(A[29]),b[15]=Q(A[42]),b[16]=Q(A[3]),b[17]=Q(A[8]),b[18]=Q(A[12]),b[19]=Q(A[17]),b[20]=Q(A[25]),b[21]=Q(A[30]),b[22]=Q(A[41]),b[23]=Q(A[43]),b[24]=Q(A[9]),b[25]=Q(A[11]),b[26]=Q(A[18]),b[27]=Q(A[24]),b[28]=Q(A[31]),b[29]=Q(A[40]),b[30]=Q(A[44]),b[31]=Q(A[53]),b[32]=Q(A[10]),b[33]=Q(A[19]),b[34]=Q(A[23]),b[35]=Q(A[32]),b[36]=Q(A[39]),b[37]=Q(A[45]),b[38]=Q(A[52]),b[39]=Q(A[54]),b[40]=Q(A[20]),b[41]=Q(A[22]),b[42]=Q(A[33]),b[43]=Q(A[38]),b[44]=Q(A[46]),b[45]=Q(A[51]),b[46]=Q(A[55]),b[47]=Q(A[60]),b[48]=Q(A[21]),b[49]=Q(A[34]),b[50]=Q(A[37]),b[51]=Q(A[47]),b[52]=Q(A[50]),b[53]=Q(A[56]),b[54]=Q(A[59]),b[55]=Q(A[61]),b[56]=Q(A[35]),b[57]=Q(A[36]),b[58]=Q(A[48]),b[59]=Q(A[49]),b[60]=Q(A[57]),b[61]=Q(A[58]),b[62]=Q(A[62]),b[63]=Q(A[63]),M(m[e]);T(m);for(let t=0;t<3;++t)I(m[t],v[t],64*e)}let a=0;for(let i=0;i<3;++i){const n=r[e.idx[i]].type;for(let e=8*w;e<8*w+t;++e){a=x[i][e];for(let t=0;t<c;++t){const r=64*t+8*(7&e);o.setUint16(a+0*n,v[i][r+0],!0),o.setUint16(a+2*n,v[i][r+1],!0),o.setUint16(a+4*n,v[i][r+2],!0),o.setUint16(a+6*n,v[i][r+3],!0),o.setUint16(a+8*n,v[i][r+4],!0),o.setUint16(a+10*n,v[i][r+5],!0),o.setUint16(a+12*n,v[i][r+6],!0),o.setUint16(a+14*n,v[i][r+7],!0),a+=16*n}}if(c!=u)for(let e=8*w;e<8*w+t;++e){const t=x[i][e]+8*c*2*n,r=64*c+8*(7&e);for(let e=0;e<s;++e)o.setUint16(t+2*e*n,v[i][r+e],!0)}}}var A,b;const y=new Uint16Array(a);o=new DataView(s.buffer);for(let w=0;w<3;++w){r[e.idx[w]].decoded=!0;const t=r[e.idx[w]].type;if(2==r[w].type)for(let e=0;e<l;++e){const r=x[w][e];for(let e=0;e<a;++e)y[e]=o.getUint16(r+2*e*t,!0);for(let e=0;e<a;++e)o.setFloat32(r+2*e*t,Q(y[e]),!0)}}}(c,f,l,u,p,i);for(let g=0;g<l.length;++g){const t=l[g];if(!t.decoded){if(2!==t.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let r=0,n=0;for(let s=0;s<e.lines;++s){let e=f[g][r];for(let r=0;r<t.width;++r){for(let r=0;r<2*t.type;++r)i[e++]=h[n+r*t.width*t.height];n++}r++}}}}return new DataView(i.buffer)}function O(e,t){const r=new Uint8Array(e);let i=0;for(;0!=r[t.value+i];)i+=1;const n=(new TextDecoder).decode(r.slice(t.value,t.value+i));return t.value=t.value+i+1,n}function F(e,t){const r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function U(e,t){const r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function N(e,t){const r=e[t.value];return t.value=t.value+1,r}function j(e,t){const r=e.getUint8(t.value);return t.value=t.value+1,r}const G=function(e,t){const r=Number(e.getBigInt64(t.value,!0));return t.value+=8,r};function z(e,t){const r=e.getFloat32(t.value,!0);return t.value+=4,r}function V(e,t){return i.A5E.toHalfFloat(z(e,t))}function Q(e){const t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function H(e,t){const r=e.getUint16(t.value,!0);return t.value+=2,r}function W(e,t){return Q(H(e,t))}function q(e,t,r,i,n){return"string"===i||"stringvector"===i||"iccProfile"===i?function(e,t,r){const i=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,i}(t,r,n):"chlist"===i?function(e,t,r,i){const n=r.value,s=[];for(;r.value<n+i-1;){const i=O(t,r),n=F(e,r),o=j(e,r);r.value+=3;const a=F(e,r),l=F(e,r);s.push({name:i,pixelType:n,pLinear:o,xSampling:a,ySampling:l})}return r.value+=1,s}(e,t,r,n):"chromaticities"===i?function(e,t){return{redX:z(e,t),redY:z(e,t),greenX:z(e,t),greenY:z(e,t),blueX:z(e,t),blueY:z(e,t),whiteX:z(e,t),whiteY:z(e,t)}}(e,r):"compression"===i?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][j(e,r)]}(e):"box2i"===i?function(e,t){return{xMin:U(e,t),yMin:U(e,t),xMax:U(e,t),yMax:U(e,t)}}(e,r):"lineOrder"===i?function(e,t){return["INCREASING_Y"][j(e,r)]}(e):"float"===i?z(e,r):"v2f"===i?function(e,t){return[z(e,t),z(e,t)]}(e,r):"v3f"===i?function(e,t){return[z(e,t),z(e,t),z(e,t)]}(e,r):"int"===i?F(e,r):"rational"===i?function(e,t){return[F(e,t),U(e,t)]}(e,r):"timecode"===i?function(e,t){return[U(e,t),U(e,t)]}(e,r):"preview"===i?(r.value+=n,"skipped"):void(r.value+=n)}const X=new DataView(e),Y=new Uint8Array(e),K={value:0},J=function(e,t,r){const i={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");i.version=e.getUint8(4);const n=e.getUint8(5);i.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;let s=!0;for(;s;){const n=O(t,r);if(0==n)s=!1;else{const s=O(t,r),o=q(e,t,r,s,U(e,r));void 0===o?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):i[n]=o}}if(0!=(-5&n))throw console.error("EXRHeader:",i),new Error("THREE.EXRLoader: provided file is currently unsupported.");return i}(X,e,K),Z=function(e,t,r,n,s){const o={size:0,viewer:t,array:r,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=k;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=D;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=P;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=P;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=B;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=R;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=L;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=L;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(o.scanlineBlockSize=o.lines,1==o.type)switch(s){case i.VzW:o.getter=W,o.inputSize=2;break;case i.cLu:o.getter=H,o.inputSize=2}else{if(2!=o.type)throw new Error("EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".");switch(s){case i.VzW:o.getter=z,o.inputSize=4;break;case i.cLu:o.getter=V,o.inputSize=4}}o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(let i=0;i<o.blockCount;i++)G(t,n);o.outputChannels=3==o.channels?4:o.channels;const a=o.width*o.height*o.outputChannels;switch(s){case i.VzW:o.byteArray=new Float32Array(a),o.channels<o.outputChannels&&o.byteArray.fill(1,0,a);break;case i.cLu:o.byteArray=new Uint16Array(a),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,a);break;default:console.error("THREE.EXRLoader: unsupported type: ",s)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?(o.format=i.wk1,o.encoding=i.rnI):(o.format=i.hEm,o.encoding=i.rnI),o}(J,X,Y,K,this.type),$={value:0},ee={R:0,G:1,B:2,A:3,Y:0};for(let t=0;t<Z.height/Z.scanlineBlockSize;t++){const e=U(X,K);Z.size=U(X,K),Z.lines=e+Z.scanlineBlockSize>Z.height?Z.height-e:Z.scanlineBlockSize;const r=Z.size<Z.lines*Z.bytesPerLine?Z.uncompress(Z):k(Z);K.value+=Z.size;for(let i=0;i<Z.scanlineBlockSize;i++){const e=i+t*Z.scanlineBlockSize;if(e>=Z.height)break;for(let t=0;t<Z.channels;t++){const n=ee[J.channels[t].name];for(let s=0;s<Z.width;s++){$.value=(i*(Z.channels*Z.width)+t*Z.width+s)*Z.inputSize;const o=(Z.height-1-e)*(Z.width*Z.outputChannels)+s*Z.outputChannels+n;Z.byteArray[o]=Z.getter(r,$)}}}}return{header:J,width:Z.width,height:Z.height,data:Z.byteArray,format:Z.format,encoding:Z.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){e.encoding=r.encoding,e.minFilter=i.wem,e.magFilter=i.wem,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,n)}}class Mg extends r{constructor(){super(...arguments),this.dependencies=[so]}async onAdded(e){this._importer||(this._importer=new lr(class extends Cg{constructor(t){super(t),this.setDataType(ro(e.renderer.rendererObject))}},["exr"],!1)),to.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&to.Importers.splice(to.Importers.indexOf(this._importer),1),this._importer=void 0}}function Tg(e,t,r){const i=r.length-e-1;if(t>=r[i])return i-1;if(t<=r[e])return e;let n=e,s=i,o=Math.floor((n+s)/2);for(;t<r[o]||t>=r[o+1];)t<r[o]?s=o:n=o,o=Math.floor((n+s)/2);return o}function Ig(e,t){let r=1;for(let n=2;n<=e;++n)r*=n;let i=1;for(let n=2;n<=t;++n)i*=n;for(let n=2;n<=e-t;++n)i*=n;return r/i}Mg.PluginType="EXRLoadPlugin";class kg extends i.Hyl{constructor(e,t,r,n,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<r.length;++o){const e=r[o];this.controlPoints[o]=new i.Ltg(e.x,e.y,e.z,e.w)}}getPoint(e,t=new i.Pa4){const r=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(e,t,r,n){const s=Tg(e,n,t),o=function(e,t,r,i){const n=[],s=[],o=[];n[0]=1;for(let a=1;a<=r;++a){s[a]=t-i[e+1-a],o[a]=i[e+a]-t;let r=0;for(let e=0;e<a;++e){const t=o[e+1],i=s[a-e],l=n[e]/(t+i);n[e]=r+t*l,r=i*l}n[a]=r}return n}(s,n,e,t),a=new i.Ltg(0,0,0,0);for(let i=0;i<=e;++i){const t=r[s-e+i],n=o[i],l=t.w*n;a.x+=t.x*l,a.y+=t.y*l,a.z+=t.z*l,a.w+=t.w*n}return a}(this.degree,this.knots,this.controlPoints,n);return 1!==s.w&&s.divideScalar(s.w),r.set(s.x,s.y,s.z)}getTangent(e,t=new i.Pa4){const r=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=function(e,t,r,n,s){return function(e){const t=e.length,r=[],n=[];for(let o=0;o<t;++o){const t=e[o];r[o]=new i.Pa4(t.x,t.y,t.z),n[o]=t.w}const s=[];for(let i=0;i<t;++i){const e=r[i].clone();for(let t=1;t<=i;++t)e.sub(s[i-t].clone().multiplyScalar(Ig(i,t)*n[t]));s[i]=e.divideScalar(n[0])}return s}(function(e,t,r,n,s){const o=1<e?1:e,a=[],l=Tg(e,n,t),c=function(e,t,r,i,n){const s=[];for(let p=0;p<=r;++p)s[p]=0;const o=[];for(let p=0;p<=i;++p)o[p]=s.slice(0);const a=[];for(let p=0;p<=r;++p)a[p]=s.slice(0);a[0][0]=1;const l=s.slice(0),c=s.slice(0);for(let p=1;p<=r;++p){l[p]=t-n[e+1-p],c[p]=n[e+p]-t;let r=0;for(let e=0;e<p;++e){const t=c[e+1],i=l[p-e];a[p][e]=t+i;const n=a[e][p-1]/a[p][e];a[e][p]=r+t*n,r=i*n}a[p][p]=r}for(let p=0;p<=r;++p)o[0][p]=a[p][r];for(let p=0;p<=r;++p){let e=0,t=1;const n=[];for(let i=0;i<=r;++i)n[i]=s.slice(0);n[0][0]=1;for(let s=1;s<=i;++s){let i=0;const l=p-s,c=r-s;p>=s&&(n[t][0]=n[e][0]/a[c+1][l],i=n[t][0]*a[l][c]);const u=p-1<=c?s-1:r-p;for(let r=l>=-1?1:-l;r<=u;++r)n[t][r]=(n[e][r]-n[e][r-1])/a[c+1][l+r],i+=n[t][r]*a[l+r][c];p<=c&&(n[t][s]=-n[e][s-1]/a[c+1][p],i+=n[t][s]*a[p][c]),o[s][p]=i;const h=e;e=t,t=h}}let u=r;for(let p=1;p<=i;++p){for(let e=0;e<=r;++e)o[p][e]*=u;u*=r-p}return o}(l,n,e,o,t),u=[];for(let i=0;i<r.length;++i){const e=r[i].clone(),t=e.w;e.x*=t,e.y*=t,e.z*=t,u[i]=e}for(let i=0;i<=o;++i){const t=u[l-e].clone().multiplyScalar(c[i][0]);for(let r=1;r<=e;++r)t.add(u[l-e+r].clone().multiplyScalar(c[i][r]));a[i]=t}for(let p=o+1;p<=2;++p)a[p]=new i.Ltg(0,0,0);return a}(e,t,r,n))}(this.degree,this.knots,this.controlPoints,n);return r.copy(s[1]).normalize(),r}}let Dg,Pg,Bg;class Rg extends i.aNw{constructor(e){super(e)}load(e,t,r,n){const s=this,o=""===s.path?i.Zp0.extractUrlBase(e):s.path,a=new i.hH6(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(r){try{t(s.parse(r,o))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}},r,n)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===Jg(e,0,t.length)}(e))Dg=(new Ng).parse(e);else{const t=Jg(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function i(t){const i=e[t-1];return e=e.slice(r+t),r++,i}for(let n=0;n<t.length;++n)if(i(1)===t[n])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(zg(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+zg(t));Dg=(new Ug).parse(t)}const r=new i.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Lg(r,this.manager).parse(Dg)}}class Lg{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Pg=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),i=this.parseDeformers(),n=(new Og).parse(i);return this.parseScene(i,n,r),Bg}parseConnections(){const e=new Map;return"Connections"in Dg&&Dg.Connections.connections.forEach(function(t){const r=t[0],i=t[1],n=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const s={ID:i,relationship:n};e.get(r).parents.push(s),e.has(i)||e.set(i,{parents:[],children:[]});const o={ID:r,relationship:n};e.get(i).children.push(o)}),e}parseImages(){const e={},t={};if("Video"in Dg.Objects){const r=Dg.Objects.Video;for(const i in r){const n=r[i];if(e[parseInt(i)]=n.RelativeFilename||n.Filename,"Content"in n){const e=n.Content instanceof ArrayBuffer&&n.Content.byteLength>0,s="string"==typeof n.Content&&""!==n.Content;if(e||s){const e=this.parseImage(r[i]);t[n.RelativeFilename||n.Filename]=e}}}}for(const r in e){const i=e[r];void 0!==t[i]?e[r]=t[i]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const t=e.Content,r=e.RelativeFilename||e.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();let n;switch(i){case"bmp":n="image/bmp";break;case"jpg":case"jpeg":n="image/jpeg";break;case"png":n="image/png";break;case"tif":n="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),n="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof t)return"data:"+n+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:n}))}}parseTextures(e){const t=new Map;if("Texture"in Dg.Objects){const r=Dg.Objects.Texture;for(const i in r){const n=this.parseTexture(r[i],e);t.set(parseInt(i),n)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const n=e.WrapModeU,s=e.WrapModeV,o=void 0!==n?n.value:0,a=void 0!==s?s.value:0;if(r.wrapS=0===o?i.rpg:i.uWy,r.wrapT=0===a?i.rpg:i.uWy,"Scaling"in e){const t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;r.offset.x=t[0],r.offset.y=t[1]}return r}loadTexture(e,t){let r;const n=this.textureLoader.path,s=Pg.get(e.id).children;let o;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(0!==(r=t[s[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new i.xEZ):(t.setPath(this.textureLoader.path),o=t.load(r))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new i.xEZ):o=this.textureLoader.load(r);return this.textureLoader.setPath(n),o}parseMaterials(e){const t=new Map;if("Material"in Dg.Objects){const r=Dg.Objects.Material;for(const i in r){const n=this.parseMaterial(r[i],e);null!==n&&t.set(parseInt(i),n)}}return t}parseMaterial(e,t){const r=e.id,n=e.attrName;let s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!Pg.has(r))return null;const o=this.parseParameters(e,t,r);let a;switch(s.toLowerCase()){case"phong":a=new i.xoR;break;case"lambert":a=new i.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new i.xoR}return a.setValues(o),a.name=n,a}parseParameters(e,t,r){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=(new i.Ilk).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(n.color=(new i.Ilk).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=(new i.Ilk).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(n.emissive=(new i.Ilk).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=(new i.Ilk).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(n.specular=(new i.Ilk).fromArray(e.SpecularColor.value));const s=this;return Pg.get(r).children.forEach(function(e){const r=e.relationship;switch(r){case"Bump":n.bumpMap=s.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":n.aoMap=s.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=s.getTexture(t,e.ID),void 0!==n.map&&(n.map.encoding=i.knz);break;case"DisplacementColor":n.displacementMap=s.getTexture(t,e.ID);break;case"EmissiveColor":n.emissiveMap=s.getTexture(t,e.ID),void 0!==n.emissiveMap&&(n.emissiveMap.encoding=i.knz);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=s.getTexture(t,e.ID);break;case"ReflectionColor":n.envMap=s.getTexture(t,e.ID),void 0!==n.envMap&&(n.envMap.mapping=i.dSO,n.envMap.encoding=i.knz);break;case"SpecularColor":n.specularMap=s.getTexture(t,e.ID),void 0!==n.specularMap&&(n.specularMap.encoding=i.knz);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=s.getTexture(t,e.ID),n.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),n}getTexture(e,t){return"LayeredTexture"in Dg.Objects&&t in Dg.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Pg.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Dg.Objects){const r=Dg.Objects.Deformer;for(const i in r){const n=r[i],s=Pg.get(parseInt(i));if("Skin"===n.attrType){const t=this.parseSkeleton(s,r);t.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[i]=t}else if("BlendShape"===n.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(s,r),e.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach(function(e){const n=t[e.ID];if("Cluster"!==n.attrType)return;const s={ID:e.ID,indices:[],weights:[],transformLink:(new i.yGw).fromArray(n.TransformLink.a)};"Indexes"in n&&(s.indices=n.Indexes.a,s.weights=n.Weights.a),r.push(s)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const r=[];for(let i=0;i<e.children.length;i++){const n=e.children[i],s=t[n.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;o.geoID=Pg.get(parseInt(n.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(o)}return r}parseScene(e,t,r){Bg=new i.ZAu;const n=this.parseModels(e.skeletons,t,r),s=Dg.Objects.Model,o=this;n.forEach(function(e){const t=s[e.ID];o.setLookAtProperties(e,t),Pg.get(e.ID).parents.forEach(function(t){const r=n.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&Bg.add(e)}),this.bindSkeleton(e.skeletons,t,n),this.createAmbientLight(),Bg.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Xg(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});const a=(new Fg).parse();1===Bg.children.length&&Bg.children[0].isGroup&&(Bg.children[0].animations=a,Bg=Bg.children[0]),Bg.animations=a}parseModels(e,t,r){const n=new Map,s=Dg.Objects.Model;for(const o in s){const a=parseInt(o),l=s[o],c=Pg.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,r);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new i.N$j;break;default:u=new i.ZAu}u.name=l.attrName?i.iUV.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),n.set(a,u)}return n}buildSkeleton(e,t,r,n){let s=null;return e.parents.forEach(function(e){for(const o in t){const a=t[o];a.rawBones.forEach(function(t,o){if(t.ID===e.ID){const e=s;(s=new i.N$j).matrixWorld.copy(t.transformLink),s.name=n?i.iUV.sanitizeNodeName(n):"",s.ID=r,a.bones[o]=s,null!==e&&s.add(e)}})}}),s}createCamera(e){let t,r;if(e.children.forEach(function(e){const t=Dg.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new i.Tme;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let n=1;void 0!==r.NearPlane&&(n=r.NearPlane.value/1e3);let s=1e3;void 0!==r.FarPlane&&(s=r.FarPlane.value/1e3);let o=window.innerWidth,a=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(o=r.AspectWidth.value,a=r.AspectHeight.value);const l=o/a;let c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new i.cPb(c,l,n,s),null!==u&&t.setFocalLength(u);break;case 1:t=new i.iKG(-o/2,o/2,a/2,-a/2,n,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new i.Tme}}return t}createLight(e){let t,r;if(e.children.forEach(function(e){const t=Dg.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new i.Tme;else{let e;e=void 0===r.LightType?0:r.LightType.value;let n=16777215;void 0!==r.Color&&(n=(new i.Ilk).fromArray(r.Color.value));let s=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(s=0);let o=0;void 0!==r.FarAttenuationEnd&&(o=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new i.cek(n,s,o,a);break;case 1:t=new i.Ox3(n,s);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=i.M8C.degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=i.M8C.degToRad(r.OuterAngle.value),l=Math.max(l,1)),t=new i.PMe(n,s,o,e,l,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new i.cek(n,s)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let n,s=null,o=null;const a=[];return e.children.forEach(function(e){t.has(e.ID)&&(s=t.get(e.ID)),r.has(e.ID)&&a.push(r.get(e.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new i.xoR({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(e){e.vertexColors=!0}),s.FBX_Deformer?(n=new i.TUv(s,o)).normalizeSkinWeights():n=new i.Kj0(s,o),n}createCurve(e,t){const r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),n=new i.nls({color:3342591,linewidth:1});return new i.x12(r,n)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?Yg(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&Pg.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){const r=Dg.Objects.Model[t.ID];if("Lcl_Translation"in r){const t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Bg.add(e.target)):e.lookAt((new i.Pa4).fromArray(t))}}})}bindSkeleton(e,t,r){const n=this.parsePoseNodes();for(const s in e){const o=e[s];Pg.get(parseInt(o.ID)).parents.forEach(function(e){if(t.has(e.ID)){const t=e.ID;Pg.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new i.OdW(o.bones),n[e.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Dg.Objects){const t=Dg.Objects.Pose;for(const r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){const n=t[r].PoseNode;Array.isArray(n)?n.forEach(function(t){e[t.Node]=(new i.yGw).fromArray(t.Matrix.a)}):e[n.Node]=(new i.yGw).fromArray(n.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Dg&&"AmbientColor"in Dg.GlobalSettings){const e=Dg.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],n=e[2];if(0!==t||0!==r||0!==n){const e=new i.Ilk(t,r,n);Bg.add(new i.Mig(e,1))}}}}class Og{parse(e){const t=new Map;if("Geometry"in Dg.Objects){const r=Dg.Objects.Geometry;for(const i in r){const n=Pg.get(parseInt(i)),s=this.parseGeometry(n,r[i],e);t.set(parseInt(i),s)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const i=r.skeletons,n=[],s=e.parents.map(function(e){return Dg.Objects.Model[e.ID]});if(0===s.length)return;const o=e.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null);e.children.forEach(function(e){void 0!==r.morphTargets[e.ID]&&n.push(r.morphTargets[e.ID])});const a=s[0],l={};"RotationOrder"in a&&(l.eulerOrder=Yg(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const c=Xg(l);return this.genGeometry(t,o,n,c)}genGeometry(e,t,r,n){const s=new i.u9r;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new i.a$l(a.vertex,3);if(l.applyMatrix4(n),s.setAttribute("position",l),a.colors.length>0&&s.setAttribute("color",new i.a$l(a.colors,3)),t&&(s.setAttribute("skinIndex",new i.qlB(a.weightsIndices,4)),s.setAttribute("skinWeight",new i.a$l(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const e=(new i.Vkp).getNormalMatrix(n),t=new i.a$l(a.normal,3);t.applyNormalMatrix(e),s.setAttribute("normal",t)}if(a.uvs.forEach(function(e,t){let r="uv"+(t+1).toString();0===t&&(r="uv"),s.setAttribute(r,new i.a$l(a.uvs[t],2))}),o.material&&"AllSame"!==o.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach(function(r,i){r!==e&&(s.addGroup(t,i-t,e),e=r,t=i)}),s.groups.length>0){const t=s.groups[s.groups.length-1],r=t.start+t.count;r!==a.materialIndex.length&&s.addGroup(r,a.materialIndex.length-r,e)}0===s.groups.length&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,r,n),s}parseGeoNode(e,t){const r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(i,n){void 0===r.weightTable[i]&&(r.weightTable[i]=[]),r.weightTable[i].push({id:t,weight:e.weights[n]})})})),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,i=0,n=!1,s=[],o=[],a=[],l=[],c=[],u=[];const p=this;return e.vertexIndices.forEach(function(h,d){let f,g=!1;h<0&&(h^=-1,g=!0);let m=[],_=[];if(s.push(3*h,3*h+1,3*h+2),e.color){const t=Hg(d,r,h,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach(function(e){_.push(e.weight),m.push(e.id)}),_.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);const e=[0,0,0,0],t=[0,0,0,0];_.forEach(function(r,i){let n=r,s=m[i];t.forEach(function(t,r,i){if(n>t){i[r]=n,n=t;const o=e[r];e[r]=s,s=o}})}),m=e,_=t}for(;_.length<4;)_.push(0),m.push(0);for(let e=0;e<4;++e)c.push(_[e]),u.push(m[e])}if(e.normal){const t=Hg(d,r,h,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&((f=Hg(d,r,h,e.material)[0])<0&&(console.warn("THREE.FBXLoader: Invalid material index:",f),f=0)),e.uv&&e.uv.forEach(function(e,t){const i=Hg(d,r,h,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])}),i++,g&&(p.genFace(t,e,s,f,o,a,l,c,u,i),r++,i=0,s=[],o=[],a=[],l=[],c=[],u=[])}),t}genFace(e,t,r,i,n,s,o,a,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[3*(u-1)]),e.normal.push(n[3*(u-1)+1]),e.normal.push(n[3*(u-1)+2]),e.normal.push(n[3*u]),e.normal.push(n[3*u+1]),e.normal.push(n[3*u+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(u-1)]),e.uvs[r].push(o[r][2*(u-1)+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])})}addMorphTargets(e,t,r,i){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const n=this;r.forEach(function(r){r.rawTargets.forEach(function(r){const s=Dg.Objects.Geometry[r.geoID];void 0!==s&&n.genMorphGeometry(e,t,s,i,r.name)})})}genMorphGeometry(e,t,r,n,s){const o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let i=0;i<l.length;i++){const e=3*l[i];u[e]=a[3*i],u[e+1]=a[3*i+1],u[e+2]=a[3*i+2]}const p={vertexIndices:o,vertexPositions:u},h=this.genBuffers(p),d=new i.a$l(h.vertex,3);d.name=s||r.attrName,d.applyMatrix4(n),e.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Normals.a;let n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:n,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.UV.a;let n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:i,indices:n,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Colors.a;let n=[];return"IndexToDirect"===r&&(n=e.ColorIndex.a),{dataSize:4,buffer:i,indices:n,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const i=e.Materials.a,n=[];for(let s=0;s<i.length;++s)n.push(s);return{dataSize:1,buffer:i,indices:n,mappingType:t,referenceType:r}}parseNurbsGeometry(e){if(void 0===kg)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new i.u9r;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new i.u9r;const r=t-1,n=e.KnotVector.a,s=[],o=e.Points.a;for(let u=0,p=o.length;u<p;u+=4)s.push((new i.Ltg).fromArray(o,u));let a,l;if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){a=r,l=n.length-1-a;for(let e=0;e<r;++e)s.push(s[e])}const c=new kg(r,n,s,a,l).getPoints(12*s.length);return(new i.u9r).setFromPoints(c)}}class Fg{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const r in t){const i=t[r],n=this.addClip(i);e.push(n)}return e}parseClips(){if(void 0===Dg.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Dg.Objects.AnimationCurveNode,t=new Map;for(const r in e){const i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Dg.Objects.AnimationCurve;for(const r in t){const i={id:t[r].id,times:t[r].KeyTime.a.map(Vg),values:t[r].KeyValueFloat.a},n=Pg.get(i.id);if(void 0!==n){const t=n.parents[0].ID,r=n.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=i:r.match(/Y/)?e.get(t).curves.y=i:r.match(/Z/)?e.get(t).curves.z=i:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=Dg.Objects.AnimationLayer,r=new Map;for(const n in t){const t=[],s=Pg.get(parseInt(n));void 0!==s&&(s.children.forEach(function(r,n){if(e.has(r.ID)){const s=e.get(r.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===t[n]){const e=Pg.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){const s=Dg.Objects.Model[e.toString()];if(void 0===s)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);const o={modelName:s.attrName?i.iUV.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Bg.traverse(function(e){e.ID===s.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))}),o.transform||(o.transform=new i.yGw),"PreRotation"in s&&(o.preRotation=s.PreRotation.value),"PostRotation"in s&&(o.postRotation=s.PostRotation.value),t[n]=o}}t[n]&&(t[n][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===t[n]){const e=Pg.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,s=Pg.get(e).parents[0].ID,o=Pg.get(s).parents[0].ID,a=Pg.get(o).parents[0].ID,l=Dg.Objects.Model[a],c={modelName:l.attrName?i.iUV.sanitizeNodeName(l.attrName):"",morphName:Dg.Objects.Deformer[e].attrName};t[n]=c}t[n][s.attr]=s}}}),r.set(parseInt(n),t))}return r}parseAnimStacks(e){const t=Dg.Objects.AnimationStack,r={};for(const i in t){const n=Pg.get(parseInt(i)).children;n.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(n[0].ID);r[i]={name:t[i].attrName,layer:s}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new i.m7l(e.name,-1,t)}generateTracks(e){const t=[];let r=new i.Pa4,n=new i._fP,s=new i.Pa4;if(e.transform&&e.transform.decompose(r,n,s),r=r.toArray(),n=(new i.USm).setFromQuaternion(n,e.eulerOrder).toArray(),s=s.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){const r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,n){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,r);return new i.yC1(e+"."+n,s,o)}generateRotationTrack(e,t,r,n,s,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(i.M8C.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(i.M8C.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(i.M8C.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,r);void 0!==n&&((n=n.map(i.M8C.degToRad)).push(o),n=(new i.USm).fromArray(n),n=(new i._fP).setFromEuler(n)),void 0!==s&&((s=s.map(i.M8C.degToRad)).push(o),s=(new i.USm).fromArray(s),s=(new i._fP).setFromEuler(s).invert());const c=new i._fP,u=new i.USm,p=[];for(let i=0;i<l.length;i+=3)u.set(l[i],l[i+1],l[i+2],o),c.setFromEuler(u),void 0!==n&&c.premultiply(n),void 0!==s&&c.multiply(s),c.toArray(p,i/3*4);return new i.iLg(e+".quaternion",a,p)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),n=Bg.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new i.dUE(e.modelName+".morphTargetInfluences["+n+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,r=t[0];for(let i=1;i<t.length;i++){const n=t[i];n!==r&&(t[e]=n,r=n,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){const i=r,n=[];let s=-1,o=-1,a=-1;return e.forEach(function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];n.push(e),i[0]=e}else n.push(i[0]);if(-1!==o){const e=t.y.values[o];n.push(e),i[1]=e}else n.push(i[1]);if(-1!==a){const e=t.z.values[a];n.push(e),i[2]=e}else n.push(i[2])}),n}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const r=e.values[t-1],i=e.values[t]-r,n=Math.abs(i);if(n>=180){const s=n/180,o=i/s;let a=r+o;const l=e.times[t-1],c=(e.times[t]-l)/s;let u=l+c;const p=[],h=[];for(;u<e.times[t];)p.push(u),u+=c,h.push(a),a+=o;e.times=Zg(e.times,t,p),e.values=Zg(e.values,t,h)}}}}class Ug{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Gg,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,i){const n=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(n||s)return;const o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):a?t.parseNodeProperty(e,a,r[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:r},s=this.parseNodeAttr(i),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in o?("PoseNode"===r?o.PoseNode.push(n):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==s.id&&(o[r][s.id]=n)):"number"==typeof s.id?(o[r]={},o[r][s.id]=n):"Properties70"!==r&&(o[r]="PoseNode"===r?[n]:n),"number"==typeof s.id&&(n.id=s.id),""!==s.name&&(n.attrName=s.name),""!==s.type&&(n.attrType=s.type),this.pushStack(n)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",i="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:r,type:i}}parseNodeProperty(e,t,r){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===i){const e=n.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]);let o=n.split(",").slice(3);i="connections",function(e,t){for(let r=0,i=e.length,n=t.length;r<n;r++,i++)e[i]=t[r]}(n=[t,r],o=o.map(function(e){return e.trim().replace(/^"/,"")})),void 0===s[i]&&(s[i]=[])}"Node"===i&&(s.id=n),i in s&&Array.isArray(s[i])?s[i].push(n):"a"!==i?s[i]=n:s.a=n,this.setCurrentProp(s,i),"a"===i&&","!==n.slice(-1)&&(s.a=Kg(n))}else this.parseNodeSpecialProperty(e,i,n)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Kg(t.a))}parseNodeSpecialProperty(e,t,r){const i=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=i[0],s=i[1],o=i[2],a=i[3];let l=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Kg(l)}this.getPrevNode()[n]={type:s,type2:o,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),n)}}class Ng{parse(e){const t=new jg(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const i=new Gg;for(;!this.endOfContent(t);){const e=this.parseNode(t,r);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},i=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(0===i)return null;const a=[];for(let p=0;p<n;p++)a.push(this.parseProperty(e));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(r.singleProperty=1===n&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(o,r,i)}return r.propertyList=a,"number"==typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==o&&(r.name=o),r}parseSubNode(e,t,r){if(!0===r.singleProperty){const e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){const e=[];r.propertyList.forEach(function(t,r){0!==r&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach(function(e){t[e]=r[e]});else if("Properties70"===e&&"P"===r.name){let e=r.propertyList[0],i=r.propertyList[1];const n=r.propertyList[2],s=r.propertyList[3];let o;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),o="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[e]={type:i,type2:n,flag:s,value:o}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){const r=e.getString(1);let i;switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(0===s)switch(r){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}void 0===t&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=qf(new Uint8Array(e.getArrayBuffer(o))),l=new jg(a.buffer);switch(r){case"b":case"c":return l.getBooleanArray(n);case"d":return l.getFloat64Array(n);case"f":return l.getFloat32Array(n);case"i":return l.getInt32Array(n);case"l":return l.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+r)}}}class jg{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let i=0;i<e;i++)t[i]=this.getUint8();const r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),i.Zp0.decodeText(new Uint8Array(t))}}class Gg{add(e,t){this[e]=t}}function zg(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Vg(e){return e/46186158e3}const Qg=[];function Hg(e,t,r,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=r;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(n=i.indices[n]);const s=n*i.dataSize,o=s+i.dataSize;return function(e,t,r,i){for(let n=s,s=0;n<i;n++,s++)e[s]=t[n];return e}(Qg,i.buffer,0,o)}const Wg=new i.USm,qg=new i.Pa4;function Xg(e){const t=new i.yGw,r=new i.yGw,n=new i.yGw,s=new i.yGw,o=new i.yGw,a=new i.yGw,l=new i.yGw,c=new i.yGw,u=new i.yGw,p=new i.yGw,h=new i.yGw,d=new i.yGw,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(qg.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(i.M8C.degToRad);t.push(e.eulerOrder||i.USm.DefaultOrder),r.makeRotationFromEuler(Wg.fromArray(t))}if(e.rotation){const t=e.rotation.map(i.M8C.degToRad);t.push(e.eulerOrder||i.USm.DefaultOrder),n.makeRotationFromEuler(Wg.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(i.M8C.degToRad);t.push(e.eulerOrder||i.USm.DefaultOrder),s.makeRotationFromEuler(Wg.fromArray(t)),s.invert()}e.scale&&o.scale(qg.fromArray(e.scale)),e.scalingOffset&&l.setPosition(qg.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(qg.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(qg.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(qg.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),p.copy(e.parentMatrixWorld));const g=r.clone().multiply(n).multiply(s),m=new i.yGw;m.extractRotation(p);const _=new i.yGw;_.copyPosition(p);const v=_.clone().invert().multiply(p),x=m.clone().invert().multiply(v),A=o,b=new i.yGw;if(0===f)b.copy(m).multiply(g).multiply(x).multiply(A);else if(1===f)b.copy(m).multiply(x).multiply(g).multiply(A);else{const e=(new i.yGw).scale((new i.Pa4).setFromMatrixScale(h)).clone().invert(),t=x.clone().multiply(e);b.copy(m).multiply(g).multiply(t).multiply(A)}const y=u.clone().invert(),w=a.clone().invert();let E=t.clone().multiply(c).multiply(u).multiply(r).multiply(n).multiply(s).multiply(y).multiply(l).multiply(a).multiply(o).multiply(w);const S=(new i.yGw).copyPosition(E),C=p.clone().multiply(S);return d.copyPosition(C),(E=d.clone().multiply(b)).premultiply(p.invert()),E}function Yg(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Kg(e){return e.split(",").map(function(e){return parseFloat(e)})}function Jg(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),i.Zp0.decodeText(new Uint8Array(e,t,r))}function Zg(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}class $g extends r{constructor(){super(...arguments),this.dependencies=[so],this._importer=new lr(Rg,["fbx"],!0)}async onAdded(e){to.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){to.Importers.splice(to.Importers.indexOf(this._importer),1)}}$g.PluginType="FBXLoadPlugin";const em=new WeakMap;class tm extends i.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,n){const s=new i.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),this.url=e,s.load(e,r=>{if(em.has(r))return em.get(r).promise.then(t).catch(n);this.decodeObjects(r,e).then(e=>{e.userData.warnings=this.warnings,t(e)}).catch(e=>n(e))},r,n)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let r,i;const n=e.byteLength,s=this._getWorker(n).then(t=>(r=t,i=this.workerNextTaskID++,new Promise((t,n)=>{r._callbacks[i]={resolve:t,reject:n},r.postMessage({type:"decode",id:i,buffer:e},[e])}))).then(e=>this._createGeometry(e.data)).catch(e=>{throw e});return s.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),em.set(e,{url:t,promise:s}),s}parse(e,t,r){this.decodeObjects(e,"").then(e=>{e.userData.warnings=this.warnings,t(e)}).catch(e=>r(e))}_compareMaterials(e){const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;for(let r=0;r<this.materials.length;r++){const e=this.materials[r],i={};if(i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type,JSON.stringify(t)===JSON.stringify(i))return e}return this.materials.push(e),e}_createMaterial(e){if(void 0===e)return new i.Wid({color:new i.Ilk(1,1,1),metalness:.8,name:"default",side:2});const t=e.diffuseColor,r=new i.Ilk(t.r/255,t.g/255,t.b/255);0===t.r&&0===t.g&&0===t.b&&(r.r=1,r.g=1,r.b=1);const n=new i.Wid({color:r,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),s=new i.dpR;for(let o=0;o<e.textures.length;o++){const t=e.textures[o];if(null!==t.image){const e=s.load(t.image);switch(t.type){case"Diffuse":n.map=e;break;case"Bump":n.bumpMap=e;break;case"Transparency":n.alphaMap=e,n.transparent=!0;break;case"Emap":n.envMap=e}e.wrapS=0===t.wrapU?i.rpg:i.uWy,e.wrapT=0===t.wrapV?i.rpg:i.uWy,e.repeat.set(t.repeat[0],t.repeat[1])}}return n}_createGeometry(e){const t=new i.Tme,r=[],n=[],s=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let o=e.objects;const a=e.materials;for(let i=0;i<o.length;i++){const l=o[i],c=l.attributes;switch(l.objectType){case"InstanceDefinition":n.push(l);break;case"InstanceReference":s.push(l);break;default:let i;if(c.materialIndex>=0){const e=a[c.materialIndex];let t=this._createMaterial(e);t=this._compareMaterials(t),i=this._createObject(l,t)}else{const e=this._createMaterial();i=this._createObject(l,e)}if(void 0===i)continue;const o=e.layers[c.layerIndex];i.visible=!o||e.layers[c.layerIndex].visible,c.isInstanceDefinitionObject?r.push(i):t.add(i)}}for(let l=0;l<n.length;l++){const e=n[l];o=[];for(let t=0;t<e.attributes.objectIds.length;t++){const i=e.attributes.objectIds[t];for(let e=0;e<r.length;e++)i===r[e].userData.attributes.id&&o.push(r[e])}for(let r=0;r<s.length;r++){const n=s[r];if(n.geometry.parentIdefId===e.attributes.id){const e=new i.Tme,r=n.geometry.xform.array,s=new i.yGw;s.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]),e.applyMatrix4(s);for(let t=0;t<o.length;t++)e.add(o[t].clone(!0));t.add(e)}}}return t.userData.materials=this.materials,t}_createObject(e,t){const r=new i.s4_,n=e.attributes;let s,o,a,l;switch(e.objectType){case"Point":case"PointSet":(s=r.parse(e.geometry)).attributes.hasOwnProperty("color")?o=new i.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(a=n.drawColor,l=new i.Ilk(a.r/255,a.g/255,a.b/255),o=new i.UY4({color:l,sizeAttenuation:!1,size:2})),o=this._compareMaterials(o);const c=new i.woe(s,o);return c.userData.attributes=n,c.userData.objectType=e.objectType,n.name&&(c.name=n.name),c;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(null===e.geometry)return;(s=r.parse(e.geometry)).attributes.hasOwnProperty("color")&&(t.vertexColors=!0),null===t&&(t=this._createMaterial(),t=this._compareMaterials(t));const u=new i.Kj0(s,t);return u.castShadow=n.castsShadows,u.receiveShadow=n.receivesShadows,u.userData.attributes=n,u.userData.objectType=e.objectType,n.name&&(u.name=n.name),u;case"Curve":s=r.parse(e.geometry),a=n.drawColor,l=new i.Ilk(a.r/255,a.g/255,a.b/255),o=new i.nls({color:l}),o=this._compareMaterials(o);const p=new i.x12(s,o);return p.userData.attributes=n,p.userData.objectType=e.objectType,n.name&&(p.name=n.name),p;case"TextDot":s=e.geometry;const h=document.createElement("canvas").getContext("2d"),d=`${s.fontHeight}px ${s.fontFace}`;h.font=d;const f=h.measureText(s.text).width+10,g=s.fontHeight+10,m=window.devicePixelRatio;h.canvas.width=f*m,h.canvas.height=g*m,h.canvas.style.width=f+"px",h.canvas.style.height=g+"px",h.setTransform(m,0,0,m,0,0),h.font=d,h.textBaseline="middle",h.textAlign="center",l=n.drawColor,h.fillStyle=`rgba(${l.r},${l.g},${l.b},${l.a})`,h.fillRect(0,0,f,g),h.fillStyle="white",h.fillText(s.text,f/2,g/2);const _=new i.ROQ(h.canvas);_.minFilter=i.wem,_.wrapS=i.uWy,_.wrapT=i.uWy,o=new i.xeV({map:_,depthTest:!1});const v=new i.jyi(o);return v.position.set(s.point[0],s.point[1],s.point[2]),v.scale.set(f/10,g/10,1),v.userData.attributes=n,v.userData.objectType=e.objectType,n.name&&(v.name=n.name),v;case"Light":let x;switch((s=e.geometry).lightStyle.name){case"LightStyle_WorldPoint":(x=new i.cek).castShadow=n.castsShadows,x.position.set(s.location[0],s.location[1],s.location[2]),x.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":(x=new i.PMe).castShadow=n.castsShadows,x.position.set(s.location[0],s.location[1],s.location[2]),x.target.position.set(s.direction[0],s.direction[1],s.direction[2]),x.angle=s.spotAngleRadians,x.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":x=new i.T_f;const e=Math.abs(s.width[2]),t=Math.abs(s.length[0]);x.position.set(s.location[0]-t/2,s.location[1],s.location[2]-e/2),x.height=t,x.width=e,x.lookAt(new i.Pa4(s.direction[0],s.direction[1],s.direction[2]));break;case"LightStyle_WorldDirectional":(x=new i.Ox3).castShadow=n.castsShadows,x.position.set(s.location[0],s.location[1],s.location[2]),x.target.position.set(s.direction[0],s.direction[1],s.direction[2]),x.shadow.normalBias=.1}return x&&(x.intensity=s.intensity,a=s.diffuse,l=new i.Ilk(a.r/255,a.g/255,a.b/255),x.color=l,x.userData.attributes=n,x.userData.objectType=e.objectType),x}}_initLibrary(){if(!this.libraryPending){const e=new i.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((t,r)=>{e.load("rhino3dm.js",t,void 0,r)}),r=new i.hH6(this.manager);r.setPath(this.libraryPath),r.setResponseType("arraybuffer");const n=new Promise((e,t)=>{r.load("rhino3dm.wasm",e,void 0,t)});this.libraryPending=Promise.all([t,n]).then(([e,t])=>{this.libraryConfig.wasmBinary=t;const r=function(){let e,t,r,i;function n(e,t){const n=e.geometry(),o=e.attributes();let a,l,c,u,p,h=n.objectType;switch(h){case r.ObjectType.Curve:const e=function e(t,i){let n=i,s=[];const o=[];if(t instanceof r.LineCurve)return[t.pointAtStart,t.pointAtEnd];if(t instanceof r.PolylineCurve){n=t.pointCount;for(let e=0;e<n;e++)s.push(t.point(e));return s}if(t instanceof r.PolyCurve){const r=t.segmentCount;for(let i=0;i<r;i++){const r=t.segmentCurve(i),o=e(r,n);s=s.concat(o),r.delete()}return s}if(t instanceof r.ArcCurve&&(n=Math.floor(t.angleDegrees/5),n=n<2?2:n),t instanceof r.NurbsCurve&&1===t.degree){const e=t.tryGetPolyline();for(let t=0;t<e.count;t++)s.push(e.get(t));return e.delete(),s}const a=t.domain,l=n-1;for(let r=0;r<n;r++){const e=a[0]+r/l*(a[1]-a[0]);if(e===a[0]||e===a[1]){o.push(e);continue}const i=t.tangentAt(e),n=t.tangentAt(o.slice(-1)[0]),s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],c=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],u=Math.sqrt(s*c);let p;if(0===u)p=Math.PI/2;else{const e=(i.x*n.x+i.y*n.y+i.z*n.z)/u;p=Math.acos(Math.max(-1,Math.min(1,e)))}p<.1||o.push(e)}return s=o.map(e=>t.pointAt(e)),s}(n,100);l={},u={},(c={}).itemSize=3,c.type="Float32Array",c.array=[];for(let t=0;t<e.length;t++)c.array.push(e[t][0]),c.array.push(e[t][1]),c.array.push(e[t][2]);l.position=c,u.attributes=l,a={data:u};break;case r.ObjectType.Point:const d=n.location,f={};l={},u={},(c={}).itemSize=3,c.type="Float32Array",c.array=[d[0],d[1],d[2]];const g=o.drawColor(t);f.itemSize=3,f.type="Float32Array",f.array=[g.r/255,g.g/255,g.b/255],l.position=c,l.color=f,u.attributes=l,a={data:u};break;case r.ObjectType.PointSet:case r.ObjectType.Mesh:a=n.toThreejsJSON();break;case r.ObjectType.Brep:const m=n.faces();p=new r.Mesh;for(let t=0;t<m.count;t++){const e=m.get(t),i=e.getMesh(r.MeshType.Any);i&&(p.append(i),i.delete()),e.delete()}p.faces().count>0&&(p.compact(),a=p.toThreejsJSON(),m.delete()),p.delete();break;case r.ObjectType.Extrusion:(p=n.getMesh(r.MeshType.Any))&&(a=p.toThreejsJSON(),p.delete());break;case r.ObjectType.TextDot:a=s(n);break;case r.ObjectType.Light:"LightStyle_WorldLinear"===(a=s(n)).lightStyle.name&&self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: No conversion exists for ${h.constructor.name} ${a.lightStyle.name}`,type:"no conversion",guid:o.id}});break;case r.ObjectType.InstanceReference:(a=s(n)).xform=s(n.xform),a.xform.array=n.xform.toFloatArray(!0);break;case r.ObjectType.SubD:n.subdivide(3),(p=r.Mesh.createFromSubDControlNet(n))&&(a=p.toThreejsJSON(),p.delete());break;default:self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: Conversion not implemented for ${h.constructor.name}`,type:"not implemented",guid:o.id}})}if(a)return(l=s(o)).geometry=s(n),o.groupCount>0&&(l.groupIds=o.getGroupList()),o.userStringCount>0&&(l.userStrings=o.getUserStrings()),n.userStringCount>0&&(l.geometry.userStrings=n.getUserStrings()),l.drawColor=o.drawColor(t),h=(h=h.constructor.name).substring(11,h.length),{geometry:a,attributes:l,objectType:h};self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: ${h.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:o.id}})}function s(e){const t={};for(const r in e){const i=e[r];"function"!=typeof i&&("object"==typeof i&&null!==i&&i.hasOwnProperty("constructor")?t[r]={name:i.constructor.name,value:i.value}:t[r]=i)}return t}onmessage=function(o){const a=o.data;switch(a.type){case"init":const o=(t=a.libraryConfig).wasmBinary;let l;e=new Promise(function(e){l={wasmBinary:o,onRuntimeInitialized:e},rhino3dm(l)}).then(()=>{r=l});break;case"decode":i=a.id;const c=a.buffer;e.then(()=>{try{const t=function(e,t){const r=new Uint8Array(t),o=e.File3dm.fromByteArray(r),a=[],l=[],c=[],u=[],p=[],h=[],d=[],f=o.objects(),g=f.count;for(let i=0;i<g;i++){const e=f.get(i),t=n(e,o);e.delete(),t&&a.push(t)}for(let i=0;i<o.instanceDefinitions().count();i++){const e=o.instanceDefinitions().get(i),t=s(e);t.objectIds=e.getObjectIds(),a.push({geometry:null,attributes:t,objectType:"InstanceDefinition"})}const m=[e.TextureType.Diffuse,e.TextureType.Bump,e.TextureType.Transparency,e.TextureType.Opacity,e.TextureType.Emap],_=[e.TextureType.PBR_BaseColor,e.TextureType.PBR_Subsurface,e.TextureType.PBR_SubsurfaceScattering,e.TextureType.PBR_SubsurfaceScatteringRadius,e.TextureType.PBR_Metallic,e.TextureType.PBR_Specular,e.TextureType.PBR_SpecularTint,e.TextureType.PBR_Roughness,e.TextureType.PBR_Anisotropic,e.TextureType.PBR_Anisotropic_Rotation,e.TextureType.PBR_Sheen,e.TextureType.PBR_SheenTint,e.TextureType.PBR_Clearcoat,e.TextureType.PBR_ClearcoatBump,e.TextureType.PBR_ClearcoatRoughness,e.TextureType.PBR_OpacityIor,e.TextureType.PBR_OpacityRoughness,e.TextureType.PBR_Emission,e.TextureType.PBR_AmbientOcclusion,e.TextureType.PBR_Displacement];for(let n=0;n<o.materials().count();n++){const e=o.materials().get(n),t=e.physicallyBased();let r=s(e);const a=[];for(let n=0;n<m.length;n++){const t=e.getTexture(m[n]);if(t){let e=m[n].constructor.name;const r={type:e=e.substring(12,e.length)},s=o.getEmbeddedFileAsBase64(t.fileName);r.wrapU=t.wrapU,r.wrapV=t.wrapV,r.wrapW=t.wrapW;const l=t.uvwTransform.toFloatArray(!0);r.repeat=[l[0],l[5]],s?r.image="data:image/png;base64,"+s:(self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: Image for ${e} texture not embedded in file.`,type:"missing resource"}}),r.image=null),a.push(r),t.delete()}}if(r.textures=a,t.supported){for(let r=0;r<_.length;r++){const t=e.getTexture(_[r]);if(t){const e=o.getEmbeddedFileAsBase64(t.fileName);let i=_[r].constructor.name;const n={type:i=i.substring(12,i.length),image:"data:image/png;base64,"+e};a.push(n),t.delete()}}const t=s(e.physicallyBased());r=Object.assign(t,r)}l.push(r),e.delete(),t.delete()}for(let i=0;i<o.layers().count();i++){const e=o.layers().get(i),t=s(e);c.push(t),e.delete()}for(let i=0;i<o.views().count();i++){const e=o.views().get(i),t=s(e);u.push(t),e.delete()}for(let i=0;i<o.namedViews().count();i++){const e=o.namedViews().get(i),t=s(e);p.push(t),e.delete()}for(let i=0;i<o.groups().count();i++){const e=o.groups().get(i),t=s(e);h.push(t),e.delete()}const v=s(o.settings()),x=o.strings().count();for(let i=0;i<x;i++)d.push(o.strings().get(i));return o.delete(),{objects:a,materials:l,layers:c,views:u,namedViews:p,groups:h,strings:d,settings:v}}(r,c);self.postMessage({type:"decode",id:a.id,data:t})}catch(e){self.postMessage({type:"error",id:a.id,error:e})}})}}}.toString(),i=["/* rhino3dm.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",libraryConfig:this.libraryConfig}),e.onmessage=(t=>{const r=t.data;switch(r.type){case"warning":this.warnings.push(r.data),console.warn(r.data);break;case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+r.type+'"')}}),this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}class rm extends tm{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/")}async loadAsync(e,t){const r=await super.loadAsync(e,t);return r.rotateX(-Math.PI/2),r}}class im extends r{constructor(){super(...arguments),this.dependencies=[so],this._importer=new lr(rm,["3dm"],!0)}async onAdded(e){to.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){to.Importers.splice(to.Importers.indexOf(this._importer),1)}}im.PluginType="Rhino3dmLoadPlugin";class nm extends r{constructor(){super(...arguments),this.dependencies=[so]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML="\nimport { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'\nwindow.MeshoptDecoder = MeshoptDecoder\n",document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}nm.PluginType="GLTFMeshOptPlugin";class sm extends i.aNw{constructor(e){super(e)}load(e,t,r,n){const s=this,o=new i.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(r){try{t(s.parse(r))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}},r,n)}parse(e){function t(e,t,r){for(let i=0,n=e.length;i<n;i++)if(e[i]!==t.getUint8(r+i))return!1;return!0}const r=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){const r=new DataView(e);if(84+50*r.getUint32(80,!0)===r.byteLength)return!0;const i=[115,111,108,105,100];for(let n=0;n<5;n++)if(t(i,r,n))return!1;return!0}(r)?function(e){const t=new DataView(e),r=t.getUint32(80,!0);let n,s,o,a,l,c,u,p,h=!1;for(let i=0;i<70;i++)1129270351==t.getUint32(i,!1)&&82==t.getUint8(i+4)&&61==t.getUint8(i+5)&&(h=!0,a=new Float32Array(3*r*3),l=t.getUint8(i+6)/255,c=t.getUint8(i+7)/255,u=t.getUint8(i+8)/255,p=t.getUint8(i+9)/255);const d=new i.u9r,f=new Float32Array(3*r*3),g=new Float32Array(3*r*3);for(let i=0;i<r;i++){const e=84+50*i,r=t.getFloat32(e,!0),p=t.getFloat32(e+4,!0),d=t.getFloat32(e+8,!0);if(h){const r=t.getUint16(e+48,!0);0==(32768&r)?(n=(31&r)/31,s=(r>>5&31)/31,o=(r>>10&31)/31):(n=l,s=c,o=u)}for(let l=1;l<=3;l++){const c=e+12*l,u=3*i*3+3*(l-1);f[u]=t.getFloat32(c,!0),f[u+1]=t.getFloat32(c+4,!0),f[u+2]=t.getFloat32(c+8,!0),g[u]=r,g[u+1]=p,g[u+2]=d,h&&(a[u]=n,a[u+1]=s,a[u+2]=o)}}return d.setAttribute("position",new i.TlE(f,3)),d.setAttribute("normal",new i.TlE(g,3)),h&&(d.setAttribute("color",new i.TlE(a,3)),d.hasColors=!0,d.alpha=p),d}(r):function(e){const t=new i.u9r,r=/solid([\s\S]*?)endsolid/g,n=/facet([\s\S]*?)endfacet/g;let s=0;const o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),c=[],u=[],p=new i.Pa4;let h,d=0,f=0,g=0;for(;null!==(h=r.exec(e));){f=g;const e=h[0];for(;null!==(h=n.exec(e));){let e=0,t=0;const r=h[0];for(;null!==(h=l.exec(r));)p.x=parseFloat(h[1]),p.y=parseFloat(h[2]),p.z=parseFloat(h[3]),t++;for(;null!==(h=a.exec(r));)c.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),u.push(p.x,p.y,p.z),e++,g++;1!==t&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+s),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+s),s++}const r=f,i=g-f;t.addGroup(r,i,d),d++}return t.setAttribute("position",new i.a$l(c,3)),t.setAttribute("normal",new i.a$l(u,3)),t}("string"!=typeof(n=e)?i.Zp0.decodeText(new Uint8Array(n)):n);var n}}class om extends r{constructor(){super(...arguments),this.dependencies=[so]}async onAdded(e){this._importer||(this._importer=new lr(sm,["stl"],!0)),to.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&to.Importers.splice(to.Importers.indexOf(this._importer),1),this._importer=void 0}}om.PluginType="STLLoadPlugin";class am extends i.aNw{constructor(e){super(e)}load(e,t,r,n){const s=this,o=""===this.path?i.Zp0.extractUrlBase(e):this.path,a=new i.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(r){try{t(s.parse(r,o))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}},r,n)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split("\n");let i={};const n=/\s+/,s={};for(let a=0;a<r.length;a++){let e=r[a];if(0===(e=e.trim()).length||"#"===e.charAt(0))continue;const t=e.indexOf(" ");let o=t>=0?e.substring(0,t):e;o=o.toLowerCase();let l=t>=0?e.substring(t+1):"";if(l=l.trim(),"newmtl"===o)i={name:l},s[l]=i;else if("ka"===o||"kd"===o||"ks"===o||"ke"===o){const e=l.split(n,3);i[o]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[o]=l}const o=new lm(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(s),o}}class lm{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:i.Wl3,this.wrap=void 0!==this.options.wrap?this.options.wrap:i.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const i=e[r],n={};t[r]=n;for(const e in i){let t=!0,r=i[e];const s=e.toLowerCase();switch(s){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(t=!1)}t&&(n[s]=r)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return void 0===this.materials[e]&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,r=this.materialsInfo[e],n={name:e,side:this.side};async function s(e,r){if(n[e])return;const i=t.getTextureParams(r,n);return new Promise((r,s)=>{let o=!1,a=()=>!o&&(o=!0)&&r();const l=t.loadTexture((c=t.baseUrl,"string"!=typeof(u=i.url)||""===u?"":/^https?:\/\//i.test(u)?u:c+u),void 0,t=>{n[e]=t,a()},void 0,a);var c,u;setTimeout(a,50),l.repeat.copy(i.scale),l.offset.copy(i.offset),l.wrapS=t.wrap,l.wrapT=t.wrap})}const o=Array.from(Object.keys(r||{}));let a=o.includes("d")||o.includes("D");for(const l of o){const e=r[l];let t;if(""!==e)switch(l.toLowerCase()){case"kd":n.color=(new i.Ilk).fromArray(e);break;case"ks":n.specular=(new i.Ilk).fromArray(e);break;case"ke":n.emissive=(new i.Ilk).fromArray(e);break;case"map_kd":await s("map",e);break;case"map_ks":await s("specularMap",e);break;case"map_ke":await s("emissiveMap",e);break;case"norm":await s("normalMap",e);break;case"map_bump":case"bump":await s("bumpMap",e);break;case"map_d":await s("alphaMap",e),n.transparent=!0;break;case"ns":n.shininess=parseFloat(e);break;case"d":(t=parseFloat(e))<1&&(n.opacity=t,n.transparent=!0);break;case"tr":if(a)break;t=parseFloat(e),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(n.opacity=1-t,n.transparent=!0)}}return this.materials[e]=new i.xoR(n),this.materials[e]}getTextureParams(e,t){const r={scale:new i.FM8(1,1),offset:new i.FM8(0,0)},n=e.split(/\s+/);let s;return(s=n.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(n[s+1]),n.splice(s,2)),(s=n.indexOf("-s"))>=0&&(r.scale.set(parseFloat(n[s+1]),parseFloat(n[s+2])),n.splice(s,4)),(s=n.indexOf("-o"))>=0&&(r.offset.set(parseFloat(n[s+1]),parseFloat(n[s+2])),n.splice(s,4)),r.url=n.join(" ").trim(),r}loadTexture(e,t,r,n,s){const o=void 0!==this.manager?this.manager:i.tEQ;let a=o.getHandler(e);null===a&&(a=new i.dpR(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const l=a.load(e,r,n,s);return void 0!==t&&(l.mapping=t),l}}const cm=/^[og]\s*(.+)?/,um=/^mtllib /,pm=/^usemtl /,hm=/^usemap /,dm=new i.Pa4,fm=new i.Pa4,gm=new i.Pa4,mm=new i.Pa4,_m=new i.Pa4;function vm(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){const e=r.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){const r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){const i=this.vertices,n=this.object.geometry.vertices;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const i=this.normals,n=this.object.geometry.normals;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addFaceNormal:function(e,t,r){const i=this.vertices,n=this.object.geometry.normals;dm.fromArray(i,e),fm.fromArray(i,t),gm.fromArray(i,r),_m.subVectors(gm,fm),mm.subVectors(dm,fm),_m.cross(mm),_m.normalize(),n.push(_m.x,_m.y,_m.z),n.push(_m.x,_m.y,_m.z),n.push(_m.x,_m.y,_m.z)},addColor:function(e,t,r){const i=this.colors,n=this.object.geometry.colors;void 0!==i[e]&&n.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&n.push(i[t+0],i[t+1],i[t+2]),void 0!==i[r]&&n.push(i[r+0],i[r+1],i[r+2])},addUV:function(e,t,r){const i=this.uvs,n=this.object.geometry.uvs;n.push(i[e+0],i[e+1]),n.push(i[t+0],i[t+1]),n.push(i[r+0],i[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,i,n,s,o,a,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),p=this.parseVertexIndex(t,c),h=this.parseVertexIndex(r,c);if(this.addVertex(u,p,h),this.addColor(u,p,h),void 0!==o&&""!==o){const e=this.normals.length;u=this.parseNormalIndex(o,e),p=this.parseNormalIndex(a,e),h=this.parseNormalIndex(l,e),this.addNormal(u,p,h)}else this.addFaceNormal(u,p,h);if(void 0!==i&&""!==i){const e=this.uvs.length;u=this.parseUVIndex(i,e),p=this.parseUVIndex(n,e),h=this.parseUVIndex(s,e),this.addUV(u,p,h),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,i=e.length;r<i;r++){const i=this.parseVertexIndex(e[r],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,i=this.uvs.length;for(let n=0,s=e.length;n<s;n++)this.addVertexLine(this.parseVertexIndex(e[n],r));for(let n=0,s=t.length;n<s;n++)this.addUVLine(this.parseUVIndex(t[n],i))}};return e.startObject("",!1),e}class xm extends i.aNw{constructor(e){super(e),this.materials=null}load(e,t,r,n){const s=this,o=new i.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,async function(r){try{t(await s.parse(r))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}},r,n)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new vm;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const r=e.split("\n");let n="",s="",o=0,a=[];const l="function"==typeof"".trimLeft;for(let i=0,u=r.length;i<u;i++)if(n=r[i],0!==(o=(n=l?n.trimLeft():n.trim()).length)&&"#"!==(s=n.charAt(0)))if("v"===s){const e=n.split(/\s+/);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?t.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===s){const e=n.substr(1).trim().split(/\s+/),r=[];for(let t=0,n=e.length;t<n;t++){const i=e[t];if(i.length>0){const e=i.split("/");r.push(e)}}const i=r[0];for(let n=1,s=r.length-1;n<s;n++){const e=r[n],s=r[n+1];t.addFace(i[0],e[0],s[0],i[1],e[1],s[1],i[2],e[2],s[2])}}else if("l"===s){const e=n.substring(1).trim().split(" ");let r=[];const i=[];if(-1===n.indexOf("/"))r=e;else for(let t=0,n=e.length;t<n;t++){const n=e[t].split("/");""!==n[0]&&r.push(n[0]),""!==n[1]&&i.push(n[1])}t.addLineGeometry(r,i)}else if("p"===s){const e=n.substr(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(a=cm.exec(n))){const e=(" "+a[0].substr(1).trim()).substr(1);t.startObject(e)}else if(pm.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(um.test(n)){t.materialLibraries.push(n.substring(7).trim());const e=n.substring(7).trim(),r=this.manager.getHandler(e);if(r){const t=await r.loadAsync(e).catch(e=>{console.warn(e)});t&&this.setMaterials(t)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(hm.test(n))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===s){if((a=n.split(" ")).length>1){const e=a[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===n)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+n+'"')}t.finalize();const c=new i.ZAu;if(c.materialLibraries=[].concat(t.materialLibraries),1==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let u=0,p=t.objects.length;u<p;u++){const e=t.objects[u],r=e.geometry,n=e.materials,s="Line"===r.type,o="Points"===r.type;let a=!1;if(0===r.vertices.length)continue;const l=new i.u9r;l.setAttribute("position",new i.a$l(r.vertices,3)),r.normals.length>0&&l.setAttribute("normal",new i.a$l(r.normals,3)),r.colors.length>0&&(a=!0,l.setAttribute("color",new i.a$l(r.colors,3))),!0===r.hasUVIndices&&l.setAttribute("uv",new i.a$l(r.uvs,2));const p=[];for(let c=0,u=n.length;c<u;c++){const e=n[c],r=e.name+"_"+e.smooth+"_"+a;let l=t.materials[r];if(null!==this.materials)if(l=await this.materials.create(e.name),!s||!l||l instanceof i.nls){if(o&&l&&!(l instanceof i.UY4)){const e=new i.UY4({size:10,sizeAttenuation:!1});i.F5T.prototype.copy.call(e,l),e.color.copy(l.color),e.map=l.map,l=e}}else{const e=new i.nls;i.F5T.prototype.copy.call(e,l),e.color.copy(l.color),l=e}void 0===l&&((l=s?new i.nls:o?new i.UY4({size:1,sizeAttenuation:!1}):new i.xoR).name=e.name,l.flatShading=!e.smooth,l.vertexColors=a,t.materials[r]=l),p.push(l)}let h;if(p.length>1){for(let e=0,t=n.length;e<t;e++){const t=n[e];l.addGroup(t.groupStart,t.groupCount,e)}h=s?new i.ejS(l,p):o?new i.woe(l,p):new i.Kj0(l,p)}else h=s?new i.ejS(l,p[0]):o?new i.woe(l,p[0]):new i.Kj0(l,p[0]);h.name=e.name,c.add(h)}else if(t.vertices.length>0){const e=new i.UY4({size:1,sizeAttenuation:!1}),r=new i.u9r;r.setAttribute("position",new i.a$l(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(r.setAttribute("color",new i.a$l(t.colors,3)),e.vertexColors=!0);const n=new i.woe(r,e);c.add(n)}return c}}class Am extends r{constructor(){super(...arguments),this.dependencies=[so],this._importer1=new lr(xm,["obj"],!0),this._importer2=new lr(am,["mtl"],!1)}async onAdded(e){to.Importers.push(this._importer1),to.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){to.Importers.splice(to.Importers.indexOf(this._importer1),1),to.Importers.splice(to.Importers.indexOf(this._importer2),1)}}Am.PluginType="ObjMtlLoadPlugin";class bm extends i.DqL{constructor(e){super(e)}parse(e,t){const r=new ym(e,1);return{mipmaps:r.mipmaps(t),width:r.pixelWidth,height:r.pixelHeight,format:r.glInternalFormat,isCubemap:6===r.numberOfFaces,mipmapCount:r.numberOfMipmapLevels}}}class ym{constructor(e,t){this.arrayBuffer=e;const r=new Uint8Array(this.arrayBuffer,0,12);if(171!==r[0]||75!==r[1]||84!==r[2]||88!==r[3]||32!==r[4]||49!==r[5]||49!==r[6]||187!==r[7]||13!==r[8]||10!==r[9]||26!==r[10]||10!==r[11])return void console.error("texture missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,n=new DataView(this.arrayBuffer,12,13*i),s=67305985===n.getUint32(0,!0);this.glType=n.getUint32(1*i,s),this.glTypeSize=n.getUint32(2*i,s),this.glFormat=n.getUint32(3*i,s),this.glInternalFormat=n.getUint32(4*i,s),this.glBaseInternalFormat=n.getUint32(5*i,s),this.pixelWidth=n.getUint32(6*i,s),this.pixelHeight=n.getUint32(7*i,s),this.pixelDepth=n.getUint32(8*i,s),this.numberOfArrayElements=n.getUint32(9*i,s),this.numberOfFaces=n.getUint32(10*i,s),this.numberOfMipmapLevels=n.getUint32(11*i,s),this.bytesOfKeyValueData=n.getUint32(12*i,s),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let r=64+this.bytesOfKeyValueData,i=this.pixelWidth,n=this.pixelHeight;const s=e?this.numberOfMipmapLevels:1;for(let o=0;o<s;o++){const e=new Int32Array(this.arrayBuffer,r,1)[0];r+=4;for(let s=0;s<this.numberOfFaces;s++){const s=new Uint8Array(this.arrayBuffer,r,e);t.push({data:s,width:i,height:n}),r+=e,r+=3-(e+3)%4}i=Math.max(1,.5*i),n=Math.max(1,.5*n)}return t}}class wm extends r{constructor(){super(...arguments),this.dependencies=[so]}async onAdded(e){this._importer||(this._importer=new lr(bm,["ktx"],!1)),to.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&to.Importers.splice(to.Importers.indexOf(this._importer),1),this._importer=void 0}}wm.PluginType="KTXLoadPlugin";class Em extends i.hH6{constructor(e){super(e),this.responseType="blob"}}class Sm extends i.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,r,i){return super.load(e,e=>{try{null==t||t(bt(e))}catch(e){null==i||i(e)}},r,i)}}class Cm{async parseAsync(e,t){var r;return new Blob([JSON.stringify(e,null,null!==(r=t.jsonSpaces)&&void 0!==r?r:2)],{type:"application/json"})}}class Mm{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}class Tm{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Um(e)}),this.register(function(e){return new Nm(e)}),this.register(function(e){return new jm(e)}),this.register(function(e){return new Vm(e)}),this.register(function(e){return new Qm(e)}),this.register(function(e){return new Gm(e)}),this.register(function(e){return new Hm(e)}),this.register(function(e){return new zm(e)}),this.register(function(e){return new Wm(e)})}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i,n){const s=n||new Fm,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](s));s.setPlugins(o),s.write(e,t,i).catch(r)}parseAsync(e,t){const r=this;return new Promise(function(i,n){r.parse(e,i,n,t)})}}const Im=5121,km=5123,Dm={};Dm[i.TyD]=9728,Dm[i.YLQ]=9984,Dm[i.aH4]=9986,Dm[i.wem]=9729,Dm[i.qyh]=9985,Dm[i.D1R]=9987,Dm[i.uWy]=33071,Dm[i.rpg]=10497,Dm[i.OoA]=33648;const Pm={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function Bm(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function Rm(e){return 4*Math.ceil(e/4)}function Lm(e,t=0){const r=Rm(e.byteLength);if(r!==e.byteLength){const i=new Uint8Array(r);if(i.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<r;n++)i[n]=t;return i.buffer}return e}function Om(e,t){if(void 0!==e.toBlob)return new Promise(r=>e.toBlob(r,t));let r;return"image/jpeg"===t?r=.92:"image/webp"===t&&(r=.8),e.convertToBlob({type:t,quality:r})}class Fm{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,r){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,n=i.buffers,s=i.json;r=i.options;const o=i.extensionsUsed,a=new Blob(n,{type:"application/octet-stream"}),l=Object.keys(o);if(l.length>0&&(s.extensionsUsed=l),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=a.size),!0===r.binary){const e=new FileReader;e.readAsArrayBuffer(a),e.onloadend=function(){const r=Lm(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,r.byteLength,!0),i.setUint32(4,5130562,!0);const n=Lm((o=JSON.stringify(s),(new TextEncoder).encode(o).buffer),32);var o;const a=new DataView(new ArrayBuffer(8));a.setUint32(0,n.byteLength,!0),a.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const u=12+a.byteLength+n.byteLength+i.byteLength+r.byteLength;c.setUint32(8,u,!0);const p=new Blob([l,a,n,i,r],{type:"application/octet-stream"}),h=new FileReader;h.readAsArrayBuffer(p),h.onloadend=function(){t(h.result)}}}else if(s.buffers&&s.buffers.length>0){const e=new FileReader;e.readAsDataURL(a),e.onloadend=function(){const r=e.result;s.buffers[0].uri=r,t(s)}}else t(s)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const r=this.options,i=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],i[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message),console.warn({...e.userData})}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new i.Pa4;for(let r=0,i=e.count;r<i;r++)if(Math.abs(t.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const r=e.clone(),n=new i.Pa4;for(let i=0,s=r.count;i<s;i++)n.fromBufferAttribute(r,i),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),r.setXYZ(i,n.x,n.y,n.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1;const i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(i.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(e){return e.encoding===i.knz?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const n=e?e.image:void 0,s=t?t.image:void 0,o=Math.max(n?n.width:0,s?s.width:0),a=Math.max(n?n.height:0,s?s.height:0),l=document.createElement("canvas");l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const u=c.getImageData(0,0,o,a);if(n){c.drawImage(n,0,0,o,a);const t=r(e),i=c.getImageData(0,0,o,a).data;for(let e=2;e<i.length;e+=4)u.data[e]=256*t(i[e]/256)}if(s){c.drawImage(s,0,0,o,a);const e=r(t),i=c.getImageData(0,0,o,a).data;for(let t=1;t<i.length;t+=4)u.data[t]=256*e(i[t]/256)}c.putImageData(u,0,0);const p=(e||t).clone();return p.source=new i.Hw6(l),p.encoding=i.rnI,p}processBuffer(e){const t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,i,n){const s=this.json;let o;s.bufferViews||(s.bufferViews=[]),o=t===Im?1:t===km?2:4;const a=Rm(i*e.itemSize*o),l=new DataView(new ArrayBuffer(a));let c=0;for(let p=r;p<r+i;p++)for(let r=0;r<e.itemSize;r++){let i;e.itemSize>4?i=e.array[p*e.itemSize+r]:0===r?i=e.getX(p):1===r?i=e.getY(p):2===r?i=e.getZ(p):3===r&&(i=e.getW(p)),5126===t?l.setFloat32(c,i,!0):5125===t?l.setUint32(c,i,!0):t===km?l.setUint16(c,i,!0):t===Im&&l.setUint8(c,i),c+=o}const u={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:a};return void 0!==n&&(u.target=n),34962===n&&(u.byteStride=e.itemSize*o),this.byteOffset+=a,s.bufferViews.push(u),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise(function(i){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=Lm(n.result),s={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(r.bufferViews.push(s)-1)}})}processAccessor(e,t,r,i){const n=this.options,s=this.json;let o;if(e.array.constructor===Float32Array)o=5126;else if(e.array.constructor===Uint32Array)o=5125;else if(e.array.constructor===Uint16Array)o=km;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=Im}if(void 0===r&&(r=0),void 0===i&&(i=e.count),n.truncateDrawRange&&void 0!==t&&null===t.index){const n=r+i,s=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;r=Math.max(r,t.drawRange.start),(i=Math.min(n,s)-r)<0&&(i=0)}if(0===i)return null;const a=function(e,t,r){const i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+r;n++)for(let t=0;t<e.itemSize;t++){let r;e.itemSize>4?r=e.array[n*e.itemSize+t]:0===t?r=e.getX(n):1===t?r=e.getY(n):2===t?r=e.getZ(n):3===t&&(r=e.getW(n)),i.min[t]=Math.min(i.min[t],r),i.max[t]=Math.max(i.max[t],r)}return i}(e,r,i);let l;void 0!==t&&(l=e===t.index?34963:34962);const c=this.processBufferView(e,o,r,i,l),u={bufferView:c.id,byteOffset:c.byteOffset,componentType:o,count:i,max:a.max,min:a.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return s.accessors||(s.accessors=[]),s.accessors.push(u)-1}processImage(e,t,r,n="image/png"){const s=this,o=s.cache,a=s.json,l=s.options,c=s.pending;o.images.has(e)||o.images.set(e,{});const u=o.images.get(e),p=n+":flipY/"+r.toString();if(void 0!==u[p])return u[p];a.images||(a.images=[]);const h={mimeType:n},d="undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas");d.width=Math.min(e.width,l.maxTextureSize),d.height=Math.min(e.height,l.maxTextureSize);const f=d.getContext("2d");if(!0===r&&(f.translate(0,d.height),f.scale(1,-1)),void 0!==e.data){t!==i.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const r=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<r.length;t+=4)r[t+0]=e.data[t+0],r[t+1]=e.data[t+1],r[t+2]=e.data[t+2],r[t+3]=e.data[t+3];f.putImageData(new ImageData(r,e.width,e.height),0,0)}else f.drawImage(e,0,0,d.width,d.height);!0===l.binary?c.push(Om(d,n).then(e=>s.processBufferViewImage(e)).then(e=>{h.bufferView=e})):void 0!==d.toDataURL?h.uri=d.toDataURL(n):c.push(Om(d,n).then(e=>(new FileReader).readAsDataURL(e)).then(e=>{h.uri=e}));const g=a.images.push(h)-1;return u[p]=g,g}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const r={magFilter:Dm[e.magFilter],minFilter:Dm[e.minFilter],wrapS:Dm[e.wrapS],wrapT:Dm[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){const t=this.cache,r=this.json;if(t.textures.has(e))return t.textures.get(e);r.textures||(r.textures=[]);let i=e.userData.mimeType;"image/webp"===i&&(i="image/png"),"image/jpg"===i&&(i="image/jpeg");const n=["image/jpeg","image/png"];i&&!n.includes(i)&&console.error("GLTFExporter: Unsupported mime type: "+i+". Cannot export texture.",e);const s={sampler:this.processSampler(e),source:!i||n.includes(i)?this.processImage(e.image,e.format,e.flipY,i):null};e.name&&(s.name=e.name),this._invokeAll(function(t){t.writeTexture&&t.writeTexture(e,s)});const o=r.textures.push(s)-1;return t.textures.set(e,o),o}processMaterial(e){const t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);const n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(Bm(s,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),r={index:this.processTexture(t)};this.applyTextureTransform(r,t),n.pbrMetallicRoughness.metallicRoughnessTexture=r}if(e.map){const t={index:this.processTexture(e.map)};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive.clone().multiplyScalar(e.emissiveIntensity),r=Math.max(t.r,t.g,t.b);if(r>1&&(t.multiplyScalar(1/r),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),r>0&&(n.emissiveFactor=t.toArray()),e.emissiveMap){const t={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){const t={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){const t={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===i.ehD&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(t){t.writeMaterial&&t.writeMaterial(e,n)});const o=r.materials.push(n)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,r=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let i=0,x=e.material.length;i<x;i++)n.push(e.material[i].uuid);else n.push(e.material.uuid);const s=n.join(":");if(t.meshes.has(s))return t.meshes.get(s);const o=e.geometry;let a;a=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const l={},c={},u=[],p=[],h={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=o.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let f=null;for(let x in o.attributes){if("morph"===x.slice(0,5))continue;const e=o.attributes[x];if(x=h[x]||x.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(x)||(x="_"+x),t.attributes.has(this.getUID(e))){c[x]=t.attributes.get(this.getUID(e));continue}f=null;const r=e.array;"JOINTS_0"!==x||r instanceof Uint16Array||r instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new i.TlE(new Uint16Array(r),e.itemSize,e.normalized));const n=this.processAccessor(f||e,o);null!==n&&(c[x]=n,t.attributes.set(this.getUID(e),n))}if(void 0!==d&&o.setAttribute("normal",d),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const r=[],i=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let s=0;s<e.morphTargetInfluences.length;++s){const a={};let l=!1;for(const e in o.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const r=o.morphAttributes[e][s],i=e.toUpperCase(),n=o.attributes[e];if(t.attributes.has(this.getUID(r,!0))){a[i]=t.attributes.get(this.getUID(r,!0));continue}const c=r.clone();if(!o.morphTargetsRelative)for(let e=0,t=r.count;e<t;e++)c.setXYZ(e,r.getX(e)-n.getX(e),r.getY(e)-n.getY(e),r.getZ(e)-n.getZ(e));a[i]=this.processAccessor(c,o),t.attributes.set(this.getUID(n,!0),a[i])}p.push(a),r.push(e.morphTargetInfluences[s]),void 0!==e.morphTargetDictionary&&i.push(n[s])}l.weights=r,i.length>0&&(l.extras={},l.extras.targetNames=i)}const g=Array.isArray(e.material);if(g&&0===o.groups.length)return null;const m=g?e.material:[e.material],_=g?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let i=0,x=_.length;i<x;i++){const e={mode:a,attributes:c};if(this.serializeUserData(o,e),p.length>0&&(e.targets=p),null!==o.index){let r=this.getUID(o.index);void 0===_[i].start&&void 0===_[i].count||(r+=":"+_[i].start+":"+_[i].count),t.attributes.has(r)?e.indices=t.attributes.get(r):(e.indices=this.processAccessor(o.index,o,_[i].start,_[i].count),t.attributes.set(r,e.indices)),null===e.indices&&delete e.indices}const r=this.processMaterial(m[_[i].materialIndex]);null!==r&&(e.material=r),u.push(e)}l.primitives=u,r.meshes||(r.meshes=[]),this._invokeAll(function(t){t.writeMesh&&t.writeMesh(e,l)});const v=r.meshes.push(l)-1;return t.meshes.set(s,v),v}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const r=e.isOrthographicCamera,n={type:r?"orthographic":"perspective"};return r?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:i.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const r=this.json,n=this.nodeMap;r.animations||(r.animations=[]);const s=(e=Tm.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,o=[],a=[];for(let l=0;l<s.length;++l){const e=s[l],r=i.iUV.parseTrackName(e.name);let c=i.iUV.findNode(t,r.nodeName);const u=Pm[r.propertyName];if("bones"===r.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(r.objectIndex):void 0),!c||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',e.name),null;const p=1;let h,d=e.values.length/e.times.length;u===Pm.morphTargetInfluences&&(d/=c.morphTargetInfluences.length),!0===e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=e.getInterpolation()===i.Syv?"STEP":"LINEAR",a.push({input:this.processAccessor(new i.TlE(e.times,p)),output:this.processAccessor(new i.TlE(e.values,d)),interpolation:h}),o.push({sampler:a.length-1,target:{node:n.get(c),path:u}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:a,channels:o}),r.animations.length-1}processSkin(e){const t=this.json,r=this.nodeMap,n=t.nodes[r.get(e)],s=e.skeleton;if(void 0===s)return null;const o=e.skeleton.bones[0];if(void 0===o)return null;const a=[],l=new Float32Array(16*s.bones.length),c=new i.yGw;for(let i=0;i<s.bones.length;++i)a.push(r.get(s.bones[i])),c.copy(s.boneInverses[i]),c.multiply(e.bindMatrix).toArray(l,16*i);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new i.TlE(l,16)),joints:a,skeleton:r.get(o)}),n.skin=t.skins.length-1}processNode(e){const t=this.json,r=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(r.trs){const t=e.quaternion.toArray(),r=e.position.toArray(),i=e.scale.toArray();Bm(t,[0,0,0,1])||(n.rotation=t),Bm(r,[0,0,0])||(n.translation=r),Bm(i,[1,1,1])||(n.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Bm(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let i=0,n=e.children.length;i<n;i++){const n=e.children[i];if(n.visible||!1===r.onlyVisible){const e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll(function(t){t.writeNode&&t.writeNode(e,n)});const s=t.nodes.push(n)-1;return i.set(e,s),s}processScene(e){const t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);const n=[];for(let s=0,o=e.children.length;s<o;s++){const t=e.children[s];if(t.visible||!1===r.onlyVisible){const e=this.processNode(t);null!==e&&n.push(e)}}n.length>0&&(i.nodes=n),this.serializeUserData(e,i)}processObjects(e){const t=new i.xsS;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});const r=[];for(let n=0;n<e.length;n++)e[n]instanceof i.xsS?this.processScene(e[n]):r.push(e[n]);r.length>0&&this.processObjects(r);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}}class Um{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const r=this.writer,i=r.json,n=r.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,s.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},n[this.name]=!0);const o=i.extensions[this.name].lights;o.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class Nm{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class jm{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const r=this.writer,i=r.extensionsUsed,n={};t.pbrMetallicRoughness.baseColorFactor&&(n.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const s=[1,1,1];if(e.specular.toArray(s,0),n.specularFactor=s,n.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(n.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const t={index:r.processTexture(e.specularMap)};r.applyTextureTransform(t,e.specularMap),n.specularGlossinessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Gm{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:r.processTexture(e.clearcoatMap)};r.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:r.processTexture(e.clearcoatRoughnessMap)};r.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:r.processTexture(e.clearcoatNormalMap)};r.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class zm{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:r.processTexture(e.iridescenceMap)};r.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:r.processTexture(e.iridescenceThicknessMap)};r.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Vm{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:r.processTexture(e.transmissionMap)};r.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Qm{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:r.processTexture(e.thicknessMap)};r.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Hm{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const t={index:r.processTexture(e.sheenColorMap)};r.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}if(n.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const t={index:r.processTexture(e.sheenRoughnessMap)};r.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,i[this.name]=!0}}class Wm{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const r=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}}Tm.Utils={GLTFWriter:Fm,insertKeyframe:function(e,t){const r=.001,i=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+i),o=e.createInterpolant(new e.ValueBufferType(i));let a;if(0===e.times.length){n[0]=t;for(let e=0;e<i;e++)s[e]=0;a=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<r)return 0;n[0]=t,n.set(e.times,1),s.set(o.evaluate(t),0),s.set(e.values,i),a=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<r)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),s.set(e.values,0),s.set(o.evaluate(t),e.values.length),a=n.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<r)return l;if(e.times[l]<t&&e.times[l+1]>t){n.set(e.times.slice(0,l+1),0),n[l+1]=t,n.set(e.times.slice(l+1),l+2),s.set(e.values.slice(0,(l+1)*i),0),s.set(o.evaluate(t),(l+1)*i),s.set(e.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return e.times=n,e.values=s,a},mergeMorphTargetTracks:function(e,t){const r=[],n={},s=e.tracks;for(let o=0;o<s.length;++o){let e=s[o];const a=i.iUV.parseTrackName(e.name),l=i.iUV.findNode(t,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){r.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(e=e.clone()).setInterpolation(i.NMF)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(void 0===u)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let p;if(void 0===n[l.uuid]){const t=new((p=e.clone()).ValueBufferType)(c*p.times.length);for(let e=0;e<p.times.length;e++)t[e*c+u]=p.values[e];p.name=(a.nodeName||"")+".morphTargetInfluences",p.values=t,n[l.uuid]=p,r.push(p);continue}const h=e.createInterpolant(new e.ValueBufferType(1));p=n[l.uuid];for(let t=0;t<p.times.length;t++)p.values[t*c+u]=h.evaluate(p.times[t]);for(let t=0;t<e.times.length;t++){const r=this.insertKeyframe(p,e.times[t]);p.values[r*c+u]=e.values[t]}}return e.tracks=r,e}};class qm extends Tm.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new i.Wid}serializeUserData(e,t){const r=e.userData,i={};r.__disposed&&console.error("Serializing a disposed object",e),Object.entries(r).forEach(([e,t])=>{(!t||"function"==typeof t||t.isObject3D||t.isTexture||t.isMaterial||null!=t.assetType||e.startsWith("_")||"uuid"!==e&&(Ue.includes(e)||Ne.includes(e)||be.includes(e)))&&(i[e]=t,delete r[e])}),super.serializeUserData(e,t),Object.entries(i).forEach(([e,t])=>{r[e]=t,delete i[e]})}processObjects(e){var t;1===e.length&&(null===(t=e[0])||void 0===t?void 0:t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const r=super.processMaterial(t);if(!e||t===e)return r;const i=JSON.stringify(this.json.materials[r]),n=JSON.parse(i);this.serializeUserData(e,n),this._invokeAll(t=>{t.writeMaterial&&t.writeMaterial(e,n)});const s=this.json.materials.push(n)-1;return this.cache.materials.set(e,s),s}processImageBlob(e,t){if(!e)return-1;const r=this.cache,i=this.options,n=this.pending,s=this.json,o=t.image;r.images.has(o)||r.images.set(o,{});const a=r.images.get(o),l=e.type+":flipY/"+t.flipY.toString();if(void 0!==a[l])return a[l];s.images||(s.images=[]);const c={mimeType:e.type};!0===i.binary?n.push(new Promise(t=>{this.processBufferViewImage(e).then(e=>{c.bufferView=e,t()})})):n.push(bt(e).then(e=>{c.uri=e}));const u=s.images.push(c)-1;return a[l]=u,u}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,r=this.json;if(t.textures.has(e))return t.textures.get(e);const i=e.source.data,n=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const s=super.processTexture(e),o=r.textures[s];if(!o)return console.error("No texture def",s,e),s;const a=r.images?r.images[o.source]:null;if(a&&(a.extras||(a.extras={}),e.source&&(a.extras.uuid=e.source.uuid),a.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=i,e.userData.mimeType=n,!o)return console.error("textureDef is null",s,e),s;o.source>=0?console.warn("textureDef.source is already set",s,e):o.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,n)}return o.source<0&&console.error("textureDef.source cannot be saved",o,e),s}processImage(e,t,r,i="image/png"){return e?super.processImage(e,t,r,i):-1}processImageUri(e,t,r,i="image/png"){const n=this.cache,s=this.json;n.images.has(e)||n.images.set(e,{});const o=n.images.get(e),a=i+":flipY/"+r.toString();if(void 0!==o[a])return o[a];s.images||(s.images=[]);const l={mimeType:i,uri:t,extras:{flipY:r}},c=s.images.push(l)-1;return o[a]=c,c}}class Xm extends Tm{register(e){return super.register(e)}async parseAsync(e,t){var r;if(!e)throw new Error("No object to export");const i=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((r,i)=>this.parse(e,r,i,t));if(i&&"object"==typeof i&&!i.byteLength)return new Blob([JSON.stringify(i,(e,t)=>e.startsWith("__")?void 0:t,null!==(r=t.jsonSpaces)&&void 0!==r?r:2)],{type:"model/gltf+json"});if(i)return new Blob([i],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,t,r,i={}){var n;const s={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!i.embedUrlImages&&i.externalImagesInExtras||!1,embedUrlImages:null!==(n=i.embedUrlImages)&&void 0!==n&&n,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return"glb"===i.exportExt&&(s.binary=!0),!1!==i.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach(e=>e.traverse(e=>{e.uuid&&(e.userData.gltfUUID=e.uuid)})),(Array.isArray(e)?e:[e]).forEach(e=>e.traverse(e=>{if(e.animations)for(const t of e.animations)!1===t.__gltfExport||s.animations.includes(t)||s.animations.push(...e.animations)})),super.parse(e,r=>{!1!==i.preserveUUIDs&&(Array.isArray(e)?e:[e]).forEach(e=>e.traverse(e=>{delete e.userData.gltfUUID})),t(Object.assign(r,{__isGLTFOutput:!0}))},r,s,new qm)}}function Ym(e,t){const r=e.getPlugin(so).exportViewerConfig();t.json.textures&&t.json.samplers&&t.json.images&&r.resources.textures&&Object.entries(r.resources.textures).forEach(([e,i])=>{t.json.textures.find(r=>{var i,n,s,o,a;return(null===(i=r.extras)||void 0===i?void 0:i.uuid)===e||(null===(s=null===(n=t.json.samplers[r.sampler])||void 0===n?void 0:n.extras)||void 0===s?void 0:s.uuid)===e||(null===(a=null===(o=t.json.images[r.source])||void 0===o?void 0:o.extras)||void 0===a?void 0:a.t_uuid)===e})&&(i.image&&r.resources.images&&r.resources.images[i.image]&&delete r.resources.images[i.image],r.resources.textures[e]={})}),t.json.materials&&r.resources.materials&&Object.entries(r.resources.materials).forEach(([e,i])=>{t.json.materials.find(t=>{var r;return(null===(r=t.extras)||void 0===r?void 0:r.uuid)===e})&&(r.resources.materials[e]={})});const n=[];Object.values(r.resources).forEach(e=>{e&&Object.values(e).forEach(e=>{e.url&&("Uint16Array"===e.url.type&&e.url.data&&(e.url.data instanceof Uint16Array||(e.url.data=new Uint16Array(e.url.data)),n.push(e.url)),"Uint8Array"===e.url.type&&e.url.data&&(e.url.data instanceof Uint8Array||(e.url.data=new Uint8Array(e.url.data)),n.push(e.url)))})});for(const s of n){let e="application/octet-stream";if("Uint16Array"===s.type&&s.width>0&&s.height>0){const t=Km(s.data,4),r=new ImageData(t,s.width,s.height),n=i.PpQ.getDataURL(r,!0).split(",")[1];e="image/png",s.data=atob(n),s.encoding="rgbe"}const r=new Blob([s.data],{type:e});t.json.images||(t.json.images=[]);const n={mimeType:e},o=t.json.images.push(n)-1;s.data={image:o},t.pending.push(t.processBufferViewImage(r).then(e=>{n.bufferView=e}))}return r}function Km(e,t=3,r){let i,n,s,o,a;const l=e.byteLength/(2*t)|0;r=r||new Uint8ClampedArray(4*l);for(let c=0;c<l;c++){i=e[c*t],n=e[c*t+1],s=e[c*t+2],o=Math.max(Math.max(i,n),s);const l=Math.ceil(Math.log2(o));a=Math.pow(2,l-8),r[4*c]=i/a|0,r[4*c+1]=n/a|0,r[4*c+2]=s/a|0,r[4*c+3]=l+128}return r}function Jm(e,t=Xm,r){var i;if(!e)return;const n=s_.Exporters.findIndex(e=>e.ext.includes("gltf")||e.ext.includes("glb")),s=[];n>=0?(s.push(...null!==(i=s_.Exporters[n].extensions)&&void 0!==i?i:[]),s_.Exporters.splice(n,1)):(s.push(e_),s.push($m),s.push(Zm),s.push(e=>new t_(e)),s.push(e=>new r_(e)),s.push(e=>new i_(e)),s.push(e=>new n_(e))),s_.Exporters.push({ctor:()=>{const i=new t;return s.forEach(e=>i.register(e)),i.register(t=>({afterParse:r=>{var i,n;if(!(null===(i=null==(r=Array.isArray(r)?r[0]:r)?void 0:r.userData)||void 0===i?void 0:i.rootSceneModelRoot)||!1===(null===(n=null==r?void 0:r.userData)||void 0===n?void 0:n.__exportViewerConfig))return;const s=t.json.scenes[t.json.scene||0];s.extensions||(s.extensions={}),s.extensions[ci]=Ym(e,t),t.extensionsUsed[ci]=!0}})),null==r||r(i),i},ext:["gltf","glb"],extensions:s})}const Zm=e=>({writeNode:(t,r)=>{if(!(null==t?void 0:t.isLight))return;r.extensions||(r.extensions={});const i={};t.shadow&&(i.shadow=t.shadow.toJSON()),Object.keys(i).length>0&&(r.extensions[pi]=i,e.extensionsUsed[pi]=!0)}}),$m=e=>({writeNode:(t,r)=>{if(!(null==t?void 0:t.isObject3D))return;r.extensions||(r.extensions={});const i={};void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),!1===t.visible&&(i.visible=!1),!1===t.frustumCulled&&(i.frustumCulled=!1),0!==t.renderOrder&&(i.renderOrder=t.renderOrder),1!==t.layers.mask&&(i.layers=t.layers.mask),!1===t.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),Object.keys(i).length>0&&(r.extensions[hi]=i,e.extensionsUsed[hi]=!0)}}),e_=e=>({writeMaterial(t,r){var n;if(!(null==t?void 0:t.isMaterial))return;r.extensions||(r.extensions={});const s={};if(void 0!==t.emissiveIntensity&&(null===(n=t.emissive)||void 0===n?void 0:n.isColor)){const e=t.emissive.clone().multiplyScalar(t.emissiveIntensity),r=Math.max(e.r,e.g,e.b);r>1&&(s.emissiveIntensity=r)}void 0!==t.fog&&(s.fog=t.fog),void 0!==t.flatShading&&(s.flatShading=t.flatShading),void 0!==t.blending&&(s.blending=t.blending),void 0!==t.side&&t.side!==i.ehD&&(s.side=t.side),void 0!==t.shadowSide&&(s.shadowSide=t.shadowSide),void 0!==t.depthFunc&&(s.depthFunc=t.depthFunc),void 0!==t.depthTest&&(s.depthTest=t.depthTest),void 0!==t.depthWrite&&(s.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(s.colorWrite=t.colorWrite),void 0!==t.wireframe&&(s.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(s.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(s.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(s.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(s.rotation=t.rotation),void 0!==t.polygonOffset&&(s.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(s.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(s.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(s.dithering=t.dithering),void 0!==t.alphaToCoverage&&(s.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(s.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.toneMapped&&(s.toneMapped=t.toneMapped);const o=this.materialExternalResources[t.uuid];o&&Object.entries(o).forEach(([e,t])=>{e.startsWith("_")||(s[e]=ke(t,!1,this.serializedMeta))}),Object.keys(s).length>0&&(r.extensions[di]=s,e.extensionsUsed[di]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(t){if(this.materialExternalResources={},!e.options.externalImagesInExtras)return;const r=[];(Array.isArray(t)?t:[t]).forEach(e=>{null==e||e.traverse(e=>{var t;e&&(null===(t=e.material)||void 0===t?void 0:t.isMaterial)&&r.push(e.material)})}),r.forEach(e=>{e&&(this.materialExternalResources[e.uuid]||(this.materialExternalResources[e.uuid]={}),this.materialExternalResources[e.uuid].__materialRef=e,Object.entries(e).forEach(([t,r])=>{t.startsWith("_")||r&&r.isTexture&&r.userData.rootPath&&(e[t]=null,this.materialExternalResources[e.uuid][t]=r)}))})},afterParse(t){const r=Object.values(this.materialExternalResources);if(r.length<1)return;r.forEach(e=>{const t=e.__materialRef;t&&(Object.entries(e).forEach(([e,r])=>{e.startsWith("_")||r&&(t[e]=r)}),delete this.materialExternalResources[t.uuid])});const i=e.json.scenes[e.json.scene||0];i.extensions||(i.extensions={}),i.extensions[di]={resources:this.serializedMeta},e.extensionsUsed[di]=!0}});class t_{constructor(e){this.writer=e,this.name=_i}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.bumpScale)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.bumpScale=e.bumpScale,e.bumpMap){const t={index:r.processTexture(e.bumpMap)};r.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class r_{constructor(e){this.writer=e,this.name=vi}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.displacementScale)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.displacementScale=e.displacementScale,n.displacementBias=e.displacementBias,e.displacementMap){const t={index:r.processTexture(e.displacementMap)};r.applyTextureTransform(t,e.displacementMap),n.displacementTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class i_{constructor(e){this.writer=e,this.name=Ai}writeMaterial(e,t){if(!e.isMeshStandardMaterial||0===e.lightMapIntensity)return;const r=this.writer,i=r.extensionsUsed,n={};if(n.lightMapIntensity=e.lightMapIntensity,e.lightMap){const t={index:r.processTexture(e.lightMap)};r.applyTextureTransform(t,e.lightMap),n.lightMapTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class n_{constructor(e){this.writer=e,this.name=xi}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const r=this.writer,i=r.extensionsUsed,n={};if(e.alphaMap){const t={index:r.processTexture(e.alphaMap)};r.applyTextureTransform(t,e.alphaMap),n.alphaTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class s_ extends r{constructor(e,t={}){super(),this._processors=new dr,this._cachedParsers=[],Jm(e)}get processors(){return this._processors}getExporter(...e){return s_.Exporters.find(t=>t.ext.some(t=>e.includes(t)))}async exportObject(e,t={}){var r,i,n,s;if(!(null==e?void 0:e.assetType))return void console.error("Object has no asset type");(null===(i=null===(r=e)||void 0===r?void 0:r.userData)||void 0===i?void 0:i.rootSceneModelRoot)&&!1===t.viewerConfig&&(e.userData.__exportViewerConfig=!1);const o=await this._exportFile(e,t);return(null===(s=null===(n=e)||void 0===n?void 0:n.userData)||void 0===s?void 0:s.rootSceneModelRoot)&&!1===t.viewerConfig&&delete e.userData.__exportViewerConfig,o}async _exportFile(e,t={}){var r,i,n;let s;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const o=await this.processBeforeExport(e,t),a=null!==(i=null!==(r=t.exportExt)&&void 0!==r?r:null==o?void 0:o.typeExt)&&void 0!==i?i:null==o?void 0:o.ext;if(!o||!a)throw new Error(`Unable to preprocess before export ${a}`);const l=this._getParser(a);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const c=await l.parseAsync(o.obj,{exportExt:null!==(n=o.ext)&&void 0!==n?n:a,...t});c.ext=o.ext,s=c}catch(t){return console.error("AssetExporter: Unable to Export file",e),console.error(t),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:t})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),s}_createParser(e){const t=s_.Exporters.find(t=>t.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const r=null==t?void 0:t.ctor(this);if(!r)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:r}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:r}),r}_getParser(e){var t,r;return null!==(r=null===(t=this._cachedParsers.find(t=>t.ext.includes(e)))||void 0===t?void 0:t.parser)&&void 0!==r?r:this._createParser(e)}async processBeforeExport(e,t={}){switch(null!=e.assetType&&(e=await this._processors.process(e.assetType,e,t)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;null===(e=this._processors)||void 0===e||e.dispose()}}s_.Exporters=[{ctor:()=>new Cm,ext:["json"]},{ctor:()=>new Mm,ext:["txt","text"]}];class o_ extends oo{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new s_(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(e,t)=>{var r;return t.convertMeshToIndexed&&(null===(r=e.modelObject)||void 0===r||r.traverse(e=>{var t;e.geometry&&(e.geometry.attributes.index||null===(t=e.setGeometry)||void 0===t||t.call(e,Y(e.geometry)))})),e}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,r;return null===(t=this.exporter)||void 0===t?void 0:t.exportObject(null===(r=this._viewer)||void 0===r?void 0:r.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",e=>{var t;"function"==typeof(null===(t=e.plugin)||void 0===t?void 0:t.toJSON)&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([e,t])=>"function"==typeof(null==t?void 0:t.toJSON)).map(([e,t])=>({label:e,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const e=await this.exportScene(this.exportOptions);e&&At(e,this.exportOptions.name+"."+e.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(e=>{var t;e.value=!1,null===(t=e.uiRefresh)||void 0===t||t.call(e)})}},{type:"button",label:"Select all",value:()=>{t.forEach(e=>{var t;e.value=!0,null===(t=e.uiRefresh)||void 0===t||t.call(e)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const r=new Blob([JSON.stringify(e.getPlugin(so).exportPluginPresets(t.filter(e=>!!e.value).map(e=>x(e.label)||"")),null,2)],{type:"application/json"});r&&At(r,this.exportOptions.name+"."+so.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const t=new Blob([JSON.stringify(e.getPlugin(so).exportViewerConfig(!1),null,2)],{type:"application/json"});t&&At(t,this.exportOptions.name+"."+so.ViewerTypeSlug)}}]}]}}}o_.PluginType="AssetExporterPlugin";class a_{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class l_ extends a_{constructor(e,t,r,i={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=i,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class c_ extends a_{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(e=>e.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(e=>e.getChild())}disconnectParents(e,t){let r=this.listParentEdges(e);return t&&(r=r.filter(e=>t(e.getParent()))),r.forEach(e=>e.dispose()),this}createEdge(e,t,r,i){return this._registerEdge(new l_(e,t,r,i))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const r=e.getChild();return this._childEdges.has(r)||this._childEdges.set(r,new Set),this._childEdges.get(r).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function u_(){return(u_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function p_(e){return e instanceof l_}function h_(e){return Array.isArray(e)&&e[0]instanceof l_}function d_(e){return!!(e&&"object"==typeof e&&Object.values(e)[0]instanceof l_)}const f_=Symbol("attributes"),g_=Symbol("immutableKeys");class m_ extends a_{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[f_]=void 0,this[g_]=void 0,this.graph=e,this[g_]=new Set,this[f_]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const i=e[r];if(i instanceof m_){const e=this.graph.createEdge(r,this,i);e.addEventListener("dispose",()=>i.dispose()),this[g_].add(r),t[r]=e}else t[r]=i}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[f_]){const i=this[f_][r];if(p_(i)){const n=i;n.getChild()===e&&this.setRef(r,t,n.getAttributes())}else if(h_(i)){const n=i.find(t=>t.getChild()===e);if(n){const i=n.getAttributes();this.removeRef(r,e).addRef(r,t,i)}}else if(d_(i)){const n=i;for(const i in n){const s=n[i];s.getChild()===e&&this.setRefMap(r,i,t,s.getAttributes())}}}return this}get(e){return this[f_][e]}set(e,t){return this[f_][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[f_][e];return t?t.getChild():null}setRef(e,t,r){if(this[g_].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const i=this[f_][e];if(i&&i.dispose(),!t)return this;const n=this.graph.createEdge(e,this,t,r);return n.addEventListener("dispose",()=>{delete this[f_][e],this.dispatchEvent({type:"change",attribute:e})}),this[f_][e]=n,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[f_][e].map(e=>e.getChild())}addRef(e,t,r){const i=this.graph.createEdge(e,this,t,r),n=this[f_][e];return n.push(i),i.addEventListener("dispose",()=>{const t=n.filter(e=>e!==i);n.length=0;for(const e of t)n.push(e);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[f_][e].filter(e=>e.getChild()===t).forEach(e=>e.dispose()),this}listRefMapKeys(e){return Object.keys(this[f_][e])}listRefMapValues(e){return Object.values(this[f_][e]).map(e=>e.getChild())}getRefMap(e,t){const r=this[f_][e];return r[t]?r[t].getChild():null}setRefMap(e,t,r,i){const n=this[f_][e],s=n[t];if(s&&s.dispose(),!r)return this;i=Object.assign(i||{},{key:t});const o=this.graph.createEdge(e,this,r,u_({},i,{key:t}));return o.addEventListener("dispose",()=>{delete n[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),n[t]=o,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(u_({},e,{target:this})),this.graph.dispatchEvent(u_({},e,{target:this,type:`node:${e.type}`})),this}}var __,v_,x_,A_,b_,y_,w_="undefined"!=typeof Float32Array?Float32Array:Array;function E_(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function S_(e,t,r){var i=t[0],n=t[1],s=t[2],o=r[3]*i+r[7]*n+r[11]*s+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/o,e}function C_(e,t,r){var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=t[8],h=t[9],d=t[10],f=t[11],g=t[12],m=t[13],_=t[14],v=t[15],x=r[0],A=r[1],b=r[2],y=r[3];return e[0]=x*i+A*a+b*p+y*g,e[1]=x*n+A*l+b*h+y*m,e[2]=x*s+A*c+b*d+y*_,e[3]=x*o+A*u+b*f+y*v,x=r[4],A=r[5],b=r[6],y=r[7],e[4]=x*i+A*a+b*p+y*g,e[5]=x*n+A*l+b*h+y*m,e[6]=x*s+A*c+b*d+y*_,e[7]=x*o+A*u+b*f+y*v,x=r[8],A=r[9],b=r[10],y=r[11],e[8]=x*i+A*a+b*p+y*g,e[9]=x*n+A*l+b*h+y*m,e[10]=x*s+A*c+b*d+y*_,e[11]=x*o+A*u+b*f+y*v,x=r[12],A=r[13],b=r[14],y=r[15],e[12]=x*i+A*a+b*p+y*g,e[13]=x*n+A*l+b*h+y*m,e[14]=x*s+A*c+b*d+y*_,e[15]=x*o+A*u+b*f+y*v,e}function M_(e,t){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const i of e.listPrimitives()){const e=i.getAttribute("POSITION");if(!e)continue;let n=[0,0,0],s=[0,0,0];for(let i=0;i<e.getCount();i++)T_(s=S_(s,n=e.getElement(i,n),t),r)}return r}function T_(e,t){for(let r=0;r<3;r++)t.min[r]=Math.min(e[r],t.min[r]),t.max[r]=Math.max(e[r],t.max[r])}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),__=new w_(3),w_!=Float32Array&&(__[0]=0,__[1]=0,__[2]=0),function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(v_||(v_={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(x_||(x_={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER"}(A_||(A_={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(b_||(b_={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(y_||(y_={}));class I_{static createBufferFromDataURI(e){if(void 0===Buffer){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return Buffer.from(t,r?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const n of e)t+=n.byteLength;const r=new Uint8Array(t);let i=0;for(const n of e)r.set(n,i),i+=n.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const i=new Uint8Array(r);if(i.set(e),0!==t)for(let n=e.byteLength;n<r;n++)i[n]=t;return i}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class k_{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,i,n]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*i<<8^255*n<<0}static convertSRGBToLinear(e,t){const r=e,i=t;for(let n=0;n<3;n++)i[n]=r[n]<.04045?.0773993808*r[n]:Math.pow(.9478672986*r[n]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,i=t;for(let n=0;n<3;n++)i[n]=r[n]<.0031308?12.92*r[n]:1.055*Math.pow(r[n],.41666)-.055;return t}}class D_{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return I_.decodeText(e.slice(12,16))===D_.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}D_.PNG_FRIED_CHUNK_NAME="CgBI";class P_{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let r=0;const i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)r+=i[0]*i[1]*4,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return r+=4}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":`image/${e}`}}function B_(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}P_.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,r,i=new DataView(e.buffer,e.byteOffset+4);for(;i.byteLength;){if(t=i.getUint16(0,!1),B_(i,t),192===(r=i.getUint8(t+1))||193===r||194===r)return[i.getUint16(t+7,!1),i.getUint16(t+5,!1)];i=new DataView(e.buffer,i.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new D_};class R_{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return P_.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function L_(e){return"[object Object]"===Object.prototype.toString.call(e)}function O_(e){if(!1===L_(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==L_(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}class F_{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=F_.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=F_.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=F_.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=F_.Verbosity.ERROR&&console.error(e)}}F_.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},F_.DEFAULT_INSTANCE=new F_(F_.Verbosity.INFO);class U_{static identity(e){return e}static eq(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-t[r])>1e-5)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,r,i){let n=E_([e[0],e[1],e[2]]);const s=E_([e[4],e[5],e[6]]),o=E_([e[8],e[9],e[10]]);(function(e){var t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],p=e[10],h=e[11],d=e[12],f=e[13],g=e[14],m=e[15];return(t*o-r*s)*(p*m-h*g)-(t*a-i*s)*(u*m-h*f)+(t*l-n*s)*(u*g-p*f)+(r*a-i*o)*(c*m-h*d)-(r*l-n*o)*(c*g-p*d)+(i*l-n*a)*(c*f-u*d)})(e)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];const a=e.slice(),l=1/n,c=1/s,u=1/o;a[0]*=l,a[1]*=l,a[2]*=l,a[4]*=c,a[5]*=c,a[6]*=c,a[8]*=u,a[9]*=u,a[10]*=u,function(e,t){var r=new w_(3);!function(e,t){var r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(s,o,a),e[2]=Math.hypot(l,c,u)}(r,t);var i=1/r[0],n=1/r[1],s=1/r[2],o=t[0]*i,a=t[1]*n,l=t[2]*s,c=t[4]*i,u=t[5]*n,p=t[6]*s,h=t[8]*i,d=t[9]*n,f=t[10]*s,g=o+u+f,m=0;g>0?(m=2*Math.sqrt(g+1),e[3]=.25*m,e[0]=(p-d)/m,e[1]=(h-l)/m,e[2]=(a-c)/m):o>u&&o>f?(m=2*Math.sqrt(1+o-u-f),e[3]=(p-d)/m,e[0]=.25*m,e[1]=(a+c)/m,e[2]=(h+l)/m):u>f?(m=2*Math.sqrt(1+u-o-f),e[3]=(h-l)/m,e[0]=(a+c)/m,e[1]=.25*m,e[2]=(p+d)/m):(m=2*Math.sqrt(1+f-o-u),e[3]=(a-c)/m,e[0]=(h+l)/m,e[1]=(p+d)/m,e[2]=.25*m)}(r,a),i[0]=n,i[1]=s,i[2]=o}static compose(e,t,r,i){const n=i,s=t[0],o=t[1],a=t[2],l=t[3],c=s+s,u=o+o,p=a+a,h=s*c,d=s*u,f=s*p,g=o*u,m=o*p,_=a*p,v=l*c,x=l*u,A=l*p,b=r[0],y=r[1],w=r[2];return n[0]=(1-(g+_))*b,n[1]=(d+A)*b,n[2]=(f-x)*b,n[3]=0,n[4]=(d-A)*y,n[5]=(1-(h+_))*y,n[6]=(m+v)*y,n[7]=0,n[8]=(f+x)*w,n[9]=(m-v)*w,n[10]=(1-(h+g))*w,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}}function N_(e,t){if(!!e!=!!t)return!1;const r=e.getChild(),i=t.getChild();return r===i||r.equals(i)}function j_(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const i=e[r],n=t[r];if(i.getChild()!==n.getChild()&&!i.getChild().equals(n.getChild()))return!1}return!0}function G_(e,t){if(!!e!=!!t)return!1;const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const n in e){const r=e[n],i=t[n];if(!!r!=!!i)return!1;const s=r.getChild(),o=i.getChild();if(s!==o&&!s.equals(o))return!1}return!0}function z_(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function V_(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!O_(e)||!O_(t))return e===t;const r=e,i=t;let n,s=0,o=0;for(n in r)s++;for(n in i)o++;if(s!==o)return!1;for(n in r){const e=r[n],t=i[n];if(Q_(e)&&Q_(t)){if(!z_(e,t))return!1}else if(O_(e)&&O_(t)){if(!V_(e,t))return!1}else if(e!==t)return!1}return!0}function Q_(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const H_="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",W_=new Set,q_=function(){let e="";for(let t=0;t<6;t++)e+=H_.charAt(Math.floor(Math.random()*H_.length));return e};class X_{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static basename(e){return R_.basename(new URL(e,"https://null.example").pathname)}static extension(e){return R_.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),i=t.split("/");r.pop();for(let n=0;n<i.length;n++)"."!==i[n]&&(".."===i[n]?r.pop():r.push(i[n]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}X_.DEFAULT_INIT={},X_.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Y_=e=>e,K_=new Set;class J_ extends m_{constructor(e,t=""){super(e),this[f_].name=t,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,Y_)}copy(e,t=Y_){for(const r in this[f_]){const e=this[f_][r];if(e instanceof l_)this[g_].has(r)||e.dispose();else if(Array.isArray(e)&&e[0]instanceof l_)for(const t of e)t.dispose();else if(O_(e)&&Object.values(e)[0]instanceof l_)for(const t in e)e[t].dispose()}for(const r in e[f_]){const i=this[f_][r],n=e[f_][r];if(n instanceof l_)this[g_].has(r)?i.getChild().copy(t(n.getChild()),t):this.setRef(r,t(n.getChild()),n.getAttributes());else if(Array.isArray(n)&&n[0]instanceof l_)for(const e of n)this.addRef(r,t(e.getChild()),e.getAttributes());else if(O_(n)&&Object.values(n)[0]instanceof l_)for(const e in n){const i=n[e];this.setRefMap(r,e,t(i.getChild()),i.getAttributes())}else this[f_][r]=O_(n)?JSON.parse(JSON.stringify(n)):Array.isArray(n)||n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.slice():n}return this}equals(e,t=K_){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const r in this[f_]){if(t.has(r))continue;const i=this[f_][r],n=e[f_][r];if(p_(i)||p_(n)){if(!N_(i,n))return!1}else if(h_(i)||h_(n)){if(!j_(i,n))return!1}else if(d_(i)||d_(n)){if(!G_(i,n))return!1}else if(O_(i)||O_(n)){if(!V_(i,n))return!1}else if(Q_(i)||Q_(n)){if(!z_(i,n))return!1}else if(i!==n)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>"Root"!==e.propertyType),this}listParents(){return this.graph.listParents(this)}}class Z_ extends J_{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class $_ extends Z_{constructor(...e){super(...e),this.i=U_.identity,this.o=U_.identity}init(){this.propertyType=v_.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:$_.Type.SCALAR,componentType:$_.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,t=Y_){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case $_.Type.SCALAR:return 1;case $_.Type.VEC2:return 2;case $_.Type.VEC3:return 3;case $_.Type.VEC4:case $_.Type.MAT2:return 4;case $_.Type.MAT3:return 9;case $_.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case $_.ComponentType.BYTE:case $_.ComponentType.UNSIGNED_BYTE:return 1;case $_.ComponentType.SHORT:case $_.ComponentType.UNSIGNED_SHORT:return 2;case $_.ComponentType.UNSIGNED_INT:case $_.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMin(e){const t=this.get("array"),r=this.getCount(),i=this.getElementSize();for(let n=0;n<i;n++)e[n]=1/0;for(let n=0;n<r*i;n+=i)for(let r=0;r<i;r++){const i=t[n+r];Number.isFinite(i)&&(e[r]=Math.min(e[r],i))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMax(e){const t=this.get("array"),r=this.getCount(),i=this.getElementSize();for(let n=0;n<i;n++)e[n]=-1/0;for(let n=0;n<r*i;n+=i)for(let r=0;r<i;r++){const i=t[n+r];Number.isFinite(i)&&(e[r]=Math.max(e[r],i))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return $_.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=(e=>U_.denormalize(e,this.get("componentType"))),this.i=(e=>U_.normalize(e,this.get("componentType")))):(this.o=U_.identity,this.i=U_.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const r=this.getElementSize(),i=this.get("array");for(let n=0;n<r;n++)t[n]=this.o(i[e*r+n]);return t}setElement(e,t){const r=this.getElementSize(),i=this.get("array");for(let n=0;n<r;n++)i[e*r+n]=this.i(t[n]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return $_.ComponentType.FLOAT;case Uint32Array:return $_.ComponentType.UNSIGNED_INT;case Uint16Array:return $_.ComponentType.UNSIGNED_SHORT;case Uint8Array:return $_.ComponentType.UNSIGNED_BYTE;case Int16Array:return $_.ComponentType.SHORT;case Int8Array:return $_.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):$_.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}$_.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},$_.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class ev extends Z_{init(){this.propertyType=v_.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class tv extends Z_{init(){this.propertyType=v_.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}tv.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class rv extends Z_{init(){this.propertyType=v_.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:rv.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:A_.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:A_.OTHER})}}rv.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class iv extends Z_{init(){this.propertyType=v_.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class nv extends Z_{init(){this.propertyType=v_.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:nv.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}nv.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class sv extends J_{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}sv.EXTENSION_NAME=void 0;class ov extends Z_{init(){this.propertyType=v_.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:ov.WrapMode.REPEAT,wrapT:ov.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}ov.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ov.MagFilter={NEAREST:9728,LINEAR:9729},ov.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:av,G:lv,B:cv,A:uv}=b_;class pv extends Z_{init(){this.propertyType=v_.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:pv.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new ov(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new ov(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new ov(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new ov(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new ov(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return k_.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",k_.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:av|lv|cv|uv})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return k_.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",k_.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:av|lv|cv})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:av|lv|cv})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:av})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:lv|cv})}}pv.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class hv extends Z_{init(){this.propertyType=v_.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class dv extends Z_{constructor(...e){super(...e),this.u=null}init(){this.propertyType=v_.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=Y_){if(t===Y_)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return U_.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),i=this.get("scale").slice();return U_.decompose(e,t,r,i),this.set("translation",t).set("rotation",r).set("scale",i)}getWorldTranslation(){const e=[0,0,0];return U_.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return U_.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return U_.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let i=this;i instanceof dv;i=i.u)e.push(i);let t;const r=e.pop().getMatrix();for(;t=e.pop();)C_(r,r,t.getMatrix());return r}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[f_].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class fv extends Z_{init(){this.propertyType=v_.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:fv.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:A_.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:A_.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}fv.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class gv extends J_{init(){this.propertyType=v_.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:A_.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function mv(){return(mv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}class _v extends Z_{init(){this.propertyType=v_.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=Y_){if(t===Y_)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[f_].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class vv extends Z_{init(){this.propertyType=v_.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:A_.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class xv extends Z_{init(){this.propertyType=v_.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||P_.extensionToMimeType(R_.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",P_.extensionToMimeType(R_.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",I_.assertView(e))}getSize(){const e=this.get("image");return e?P_.getSize(e,this.getMimeType()):null}}class Av extends Z_{init(){this.propertyType=v_.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",e=>{this.l(e.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Y_){if(t===Y_)throw new Error("Root cannot be copied.");this.set("asset",mv({},e.get("asset"))),this.setName(e.getName()),this.setExtras(mv({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const i=e.getExtension(r);this.setExtension(r,t(i))}return this}l(e){return e instanceof _v?this.addRef("scenes",e):e instanceof dv?this.addRef("nodes",e):e instanceof nv?this.addRef("cameras",e):e instanceof vv?this.addRef("skins",e):e instanceof hv?this.addRef("meshes",e):e instanceof pv?this.addRef("materials",e):e instanceof xv?this.addRef("textures",e):e instanceof ev?this.addRef("animations",e):e instanceof $_?this.addRef("accessors",e):e instanceof iv&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class bv{constructor(){this.m=new c_,this.T=new Av(this.m),this.v=F_.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return(new bv).setLogger(this.v).merge(this)}merge(e){for(const n of e.getRoot().listExtensionsUsed()){const e=this.createExtension(n.constructor);n.isRequired()&&e.setRequired(!0)}const t=new Set,r=new Map;t.add(e.T),r.set(e.T,this.T);for(const n of e.m.listEdges())for(const e of[n.getParent(),n.getChild()]){if(t.has(e))continue;let i;i=e.propertyType===v_.TEXTURE_INFO?e:new(0,e.constructor)(this.m),r.set(e,i),t.add(e)}const i=e=>{const t=r.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const n of t){const e=r.get(n);if(!e)throw new Error("Could resolve property.");e.propertyType!==v_.TEXTURE_INFO&&e.copy(n,i)}return this}async transform(...e){const t=e.map(e=>e.name);for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(e=>e.extensionName===t)||new e(this)}createScene(e=""){return new _v(this.m,e)}createNode(e=""){return new dv(this.m,e)}createCamera(e=""){return new nv(this.m,e)}createSkin(e=""){return new vv(this.m,e)}createMesh(e=""){return new hv(this.m,e)}createPrimitive(){return new fv(this.m)}createPrimitiveTarget(e=""){return new gv(this.m,e)}createMaterial(e=""){return new pv(this.m,e)}createTexture(e=""){return new xv(this.m,e)}createAnimation(e=""){return new ev(this.m,e)}createAnimationChannel(e=""){return new tv(this.m,e)}createAnimationSampler(e=""){return new rv(this.m,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new $_(this.m,e).setBuffer(t)}createBuffer(e=""){return new iv(this.m,e)}}class yv{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=(e=>{const t=e,r=t.target;r instanceof sv&&r.extensionName===this.extensionName&&("node:create"===t.type&&this.M(r),"node:dispose"===t.type&&this.I(r))});const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}yv.EXTENSION_NAME=void 0;class wv{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord);const r=this.jsonDoc.json.textures[t.index];if(void 0===r.sampler)return;const i=this.jsonDoc.json.samplers[r.sampler];void 0!==i.magFilter&&e.setMagFilter(i.magFilter),void 0!==i.minFilter&&e.setMinFilter(i.minFilter),void 0!==i.wrapS&&e.setWrapS(i.wrapS),void 0!==i.wrapT&&e.setWrapT(i.wrapT)}}const Ev={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Sv={logger:F_.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function Cv(e,t){const r=t.bufferViews[e.bufferView],i=t.jsonDoc.json.bufferViews[e.bufferView],n=Ev[e.componentType],s=$_.getElementSize(e.type),o=n.BYTES_PER_ELEMENT;if(void 0!==i.byteStride&&i.byteStride!==s*o)return function(e,t){const r=t.bufferViews[e.bufferView],i=t.jsonDoc.json.bufferViews[e.bufferView],n=Ev[e.componentType],s=$_.getElementSize(e.type),o=n.BYTES_PER_ELEMENT,a=e.byteOffset||0,l=new n(e.count*s),c=new DataView(r.buffer,r.byteOffset,r.byteLength),u=i.byteStride;for(let p=0;p<e.count;p++)for(let t=0;t<s;t++){const r=a+p*u+t*o;let i;switch(e.componentType){case $_.ComponentType.FLOAT:i=c.getFloat32(r,!0);break;case $_.ComponentType.UNSIGNED_INT:i=c.getUint32(r,!0);break;case $_.ComponentType.UNSIGNED_SHORT:i=c.getUint16(r,!0);break;case $_.ComponentType.UNSIGNED_BYTE:i=c.getUint8(r);break;case $_.ComponentType.SHORT:i=c.getInt16(r,!0);break;case $_.ComponentType.BYTE:i=c.getInt8(r);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}l[p*s+t]=i}return l}(e,t);const a=r.byteOffset+(e.byteOffset||0);return new n(r.buffer.slice(a,a+e.count*s*o))}var Mv;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Mv||(Mv={}));class Tv{constructor(e,t,r){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=t,this.options=r;const i=e.getRoot(),n=i.listBuffers().length,s=i.listTextures().length;this.bufferURIGenerator=new Iv(n>1,r.basename),this.imageURIGenerator=new Iv(s>1,r.basename),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},i=JSON.stringify(r);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const n={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(i)},s=JSON.stringify(n);this.textureDefIndexMap.has(s)||(this.textureDefIndexMap.set(s,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(n));const o={index:this.textureDefIndexMap.get(s)};return 0!==t.getTexCoord()&&(o.texCoord=t.getTexCoord()),this.textureInfoDefMap.set(t,o),o}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName())&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===y_.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const i=P_.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,i),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.O.get(e);if(t)return t;for(const r of this.N.getGraph().listParentEdges(e)){const{usage:e}=r.getAttributes();if(e)return e;r.getParent().propertyType!==v_.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${r.getName()}".`)}return Tv.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,t){const r=this.O.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this.O.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,r]of Array.from(this.O.entries()))e[r]=e[r]||[],e[r].push(t);return e}}Tv.BufferViewTarget=Mv,Tv.BufferViewUsage=A_,Tv.USAGE_TO_TARGET={[A_.ARRAY_BUFFER]:Mv.ARRAY_BUFFER,[A_.ELEMENT_ARRAY_BUFFER]:Mv.ELEMENT_ARRAY_BUFFER};class Iv{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=t}createURI(e,t){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${t}`:`${this.basename}.${t}`}}const{BufferViewUsage:kv}=Tv;var Dv;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(Dv||(Dv={}));class Pv extends class{constructor(){this.v=F_.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=x_.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===y_.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(e,t=Sv){const r=mv({},Sv,t),{json:i}=e,n=new bv;this.validate(e,r);const s=new wv(e),o=i.asset,a=n.getRoot().getAsset();o.copyright&&(a.copyright=o.copyright),o.extras&&(a.extras=o.extras),void 0!==i.extras&&n.getRoot().setExtras(mv({},i.extras));const l=i.extensionsUsed||[],c=i.extensionsRequired||[];for(const m of r.extensions)if(l.includes(m.EXTENSION_NAME)){const e=n.createExtension(m).setRequired(c.includes(m.EXTENSION_NAME));for(const t of e.readDependencies)e.install(t,r.dependencies[t])}const u=i.buffers||[];n.getRoot().listExtensionsUsed().filter(e=>e.prereadTypes.includes(v_.BUFFER)).forEach(e=>e.preread(s,v_.BUFFER)),s.buffers=u.map(e=>{const t=n.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t}),s.bufferViewBuffers=(i.bufferViews||[]).map((t,r)=>{if(!s.bufferViews[r]){const i=e.json.buffers[t.buffer];s.bufferViews[r]=I_.toView(i.uri?e.resources[i.uri]:e.resources["@glb.bin"],t.byteOffset||0,t.byteLength)}return s.buffers[t.buffer]}),s.accessors=(i.accessors||[]).map(e=>{const t=n.createAccessor(e.name,s.bufferViewBuffers[e.bufferView]).setType(e.type);if(e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView&&!e.sparse)return t;let r;return r=void 0!==e.sparse?function(e,t){const r=Ev[e.componentType],i=$_.getElementSize(e.type);let n;n=void 0!==e.bufferView?Cv(e,t):new r(e.count*i);const s=e.sparse,o=s.count,a=mv({},e,s.indices,{count:o,type:"SCALAR"}),l=mv({},e,s.values,{count:o}),c=Cv(a,t),u=Cv(l,t);for(let p=0;p<a.count;p++)for(let e=0;e<i;e++)n[c[p]*i+e]=u[p*i+e];return n}(e,s):Cv(e,s),t.setArray(r),t});const p=i.images||[],h=i.textures||[];n.getRoot().listExtensionsUsed().filter(e=>e.prereadTypes.includes(v_.TEXTURE)).forEach(e=>e.preread(s,v_.TEXTURE)),s.textures=p.map(t=>{const r=n.createTexture(t.name);if(t.extras&&r.setExtras(t.extras),void 0!==t.bufferView){const n=i.bufferViews[t.bufferView],s=e.json.buffers[n.buffer],o=n.byteOffset||0,a=(s.uri?e.resources[s.uri]:e.resources["@glb.bin"]).slice(o,o+n.byteLength);r.setImage(a)}else void 0!==t.uri&&(r.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&r.setURI(t.uri));if(void 0!==t.mimeType)r.setMimeType(t.mimeType);else if(t.uri){const e=R_.extension(t.uri);r.setMimeType(P_.extensionToMimeType(e))}return r}),s.materials=(i.materials||[]).map(e=>{const t=n.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const r=e.pbrMetallicRoughness||{};if(void 0!==r.baseColorFactor&&t.setBaseColorFactor(r.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==r.metallicFactor&&t.setMetallicFactor(r.metallicFactor),void 0!==r.roughnessFactor&&t.setRoughnessFactor(r.roughnessFactor),void 0!==r.baseColorTexture){const e=r.baseColorTexture;t.setBaseColorTexture(s.textures[h[e.index].source]),s.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const r=e.emissiveTexture;t.setEmissiveTexture(s.textures[h[r.index].source]),s.setTextureInfo(t.getEmissiveTextureInfo(),r)}if(void 0!==e.normalTexture){const r=e.normalTexture;t.setNormalTexture(s.textures[h[r.index].source]),s.setTextureInfo(t.getNormalTextureInfo(),r),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const r=e.occlusionTexture;t.setOcclusionTexture(s.textures[h[r.index].source]),s.setTextureInfo(t.getOcclusionTextureInfo(),r),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==r.metallicRoughnessTexture){const e=r.metallicRoughnessTexture;t.setMetallicRoughnessTexture(s.textures[h[e.index].source]),s.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t});const d=i.meshes||[];n.getRoot().listExtensionsUsed().filter(e=>e.prereadTypes.includes(v_.PRIMITIVE)).forEach(e=>e.preread(s,v_.PRIMITIVE)),s.meshes=d.map(e=>{const t=n.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach(r=>{const i=n.createPrimitive();r.extras&&i.setExtras(r.extras),void 0!==r.material&&i.setMaterial(s.materials[r.material]),void 0!==r.mode&&i.setMode(r.mode);for(const[e,t]of Object.entries(r.attributes||{}))i.setAttribute(e,s.accessors[t]);void 0!==r.indices&&i.setIndices(s.accessors[r.indices]);const o=e.extras&&e.extras.targetNames||[];(r.targets||[]).forEach((e,t)=>{const r=o[t]||t.toString(),a=n.createPrimitiveTarget(r);for(const[i,n]of Object.entries(e))a.setAttribute(i,s.accessors[n]);i.addTarget(a)}),t.addPrimitive(i)}),t}),s.cameras=(i.cameras||[]).map(e=>{const t=n.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===nv.Type.PERSPECTIVE){const r=e.perspective;t.setYFov(r.yfov),t.setZNear(r.znear),void 0!==r.zfar&&t.setZFar(r.zfar),void 0!==r.aspectRatio&&t.setAspectRatio(r.aspectRatio)}else{const r=e.orthographic;t.setZNear(r.znear).setZFar(r.zfar).setXMag(r.xmag).setYMag(r.ymag)}return t});const f=i.nodes||[];n.getRoot().listExtensionsUsed().filter(e=>e.prereadTypes.includes(v_.NODE)).forEach(e=>e.preread(s,v_.NODE)),s.nodes=f.map(e=>{const t=n.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const r=[0,0,0],i=[0,0,0,1],n=[1,1,1];U_.decompose(e.matrix,r,i,n),t.setTranslation(r),t.setRotation(i),t.setScale(n)}return void 0!==e.weights&&t.setWeights(e.weights),t}),s.skins=(i.skins||[]).map(e=>{const t=n.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(s.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(s.nodes[e.skeleton]);for(const r of e.joints)t.addJoint(s.nodes[r]);return t}),f.map((e,t)=>{const r=s.nodes[t];(e.children||[]).forEach(e=>r.addChild(s.nodes[e])),void 0!==e.mesh&&r.setMesh(s.meshes[e.mesh]),void 0!==e.camera&&r.setCamera(s.cameras[e.camera]),void 0!==e.skin&&r.setSkin(s.skins[e.skin])}),s.animations=(i.animations||[]).map(e=>{const t=n.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const r=(e.samplers||[]).map(e=>{const r=n.createAnimationSampler().setInput(s.accessors[e.input]).setOutput(s.accessors[e.output]).setInterpolation(e.interpolation||rv.Interpolation.LINEAR);return e.extras&&r.setExtras(e.extras),t.addSampler(r),r});return(e.channels||[]).forEach(e=>{const i=n.createAnimationChannel().setSampler(r[e.sampler]).setTargetPath(e.target.path);void 0!==e.target.node&&i.setTargetNode(s.nodes[e.target.node]),e.extras&&i.setExtras(e.extras),t.addChannel(i)}),t});const g=i.scenes||[];return n.getRoot().listExtensionsUsed().filter(e=>e.prereadTypes.includes(v_.SCENE)).forEach(e=>e.preread(s,v_.SCENE)),s.scenes=g.map(e=>{const t=n.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map(e=>s.nodes[e]).forEach(e=>t.addChild(e)),t}),void 0!==i.scene&&n.getRoot().setDefaultScene(s.scenes[i.scene]),n.getRoot().listExtensionsUsed().forEach(e=>e.read(s)),n}static validate(e,t){const r=e.json;if("2.0"!==r.asset.version)throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired)for(const i of r.extensionsRequired)if(!t.extensions.find(e=>e.EXTENSION_NAME===i))throw new Error(`Missing required extension, "${i}".`);if(r.extensionsUsed)for(const i of r.extensionsUsed)t.extensions.find(e=>e.EXTENSION_NAME===i)||t.logger.warn(`Missing optional extension, "${i}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const t=this._(I_.assertView(e));this.L(t);const r=t.json;if(r.buffers&&r.buffers.some(e=>(function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)})(t,e)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some(e=>(function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView})(t,e)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(I_.assertView(e)))}async writeJSON(e,t={}){if(t.format===y_.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return class{static write(e,t){const r=e.getRoot(),i={asset:mv({generator:"glTF-Transform v2.2.3"},r.getAsset()),extras:mv({},r.getExtras())},n={json:i,resources:{}},s=new Tv(e,n,t),o=t.logger||F_.DEFAULT_INSTANCE,a=new Set(t.extensions.map(e=>e.EXTENSION_NAME)),l=e.getRoot().listExtensionsUsed().filter(e=>a.has(e.extensionName)),c=e.getRoot().listExtensionsRequired().filter(e=>a.has(e.extensionName));l.length<e.getRoot().listExtensionsUsed().length&&o.debug("Some extensions were not registered for I/O, and will not be written.");for(const f of l)for(const e of f.writeDependencies)f.install(e,t.dependencies[e]);function u(e,t,r,n){const o=[];let a=0;for(const c of e){const e=s.createAccessorDef(c);e.bufferView=i.bufferViews.length;const t=c.getArray(),r=I_.pad(I_.toView(t));e.byteOffset=a,a+=r.byteLength,o.push(r),s.accessorIndexMap.set(c,i.accessors.length),i.accessors.push(e)}const l={buffer:t,byteOffset:r,byteLength:I_.concat(o).byteLength};return n&&(l.target=n),i.bufferViews.push(l),{buffers:o,byteLength:a}}function p(e,t,r){const n=e[0].getCount();let o=0;for(const u of e){const e=s.createAccessorDef(u);e.bufferView=i.bufferViews.length,e.byteOffset=o;const t=u.getElementSize(),r=u.getComponentSize();o+=I_.padNumber(t*r),s.accessorIndexMap.set(u,i.accessors.length),i.accessors.push(e)}const a=n*o,l=new ArrayBuffer(a),c=new DataView(l);for(let i=0;i<n;i++){let t=0;for(const r of e){const e=r.getElementSize(),n=r.getComponentSize(),s=r.getComponentType(),a=r.getArray();for(let r=0;r<e;r++){const l=i*o+t+r*n,u=a[i*e+r];switch(s){case $_.ComponentType.FLOAT:c.setFloat32(l,u,!0);break;case $_.ComponentType.BYTE:c.setInt8(l,u);break;case $_.ComponentType.SHORT:c.setInt16(l,u,!0);break;case $_.ComponentType.UNSIGNED_BYTE:c.setUint8(l,u);break;case $_.ComponentType.UNSIGNED_SHORT:c.setUint16(l,u,!0);break;case $_.ComponentType.UNSIGNED_INT:c.setUint32(l,u,!0);break;default:throw new Error("Unexpected component type: "+s)}}t+=I_.padNumber(e*n)}}return i.bufferViews.push({buffer:t,byteOffset:r,byteLength:a,byteStride:o,target:Tv.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(l)]}}const h=new Map;for(const f of e.getGraph().listEdges()){if(f.getParent()===r)continue;const e=f.getChild();if(e instanceof $_){const t=h.get(e)||[];t.push(f),h.set(e,t)}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=r.listTextures().map((e,t)=>{const r=s.createPropertyDef(e);e.getMimeType()&&(r.mimeType=e.getMimeType());const i=e.getImage();return i&&s.createImageData(r,i,e),s.imageIndexMap.set(e,t),r}),l.filter(e=>e.prewriteTypes.includes(v_.ACCESSOR)).forEach(e=>e.prewrite(s,v_.ACCESSOR)),r.listAccessors().forEach(e=>{const t=s.accessorUsageGroupedByParent,r=s.accessorParents;if(s.accessorIndexMap.has(e))return;const i=h.get(e)||[],n=s.getAccessorUsage(e);if(s.addAccessorToUsageGroup(e,n),t.has(n)){const t=i[0].getParent(),n=r.get(t)||new Set;n.add(e),r.set(t,n)}}),l.filter(e=>e.prewriteTypes.includes(v_.BUFFER)).forEach(e=>e.prewrite(s,v_.BUFFER)),(r.listAccessors().length>0||r.listTextures().length>0||s.otherBufferViews.size>0)&&0===r.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],r.listBuffers().forEach((e,r)=>{const o=s.createPropertyDef(e),a=s.accessorUsageGroupedByParent,l=s.accessorParents,c=e.listParents().filter(e=>e instanceof $_),h=new Set(c),d=[],f=i.buffers.length;let g=0;const m=s.listAccessorUsageGroups();for(const i in m)if(a.has(i))for(const e of Array.from(l.values())){const r=Array.from(e).filter(e=>h.has(e)).filter(e=>s.getAccessorUsage(e)===i);if(r.length)if(i!==kv.ARRAY_BUFFER||t.vertexLayout===x_.INTERLEAVED){const e=i===kv.ARRAY_BUFFER?p(r,f,g):u(r,f,g);g+=e.byteLength,d.push(...e.buffers)}else for(const e of r){const t=p([e],f,g);g+=t.byteLength,d.push(...t.buffers)}}else{const e=m[i].filter(e=>h.has(e));if(!e.length)continue;const t=u(e,f,g,i===kv.ELEMENT_ARRAY_BUFFER?Tv.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);g+=t.byteLength,d.push(...t.buffers)}if(s.imageBufferViews.length&&0===r)for(let t=0;t<s.imageBufferViews.length;t++)if(i.bufferViews[i.images[t].bufferView].byteOffset=g,g+=s.imageBufferViews[t].byteLength,d.push(s.imageBufferViews[t]),g%8){const e=8-g%8;g+=e,d.push(new Uint8Array(e))}if(s.otherBufferViews.has(e))for(const t of s.otherBufferViews.get(e))i.bufferViews.push({buffer:f,byteOffset:g,byteLength:t.byteLength}),s.otherBufferViewsIndexMap.set(t,i.bufferViews.length-1),g+=t.byteLength,d.push(t);if(g){let r;t.format===y_.GLB?r="@glb.bin":(r=s.bufferURIGenerator.createURI(e,"bin"),o.uri=r),o.byteLength=g,n.resources[r]=I_.concat(d)}i.buffers.push(o),s.bufferIndexMap.set(e,r)}),r.listAccessors().find(e=>!e.getBuffer())&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),i.materials=r.listMaterials().map((e,t)=>{const r=s.createPropertyDef(e);if(e.getAlphaMode()!==pv.AlphaMode.OPAQUE&&(r.alphaMode=e.getAlphaMode()),e.getAlphaMode()===pv.AlphaMode.MASK&&(r.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(r.doubleSided=!0),r.pbrMetallicRoughness={},U_.eq(e.getBaseColorFactor(),[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),U_.eq(e.getEmissiveFactor(),[0,0,0])||(r.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(r.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(r.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),i=e.getBaseColorTextureInfo();r.pbrMetallicRoughness.baseColorTexture=s.createTextureInfoDef(t,i)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),i=e.getEmissiveTextureInfo();r.emissiveTexture=s.createTextureInfoDef(t,i)}if(e.getNormalTexture()){const t=e.getNormalTexture(),i=e.getNormalTextureInfo(),n=s.createTextureInfoDef(t,i);1!==e.getNormalScale()&&(n.scale=e.getNormalScale()),r.normalTexture=n}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),i=e.getOcclusionTextureInfo(),n=s.createTextureInfoDef(t,i);1!==e.getOcclusionStrength()&&(n.strength=e.getOcclusionStrength()),r.occlusionTexture=n}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),i=e.getMetallicRoughnessTextureInfo();r.pbrMetallicRoughness.metallicRoughnessTexture=s.createTextureInfoDef(t,i)}return s.materialIndexMap.set(e,t),r}),i.meshes=r.listMeshes().map((e,t)=>{const r=s.createPropertyDef(e);let i=null;return r.primitives=e.listPrimitives().map(e=>{const t={attributes:{}};t.mode=e.getMode();const r=e.getMaterial();r&&(t.material=s.materialIndexMap.get(r)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const n=e.getIndices();n&&(t.indices=s.accessorIndexMap.get(n));for(const i of e.listSemantics())t.attributes[i]=s.accessorIndexMap.get(e.getAttribute(i));for(const i of e.listTargets()){const e={};for(const t of i.listSemantics())e[t]=s.accessorIndexMap.get(i.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!i&&(i=e.listTargets().map(e=>e.getName())),t}),e.getWeights().length&&(r.weights=e.getWeights()),i&&(r.extras=r.extras||{},r.extras.targetNames=i),s.meshIndexMap.set(e,t),r}),i.cameras=r.listCameras().map((e,t)=>{const r=s.createPropertyDef(e);if(r.type=e.getType(),r.type===nv.Type.PERSPECTIVE){r.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(r.perspective.aspectRatio=t)}else r.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return s.cameraIndexMap.set(e,t),r}),i.nodes=r.listNodes().map((e,t)=>{const r=s.createPropertyDef(e);return U_.eq(e.getTranslation(),[0,0,0])||(r.translation=e.getTranslation()),U_.eq(e.getRotation(),[0,0,0,1])||(r.rotation=e.getRotation()),U_.eq(e.getScale(),[1,1,1])||(r.scale=e.getScale()),e.getWeights().length&&(r.weights=e.getWeights()),s.nodeIndexMap.set(e,t),r}),i.skins=r.listSkins().map((e,t)=>{const r=s.createPropertyDef(e),i=e.getInverseBindMatrices();i&&(r.inverseBindMatrices=s.accessorIndexMap.get(i));const n=e.getSkeleton();return n&&(r.skeleton=s.nodeIndexMap.get(n)),r.joints=e.listJoints().map(e=>s.nodeIndexMap.get(e)),s.skinIndexMap.set(e,t),r}),r.listNodes().forEach((e,t)=>{const r=i.nodes[t],n=e.getMesh();n&&(r.mesh=s.meshIndexMap.get(n));const o=e.getCamera();o&&(r.camera=s.cameraIndexMap.get(o));const a=e.getSkin();a&&(r.skin=s.skinIndexMap.get(a)),e.listChildren().length>0&&(r.children=e.listChildren().map(e=>s.nodeIndexMap.get(e)))}),i.animations=r.listAnimations().map((e,t)=>{const r=s.createPropertyDef(e),i=new Map;return r.samplers=e.listSamplers().map((e,t)=>{const r=s.createPropertyDef(e);return r.input=s.accessorIndexMap.get(e.getInput()),r.output=s.accessorIndexMap.get(e.getOutput()),r.interpolation=e.getInterpolation(),i.set(e,t),r}),r.channels=e.listChannels().map(e=>{const t=s.createPropertyDef(e);return t.sampler=i.get(e.getSampler()),t.target={node:s.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t}),s.animationIndexMap.set(e,t),r}),i.scenes=r.listScenes().map((e,t)=>{const r=s.createPropertyDef(e);return r.nodes=e.listChildren().map(e=>s.nodeIndexMap.get(e)),s.sceneIndexMap.set(e,t),r});const d=r.getDefaultScene();return d&&(i.scene=r.listScenes().indexOf(d)),i.extensionsUsed=l.map(e=>e.extensionName),i.extensionsRequired=c.map(e=>e.extensionName),l.forEach(e=>e.write(s)),function(e){const t=[];for(const r in e){const i=e[r];(Array.isArray(i)&&0===i.length||null===i||""===i||i&&"object"==typeof i&&0===Object.keys(i).length)&&t.push(r)}for(const r of t)delete e[r]}(i),n}}.write(e,{format:t.format||y_.GLTF,basename:t.basename||"",logger:this.v,vertexLayout:this.F,dependencies:mv({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:y_.GLB}),i=new Uint32Array([1179937895,2,12]),n=JSON.stringify(t),s=I_.pad(I_.encodeText(n),32),o=I_.toView(new Uint32Array([s.byteLength,1313821514])),a=I_.concat([o,s]);i[i.length-1]+=a.byteLength;const l=Object.values(r)[0];if(!l||!l.byteLength)return I_.concat([I_.toView(i),a]);const c=I_.pad(l,0),u=I_.toView(new Uint32Array([c.byteLength,5130562])),p=I_.concat([u,c]);return i[i.length-1]+=p.byteLength,I_.concat([I_.toView(i),a,p])}detectFormat(e){return"glb"===(X_.isAbsoluteURL(e)?X_.extension(e):R_.extension(e))?y_.GLB:y_.GLTF}async P(e){this.lastReadBytes=0;const t=await this.readURI(e,"text");this.lastReadBytes+=t.length;const r={json:JSON.parse(t),resources:{}};return await this.D(r,this.dirname(e)),this.L(r),r}async U(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=this._(t);return await this.D(r,this.dirname(e)),this.L(r),r}async D(e,t){var r=this;const i=[...e.json.images||[],...e.json.buffers||[]].map(async function(i){const n=i.uri;if(!n||n.match(/data:/))return Promise.resolve();e.resources[n]=await r.readURI(r.resolve(t,n),"view"),r.lastReadBytes+=e.resources[n].byteLength});await Promise.all(i)}L(e){function t(t){if(t.uri)if(t.uri in e.resources)I_.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const r=`__${function(){for(let e=0;e<999;e++){const e=q_();if(!W_.has(e))return W_.add(e),e}return""}()}.${R_.extension(t.uri)}`;e.resources[r]=I_.createBufferFromDataURI(t.uri),t.uri=r}}(e.json.images||[]).forEach(e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)}),(e.json.buffers||[]).forEach(t)}j(e){const{images:t,buffers:r}=e.json;return e={json:mv({},e.json),resources:mv({},e.resources)},t&&(e.json.images=t.map(e=>mv({},e))),r&&(e.json.buffers=r.map(e=>mv({},e))),e}_(e){const t=new Uint32Array(e.buffer,e.byteOffset,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Dv.JSON)throw new Error("Missing required GLB JSON chunk.");const i=r[0],n=I_.decodeText(I_.toView(e,20,i)),s=JSON.parse(n),o=20+i;if(e.byteLength<=o)return{json:s,resources:{}};const a=new Uint32Array(e.buffer,e.byteOffset+o,2);if(a[1]!==Dv.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:s,resources:{"@glb.bin":I_.toView(e,o+8,a[0])}}}}{constructor(e=X_.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,t){const r=await fetch(e,this.V);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return X_.resolve(e,t)}dirname(e){return X_.dirname(e)}detectFormat(e){return"glb"===X_.extension(e)?y_.GLB:y_.GLTF}}class Bv{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Rv{constructor(e,t,r,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,i)}}new Uint8Array([0]);const Lv=[171,75,84,88,32,50,48,187,13,10,26,10];function Ov(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}function Fv(e){const t=new Uint8Array(e.buffer,e.byteOffset,Lv.length);if(t[0]!==Lv[0]||t[1]!==Lv[1]||t[2]!==Lv[2]||t[3]!==Lv[3]||t[4]!==Lv[4]||t[5]!==Lv[5]||t[6]!==Lv[6]||t[7]!==Lv[7]||t[8]!==Lv[8]||t[9]!==Lv[9]||t[10]!==Lv[10]||t[11]!==Lv[11])throw new Error("Missing KTX 2.0 identifier.");const r=new Bv,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new Rv(e,Lv.length,i,!0);r.vkFormat=n._nextUint32(),r.typeSize=n._nextUint32(),r.pixelWidth=n._nextUint32(),r.pixelHeight=n._nextUint32(),r.pixelDepth=n._nextUint32(),r.layerCount=n._nextUint32(),r.faceCount=n._nextUint32();const s=n._nextUint32();r.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),u=n._nextUint64(),p=n._nextUint64(),h=new Rv(e,Lv.length+i,3*s*8,!0);for(let B=0;B<s;B++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+h._nextUint64(),h._nextUint64()),uncompressedByteLength:h._nextUint64()});const d=new Rv(e,o,a,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},g=(f.descriptorBlockSize/4-6)/4;for(let B=0;B<g;B++){const e={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=d._nextInt32(),e.sampleUpper=d._nextInt32()):(e.sampleLower=d._nextUint32(),e.sampleUpper=d._nextUint32()),f.samples[B]=e}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(f);const m=new Rv(e,l,c,!0);for(;m._offset<c;){const e=m._nextUint32(),t=m._scan(e),i=Ov(t),n=m._scan(e-t.byteLength);r.keyValue[i]=i.match(/^ktx/i)?Ov(n):n,m._offset%4&&m._skip(4-m._offset%4)}if(p<=0)return r;const _=new Rv(e,u,p,!0),v=_._nextUint16(),x=_._nextUint16(),A=_._nextUint32(),b=_._nextUint32(),y=_._nextUint32(),w=_._nextUint32(),E=[];for(let B=0;B<s;B++)E.push({imageFlags:_._nextUint32(),rgbSliceByteOffset:_._nextUint32(),rgbSliceByteLength:_._nextUint32(),alphaSliceByteOffset:_._nextUint32(),alphaSliceByteLength:_._nextUint32()});const S=u+_._offset,C=S+A,M=C+b,T=M+y,I=new Uint8Array(e.buffer,e.byteOffset+S,A),k=new Uint8Array(e.buffer,e.byteOffset+C,b),D=new Uint8Array(e.buffer,e.byteOffset+M,y),P=new Uint8Array(e.buffer,e.byteOffset+T,w);return r.globalData={endpointCount:v,selectorCount:x,imageDescs:E,endpointsData:I,selectorsData:k,tablesData:D,extendedData:P},r}class Uv extends sv{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[v_.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Uv.EXTENSION_NAME="EXT_mesh_gpu_instancing";const Nv="EXT_mesh_gpu_instancing";function jv(){return(jv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}var Gv,zv,Vv;(class extends yv{constructor(...e){super(...e),this.extensionName=Nv,this.provideTypes=[v_.NODE],this.prewriteTypes=[v_.ACCESSOR]}createInstancedMesh(){return new Uv(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,r)=>{if(!t.extensions||!t.extensions[Nv])return;const i=t.extensions[Nv],n=this.createInstancedMesh();for(const s in i.attributes)n.setAttribute(s,e.accessors[i.attributes[s]]);e.nodes[r].setExtension(Nv,n)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const r of t.listAttributes())e.addAccessorToUsageGroup(r,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(r=>{const i=r.getExtension(Nv);if(i){const n=e.nodeIndexMap.get(r),s=t.json.nodes[n],o={attributes:{}};i.listSemantics().forEach(t=>{const r=i.getAttribute(t);o.attributes[t]=e.accessorIndexMap.get(r)}),s.extensions=s.extensions||{},s.extensions[Nv]=o}}),this}}).EXTENSION_NAME=Nv,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(Gv||(Gv={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(zv||(zv={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(Vv||(Vv={}));const{BYTE:Qv,SHORT:Hv,FLOAT:Wv}=$_.ComponentType,{normalize:qv,denormalize:Xv}=U_;function Yv(e,t,r,i){const{filter:n,bits:s}=i,o={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(r!==zv.ATTRIBUTES)return o;if(n!==Vv.NONE){let r=e.getNormalized()?function(e){const t=e.getComponentType(),r=e.getArray(),i=new Float32Array(r.length);for(let n=0;n<r.length;n++)i[n]=Xv(r[n],t);return i}(e):new Float32Array(o.array);switch(n){case Vv.EXPONENTIAL:o.byteStride=4*e.getElementSize(),o.componentType=Wv,o.normalized=!1,o.array=t.encodeFilterExp(r,e.getCount(),o.byteStride,s);break;case Vv.OCTAHEDRAL:o.byteStride=s>8?8:4,o.componentType=s>8?Hv:Qv,o.normalized=!0,r=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let r=0,i=e.length/3;r<i;r++)t[4*r]=e[3*r],t[4*r+1]=e[3*r+1],t[4*r+2]=e[3*r+2];return t}(r):r,o.array=t.encodeFilterOct(r,e.getCount(),o.byteStride,s);break;case Vv.QUATERNION:o.byteStride=8,o.componentType=Hv,o.normalized=!0,o.array=t.encodeFilterQuat(r,e.getCount(),o.byteStride,s);break;default:throw new Error("Invalid filter.")}o.min=e.getMin([]),o.max=e.getMax([]),e.getNormalized()&&(o.min=o.min.map(t=>Xv(t,e.getComponentType())),o.max=o.max.map(t=>Xv(t,e.getComponentType()))),o.normalized&&(o.min=o.min.map(e=>qv(e,o.componentType)),o.max=o.max.map(e=>qv(e,o.componentType)))}else o.byteStride%4&&(o.array=function(e,t){const r=I_.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,i=new e.constructor(e.length/t*r);for(let n=0;n*t<e.length;n++)for(let s=0;s<t;s++)i[n*r+s]=e[n*t+s];return i}(o.array,e.getElementSize()),o.byteStride=o.array.byteLength/e.getCount());return o}function Kv(e,t){return t===Tv.BufferViewUsage.ELEMENT_ARRAY_BUFFER?e.listParents().some(e=>e instanceof fv&&e.getMode()===fv.Mode.TRIANGLES)?zv.TRIANGLES:zv.INDICES:zv.ATTRIBUTES}function Jv(e,t){const r=t.getGraph().listParentEdges(e).filter(e=>!(e.getParent()instanceof Av));for(const i of r){const t=i.getName(),r=i.getAttributes().key||"";if("indices"===t)return{filter:Vv.NONE};if("attributes"===t){if("POSITION"===r)return{filter:Vv.NONE};if("TEXCOORD_0"===r)return{filter:Vv.NONE};if("NORMAL"===r)return{filter:Vv.OCTAHEDRAL,bits:8};if("TANGENT"===r)return{filter:Vv.OCTAHEDRAL,bits:8};if(r.startsWith("JOINTS_"))return{filter:Vv.NONE};if(r.startsWith("WEIGHTS_"))return{filter:Vv.NONE}}if("output"===t){const t=Zv(e);return"rotation"===t?{filter:Vv.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:Vv.EXPONENTIAL,bits:12}:{filter:Vv.NONE}}if("input"===t)return{filter:Vv.NONE};if("inverseBindMatrices"===t)return{filter:Vv.NONE}}return{filter:Vv.NONE}}function Zv(e){for(const t of e.listParents())if(t instanceof rv)for(const e of t.listParents())if(e instanceof tv)return e.getTargetPath();return null}const $v="EXT_meshopt_compression",ex={method:Gv.QUANTIZE};class tx extends yv{constructor(...e){super(...e),this.extensionName=$v,this.prereadTypes=[v_.BUFFER,v_.PRIMITIVE],this.prewriteTypes=[v_.BUFFER,v_.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=ex,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=jv({},ex,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${$v}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${$v}]: Missing WASM support.`)}return t===v_.BUFFER?this._prereadBuffers(e):t===v_.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((r,i)=>{if(!r.extensions||!r.extensions[$v])return;const n=r.extensions[$v],s=n.byteOffset||0,o=n.byteLength||0,a=n.count,l=n.byteStride,c=new Uint8Array(a*l),u=t.json.buffers[r.buffer],p=I_.toView(u.uri?t.resources[u.uri]:t.resources["@glb.bin"],s,o);this._decoder.decodeGltfBuffer(c,a,l,p,n.mode,n.filter),e.bufferViews[i]=c})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(r=>{var i;r.extensions&&r.extensions[$v]&&(i=t.json.buffers[r.buffer]).extensions&&i.extensions.EXT_meshopt_compression&&i.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[r.buffer],e.buffers[r.extensions[$v].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,r]of this._decoderFallbackBufferMap){for(const e of t.listParents())e instanceof $_&&e.swap(t,r);t.dispose()}return this}prewrite(e,t){return t===v_.ACCESSOR?this._prewriteAccessors(e):t===v_.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,r=this._encoder,i=this._encoderOptions,n=this.document.createBuffer(),s=this.document.getRoot().listBuffers().indexOf(n);this._encoderFallbackBuffer=n,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const o of this.document.getRoot().listAccessors()){if("weights"===Zv(o))continue;const n=e.getAccessorUsage(o),a=Kv(o,n),l=i.method===Gv.FILTER?Jv(o,this.document):{filter:Vv.NONE},c=Yv(o,r,a,l),{array:u,byteStride:p}=c,h=o.getBuffer();if(!h)throw new Error(`${$v}: Missing buffer for accessor.`);const d=this.document.getRoot().listBuffers().indexOf(h),f=[n,a,l.filter,p,d].join(":");let g=this._encoderBufferViews[f],m=this._encoderBufferViewData[f],_=this._encoderBufferViewAccessors[f];g&&m||(_=this._encoderBufferViewAccessors[f]=[],m=this._encoderBufferViewData[f]=[],g=this._encoderBufferViews[f]={buffer:s,target:Tv.USAGE_TO_TARGET[n],byteOffset:0,byteLength:0,byteStride:n===Tv.BufferViewUsage.ARRAY_BUFFER?p:void 0,extensions:{[$v]:{buffer:d,byteOffset:0,byteLength:0,mode:a,filter:l.filter!==Vv.NONE?l.filter:void 0,byteStride:p,count:0}}});const v=e.createAccessorDef(o);v.componentType=c.componentType,v.normalized=c.normalized,v.byteOffset=g.byteLength,v.min&&c.min&&(v.min=c.min),v.max&&c.max&&(v.max=c.max),e.accessorIndexMap.set(o,t.accessors.length),t.accessors.push(v),_.push(v),m.push(new Uint8Array(u.buffer,u.byteOffset,u.byteLength)),g.byteLength+=u.byteLength,g.extensions.EXT_meshopt_compression.count+=o.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const r in this._encoderBufferViews){const i=this._encoderBufferViews[r],n=this._encoderBufferViewData[r],s=this.document.getRoot().listBuffers()[i.extensions[$v].buffer],o=e.otherBufferViews.get(s)||[],{count:a,byteStride:l,mode:c}=i.extensions[$v],u=I_.concat(n),p=t.encodeGltfBuffer(u,a,l,c),h=I_.pad(p);i.extensions[$v].byteLength=p.byteLength,n.length=0,n.push(h),o.push(h),e.otherBufferViews.set(s,o)}}write(e){let t=0;for(const s in this._encoderBufferViews){const r=this._encoderBufferViews[s],i=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[s][0]),n=this._encoderBufferViewAccessors[s];for(const e of n)e.bufferView=i;const o=e.jsonDoc.json.bufferViews[i],a=o.byteOffset||0;Object.assign(o,r),o.byteOffset=t,o.extensions[$v].byteOffset=a,t+=I_.padNumber(r.byteLength)}const r=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(r),n=e.jsonDoc.json.buffers[i];return n.byteLength=t,n.extensions={[$v]:{fallback:!0}},r.dispose(),this}}tx.EXTENSION_NAME=$v,tx.EncoderMethod=Gv;const rx="EXT_texture_webp";class ix{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=I_.decodeText(e.slice(0,4)),r=I_.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==r)return null;const i=new DataView(e.buffer,e.byteOffset);let n=12;for(;n<i.byteLength;){const e=I_.decodeText(new Uint8Array([i.getUint8(n),i.getUint8(n+1),i.getUint8(n+2),i.getUint8(n+3)])),t=i.getUint32(n+4,!0);if("VP8 "===e)return[16383&i.getInt16(n+14,!0),16383&i.getInt16(n+16,!0)];if("VP8L"===e){const e=i.getUint8(n+9),t=i.getUint8(n+10),r=i.getUint8(n+11);return[1+((63&t)<<8|e),1+((15&i.getUint8(n+12))<<10|r<<2|(192&t)>>6)]}n+=8+t+t%2}return null}getChannels(e){return 4}}(class extends yv{constructor(...e){super(...e),this.extensionName=rx,this.prereadTypes=[v_.TEXTURE]}static register(){P_.registerFormat("image/webp",new ix)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(r=>{if("image/webp"===r.getMimeType()){const i=e.imageIndexMap.get(r);(t.json.textures||[]).forEach(e=>{e.source===i&&(e.extensions=e.extensions||{},e.extensions.EXT_texture_webp={source:e.source},delete e.source)})}}),this}}).EXTENSION_NAME=rx;const nx="KHR_draco_mesh_compression";let sx,ox,ax,lx;function cx(e,t){const r=new sx.DecoderBuffer;try{if(r.Init(t,t.length),e.GetEncodedGeometryType(r)!==sx.TRIANGULAR_MESH)throw new Error(`[${nx}] Unknown geometry type.`);const i=new sx.Mesh;if(!e.DecodeBufferToMesh(r,i).ok()||0===i.ptr)throw new Error(`[${nx}] Decoding failure.`);return i}finally{sx.destroy(r)}}function ux(e,t){const r=3*t.num_faces();let i,n;if(t.num_points()<=65534){const s=r*Uint16Array.BYTES_PER_ELEMENT;i=sx._malloc(s),e.GetTrianglesUInt16Array(t,s,i),n=new Uint16Array(sx.HEAPU16.buffer,i,r).slice()}else{const s=r*Uint32Array.BYTES_PER_ELEMENT;i=sx._malloc(s),e.GetTrianglesUInt32Array(t,s,i),n=new Uint32Array(sx.HEAPU32.buffer,i,r).slice()}return sx._free(i),n}function px(e,t,r,i){const n=ax[i.componentType],s=ox[i.componentType],o=r.num_components(),a=t.num_points()*o,l=a*s.BYTES_PER_ELEMENT,c=sx._malloc(l);e.GetAttributeDataArrayForAllPoints(t,r,n,l,c);const u=new s(sx.HEAPF32.buffer,c,a).slice();return sx._free(c),u}var hx,dx;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(hx||(hx={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(dx||(dx={}));const fx={[dx.POSITION]:14,[dx.NORMAL]:10,[dx.COLOR]:8,[dx.TEX_COORD]:12,[dx.GENERIC]:12},gx={decodeSpeed:5,encodeSpeed:5,method:hx.EDGEBREAKER,quantizationBits:fx,quantizationVolume:"mesh"};function mx(e,t=gx){const r=jv({},gx,t);r.quantizationBits=jv({},fx,t.quantizationBits);const i=new lx.Encoder,n=new lx.MeshBuilder,s=new lx.Mesh,o={},a=new lx.DracoInt8Array;for(const f of e.listSemantics()){const t=e.getAttribute(f),a=_x(f),l=vx(n,t.getComponentType(),s,lx[a],t.getCount(),t.getElementSize(),t.getArray());if(-1===l)throw new Error(`Error compressing "${f}" attribute.`);if(o[f]=l,"mesh"===r.quantizationVolume||"POSITION"!==f)i.SetAttributeQuantization(lx[a],r.quantizationBits[a]);else{if("object"!=typeof r.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=r,n=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);i.SetAttributeExplicitQuantization(lx[a],r.quantizationBits[a],t.getElementSize(),e.min,n)}}}const l=e.getIndices();if(!l)throw new Error("Primitive must have indices.");n.AddFacesToMesh(s,l.getCount()/3,l.getArray()),i.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),i.SetTrackEncodedProperties(!0),r.method===hx.SEQUENTIAL||e.listTargets().length>0?i.SetEncodingMethod(lx.MESH_SEQUENTIAL_ENCODING):i.SetEncodingMethod(lx.MESH_EDGEBREAKER_ENCODING);const c=i.EncodeMeshToDracoBuffer(s,a);if(c<=0)throw new Error("Error applying Draco compression.");const u=new Uint8Array(c);for(let f=0;f<c;++f)u[f]=a.GetValue(f);const p=e.getAttribute("POSITION").getCount(),h=i.GetNumberOfEncodedPoints(),d=3*i.GetNumberOfEncodedFaces();if(e.listTargets().length>0&&h!==p)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return lx.destroy(a),lx.destroy(s),lx.destroy(n),lx.destroy(i),{numVertices:h,numIndices:d,data:u,attributeIDs:o}}function _x(e){return"POSITION"===e?dx.POSITION:"NORMAL"===e?dx.NORMAL:e.startsWith("COLOR_")?dx.COLOR:e.startsWith("TEXCOORD_")?dx.TEX_COORD:dx.GENERIC}function vx(e,t,r,i,n,s,o){switch(t){case $_.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(r,i,n,s,o);case $_.ComponentType.BYTE:return e.AddInt8Attribute(r,i,n,s,o);case $_.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(r,i,n,s,o);case $_.ComponentType.SHORT:return e.AddInt16Attribute(r,i,n,s,o);case $_.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(r,i,n,s,o);case $_.ComponentType.FLOAT:return e.AddFloatAttribute(r,i,n,s,o);default:throw new Error(`Unexpected component type, "${t}".`)}}const xx="KHR_draco_mesh_compression";class Ax extends yv{constructor(...e){super(...e),this.extensionName=xx,this.prereadTypes=[v_.PRIMITIVE],this.prewriteTypes=[v_.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,sx=this._decoderModule,ox={[$_.ComponentType.FLOAT]:Float32Array,[$_.ComponentType.UNSIGNED_INT]:Uint32Array,[$_.ComponentType.UNSIGNED_SHORT]:Uint16Array,[$_.ComponentType.UNSIGNED_BYTE]:Uint8Array,[$_.ComponentType.SHORT]:Int16Array,[$_.ComponentType.BYTE]:Int8Array},ax={[$_.ComponentType.FLOAT]:sx.DT_FLOAT32,[$_.ComponentType.UNSIGNED_INT]:sx.DT_UINT32,[$_.ComponentType.UNSIGNED_SHORT]:sx.DT_UINT16,[$_.ComponentType.UNSIGNED_BYTE]:sx.DT_UINT8,[$_.ComponentType.SHORT]:sx.DT_INT16,[$_.ComponentType.BYTE]:sx.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,lx=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${xx}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),r=e.jsonDoc,i=new Map;try{const n=r.json.meshes||[];for(const s of n)for(const n of s.primitives){if(!n.extensions||!n.extensions[xx])continue;const s=n.extensions[xx];let[o,a]=i.get(s.bufferView)||[];if(!a||!o){const e=r.json.bufferViews[s.bufferView],n=r.json.buffers[e.buffer],l=I_.toView(n.uri?r.resources[n.uri]:r.resources["@glb.bin"],e.byteOffset||0,e.byteLength);a=cx(o=new this._decoderModule.Decoder,l),i.set(s.bufferView,[o,a]),t.debug(`[${xx}] Decompressed ${l.byteLength} bytes.`)}for(const t in n.attributes){const r=e.jsonDoc.json.accessors[n.attributes[t]],i=o.GetAttributeByUniqueId(a,s.attributes[t]),l=px(o,a,i,r);e.accessors[n.attributes[t]].setArray(l)}void 0!==n.indices&&e.accessors[n.indices].setArray(ux(o,a))}}finally{for(const[e,t]of Array.from(i.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${xx}] Please install extension dependency, "draco3d.encoder".`);const r=this.document.getLogger();r.debug(`[${xx}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=function(e){const t=e.getLogger(),r=new Set,i=new Set;for(const c of e.getRoot().listMeshes())for(const e of c.listPrimitives())e.getIndices()?e.getMode()!==fv.Mode.TRIANGLES?(i.add(e),t.warn(`[${xx}] Skipping Draco compression on non-TRIANGLES primitive.`)):r.add(e):(i.add(e),t.warn(`[${xx}] Skipping Draco compression on non-indexed primitive.`));const n=e.getRoot().listAccessors(),s=new Map;for(let c=0;c<n.length;c++)s.set(n[c],c);const o=new Map,a=new Set,l=new Map;for(const c of Array.from(r)){let t=bx(c,s);if(a.has(t))l.set(c,t);else{if(o.has(c.getIndices())){const t=c.getIndices(),r=t.clone();s.set(r,e.getRoot().listAccessors().length-1),c.swap(t,r)}for(const t of c.listAttributes())if(o.has(t)){const r=t.clone();s.set(r,e.getRoot().listAccessors().length-1),c.swap(t,r)}t=bx(c,s),a.add(t),l.set(c,t),o.set(c.getIndices(),t);for(const e of c.listAttributes())o.set(e,t)}}for(const c of Array.from(o.keys())){const e=new Set(c.listParents().map(e=>e.propertyType));if(2!==e.size||!e.has(v_.PRIMITIVE)||!e.has(v_.ROOT))throw new Error(`[${xx}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const c of Array.from(r)){const e=l.get(c),t=c.getIndices();if(o.get(t)!==e||c.listAttributes().some(t=>o.get(t)!==e))throw new Error(`[${xx}] Draco primitives must share all, or no, accessors.`)}for(const c of Array.from(i)){const e=c.getIndices();if(o.has(e)||c.listAttributes().some(e=>o.has(e)))throw new Error(`[${xx}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return l}(this.document),n=new Map;let s="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?r.warn(`[${xx}]: quantizationVolume=scene requires exactly 1 scene.`):s=function(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=e.propertyType===v_.NODE?[e]:e.listChildren();for(const i of r)i.traverse(e=>{const r=e.getMesh();if(!r)return;const i=M_(r,e.getWorldMatrix());T_(i.min,t),T_(i.max,t)});return t}(this.document.getRoot().listScenes().pop()));for(const o of Array.from(i.keys())){const t=i.get(o);if(!t)throw new Error("Unexpected primitive.");if(n.has(t)){n.set(t,n.get(t));continue}const r=o.getIndices(),a=e.jsonDoc.json.accessors,l=mx(o,jv({},this._encoderOptions,{quantizationVolume:s}));n.set(t,l);const c=e.createAccessorDef(r);c.count=l.numIndices,e.accessorIndexMap.set(r,a.length),a.push(c);for(const i of o.listSemantics()){const t=o.getAttribute(i),r=e.createAccessorDef(t);r.count=l.numVertices,e.accessorIndexMap.set(t,a.length),a.push(r)}const u=o.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(u)||e.otherBufferViews.set(u,[]),e.otherBufferViews.get(u).push(l.data)}return r.debug(`[${xx}] Compressed ${i.size} primitives.`),e.extensionData[xx]={primitiveHashMap:i,primitiveEncodingMap:n},this}write(e){const t=e.extensionData[xx];for(const r of this.document.getRoot().listMeshes()){const i=e.jsonDoc.json.meshes[e.meshIndexMap.get(r)];for(let n=0;n<r.listPrimitives().length;n++){const s=r.listPrimitives()[n],o=i.primitives[n],a=t.primitiveHashMap.get(s);if(!a)continue;const l=t.primitiveEncodingMap.get(a);o.extensions=o.extensions||{},o.extensions[xx]={bufferView:e.otherBufferViewsIndexMap.get(l.data),attributes:l.attributeIDs}}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter(e=>e!==xx),t.extensionsRequired=(t.extensionsRequired||[]).filter(e=>e!==xx)}return this}}function bx(e,t){const r=[],i=e.getIndices();r.push(t.get(i));for(const n of e.listAttributes())r.push(t.get(n));return r.sort().join("|")}Ax.EXTENSION_NAME=xx,Ax.EncoderMethod=hx;class yx extends sv{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[v_.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:yx.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return k_.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return k_.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}yx.EXTENSION_NAME="KHR_lights_punctual",yx.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const wx="KHR_lights_punctual";class Ex extends yv{constructor(...e){super(...e),this.extensionName=wx}createLight(e=""){return new yx(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions.KHR_lights_punctual)return this;const r=(t.json.extensions.KHR_lights_punctual.lights||[]).map(e=>{var t,r;const i=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&i.setColor(e.color),void 0!==e.intensity&&i.setIntensity(e.intensity),void 0!==e.range&&i.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&i.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(r=e.spot)?void 0:r.outerConeAngle)&&i.setOuterConeAngle(e.spot.outerConeAngle),i});return t.json.nodes.forEach((t,i)=>{t.extensions&&t.extensions.KHR_lights_punctual&&e.nodes[i].setExtension(wx,r[t.extensions.KHR_lights_punctual.light])}),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const r=[],i=new Map;for(const n of this.properties){const e=n,t={type:e.getType()};U_.eq(e.getColor(),[1,1,1])||(t.color=e.getColor()),1!==e.getIntensity()&&(t.intensity=e.getIntensity()),null!=e.getRange()&&(t.range=e.getRange()),e.getName()&&(t.name=e.getName()),e.getType()===yx.Type.SPOT&&(t.spot={innerConeAngle:e.getInnerConeAngle(),outerConeAngle:e.getOuterConeAngle()}),r.push(t),i.set(e,r.length-1)}return this.document.getRoot().listNodes().forEach(r=>{const n=r.getExtension(wx);if(n){const s=e.nodeIndexMap.get(r),o=t.json.nodes[s];o.extensions=o.extensions||{},o.extensions.KHR_lights_punctual={light:i.get(n)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions.KHR_lights_punctual={lights:r},this}}Ex.EXTENSION_NAME=wx;const{R:Sx,G:Cx,B:Mx}=b_;class Tx extends sv{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new ov(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new ov(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new ov(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Sx})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Cx})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Sx|Cx|Mx})}}Tx.EXTENSION_NAME="KHR_materials_clearcoat";const Ix="KHR_materials_clearcoat";class kx extends yv{constructor(...e){super(...e),this.extensionName=Ix}createClearcoat(){return new Tx(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions[Ix]){const n=this.createClearcoat();e.materials[i].setExtension(Ix,n);const s=t.extensions[Ix];if(void 0!==s.clearcoatFactor&&n.setClearcoatFactor(s.clearcoatFactor),void 0!==s.clearcoatRoughnessFactor&&n.setClearcoatRoughnessFactor(s.clearcoatRoughnessFactor),void 0!==s.clearcoatTexture){const t=s.clearcoatTexture;n.setClearcoatTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getClearcoatTextureInfo(),t)}if(void 0!==s.clearcoatRoughnessTexture){const t=s.clearcoatRoughnessTexture;n.setClearcoatRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==s.clearcoatNormalTexture){const t=s.clearcoatNormalTexture;n.setClearcoatNormalTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&n.setClearcoatNormalScale(t.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(Ix);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o=s.extensions[Ix]={clearcoatFactor:i.getClearcoatFactor(),clearcoatRoughnessFactor:i.getClearcoatRoughnessFactor()};if(i.getClearcoatTexture()){const t=i.getClearcoatTexture(),r=i.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(t,r)}if(i.getClearcoatRoughnessTexture()){const t=i.getClearcoatRoughnessTexture(),r=i.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(t,r)}if(i.getClearcoatNormalTexture()){const t=i.getClearcoatNormalTexture(),r=i.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(t,r),1!==i.getClearcoatNormalScale()&&(o.clearcoatNormalTexture.scale=i.getClearcoatNormalScale())}}}),this}}kx.EXTENSION_NAME=Ix;class Dx extends sv{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}Dx.EXTENSION_NAME="KHR_materials_emissive_strength";const Px="KHR_materials_emissive_strength";class Bx extends yv{constructor(...e){super(...e),this.extensionName=Px}createEmissiveStrength(){return new Dx(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[Px]){const i=this.createEmissiveStrength();e.materials[r].setExtension(Px,i);const n=t.extensions[Px];void 0!==n.emissiveStrength&&i.setEmissiveStrength(n.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(Px);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{},s.extensions[Px]={emissiveStrength:i.getEmissiveStrength()}}}),this}}Bx.EXTENSION_NAME=Px;class Rx extends sv{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}Rx.EXTENSION_NAME="KHR_materials_ior";const Lx="KHR_materials_ior";class Ox extends yv{constructor(...e){super(...e),this.extensionName=Lx}createIOR(){return new Rx(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,r)=>{if(t.extensions&&t.extensions.KHR_materials_ior){const i=this.createIOR();e.materials[r].setExtension(Lx,i);const n=t.extensions.KHR_materials_ior;void 0!==n.ior&&i.setIOR(n.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(Lx);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{},s.extensions.KHR_materials_ior={ior:i.getIOR()}}}),this}}Ox.EXTENSION_NAME=Lx;const{R:Fx,G:Ux}=b_;class Nx extends sv{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new ov(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new ov(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Fx})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:Ux})}}Nx.EXTENSION_NAME="KHR_materials_iridescence";const jx="KHR_materials_iridescence";class Gx extends yv{constructor(...e){super(...e),this.extensionName=jx}createIridescence(){return new Nx(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions[jx]){const n=this.createIridescence();e.materials[i].setExtension(jx,n);const s=t.extensions[jx];if(void 0!==s.iridescenceFactor&&n.setIridescenceFactor(s.iridescenceFactor),void 0!==s.iridescenceIor&&n.setIridescenceIOR(s.iridescenceIor),void 0!==s.iridescenceThicknessMinimum&&n.setIridescenceThicknessMinimum(s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&n.setIridescenceThicknessMaximum(s.iridescenceThicknessMaximum),void 0!==s.iridescenceTexture){const t=s.iridescenceTexture;n.setIridescenceTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getIridescenceTextureInfo(),t)}if(void 0!==s.iridescenceThicknessTexture){const t=s.iridescenceThicknessTexture;n.setIridescenceThicknessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getIridescenceThicknessTextureInfo(),t)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(jx);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o=s.extensions[jx]={};if(i.getIridescenceFactor()>0&&(o.iridescenceFactor=i.getIridescenceFactor()),1.3!==i.getIridescenceIOR()&&(o.iridescenceIor=i.getIridescenceIOR()),100!==i.getIridescenceThicknessMinimum()&&(o.iridescenceThicknessMinimum=i.getIridescenceThicknessMinimum()),400!==i.getIridescenceThicknessMaximum()&&(o.iridescenceThicknessMaximum=i.getIridescenceThicknessMaximum()),i.getIridescenceTexture()){const t=i.getIridescenceTexture(),r=i.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(t,r)}if(i.getIridescenceThicknessTexture()){const t=i.getIridescenceThicknessTexture(),r=i.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(t,r)}}}),this}}Gx.EXTENSION_NAME=jx;const{R:zx,G:Vx,B:Qx,A:Hx}=b_;class Wx extends sv{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new ov(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new ov(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return k_.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(k_.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:zx|Vx|Qx|Hx})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:zx|Vx|Qx|Hx})}}Wx.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const qx="KHR_materials_pbrSpecularGlossiness";class Xx extends yv{constructor(...e){super(...e),this.extensionName=qx}createPBRSpecularGlossiness(){return new Wx(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions[qx]){const n=this.createPBRSpecularGlossiness();e.materials[i].setExtension(qx,n);const s=t.extensions[qx];if(void 0!==s.diffuseFactor&&n.setDiffuseFactor(s.diffuseFactor),void 0!==s.specularFactor&&n.setSpecularFactor(s.specularFactor),void 0!==s.glossinessFactor&&n.setGlossinessFactor(s.glossinessFactor),void 0!==s.diffuseTexture){const t=s.diffuseTexture;n.setDiffuseTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getDiffuseTextureInfo(),t)}if(void 0!==s.specularGlossinessTexture){const t=s.specularGlossinessTexture;n.setSpecularGlossinessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSpecularGlossinessTextureInfo(),t)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(qx);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o=s.extensions[qx]={diffuseFactor:i.getDiffuseFactor(),specularFactor:i.getSpecularFactor(),glossinessFactor:i.getGlossinessFactor()};if(i.getDiffuseTexture()){const t=i.getDiffuseTexture(),r=i.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(t,r)}if(i.getSpecularGlossinessTexture()){const t=i.getSpecularGlossinessTexture(),r=i.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(t,r)}}}),this}}Xx.EXTENSION_NAME=qx;const{R:Yx,G:Kx,B:Jx,A:Zx}=b_;class $x extends sv{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new ov(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new ov(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return k_.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",k_.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Yx|Kx|Jx})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Zx})}}$x.EXTENSION_NAME="KHR_materials_sheen";const eA="KHR_materials_sheen";class tA extends yv{constructor(...e){super(...e),this.extensionName=eA}createSheen(){return new $x(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions.KHR_materials_sheen){const n=this.createSheen();e.materials[i].setExtension(eA,n);const s=t.extensions.KHR_materials_sheen;if(void 0!==s.sheenColorFactor&&n.setSheenColorFactor(s.sheenColorFactor),void 0!==s.sheenRoughnessFactor&&n.setSheenRoughnessFactor(s.sheenRoughnessFactor),void 0!==s.sheenColorTexture){const t=s.sheenColorTexture;n.setSheenColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSheenColorTextureInfo(),t)}if(void 0!==s.sheenRoughnessTexture){const t=s.sheenRoughnessTexture;n.setSheenRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSheenRoughnessTextureInfo(),t)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(eA);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o=s.extensions.KHR_materials_sheen={sheenColorFactor:i.getSheenColorFactor(),sheenRoughnessFactor:i.getSheenRoughnessFactor()};if(i.getSheenColorTexture()){const t=i.getSheenColorTexture(),r=i.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(t,r)}if(i.getSheenRoughnessTexture()){const t=i.getSheenRoughnessTexture(),r=i.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(t,r)}}}),this}}tA.EXTENSION_NAME=eA;const{R:rA,G:iA,B:nA,A:sA}=b_;class oA extends sv{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new ov(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new ov(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return k_.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",k_.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:sA})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:rA|iA|nA})}}oA.EXTENSION_NAME="KHR_materials_specular";const aA="KHR_materials_specular";class lA extends yv{constructor(...e){super(...e),this.extensionName=aA}createSpecular(){return new oA(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions[aA]){const n=this.createSpecular();e.materials[i].setExtension(aA,n);const s=t.extensions[aA];if(void 0!==s.specularFactor&&n.setSpecularFactor(s.specularFactor),void 0!==s.specularColorFactor&&n.setSpecularColorFactor(s.specularColorFactor),void 0!==s.specularTexture){const t=s.specularTexture;n.setSpecularTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSpecularTextureInfo(),t)}if(void 0!==s.specularColorTexture){const t=s.specularColorTexture;n.setSpecularColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSpecularColorTextureInfo(),t)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(aA);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o=s.extensions[aA]={};if(1!==i.getSpecularFactor()&&(o.specularFactor=i.getSpecularFactor()),U_.eq(i.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const t=i.getSpecularTexture(),r=i.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(t,r)}if(i.getSpecularColorTexture()){const t=i.getSpecularColorTexture(),r=i.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(t,r)}}}),this}}lA.EXTENSION_NAME=aA;const{R:cA}=b_;class uA extends sv{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new ov(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:cA})}}uA.EXTENSION_NAME="KHR_materials_transmission";const pA="KHR_materials_transmission";class hA extends yv{constructor(...e){super(...e),this.extensionName=pA}createTransmission(){return new uA(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions[pA]){const n=this.createTransmission();e.materials[i].setExtension(pA,n);const s=t.extensions[pA];if(void 0!==s.transmissionFactor&&n.setTransmissionFactor(s.transmissionFactor),void 0!==s.transmissionTexture){const t=s.transmissionTexture;n.setTransmissionTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getTransmissionTextureInfo(),t)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(pA);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o=s.extensions[pA]={transmissionFactor:i.getTransmissionFactor()};if(i.getTransmissionTexture()){const t=i.getTransmissionTexture(),r=i.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(t,r)}}}),this}}hA.EXTENSION_NAME=pA;class dA extends sv{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[v_.MATERIAL]}}dA.EXTENSION_NAME="KHR_materials_unlit";const fA="KHR_materials_unlit";class gA extends yv{constructor(...e){super(...e),this.extensionName=fA}createUnlit(){return new dA(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,r)=>{t.extensions&&t.extensions.KHR_materials_unlit&&e.materials[r].setExtension(fA,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{if(r.getExtension(fA)){const i=e.materialIndexMap.get(r),n=t.json.materials[i];n.extensions=n.extensions||{},n.extensions.KHR_materials_unlit={}}}),this}}gA.EXTENSION_NAME=fA;class mA extends sv{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}mA.EXTENSION_NAME="KHR_materials_variants";class _A extends sv{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[v_.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}_A.EXTENSION_NAME="KHR_materials_variants";class vA extends sv{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}vA.EXTENSION_NAME="KHR_materials_variants";const xA="KHR_materials_variants";class AA extends yv{constructor(...e){super(...e),this.extensionName=xA}createMappingList(){return new _A(this.document.getGraph())}createVariant(e=""){return new vA(this.document.getGraph(),e)}createMapping(){return new mA(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof vA)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[xA])return this;const r=(t.json.extensions[xA].variants||[]).map(e=>this.createVariant().setName(e.name||""));return(t.json.meshes||[]).forEach((t,i)=>{const n=e.meshes[i];(t.primitives||[]).forEach((t,i)=>{if(!t.extensions||!t.extensions[xA])return;const s=this.createMappingList(),o=t.extensions[xA];for(const n of o.mappings){const t=this.createMapping();void 0!==n.material&&t.setMaterial(e.materials[n.material]);for(const e of n.variants||[])t.addVariant(r[e]);s.addMapping(t)}n.listPrimitives()[i].setExtension(xA,s)})}),this}write(e){const t=e.jsonDoc,r=this.listVariants();if(!r.length)return this;const i=[],n=new Map;for(const s of r)n.set(s,i.length),i.push(e.createPropertyDef(s));for(const s of this.document.getRoot().listMeshes()){const t=e.meshIndexMap.get(s);s.listPrimitives().forEach((r,i)=>{const s=r.getExtension(xA);if(!s)return;const o=e.jsonDoc.json.meshes[t].primitives[i],a=s.listMappings().map(t=>{const r=e.createPropertyDef(t),i=t.getMaterial();return i&&(r.material=e.materialIndexMap.get(i)),r.variants=t.listVariants().map(e=>n.get(e)),r});o.extensions=o.extensions||{},o.extensions[xA]={mappings:a}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[xA]={variants:i},this}}AA.EXTENSION_NAME=xA;const{G:bA}=b_;class yA extends sv{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[v_.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new ov(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:bA})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return k_.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",k_.hexToFactor(e,t))}}yA.EXTENSION_NAME="KHR_materials_volume";const wA="KHR_materials_volume";class EA extends yv{constructor(...e){super(...e),this.extensionName=wA}createVolume(){return new yA(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach((t,i)=>{if(t.extensions&&t.extensions.KHR_materials_volume){const n=this.createVolume();e.materials[i].setExtension(wA,n);const s=t.extensions.KHR_materials_volume;if(void 0!==s.thicknessFactor&&n.setThicknessFactor(s.thicknessFactor),void 0!==s.attenuationDistance&&n.setAttenuationDistance(s.attenuationDistance),void 0!==s.attenuationColor&&n.setAttenuationColor(s.attenuationColor),void 0!==s.thicknessTexture){const t=s.thicknessTexture;n.setThicknessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getThicknessTextureInfo(),t)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(wA);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o=s.extensions.KHR_materials_volume={};if(i.getThicknessFactor()>0&&(o.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(o.attenuationDistance=i.getAttenuationDistance()),U_.eq(i.getAttenuationColor(),[1,1,1])||(o.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const t=i.getThicknessTexture(),r=i.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(t,r)}}}),this}}EA.EXTENSION_NAME=wA;const SA="KHR_mesh_quantization";class CA extends yv{constructor(...e){super(...e),this.extensionName=SA}read(e){return this}write(e){return this}}CA.EXTENSION_NAME=SA;const MA="KHR_texture_basisu";class TA{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=Fv(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=Fv(e).dataFormatDescriptor[0];if(163===t.colorModel)return 2===t.samples.length&&15==(15&t.samples[1].channelType)?4:3;if(166===t.colorModel)return 3==(15&t.samples[0].channelType)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=Fv(e),r=this.getChannels(e)>3;let i=0;for(let n=0;n<t.levels.length;n++){const e=t.levels[n];i+=e.uncompressedByteLength?e.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,n)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,n)))/4)*(r?16:8)}return i}}class IA extends yv{constructor(...e){super(...e),this.extensionName=MA,this.prereadTypes=[v_.TEXTURE]}static register(){P_.registerFormat("image/ktx2",new TA)}preread(e){return e.jsonDoc.json.textures.forEach(e=>{e.extensions&&e.extensions.KHR_texture_basisu&&(e.source=e.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(r=>{if("image/ktx2"===r.getMimeType()){const i=e.imageIndexMap.get(r);t.json.textures.forEach(e=>{e.source===i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_basisu={source:e.source},delete e.source)})}}),this}}IA.EXTENSION_NAME=MA;class kA extends sv{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[v_.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}kA.EXTENSION_NAME="KHR_texture_transform";const DA="KHR_texture_transform";class PA extends yv{constructor(...e){super(...e),this.extensionName=DA}createTransform(){return new kA(this.document.getGraph())}read(e){for(const[t,r]of Array.from(e.textureInfos.entries())){if(!r.extensions||!r.extensions.KHR_texture_transform)continue;const e=this.createTransform(),i=r.extensions.KHR_texture_transform;void 0!==i.offset&&e.setOffset(i.offset),void 0!==i.rotation&&e.setRotation(i.rotation),void 0!==i.scale&&e.setScale(i.scale),void 0!==i.texCoord&&e.setTexCoord(i.texCoord),t.setExtension(DA,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[r,i]of t){const e=r.getExtension(DA);if(!e)continue;i.extensions=i.extensions||{};const t={},n=U_.eq;n(e.getOffset(),[0,0])||(t.offset=e.getOffset()),0!==e.getRotation()&&(t.rotation=e.getRotation()),n(e.getScale(),[1,1])||(t.scale=e.getScale()),null!=e.getTexCoord()&&(t.texCoord=e.getTexCoord()),i.extensions.KHR_texture_transform=t}return this}}PA.EXTENSION_NAME=DA;const BA=[v_.ROOT,v_.SCENE,v_.NODE,v_.MESH,v_.MATERIAL,v_.TEXTURE,v_.ANIMATION];class RA extends sv{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=BA}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",jv({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const r=jv({},this.get("properties"));return t?r[e]=t:delete r[e],this.set("properties",r)}toJSONLD(){return jv({"@context":LA(this.get("context"))},LA(this.get("properties")))}fromJSONLD(e){const t=(e=LA(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function LA(e){return JSON.parse(JSON.stringify(e))}RA.EXTENSION_NAME="KHR_xmp_json_ld";const OA="KHR_xmp_json_ld";class FA extends yv{constructor(...e){super(...e),this.extensionName=OA}createPacket(){return new RA(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const r=null==(t=e.jsonDoc.json.extensions)?void 0:t.KHR_xmp_json_ld;if(!r||!r.packets)return this;const i=e.jsonDoc.json,n=this.document.getRoot(),s=r.packets.map(e=>this.createPacket().fromJSONLD(e)),o=[[i.asset],i.scenes,i.nodes,i.meshes,i.materials,i.images,i.animations],a=[[n],n.listScenes(),n.listNodes(),n.listMeshes(),n.listMaterials(),n.listTextures(),n.listAnimations()];for(let l=0;l<o.length;l++){const e=o[l]||[];for(let t=0;t<e.length;t++){const r=e[t];r.extensions&&r.extensions.KHR_xmp_json_ld&&a[l][t].setExtension(OA,s[r.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:t}=e.jsonDoc,r=[];for(const i of this.properties){r.push(i.toJSONLD());for(const n of i.listParents()){let i;switch(n.propertyType){case v_.ROOT:i=t.asset;break;case v_.SCENE:i=t.scenes[e.sceneIndexMap.get(n)];break;case v_.NODE:i=t.nodes[e.nodeIndexMap.get(n)];break;case v_.MESH:i=t.meshes[e.meshIndexMap.get(n)];break;case v_.MATERIAL:i=t.materials[e.materialIndexMap.get(n)];break;case v_.TEXTURE:i=t.images[e.imageIndexMap.get(n)];break;case v_.ANIMATION:i=t.animations[e.animationIndexMap.get(n)];break;default:i=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${n.propertyType}"`)}i&&(i.extensions=i.extensions||{},i.extensions.KHR_xmp_json_ld={packet:r.length-1})}}return r.length>0&&(t.extensions=t.extensions||{},t.extensions.KHR_xmp_json_ld={packets:r}),this}}FA.EXTENSION_NAME=OA;const UA=[Ax,Ex,kx,Bx,Ox,Gx,Xx,lA,tA,hA,gA,AA,EA,CA,IA,PA,FA];let NA=class extends Wt{constructor(e,t,r){super(e,t,null!=r?r:new jA,new xe(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(e,t,r,i,n){this.enabled&&super.render(e,t,r,i,n)}};NA=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([ot("High precision Normal Buffer")],NA);class jA extends i.RSm{constructor(){super()}onBeforeRender(e,t,r,n,s){var o,a;let l=s.material;Array.isArray(l)&&(l=l[0]),this.normalMap=null!==(o=null==l?void 0:l.normalMap)&&void 0!==o?o:null,this.needsUpdate=!0,this.side=null!==(a=l.side)&&void 0!==a?a:i.ehD}}class GA extends lo{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:i.cLu,minFilter:i.TyD,magFilter:i.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,r=new Set,n=new Set;return new class extends NA{render(e,i,s,o,a){const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:e})=>{e&&((e.transparent&&e.userData.renderToDepth||!e.transparent&&0===e.transmission&&!1===e.userData.renderToDepth)&&(r.add(e),e.transparent=!e.transparent),Math.abs(e.transmission||0)>0&&e.userData.renderToDepth&&(n.add([e,e.transmission]),e.transmission=0))}),W(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,t,o,a)),r.forEach(e=>e.transparent=!e.transparent),r.clear(),n.forEach(([e,t])=>e.transmission=t),n.clear(),e.setRenderTarget(l,c,u))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,r;return e.renderer.disposeTarget(null===(r=null===(t=this._normalTarget)||void 0===t?void 0:t.dispose)||void 0===r?void 0:r.call(t)),super.onRemove(e)}updateShaderProperties(e){var t,r;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&null!==(r=null===(t=this.getNormalBuffer())||void 0===t?void 0:t.texture)&&void 0!==r?r:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return null===(e=this.pass)||void 0===e?void 0:e.passObject.uiConfig}}function zA(e){const t=null==e?void 0:e.userData;if(!t)return!1;t._ssBevel||(t._ssBevel={});const r=t._ssBevel;return r.hasSSBevel=!0,void 0===r.radius&&(r.radius=0),e.isMaterial&&(e.needsUpdate=!0),!0}GA.PluginType="NormalBufferPlugin";let VA=class extends Ht{constructor(e,t,r,n){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new i.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new i.Pa4(1,1,1)}},vertexShader:Bo,fragmentShader:`\n\n            ${r}\n\n            ${Oo}\n\n            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;\n#include <common>\nfloat getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}\n            \n            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(e,t,r)=>{var i,n;this.enabled&&(null===(n=null===(i=t.materialObject.userData)||void 0===i?void 0:i._ssBevel)||void 0===n?void 0:n.hasSSBevel)&&(e.fragmentShader=Jt(e.fragmentShader,"#include <normal_fragment_maps>"," \n                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;\n                normal = normalize(normal);\n                //geometryNormal = normal;\n            "))},onObjectRender:(e,t,r)=>{var i,n;if(!this.enabled||!(null===(n=null===(i=t.materialObject.userData)||void 0===i?void 0:i._ssBevel)||void 0===n?void 0:n.hasSSBevel))return;const s=t.materialObject,o=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==o&&(this.materialExtension.extraUniforms.tSSBevelMap.value=o,s.needsUpdate=!0)},getUiConfig:e=>{const t={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var t;return(null===(t=e.materialObject.userData._ssBevel)||void 0===t?void 0:t.hasSSBevel)||!1},set value(r){var i,n;r!==(null===(i=e.materialObject.userData._ssBevel)||void 0===i?void 0:i.hasSSBevel)&&(r?zA(e.materialObject)||alert("Cannot add screen space bevel."):(e.materialObject.userData._ssBevel.hasSSBevel=!1,e.materialObject.needsUpdate=!0),null===(n=t.uiRefresh)||void 0===n||n.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var t;return!(null===(t=e.materialObject.userData._ssBevel)||void 0===t?void 0:t.hasSSBevel)},property:[e.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return t},parsFragmentSnippet:(e,t)=>{var r,i;return this.enabled&&(null===(i=null===(r=null==t?void 0:t.materialObject.userData)||void 0===r?void 0:r._ssBevel)||void 0===i?void 0:i.hasSSBevel)?w`
            uniform sampler2D tSSBevelMap;
            ${jo}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:e=>{var t,r;return(this.enabled?"1":"0")+((null===(r=null===(t=e.materialObject.userData)||void 0===t?void 0:t._ssBevel)||void 0===r?void 0:r.hasSSBevel)?"1":"0")},isCompatible:e=>e.isMeshStandardMaterial2},this._target=t,this.needsSwap=!1,this.clear=!0,this._viewerApp=n,this._edgeMaterial=new zt({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new i.FM8(1,1)},cameraPositionWorld:{value:new i.Pa4(1,1,1)}},vertexShader:Bo,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new zt({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new i.FM8(.5,.5)},direction:{value:new i.FM8(.5,.5)}},vertexShader:Bo,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(e,t,r,n,s){var o,a;if(!this.enabled)return;const l=e.baseRenderer,c={minFilter:i.wem,magFilter:i.wem,isAntialiased:!1,format:i.wk1,depthBuffer:!1,generateMipmaps:!1},u=l.getTempTarget(c);this._renderEdges(l,u),this._blurEdges(l,u),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),null===(o=this._viewerApp.getPlugin(ho))||void 0===o||o.updateShaderProperties(this.material),null===(a=this._viewerApp.getPlugin(GA))||void 0===a||a.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=u.texture,super.render(e,this._target,u,n,s),l.releaseTempTarget(u)}_initsamples(){const e=[],t=1/8;return e.push(new i.FM8(-8,0).multiplyScalar(t)),e.push(new i.FM8(-6,-4).multiplyScalar(t)),e.push(new i.FM8(-3,-2).multiplyScalar(t)),e.push(new i.FM8(-2,-6).multiplyScalar(t)),e.push(new i.FM8(1,-1).multiplyScalar(t)),e.push(new i.FM8(2,-5).multiplyScalar(t)),e.push(new i.FM8(6,-7).multiplyScalar(t)),e.push(new i.FM8(5,-3).multiplyScalar(t)),e.push(new i.FM8(4,1).multiplyScalar(t)),e.push(new i.FM8(7,4).multiplyScalar(t)),e.push(new i.FM8(3,5).multiplyScalar(t)),e.push(new i.FM8(0,7).multiplyScalar(t)),e.push(new i.FM8(-1,3).multiplyScalar(t)),e.push(new i.FM8(-4,6).multiplyScalar(t)),e.push(new i.FM8(-7,8).multiplyScalar(t)),e.push(new i.FM8(-5,2).multiplyScalar(t)),e}_blurEdges(e,t){var r,n;const s={minFilter:i.wem,magFilter:i.wem,isAntialiased:!1,format:i.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},o=e.getTempTarget(s),a=(null===(r=t.texture.image)||void 0===r?void 0:r.width)||1,l=(null===(n=t.texture.image)||void 0===n?void 0:n.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new i.FM8(a,l),this._separableBlurMaterial.uniforms.colorTexture.value=t.texture,this._separableBlurMaterial.uniforms.direction.value=new i.FM8(1,0),e.blit(void 0,o,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new i.FM8(a/2,l/2),this._separableBlurMaterial.uniforms.colorTexture.value=o.texture,this._separableBlurMaterial.uniforms.direction.value=new i.FM8(0,1),e.blit(void 0,t,{material:this._separableBlurMaterial}),e.releaseTempTarget(o)}_renderEdges(e,t){var r,n,s,o;const a=(null===(r=t.texture.image)||void 0===r?void 0:r.width)||1,l=(null===(n=t.texture.image)||void 0===n?void 0:n.height)||1;this._edgeMaterial.uniforms.screenSize.value=new i.FM8(a,l),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),null===(s=this._viewerApp.getPlugin(ho))||void 0===s||s.updateShaderProperties(this._edgeMaterial),null===(o=this._viewerApp.getPlugin(GA))||void 0===o||o.updateShaderProperties(this._edgeMaterial),e.blit(void 0,t,{material:this._edgeMaterial})}};VA=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([ot("SSBevel")],VA);class QA extends lo{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[so,ho,GA],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(e=>new HA(e))}passCtor(e){var t,r;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:i.cLu,minFilter:i.TyD,magFilter:i.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const n=e.getPluginByType("debug");return n&&n.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new VA(e.renderer,this._bevelTarget,null!==(r=null===(t=e.getPlugin(ho))||void 0===t?void 0:t.getUnpackSnippet())&&void 0!==r?r:"",e)}async onAdded(e){var t,r,i,n,s,o,a,l;await super.onAdded(e);const c=e.getPlugin(so);return(null===(t=this.pass)||void 0===t?void 0:t.passObject.materialExtension)&&(null===(r=null==c?void 0:c.materials)||void 0===r||r.registerMaterialExtension(null===(i=this.pass)||void 0===i?void 0:i.passObject.materialExtension)),null===(n=null==c?void 0:c.importer)||void 0===n||n.addEventListener("loaderCreate",this._loaderCreate),null===(a=null===(o=null===(s=null==c?void 0:c.exporter)||void 0===s?void 0:s.getExporter("gltf","glb"))||void 0===o?void 0:o.extensions)||void 0===a||a.push(WA),null===(l=e.getPlugin(ho))||void 0===l||l.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,r,i;null===(e=this._viewer)||void 0===e||e.setDirty(),null===(i=null===(t=this.pass)||void 0===t?void 0:(r=t.passObject.materialExtension).setDirty)||void 0===i||i.call(r)}_update(e){var t;let r=this.enabled;if(r&&!this._lastEnabled){const e=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?e.enabled=!0:(this.enabled=!1,e.enabled=!1,r=!1)}return this._lastEnabled=r,r}get uiConfig(){var e,t,r,i,n;const s=null!==(r=null===(t=null===(e=this.pass)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig)&&void 0!==r?r:{};return null===(n=null===(i=s.children)||void 0===i?void 0:i.map(e=>x(e)))||void 0===n||n.flat(2).forEach(e=>e&&(e.onChange=this.setDirty)),s}updateGBuffer(e,t){var r,n,s;if(e instanceof i.Kj0&&(null===(r=e.material)||void 0===r?void 0:r.userData)){for(let e=3;e<8;e++)t.y=yh(t.y,e);let r=(null===(n=e.material)||void 0===n?void 0:n.userData._ssBevel)?null===(s=e.material)||void 0===s?void 0:s.userData._ssBevel.radius:0;r=Math.min(r,31),r<<=3,t.y=t.y|r}}}QA.PluginType="SSBevelPlugin",QA.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class HA{constructor(e){this.parser=e,this.name=QA.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.userData||(t.userData={}),zA(t),t.userData._ssBevel=De(i,t.userData._ssBevel,!1,{}),Promise.resolve()}}const WA=e=>({writeMaterial:(t,r)=>{if(!t.isMeshStandardMaterial||!t.userData._ssBevel)return;if(!t.userData._ssBevel.hasSSBevel)return;r.extensions=r.extensions||{};const i=ke(t.userData._ssBevel,!1);r.extensions[QA.SSBEVEL_GLTF_EXTENSION]=i,e.extensionsUsed[QA.SSBEVEL_GLTF_EXTENSION]=!0}});class qA extends Xm{constructor(e){super(),this._loadedLibs=!1,e=e||{method:Ax.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=(new Pv).registerExtensions(UA).registerExtensions([KA,rb,$A,eb,tb,ib,nb,sb,ob,ab,lb,cb,ub,pb,hb]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,...r}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,r);await this._loadLibs();const i={...r};t&&(i.externalImagesInExtras=!0);const n=await new Promise((t,r)=>this.parse(e,t,r,i)),s=await super.parseAsync(n,i);if(!t)return s;if(!n)throw new Error("GLTFDracoExporter: gltf is null");let o=n;const a=o.byteLength||1/0,l=await("object"!=typeof o||o.byteLength?this._io.readBinary(new Uint8Array(o)):this._io.readJSON({json:o,resources:{}}));if(l.createExtension(Ax).setRequired(!0).setEncoderOptions(this._encoderOptions),"glb"===i.exportExt)o=await this._io.writeBinary(l),isFinite(a)&&console.log("DRACO Compression ratio: "+(o.byteLength/a).toFixed(5));else{const e=await this._io.writeJSON(l);o=e.json,Object.values(e.resources).filter(e=>e).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),o.resources=e.resources)}o.__isGLTFOutput=!0;const c=await super.parseAsync(o,i);return c.__uncompressed=s,c}}class XA extends oo{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[so,o_]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");!function(e,t){Jm(e,qA,e=>{const r=We()+".drc",i=e;i.loader=t.registerFile(r),i.loader.setDecoderConfig({type:"js"}),i.loader.preload(!0,!0)})}(e,t)}}XA.PluginType="GLTFDracoExportPlugin";class YA extends sv{constructor(){super(...arguments),this.extensionName=ci,this.parentTypes=[v_.SCENE],this.propertyType="ViewerJSON"}init(){}}class KA extends yv{constructor(){super(...arguments),this.extensionName=ci,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},null===(t=e.jsonDoc.json.scenes)||void 0===t||t.forEach((t,r)=>{if(t.extensions&&t.extensions[ci]){const i=new YA(this.document.getGraph());e.scenes[r].setExtension(ci,i);const n=t.extensions[ci];this._viewerConfig=n}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var r;if(t.getExtension(ci)){const t=null===(r=e.jsonDoc.json.scenes)||void 0===r?void 0:r[e.jsonDoc.json.scene||0];t&&this._viewerConfig!=={}&&(t.extensions=t.extensions||{},t.extensions[ci]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}KA.EXTENSION_NAME=ci;class JA extends sv{constructor(e,t,r){super(e,t),this.parentTypes=[v_.MATERIAL,v_.MESH,v_.NODE,v_.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=r}addTexture(e,t,r,i=4369){this.setRef(e,r,{channels:i}),this.textures[e]=[t,r]}copy(e,t=Y_){return super.copy(e,t),this}dispose(){Object.values(this.textures).forEach(([e,t])=>{null==e||e.dispose()}),super.dispose()}init(){}}class ZA extends yv{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,r=t.json.materials||[],i=t.json.textures||[];return r.forEach((t,r)=>{var n,s;if(t.extensions&&t.extensions[this.extensionName]){const o=new JA(this.document.getGraph(),"",this.extensionName);e.materials[r].setExtension(this.extensionName,o);const a={...t.extensions[this.extensionName]};for(const[t,r]of Object.entries(a))if("number"==typeof(null==r?void 0:r.index)){const l=r,c=null===(n=i[l.index])||void 0===n?void 0:n.source;if("number"!=typeof c){console.warn("GLTF Pipeline: source texture not found for texture info",l);continue}const u=e.textures[c],p=new ov(this.document.getGraph()),h=null!==(s=this.textureChannels[t])&&void 0!==s?s:4369;o.addTexture(t,p,u,h),e.setTextureInfo(p,l),delete a[t]}o.setExtras(a)}}),(t.json.meshes||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new JA(this.document.getGraph(),"",this.extensionName);e.meshes[r].setExtension(this.extensionName,i);const n=t.extensions[this.extensionName];i.setExtras(n)}}),(t.json.nodes||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new JA(this.document.getGraph(),"",this.extensionName);e.nodes[r].setExtension(this.extensionName,i);const n=t.extensions[this.extensionName];i.setExtras(n)}}),(t.json.scenes||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[this.extensionName]){const i=new JA(this.document.getGraph(),"",this.extensionName);e.scenes[r].setExtension(this.extensionName,i);const n=t.extensions[this.extensionName];i.setExtras(n)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(r=>{const i=r.getExtension(this.extensionName);if(i){const n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{};const o={...i.getExtras()};for(const[t,r]of Object.entries(i.textures)){const i=r[0],n=r[1];n&&(o[t]=e.createTextureInfoDef(n,i))}s.extensions[this.extensionName]=o}}),this.document.getRoot().listMeshes().forEach(r=>{const i=r.getExtension(this.extensionName);if(i){const n=e.meshIndexMap.get(r),s=t.json.meshes[n];s.extensions=s.extensions||{},s.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listNodes().forEach(r=>{const i=r.getExtension(this.extensionName);if(i){const n=e.nodeIndexMap.get(r),s=t.json.nodes[n];s.extensions=s.extensions||{},s.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listScenes().forEach(r=>{const i=r.getExtension(this.extensionName);if(i){const r=e.jsonDoc.json.scene||0,n=t.json.scenes[r];if(!n)return;n.extensions=n.extensions||{},n.extensions[this.extensionName]=i.getExtras()}}),this}}class $A extends ZA{constructor(){super(...arguments),this.extensionName=$A.EXTENSION_NAME,this.textureChannels={bumpTexture:b_.R}}}$A.EXTENSION_NAME=_i;class eb extends ZA{constructor(){super(...arguments),this.extensionName=eb.EXTENSION_NAME,this.textureChannels={lightMapTexture:b_.R|b_.G|b_.B}}}eb.EXTENSION_NAME=Ai;class tb extends ZA{constructor(){super(...arguments),this.extensionName=tb.EXTENSION_NAME,this.textureChannels={alphaTexture:b_.G}}}tb.EXTENSION_NAME=xi;class rb extends ZA{constructor(){super(...arguments),this.extensionName=rb.EXTENSION_NAME}}rb.EXTENSION_NAME=jc.DIAMOND_GLTF_EXTENSION;class ib extends ZA{constructor(){super(...arguments),this.extensionName=ib.EXTENSION_NAME}}ib.EXTENSION_NAME=Qc.AnimationMarkersExtension;class nb extends ZA{constructor(){super(...arguments),this.extensionName=nb.EXTENSION_NAME,this.textureChannels={anisotropyDirection:b_.R|b_.G|b_.B}}}nb.EXTENSION_NAME=Au.ANISOTROPY_GLTF_EXTENSION;class sb extends ZA{constructor(){super(...arguments),this.extensionName=sb.EXTENSION_NAME,this.textureChannels={anisotropyDirection:b_.R|b_.G|b_.B}}}sb.EXTENSION_NAME=Lu.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class ob extends ZA{constructor(){super(...arguments),this.extensionName=ob.EXTENSION_NAME}}ob.EXTENSION_NAME=pi;class ab extends ZA{constructor(){super(...arguments),this.extensionName=ab.EXTENSION_NAME}}ab.EXTENSION_NAME=hi;class lb extends ZA{constructor(){super(...arguments),this.extensionName=lb.EXTENSION_NAME}}lb.EXTENSION_NAME=di;class cb extends ZA{constructor(){super(...arguments),this.extensionName=cb.EXTENSION_NAME}}cb.EXTENSION_NAME=Nu.CLEARCOAT_TINT_GLTF_EXTENSION;class ub extends ZA{constructor(){super(...arguments),this.extensionName=ub.EXTENSION_NAME}}ub.EXTENSION_NAME=Eu.THIN_FILM_LAYER_GLTF_EXTENSION;class pb extends ZA{constructor(){super(...arguments),this.extensionName=pb.EXTENSION_NAME}}pb.EXTENSION_NAME=QA.SSBEVEL_GLTF_EXTENSION;class hb extends ZA{constructor(){super(...arguments),this.extensionName=hb.EXTENSION_NAME}}hb.EXTENSION_NAME=Iu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class db extends r{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}db.PluginType="PMREMGenerator";const fb=new i.Pa4,gb=new i._fP,mb=new i.Pa4;class _b extends i.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const vb=new i.yGw,xb=new i.yGw;class Ab{constructor(e={}){const t=this;let r,i,n,s;const o={camera:{fov:0,style:""},objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a;const l=document.createElement("div");function c(e){return Math.abs(e)<1e-10?0:e}function u(e){const t=e.elements;return"matrix3d("+c(t[0])+","+c(-t[1])+","+c(t[2])+","+c(t[3])+","+c(t[4])+","+c(-t[5])+","+c(t[6])+","+c(t[7])+","+c(t[8])+","+c(-t[9])+","+c(t[10])+","+c(t[11])+","+c(t[12])+","+c(-t[13])+","+c(t[14])+","+c(t[15])+")"}function p(e){const t=e.elements;return"translate(-50%,-50%)matrix3d("+c(t[0])+","+c(t[1])+","+c(t[2])+","+c(t[3])+","+c(-t[4])+","+c(-t[5])+","+c(-t[6])+","+c(-t[7])+","+c(t[8])+","+c(t[9])+","+c(t[10])+","+c(t[11])+","+c(t[12])+","+c(t[13])+","+c(t[14])+","+c(t[15])+")"}function h(e,r,i,n){if(e.isCSS3DObject){const n=!0===e.visible&&!0===e.layers.test(i.layers);if(e.element.style.display=!0===n?"":"none",!0===n){let n;e.onBeforeRender(t,r,i),e.isCSS3DSprite?(vb.copy(i.matrixWorldInverse),vb.transpose(),0!==e.rotation2D&&vb.multiply(xb.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(fb,gb,mb),vb.setPosition(fb),vb.scale(mb),vb.elements[3]=0,vb.elements[7]=0,vb.elements[11]=0,vb.elements[15]=1,n=p(vb)):n=p(e.matrixWorld);const s=e.element,a=o.objects.get(e);if(void 0===a||a.style!==n){s.style.transform=n;const t={style:n};o.objects.set(e,t)}s.parentNode!==l&&l.appendChild(s),e.onAfterRender(t,r,i)}}for(let t=0,s=e.children.length;t<s;t++)h(e.children[t],r,i,n)}l.style.transformStyle="preserve-3d",l.style.pointerEvents="none",a.appendChild(l),this.getSize=function(){return{width:r,height:i}},this.render=function(e,t){const r=t.projectionMatrix.elements[5]*s;let i,p;o.camera.fov!==r&&(a.style.perspective=t.isPerspectiveCamera?r+"px":"",o.camera.fov=r),!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),t.isOrthographicCamera&&(i=-(t.right+t.left)/2,p=(t.top+t.bottom)/2);const d=t.isOrthographicCamera?"scale("+r+")translate("+c(i)+"px,"+c(p)+"px)"+u(t.matrixWorldInverse):"translateZ("+r+"px)"+u(t.matrixWorldInverse),f=d+"translate("+n+"px,"+s+"px)";o.camera.style!==f&&(l.style.transform=f,o.camera.style=f),h(e,e,t,d)},this.setSize=function(e,t){n=(r=e)/2,s=(i=t)/2,a.style.width=e+"px",a.style.height=t+"px",l.style.width=e+"px",l.style.height=t+"px"}}}var bb,yb=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let wb=bb=class extends oo{constructor(e=!0){super(),this._scene=new i.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=(async()=>{var e,t,r,i,n;const s=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject();if(!(null==s?void 0:s.geometry))return void(await(null===(r=this._viewer)||void 0===r?void 0:r.alert("No Geometry: Selected object must have a geometry to apply the iframe to")));const o=await(null===(i=this._viewer)||void 0===i?void 0:i.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!o)return;const a=await(null===(n=this._viewer)||void 0===n?void 0:n.prompt("Width: Enter the width for the object.","512",!1))||"512";a&&this.attachIFrame(s,o,parseInt(a))}),this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&(null===(e=this._viewer)||void 0===e||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=e,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const e=this._viewer;e&&this._renderer&&(e.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",e.canvas):this._renderer.domElement.appendChild(e.canvas))}_initialize(){if(this._renderer)return;if(!this._viewer)return;this._renderer=new Ab;const e=this._viewer.renderer.rendererObject.getSize(new i.FM8);this._renderer.setSize(e.width,e.height);const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.zIndex="0",t.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(t),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const e=this._viewer.renderer.rendererObject.getSize(new i.FM8);this._renderer.setSize(e.width,e.height)})}async onAdded(e){await super.onAdded(e);let t=!0,r=!0;e.addEventListener("postFrame",n=>{var s,o;t&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(r&&this._trackers.forEach(e=>{var t,r;let n=!0;const s=e.modelObj.material.side;if(s!==i.ehD){const o=new i.Pa4(0,0,1).applyQuaternion(e.cssObj.quaternion),a=null===(r=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera)||void 0===r?void 0:r.cameraObject,l=o.dot(a.getWorldDirection(new i.Pa4));n=s===i._Li?l>0:l<0}e.cssObj.element.style.visibility=n?"visible":"hidden"}),this._trackers.filter(e=>e.dirty).forEach(e=>this._syncProperties(e)),null===(s=this._renderer)||void 0===s||s.render(this._scene,null===(o=e.scene.activeCamera)||void 0===o?void 0:o.cameraObject),t=!1))}),e.addEventListener("update",e=>{this.enabled&&(t=this._trackers.length>0)}),e.scene.addEventListener("sceneUpdate",e=>{this.enabled&&(this._trackers.forEach(e=>e.dirty=!0),t=this._trackers.length>0)}),e.scene.addEventListener("activeCameraUpdate",e=>{this.enabled&&(t=this._trackers.length>0,r=!0)});let n=!1;const s=new i.iMs;e.container.addEventListener("mousemove",e=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const t=this._viewer.canvas.getBoundingClientRect(),r=(e.clientX-t.x)/t.width*2-1,i=-(e.clientY-t.y)/t.height*2+1;s.setFromCamera({x:r,y:i},this._viewer.scene.activeCamera.cameraObject);const o=this._trackers.map(e=>e.modelObj),a=s.intersectObjects(o,!1);if(console.log(a),a.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)})}attachIFrame(e,t,r){const i=Mb(e.modelObject),n=Eb(t,r,r*i.y/i.x,()=>{var t;return null===(t=e.setDirty)||void 0===t?void 0:t.call(e)});return this.attachCSS3DObject(n,e),n}attachCSS3DObject(e,t){var r,n,s,o,a;if(this._trackers.push({cssObj:e,modelObj:t.modelObject,dirty:!0}),e.element&&(this._resizeObserver.observe(e.element),e.element.__isCSS3DObjectElement=!0,console.log(e.element,e.element.__isCSS3DObjectElement)),t.userData.__oldMaterial=t.material,!t.setMaterial)throw"model not processed?";const l=null===(r=this._viewer)||void 0===r?void 0:r.createMaterial("basic",{opacity:0,color:new i.Ilk("black"),blending:i.jFi,side:i.Wl3});if(!l)throw"cannot create mat";l.userData.forcedLinearDepth=0,null===(n=t.setMaterial)||void 0===n||n.call(t,l),Sb(t.modelObject),Cb(t.modelObject),Mb(t.modelObject),this._scene.add(e),null===(o=null===(s=this.uiConfig)||void 0===s?void 0:s.uiRefresh)||void 0===o||o.call(s),null===(a=t.setDirty)||void 0===a||a.call(t)}_syncProperties(e){const t=e.modelObj,r=e.cssObj;t.updateMatrixWorld();const n=e.cssObj.element.clientWidth<1.5?0:(e.cssObj.element.clientWidth-1.5)/Mb(t).x,s=Sb(t);r.quaternion.setFromUnitVectors(new i.Pa4(0,0,1),s),r.position.copy(Cb(t)),r.scale.set(1,1,1).multiplyScalar(1/n),r.updateMatrixWorld(),r.applyMatrix4(t.matrixWorld),e.dirty=!1}async onDispose(e){return this._resizeObserver.disconnect(),super.onDispose(e)}};function Eb(e,t,r,i){const n=document.createElement("div");n.style.width=t.toString()+"px",n.style.height=r.toString()+"px",n.style.backgroundColor="transparent";const s=document.createElement("iframe",{is:"x-frame-bypass"});s.style.width="100%",s.style.height="100%",s.style.border="0px";const o=()=>{var e,t;try{s.contentWindow.name}catch(r){("string"==typeof r?r:null!==(t=null===(e=null==r?void 0:r.toString)||void 0===e?void 0:e.call(r))&&void 0!==t?t:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(r)}i(),s.removeEventListener("load",o)};return s.addEventListener("load",o),s.src=e,n.appendChild(s),new _b(n)}function Sb(e){if(e.geometry.userData.geometryNormal)return e.geometry.userData.geometryNormal;const t=e.geometry.attributes.normal,r=new i.Pa4,n=new i.Pa4;for(let i=0,s=t.count;i<s;i++)r.fromBufferAttribute(t,i),n.add(r);return n.normalize(),e.geometry.userData.geometryNormal=n,n}function Cb(e){if(e.geometry.userData.geometryCenter)return e.geometry.userData.geometryCenter;const t=e.geometry;if(!t)return new i.Pa4(0,0,0);t.boundingBox||t.computeBoundingBox();const r=t.boundingBox.getCenter(new i.Pa4);return e.geometry.userData.geometryCenter=r,r}function Mb(e,t=new i.Pa4(0,0,1)){if(e.geometry.userData.geometrySize)return e.geometry.userData.geometrySize;const r=e.geometry;if(!r)return new i.Pa4(0,0,0);const n=r.clone();n.applyMatrix4((new i.yGw).makeRotationFromQuaternion((new i._fP).setFromUnitVectors(t,Sb(e)).invert())),n.computeBoundingBox();const s=n.boundingBox.getSize(new i.Pa4);return e.geometry.userData.geometrySize=s,n.dispose(),s}wb.PluginType="CSS3DRenderer",yb([Ye("Enabled"),M(bb.prototype._refreshEnabled),Ce()],wb.prototype,"enabled",void 0),yb([Ye("Over canvas"),M(bb.prototype._refreshCanvasInDOM),Ce()],wb.prototype,"overCanvas",void 0),yb([et("Attach iframe")],wb.prototype,"attachIFrameToSelected",void 0),wb=bb=yb([ot("CSS3D Renderer")],wb);var Tb,Ib=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let kb=Tb=class{constructor(e){this.enabled=!1,this.enableHighlight=!0,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new i.Ilk(13715217),this.transparnecy=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new i.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new i.Ilk(16777215)},enableHighlight:{value:!0}},this.parsFragmentSnippet=((e,t)=>this.enabled?w`
            ${Yt}
            ${"uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float getVisibilityBit(in float number){return mod(floor(number/pow(2.,2.)),2.);}float visibility(vec2 uv){float backGround=getDepth(uv)>0.9999?1.:0.;return getVisibilityBit(getGBufferFlags(uv).a*255.)*(1.-backGround);}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;vec4 uvOffset=outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c=visibility(vUv);float c1=visibility(vUv+uvOffset.xy);float c2=visibility(vUv-uvOffset.xy);float c3=visibility(vUv+uvOffset.yw);float c4=visibility(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));float trans=min(1.,10.*(1.-highlightTransparency));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 outColor=vec4(outlineColor,trans)*vec4(d)+highlightColor;vec3 finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);return vec4(finalColor.rgb,color.a);}"}
        `:""),this._combinedPostPlugin=e.getPlugin(mh),this._pickingPlugin=e.getPlugin(Fc),this._setDirty=this._setDirty.bind(this)}shaderExtender(e,t,r){this.enabled&&(e.fragmentShader=Jt(e.fragmentShader,"#glMarker"," \n            gl_FragColor = outline(gl_FragColor);\n            #glMarker\n        "))}onObjectRender(e,t,r){this.enabled&&t.materialObject.uniforms.outlineIntensity&&(t.materialObject.uniforms.outlineIntensity.value=this.outlineIntensity,t.materialObject.uniforms.outlineThickness.value=this._outlineThickness,t.materialObject.uniforms.outlineColor.value.copy(this.outlineColor),t.materialObject.uniforms.enableHighlight.value=this.enableHighlight,t.materialObject.uniforms.highlightTransparency.value=this.transparnecy)}getUiConfig(){return this.uiConfig}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var e;null===(e=this.__setDirty)||void 0===e||e.call(this),this._setDirty()}_enable(){var e;null===(e=this._pickingPlugin)||void 0===e||e.enableWidget(!this.enabled),this._setDirty()}};kb.PluginType="Outline",Ib([M(Tb.prototype._enable),Ye("Enable"),Ce()],kb.prototype,"enabled",void 0),Ib([M(Tb.prototype._setDirty),Ye("Highlight"),Ce()],kb.prototype,"enableHighlight",void 0),Ib([M(Tb.prototype._setDirty),Ye("DynamicSelection"),Ce()],kb.prototype,"enableDynamicSelection",void 0),Ib([M(Tb.prototype._setDirty),Je("Intensity",[0,2],.001,{limitedUi:!0}),Ce()],kb.prototype,"outlineIntensity",void 0),Ib([M(Tb.prototype._setDirty),Je("Transparency",[0,1],.01,{limitedUi:!0}),Ce()],kb.prototype,"highlightTransparency",void 0),Ib([M(Tb.prototype._setDirty),rt("Color"),Ce()],kb.prototype,"outlineColor",void 0),kb=Tb=Ib([ot("Outline")],kb);class Db extends vh{constructor(){super(),this._state="in",this.updateGBuffer=this.updateGBuffer.bind(this)}generateExtension(e){return new kb(e)}async onAdded(e){var t,r;await super.onAdded(e),null===(t=e.getPlugin(ho))||void 0===t||t.registerGBufferUpdater(this.updateGBuffer),this._pickingPlugin=e.getPlugin(Fc);const i=this;null===(r=this._pickingPlugin)||void 0===r||r.addEventListener("selectedObjectChanged",()=>{var e;i._animationCallBack||((null===(e=this._pickingPlugin)||void 0===e?void 0:e.getSelectedObject())?(this._extension.transparnecy=1,i._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparnecy=1)}),document.addEventListener("mousemove",t=>{var r;const n=null===(r=this._pickingPlugin)||void 0===r?void 0:r.getSelectedObject();n&&this._extension.enableDynamicSelection?t.target!=e.canvas?i._animationCallBack||"in"!=i._state||(i._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),i._state="out"):i._animationCallBack||"out"!=i._state||(i._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),i._state="in"):this._extension.transparnecy=n?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,t,r){return Dc(this._extension,"transparnecy",{from:e,to:t,duration:r,onComplete:()=>{this._animationCallBack=null}})}updateGBuffer(e,t){var r;if(e instanceof i.Kj0){const i=null===(r=this._pickingPlugin)||void 0===r?void 0:r.getSelectedObject();i&&i.id===e.id?t.w=bh(t.w,2,1):t.w=bh(t.w,2,0)}}}Db.PluginType="Outline";const Pb=1e4,Bb=50;class Rb{constructor(e=Bb){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,r,i){const n=2e-4*this.naturalFrequency;if(null==e||0===i)return t;if(e===t&&0===this.velocity)return t;if(r<0)return e;const s=e-t,o=this.velocity+this.naturalFrequency*s,a=s+r*o,l=Math.exp(-this.naturalFrequency*r),c=(o-this.naturalFrequency*a)*l,u=-this.naturalFrequency*(c+o*l);return Math.abs(c)<n*Math.abs(i)&&u*s>=0?(this.velocity=0,t):(this.velocity=c,t+a*l)}}const Lb=new i.Pa4;class Ob{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new i.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new i.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new i.Pa4,this._hitMatrix=new i.yGw,this.xDamper=new Rb,this.yDamper=new Rb,this.zDamper=new Rb,this.yawDamper=new Rb,this.scaleDamper=new Rb,this.onSelectStart=(e=>{const t=this.transientHitTestSource;if(null==t)return;const r=this.frame.getHitTestResultsForTransientInput(t),i=this.presentedScene,n=this.placementBox;if(1===r.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad||{axes:[0,0]},r=n.getHit(i,t[0],t[1]);n.show=!0,null!=r?(this.isTranslating=!0,this.lastDragPosition.copy(r)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===r.length){n.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(r);this.firstRatio=e/i.scale.x}}),this.onSelectEnd=(()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1})}async setSession(e,t,r,i){var n;this.transientHitTestSource=await(null===(n=e.requestHitTestSourceForTransientInput)||void 0===n?void 0:n.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=i,this.xr=r,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var t;const r=null===(t=this.xr)||void 0===t?void 0:t.getReferenceSpace(),i=r?e.getPose(r):null;return i?(this._hitMatrix.fromArray(i.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,r=t.position,i=t.rotation.y,n=this.placementBox,s=Math.max(n.boundingSize.x,n.boundingSize.y,n.boundingSize.z)/2,o=this.goalPosition,a=t.scale.x;if(!o.equals(r)||this.goalScale!==a){let{x:i,y:l,z:c}=r;i=this.xDamper.update(i,o.x,e,s),l=this.yDamper.update(l,o.y,e,s),c=this.zDamper.update(c,o.z,e,s),r.set(i,l,c);const u=this.scaleDamper.update(a,this.goalScale,e,1);if(t.scale.set(u,u,u),!this.isTranslating){const e=o.y-l;this.placementComplete&&!this.placeOnWall?n.offsetHeight=e/u:0===e&&(this.placementComplete=!0,n.show=!1)}}n.updateOpacity(e),t.rotation.y=this.yawDamper.update(i,this.goalYaw,e,Math.PI)}processInput(e){var t;this.frame=e;const r=this.transientHitTestSource;if(!r)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(r),n=this.presentedScene,s=n.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(i);if(this.placeOnWall||(this.goalYaw+=t),!n.userData.__scaleDisabled){const t=e/this.firstRatio;this.goalScale=t<1.3&&t>.7692307692307692?1:t}}else if(2!==i.length)if(this.isRotating&&(null===(t=this.inputSource)||void 0===t?void 0:t.gamepad)){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&(console.log("translating"),i.forEach(e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/s;const r=Lb.copy(this.xr.getCamera().position),i=-e/(r.y-t.y);r.multiplyScalar(i),t.multiplyScalar(1-i).add(r)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/s}}getTouchLocation(){var e,t;const{axes:r}=null!==(e=this.inputSource.gamepad)&&void 0!==e?e:{axes:[0,0]},i=this.placementBox.getExpandedHit(this.presentedScene,r[0],r[1]);return null!=i&&(Lb.copy(i).sub(null===(t=this.xr)||void 0===t?void 0:t.getCamera().position),Lb.length()>10)?null:i}fingerPolar(e){var t,r,i,n,s,o;const a=null!==(i=null===(r=null===(t=e[0].inputSource)||void 0===t?void 0:t.gamepad)||void 0===r?void 0:r.axes)&&void 0!==i?i:[0,0],l=null!==(o=null===(s=null===(n=e[1].inputSource)||void 0===n?void 0:n.gamepad)||void 0===s?void 0:s.axes)&&void 0!==o?o:[0,0],c=l[0]-a[0],u=l[1]-a[1],p=Math.atan2(u,c);let h=this.lastAngle-p;return h>Math.PI?h-=2*Math.PI:h<-Math.PI&&(h+=2*Math.PI),this.lastAngle=p,{separation:Math.sqrt(c*c+u*u),deltaYaw:h}}}const Fb=.2,Ub=Math.PI/24,Nb=new i.FM8,jb=(e,t,r)=>{let i=t>0?r>0?0:-Math.PI/2:r>0?Math.PI/2:Math.PI;for(let n=0;n<=12;++n)e.push(t+.17*Math.cos(i),r+.17*Math.sin(i),0,t+Fb*Math.cos(i),r+Fb*Math.sin(i),0),i+=Ub};class Gb extends i.Kj0{constructor(e,t,r=!1){super(((e,t)=>{const r=new i.u9r,n=[],s=[],o=e.getSize(new i.Pa4),a=o.x/2,l=(t?o.y:o.z)/2;jb(s,a,l),jb(s,-a,l),jb(s,-a,-l),jb(s,a,-l);const c=s.length/3;for(let i=0;i<c-2;i+=2)n.push(i,i+1,i+3,i,i+3,i+2);const u=c-2;return n.push(u,u+1,1,u,1,0),r.setAttribute("position",new i.a$l(s,3)),r.setIndex(n),r})(e,r)),this.boundingSize=new i.Pa4,this._raycaster=new i.iMs,this._camera=t,this._placeOnWall=r;const n=this.material;n.side=i.Wl3,n.color=new xe(16711935),n.opacity=0,this.userData.bboxVisible=!1;const s=e.getSize(this.boundingSize);console.log(e,r,s,this);const o=s.x/2,a=(r?s.y:s.z)/2;this.hitPlane=new i.Kj0(new i._12(2*(o+Fb),2*(a+Fb))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),r?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,r){Nb.set(t,-r),this.hitPlane.visible=!0;const i=this._positionAndNormalFromPoint(Nb,this.hitPlane);return this.hitPlane.visible=!1,null==i?null:i.position}getExpandedHit(e,t,r){this.hitPlane.scale.set(1e3,1e3,1e3);const i=this.getHit(e,t,r);return this.hitPlane.scale.set(1,1,1),i}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:r}=this.hitPlane;t.dispose(),r.dispose(),this.geometry.dispose(),this.material.dispose(),null===(e=this.parent)||void 0===e||e.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const r=this._raycaster.intersectObject(t,!0);if(0===r.length)return null;const n=r[0];return null==n.face?null:null==n.uv?{position:n.point,normal:n.face.normal,uv:null}:(n.face.normal.applyNormalMatrix((new i.Vkp).getNormalMatrix(n.object.matrixWorld)),{position:n.point,normal:n.face.normal,uv:n.uv})}}class zb extends oo{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new Ob,this._preRender=(()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),t=e.cameras[0]||e,r=this._viewer.scene.activeCamera;r.cameraObject.projectionMatrix.copy(t.projectionMatrix),r.cameraObject.projectionMatrixInverse.copy(r.cameraObject.projectionMatrix).invert()}),this._postRender=(()=>{var e,t;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const r=this._viewer.renderer,i=null===(t=null===(e=this._xrManager)||void 0===e?void 0:e.getCamera())||void 0===t?void 0:t.cameras[0].viewport;i?r.rendererObject.setViewport(i):console.warn("no viewport for ar camera"),W(r.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{Vb.render(r.rendererObject,null,r.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0}),this._frameCount=0,this._lastTime=0,this._preFrame=(({xrFrame:e,deltaTime:t})=>{var r,i;if(this.dirty=!!e&&(null===(r=this._xrManager)||void 0===r?void 0:r.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const n=this._xrManager.getReferenceSpace(),s=e.getViewerPose(n);if(null==s&&this._frameCount,null==s||0===(null===(i=this._viewer)||void 0===i?void 0:i.scene.modelRoot.children.length))return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const o=this._viewer.scene.activeCamera;this._xrManager.updateCamera(o.cameraObject),o.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(t),this._updateShadow()}),this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new i.Pa4(1,1,1),modelPosition:new i.Pa4,modelRotation:new i._fP,cameraPosition:new i.Pa4(0,0,5),cameraTarget:new i.Pa4,cameraUp:new i.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new i.Pa4,groundScale:1},this._savePreXRState=(()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,t=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(t.position),this._preXRState.cameraTarget.copy(t.target),this._preXRState.cameraUp.copy(t.cameraObject.up),t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=t.cameraObject.fov,this._preXRState.cameraAspect=t.cameraObject.aspect),this._preXRState.cameraZoom=t.cameraObject.zoom,this._preXRState.cameraNear=t.cameraObject.near,this._preXRState.cameraFar=t.cameraObject.far;const r=this._viewer.getPluginByType("Ground");(null==r?void 0:r.mesh)&&(this._preXRState.groundOffset.subVectors(e.position,r.mesh.modelObject.position),this._preXRState.groundScale=r.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),r.shadowBaker.enabled=!1)}),this._xrSessionStart=(()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,t=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var e,r;if(this._xrSession){const i=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await(null===(r=(e=this._xrSession).requestHitTestSource)||void 0===r?void 0:r.call(e,{space:i,offsetRay:t}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()}),this._xrSessionEnd=(()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,null===(e=this._xrSession)||void 0===e||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())})}async onAdded(e){await super.onAdded(e);const t=e.renderer.rendererObject.xr;t.enabled=!0,t.cameraAutoUpdate=!1,this._xrManager=t;const r=document.getElementById("tweakpaneUiContainer"),i=r?{root:r}:void 0;document.body.appendChild(class{static createButton(e,t={}){const r=document.createElement("button");function i(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null}function n(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return r.id="ARButton",r.style.display="none",n(r),navigator.xr.isSessionSupported("immersive-ar").then(function(n){n?function(){if(void 0===t.domOverlay){const e=document.createElement("div");e.style.display="none",document.body.appendChild(e);const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width",38),r.setAttribute("height",38),r.style.position="absolute",r.style.right="20px",r.style.top="20px",r.addEventListener("click",function(){i.end()}),e.appendChild(r);const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),n.setAttribute("stroke","#fff"),n.setAttribute("stroke-width",2),r.appendChild(n),void 0===t.optionalFeatures&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:e}}let i=null;async function n(n){n.addEventListener("end",s),e.xr.setReferenceSpaceType("local"),await e.xr.setSession(n),r.textContent="STOP AR",t.domOverlay.root.style.display="",i=n}function s(){i.removeEventListener("end",s),r.textContent="START AR",t.domOverlay.root.style.display="none",i=null}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="START AR",r.onmouseenter=function(){r.style.opacity="1.0"},r.onmouseleave=function(){r.style.opacity="0.5"},r.onclick=function(){null===i?navigator.xr.requestSession("immersive-ar",t).then(n):i.end()}}():(i(),r.textContent="AR NOT SUPPORTED")}).catch(function(e){i(),console.warn("Exception when trying to call xr.isSessionSupported",e),r.textContent="AR NOT ALLOWED"}),r;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",n(e),e}}}.createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:i})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,t=this._viewer.getPluginByType("Ground");t&&(t.groundReflection=!1,t.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),t.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const t=e.getHitTestResults(this._hitTestSource);if(!t.length)return;const r=t[0],i=this._touchInputHelper.getHitPoint(r);i&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(i):this._touchInputHelper.goalPosition.y=i.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",i))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const t=this._viewer.scene.modelRoot,r=this._viewer.scene.activeCamera,n=null===(e=this._xrManager)||void 0===e?void 0:e.getCamera(),s=n.cameras[0]||n;this._removePlacementBox();const o=this._viewer.scene.getBounds(!0,!0);o.getSize(new i.Pa4).length()>.01&&(this._placementBox=new Gb(o,n,this.placeOnWall),t.add(this._placementBox),this._placementBox.show=!1);const a=n.getWorldDirection(new i.Pa4);t.rotation.y=Math.atan2(-a.x,-a.z)-0,r.cameraObject.zoom=s.zoom,r.cameraObject.near=s.near,r.cameraObject.far=s.far,r.cameraObject.isPerspectiveCamera?(r.cameraObject.fov=s.fov,r.cameraObject.aspect=s.viewport.width/s.viewport.height):console.warn("Perspective camera required."),r.cameraObject.updateProjectionMatrix(),t.position.set(0,0,0);const l=t.userData.arScale||1;t.scale.set(l,l,l),t.position.copy(n.position).add(a.multiplyScalar(5)),t.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const t=this._viewer.scene.activeCamera;t.position.copy(this._preXRState.cameraPosition),t.target.copy(this._preXRState.cameraTarget),t.cameraObject.up.copy(this._preXRState.cameraUp),t.cameraObject.near=this._preXRState.cameraNear,t.cameraObject.far=this._preXRState.cameraFar,t.cameraObject.isPerspectiveCamera&&(void 0!==this._preXRState.cameraFov&&(t.cameraObject.fov=this._preXRState.cameraFov),void 0!==this._preXRState.cameraAspect&&(t.cameraObject.aspect=this._preXRState.cameraAspect)),t.positionUpdated(!1),t.targetUpdated(!0),t.cameraObject.updateMatrixWorld(!0),t.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}zb.PluginType="WEBXR_ARPlugin";const Vb=new c({vertexShader:n.vertexShader,fragmentShader:"\n    uniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\t// gl_FragColor = vec4(1,0,1,1);\n\t\t\tgl_FragColor = texel;\n\n\t\t}\n\t\t",uniforms:n.uniforms});async function Qb(e,t){if(e.createWriter){const r=await e.createWriter();return await r.write(0,t),void(await r.close())}const r=await e.createWritable();await r.write(t),await r.close()}async function Hb(e,t){const r={};return t&&(r.writable=!0,r.mode="readwrite"),"granted"===await e.queryPermission(r)||"granted"===await e.requestPermission(r)}Vb.renderToScreen=!1,Vb.useExistingRenderTarget=!0,Vb.clear=!1;class Wb extends r{constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=(e=>{var t;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const e=new Blob(this._currentRecording,{type:this._options.mimeType});null===(t=this._recordingCallback)||void 0===t||t.call(this,e)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})}),this._onstart=(e=>{var t;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&(null===(t=this._recorder)||void 0===t||t.pause())}),this._onresume=(e=>{if(!this.stepMode)return;const t=()=>{var e;"recording"===this._state&&(null===(e=this._recorder)||void 0===e||e.pause())},r=Math.min(this._resumeSyncTime-kt(),0)+1e3/this._options.frameRate;r>0?Tc(r).then(t):t()}),this._onpause=(e=>{}),this._ondataavailable=(e=>{e.data&&e.data.size>0&&this._currentRecording.push(e.data)}),this._onerror=(e=>{this._state="error",this._console.error(e),this.dispatchEvent({type:"error",error:e}),this._recorder=void 0}),this._canvas=e;const r=null==t?void 0:t.mimeType;this._options={mimeType:r||"auto",frameRate:30},this._setOptions(t||this._options)}_setOptions(e){var t,r;Object.assign(this._options,e),this._options.mimeType&&"auto"!==this._options.mimeType||(this._options.mimeType=null!==(t=Wb.GetSupportedMimeTypes([],["h264"],!0))&&void 0!==t?t:Wb.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(null===(r=this._options.mimeType)||void 0===r?void 0:r.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return"recording"===this._state}start(){var e,t,r;if("recording"===this._state)return void this._console.log("Already recording canvas");if("error"===this._state&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return"paused"===this._state?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if("paused"===this._state)return this.dispatchEvent({type:"starting"}),void(this._state="recording");const i={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,null===(e=i.mimeType)||void 0===e?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const e=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),r=null===(t=e.getVideoTracks())||void 0===t?void 0:t[0];this._track=r,this._recorder=new window.MediaRecorder(e,i),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",null===(r=this._recorder)||void 0===r||r.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const t=await(null==e?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._state="recording",this._onstart({})}).catch(e=>{this._onerror({detail:e})})}async requestFrame(){if("recording"!==this._state)return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=kt(),this._track.requestFrame(),this._recorder.resume())}pause(){"paused"!==this._state&&"stopped"!==this._state&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){"stopped"!==this._state&&("error"!==this._state?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&"error"!==this._state?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([e,t])=>await(await fetch(t)).blob())),r=[];for(let i=0;i<e.length;i++){const n=await this._imgDirectory.getFileHandle(e[i][0],{create:!0});r.push(Qb(n,t[i]))}await Promise.all(r)}static GetSupportedMimeTypes(e,t,r=!1){if(!window.MediaRecorder)return r?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter(t=>!e||e.length<1||e.includes(t)),n=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(e=>!t||t.length<1||t.includes(e)),s=[];return i.forEach(e=>{const t=`video/${e}`;n.forEach(e=>{[`${t};codecs=${e}`,`${t};codecs:${e}`,`${t};codecs=${e.toUpperCase()}`,`${t};codecs:${e.toUpperCase()}`,`${t}`].forEach(e=>{MediaRecorder.isTypeSupported(e)&&s.push(e)})})}),r?s.length>0?s[0]:void 0:s}}var qb=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class Xb extends oo{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=(()=>{var e,t,r;if(this.convergeMode&&(null===(e=this._recorder)||void 0===e?void 0:e.isRecording())){const e=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=(null===(r=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Progressive"))||void 0===r?void 0:r.isConverged())||!1,e&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}}),this._postRender=(()=>{var e,t,r;if((null===(e=this._recorder)||void 0===e?void 0:e.isRecording())&&(!this.convergeMode||(null===(r=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Progressive"))||void 0===r?void 0:r.isConverged(!0)))){const e=()=>{var e;return null===(e=this._recorder)||void 0===e?void 0:e.requestFrame()};this.convergeMode?Tc(1).then(e):e()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)}),this._refreshUi=(()=>{var e,t;null===(t=null===(e=this._uiConfig)||void 0===e?void 0:e.children)||void 0===t||t.map(e=>x(e)).flat(2).forEach(e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e)})})}get recorder(){return this._recorder}isRecording(){var e,t;return null!==(t=null===(e=this._recorder)||void 0===e?void 0:e.isRecording())&&void 0!==t&&t}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new Wb(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var t,r,i;this.dirty=e,null===(t=this._viewer)||void 0===t||t.setDirty(),null===(i=null===(r=this._uiConfig)||void 0===r?void 0:r.children)||void 0===i||i.map(e=>x(e)).flat(2).forEach(e=>{var t;return null===(t=null==e?void 0:e.uiRefresh)||void 0===t?void 0:t.call(e)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),null===(t=this._recorder)||void 0===t||t.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&!1===(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(null===(e=this.recorder)||void 0===e?void 0:e.isRecording())return new Promise((e,t)=>{var r;return null===(r=this.recorder)||void 0===r?void 0:r.stop(e)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var t,r;return null!==(r=null===(t=e.recorder)||void 0===t?void 0:t.state)&&void 0!==r?r:"not initialized"},set value(e){}},{type:"button",get label(){var t;return(null===(t=e.recorder)||void 0===t?void 0:t.isRecording())?"Stop Recording":"Start Recording"},value:()=>{var t;(null===(t=e.recorder)||void 0===t?void 0:t.isRecording())?this.stopRecording().then(e=>{if(e){console.log(e);const t=e.type.split(";")[0].split("/").pop()||"mp4";At(e,"test."+t)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var t,r;return!!(null===(t=e.recorder)||void 0===t?void 0:t.isRecording())||!(null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("CameraViews"))},value:()=>{var e,t;null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("CameraViews"))||void 0===t||t.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var t,r,i,n;return!!(null===(t=e.recorder)||void 0===t?void 0:t.isRecording())||!(null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("CameraViews"))||!(null===(n=null===(i=this._viewer)||void 0===i?void 0:i.getPluginByType("GLTFAnimation"))||void 0===n?void 0:n.animations.length)},value:()=>{var e,t,r,i;const n="playing"===(null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("GLTFAnimation"))||void 0===t?void 0:t.animationState);null===(i=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("CameraViews"))||void 0===i||i.recordAllViews(()=>{var e,t;null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("GLTFAnimation"))||void 0===t||t.playAnimation()}).then(()=>{var e,t;n||null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("GLTFAnimation"))||void 0===t||t.stopAnimation()})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var t,r,i;return!!(null===(t=e.recorder)||void 0===t?void 0:t.isRecording())||!(null===(i=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("GLTFAnimation"))||void 0===i?void 0:i.animations.length)},value:async()=>{var t,r;if(null===(t=e.recorder)||void 0===t?void 0:t.isRecording())return;const i=null===(r=this._viewer)||void 0===r?void 0:r.getPluginByType("GLTFAnimation");if(!i)return;if(!this.startRecording())return;let n=!1;i.loopAnimations&&(n=!0),n&&(i.loopAnimations=!1),await i.playAnimation();const s=await this.stopRecording();if(n&&(i.loopAnimations=!0),s){const e=s.type.split(";")[0].split("/").pop()||"mp4";At(s,"test."+e)}}}]}}}Xb.PluginType="CanvasRecorder",qb([M(Xb.prototype.refreshRecorderOptions),Ce()],Xb.prototype,"convergeMode",void 0),qb([M(Xb.prototype.refreshRecorderOptions),Ce()],Xb.prototype,"mimeType",void 0),qb([M(Xb.prototype.refreshRecorderOptions),Ce()],Xb.prototype,"videoFrameRate",void 0);var Yb=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const Kb=new i.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"});Kb.depthTest=!1;const Jb=new i.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"});Jb.depthTest=!1;class Zb extends hu{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new i.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(qc)}async onAdded(e){const t=e.renderer.createTarget({type:i.ywz,format:i.wk1,encoding:i.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:i.wem,magFilter:i.wem});t.texture.name="groundContactDepthTexture";const r=new i.lRF({depthPacking:i.z81});r.onBeforeCompile=function(e){e.uniforms.opacity.value=1,e.fragmentShader=`\n\t\t\t\t\t\t${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}\n\t\t\t\t\t`};const n=new po(t,r,new i.Ilk(0,0,0),0);this._depthPass=n,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer)return;if(!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:i.ywz,format:i.wk1,encoding:i.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:i.wem,magFilter:i.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(Kb.uniforms.h.value=t*this.blurAmount/256,Jb.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:Kb,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:Jb,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new i.Pa4)),this.shadowCamera.setRotationFromEuler(new i.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const t=super._refreshMaterial();return this._material?(this._material.alphaMap=(null===(e=this._depthPass)||void 0===e?void 0:e.target.texture)||null,t&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1),t):t}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}Zb.PluginType="ContactShadowGroundPlugin",Yb([M(Zb.prototype.refreshOptions),Ce()],Zb.prototype,"contactShadows",void 0),Yb([Ce(),M(Zb.prototype._setDirty)],Zb.prototype,"blurAmount",void 0),Yb([Ce(),M(Zb.prototype._refreshShadowCameraFrustum)],Zb.prototype,"shadowScale",void 0),Yb([Ce(),M(Zb.prototype._refreshShadowCameraFrustum)],Zb.prototype,"shadowHeight",void 0);const $b=new i.cPb(45,1,.1,1e3);function ey(e,t,r,n=7,s=new i.Pa4(0,0,1.5)){r=null!=r?r:e.scene.modelObject;const o=(new k).expandByObject(null!=r?r:t,!0,!0),a=o.getCenter(new i.Pa4),l=o.getSize(new i.Pa4);$b.position.copy(a).add(s.clone().multiplyScalar(Math.max(l.x,l.y,l.z))),$b.lookAt(a),t&&t.traverseVisible(e=>{e.layers.enable(n)}),n>0?$b.layers.set(n):$b.layers.enableAll();const c=null==t?void 0:t.visible;t&&(t.visible=!0),e.renderer.rendererObject.setRenderTarget(null),e.renderer.rendererObject.render(r,$b);const u=e.renderer.rendererObject.domElement.toDataURL("image/png");return t&&(t.visible=c,t.traverseVisible(e=>{e.layers.disable(n)}),$b.layers.enableAll()),e.setDirty(),u}class ty{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new i.Kj0(new i.xo$(1)),cube:new i.Kj0(new i.DvJ(1,1,1)),cylinder:new i.Kj0(new i.fHI(.5,.5,1))};const t=new i.xsS;this._channel=7;const r=new i.vmT(16777215,4473924,1);r.position.set(0,10,0),r.layers.set(this._channel),t.add(r),this._lights.push(r),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const r=this.shapes[t]||new i.Kj0(new i.xo$(1));r.material=e.materialObject,r.geometry.attributes.tangent||r.geometry.computeTangents(),this._scene.add(r),this._scene.environment=this.viewer.scene.getEnvironment();const n=r.material.envMapIntensity;"number"==typeof n&&(r.material.envMapIntensity=Math.max(n,2));const s=ey(this.viewer,r,this._scene,this._channel,new i.Pa4(0,0,1.5));return"number"==typeof n&&(r.material.envMapIntensity=n),this._scene.remove(r),r.material=void 0,s}}class ry extends oo{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=(()=>{var e,t;this.enabled&&(null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e))}),this.dependencies=[so],this.variations=[],this._selectedMaterial=(()=>{var e,t;return(null===(t=null===(e=this._picking)||void 0===e?void 0:e.getSelectedObject())||void 0===t?void 0:t.material)||void 0}),this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Zt).filter(e=>e.endsWith("Map"))].map(e=>({label:e,value:e}))},...(null===(e=this.getSelectedVariation())||void 0===e?void 0:e.materials.map(e=>e.uiConfig?Object.assign(e.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const e=this.getSelectedVariation();e&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(e.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const e=this.getSelectedVariation();e&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(e)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var t,r;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Picking"),this._previewGenerator=new ty(this._viewer),null===(r=this._picking)||void 0===r||r.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){var t,r;return null===(t=this._previewGenerator)||void 0===t||t.dispose(),this._previewGenerator=void 0,null===(r=this._picking)||void 0===r||r.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation(null===(e=this._selectedMaterial())||void 0===e?void 0:e.uuid)||this.findVariation(null===(t=this._selectedMaterial())||void 0===t?void 0:t.name)}applyVariation(e,t){var r,i;const n=e.materials.find(e=>e.uuid===t);if(n){const t=null===(i=null===(r=this._viewer)||void 0===r?void 0:r.getManager())||void 0===i?void 0:i.materials;let s=null==t?void 0:t.findMaterialsByName(e.uuid);(!s||s.length<1)&&(s=[null==t?void 0:t.findMaterial(e.uuid)]),s.forEach(e=>{if(!e)return;const t=e.name;e.copyProps(n),e.name=t})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var t;const r=null===(t=null==e?void 0:e.clone)||void 0===t?void 0:t.call(e);if(e&&r){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t||this.variations.push(t={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),t.materials.push(r),this.refreshUi()}}}ry.PluginType="MaterialConfiguratorBasePlugin",function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ce()],ry.prototype,"variations",void 0);const iy=(e,t=!0)=>{const r=(new xe).set(e);return t&&r.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${r.getHexString()}'/%3E%3C/svg%3E%0A`},ny=(e,t=!0)=>{const r=(new xe).set(e);return t&&r.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${r.getHexString()}'/%3E%3C/svg%3E%0A`},sy=e=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${e}%3C/text%3E%3C/svg%3E%0A`,oy=async(e,t)=>Ft(await St(e),t),ay=async(e,t)=>await oy(e,t).then(e=>e.toDataURL("image/png"));class ly{static _initialize(){this._inited=!0,Ct(E`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,t,r,i,n,s,o){var a;this._inited||this._initialize();const l=Dt(),c=l?.15:.25,u=l?1.5:2.5,p=Et({classList:["customContextGrid"],addToBody:!1,innerHTML:`\n            <div class="customContextGridHeading"> ${t} </div>\n            `});p.style.top=n+"px",p.style.left=i+"px",p.style.gap=c+"rem",p.style.width=(u+c)*r-c+"rem",p.dataset.tag=e;for(const h of s){const e=Et({classList:["customContextGridItems"],addToBody:!1,innerHTML:`\n            <img src="${h.image}" class="customContextGridItemImage">\n            `});e.style.width=u+"rem",e.style.height=u+"rem",p.appendChild(e),e.onclick=(()=>{var e;return null===(e=h.onClick)||void 0===e?void 0:e.call(h,h.id)}),o(e,h)}return null===(a=this.Elements)||void 0===a||a.push(p),p}static RemoveAll(e){if(e){const t=this.Elements.filter(t=>t.dataset.tag===e);for(const e of t)e.remove();this.Elements=this.Elements.filter(t=>t.dataset.tag!==e)}else{for(const e of this.Elements)e.remove();this.Elements=[]}}static RebuildUi(e){if(0===this.Elements.length)return;e||(e=document.body);for(const r of this.Elements)r.remove();let t=20;for(const r of this.Elements)r.style.top=t+"px",e.appendChild(r),t+=r.clientHeight+20}}function cy(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function uy(e){return e instanceof cy(e).Element||e instanceof Element}function py(e){return e instanceof cy(e).HTMLElement||e instanceof HTMLElement}function hy(e){return"undefined"!=typeof ShadowRoot&&(e instanceof cy(e).ShadowRoot||e instanceof ShadowRoot)}ly.Elements=[],ly._inited=!1;var dy=Math.max,fy=Math.min,gy=Math.round;function my(e,t){void 0===t&&(t=!1);var r=e.getBoundingClientRect(),i=1,n=1;if(py(e)&&t){var s=e.offsetHeight,o=e.offsetWidth;o>0&&(i=gy(r.width)/o||1),s>0&&(n=gy(r.height)/s||1)}return{width:r.width/i,height:r.height/n,top:r.top/n,right:r.right/i,bottom:r.bottom/n,left:r.left/i,x:r.left/i,y:r.top/n}}function _y(e){var t=cy(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function vy(e){return e?(e.nodeName||"").toLowerCase():null}function xy(e){return((uy(e)?e.ownerDocument:e.document)||window.document).documentElement}function Ay(e){return my(xy(e)).left+_y(e).scrollLeft}function by(e){return cy(e).getComputedStyle(e)}function yy(e){var t=by(e),r=t.overflow,i=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+n+i)}function wy(e,t,r){void 0===r&&(r=!1);var i,n,s=py(t),o=py(t)&&function(e){var t=e.getBoundingClientRect(),r=gy(t.width)/e.offsetWidth||1,i=gy(t.height)/e.offsetHeight||1;return 1!==r||1!==i}(t),a=xy(t),l=my(e,o),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(s||!s&&!r)&&(("body"!==vy(t)||yy(a))&&(c=(i=t)!==cy(i)&&py(i)?{scrollLeft:(n=i).scrollLeft,scrollTop:n.scrollTop}:_y(i)),py(t)?((u=my(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):a&&(u.x=Ay(a))),{x:l.left+c.scrollLeft-u.x,y:l.top+c.scrollTop-u.y,width:l.width,height:l.height}}function Ey(e){var t=my(e),r=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:i}}function Sy(e){return"html"===vy(e)?e:e.assignedSlot||e.parentNode||(hy(e)?e.host:null)||xy(e)}function Cy(e,t){var r;void 0===t&&(t=[]);var i=function e(t){return["html","body","#document"].indexOf(vy(t))>=0?t.ownerDocument.body:py(t)&&yy(t)?t:e(Sy(t))}(e),n=i===(null==(r=e.ownerDocument)?void 0:r.body),s=cy(i),o=n?[s].concat(s.visualViewport||[],yy(i)?i:[]):i,a=t.concat(o);return n?a:a.concat(Cy(Sy(o)))}function My(e){return["table","td","th"].indexOf(vy(e))>=0}function Ty(e){return py(e)&&"fixed"!==by(e).position?e.offsetParent:null}function Iy(e){for(var t=cy(e),r=Ty(e);r&&My(r)&&"static"===by(r).position;)r=Ty(r);return r&&("html"===vy(r)||"body"===vy(r)&&"static"===by(r).position)?t:r||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&py(e)&&"fixed"===by(e).position)return null;var r=Sy(e);for(hy(r)&&(r=r.host);py(r)&&["html","body"].indexOf(vy(r))<0;){var i=by(r);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return r;r=r.parentNode}return null}(e)||t}var ky="top",Dy="bottom",Py="right",By="left",Ry="auto",Ly=[ky,Dy,Py,By],Oy="start",Fy="end",Uy="clippingParents",Ny="viewport",jy="popper",Gy="reference",zy=Ly.reduce(function(e,t){return e.concat([t+"-"+Oy,t+"-"+Fy])},[]),Vy=[].concat(Ly,[Ry]).reduce(function(e,t){return e.concat([t,t+"-"+Oy,t+"-"+Fy])},[]),Qy="beforeRead",Hy="read",Wy="afterRead",qy="beforeMain",Xy="main",Yy="afterMain",Ky="beforeWrite",Jy="write",Zy="afterWrite",$y=[Qy,Hy,Wy,qy,Xy,Yy,Ky,Jy,Zy];function ew(e){var t=new Map,r=new Set,i=[];return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){r.has(e.name)||function e(n){r.add(n.name),[].concat(n.requires||[],n.requiresIfExists||[]).forEach(function(i){if(!r.has(i)){var n=t.get(i);n&&e(n)}}),i.push(n)}(e)}),i}var tw={placement:"bottom",modifiers:[],strategy:"absolute"};function rw(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function iw(e){void 0===e&&(e={});var t=e,r=t.defaultModifiers,i=void 0===r?[]:r,n=t.defaultOptions,s=void 0===n?tw:n;return function(e,t,r){void 0===r&&(r=s);var n,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},tw,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,u={state:a,setOptions:function(r){var n="function"==typeof r?r(a.options):r;p(),a.options=Object.assign({},s,a.options,n),a.scrollParents={reference:uy(e)?Cy(e):e.contextElement?Cy(e.contextElement):[],popper:Cy(t)};var o,c,h=function(e){var t=ew(e);return $y.reduce(function(e,r){return e.concat(t.filter(function(e){return e.phase===r}))},[])}((o=[].concat(i,a.options.modifiers),c=o.reduce(function(e,t){var r=e[t.name];return e[t.name]=r?Object.assign({},r,t,{options:Object.assign({},r.options,t.options),data:Object.assign({},r.data,t.data)}):t,e},{}),Object.keys(c).map(function(e){return c[e]})));return a.orderedModifiers=h.filter(function(e){return e.enabled}),a.orderedModifiers.forEach(function(e){var t=e.name,r=e.options,i=void 0===r?{}:r,n=e.effect;if("function"==typeof n){var s=n({state:a,name:t,instance:u,options:i});l.push(s||function(){})}}),u.update()},forceUpdate:function(){if(!c){var e=a.elements,t=e.reference,r=e.popper;if(rw(t,r)){a.rects={reference:wy(t,Iy(r),"fixed"===a.options.strategy),popper:Ey(r)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach(function(e){return a.modifiersData[e.name]=Object.assign({},e.data)});for(var i=0;i<a.orderedModifiers.length;i++)if(!0!==a.reset){var n=a.orderedModifiers[i],s=n.fn,o=n.options,l=void 0===o?{}:o,p=n.name;"function"==typeof s&&(a=s({state:a,options:l,name:p,instance:u})||a)}else a.reset=!1,i=-1}}},update:(n=function(){return new Promise(function(e){u.forceUpdate(),e(a)})},function(){return o||(o=new Promise(function(e){Promise.resolve().then(function(){o=void 0,e(n())})})),o}),destroy:function(){p(),c=!0}};if(!rw(e,t))return u;function p(){l.forEach(function(e){return e()}),l=[]}return u.setOptions(r).then(function(e){!c&&r.onFirstUpdate&&r.onFirstUpdate(e)}),u}}var nw=iw(),sw={passive:!0},ow={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,r=e.instance,i=e.options,n=i.scroll,s=void 0===n||n,o=i.resize,a=void 0===o||o,l=cy(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach(function(e){e.addEventListener("scroll",r.update,sw)}),a&&l.addEventListener("resize",r.update,sw),function(){s&&c.forEach(function(e){e.removeEventListener("scroll",r.update,sw)}),a&&l.removeEventListener("resize",r.update,sw)}},data:{}};function aw(e){return e.split("-")[0]}function lw(e){return e.split("-")[1]}function cw(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function uw(e){var t,r=e.reference,i=e.element,n=e.placement,s=n?aw(n):null,o=n?lw(n):null,a=r.x+r.width/2-i.width/2,l=r.y+r.height/2-i.height/2;switch(s){case ky:t={x:a,y:r.y-i.height};break;case Dy:t={x:a,y:r.y+r.height};break;case Py:t={x:r.x+r.width,y:l};break;case By:t={x:r.x-i.width,y:l};break;default:t={x:r.x,y:r.y}}var c=s?cw(s):null;if(null!=c){var u="y"===c?"height":"width";switch(o){case Oy:t[c]=t[c]-(r[u]/2-i[u]/2);break;case Fy:t[c]=t[c]+(r[u]/2-i[u]/2)}}return t}var pw={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,r=e.name;t.modifiersData[r]=uw({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},hw={top:"auto",right:"auto",bottom:"auto",left:"auto"};function dw(e){var t,r=e.popper,i=e.popperRect,n=e.placement,s=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,u=e.roundOffsets,p=e.isFixed,h=o.x,d=void 0===h?0:h,f=o.y,g=void 0===f?0:f,m="function"==typeof u?u({x:d,y:g}):{x:d,y:g};d=m.x,g=m.y;var _=o.hasOwnProperty("x"),v=o.hasOwnProperty("y"),x=By,A=ky,b=window;if(c){var y=Iy(r),w="clientHeight",E="clientWidth";y===cy(r)&&"static"!==by(y=xy(r)).position&&"absolute"===a&&(w="scrollHeight",E="scrollWidth"),(n===ky||(n===By||n===Py)&&s===Fy)&&(A=Dy,g-=(p&&y===b&&b.visualViewport?b.visualViewport.height:y[w])-i.height,g*=l?1:-1),n!==By&&(n!==ky&&n!==Dy||s!==Fy)||(x=Py,d-=(p&&y===b&&b.visualViewport?b.visualViewport.width:y[E])-i.width,d*=l?1:-1)}var S,C=Object.assign({position:a},c&&hw),M=!0===u?function(e){var t=e.x,r=e.y,i=window.devicePixelRatio||1;return{x:gy(t*i)/i||0,y:gy(r*i)/i||0}}({x:d,y:g}):{x:d,y:g};return d=M.x,g=M.y,l?Object.assign({},C,((S={})[A]=v?"0":"",S[x]=_?"0":"",S.transform=(b.devicePixelRatio||1)<=1?"translate("+d+"px, "+g+"px)":"translate3d("+d+"px, "+g+"px, 0)",S)):Object.assign({},C,((t={})[A]=v?g+"px":"",t[x]=_?d+"px":"",t.transform="",t))}var fw={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,r=e.options,i=r.gpuAcceleration,n=void 0===i||i,s=r.adaptive,o=void 0===s||s,a=r.roundOffsets,l=void 0===a||a,c={placement:aw(t.placement),variation:lw(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,dw(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,dw(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},gw={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var r=t.styles[e]||{},i=t.attributes[e]||{},n=t.elements[e];py(n)&&vy(n)&&(Object.assign(n.style,r),Object.keys(i).forEach(function(e){var t=i[e];!1===t?n.removeAttribute(e):n.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach(function(e){var i=t.elements[e],n=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:r[e]).reduce(function(e,t){return e[t]="",e},{});py(i)&&vy(i)&&(Object.assign(i.style,s),Object.keys(n).forEach(function(e){i.removeAttribute(e)}))})}},requires:["computeStyles"]},mw={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,r=e.options,i=e.name,n=r.offset,s=void 0===n?[0,0]:n,o=Vy.reduce(function(e,r){return e[r]=function(e,t,r){var i=aw(e),n=[By,ky].indexOf(i)>=0?-1:1,s="function"==typeof r?r(Object.assign({},t,{placement:e})):r,o=s[0],a=s[1];return o=o||0,a=(a||0)*n,[By,Py].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}(r,t.rects,s),e},{}),a=o[t.placement],l=a.x,c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=o}},_w={left:"right",right:"left",bottom:"top",top:"bottom"};function vw(e){return e.replace(/left|right|bottom|top/g,function(e){return _w[e]})}var xw={start:"end",end:"start"};function Aw(e){return e.replace(/start|end/g,function(e){return xw[e]})}function bw(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&hy(r)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function yw(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function ww(e,t){return t===Ny?yw(function(e){var t=cy(e),r=xy(e),i=t.visualViewport,n=r.clientWidth,s=r.clientHeight,o=0,a=0;return i&&(n=i.width,s=i.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(o=i.offsetLeft,a=i.offsetTop)),{width:n,height:s,x:o+Ay(e),y:a}}(e)):uy(t)?function(e){var t=my(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(t):yw(function(e){var t,r=xy(e),i=_y(e),n=null==(t=e.ownerDocument)?void 0:t.body,s=dy(r.scrollWidth,r.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=dy(r.scrollHeight,r.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),a=-i.scrollLeft+Ay(e),l=-i.scrollTop;return"rtl"===by(n||r).direction&&(a+=dy(r.clientWidth,n?n.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}(xy(e)))}function Ew(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Sw(e,t){return t.reduce(function(t,r){return t[r]=e,t},{})}function Cw(e,t){void 0===t&&(t={});var r=t,i=r.placement,n=void 0===i?e.placement:i,s=r.boundary,o=void 0===s?Uy:s,a=r.rootBoundary,l=void 0===a?Ny:a,c=r.elementContext,u=void 0===c?jy:c,p=r.altBoundary,h=void 0!==p&&p,d=r.padding,f=void 0===d?0:d,g=Ew("number"!=typeof f?f:Sw(f,Ly)),m=u===jy?Gy:jy,_=e.rects.popper,v=e.elements[h?m:u],x=function(e,t,r){var i="clippingParents"===t?function(e){var t=Cy(Sy(e)),r=["absolute","fixed"].indexOf(by(e).position)>=0&&py(e)?Iy(e):e;return uy(r)?t.filter(function(e){return uy(e)&&bw(e,r)&&"body"!==vy(e)}):[]}(e):[].concat(t),n=[].concat(i,[r]),s=n[0],o=n.reduce(function(t,r){var i=ww(e,r);return t.top=dy(i.top,t.top),t.right=fy(i.right,t.right),t.bottom=fy(i.bottom,t.bottom),t.left=dy(i.left,t.left),t},ww(e,s));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}(uy(v)?v:v.contextElement||xy(e.elements.popper),o,l),A=my(e.elements.reference),b=uw({reference:A,element:_,strategy:"absolute",placement:n}),y=yw(Object.assign({},_,b)),w=u===jy?y:A,E={top:x.top-w.top+g.top,bottom:w.bottom-x.bottom+g.bottom,left:x.left-w.left+g.left,right:w.right-x.right+g.right},S=e.modifiersData.offset;if(u===jy&&S){var C=S[n];Object.keys(E).forEach(function(e){var t=[Py,Dy].indexOf(e)>=0?1:-1,r=[ky,Dy].indexOf(e)>=0?"y":"x";E[e]+=C[r]*t})}return E}var Mw={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var n=r.mainAxis,s=void 0===n||n,o=r.altAxis,a=void 0===o||o,l=r.fallbackPlacements,c=r.padding,u=r.boundary,p=r.rootBoundary,h=r.altBoundary,d=r.flipVariations,f=void 0===d||d,g=r.allowedAutoPlacements,m=t.options.placement,_=aw(m),v=l||(_!==m&&f?function(e){if(aw(e)===Ry)return[];var t=vw(e);return[Aw(e),t,Aw(t)]}(m):[vw(m)]),x=[m].concat(v).reduce(function(e,r){return e.concat(aw(r)===Ry?function(e,t){void 0===t&&(t={});var r=t,i=r.placement,n=r.boundary,s=r.rootBoundary,o=r.padding,a=r.flipVariations,l=r.allowedAutoPlacements,c=void 0===l?Vy:l,u=lw(i),p=u?a?zy:zy.filter(function(e){return lw(e)===u}):Ly,h=p.filter(function(e){return c.indexOf(e)>=0});0===h.length&&(h=p);var d=h.reduce(function(t,r){return t[r]=Cw(e,{placement:r,boundary:n,rootBoundary:s,padding:o})[aw(r)],t},{});return Object.keys(d).sort(function(e,t){return d[e]-d[t]})}(t,{placement:r,boundary:u,rootBoundary:p,padding:c,flipVariations:f,allowedAutoPlacements:g}):r)},[]),A=t.rects.reference,b=t.rects.popper,y=new Map,w=!0,E=x[0],S=0;S<x.length;S++){var C=x[S],M=aw(C),T=lw(C)===Oy,I=[ky,Dy].indexOf(M)>=0,k=I?"width":"height",D=Cw(t,{placement:C,boundary:u,rootBoundary:p,altBoundary:h,padding:c}),P=I?T?Py:By:T?Dy:ky;A[k]>b[k]&&(P=vw(P));var B=vw(P),R=[];if(s&&R.push(D[M]<=0),a&&R.push(D[P]<=0,D[B]<=0),R.every(function(e){return e})){E=C,w=!1;break}y.set(C,R)}if(w)for(var L=function(e){var t=x.find(function(t){var r=y.get(t);if(r)return r.slice(0,e).every(function(e){return e})});if(t)return E=t,"break"},O=f?3:1;O>0&&"break"!==L(O);O--);t.placement!==E&&(t.modifiersData[i]._skip=!0,t.placement=E,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Tw(e,t,r){return dy(e,fy(t,r))}var Iw={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,i=e.name,n=r.mainAxis,s=void 0===n||n,o=r.altAxis,a=void 0!==o&&o,l=r.boundary,c=r.rootBoundary,u=r.altBoundary,p=r.padding,h=r.tether,d=void 0===h||h,f=r.tetherOffset,g=void 0===f?0:f,m=Cw(t,{boundary:l,rootBoundary:c,padding:p,altBoundary:u}),_=aw(t.placement),v=lw(t.placement),x=!v,A=cw(_),b="x"===A?"y":"x",y=t.modifiersData.popperOffsets,w=t.rects.reference,E=t.rects.popper,S="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,C="number"==typeof S?{mainAxis:S,altAxis:S}:Object.assign({mainAxis:0,altAxis:0},S),M=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,T={x:0,y:0};if(y){if(s){var I,k="y"===A?ky:By,D="y"===A?Dy:Py,P="y"===A?"height":"width",B=y[A],R=B+m[k],L=B-m[D],O=d?-E[P]/2:0,F=v===Oy?w[P]:E[P],U=v===Oy?-E[P]:-w[P],N=t.elements.arrow,j=d&&N?Ey(N):{width:0,height:0},G=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},z=G[k],V=G[D],Q=Tw(0,w[P],j[P]),H=x?w[P]/2-O-Q-z-C.mainAxis:F-Q-z-C.mainAxis,W=x?-w[P]/2+O+Q+V+C.mainAxis:U+Q+V+C.mainAxis,q=t.elements.arrow&&Iy(t.elements.arrow),X=q?"y"===A?q.clientTop||0:q.clientLeft||0:0,Y=null!=(I=null==M?void 0:M[A])?I:0,K=B+W-Y,J=Tw(d?fy(R,B+H-Y-X):R,B,d?dy(L,K):L);y[A]=J,T[A]=J-B}if(a){var Z,$="x"===A?ky:By,ee="x"===A?Dy:Py,te=y[b],re="y"===b?"height":"width",ie=te+m[$],ne=te-m[ee],se=-1!==[ky,By].indexOf(_),oe=null!=(Z=null==M?void 0:M[b])?Z:0,ae=se?ie:te-w[re]-E[re]-oe+C.altAxis,le=se?te+w[re]+E[re]-oe-C.altAxis:ne,ce=d&&se?function(e,t,r){var i=Tw(ae,te,r);return i>r?r:i}(0,0,le):Tw(d?ae:ie,te,d?le:ne);y[b]=ce,T[b]=ce-te}t.modifiersData[i]=T}},requiresIfExists:["offset"]},kw={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,r=e.state,i=e.name,n=e.options,s=r.elements.arrow,o=r.modifiersData.popperOffsets,a=aw(r.placement),l=cw(a),c=[By,Py].indexOf(a)>=0?"height":"width";if(s&&o){var u=function(e,t){return Ew("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Sw(e,Ly))}(n.padding,r),p=Ey(s),h="y"===l?ky:By,d="y"===l?Dy:Py,f=r.rects.reference[c]+r.rects.reference[l]-o[l]-r.rects.popper[c],g=o[l]-r.rects.reference[l],m=Iy(s),_=m?"y"===l?m.clientHeight||0:m.clientWidth||0:0,v=f/2-g/2,x=u[h],A=_-p[c]-u[d],b=_/2-p[c]/2+v,y=Tw(x,b,A),w=l;r.modifiersData[i]=((t={})[w]=y,t.centerOffset=y-b,t)}},effect:function(e){var t=e.state,r=e.options.element,i=void 0===r?"[data-popper-arrow]":r;null!=i&&("string"!=typeof i||(i=t.elements.popper.querySelector(i)))&&bw(t.elements.popper,i)&&(t.elements.arrow=i)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Dw(e,t,r){return void 0===r&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function Pw(e){return[ky,Py,Dy,By].some(function(t){return e[t]>=0})}var Bw={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,r=e.name,i=t.rects.reference,n=t.rects.popper,s=t.modifiersData.preventOverflow,o=Cw(t,{elementContext:"reference"}),a=Cw(t,{altBoundary:!0}),l=Dw(o,i),c=Dw(a,n,s),u=Pw(l),p=Pw(c);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:p},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":p})}},Rw=iw({defaultModifiers:[ow,pw,fw,gw,mw,Mw,Iw,kw,Bw]}),Lw="tippy-content",Ow="tippy-arrow",Fw="tippy-svg-arrow",Uw={passive:!0,capture:!0},Nw=function(){return document.body};function jw(e,t,r){if(Array.isArray(e)){var i=e[t];return null==i?Array.isArray(r)?r[t]:r:i}return e}function Gw(e,t){var r={}.toString.call(e);return 0===r.indexOf("[object")&&r.indexOf(t+"]")>-1}function zw(e,t){return"function"==typeof e?e.apply(void 0,t):e}function Vw(e,t){return 0===t?e:function(i){clearTimeout(r),r=setTimeout(function(){e(i)},t)};var r}function Qw(e){return[].concat(e)}function Hw(e,t){-1===e.indexOf(t)&&e.push(t)}function Ww(e){return[].slice.call(e)}function qw(e){return Object.keys(e).reduce(function(t,r){return void 0!==e[r]&&(t[r]=e[r]),t},{})}function Xw(){return document.createElement("div")}function Yw(e){return["Element","Fragment"].some(function(t){return Gw(e,t)})}function Kw(e,t){e.forEach(function(e){e&&(e.style.transitionDuration=t+"ms")})}function Jw(e,t){e.forEach(function(e){e&&e.setAttribute("data-state",t)})}function Zw(e,t,r){var i=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(t){e[i](t,r)})}function $w(e,t){for(var r=t;r;){var i;if(e.contains(r))return!0;r=null==r.getRootNode||null==(i=r.getRootNode())?void 0:i.host}return!1}var eE={isTouch:!1},tE=0;function rE(){eE.isTouch||(eE.isTouch=!0,window.performance&&document.addEventListener("mousemove",iE))}function iE(){var e=performance.now();e-tE<20&&(eE.isTouch=!1,document.removeEventListener("mousemove",iE)),tE=e}function nE(){var e,t=document.activeElement;if((e=t)&&e._tippy&&e._tippy.reference===e){var r=t._tippy;t.blur&&!r.state.isVisible&&t.blur()}}var sE=!("undefined"==typeof window||"undefined"==typeof document||!window.msCrypto),oE=Object.assign({appendTo:Nw,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),aE=Object.keys(oE);function lE(e){var t=(e.plugins||[]).reduce(function(t,r){var i,n=r.name,s=r.defaultValue;return n&&(t[n]=void 0!==e[n]?e[n]:null!=(i=oE[n])?i:s),t},{});return Object.assign({},e,t)}function cE(e,t){var r=Object.assign({},t,{content:zw(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(lE(Object.assign({},oE,{plugins:t}))):aE).reduce(function(t,r){var i=(e.getAttribute("data-tippy-"+r)||"").trim();if(!i)return t;if("content"===r)t[r]=i;else try{t[r]=JSON.parse(i)}catch(e){t[r]=i}return t},{})}(e,t.plugins));return r.aria=Object.assign({},oE.aria,r.aria),r.aria={expanded:"auto"===r.aria.expanded?t.interactive:r.aria.expanded,content:"auto"===r.aria.content?t.interactive?null:"describedby":r.aria.content},r}function uE(e,t){e.innerHTML=t}function pE(e){var t=Xw();return!0===e?t.className=Ow:(t.className=Fw,Yw(e)?t.appendChild(e):uE(t,e)),t}function hE(e,t){Yw(t.content)?(uE(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?uE(e,t.content):e.textContent=t.content)}function dE(e){var t=e.firstElementChild,r=Ww(t.children);return{box:t,content:r.find(function(e){return e.classList.contains(Lw)}),arrow:r.find(function(e){return e.classList.contains(Ow)||e.classList.contains(Fw)}),backdrop:r.find(function(e){return e.classList.contains("tippy-backdrop")})}}function fE(e){var t=Xw(),r=Xw();r.className="tippy-box",r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var i=Xw();function n(r,i){var n=dE(t),s=n.box,o=n.content,a=n.arrow;i.theme?s.setAttribute("data-theme",i.theme):s.removeAttribute("data-theme"),"string"==typeof i.animation?s.setAttribute("data-animation",i.animation):s.removeAttribute("data-animation"),i.inertia?s.setAttribute("data-inertia",""):s.removeAttribute("data-inertia"),s.style.maxWidth="number"==typeof i.maxWidth?i.maxWidth+"px":i.maxWidth,i.role?s.setAttribute("role",i.role):s.removeAttribute("role"),r.content===i.content&&r.allowHTML===i.allowHTML||hE(o,e.props),i.arrow?a?r.arrow!==i.arrow&&(s.removeChild(a),s.appendChild(pE(i.arrow))):s.appendChild(pE(i.arrow)):a&&s.removeChild(a)}return i.className=Lw,i.setAttribute("data-state","hidden"),hE(i,e.props),t.appendChild(r),r.appendChild(i),n(e.props,e.props),{popper:t,onUpdate:n}}fE.$$tippy=!0;var gE=1,mE=[],_E=[];function vE(e,t){void 0===t&&(t={});var r=oE.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",rE,Uw),window.addEventListener("blur",nE);var i,n=Object.assign({},t,{plugins:r}),s=(i=e,Yw(i)?[i]:Gw(i,"NodeList")?Ww(i):Array.isArray(i)?i:Ww(document.querySelectorAll(i))).reduce(function(e,t){var r=t&&function(e,t){var r,i,n,s,o,a,l,c,u=cE(e,Object.assign({},oE,lE(qw(t)))),p=!1,h=!1,d=!1,f=!1,g=[],m=Vw(q,u.interactiveDebounce),_=gE++,v=(c=u.plugins).filter(function(e,t){return c.indexOf(e)===t}),x={id:_,reference:e,popper:Xw(),popperInstance:null,props:u,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:v,clearDelayTimeouts:function(){clearTimeout(r),clearTimeout(i),cancelAnimationFrame(n)},setProps:function(t){if(!x.state.isDestroyed){B("onBeforeUpdate",[x,t]),H();var r=x.props,i=cE(e,Object.assign({},r,qw(t),{ignoreAttributes:!0}));x.props=i,Q(),r.interactiveDebounce!==i.interactiveDebounce&&(O(),m=Vw(q,i.interactiveDebounce)),r.triggerTarget&&!i.triggerTarget?Qw(r.triggerTarget).forEach(function(e){e.removeAttribute("aria-expanded")}):i.triggerTarget&&e.removeAttribute("aria-expanded"),L(),P(),y&&y(r,i),x.popperInstance&&(J(),$().forEach(function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)})),B("onAfterUpdate",[x,t])}},setContent:function(e){x.setProps({content:e})},show:function(){var e=x.state.isVisible,t=x.state.isDestroyed,r=!x.state.isEnabled,i=eE.isTouch&&!x.props.touch,n=jw(x.props.duration,0,oE.duration);if(!(e||t||r||i||T().hasAttribute("disabled")||(B("onShow",[x],!1),!1===x.props.onShow(x)))){if(x.state.isVisible=!0,M()&&(b.style.visibility="visible"),P(),j(),x.state.isMounted||(b.style.transition="none"),M()){var s=k();Kw([s.box,s.content],0)}var o,l,c;a=function(){var e;if(x.state.isVisible&&!f){if(f=!0,b.offsetHeight,b.style.transition=x.props.moveTransition,M()&&x.props.animation){var t=k(),r=t.box,i=t.content;Kw([r,i],n),Jw([r,i],"visible")}R(),L(),Hw(_E,x),null==(e=x.popperInstance)||e.forceUpdate(),B("onMount",[x]),x.props.animation&&M()&&z(n,function(){x.state.isShown=!0,B("onShown",[x])})}},l=x.props.appendTo,c=T(),(o=x.props.interactive&&l===Nw||"parent"===l?c.parentNode:zw(l,[c])).contains(b)||o.appendChild(b),x.state.isMounted=!0,J()}},hide:function(){var e=!x.state.isVisible,t=x.state.isDestroyed,r=!x.state.isEnabled,i=jw(x.props.duration,1,oE.duration);if(!(e||t||r)&&(B("onHide",[x],!1),!1!==x.props.onHide(x))){if(x.state.isVisible=!1,x.state.isShown=!1,f=!1,p=!1,M()&&(b.style.visibility="hidden"),O(),G(),P(!0),M()){var n=k(),s=n.box,o=n.content;x.props.animation&&(Kw([s,o],i),Jw([s,o],"hidden"))}R(),L(),x.props.animation?M()&&function(e,t){z(e,function(){!x.state.isVisible&&b.parentNode&&b.parentNode.contains(b)&&t()})}(i,x.unmount):x.unmount()}},hideWithInteractivity:function(e){I().addEventListener("mousemove",m),Hw(mE,m),m(e)},enable:function(){x.state.isEnabled=!0},disable:function(){x.hide(),x.state.isEnabled=!1},unmount:function(){x.state.isVisible&&x.hide(),x.state.isMounted&&(Z(),$().forEach(function(e){e._tippy.unmount()}),b.parentNode&&b.parentNode.removeChild(b),_E=_E.filter(function(e){return e!==x}),x.state.isMounted=!1,B("onHidden",[x]))},destroy:function(){x.state.isDestroyed||(x.clearDelayTimeouts(),x.unmount(),H(),delete e._tippy,x.state.isDestroyed=!0,B("onDestroy",[x]))}};if(!u.render)return x;var A=u.render(x),b=A.popper,y=A.onUpdate;b.setAttribute("data-tippy-root",""),b.id="tippy-"+x.id,x.popper=b,e._tippy=x,b._tippy=x;var w=v.map(function(e){return e.fn(x)}),E=e.hasAttribute("aria-expanded");return Q(),L(),P(),B("onCreate",[x]),u.showOnCreate&&ee(),b.addEventListener("mouseenter",function(){x.props.interactive&&x.state.isVisible&&x.clearDelayTimeouts()}),b.addEventListener("mouseleave",function(){x.props.interactive&&x.props.trigger.indexOf("mouseenter")>=0&&I().addEventListener("mousemove",m)}),x;function S(){var e=x.props.touch;return Array.isArray(e)?e:[e,0]}function C(){return"hold"===S()[0]}function M(){var e;return!(null==(e=x.props.render)||!e.$$tippy)}function T(){return l||e}function I(){var e,t,r=T().parentNode;return r&&null!=(t=Qw(r)[0])&&null!=(e=t.ownerDocument)&&e.body?t.ownerDocument:document}function k(){return dE(b)}function D(e){return x.state.isMounted&&!x.state.isVisible||eE.isTouch||s&&"focus"===s.type?0:jw(x.props.delay,e?0:1,oE.delay)}function P(e){void 0===e&&(e=!1),b.style.pointerEvents=x.props.interactive&&!e?"":"none",b.style.zIndex=""+x.props.zIndex}function B(e,t,r){var i;void 0===r&&(r=!0),w.forEach(function(r){r[e]&&r[e].apply(r,t)}),r&&(i=x.props)[e].apply(i,t)}function R(){var t=x.props.aria;if(t.content){var r="aria-"+t.content,i=b.id;Qw(x.props.triggerTarget||e).forEach(function(e){var t=e.getAttribute(r);if(x.state.isVisible)e.setAttribute(r,t?t+" "+i:i);else{var n=t&&t.replace(i,"").trim();n?e.setAttribute(r,n):e.removeAttribute(r)}})}}function L(){!E&&x.props.aria.expanded&&Qw(x.props.triggerTarget||e).forEach(function(e){x.props.interactive?e.setAttribute("aria-expanded",x.state.isVisible&&e===T()?"true":"false"):e.removeAttribute("aria-expanded")})}function O(){I().removeEventListener("mousemove",m),mE=mE.filter(function(e){return e!==m})}function F(t){if(!eE.isTouch||!d&&"mousedown"!==t.type){var r=t.composedPath&&t.composedPath()[0]||t.target;if(!x.props.interactive||!$w(b,r)){if(Qw(x.props.triggerTarget||e).some(function(e){return $w(e,r)})){if(eE.isTouch)return;if(x.state.isVisible&&x.props.trigger.indexOf("click")>=0)return}else B("onClickOutside",[x,t]);!0===x.props.hideOnClick&&(x.clearDelayTimeouts(),x.hide(),h=!0,setTimeout(function(){h=!1}),x.state.isMounted||G())}}}function U(){d=!0}function N(){d=!1}function j(){var e=I();e.addEventListener("mousedown",F,!0),e.addEventListener("touchend",F,Uw),e.addEventListener("touchstart",N,Uw),e.addEventListener("touchmove",U,Uw)}function G(){var e=I();e.removeEventListener("mousedown",F,!0),e.removeEventListener("touchend",F,Uw),e.removeEventListener("touchstart",N,Uw),e.removeEventListener("touchmove",U,Uw)}function z(e,t){var r=k().box;function i(e){e.target===r&&(Zw(r,"remove",i),t())}if(0===e)return t();Zw(r,"remove",o),Zw(r,"add",i),o=i}function V(t,r,i){void 0===i&&(i=!1),Qw(x.props.triggerTarget||e).forEach(function(e){e.addEventListener(t,r,i),g.push({node:e,eventType:t,handler:r,options:i})})}function Q(){var e;C()&&(V("touchstart",W,{passive:!0}),V("touchend",X,{passive:!0})),(e=x.props.trigger,e.split(/\s+/).filter(Boolean)).forEach(function(e){if("manual"!==e)switch(V(e,W),e){case"mouseenter":V("mouseleave",X);break;case"focus":V(sE?"focusout":"blur",Y);break;case"focusin":V("focusout",Y)}})}function H(){g.forEach(function(e){var t=e.node,r=e.eventType,i=e.handler,n=e.options;t.removeEventListener(r,i,n)}),g=[]}function W(e){var t,r=!1;if(x.state.isEnabled&&!K(e)&&!h){var i="focus"===(null==(t=s)?void 0:t.type);s=e,l=e.currentTarget,L(),!x.state.isVisible&&Gw(e,"MouseEvent")&&mE.forEach(function(t){return t(e)}),"click"===e.type&&(x.props.trigger.indexOf("mouseenter")<0||p)&&!1!==x.props.hideOnClick&&x.state.isVisible?r=!0:ee(e),"click"===e.type&&(p=!r),r&&!i&&te(e)}}function q(e){var t=e.target,r=T().contains(t)||b.contains(t);"mousemove"===e.type&&r||function(e,t){var r=t.clientX,i=t.clientY;return e.every(function(e){var t=e.popperRect,n=e.popperState,s=e.props.interactiveBorder,o=n.placement.split("-")[0],a=n.modifiersData.offset;if(!a)return!0;var l="bottom"===o?a.top.y:0,c="top"===o?a.bottom.y:0,u="right"===o?a.left.x:0,p="left"===o?a.right.x:0,h=t.top-i+l>s,d=i-t.bottom-c>s,f=t.left-r+u>s,g=r-t.right-p>s;return h||d||f||g})}($().concat(b).map(function(e){var t,r=null==(t=e._tippy.popperInstance)?void 0:t.state;return r?{popperRect:e.getBoundingClientRect(),popperState:r,props:u}:null}).filter(Boolean),e)&&(O(),te(e))}function X(e){K(e)||x.props.trigger.indexOf("click")>=0&&p||(x.props.interactive?x.hideWithInteractivity(e):te(e))}function Y(e){x.props.trigger.indexOf("focusin")<0&&e.target!==T()||x.props.interactive&&e.relatedTarget&&b.contains(e.relatedTarget)||te(e)}function K(e){return!!eE.isTouch&&C()!==e.type.indexOf("touch")>=0}function J(){Z();var t=x.props,r=t.popperOptions,i=t.placement,n=t.offset,s=t.getReferenceClientRect,o=t.moveTransition,l=M()?dE(b).arrow:null,c=s?{getBoundingClientRect:s,contextElement:s.contextElement||T()}:e,u=[{name:"offset",options:{offset:n}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(M()){var r=k().box;["placement","reference-hidden","escaped"].forEach(function(e){"placement"===e?r.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?r.setAttribute("data-"+e,""):r.removeAttribute("data-"+e)}),t.attributes.popper={}}}}];M()&&l&&u.push({name:"arrow",options:{element:l,padding:3}}),u.push.apply(u,(null==r?void 0:r.modifiers)||[]),x.popperInstance=Rw(c,b,Object.assign({},r,{placement:i,onFirstUpdate:a,modifiers:u}))}function Z(){x.popperInstance&&(x.popperInstance.destroy(),x.popperInstance=null)}function $(){return Ww(b.querySelectorAll("[data-tippy-root]"))}function ee(e){x.clearDelayTimeouts(),e&&B("onTrigger",[x,e]),j();var t=D(!0),i=S(),n=i[0],s=i[1];eE.isTouch&&"hold"===n&&s&&(t=s),t?r=setTimeout(function(){x.show()},t):x.show()}function te(e){if(x.clearDelayTimeouts(),B("onUntrigger",[x,e]),x.state.isVisible){if(!(x.props.trigger.indexOf("mouseenter")>=0&&x.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&p)){var t=D(!1);t?i=setTimeout(function(){x.state.isVisible&&x.hide()},t):n=requestAnimationFrame(function(){x.hide()})}}else G()}}(t,n);return r&&e.push(r),e},[]);return Yw(e)?s[0]:s}vE.defaultProps=oE,vE.setDefaultProps=function(e){Object.keys(e).forEach(function(t){oE[t]=e[t]})},vE.currentInput=eE,Object.assign({},gw,{effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow)}}),vE.setDefaultProps({render:fE});var xE=vE;class AE extends ry{async _refreshUi(){var e;if(!(await super._refreshUi()))return!1;ly.RemoveAll(AE.PluginType);for(const t of this.variations)ly.Create(AE.PluginType,t.title,5,20,0,t.materials.map(e=>{let r;if(t.preview.startsWith("generate:"))r=this._previewGenerator.generate(e,t.preview.split(":")[1]);else{const i=e[t.preview]||"#ff00ff";(r=i.image?Tt(i.image,100):void 0)||(r=ny(i,!0))}return{id:e.uuid,image:r,onClick:e=>this.applyVariation(t,e),tooltip:e.name||e.uuid}}),(e,t)=>xE(e,{placement:"bottom",content:t.tooltip}));return ly.RebuildUi(null===(e=this._viewer)||void 0===e?void 0:e.container),!0}}AE.PluginType="MaterialConfiguratorPlugin";class bE extends oo{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=(()=>{var e,t;this.enabled&&(null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0))}),this.dependencies=[so],this._selectedObject=(()=>{var e;return(null===(e=this._picking)||void 0===e?void 0:e.getSelectedObject())||void 0}),this._selectedMaterial=(()=>{var e;return(null===(e=this._selectedObject())||void 0===e?void 0:e.material)||void 0})}async onAdded(e){var t,r;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Picking"),this._previewGenerator=new ty(this._viewer),null===(r=this._picking)||void 0===r||r.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,r;return null===(t=this._previewGenerator)||void 0===t||t.dispose(),this._previewGenerator=void 0,null===(r=this._picking)||void 0===r||r.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}bE.PluginType="MaterialLibraryBasePlugin",function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ye("Enabled")],bE.prototype,"enabled",void 0);class yE extends bE{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:We(),children:[...nt(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(so).materials.getMaterialsOfType(null===(e=this._selectedMaterial())||void 0===e?void 0:e.typeSlug).map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return null===(e=this._selectedMaterial())||void 0===e?void 0:e.uuid},setValue:e=>{var t,r,i,n,s;const o=null===(i=null===(r=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(so))||void 0===r?void 0:r.materials)||void 0===i?void 0:i.findMaterial(e);if(o)if(this.replaceMaterial)null===(s=null===(n=this._selectedObject())||void 0===n?void 0:n.setMaterial)||void 0===s||s.call(n,o);else{const e=this._selectedMaterial();if(e){const t=e.name,r=e.uuid;e.copyProps(o),e.name=t,e.uuid=r,e.userData.uuid&&(e.userData.uuid=r)}}this._refreshUi()}}}]}}async _refreshUi(){var e,t,r,i;if(!(await super._refreshUi()))return!1;const n=[er.TypeSlug,ra.TypeSlug],s=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(so))||void 0===t?void 0:t.materials,o=n.map(e=>[e,null==s?void 0:s.getMaterialsOfType(e)]);ly.RemoveAll(yE.PluginType);for(const[a,l]of o)ly.Create(yE.PluginType,a,5,20,0,null===(r=l)||void 0===r?void 0:r.filter(e=>!e.userData.__runtimeMaterial).map(e=>{let t;const r="generate:sphere";if(r.startsWith("generate:"))t=this._previewGenerator.generate(e,r.split(":")[1]);else{const i=e[r]||"#ff00ff";(t=i.image?Tt(i.image,100):void 0)||(t=iy(i,!0))}return{id:e.uuid,image:t,onClick:e=>{const t=null==s?void 0:s.findMaterial(e);if(console.log(null==t?void 0:t.name),t){const e=t.userData.__appliedMeshes;if(null==e?void 0:e.size){const t=e.keys().next().value;t.dispatchEvent({type:"select",value:t})}}},tooltip:e.name||e.uuid}}),(e,t)=>xE(e,{placement:"bottom",content:t.tooltip}));return ly.RebuildUi(null===(i=this._viewer)||void 0===i?void 0:i.container),!0}}function wE(e,t,r,n){e.traverse(e=>{e&&(e.userData.cloneRotI=t,e.userData.rotationCount=r,e.userData.rotationAxis=n,e.addEventListener("beforeRender",t=>(function(e,t){var r;t&&(null===(r=t.map)||void 0===r?void 0:r.isTexture)&&(t.extraUniformsToUpload||(t.extraUniformsToUpload={}),t.extraUniformsToUpload.uvTransform||(t.extraUniformsToUpload.uvTransform={value:new i.Vkp}),t.extraUniformsToUpload.uvTransform.value.setUvTransform(t.map.offset.x*t.map.repeat.x*e.userData.cloneRotI/(e.userData.rotationCount||1),t.map.offset.y*t.map.repeat.y*e.userData.cloneRotI/(e.userData.rotationCount||1),t.map.repeat.x,t.map.repeat.y,t.map.rotation,t.map.center.x,t.map.center.y))})(e,t.material)))})}function EE(e,t,r,i="x"){var n;if(e.userData.rotationCount>1&&!e.userData.rotationRoot)return e;const s=e.parent;if(!s)throw new Error("No parent");if(e.userData.cloneParent){const t=e.userData.cloneParent;if(!(e=s.children.find(e=>t===e.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",t,s),e}let o=s.children.filter(t=>{var r;return(null===(r=t.userData)||void 0===r?void 0:r.cloneParent)===e.uuid}).sort((e,t)=>e.userData.cloneRotI-t.userData.cloneRotI);if(e.userData.rotationCount===t&&t===o.length&&void 0===r&&e.userData.rotationAxis===i)return e;if(null==r&&(r=null!==(n=e.userData.rotationSkips)&&void 0!==n?n:[]),r!==e.userData.rotationSkips&&(e.userData.rotationSkips=[...r]),wE(e,0,t,i),e.userData.rotationRoot=!0,e.visible=!0,t<=o.length){for(let e=t-1;e<o.length;e++)s.remove(o[e]),o[e].traverse(e=>e.userData={__disposed:!0});o=o.slice(0,t)}for(let a=1;a<t;a++){const n=a<=o.length?o[a-1]:e.clone();n.rotation.copy(e.rotation),n.rotation[i]+=a/t*Math.PI*2,wE(n,a,t,i),a>o.length&&s.add(n),n.visible=!r.includes(a)}return e.visible=!r.includes(0),e}yE.PluginType="MaterialLibraryPlugin",function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ye("Replace Material")],yE.prototype,"replaceMaterial",void 0);var SE,CE=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let ME=SE=class extends oo{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPluginByType("Picking"))||void 0===t||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var e,t,r,i,n,s,o,a,l;if(!this.enabled)return;const c=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("Picking"))||void 0===t?void 0:t.getSelectedObject();if(!c)return void(null===(i=(r=this.uiConfig).uiRefresh)||void 0===i||i.call(r,"postFrame",!0));const u=c.userData.rotationRoot&&null!==(n=c.userData.rotationCount)&&void 0!==n?n:1;this.rotations=u,this.skips=null!==(o=null===(s=c.userData.rotationSkips)||void 0===s?void 0:s.join(","))&&void 0!==o?o:"",this.axis=c.userData.rotationAxis||"x",null===(l=(a=this.uiConfig).uiRefresh)||void 0===l||l.call(a,"postFrame",!0)}_paramsChanged(){var e,t,r,n,s,o;if(!this.enabled)return;const a=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("Picking"))||void 0===t?void 0:t.getSelectedObject();if(a){if(this.rotations>1||a.userData.rotationCount){const e=a.userData.rotationCount,t=EE(a,this.rotations,this.skips.split(",").map(e=>parseInt(e)).filter(e=>isFinite(e)),this.axis),o=null==t?void 0:t.userData.rotationCount;if(o&&o!==e){const e=[];null==t||t.traverseAncestors(t=>{e.push(t)});for(const t of e)if(t.userData.autoScaled){X(t),null===(r=this._viewer)||void 0===r||r.resetCamera({rootObject:t,centerOffset:new i.Pa4(4,4,4)});break}}a.parent&&!a.userData.__disposed||null===(s=null===(n=this._viewer)||void 0===n?void 0:n.getPluginByType("Picking"))||void 0===s||s.setSelectedObject(t,!0)}null===(o=this._viewer)||void 0===o||o.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};ME.PluginType="ObjectRotationPlugin",CE([Ce(),Ye("Enabled"),M(SE.prototype._paramsChanged)],ME.prototype,"enabled",void 0),CE([Je("Rotation Count",[1,100],1,e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("Picking"))||void 0===r?void 0:r.getSelectedObject())||!e.rotations}})),M(SE.prototype._paramsChanged)],ME.prototype,"rotations",void 0),CE([$e("Axis",["x","y","z"].map(e=>({label:e})),e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("Picking"))||void 0===r?void 0:r.getSelectedObject())||!e.rotations}})),M(SE.prototype._paramsChanged)],ME.prototype,"axis",void 0),CE([tt("Rotation Skips",e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("Picking"))||void 0===r?void 0:r.getSelectedObject())||!e.rotations}})),M(SE.prototype._paramsChanged)],ME.prototype,"skips",void 0),ME=SE=CE([ot("Object Rotations")],ME);var TE,IE=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let kE=TE=class extends oo{constructor(e=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,r)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <map_fragment>");for(const t of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${t}>`,i.WdD[t].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",i.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?"#ifdef USE_BUMPMAP\nmat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){\n#if defined( TANGENTSPACE_NORMALMAP ) && 0 \nvec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);\n#else\nvec2 texOffs=1./bumpMapSize;\n#if PARALLAX_NORMAL_MAP_QUALITY > 0\nfloat hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);\n#else\nfloat h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);\n#endif\nreturn normalize(vec3(deltaH/texOffs,1.));\n#endif\n}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}\n#pragma unroll_loop_end\nbestBumpHeight+=bumpHeightStep;\n#pragma unroll_loop_start\nfor(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}\n#pragma unroll_loop_end\nbestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);\n#ifdef FLIP_SIDED\nnormal=-normal;\n#endif\nreturn parallaxUv;}\n#endif \n\n".replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+(null===(t=e.materialObject.bumpMap)||void 0===t?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},r)=>{for(const[i,n]of Object.entries(this._defines)){const e="number"==typeof n?n:n?1:0;t.defines[i]!==e&&(t.defines[i]=e,t.needsUpdate=!0)}}},this.dependencies=[so],this.enabled=e,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var e,t,r;null===(t=null===(e=this._bumpMapExtension)||void 0===e?void 0:e.setDirty)||void 0===t||t.call(e),null===(r=this._viewer)||void 0===r||r.setDirty()}async onAdded(e){var t,r;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.registerMaterialExtension(this._bumpMapExtension),super.onAdded(e)}async onRemove(e){var t,r;return null===(r=null===(t=e.getPlugin(so))||void 0===t?void 0:t.materials)||void 0===r||r.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(e)}};kE.PluginType="ReliefParallaxMapping",IE([M(TE.prototype._updateExtension),Ye("Enabled")],kE.prototype,"enabled",void 0),IE([M(TE.prototype._updateExtension),Ye("Debug Normals")],kE.prototype,"debugNormals",void 0),IE([M(TE.prototype._updateExtension),Ye("Debug Hit Height")],kE.prototype,"debugHitHeight",void 0),IE([V("PARALLAX_MAP_STEPS",void 0,!0,TE.prototype._updateExtension),Je("Step count",[1,32],1),Ce()],kE.prototype,"stepCount",void 0),IE([V("PARALLAX_MAP_B_STEPS",void 0,!0,TE.prototype._updateExtension),Je("Binary search steps",[1,8],1),Ce()],kE.prototype,"binaryStepCount",void 0),kE=TE=IE([ot("Parallax Mapping")],kE);var DE=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};class PE extends Ht{constructor(e,t,r,n=!1){super({vertexShader:Bo,fragmentShader:`\n\n${Lo}\n${Ro}\n${Oo}\n${Fo}\n${r}\n\n${Uo}\n\nvarying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\nvec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);\n#endif\nreturn vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}\n\n            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!n},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new i.yGw},screenSize:{value:new i.FM8},cameraPositionWorld:{value:new i.Pa4},cameraNearFar:{value:new i.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:n?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(e,t,r)=>{if(!e.defines.SSRTAO_ENABLED)return;const i="vec3 totalDiffuse =";e.fragmentShader=e.fragmentShader.replace(i,`\n\n            \n            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0\nvec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\nvec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);\n#endif\n#if defined( USE_ENVMAP )\nfloat dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;\n#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0\n#if !defined(SSR_ENABLED) || SSR_ENABLED < 1\nreflectedLight.indirectSpecular+=ssgiColor*material.specularColor;\n#endif\n#endif\n#endif\n#endif\n\n            \n            // reflectedLight.directDiffuse = vec3(0.);\n            // reflectedLight.indirectDiffuse = vec3(0.);\n            // reflectedLight.directSpecular = vec3(0.);\n            // reflectedLight.indirectSpecular = vec3(0.);\n            \n            \n${i}`),e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",""),e.vertexUvs=!0},onObjectRender:(e,t,r)=>{var i,n,s;this.materialExtension.extraUniforms.tSSGIMap.value=null===(i=this._target)||void 0===i?void 0:i.texture;const o=t.materialObject,a=!o.transparent&&o.transmission<.001;let l=this.enabled&&a&&(this.renderWithCamera||this._renderer.frameCount>1)&&!1!==r.userData.screenSpaceRendering&&!(null===(n=o.userData)||void 0===n?void 0:n.ssrtaoDisabled)&&!(null===(s=o.userData)||void 0===s?void 0:s.ssaoDisabled)?1:0;o.defines.SSRTAO_ENABLED!==l&&(o.defines.SSRTAO_ENABLED=l,o.needsUpdate=!0),l=this.material.defines.SSGI_ENABLED,o.defines.SSGI_ENABLED!==l&&(o.defines.SSGI_ENABLED=l,o.needsUpdate=!0),l=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==l&&(this.materialExtension.extraUniforms.tSSGIMap.value=l,o.needsUpdate=!0)},parsFragmentSnippet:e=>{var t;return w`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${U("tSSGIMap",null===(t=this._target)||void 0===t?void 0:t.texture,e.capabilities.isWebGL2)}

            ${jo}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:e=>{var t,r;return this.enabled?"1":"0"+(null===(r=null===(t=this._target)||void 0===t?void 0:t.texture)||void 0===r?void 0:r.encoding)},isCompatible:e=>{var t;return!(null===(t=e.materialObject.userData)||void 0===t?void 0:t.ssaoDisabled)&&e.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...nt(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=n,this.ssgiEnabled=n,this.bilateralPass=new Ho(this._target,r,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,t,r,i,n){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,r,i,n),this.smoothEnabled&&this.bilateralPass.render(e,t,r,i,n))}}DE([Ce()],PE.prototype,"bilateralPass",void 0),DE([Je("Intensity",[0,4]),Ce(),z()],PE.prototype,"intensity",void 0),DE([Je("Power",[0,3]),Ce(),z()],PE.prototype,"power",void 0),DE([Ye("Auto radius"),Ce(),z()],PE.prototype,"autoRadius",void 0),DE([Je("Object Radius",[.01,10]),Ce(),z()],PE.prototype,"objectRadius",void 0),DE([Je("Tolerance",[.1,5]),Ce(),z()],PE.prototype,"tolerance",void 0),DE([Je("Bias",[-.3,.3]),Ce(),z()],PE.prototype,"bias",void 0),DE([Je("Falloff",[1e-4,4]),Ce(),z()],PE.prototype,"falloff",void 0),DE([Je("Ray Count",[1,5],1),Ce(),z()],PE.prototype,"rayCount",void 0),DE([Je("Step count",[1,16],1),Ce(),V("RTAO_STEP_COUNT")],PE.prototype,"stepCount",void 0),DE([Ye("Smooth Enabled"),Ce()],PE.prototype,"smoothEnabled",void 0),DE([Ye("Render with Camera")],PE.prototype,"renderWithCamera",void 0);class BE extends Io{constructor(e=!0){super(),this.dependencies=[so,ho,Po],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var t,r;await super.onAdded(e),this.enabled=this._initEnabled,null===(r=(t=this.uiConfig).uiRefresh)||void 0===r||r.call(t,"postFrame",!0)}get enabled(){var e,t;return(null===(t=null===(e=this.passes.ssrtgi)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.enabled)||!1}set enabled(e){var t;(null===(t=this.passes.ssrtgi)||void 0===t?void 0:t.passObject)&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,r,i;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let n=!1;return null===(t=this._viewer)||void 0===t||t.getPluginByType("debug"),[ao(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new PE(e.renderer,this._rtgiTarget,null!==(i=null===(r=e.getPlugin(ho))||void 0===r?void 0:r.getUnpackSnippet())&&void 0!==i?i:"",!0),update:()=>{var t;let r=this.enabled;if(r&&!n){const e=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("SSAO");(null==e?void 0:e.enabled)&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?e.enabled=!1:(this.enabled=!1,r=!1))}n=r,r&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ho)])}},()=>[e.getPlugin(ho),e.getPlugin(Po),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get uiConfig(){var e,t,r,i,n;const s=null!==(r=null===(t=null===(e=this.passes.ssrtgi)||void 0===e?void 0:e.passObject)||void 0===t?void 0:t.uiConfig)&&void 0!==r?r:{};return null===(n=null===(i=s.children)||void 0===i?void 0:i.map(e=>x(e)))||void 0===n||n.flat(2).forEach(e=>e&&(e.onChange=this.setDirty)),s}}BE.PluginType="SSGI";class RE extends oo{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[so],this.variations=[],this._selectedSwitchNode=(()=>{var e;const t=null===(e=this._picking)||void 0===e?void 0:e.getSelectedObject();if(!t)return;const r=this.variations.map(e=>e.name);let i;return t.traverseAncestors(e=>{i||r.includes(e.name)&&(i=e)}),i}),this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,r;await super.onAdded(e),this._picking=null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("Picking"),null===(r=this._picking)||void 0===r||r.addEventListener("selectedObjectChanged",()=>{var e,t;null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const e of this.variations){const t=this._viewer.scene.getObjectByName(e.name);if(!t||t.children.length<1)return;e.selected||(e.selected=t.children[0].name||t.children[0].uuid);for(const r of t.children)r.visible=(r.name||r.uuid)===e.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const e of this.variations){const t=this._viewer.scene.getObjectByName(e.name);if(!t||t.children.length<1)return;for(const e of t.children)e.visible=!0}}),this.addEventListener("deserialize",async()=>{await Tc(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t,r;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,ly.RemoveAll(RE.PluginType);for(const e of this.variations){const t=this._viewer.scene.getObjectByName(e.name);t?(t.children.length<1&&console.warn("SwitchNode does not have enough children",e),ly.Create(RE.PluginType,e.title,Math.min(5,t.children.length),20,0,t.children.map(t=>{const r=e.camView,n=new i.Pa4((r.includes("right")?1:0)-(r.includes("left")?1:0),(r.includes("top")?1:0)-(r.includes("bottom")?1:0),(r.includes("front")?1:0)-(r.includes("back")?1:0));e.camDistance||(e.camDistance=1);const s=ey(this._viewer,t,void 0,7,n.multiplyScalar(.5*e.camDistance));return{id:t.uuid,image:s,onClick:()=>{var r;e.selected=t.name||t.uuid,null===(r=this._viewer)||void 0===r||r.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:t.name||t.uuid}}),(e,t)=>xE(e,{placement:"bottom",content:t.tooltip}))):console.warn("no object found for variation, skipping",e)}ly.RebuildUi(null===(e=this._viewer)||void 0===e?void 0:e.container),null===(r=(t=this.uiConfig).uiRefresh)||void 0===r||r.call(t)}}}RE.PluginType="SwitchNodePlugin",function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);s>3&&o&&Object.defineProperty(t,r,o)}([Ce()],RE.prototype,"variations",void 0);class LE extends i.u9r{constructor(e,t,r=32,n=64,s=!1,o=new i.FM8(1,1),a="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:r,tubularSegments:n,closed:s,primary:a,shapeScale:o.clone()};const l=t.computeFrenetFrames(n,s);this.frames=l;const c=new i.Pa4,u=new i.Pa4,p=new i.Pa4,h=new i.FM8;let d=new i.Pa4;const f=[],g=[],m=[],_=e.getSpacedPoints(r);for(const i of _)i.multiply(o);!function(){for(let e=0;e<n;e++)x(e);x(!1===s?n:0),function(){for(let e=0;e<=n;e++)for(let t=0;t<=r;t++)h.x=e/n,h.y=t/r,g.push(h.x,h.y)}(),function(){const e="shape"===a,t=e?r:n,i=e?n:r;for(let n=1;n<=t;n++)for(let t=1;t<=i;t++){const[i,s]=e?[t,n]:[n,t],o=(r+1)*(i-1)+(s-1),a=(r+1)*i+(s-1),l=(r+1)*i+s,c=(r+1)*(i-1)+s;m.push(o,a,c),m.push(a,l,c)}}()}(),this.setIndex(m),this.setAttribute("position",new i.a$l(f,3)),this.setAttribute("uv",new i.a$l(g,2)),this.computeVertexNormals();const v=this.attributes.normal;function x(e){d=t.getPointAt(e/n,d);const i=l.normals[e],s=l.binormals[e];for(let t=0;t<=r;t++){const e=_[t%r];u.set(0,0,0).addScaledVector(i,e.x).addScaledVector(s,e.y),c.copy(d).add(u),f.push(c.x,c.y,c.z)}}!function(){for(let t=1;t<r;t++){const e=t+n*(r+1);u.fromBufferAttribute(v,t),p.fromBufferAttribute(v,e),u.add(p).normalize(),v.setXYZ(t,u.x,u.y,u.z),v.setXYZ(e,u.x,u.y,u.z)}for(let t=1;t<n;t++){const e=t*(r+1),i=e+r;u.fromBufferAttribute(v,e),p.fromBufferAttribute(v,i),u.add(p).normalize(),v.setXYZ(e,u.x,u.y,u.z),v.setXYZ(i,u.x,u.y,u.z)}u.fromBufferAttribute(v,0),p.fromBufferAttribute(v,r),u.add(p);const e=n*(r+1);p.fromBufferAttribute(v,e),u.add(p),p.fromBufferAttribute(v,e+r),u.add(p),u.normalize(),v.setXYZ(0,u.x,u.y,u.z),v.setXYZ(r,u.x,u.y,u.z),v.setXYZ(e,u.x,u.y,u.z),v.setXYZ(e+r,u.x,u.y,u.z),v.needsUpdate=!0}()}createSplits(e){this.clearGroups();const t="shape"===this.parameters.primary?this.parameters.shapeSegments:this.parameters.tubularSegments,r=this.index.count,i=[...e,1].sort();let n=0,s=0;for(const o of i){const e=Math.round(t*o)*r/t;this.addGroup(n,e-n,s++),n=e}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var OE,FE=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let UE=OE=class extends oo{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new i.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=(async()=>{var e,t;const r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject();if(!r)return;let i=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!i)return;i=parseFloat(i);const n=new NE(0,0,i,i,0,2*Math.PI,!0,0);await this.extrudeObject(r,n)})}async onAdded(e){await super.onAdded(e)}static CreateCurve(e,t){var r,i;if("circle"===e)return new NE(0,0,null!==(r=t.radius)&&void 0!==r?r:1,null!==(i=t.radius)&&void 0!==i?i:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(e,t,r=this.shapeSegments,n=this.tubularSegments,s=this.shapeScale,o=this.materialSplits.split(",").map(e=>parseFloat(e.trim())),a=this.horizontalSplits){var l,c,u,p,h,d,f,g;if(e.userData.isExtrudedTube,e.userData._extrudeSource){const t=e.userData._extrudeSource;if(!(e=null===(l=e.parent)||void 0===l?void 0:l.children.find(e=>t===e.uuid)))return void console.warn("Could not find extrude source with uuid",t)}if(e.userData.extrudedObject){const t=e.userData.extrudedObject,r=null===(c=e.parent)||void 0===c?void 0:c.children.find(e=>t===e.uuid);r&&(r.removeFromParent(),r.geometry.dispose(),r.geometry=null,r.material=null),delete e.userData.extrudedObject}const m=e.geometry;if(!m)return void(null===(u=this._viewer)||void 0===u||u.alert("Extrude: No geometry to extrude"));const _=[e.material];let v;try{const i=OE.ConvertGeometryToFlatShape(m);(v=new LE(i,t,r,n,!0,s,a?"shape":"path")).computeBoundingBox(),v.createSplits(o)}catch(e){return void(null===(p=this._viewer)||void 0===p||p.alert("string"==typeof e?e:null==e?void 0:e.message))}_[0].color.set(16777215);for(let i=_.length;i<v.groups.length;i++){const e=_[0].clone();_.push(e),e.color.set(16777215*Math.random())}const x=new i.Kj0(v,_);x.userData._extrudeSource=e.uuid,x.userData.isExtrudedTube=!0,e.visible=!1,e.userData.bboxVisible=!1,x.name=e.name+"_extruded";const A=await(null===(f=null===(d=null===(h=this._viewer)||void 0===h?void 0:h.getManager())||void 0===d?void 0:d.importer)||void 0===f?void 0:f.processImportedSingle(x,{autoCenter:!1,autoScale:!1}));A&&(null===(g=e.parent)||void 0===g||g.add(A.modelObject),e.userData.extrudedObject=A.modelObject.uuid,A.dispatchEvent({type:"select",ui:!0,value:A}))}static ExtrudeShape(e,t,r,n,s,o,a,l){const c=new LE(e,n,t,r,!0,new i.FM8(s,o),l?"shape":"path");c.computeBoundingBox(),c.createSplits(a);const u=new i.Kj0(c,[]);return u.userData.isExtrudedTube=!0,u}static ConvertGeometryToFlatShape(e,t=!0){if(e.userData.__planarShape)return e.userData.__planarShape;let r=e.attributes.position;if(!r)throw"no position attribute";if(r.count>500)throw"too large to extrude";const n=e;r=n.attributes.position,n.boundingBox||n.computeBoundingBox();const s=n.boundingBox.getSize(new i.Pa4),o=s.x<.001?"x":s.y<.001?"y":s.z<.001?"z":null;if(!o)throw"geometry is not axis aligned not planar";let a=[];for(let c=0;c<r.count;c++){const e=new i.FM8;"x"===o?e.set(r.getY(c),r.getZ(c)):"y"===o?e.set(r.getX(c),r.getZ(c)):e.set(r.getX(c),r.getY(c)),a.push(e)}if(t){let e=0;for(let t=0;t<a.length;t++)(a[t].x<a[e].x||a[t].x===a[e].x&&a[t].y<a[e].y)&&(e=t);0!==e&&(a=a.slice(e).concat(a.slice(0,e)))}const l=new i.bnF(a);return e.userData.__planarShape=l,l}};UE.PluginType="ShapeTubeExtrudePlugin",FE([Ye("Enabled")],UE.prototype,"enabled",void 0),FE([Je("Shape Segments (X)",[1,100],1,e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject())}}))],UE.prototype,"shapeSegments",void 0),FE([Je("Tube Segments (Y)",[1,100],1,e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject())}}))],UE.prototype,"tubularSegments",void 0),FE([Ze("Shape scale",[.01,10],.01,e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject())}}))],UE.prototype,"shapeScale",void 0),FE([tt("Material Splits",e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject())}}))],UE.prototype,"materialSplits",void 0),FE([Ye("Horizontal Splits",e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject())}}))],UE.prototype,"horizontalSplits",void 0),FE([et("Extrude Circle Tube",e=>({hidden:()=>{var t,r;return!(null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject())}}))],UE.prototype,"extrudeCirceTube",void 0),UE=OE=FE([ot("Extrude Tube Shapes")],UE);class NE extends i.Ny0{getPoint(e,t){return super.getPoint(e,t||new i.Pa4)}}class jE extends oo{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=(()=>{var e,t;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&(null===(e=this._viewer.getPluginByType("FrameFade"))||void 0===e||e.enable(jE.PluginType),this._fadeDisabled=!1));const r=kt()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=r-1/60);let i=r-this._lastFrameTime;this._lastFrameTime=r;const n=null===(t=this._viewer.getPluginByType("Progressive"))||void 0===t?void 0:t.postFrameConvergedRecordingDelta();if(n&&n>0&&(i=n),0!==n&&(!((i*=1e3)<=.001)&&(this._updaters.forEach(e=>{let t=i;e.time+t<0&&(t=-e.time),e.time+=t,Math.abs(t)>.001&&e.u(t)}),!this._fadeDisabled&&this.disableFrameFade))){const e=this._viewer.getPluginByType("FrameFade");e&&(e.disable(jE.PluginType),this._fadeDisabled=!0)}}),this.defaultDriver=(e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)})),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=We(),r={id:t,options:e,stop:()=>{var e,r,i;(null===(e=this.animations[t])||void 0===e?void 0:e._stop)?null===(i=null===(r=this.animations[t])||void 0===r?void 0:r._stop)||void 0===i||i.call(r):console.warn("Animation not started")}};return this.animations[t]=r,r.promise=new Promise((r,i)=>{const n={driver:this.defaultDriver,onComplete:()=>{var t;null===(t=e.onComplete)||void 0===t||t.call(e),r()},onStop:()=>{var t;null===(t=e.onStop)||void 0===t||t.call(e),r()},...e},s=Cc(n);this.animations[t]._stop=s.stop,this.animations[t].options=n}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}jE.PluginType="PopmotionPlugin";const GE=async e=>bt(await(await fetch(e)).blob());async function zE(e,t=GE){const r=e.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(r)for(const i of r){const r=await t(i);e=e.replace(i,r)}return e}function VE(e,t,{width:r,height:i},n=!0){const s=`\n<svg viewBox="0 0 ${r} ${i}" xmlns="http://www.w3.org/2000/svg">\n    <style>\n    ${t}\n    </style>\n    <foreignObject x="0" y="0" width="100%" height="100%">\n        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">\n            ${e}\n        </div>\n    </foreignObject>\n</svg>\n    `;return n?C(s):s}async function QE(e,t,r){const i=VE(e,t,r);return await oy(i,r)}async function HE(e,t,r){const i=VE(e,t,r);return await ay(i,r)}var WE,qE,XE=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const YE=e=>({onChange:t=>{t.last&&e.onChange()}});let KE=WE=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=(()=>{})}set(e){Object.assign(this,e)}reset(){const e=this.onChange;Object.assign(this,new WE),this.onChange=e}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};XE([tt("Text",YE)],KE.prototype,"text",void 0),XE([Je("Font Size",[2,400],1,YE)],KE.prototype,"fontSize",void 0),XE([Je("Width",[2,4096],1,YE)],KE.prototype,"width",void 0),XE([Je("Height",[2,4096],1,YE)],KE.prototype,"height",void 0),XE([Je("X Offset",[-1024,1024],1,YE)],KE.prototype,"xOffset",void 0),XE([Je("Y Offset",[-1024,1024],1,YE)],KE.prototype,"yOffset",void 0),XE([Je("V-Width",[2,4096],1,YE)],KE.prototype,"boxWidth",void 0),XE([Je("V-Height",[2,4096],1,YE)],KE.prototype,"boxHeight",void 0),XE([$e("Text Anchor",["start","middle","end"].map(e=>({label:e})),YE)],KE.prototype,"textAnchor",void 0),XE([tt("Font",YE)],KE.prototype,"fontFamily",void 0),XE([tt("Font Url",YE)],KE.prototype,"fontPath",void 0),XE([Ye("Mask Text",YE)],KE.prototype,"maskText",void 0),XE([Ye("Inner Shadow",YE)],KE.prototype,"innerShadow",void 0),XE([rt("Text Color",YE)],KE.prototype,"textColor",void 0),XE([rt("BG Fill",YE)],KE.prototype,"bgFillColor",void 0),XE([rt("SVG BG",YE)],KE.prototype,"svgBackground",void 0),KE=WE=XE([ot("Text SVG Options")],KE);const JE={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},ZE=e=>({hidden:()=>{const t=e.getSelected();return!t||!t.userData[$E.PluginType]}});let $E=qE=class extends oo{constructor(){super(),this.enabled=!0,this.getSelected=(()=>{var e,t;return null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("Picking"))||void 0===t?void 0:t.getSelectedObject()}),this.options=new KE,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(e){var t;await super.onAdded(e),null===(t=e.getPluginByType("Picking"))||void 0===t||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var e,t,r,i,n,s;if(!this.enabled)return;const o=this.getSelected();if(!o)return void(null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0));const a=o.userData[qE.PluginType];if(!a)return this.options.reset(),this._lastMeta=void 0,void(null===(i=(r=this.uiConfig).uiRefresh)||void 0===i||i.call(r,"postFrame",!0));this._lastMeta!==a&&(this.options.set(a),this._lastMeta=a),null===(s=(n=this.uiConfig).uiRefresh)||void 0===s||s.call(n,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const e=this.getSelected();e&&e.isMesh&&e.userData[qE.PluginType]&&this.updateText(e,this.options.toJSON())}async addTextToSelected(){var e;const t=this.getSelected();t&&t.isMesh?t.material?(t.userData[qE.PluginType]||!t.material.map||await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(t):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(e,t){return this.updateText(e,Object.assign(this.options.toJSON(),t))}async updateText(e,t){var r,i;if(!e.isMesh)return;if(!e.material)return void console.error("updateText: no material on mesh");let n=e.userData[qE.PluginType];n||(e.userData[qE.PluginType]=n={}),Object.assign(n,t);const s=e.material;s.map&&(s.map._isSimpleTextTexture&&s.map.dispose(),s.map=void 0),s.alphaMap&&(s.alphaMap._isSimpleTextTexture&&s.alphaMap.dispose(),s.alphaMap=void 0),s.bumpMap&&(s.bumpMap._isSimpleTextTexture&&s.bumpMap.dispose(),s.bumpMap=void 0);const o=await this.makeTextSvg(n);this.applyToMap&&(s.map=o),this.applyToAlphaMap&&(s.alphaMap=o,s.transparent=!0),this.applyToBumpMap&&(s.bumpMap=o),s.userData.inverseAlphaMap=this.inverseAlphaMap,s.setDirty(),s.needsUpdate=!0,null===(i=(r=this.uiConfig).uiRefresh)||void 0===i||i.call(r,"postFrame",!0)}async makeTextSvg(e){const t=e.fontFamily||"Arial",r=e.fontPath||this.fonts[t]||"";let n=e.style;if(r.length>0){const e=r.split("?")[0].split(".").pop()||"woff";n+="\n"+(r.length>0?`\n            @font-face {\n                font-family: ${t};\n                src: url(${r}) format(${JE[e]||e});\n            }`:"")}let s=function({text:e="Custom Text",svgBackground:t="#ffffff",xOffset:r=0,yOffset:i=0,width:n=1024,height:s=1024,boxWidth:o=1024,boxHeight:a=1024,fontFamily:l="",fontSize:c=32,maskText:u=!0,innerShadow:p=!0,bgFillColor:h="#000000",textColor:d="#ffffff",textAnchor:f="middle",style:g=""}){return`\n<svg style="background-color:${t}" width="${n}" height="${s}" viewBox="0 0 ${o} ${a}"\n xmlns="http://www.w3.org/2000/svg"\n xmlns:xlink="http://www.w3.org/1999/xlink">\n     <defs>\n        <style>\n        ${g}\n        </style>\n    </defs>\n\n    <g style="overflow:hidden; text-anchor: ${f}; font-size: ${c}px; font-family: ${l||"Arial"}">\n        <defs>\n\n`+(u?`\n<mask id="textMask">\n<text style="fill:white; font-size: ${c}px;" x="${r+o/2}" y="${a/2+i+c/4}" > ${e} </text>\n</mask>\n`:"")+"\n\n"+(p?'\n<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">\n<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>\n<feOffset in="blur" dx="1.5" dy="1.5"/>\n</filter>\n':"")+"\n\n        </defs>\n\n"+(u?'\n        <g mask="url(#textMask)">\n':"")+`\n\n        <rect x="0" y="0" width="${o}" height="${a}" style="fill:${h}"/>\n        <text style="${p?"filter: url(#innerShadow);":""} fill:${d};" x="${r+o/2}" y="${a/2+i+c/4}"> ${e} </text>\n\n`+(u?"\n        </g>\n":"")+"\n\n    </g>\n</svg>\n"}({...e,fontFamily:t,style:n});s=await zE(s,async e=>this._getAssetData(e)),s=C(s);const o=await this._viewer.getManager().importer.importSinglePath(s,{generateMipmaps:!1,minFilter:i.wem});return o._isSimpleTextTexture=!0,o.flipY=!1,o.needsUpdate=!0,o}async _getAssetData(e){var t,r;if(e.startsWith("http://www.w3.org"))return e;const i=null===(r=null===(t=this._viewer)||void 0===t?void 0:t.getManager())||void 0===r?void 0:r.importer;if(!i)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new Sm(i.loadingManager),processImported:!1};try{return await i.importPath(e,this._assetLoadOptions)}catch(e){return console.error(e),""}}};$E.PluginType="SimpleTextPlugin",XE([Xe(void 0,{params:ZE})],$E.prototype,"options",void 0),XE([Ye("Apply Map",ZE),M(qE.prototype._paramsChanged)],$E.prototype,"applyToMap",void 0),XE([Ye("Apply Bump Map",ZE),M(qE.prototype._paramsChanged)],$E.prototype,"applyToBumpMap",void 0),XE([Ye("Apply Alpha Map",ZE),M(qE.prototype._paramsChanged)],$E.prototype,"applyToAlphaMap",void 0),XE([Ye("Invert Alpha Map",ZE),M(qE.prototype._paramsChanged)],$E.prototype,"inverseAlphaMap",void 0),XE([et("Add Text",e=>({hidden:()=>!e.getSelected()}))],$E.prototype,"addTextToSelected",null),$E=qE=XE([ot("Simple Text")],$E);class eS{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class tS{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class rS{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new rS;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(e=>e.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,r=new Array;for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,r,t,r);return this.front&&(t=this.front.clipPolygons(t)),r=this.back?this.back.clipPolygons(r):[],t.concat(r)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],r=[];for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],this.polygons,this.polygons,t,r);t.length&&(this.front||(this.front=new rS),this.front.build(t)),r.length&&(this.back||(this.back=new rS),this.back.build(r))}}class iS{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new iS(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add((new iS).copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),r=t.x,i=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*s-r*a,this.z=r*o-i*s,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new i.Pa4(this.x,this.y,this.z)}}class nS{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new nS(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,r,i,n){let s=0;const o=[];for(let a=0;a<e.vertices.length;a++){const t=this.normal.dot(e.vertices[a].pos)-this.w,r=t<-nS.EPSILON?2:t>nS.EPSILON?1:0;s|=r,o.push(r)}switch(s){case 0:(this.normal.dot(e.plane.normal)>0?t:r).push(e);break;case 1:i.push(e);break;case 2:n.push(e);break;case 3:{const t=[],r=[];for(let i=0;i<e.vertices.length;i++){const n=(i+1)%e.vertices.length,s=o[i],a=o[n],l=e.vertices[i],c=e.vertices[n];if(2!=s&&t.push(l),1!=s&&r.push(2!=s?l.clone():l),3==(s|a)){const e=(this.w-this.normal.dot(l.pos))/this.normal.dot((new iS).copy(c.pos).sub(l.pos)),i=l.interpolate(c,e);t.push(i),r.push(i.clone())}}t.length>=3&&i.push(new sS(t,e.shared)),r.length>=3&&n.push(new sS(r,e.shared));break}}}static fromPoints(e,t,r){const i=(new iS).copy(t).sub(e).cross((new iS).copy(r).sub(e)).normalize();return new nS(i.clone(),i.dot(e))}}nS.EPSILON=1e-5;class sS{constructor(e,t){this.vertices=e,this.shared=t,this.plane=nS.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new sS(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class oS{constructor(e,t,r,i){this.pos=(new iS).copy(e),this.normal=(new iS).copy(t),this.uv=(new iS).copy(r),this.uv.z=0,i&&(this.color=(new iS).copy(i))}clone(){return new oS(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new oS(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class aS{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new aS;return t.polygons=e,t}static fromGeometry(e,t){let r=[];const i=e.attributes.position,n=e.attributes.normal,s=e.attributes.uv,o=e.attributes.color,a=e.groups;let l;if(e.index)l=e.index.array;else{l=new Array(i.array.length/i.itemSize|0);for(let e=0;e<l.length;e++)l[e]=e}const c=l.length/3|0;r=new Array(c);for(let u=0,p=0,h=l.length;u<h;u+=3,p++){const e=new Array(3);for(let t=0;t<3;t++){const r=l[u+t],a=3*r,c=2*r,p=i.array[a],h=i.array[a+1],d=i.array[a+2],f=n.array[a],g=n.array[a+1],m=n.array[a+2],_=null==s?void 0:s.array[c],v=null==s?void 0:s.array[c+1];e[t]=new oS(new iS(p,h,d),new iS(f,g,m),new iS(_,v,0),o&&new iS(o.array[c],o.array[c+1],o.array[c+2]))}if(void 0===t&&a&&a.length>0)for(const t of a)u>=t.start&&u<t.start+t.count&&(r[p]=new sS(e,t.materialIndex));else r[p]=new sS(e,t)}return aS.fromPolygons(r.filter(e=>!isNaN(e.plane.normal.x)))}static toGeometry(e,t){let r=0;const n=e.polygons;for(const i of n)r+=i.vertices.length-2;const s=new i.u9r,o=new eS(3*r*3),a=new eS(3*r*3),l=new tS(2*r*3);let c;const u=[],p=[];for(const i of n){const e=i.vertices,t=e.length;void 0!==i.shared&&(u[i.shared]||(u[i.shared]=[])),t&&void 0!==e[0].color&&(c||(c=new eS(3*r*3)));for(let r=3;r<=t;r++)(void 0===i.shared?p:u[i.shared]).push(o.top/3,o.top/3+1,o.top/3+2),o.write(e[0].pos),o.write(e[r-2].pos),o.write(e[r-1].pos),a.write(e[0].normal),a.write(e[r-2].normal),a.write(e[r-1].normal),l&&(l.write(e[0].uv),l.write(e[r-2].uv),l.write(e[r-1].uv)),c&&(c.write(e[0].color),c.write(e[r-2].color),c.write(e[r-1].color))}s.setAttribute("position",new i.TlE(o.array,3)),s.setAttribute("normal",new i.TlE(a.array,3)),l&&s.setAttribute("uv",new i.TlE(l.array,2)),c&&s.setAttribute("color",new i.TlE(c.array,3));for(let i=0;i<u.length;i++)void 0===u[i]&&(u[i]=[]);if(u.length){let e=[],t=0;for(let r=0;r<u.length;r++)s.addGroup(t,u[r].length,r),t+=u[r].length,e=e.concat(u[r]);s.addGroup(t,p.length,u.length),e=e.concat(p),s.setIndex(e)}const h=(new i.yGw).copy(t).invert();return s.applyMatrix4(h),s.computeBoundingSphere(),s.computeBoundingBox(),s}static fromMesh(e,t){const r=aS.fromGeometry(e.geometry,t),n=new i.Pa4,s=new i.Vkp;s.getNormalMatrix(e.matrix);for(let i=0;i<r.polygons.length;i++){const t=r.polygons[i];for(let r=0;r<t.vertices.length;r++){const i=t.vertices[r];i.pos.copy(n.copy(i.pos.toVector3()).applyMatrix4(e.matrix)),i.normal.copy(n.copy(i.normal.toVector3()).applyMatrix3(s))}}return r}static toMesh(e,t,r){const n=aS.toGeometry(e,t),s=new i.Kj0(n,r);return s.matrix.copy(t),s.matrix.decompose(s.position,s.quaternion,s.scale),s.rotation.setFromQuaternion(s.quaternion),s.updateMatrixWorld(),s.castShadow=s.receiveShadow=!0,s}static union(e,t){const r=aS.fromMesh(e),i=aS.fromMesh(t);return aS.toMesh(r.union(i),e.matrix,e.material)}static subtract(e,t){const r=aS.fromMesh(e),i=aS.fromMesh(t);return aS.toMesh(r.subtract(i),e.matrix,e.material)}static intersect(e,t){const r=aS.fromMesh(e),i=aS.fromMesh(t);return aS.toMesh(r.intersect(i),e.matrix,e.material)}clone(){const e=new aS;return e.polygons=this.polygons.map(e=>e.clone()).filter(e=>Number.isFinite(e.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new rS(this.clone().polygons),r=new rS(e.clone().polygons);return t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),aS.fromPolygons(t.allPolygons())}subtract(e){const t=new rS(this.clone().polygons),r=new rS(e.clone().polygons);return t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),aS.fromPolygons(t.allPolygons())}intersect(e){const t=new rS(this.clone().polygons),r=new rS(e.clone().polygons);return t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),aS.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return aS.toMesh(this,e,t)}toGeometry(e){return aS.toGeometry(this,e)}}var lS=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const cS=["union","subtract","intersect"];class uS extends oo{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Fc],this.rootMesh=new i.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),null===(t=e.getPlugin(Fc))||void 0===t||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,t;const r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject();r&&r.geometry&&(r.userData._isCSGMesh||(r.userData.csgBrush||(r.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&At(e,"csg."+e.ext)}async exportObject(){var e,t;const r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("AssetExporterPlugin"))||void 0===t?void 0:t.exporter;if(!r||!this.rootObject)return;const i=this.rootMesh.visible;this.rootMesh.visible=!0;const n=await r.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=i,n}_updateSelectedProperties(){var e,t;const r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject();r&&r.userData.csgBrush&&(r.userData.csgBrush.enabled=this.csgSelectedEnabled,r.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,t,r,i,n,s,o,a;const l=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(Fc))||void 0===t?void 0:t.getSelectedObject();l&&(this.csgSelectedEnabled=null!==(i=null===(r=l.userData.csgBrush)||void 0===r?void 0:r.enabled)&&void 0!==i&&i,this.csgSelectedOperation=null!==(s=null===(n=l.userData.csgBrush)||void 0===n?void 0:n.operation)&&void 0!==s?s:"union"),null===(a=null===(o=this.uiConfig)||void 0===o?void 0:o.uiRefresh)||void 0===a||a.call(o,"postFrame",!0)}_preFrame(){var e,t,r;if(!this.rootObject)return;if(!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const i=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,null===(e=this.rootObject)||void 0===e||e.modelObject.updateMatrixWorld(!0),(null!==(t=this.rootMesh.userData.dispose)&&void 0!==t?t:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(i)),this.rootMesh&&!this.rootMesh.parent&&(null===(r=this.rootObject)||void 0===r||r.modelObject.add(this.rootMesh)),this.showResult?(i.forEach(e=>{e[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(i.forEach(e=>{e[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const t=[];return null===(e=this._viewer)||void 0===e||e.scene.traverse(e=>{var r;e.isMesh&&e.geometry&&(null===(r=e.userData.csgBrush)||void 0===r?void 0:r.enabled)&&t.push([e,e.userData.csgBrush.operation])}),t}_sceneUpdate(e){var t,r;(null===(r=null===(t=null==e?void 0:e.object)||void 0===t?void 0:t.userData)||void 0===r?void 0:r._isCSGMesh)||(this._csgNeedsUpdate=!0)}}function pS(e,t){let r=new aS;const n=e.map(e=>e[0].material).flatMap(e=>e);e.forEach(([e,t])=>{if(!cS.includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const i=e.matrix;e.matrix=e.matrixWorld;let s=0;s=Array.isArray(e.material)?void 0:n.indexOf(e.material),r=r[t](aS.fromMesh(e,s)),e.matrix=i});const s=r.toMesh(null!=t?t:(new i.yGw).identity(),n);return s.userData._isCSGMesh=!0,s.geometry.groups=s.geometry.groups.filter(e=>e.count>0),s}lS([Ye("Show Result",e=>({onChange:()=>{var t;return null===(t=e._viewer)||void 0===t?void 0:t.setDirty()}}))],uS.prototype,"showResult",void 0),lS([et("Make CSG Brush",e=>({hidden:()=>{var t,r;const i=null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject();return!(null==i?void 0:i.userData)||!!i.userData.csgBrush||i.userData._isCSGMesh}}))],uS.prototype,"makeSelectedCSGBrush",null),lS([Ye("Enabled",e=>({hidden:()=>{var t,r;const i=null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject();return!i||!i.userData.csgBrush},onChange:e._updateSelectedProperties}))],uS.prototype,"csgSelectedEnabled",void 0),lS([$e("Operation",cS.map(e=>({label:e})),e=>({hidden:()=>{var t,r;const i=null===(r=null===(t=e._viewer)||void 0===t?void 0:t.getPlugin(Fc))||void 0===r?void 0:r.getSelectedObject();return!i||!i.userData.csgBrush},onChange:e._updateSelectedProperties}))],uS.prototype,"csgSelectedOperation",void 0),lS([et("Refresh CSG")],uS.prototype,"refreshCSG",null),lS([et("Export Result",e=>({hidden:()=>{var t;return!(null===(t=e._viewer)||void 0===t?void 0:t.getPluginByType("AssetExporterPlugin"))}}))],uS.prototype,"downloadObject",null);let hS=class extends uS{_buildCSGMesh(e){return pS(e)}};hS.PluginType="CSGPluginBSP",hS=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([ot("CSG Plugin (BSP)")],hS);class dS{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,i=-1/0;for(let n=0,s=e.length;n<s;n++){const s=e[n][t];r=s<r?s:r,i=s>i?s:i}this.min=r,this.max=i}setFromPoints(e,t){let r=1/0,i=-1/0;for(let n=0,s=t.length;n<s;n++){const s=t[n],o=e.dot(s);r=o<r?o:r,i=o>i?o:i}this.min=r,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}dS.prototype.setFromBox=function(){const e=new i.Pa4;return function(t,r){const i=r.min,n=r.max;let s=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let r=0;r<=1;r++)for(let l=0;l<=1;l++){e.x=i.x*a+n.x*(1-a),e.y=i.y*r+n.y*(1-r),e.z=i.z*l+n.z*(1-l);const c=t.dot(e);s=Math.min(c,s),o=Math.max(c,o)}this.min=s,this.max=o}}(),new dS;const fS=function(){const e=new i.Pa4,t=new i.Pa4,r=new i.Pa4;return function(i,n,s){const o=i.start,a=e,l=n.start,c=t;r.subVectors(o,l),e.subVectors(i.end,n.start),t.subVectors(n.end,n.start);const u=r.dot(c),p=c.dot(a),h=c.dot(c),d=r.dot(a),f=a.dot(a)*h-p*p;let g,m;m=(u+(g=0!==f?(u*p-d*h)/f:0)*p)/h,s.x=g,s.y=m}}(),gS=function(){const e=new i.FM8,t=new i.Pa4,r=new i.Pa4;return function(i,n,s,o){fS(i,n,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1)return i.at(a,s),void n.at(l,o);if(a>=0&&a<=1)return l<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,s);if(l>=0&&l<=1)return a<0?i.at(0,s):i.at(1,s),void n.closestPointToPoint(s,!0,o);{let e,c;e=a<0?i.start:i.end,c=l<0?n.start:n.end;const u=t,p=r;return i.closestPointToPoint(c,!0,t),n.closestPointToPoint(e,!0,r),u.distanceToSquared(c)<=p.distanceToSquared(e)?(s.copy(u),void o.copy(c)):(s.copy(e),void o.copy(p))}}}(),mS=function(){const e=new i.Pa4,t=new i.Pa4,r=new i.JOQ,n=new i.Zzh;return function(i,s){const{radius:o,center:a}=i,{a:l,b:c,c:u}=s;if(n.start=l,n.end=c,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(n.start=l,n.end=u,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;if(n.start=c,n.end=u,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o)return!0;const p=s.getPlane(r);if(Math.abs(p.distanceToPoint(a))<=o){const e=p.projectPoint(a,t);if(s.containsPoint(e))return!0}return!1}}();function _S(e){return Math.abs(e)<1e-15}class vS extends i.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new i.Pa4),this.satBounds=new Array(4).fill().map(()=>new dS),this.points=[this.a,this.b,this.c],this.sphere=new i.aLr,this.plane=new i.JOQ,this.needsUpdate=!0}intersectsSphere(e){return mS(e,this)}update(){const e=this.a,t=this.b,r=this.c,i=this.points,n=this.satAxes,s=this.satBounds,o=n[0],a=s[0];this.getNormal(o),a.setFromPoints(o,i);const l=n[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,i);const u=n[2],p=s[2];u.subVectors(t,r),p.setFromPoints(u,i);const h=n[3],d=s[3];h.subVectors(r,e),d.setFromPoints(h,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}vS.prototype.closestPointToSegment=function(){const e=new i.Pa4,t=new i.Pa4,r=new i.Zzh;return function(i,n=null,s=null){const{start:o,end:a}=i,l=this.points;let c,u=1/0;for(let p=0;p<3;p++){const o=(p+1)%3;r.start.copy(l[p]),r.end.copy(l[o]),gS(r,i,e,t),(c=e.distanceToSquared(t))<u&&(u=c,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(o,e),(c=o.distanceToSquared(e))<u&&(u=c,n&&n.copy(e),s&&s.copy(o)),this.closestPointToPoint(a,e),(c=a.distanceToSquared(e))<u&&(u=c,n&&n.copy(e),s&&s.copy(a)),Math.sqrt(u)}}(),vS.prototype.intersectsTriangle=function(){const e=new vS,t=new Array(3),r=new Array(3),n=new dS,s=new dS,o=new i.Pa4,a=new i.Pa4,l=new i.Pa4,c=new i.Pa4,u=new i.Zzh,p=new i.Zzh,h=new i.Zzh;return function(i,d=null){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const f=this.plane,g=i.plane;if(Math.abs(f.normal.dot(g.normal))>1-1e-10){const e=this.satBounds,a=this.satAxes;r[0]=i.a,r[1]=i.b,r[2]=i.c;for(let t=0;t<4;t++){const i=e[t],s=a[t];if(n.setFromPoints(s,r),i.isSeparated(n))return!1}const l=i.satBounds,c=i.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let r=0;r<4;r++){const e=l[r],i=c[r];if(n.setFromPoints(i,t),e.isSeparated(n))return!1}for(let i=0;i<4;i++){const e=a[i];for(let i=0;i<4;i++){const a=c[i];if(o.crossVectors(e,a),n.setFromPoints(o,t),s.setFromPoints(o,r),n.isSeparated(s))return!1}}return d&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),d.start.set(0,0,0),d.end.set(0,0,0)),!0}{const e=this.points;let t=!1,r=0;for(let i=0;i<3;i++){const n=e[i],s=e[(i+1)%3];u.start.copy(n),u.end.copy(s),u.delta(a);const o=t?p.start:p.end,l=_S(g.distanceToPoint(n));if(_S(g.normal.dot(a))&&l){p.copy(u),r=2;break}if((g.intersectLine(u,o)||l)&&!_S(o.distanceTo(s))){if(r++,t)break;t=!0}}if(1===r&&this.containsPoint(p.start))return d&&(d.start.copy(p.start),d.end.copy(p.start)),!0;if(2!==r)return!1;const n=i.points;let s=!1,o=0;for(let i=0;i<3;i++){const e=n[i],t=n[(i+1)%3];u.start.copy(e),u.end.copy(t),u.delta(l);const r=s?h.start:h.end,a=_S(f.distanceToPoint(e));if(_S(f.normal.dot(l))&&a){h.copy(u),o=2;break}if((f.intersectLine(u,r)||a)&&!_S(r.distanceTo(t))){if(o++,s)break;s=!0}}if(1===o&&this.containsPoint(h.start))return d&&(d.start.copy(h.start),d.end.copy(h.start)),!0;if(2!==o)return!1;if(p.delta(a),h.delta(l),a.dot(l)<0){let e=h.start;h.start=h.end,h.end=e}const m=p.start.dot(a),_=p.end.dot(a),v=h.start.dot(a),x=h.end.dot(a),A=_<v,b=m<x;return(m===x||v===_||A!==b)&&(d&&(c.subVectors(p.start,h.start),c.dot(a)>0?d.start.copy(p.start):d.start.copy(h.start),c.subVectors(p.end,h.end),c.dot(a)<0?d.end.copy(p.end):d.end.copy(h.end)),!0)}}}(),vS.prototype.distanceToPoint=function(){const e=new i.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),vS.prototype.distanceToTriangle=function(){const e=new i.Pa4,t=new i.Pa4,r=["a","b","c"],n=new i.Zzh,s=new i.Zzh;return function(i,o=null,a=null){const l=o||a?n:null;if(this.intersectsTriangle(i,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let t=0;t<3;t++){let n;const s=r[t],l=i[s];this.closestPointToPoint(l,e),(n=l.distanceToSquared(e))<c&&(c=n,o&&o.copy(e),a&&a.copy(l));const u=this[s];i.closestPointToPoint(u,e),(n=u.distanceToSquared(e))<c&&(c=n,o&&o.copy(u),a&&a.copy(e))}for(let u=0;u<3;u++){const l=r[u],p=r[(u+1)%3];n.set(this[l],this[p]);for(let u=0;u<3;u++){const l=r[u],p=r[(u+1)%3];s.set(i[l],i[p]),gS(n,s,e,t);const h=e.distanceToSquared(t);h<c&&(c=h,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(c)}}();class xS{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:r,ids:i}=this;r[e]||(r[e]=[],i.push(e)),r[e].push(t)}}const AS=new i.zHn,bS=new i.yGw,yS=new i.CJI,wS=new i.Pa4,ES=new i.Ltg,SS=new i.Ltg,CS=new i.Ltg,MS=new i.Ltg,TS=new i.Ltg,IS=new i.Ltg,kS=new i.Zzh,DS=1e-8;let PS=null;function BS(e){PS=e}function RS(e,t){function r(){return Math.random()-.5}AS.origin.copy(e.a).add(e.b).add(e.c).multiplyScalar(1/3),e.getNormal(AS.direction);let n=0,s=1/0;for(let o=0;o<3;o++){AS.direction.x+=r()*DS,AS.direction.y+=r()*DS,AS.direction.z+=r()*DS;const e=t.raycastFirst(AS,i.ehD);if(Boolean(e&&AS.direction.dot(e.face.normal)>0)&&n++,null!==e&&(s=Math.min(s,e.distance)),0===s||n/3>.5||(o-n+1)/3>.5)break}return 0===s?0:n/3>.5?-1:1}function LS(e,t,r,i,n,s,o=!1){const a=r.attributes,l=r.index,c=3*e,u=l.getX(c+0),p=l.getX(c+1),h=l.getX(c+2);for(const d in s){const e=a[d],r=s[d];if(!(d in a))throw new Error(`CSG Operations: Attribute ${d} not available on geometry.`);const l=e.itemSize;"position"===d?(yS.a.fromBufferAttribute(e,u).applyMatrix4(i),yS.b.fromBufferAttribute(e,p).applyMatrix4(i),yS.c.fromBufferAttribute(e,h).applyMatrix4(i),US(yS.a,yS.b,yS.c,t,3,r,o)):"normal"===d?(yS.a.fromBufferAttribute(e,u).applyNormalMatrix(n),yS.b.fromBufferAttribute(e,p).applyNormalMatrix(n),yS.c.fromBufferAttribute(e,h).applyNormalMatrix(n),o&&(yS.a.multiplyScalar(-1),yS.b.multiplyScalar(-1),yS.c.multiplyScalar(-1)),US(yS.a,yS.b,yS.c,t,3,r,o,!0)):(ES.fromBufferAttribute(e,u),SS.fromBufferAttribute(e,p),CS.fromBufferAttribute(e,h),US(ES,SS,CS,t,l,r,o))}}function OS(e,t,r,i,n,s,o,a=!1){NS(e,i,n,s,o,a),NS(t,i,n,s,o,a),NS(r,i,n,s,o,a)}function FS(e,t,r=!1){switch(e){case 0:if(1===t||0===t&&r)return 1;break;case 1:if(r){if(-1===t)return 0}else if(1===t)return 1;break;case 3:if(-1===t)return 0;if(1===t)return 1;case 4:if(-1===t||0===t&&r)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${e}".`)}return 2}function US(e,t,r,i,n,s,o=!1,a=!1){const l=e=>{s.push(e.x),n>1&&s.push(e.y),n>2&&s.push(e.z),n>3&&s.push(e.w)};MS.set(0,0,0,0).addScaledVector(e,i.a.x).addScaledVector(t,i.a.y).addScaledVector(r,i.a.z),TS.set(0,0,0,0).addScaledVector(e,i.b.x).addScaledVector(t,i.b.y).addScaledVector(r,i.b.z),IS.set(0,0,0,0).addScaledVector(e,i.c.x).addScaledVector(t,i.c.y).addScaledVector(r,i.c.z),a&&(MS.normalize(),TS.normalize(),IS.normalize()),l(MS),o?(l(IS),l(TS)):(l(TS),l(IS))}function NS(e,t,r,i,n,s=!1){for(const o in n){const a=t[o],l=n[o];if(!(o in t))throw new Error(`CSG Operations: Attribute ${o} no available on geometry.`);const c=a.itemSize;"position"===o?(wS.fromBufferAttribute(a,e).applyMatrix4(r),l.push(wS.x,wS.y,wS.z)):"normal"===o?(wS.fromBufferAttribute(a,e).applyNormalMatrix(i),s&&wS.multiplyScalar(-1),l.push(wS.x,wS.y,wS.z)):(l.push(a.getX(e)),c>1&&l.push(a.getY(e)),c>2&&l.push(a.getZ(e)),c>3&&l.push(a.getW(e)))}}const jS=1e-14,GS=1e-7,zS=new i.Zzh,VS=new i.Zzh,QS=new i.Pa4,HS=new i.Pa4,WS=new i.JOQ,qS=new vS;function XS(e){return e.a.distanceToSquared(e.b)<jS||e.a.distanceToSquared(e.c)<jS||e.b.distanceToSquared(e.c)<jS}class YS extends i.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,t=null,r=-1){if(null!==this.originalSide&&null===this.side)return;QS.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const i=e.distanceToPoint(QS)<0?-1:1;t&&-1!==r?1===i&&(this.coplanarCount++,3===this.coplanarCount&&(this.side=0)):(null===this.originalSide&&(this.originalSide=i,this.side=i),i!==this.side&&(this.side=null))}}class KS{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new YS);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class JS{constructor(){this.trianglePool=new KS,this.triangles=[],this.normal=new i.Pa4}initialize(e){const{triangles:t,trianglePool:r,normal:i}=this;if(t.length=0,r.clear(),Array.isArray(e))for(let n=0,s=e.length;n<s;n++){const s=e[n];if(0===n)s.getNormal(i);else if(Math.abs(1-s.getNormal(QS).dot(i))>jS)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const o=r.getTriangle();o.copy(s),t.push(o)}else{e.getNormal(i);const n=r.getTriangle();n.copy(e),t.push(n)}}splitByTriangle(e){const{normal:t,triangles:r}=this;if(e.getPlane(WS),Math.abs(1-Math.abs(WS.normal.dot(t)))<GS){const i=[e.a,e.b,e.c];for(let r=0;r<3;r++){const n=(r+1)%3,s=i[r],o=i[n];QS.subVectors(o,s).normalize(),HS.crossVectors(t,QS),WS.setFromNormalAndCoplanarPoint(HS,s),this.splitByPlane(WS,e,r)}for(let e=0,t=r.length;e<t;e++)r[e].coplanarCount=0}else this.splitByPlane(WS,e)}splitByPlane(e,t=null,r=-1){const{triangles:i,trianglePool:n}=this;let s=null;null!==t&&((s=qS).copy(t),s.needsUpdate=!0);for(let o=0,a=i.length;o<a;o++){const t=i[o],{a:l,b:c,c:u}=t;if(s&&(!s.intersectsTriangle(t,zS)||zS.distance()<1e-5)){t.updateSide(e,s,r),t.side=null;continue}let p=0,h=-1,d=0,f=0,g=!1;const m=[l,c,u];for(let r=0;r<3;r++){const t=(r+1)%3;zS.start.copy(m[r]),zS.end.copy(m[t]);const i=e.distanceToPoint(zS.start),n=e.distanceToPoint(zS.end);Math.abs(i)<jS?f++:i>0&&d++,Math.abs(i)<GS&&Math.abs(n)<GS&&(g=!0);let s=!!e.intersectLine(zS,QS);!s&&Math.abs(n)<jS&&(QS.copy(zS.end),s=!0),!s||QS.distanceTo(zS.start)<jS||(QS.distanceTo(zS.end)<jS&&(h=r),0===p?VS.start.copy(QS):VS.end.copy(QS),p++)}if(!g&&f<2&&2===p&&VS.distance()>GS)if(-1!==h){let l=0;l===(h=(h+1)%3)&&(l=(l+1)%3);let c=l+1;c===h&&(c=(c+1)%3);const u=n.getTriangle();u.a.copy(m[c]),u.b.copy(VS.end),u.c.copy(VS.start),XS(u)||(i.push(u),u.initFrom(t),u.updateSide(e,s,r)),t.a.copy(m[l]),t.b.copy(VS.start),t.c.copy(VS.end),XS(t)?(i.splice(o,1),o--,a--):t.updateSide(e,s,r)}else{const l=m.findIndex(t=>d>=2?e.distanceToPoint(t)<0:e.distanceToPoint(t)>0);if(0===l){let e=VS.start;VS.start=VS.end,VS.end=e}else if(-1===l)continue;const c=(l+1)%3,u=(l+2)%3,p=n.getTriangle(),h=n.getTriangle();m[c].distanceToSquared(VS.start)<m[u].distanceToSquared(VS.end)?(p.a.copy(m[c]),p.b.copy(VS.start),p.c.copy(VS.end),h.a.copy(m[c]),h.b.copy(m[u]),h.c.copy(VS.start)):(p.a.copy(m[u]),p.b.copy(VS.start),p.c.copy(VS.end),h.a.copy(m[c]),h.b.copy(m[u]),h.c.copy(VS.end)),t.a.copy(m[l]),t.b.copy(VS.end),t.c.copy(VS.start),XS(p)||(i.push(p),p.initFrom(t),p.updateSide(e,s,r)),XS(h)||(i.push(h),h.initFrom(t),h.updateSide(e,s,r)),XS(t)?(i.splice(o,1),o--,a--):t.updateSide(e,s,r)}else 3===p&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function ZS(){return"undefined"!=typeof SharedArrayBuffer}function $S(e){if(e.buffer instanceof SharedArrayBuffer)return e;const t=e.constructor,r=e.buffer,i=new SharedArrayBuffer(r.byteLength),n=new Uint8Array(r);return new Uint8Array(i).set(n,0),new t(i)}class eC{constructor(e,t=500){const r=ZS()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new r(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:r,expansionFactor:i}=this;null===e&&(e=~~(r.length*i));const n=new t(e);n.set(r,0),this.array=n}push(...e){let{array:t,length:r}=this;r+e.length>t.length&&(this.expand(),t=this.array);for(let i=0,n=e.length;i<n;i++)t[r+i]=e[i];this.length+=e.length}clear(){this.length=0}}class tC{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:r}=this;let i=0;for(let n=0;n<t;n++)i+=r[n][e].length;return i}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const r=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const e={};t.push(e);for(const t in r)e[t]=new eC(r[t].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:r}=this;if(!r[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:r}=this,i=r[0][e];if(i){if(i.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let n=0,s=r.length;n<s;n++)r[n][e]=new eC(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(e=>{for(const t in e)e[t].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class rC{constructor(e){this.triangle=(new i.CJI).copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=(new i.CJI).copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const r in t)e.push(t[r]);return e}}class iC{constructor(){this.data={}}addTriangleIntersection(e,t,r,i){const{data:n}=this;n[e]||(n[e]=new rC(t)),n[e].addTriangle(r,i)}getTrianglesAsArray(e=null){const{data:t}=this,r=[];if(null!==e)e in t&&r.push(t[e].triangle);else for(const i in t)r.push(t[i].triangle);return r}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(e=>parseInt(e)):[]}getIntersectionsAsArray(e=null,t=null){const{data:r}=this,i=new Set,n=[],s=e=>{if(r[e])if(null!==t)r[e].intersects[t]&&n.push(r[e].intersects[t]);else{const t=r[e].intersects;for(const e in t)i.has(e)||(i.add(e),n.push(t[e]))}};if(null!==e)s(e);else for(const o in r)s(o);return n}reset(){this.data={}}}class nC{constructor(){this.enabled=!1,this.triangleIntersectsA=new iC,this.triangleIntersectsB=new iC,this.intersectionEdges=[]}addIntersectingTriangles(e,t,r,i){const{triangleIntersectsA:n,triangleIntersectsB:s}=this;n.addTriangleIntersection(e,t,r,i),s.addTriangleIntersection(r,i,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const sC=new i.yGw,oC=new i.Vkp,aC=new i.CJI,lC=new i.CJI,cC=new i.CJI,uC=new i.CJI;function pC(e){for(const t of e)return t}function hC(e,t,r,i,n,s,o,a=0){sC.copy(t.matrixWorld).invert().multiply(e.matrixWorld),oC.getNormalMatrix(e.matrixWorld);const l=e.geometry.groupIndices,c=e.geometry.index,u=e.geometry.attributes.position,p=t.geometry.boundsTree,h=t.geometry.index,d=t.geometry.attributes.position,f=r.ids,g=r.intersectionSet;for(let m=0,_=f.length;m<_;m++){const t=f[m],r=-1===a?0:l[t]+a,_=o.getGroupSet(r),v=3*t,x=c.getX(v+0),A=c.getX(v+1),b=c.getX(v+2);aC.a.fromBufferAttribute(u,x).applyMatrix4(sC),aC.b.fromBufferAttribute(u,A).applyMatrix4(sC),aC.c.fromBufferAttribute(u,b).applyMatrix4(sC),s.initialize(aC);const y=g[t];for(let e=0,i=y.length;e<i;e++){const t=3*y[e],r=h.getX(t+0),i=h.getX(t+1),n=h.getX(t+2);lC.a.fromBufferAttribute(d,r),lC.b.fromBufferAttribute(d,i),lC.c.fromBufferAttribute(d,n),s.splitByTriangle(lC)}const w=s.triangles;for(let s=0,o=w.length;s<o;s++){const r=w[s],o=FS(i,RS(r,p),n);if(2!==o)switch(aC.getBarycoord(r.a,uC.a),aC.getBarycoord(r.b,uC.b),aC.getBarycoord(r.c,uC.c),o){case 1:LS(t,uC,e.geometry,e.matrixWorld,oC,_);break;case 0:LS(t,uC,e.geometry,e.matrixWorld,oC,_,!0)}}}return f.length}function dC(e,t,r,i,n,s,o=0){sC.copy(t.matrixWorld).invert().multiply(e.matrixWorld),oC.getNormalMatrix(e.matrixWorld);const a=t.geometry.boundsTree,l=e.geometry.groupIndices,c=e.geometry.index,u=e.geometry.attributes,p=u.position,h=[],d=e.geometry.halfEdges,f=new Set;for(let g=0,m=c.count/3;g<m;g++)g in r.intersectionSet||f.add(g);for(;f.size>0;){const t=pC(f);f.delete(t),h.push(t);const r=3*t,g=c.getX(r+0),m=c.getX(r+1),_=c.getX(r+2);cC.a.fromBufferAttribute(p,g).applyMatrix4(sC),cC.b.fromBufferAttribute(p,m).applyMatrix4(sC),cC.c.fromBufferAttribute(p,_).applyMatrix4(sC);const v=FS(i,RS(cC,a),n);for(;h.length>0;){const t=h.pop(),r=-1===o?0:l[t]+o,i=s.getGroupSet(r);for(let e=0;e<3;e++){const r=d.getSiblingTriangleIndex(t,e);-1!==r&&f.has(r)&&(h.push(r),f.delete(r))}const a=3*t,p=c.getX(a+0),g=c.getX(a+1),m=c.getX(a+2);switch(v){case 1:OS(p,g,m,u,e.matrixWorld,oC,i);break;case 0:OS(m,g,p,u,e.matrixWorld,oC,i,n)}}}}const fC=1.25,gC=65535,mC=Math.pow(2,-24);class _C{constructor(){}}function vC(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function xC(e){let t=-1,r=-1/0;for(let i=0;i<3;i++){const n=e[i+3]-e[i];n>r&&(r=n,t=i)}return t}function AC(e,t){t.set(e)}function bC(e,t,r){let i,n;for(let s=0;s<3;s++){const o=s+3;i=e[s],n=t[s],r[s]=i<n?i:n,i=e[o],n=t[o],r[o]=i>n?i:n}}function yC(e,t,r){for(let i=0;i<3;i++){const n=t[e+2*i],s=t[e+2*i+1],o=n-s,a=n+s;o<r[i]&&(r[i]=o),a>r[i+3]&&(r[i+3]=a)}}function wC(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return 2*(t*r+r*i+i*t)}function EC(e,t,r,i,n=null){let s=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0,p=1/0,h=1/0,d=1/0,f=-1/0,g=-1/0,m=-1/0;const _=null!==n;for(let v=6*t,x=6*(t+r);v<x;v+=6){const t=e[v+0],r=e[v+1],i=t-r,n=t+r;i<s&&(s=i),n>l&&(l=n),_&&t<p&&(p=t),_&&t>f&&(f=t);const x=e[v+2],A=e[v+3],b=x-A,y=x+A;b<o&&(o=b),y>c&&(c=y),_&&x<h&&(h=x),_&&x>g&&(g=x);const w=e[v+4],E=e[v+5],S=w-E,C=w+E;S<a&&(a=S),C>u&&(u=C),_&&w<d&&(d=w),_&&w>m&&(m=w)}i[0]=s,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=u,_&&(n[0]=p,n[1]=h,n[2]=d,n[3]=f,n[4]=g,n[5]=m)}const SC=(e,t)=>e.candidate-t.candidate,CC=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),MC=new Float32Array(6);class TC extends i.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new i.yGw,this.invMatrix=new i.yGw,this.points=new Array(8).fill().map(()=>new i.Pa4),this.satAxes=new Array(3).fill().map(()=>new i.Pa4),this.satBounds=new Array(3).fill().map(()=>new dS),this.alignedSatBounds=new Array(3).fill().map(()=>new dS),this.needsUpdate=!1}set(e,t,r){super.set(e,t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}TC.prototype.update=function(){const e=this.matrix,t=this.min,r=this.max,i=this.points;for(let l=0;l<=1;l++)for(let n=0;n<=1;n++)for(let s=0;s<=1;s++){const o=i[1*l|2*n|4*s];o.x=l?r.x:t.x,o.y=n?r.y:t.y,o.z=s?r.z:t.z,o.applyMatrix4(e)}const n=this.satBounds,s=this.satAxes,o=i[0];for(let l=0;l<3;l++){const e=s[l],t=n[l],r=i[1<<l];e.subVectors(o,r),t.setFromPoints(e,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},TC.prototype.intersectsBox=function(){const e=new dS;return function(t){this.needsUpdate&&this.update();const r=t.min,i=t.max,n=this.satBounds,s=this.satAxes,o=this.alignedSatBounds;if(e.min=r.x,e.max=i.x,o[0].isSeparated(e))return!1;if(e.min=r.y,e.max=i.y,o[1].isSeparated(e))return!1;if(e.min=r.z,e.max=i.z,o[2].isSeparated(e))return!1;for(let a=0;a<3;a++){const r=s[a],i=n[a];if(e.setFromBox(r,t),i.isSeparated(e))return!1}return!0}}(),TC.prototype.intersectsTriangle=function(){const e=new vS,t=new Array(3),r=new dS,n=new dS,s=new i.Pa4;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const o=this.satBounds,a=this.satAxes;t[0]=i.a,t[1]=i.b,t[2]=i.c;for(let e=0;e<3;e++){const i=o[e],n=a[e];if(r.setFromPoints(n,t),i.isSeparated(r))return!1}const l=i.satBounds,c=i.satAxes,u=this.points;for(let e=0;e<3;e++){const t=l[e],i=c[e];if(r.setFromPoints(i,u),t.isSeparated(r))return!1}for(let e=0;e<3;e++){const i=a[e];for(let e=0;e<4;e++){const o=c[e];if(s.crossVectors(i,o),r.setFromPoints(s,t),n.setFromPoints(s,u),r.isSeparated(n))return!1}}return!0}}(),TC.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},TC.prototype.distanceToPoint=function(){const e=new i.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),TC.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map(()=>new i.Zzh),r=new Array(12).fill().map(()=>new i.Zzh),n=new i.Pa4,s=new i.Pa4;return function(i,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(a||l)&&(i.getCenter(s),this.closestPointToPoint(s,n),i.closestPointToPoint(n,s),a&&a.copy(n),l&&l.copy(s)),0;const c=o*o,u=i.min,p=i.max,h=this.points;let d=1/0;for(let e=0;e<8;e++){const t=h[e];s.copy(t).clamp(u,p);const r=t.distanceToSquared(s);if(r<d&&(d=r,a&&a.copy(t),l&&l.copy(s),r<c))return Math.sqrt(r)}let f=0;for(let n=0;n<3;n++)for(let i=0;i<=1;i++)for(let s=0;s<=1;s++){const o=(n+1)%3,a=(n+2)%3,l=1<<n|i<<o|s<<a,c=h[i<<o|s<<a],d=h[l];t[f].set(c,d);const g=e[n],m=e[o],_=e[a],v=r[f],x=v.start,A=v.end;x[g]=u[g],x[m]=i?u[m]:p[m],x[_]=s?u[_]:p[m],A[g]=p[g],A[m]=i?u[m]:p[m],A[_]=s?u[_]:p[m],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){s.x=e?p.x:u.x,s.y=t?p.y:u.y,s.z=r?p.z:u.z,this.closestPointToPoint(s,n);const i=s.distanceToSquared(n);if(i<d&&(d=i,a&&a.copy(n),l&&l.copy(s),i<c))return Math.sqrt(i)}for(let e=0;e<12;e++){const i=t[e];for(let e=0;e<12;e++){const t=r[e];gS(i,t,n,s);const o=n.distanceToSquared(s);if(o<d&&(d=o,a&&a.copy(n),l&&l.copy(s),o<c))return Math.sqrt(o)}}return Math.sqrt(d)}}();const IC=new i.Pa4,kC=new i.Pa4,DC=new i.Pa4,PC=new i.FM8,BC=new i.FM8,RC=new i.FM8,LC=new i.Pa4;function OC(e,t,r,n,s){const o=3*n,a=e.index.getX(o),l=e.index.getX(o+1),c=e.index.getX(o+2),u=function(e,t,r,n,s,o,a){IC.fromBufferAttribute(t,n),kC.fromBufferAttribute(t,s),DC.fromBufferAttribute(t,o);const l=function(e,t,r,n,s,o){let a;return null===(a=o===i._Li?e.intersectTriangle(n,r,t,!0,s):e.intersectTriangle(t,r,n,o!==i.ehD,s))?null:{distance:e.origin.distanceTo(s),point:s.clone()}}(e,IC,kC,DC,LC,a);if(l){r&&(PC.fromBufferAttribute(r,n),BC.fromBufferAttribute(r,s),RC.fromBufferAttribute(r,o),l.uv=i.CJI.getUV(LC,IC,kC,DC,PC,BC,RC,new i.FM8));const e={a:n,b:s,c:o,normal:new i.Pa4,materialIndex:0};i.CJI.getNormal(IC,kC,DC,e.normal),l.face=e,l.faceIndex=n}return l}(r,e.attributes.position,e.attributes.uv,a,l,c,t);return u?(u.faceIndex=n,s&&s.push(u),u):null}function FC(e,t,r){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(r.ray.origin),e.object=t,e.distance<r.near||e.distance>r.far?null:e)}function UC(e,t,r,i){const n=e.a,s=e.b,o=e.c;let a=t,l=t+1,c=t+2;r&&(a=r.getX(t),l=r.getX(t+1),c=r.getX(t+2)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),s.x=i.getX(l),s.y=i.getY(l),s.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function NC(e,t,r,i,n,s,o){const a=r.index,l=r.attributes.position;for(let c=e,u=t+e;c<u;c++)if(UC(o,3*c,a,l),o.needsUpdate=!0,i(o,c,n,s))return!0;return!1}class jC{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function GC(e,t){return 65535===t[e+15]}function zC(e,t){return t[e+6]}function VC(e,t){return t[e+14]}function QC(e){return e+8}function HC(e,t){return t[e+6]}const WC=new i.ZzF,qC=new i.Pa4,XC=["x","y","z"];function YC(e,t,r,i,n){let s=2*e,o=rM,a=iM,l=nM;if(GC(s,a))!function(e,t,r,i,n,s){for(let o=i,a=i+n;o<a;o++)OC(e,t,r,o,s)}(t,r,i,zC(e,l),VC(s,a),n);else{const s=QC(e);$C(s,o,i,qC)&&YC(s,t,r,i,n);const a=HC(e,l);$C(a,o,i,qC)&&YC(a,t,r,i,n)}}function KC(e,t,r,i){let n=2*e,s=rM,o=iM,a=nM;if(GC(n,o))return function(e,t,r,i,n){let s=1/0,o=null;for(let a=i,l=i+n;a<l;a++){const i=OC(e,t,r,a);i&&i.distance<s&&(o=i,s=i.distance)}return o}(t,r,i,zC(e,a),VC(n,o));{const n=function(e,t){return a[e+7]}(e),o=XC[n],l=i.direction[o]>=0;let c,u;l?(c=QC(e),u=HC(e,a)):(c=HC(e,a),u=QC(e));const p=$C(c,s,i,qC)?KC(c,t,r,i):null;if(p){const e=p.point[o];if(l?e<=s[u+n]:e>=s[u+n+3])return p}const h=$C(u,s,i,qC)?KC(u,t,r,i):null;return p&&h?p.distance<=h.distance?p:h:p||h||null}}const JC=function(){let e,t;const r=[],n=new jC(()=>new i.ZzF);return function(...i){e=n.getPrimitive(),t=n.getPrimitive(),r.push(e,t);const s=function r(i,n,s,o,a=null,l=0,c=0){function u(e){let t=2*e,r=iM,i=nM;for(;!GC(t,r);)t=2*(e=QC(e));return zC(e,i)}function p(e){let t=2*e,r=iM,i=nM;for(;!GC(t,r);)t=2*(e=HC(e,i));return zC(e,i)+VC(t,r)}let h=2*i,d=rM,f=iM,g=nM;if(GC(h,f)){const t=zC(i,g),r=VC(h,f);return vC(i,d,e),o(t,r,!1,c,l+i,e)}{const h=QC(i),m=HC(i,g);let _,v,x,A,b=h,y=m;if(a&&(A=t,vC(b,d,x=e),vC(y,d,A),_=a(x),(v=a(A))<_)){b=m,y=h;const e=_;_=v,v=e,x=A}x||vC(b,d,x=e);const w=s(x,GC(2*b,f),_,c+1,l+b);let E;if(2===w){const e=u(b);E=o(e,p(b)-e,!0,c+1,l+b,x)}else E=w&&r(b,n,s,o,a,l,c+1);if(E)return!0;vC(y,d,A=t);const S=s(A,GC(2*y,f),v,c+1,l+y);let C;if(2===S){const e=u(y);C=o(e,p(y)-e,!0,c+1,l+y,A)}else C=S&&r(y,n,s,o,a,l,c+1);return!!C}}(...i);n.releasePrimitive(e),n.releasePrimitive(t),r.pop(),r.pop();const o=r.length;return o>0&&(t=r[o-1],e=r[o-2]),s}}(),ZC=function(){const e=new vS,t=new vS,r=new i.yGw,n=new TC,s=new TC;return function i(o,a,l,c,u=null){let p=2*o,h=rM,d=iM,f=nM;if(null===u&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,c),u=n),!GC(p,d)){const e=o+8,t=f[o+6];return vC(e,h,WC),!(!u.intersectsBox(WC)||!i(e,a,l,c,u))||(vC(t,h,WC),!(!u.intersectsBox(WC)||!i(t,a,l,c,u)))}{const i=a,n=i.index,u=i.attributes.position,g=l.index,m=l.attributes.position,_=zC(o,f),v=VC(p,d);if(r.copy(c).invert(),l.boundsTree){return vC(o,h,s),s.matrix.copy(r),s.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:e=>s.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(let r=3*_,i=3*(v+_);r<i;r+=3)if(UC(t,r,n,u),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}})}for(let s=3*_,o=v+3*_;s<o;s+=3){UC(e,s,n,u),e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let r=0,i=g.count;r<i;r+=3)if(UC(t,r,g,m),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function $C(e,t,r,i){return vC(e,t,WC),r.intersectBox(WC,i)}const eM=[];let tM,rM,iM,nM;function sM(e){tM&&eM.push(tM),tM=e,rM=new Float32Array(e),iM=new Uint16Array(e),nM=new Uint32Array(e)}function oM(){tM=null,rM=null,iM=null,nM=null,eM.length&&sM(eM.pop())}const aM=Symbol("skip tree generation"),lM=new i.ZzF,cM=new i.ZzF,uM=new i.yGw,pM=new TC,hM=new TC,dM=new i.Pa4,fM=new i.Pa4,gM=new i.Pa4,mM=new i.Pa4,_M=new i.Pa4,vM=new i.ZzF,xM=new jC(()=>new vS);class AM{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),AM.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};const r=e.geometry,i=e._roots,n=r.getIndex();let s;return s=t.cloneBuffers?{roots:i.map(e=>e.slice()),index:n.array.slice()}:{roots:i,index:n.array}}static deserialize(e,t,r={}){if("boolean"==typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),AM.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r={setIndex:!0,...r};const{index:n,roots:s}=e,o=new AM(t,{...r,[aM]:!0});if(o._roots=s,r.setIndex){const r=t.getIndex();if(null===r){const r=new i.TlE(e.index,1,!1);t.setIndex(r)}else r.array!==n&&(r.array.set(n),r.needsUpdate=!0)}return o}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[aM]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[aM]||(this._roots=function(e,t){const r=function(e,t){function r(e){d&&d(e/f)}function n(t,i,s,d=null,f=0){if(!g&&f>=c&&(g=!0,u&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),s<=p||f>=c)return r(i+s),t.offset=i,t.count=s,t;const m=function(e,t,r,i,n,s){let o=-1,a=0;if(0===s)-1!==(o=xC(t))&&(a=(t[o]+t[o+3])/2);else if(1===s)-1!==(o=xC(e))&&(a=function(e,t,r,i){let n=0;for(let s=t,o=t+r;s<o;s++)n+=e[6*s+2*i];return n/r}(r,i,n,o));else if(2===s){const s=wC(e);let l=fC*n;const c=6*i,u=6*(i+n);for(let e=0;e<3;e++){const i=t[e],p=(t[e+3]-i)/32;if(n<8){const t=[...CC];t.length=n;let i=0;for(let n=c;n<u;n+=6,i++){const s=t[i];s.candidate=r[n+2*e],s.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:l}=s;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;yC(n,r,o)}t.sort(SC);let p=n;for(let e=0;e<p;e++){const r=t[e];for(;e+1<p&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),p--}for(let n=c;n<u;n+=6){const i=r[n+2*e];for(let e=0;e<p;e++){const s=t[e];i>=s.candidate?yC(n,r,s.rightCacheBounds):(yC(n,r,s.leftCacheBounds),s.count++)}}for(let r=0;r<p;r++){const i=t[r],c=i.count,u=n-i.count,p=i.leftCacheBounds,h=i.rightCacheBounds;let d=0;0!==c&&(d=wC(p)/s);let f=0;0!==u&&(f=wC(h)/s);const g=1+fC*(d*c+f*u);g<l&&(o=e,l=g,a=i.candidate)}}else{for(let e=0;e<32;e++){const t=CC[e];t.count=0,t.candidate=i+p+e*p;const r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let n=c;n<u;n+=6){let t=~~((r[n+2*e]-i)/p);t>=32&&(t=31);const s=CC[t];s.count++,yC(n,r,s.bounds)}const t=CC[31];AC(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=CC[e],r=CC[e+1];bC(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let h=0;for(let r=0;r<31;r++){const t=CC[r],i=t.count,c=t.bounds,u=CC[r+1].rightCacheBounds;0!==i&&(0===h?AC(c,MC):bC(c,MC,MC));let p=0,d=0;0!==(h+=i)&&(p=wC(MC)/s);const f=n-h;0!==f&&(d=wC(u)/s);const g=1+fC*(p*h+d*f);g<l&&(o=e,l=g,a=t.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}(t.boundingData,d,a,i,s,h);if(-1===m.axis)return r(i+s),t.offset=i,t.count=s,t;const _=function(e,t,r,i,n){let s=r,o=r+i-1;const a=n.pos,l=2*n.axis;for(;;){for(;s<=o&&t[6*s+l]<a;)s++;for(;s<=o&&t[6*o+l]>=a;)o--;if(!(s<o))return s;for(let r=0;r<3;r++){let i=e[3*s+r];e[3*s+r]=e[3*o+r],e[3*o+r]=i;let n=t[6*s+2*r+0];t[6*s+2*r+0]=t[6*o+2*r+0],t[6*o+2*r+0]=n;let a=t[6*s+2*r+1];t[6*s+2*r+1]=t[6*o+2*r+1],t[6*o+2*r+1]=a}s++,o--}}(l,a,i,s,m);if(_===i||_===i+s)r(i+s),t.offset=i,t.count=s;else{t.splitAxis=m.axis;const e=new _C,r=i,l=_-i;t.left=e,e.boundingData=new Float32Array(6),EC(a,r,l,e.boundingData,o),n(e,r,l,o,f+1);const c=new _C,u=_,p=s-l;t.right=c,c.boundingData=new Float32Array(6),EC(a,u,p,c.boundingData,o),n(c,u,p,o,f+1)}return t}!function(e,t){if(!e.index){const r=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let s;s=r>65535?new Uint32Array(new n(4*r)):new Uint16Array(new n(2*r)),e.setIndex(new i.TlE(s,1));for(let e=0;e<r;e++)s[e]=e}}(e,t);const s=new Float32Array(6),o=new Float32Array(6),a=function(e,t){const r=e.attributes.position,i=r.array,n=e.index.array,s=n.length/3,o=new Float32Array(6*s),a=r.offset||0;let l=3;r.isInterleavedBufferAttribute&&(l=r.data.stride);for(let c=0;c<s;c++){const e=3*c,r=6*c,s=n[e+0]*l+a,u=n[e+1]*l+a,p=n[e+2]*l+a;for(let n=0;n<3;n++){const e=i[s+n],a=i[u+n],l=i[p+n];let c=e;a<c&&(c=a),l<c&&(c=l);let h=e;a>h&&(h=a),l>h&&(h=l);const d=(h-c)/2,f=2*n;o[r+f+0]=c+d,o[r+f+1]=d+(Math.abs(c)+d)*mC,c<t[n]&&(t[n]=c),h>t[n+3]&&(t[n+3]=h)}}return o}(e,s),l=e.index.array,c=t.maxDepth,u=t.verbose,p=t.maxLeafTris,h=t.strategy,d=t.onProgress,f=e.index.count/3;let g=!1;const m=[],_=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];const t=[],r=new Set;for(const n of e.groups)r.add(n.start),r.add(n.start+n.count);const i=Array.from(r.values()).sort((e,t)=>e-t);for(let n=0;n<i.length-1;n++){const e=i[n],r=i[n+1];t.push({offset:e/3,count:(r-e)/3})}return t}(e);if(1===_.length){const e=_[0],t=new _C;t.boundingData=s,function(e,t,r,i){let n=1/0,s=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let u=6*t,p=6*(t+r);u<p;u+=6){const t=e[u+0];t<n&&(n=t),t>a&&(a=t);const r=e[u+2];r<s&&(s=r),r>l&&(l=r);const i=e[u+4];i<o&&(o=i),i>c&&(c=i)}i[0]=n,i[1]=s,i[2]=o,i[3]=a,i[4]=l,i[5]=c}(a,e.offset,e.count,o),n(t,e.offset,e.count,o),m.push(t)}else for(let i of _){const e=new _C;e.boundingData=new Float32Array(6),EC(a,i.offset,i.count,e.boundingData,o),n(e,i.offset,i.count,o),m.push(e)}return m}(e,t);let n,s,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let i=0;i<r.length;i++){const e=r[i],t=new l(32*c(e));n=new Float32Array(t),s=new Uint32Array(t),o=new Uint16Array(t),u(0,e),a.push(t)}return a;function c(e){return e.count?1:1+c(e.left)+c(e.right)}function u(e,t){const r=e/4,i=e/2,a=!!t.count,l=t.boundingData;for(let s=0;s<6;s++)n[r+s]=l[s];if(a){const n=t.offset,a=t.count;return s[r+6]=n,o[i+14]=a,o[i+15]=gC,e+32}{const i=t.left,n=t.right,o=t.splitAxis;let a;if((a=u(e+32,i))/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[r+6]=a/4,a=u(a,n),s[r+7]=o,a}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new i.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,r=t.index.array,i=t.attributes.position,n=i.array,s=i.offset||0;let o,a,l,c,u=3;i.isInterleavedBufferAttribute&&(u=i.data.stride);let p=0;const h=this._roots;for(let f=0,g=h.length;f<g;f++)o=h[f],a=new Uint32Array(o),l=new Uint16Array(o),c=new Float32Array(o),d(0,p),p+=o.byteLength;function d(t,i,o=!1){const p=2*t;if(l[p+15]===gC){const e=a[t+6];let i=1/0,o=1/0,h=1/0,d=-1/0,f=-1/0,g=-1/0;for(let t=3*e,a=3*(e+l[p+14]);t<a;t++){const e=r[t]*u+s,a=n[e+0],l=n[e+1],c=n[e+2];a<i&&(i=a),a>d&&(d=a),l<o&&(o=l),l>f&&(f=l),c<h&&(h=c),c>g&&(g=c)}return(c[t+0]!==i||c[t+1]!==o||c[t+2]!==h||c[t+3]!==d||c[t+4]!==f||c[t+5]!==g)&&(c[t+0]=i,c[t+1]=o,c[t+2]=h,c[t+3]=d,c[t+4]=f,c[t+5]=g,!0)}{const r=t+8,n=a[t+6],s=r+i,l=n+i;let u=o,p=!1,h=!1;e?u||(p=e.has(s),h=e.has(l),u=!p&&!h):(p=!0,h=!0);const f=u||h;let g=!1;(u||p)&&(g=d(r,i,u));let m=!1;f&&(m=d(n,i,u));const _=g||m;if(_)for(let e=0;e<3;e++){const i=r+e,s=n+e,o=c[i],a=c[i+3],l=c[s],u=c[s+3];c[t+e]=o<l?o:l,c[t+e+3]=a>u?a:u}return _}}}traverse(e,t=0){const r=this._roots[t],i=new Uint32Array(r),n=new Uint16Array(r);!function t(s,o=0){const a=2*s,l=n[a+15]===gC;if(l){const t=i[s+6],c=n[a+14];e(o,l,new Float32Array(r,4*s,6),t,c)}else{const n=s+8,a=i[s+6],c=i[s+7];e(o,l,new Float32Array(r,4*s,6),c)||(t(n,o+1),t(a,o+1))}}(0)}raycast(e,t=i.Wl3){const r=this._roots,n=this.geometry,s=[],o=t.isMaterial,a=Array.isArray(t),l=n.groups,c=o?t.side:t;for(let i=0,u=r.length;i<u;i++){const o=a?t[l[i].materialIndex].side:c,u=s.length;if(sM(r[i]),YC(0,n,o,e,s),oM(),a){const e=l[i].materialIndex;for(let t=u,r=s.length;t<r;t++)s[t].face.materialIndex=e}}return s}raycastFirst(e,t=i.Wl3){const r=this._roots,n=this.geometry,s=t.isMaterial,o=Array.isArray(t);let a=null;const l=n.groups,c=s?t.side:t;for(let i=0,u=r.length;i<u;i++){const s=o?t[l[i].materialIndex].side:c;sM(r[i]);const u=KC(0,n,s,e);oM(),null!=u&&(null==a||u.distance<a.distance)&&(a=u,o&&(u.face.materialIndex=l[i].materialIndex))}return a}intersectsGeometry(e,t){const r=this.geometry;let i=!1;for(const n of this._roots)if(sM(n),i=ZC(0,r,e,t),oM(),i)break;return i}shapecast(e,t,r){const i=this.geometry;if(e instanceof Function){if(t){const e=t;t=((t,r,i,n)=>{const s=3*r;return e(t,s,s+1,s+2,i,n)})}e={boundsTraverseOrder:r,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const n=xM.getPrimitive();let{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){const e=a;a=((t,r,s,o,a)=>!!e(t,r,s,o,a)||NC(t,r,i,l,s,o,n))}else a||(a=l?(e,t,r,s)=>NC(e,t,i,l,r,s,n):(e,t,r)=>r);let c=!1,u=0;for(const p of this._roots){if(sM(p),c=JC(0,i,o,a,s,u),oM(),c)break;u+=p.byteLength}return xM.releasePrimitive(n),c}bvhcast(e,t,r){let{intersectsRanges:i,intersectsTriangles:n}=r;const s=this.geometry.index,o=this.geometry.attributes.position,a=e.geometry.index,l=e.geometry.attributes.position;uM.copy(t).invert();const c=xM.getPrimitive(),u=xM.getPrimitive();if(n){function p(e,r,i,p,h,d,f,g){for(let m=i,_=i+p;m<_;m++){UC(u,3*m,a,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,i=e+r;t<i;t++)if(UC(c,3*t,s,o),c.needsUpdate=!0,n(c,u,t,m,h,d,f,g))return!0}return!1}if(i){const e=i;i=function(t,r,i,n,s,o,a,l){return!!e(t,r,i,n,s,o,a,l)||p(t,r,i,n,s,o,a,l)}}else i=p}e.getBoundingBox(cM),cM.applyMatrix4(t);const h=this.shapecast({intersectsBounds:e=>cM.intersectsBox(e),intersectsRange:(t,r,n,s,o,a)=>(lM.copy(a),lM.applyMatrix4(uM),e.shapecast({intersectsBounds:e=>lM.intersectsBox(e),intersectsRange:(e,n,a,l,c)=>i(t,r,e,n,s,o,l,c)}))});return xM.releasePrimitive(c),xM.releasePrimitive(u),h}intersectsBox(e,t){return pM.set(e.min,e.max,t),pM.needsUpdate=!0,this.shapecast({intersectsBounds:e=>pM.intersectsBox(e),intersectsTriangle:e=>pM.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},i={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),pM.set(e.boundingBox.min,e.boundingBox.max,t),pM.needsUpdate=!0;const o=this.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,u=e.index,p=xM.getPrimitive(),h=xM.getPrimitive();let d=fM,f=gM,g=null,m=null;i&&(g=mM,m=_M);let _=1/0,v=null,x=null;return uM.copy(t).invert(),hM.matrix.copy(uM),this.shapecast({boundsTraverseOrder:e=>pM.distanceToBox(e),intersectsBounds:(e,t,r)=>r<_&&r<s&&(t&&(hM.min.copy(e.min),hM.max.copy(e.max),hM.needsUpdate=!0),!0),intersectsRange:(r,i)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>hM.distanceToBox(e),intersectsBounds:(e,t,r)=>r<_&&r<s,intersectsRange:(e,s)=>{for(let o=3*e,A=3*(e+s);o<A;o+=3){UC(h,o,u,c),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let e=3*r,t=3*(r+i);e<t;e+=3){UC(p,e,l,a),p.needsUpdate=!0;const t=p.distanceToTriangle(h,d,g);if(t<_&&(f.copy(d),m&&m.copy(g),_=t,v=e/3,x=o/3),t<n)return!0}}}});for(let e=0,s=u?u.count:c.count;e<s;e+=3){UC(h,e,u,c),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let t=3*r,s=3*(r+i);t<s;t+=3){UC(p,t,l,a),p.needsUpdate=!0;const r=p.distanceToTriangle(h,d,g);if(r<_&&(f.copy(d),m&&m.copy(g),_=r,v=t/3,x=e/3),r<n)return!0}}}}),xM.releasePrimitive(p),xM.releasePrimitive(h),_===1/0?null:(r.point?r.point.copy(f):r.point=f.clone(),r.distance=_,r.faceIndex=v,i&&(i.point?i.point.copy(m):i.point=m.clone(),i.point.applyMatrix4(uM),f.applyMatrix4(uM),i.distance=f.sub(i.point).length(),i.faceIndex=x),r)}closestPointToPoint(e,t={},r=0,i=1/0){const n=r*r,s=i*i;let o=1/0,a=null;if(this.shapecast({boundsTraverseOrder:t=>(dM.copy(e).clamp(t.min,t.max),dM.distanceToSquared(e)),intersectsBounds:(e,t,r)=>r<o&&r<s,intersectsTriangle:(t,r)=>{t.closestPointToPoint(e,dM);const i=e.distanceToSquared(dM);return i<o&&(fM.copy(dM),o=i,a=r),i<n}}),o===1/0)return null;const l=Math.sqrt(o);return t.point?t.point.copy(fM):t.point=fM.clone(),t.distance=l,t.faceIndex=a,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{vC(0,new Float32Array(t),vM),e.union(vM)}),e}}const bM=AM.prototype.raycast;AM.prototype.raycast=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[t,r,i,n]=e;return bM.call(this,i,t.material).forEach(e=>{(e=FC(e,t,r))&&n.push(e)}),n}return bM.apply(this,e)};const yM=AM.prototype.raycastFirst;AM.prototype.raycastFirst=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[t,r,i]=e;return FC(yM.call(this,i,t.material),t,r)}return yM.apply(this,e)};const wM=AM.prototype.closestPointToPoint;AM.prototype.closestPointToPoint=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),e.unshift();const t=e[1],r={};return e[1]=r,wM.apply(this,e),t&&t.copy(r.point),r.distance}return wM.apply(this,e)};const EM=AM.prototype.closestPointToGeometry;AM.prototype.closestPointToGeometry=function(...e){const t=e[2],r=e[3];if(t&&t.isVector3||r&&r.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const i={},n={},s=e[1];return e[2]=i,e[3]=n,EM.apply(this,e),t&&t.copy(i.point),r&&r.copy(n.point).applyMatrix4(s),i.distance}return EM.apply(this,e)};const SM=AM.prototype.refit;AM.prototype.refit=function(...e){const t=e[0],r=e[1];if(r&&(r instanceof Set||Array.isArray(r))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const e=new Set;r.forEach(t=>e.add(t)),t&&t.forEach(t=>e.add(t)),SM.call(this,e)}else SM.apply(this,e)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(e=>{const t=AM.prototype[e];AM.prototype[e]=function(...r){return(null===r[0]||r[0].isMesh)&&(r.shift(),console.warn(`MeshBVH: The function signature for "${e}" has changed and no longer takes Mesh. See docs for new signature.`)),t.apply(this,r)}});const CM=[new i.Pa4,new i.Pa4,new i.Pa4];function MM(e){return~~(1e4*e)}function TM(e){return`${MM(e.x)},${MM(e.y)},${MM(e.z)}`}class IM{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const r=this.data[3*e+t];return-1===r?-1:~~(r/3)}getSiblingEdgeIndex(e,t){const r=this.data[3*e+t];return-1===r?-1:r%3}updateFrom(e){const t=new Map,{attributes:r}=e,i=e.index,n=r.position;let s=i?i.count/3:n.count/3;const o=s;let a=0;this.useDrawRange&&(a=e.drawRange.start,e.drawRange.count!==1/0&&(s=~~(e.drawRange.count/3)));let l=this.data;(!l||l.length<3*o)&&(l=new Int32Array(3*o)),l.fill(-1);let c=0,u=0;for(let p=0;p<s;p++){const e=3*p+a;for(let t=0;t<3;t++){let r=e+t;i&&(r=i.getX(r)),CM[t].fromBufferAttribute(n,r)}for(let r=0;r<3;r++){const i=(r+1)%3,n=CM[r],s=CM[i],o=TM(n),a=TM(s),p=`${a}_${o}`;if(t.has(p)){const i=t.get(p);l[e+r]=i,l[i]=e+r,t.delete(p),c--,u++}else{const i=`${o}_${a}`;t.set(i,e+r),c++}}}this.matchedEdges=u,this.unmatchedEdges=c,this.data=l}}class kM extends i.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new i.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,r=e.elements,i=t.elements;for(let n=0;n<16;n++)if(r[n]!==i[n])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(ZS())for(const r in t){const e=t[r];if(e.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");e.array=$S(e.array)}if(e.boundsTree||(e.boundsTree=new AM(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new IM(e)),!e.groupIndices){const t=e.index.count/3,r=new Uint16Array(t),i=e.groups;for(let e=0,n=i.length;e<n;e++){const{start:t,count:n}=i[e];for(let i=t/3,s=(t+n)/3;i<s;i++)r[i]=e}e.groupIndices=r}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function DM(e,t){let r=t;return Array.isArray(t)||(r=[],e.forEach(e=>{r[e.materialIndex]=t})),r}class PM{constructor(){this.triangleSplitter=new JS,this.attributeData=new tC,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new nC}evaluate(e,t,r,n=new kM){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:s,attributeData:o,attributes:a,useGroups:l,debug:c}=this,u=n.geometry,p=e.geometry.attributes;for(let i=0,_=a.length;i<_;i++){const e=a[i],t=p[e];o.initializeArray(e,t.array.constructor)}for(const i in o.attributes)a.includes(i)||o.delete(i);for(const i in u.attributes)a.includes(i)||(u.deleteAttribute(i),u.dispose());o.clear(),c.enabled&&(c.reset(),BS(c)),function(e,t,r,i,n,s){const{useGroups:o=!0}=s,{aIntersections:a,bIntersections:l}=function(e,t){const r=new xS,i=new xS;return bS.copy(e.matrixWorld).invert().multiply(t.matrixWorld),e.geometry.boundsTree.bvhcast(t.geometry.boundsTree,bS,{intersectsTriangles:(e,t,n,s)=>(e.intersectsTriangle(t,kS)&&kS.distance()>1e-5&&(r.add(n,s),i.add(s,n),PS&&(PS.addEdge(kS),PS.addIntersectingTriangles(n,e,s,t))),!1)}),{aIntersections:r,bIntersections:i}}(e,t);let c;dC(e,t,a,r,!1,n,c=o?0:-1),hC(e,t,a,r,!1,i,n,c),dC(t,e,l,r,!0,n,c=o?e.geometry.groups.length||1:-1),hC(t,e,l,r,!0,i,n,c)}(e,t,r,s,o,{useGroups:l}),c.enabled&&BS(null);const h=l&&0!==e.geometry.groups.length?e.geometry.groups.map(e=>({...e})):[{start:0,count:1/0,materialIndex:0}],d=l&&0!==t.geometry.groups.length?t.geometry.groups.map(e=>({...e})):[{start:0,count:1/0,materialIndex:0}],f=DM(h,e.material),g=DM(d,t.material);d.forEach(e=>{e.materialIndex+=f.length}),function(e,t,r,n){let s=!1,o=-1;const a=n.groupCount,l=e.attributes,c=n.groupAttributes[0];for(const p in c){const r=n.getTotalLength(p,a),u=c[p].type;let h=l[p];if(!h||h.array.length<r){const n=t.attributes[p];h=new i.TlE(new u(r),n.itemSize,n.normalized),e.setAttribute(p,h),s=!0}let d=0;for(let e=0;e<a;e++){const{array:t,type:r,length:i}=n.groupAttributes[e][p],s=new r(t.buffer,0,i);h.array.set(s,d),d+=s.length}h.needsUpdate=!0,o=r/h.itemSize}e.setDrawRange(0,o),e.clearGroups();let u=0;for(let i=0;i<a;i++){const t=n.getGroupArray("position",i).length/3;if(0!==t){const n=r[i];e.addGroup(u,t,n.materialIndex),u+=t}}if(e.index){const t=e.index.array;if(t.length<o)e.index=null,s=!0;else for(let e=0,r=t.length;e<r;e++)t[e]=e}e.boundsTree=null,s&&e.dispose()}(u,e.geometry,[...h,...d],o);const m=u.groups;if(l){const e=new Map,t=[...f,...g];let r=0;for(let i=0,n=t.length;i<n;i++)Boolean(m.find(e=>e.materialIndex===i))?(e.set(i,r),r++):t[i]=null;for(let i=0,n=m.length;i<n;i++){const t=m[i];t.materialIndex=e.get(t.materialIndex)}n.material=t.filter(e=>e)}return n}evaluateHierarchy(e,t=new kM){e.updateMatrixWorld(!0);const r=(e,t)=>{const i=e.children;for(let n=0,s=i.length;n<s;n++){const e=i[n];e.isOperationGroup?r(e,t):t(e)}},i=e=>{const t=e.children;let n=!1;for(let r=0,o=t.length;r<o;r++){const e=t[r];n=i(e)||n}const s=e.isDirty();if(s&&e.markUpdated(),n&&!e.isOperationGroup){let t;return r(e,r=>{t=t?this.evaluate(t,r,r.operation):this.evaluate(e,r,r.operation)}),e._cachedGeometry=t.geometry,e._cachedMaterials=t.material,!0}return n||s};return i(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const BM={union:0,subtract:1,intersect:4,difference:3};function RM(e,t){const r=new PM;r.useGroups=!0,r.attributes=["position","normal","uv"],e.forEach(e=>{for(const t of[...r.attributes])e[0].geometry.getAttribute(t)||r.attributes.splice(r.attributes.indexOf(t),1)});let n=new kM(new i._12(.01,.01,2,2));e.forEach(([e,t])=>{if(!Object.keys(BM).includes(t))return void console.error(`Unknown operation ${t}`);e.updateMatrix(),e.updateMatrixWorld();const i=new kM;i.geometry=e.geometry,i.material=e.material,e.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.updateMatrix(),i.updateMatrixWorld(),n=r.evaluate(n,i,BM[t])});const s=n;return s.userData._isCSGMesh=!0,s}let LM=class extends uS{_buildCSGMesh(e){return RM(e)}};LM.PluginType="CSGPluginBVH",LM=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([ot("CSG Plugin (BVH)")],LM);class OM extends oo{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=(e=>{var t,r,i,n;null===(r=null===(t=e.lastCamera)||void 0===t?void 0:t.removeControlsCtor)||void 0===r||r.call(t,this.controlsKey),null===(n=null===(i=e.camera)||void 0===i?void 0:i.setControlsCtor)||void 0===n||n.call(i,this.controlsKey,this._controlsCtor)})}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var FM=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const UM=new i.Pa4(0,0,1),NM=new i.USm,jM=new i._fP,GM=new i._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),zM=new i._fP,VM={type:"change"};let QM=class extends r{constructor(e){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new i._fP,this.onDeviceOrientationChangeEvent=(e=>{this.deviceOrientation=e}),this.onScreenOrientationChangeEvent=(()=>{this.screenOrientation=screen.orientation}),this._initQuaternion=new i._fP,this._initQuaternionInvert=new i._fP,this._initQuaternionDest=new i._fP,this._lastTime=-1,!1===window.isSecureContext&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=e,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new i._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const e=this.deviceOrientation;if(e){const t=null!==e.alpha?i.M8C.degToRad(e.alpha):0,r=null!==e.beta?i.M8C.degToRad(e.beta):0,n=null!==e.gamma?i.M8C.degToRad(e.gamma):0,s=this.screenOrientation?i.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(t,r,n,s),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(VM))}}dispose(){this.disconnect()}setObjectQuaternion(e,t,r,i){const n=kt()/1e3;NM.set(t,e,-r,"YXZ"),zM.setFromEuler(NM),zM.multiply(GM),zM.multiply(jM.setFromAxisAngle(UM,-i)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(zM).invert(),this._initQuaternionDest.__init=!0),zM.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(zM,this.dampingFactor/(Math.min(1,n-this._lastTime)/(1/60))),this._lastTime=n}};FM([Ce(),Je("Damping",[0,1],.01)],QM.prototype,"dampingFactor",void 0),QM=FM([at("Device Orientation Controls")],QM);class HM extends OM{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=((e,t)=>new QM(e))}}HM.PluginType="DeviceOrientationControlsPlugin";var WM=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const qM=new i.Pa4,XM=new i.$V,YM=new i.Pa4,KM={type:"change"};let JM=class extends r{constructor(e,t){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new i.Pa4,this._lastTime=-1,this.object=e,this.domElement=t,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const e=this.object.quaternion;qM.set(0,0,-1).applyQuaternion(e),XM.setFromVector3(qM),this.lat=90-i.M8C.radToDeg(XM.phi),this.lon=i.M8C.radToDeg(XM.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(e){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(e){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(e){if(this.enableKeys)switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(e,t,r){return e.isVector3?YM.copy(e):void 0===t||void 0===r?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):YM.set(e,t,r),this.object.lookAt(YM),this.setOrientation(),this}update(){const e=kt(),t=(this._lastTime<0?16:Math.min(e-this._lastTime,1e3))/1e3;if(this._lastTime=e,!this.enabled)return;if(this.heightSpeed){const e=i.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=t*(e*this.heightCoef)}else this.autoSpeedFactor=0;const r=t*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);let n=t*this.lookSpeed;this.activeLook||(n=0);let s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*n,this.lookVertical&&(this.lat-=this.mouseY*n*s),this.lat=Math.max(-85,Math.min(85,this.lat));let o=i.M8C.degToRad(90-this.lat);const a=i.M8C.degToRad(this.lon);this.constrainVertical&&(o=i.M8C.mapLinear(o,0,Math.PI,this.verticalMin,this.verticalMax));const l=this.object.position;this.targetPosition.setFromSphericalCoords(1,o,a).add(l),this.object.lookAt(this.targetPosition),this.dispatchEvent(KM)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(e){this.enableKeys&&e.preventDefault()}};WM([Ce(),Ye()],JM.prototype,"enabled",void 0),WM([Ce(),Ye()],JM.prototype,"enableKeys",void 0),WM([Ce(),tt()],JM.prototype,"movementSpeed",void 0),WM([Ce(),tt()],JM.prototype,"lookSpeed",void 0),WM([Ce(),Ye()],JM.prototype,"lookVertical",void 0),WM([Ce(),Ye()],JM.prototype,"autoForward",void 0),WM([Ce(),Ye()],JM.prototype,"activeLook",void 0),WM([Ce(),Ye()],JM.prototype,"heightSpeed",void 0),WM([Ce(),tt()],JM.prototype,"heightCoef",void 0),WM([Ce(),tt()],JM.prototype,"heightMin",void 0),WM([Ce(),tt()],JM.prototype,"heightMax",void 0),WM([Ce(),Ye()],JM.prototype,"constrainVertical",void 0),WM([Ce(),tt()],JM.prototype,"verticalMin",void 0),WM([Ce(),tt()],JM.prototype,"verticalMax",void 0),WM([Ce(),Ye()],JM.prototype,"mouseDragOn",void 0),JM=WM([ot("First Person Controls")],JM);class ZM extends OM{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=((e,t)=>new JM(e,t))}}ZM.PluginType="FirstPersonControlsPlugin";var $M=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};const eT=new i.USm(0,0,0,"YXZ"),tT=new i.Pa4,rT={type:"change"},iT={type:"lock"},nT={type:"unlock"},sT=Math.PI/2;let oT=class extends r{constructor(e,t){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new i.Pa4(0,0,-1),this.domElement=t,this.object=e,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(e){this.isLocked||this.autoLockOnClick&&(e.preventDefault(),this.lock())}onMouseMove(e){this.isLocked&&(this._movementX+=e.movementX||e.mozMovementX||e.webkitMovementX||0,this._movementY+=e.movementY||e.mozMovementY||e.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(iT),this.isLocked=!0):(this.dispatchEvent(nT),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(e){return e.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(e){tT.setFromMatrixColumn(this.object.matrix,0),tT.crossVectors(this.object.up,tT),this.object.position.addScaledVector(tT,e)}moveRight(e){tT.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(tT,e)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){this._movementX<1e-4||this._movementY<1e-4||(eT.setFromQuaternion(this.object.quaternion),eT.y-=.002*this._movementX*this.pointerSpeed,eT.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,eT.x=Math.max(sT-this.maxPolarAngle,Math.min(sT-this.minPolarAngle,eT.x)),this.object.quaternion.setFromEuler(eT),this.dispatchEvent(rT))}};$M([Ye(),Ce()],oT.prototype,"enabled",void 0),$M([tt(),Ce()],oT.prototype,"minPolarAngle",void 0),$M([tt(),Ce()],oT.prototype,"maxPolarAngle",void 0),$M([tt(),Ce()],oT.prototype,"pointerSpeed",void 0),$M([Ye(),Ce()],oT.prototype,"autoLockOnClick",void 0),oT=$M([at("Pointer Lock Controls")],oT);class aT extends OM{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=((e,t)=>new oT(e,t.ownerDocument?t:t.documentElement))}}aT.PluginType="PointerLockControlsPlugin";var lT=__webpackgi_require__(819);class cT{static _initialize(){this._inited=!0,Ct(E`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,t,r){this._inited||this._initialize(),this.Element&&this.Remove();const i=Et({id:"customContextMenu",addToBody:!1});i.style.top=r+"px",i.style.left=t+"px";for(const[n,s]of Object.entries(e)){const e=Et({classList:["customContextMenuItems"],addToBody:!1,innerHTML:n});i.appendChild(e),e.onclick=s}return this.Element=i,i}static Remove(){var e;null===(e=this.Element)||void 0===e||e.remove(),this.Element=void 0}}cT.Element=void 0,cT._inited=!1;var uT=__webpackgi_require__(665);const pT=(e,t,r)=>{var i,n,s;const o=e.controller_,a=null===(n=null===(i=o.parent)||void 0===i?void 0:i.children)||void 0===n?void 0:n.indexOf(o);return!(((e,t)=>t.controller_.rackController.rack===e.controller_.parent)(e,t)&&a===r||(void 0!==a&&a>=0&&(null===(s=o.parent)||void 0===s||s.remove(e)),t.add(e,r),0))},hT=(e,t,r,i)=>{var n,s,o,a,l;let c=t.uiRef;const u=null==c?void 0:c.expanded;if(c||(c=e.addFolder({title:""})).on("fold",e=>{var r,i,n;let s=c.expanded;m(t,"expanded",s,!0),(s=null!==(r=x(t.expanded))&&void 0!==r?r:s)!==c.expanded&&(c.expanded=s),null===(i=t.uiRefresh)||void 0===i||i.call(t,"postFrame",!0),s&&(null===(n=t.onExpand)||void 0===n||n.call(t,t))}),!c)return c;c.expanded=null!==(s=null!==(n=x(t.expanded))&&void 0!==n?n:u)&&void 0!==s&&s;const p=(null!==(o=t.children)&&void 0!==o?o:[]).map(e=>e&&x(e)).flat(2).filter(e=>e);let h=0;for(const m of p){let e=m.uiRef;e&&e.controller_.viewProps.get("disposed")&&(m.uiRef=void 0),(e=m.uiRef)||(r.appendUiObject({uiConfig:m},c),e=m.uiRef),e&&pT(e,c,h++)&&r.appendUiObject({uiConfig:m},c)}let d=c.children;for(;d.length>h;){const e=d[d.length-1];c.remove(e),d=c.children}c.controller_.props.set("title",null!==(a=x(t.label))&&void 0!==a?a:"");const f=c.controller_.view.containerElement,g=x(t.domChildren,[]);if(void 0!==(null==g?void 0:g.length)){const e=[];for(let t=0;t<f.children.length;t++){const r=f.children[t];(null===(l=r.dataset)||void 0===l?void 0:l.tpCustomDOM)&&e.push(r)}for(const t of e)f.removeChild(t);for(const t of g)t.parentElement!==f&&(f.appendChild(t),t.dataset.tpCustomDOM="true");c.controller_.foldable.cleanUpTransition()}return c},dT=(e,t,r,i)=>{var n,s;const[o,a]=null!==(n=t.property)&&void 0!==n?n:[void 0,void 0],l=null!==(s=x(t.label))&&void 0!==s?s:a;let c=t.uiRef;return c||(c=e.addButton({title:""})).on("click",async()=>{var e;const i=[];t.prompt&&i.push(await r.prompt(...t.prompt));const n=null!==(e=o&&a?o[a]:void 0)&&void 0!==e?e:t.value;if("function"==typeof n){const e=()=>{r.removeEventListener("postFrame",e),n.call(t,...i)};r.addEventListener("postFrame",e)}else console.warn("Invalid action type for button")}),c&&(c.title=null!=l?l:"click me"),c},fT=(e,t,r,i)=>{var n;const s=Object.fromEntries((null!==(n=x(t.children))&&void 0!==n?n:[]).map(e=>x(e)).flat(2).filter(e=>e).map(e=>{var t;const r=x(e.label);return[r,null!==(t=e.value)&&void 0!==t?t:r]}));return vT(e,t,r,{options:s,...null!=i?i:{}})},gT=(e,t,r,i)=>{var n,s;const o=x(t.bounds),a=(null!==(n=null==o?void 0:o.length)&&void 0!==n?n:0)>=2?o[1]:1,l=(null!==(s=null==o?void 0:o.length)&&void 0!==s?s:0)>=1?o[0]:0,c=t.stepSize||void 0;return vT(e,t,r,{min:l,max:a,step:c,...null!=i?i:{}})},mT=(e,t,r,n)=>{var s,o,a;const l=x(t.bounds);if(!l||l.length<1)return vT(e,t,r,{...null!=n?n:{}});const c=(null!==(s=l.length)&&void 0!==s?s:0)>=2?l[1]:1,u=(null!==(o=l.length)&&void 0!==o?o:0)>=1?l[0]:0,p={min:u,max:c,step:null!==(a=t.stepSize)&&void 0!==a?a:(c-u)/100},h={x:p,y:p};"vec3"!==t.type&&"vec4"!==t.type||(h.z=p),"vec4"===t.type&&(h.w=p);const d=t.property;if(void 0===t.value&&d&&d[0]&&"object"==typeof d[0]&&d[0][d[1]]&&Array.isArray(d[0][d[1]])){const[e,r]=d,n=e[r],s=n.length,o=(new(2===s?i.FM8:3===s?i.Pa4:i.Ltg)).fromArray(n);t.value=o,t.property=void 0,t.onChange=[()=>{e[r]=o.toArray()},...Array.isArray(t.onChange)?t.onChange:[t.onChange]].filter(e=>e),void 0===t.label&&(t.label=r)}return vT(e,t,r,{...h,...null!=n?n:{}})},_T=(e,t,r,i)=>{var n;const s=t.property;if(void 0===t.value&&s&&"object"==typeof s[0]&&(null===(n=s[0][s[1]])||void 0===n?void 0:n.isColor)){const[e,r]=s,i=(new xe).set(e[r]).convertSRGBToLinear();Object.defineProperty(t,"value",{get:()=>{const t=e[r];return t?i.set(t).convertLinearToSRGB().getHex():0},set:t=>{const n=e[r];i.setHex(t).convertSRGBToLinear(),n.isColor?n.copy(i):"number"==typeof n?e[r]=i.getHex():"string"==typeof n&&(e[r]="#"+i.getHexString()),"function"==typeof(null==e?void 0:e.setDirty)&&e.setDirty()}}),t.property=void 0,t.onChange=[...Array.isArray(t.onChange)?t.onChange:[t.onChange]].filter(e=>e),void 0===t.label&&(t.label=r)}return(i=null!=i?i:{}).view="color",x(t.inlinePicker)&&(i.picker="inline"),vT(e,t,r,i)},vT=(e,t,r,i)=>{var n;let s=x(t.property);if((t.getValue||t.setValue)&&s&&console.error("specify either property or value, or getValue and setValue",t),s)t.value&&console.warn("Both property and value are defined, value will be ignored",t);else if(void 0===t.value&&(t.getValue||t.setValue)&&(Object.defineProperty(t,"value",{get:()=>{var e;return null===(e=t.getValue)||void 0===e?void 0:e.call(t)},set:e=>{var r;return null===(r=t.setValue)||void 0===r?void 0:r.call(t,e)}}),s=[t,"value"]),s||void 0===t.value||(s=[t,"value"]),!s)return void console.error("cannot determine property",t);i=null!=i?i:{};const o={label:null!==(n=x(t.label))&&void 0!==n?n:s[1],...i};let a=t.uiRef;if(!a&&"object"==typeof s[0]&&s[0]){const[r,i]=s;try{a=t.isMonitor?e.addMonitor(r,i,o):e.addInput(r,i,o).on("change",e=>{[t.onChange].flat().forEach(t=>"function"==typeof t&&(null==t?void 0:t(e))),"function"==typeof(null==r?void 0:r.setDirty)&&r.setDirty(e)})}catch(e){if(!e.message.startsWith("No matching controller for"))throw e;a=void 0}}if(a){for(const[e,t]of Object.entries(o)){const r=a.controller_.props.value(e);void 0!==r&&r.rawValue!==t&&a.controller_.props.set(e,t)}"slider"===t.type&&(void 0!==o.min&&a.controller_.valueController.sliderController.props.set("minValue",o.min),void 0!==o.max&&a.controller_.valueController.sliderController.props.set("maxValue",o.max)),a.refresh()}return a};class xT extends r{constructor(e=!1,t=!1,r=!1,i=!0,n=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:hT,folder:hT,input:vT,slider:gT,dropdown:fT,checkbox:vT,color:_T,vec:mT,vec2:mT,vec3:mT,vec4:mT,button:dT,monitor:(e,t,r,i)=>(t.isMonitor=!0,vT(e,t,r,i)),dummy:(e,t,r,i)=>vT(e,t,r,i)},this.alert=(async e=>alert(e)),this.confirm=(async e=>confirm(e)),this.prompt=(async(e,t,r=!0)=>prompt(e,t)),this._expand=e,this._limitedOptions=r;const s=this._createUiContainer();n.appendChild(s),this._pane=new uT.Pane({title:"Configuration",container:s}),this._pane.expanded=this._expand,i&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],r=[],i=kt(),n=i-this._lastModeTime[e];t.forEach(e=>{e[2]>.001?(e[2]-=n,r.push(e)):this._refreshUiObject(e[0],e[1],e[2])}),this._refreshQueue[e]=r,this._lastModeTime[e]=i}addToRefreshQueue(e,t){var r;const i=null===(r=t[0])||void 0===r?void 0:r.uiConfig,n=null==i?void 0:i.uuid,s=this._refreshQueue[e],o=s.find(e=>e[3]===n);o?o[2]=Math.max(o[2],t[2]):s.push([...t,n]),this._refreshQueue[e]=s}dispose(){var e;null===(e=this._pane)||void 0===e||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var r,i,n,s;const{uiConfig:o}=null!=e?e:{};if(o&&(!this._limitedOptions||o.limitedUi)&&(t=null!=t?t:this._pane,o.type)){o.uuid||(o.uuid=We()),o.uiRef&&o.uiRefType!==o.type&&this.removeUiConfig(o);const a=null===(i=(r=this._typeGenerators)[o.type])||void 0===i?void 0:i.call(r,t,o,this);a&&(a.hidden=null!==(n=x(o.hidden))&&void 0!==n&&n,a.disabled=null!==(s=x(o.disabled))&&void 0!==s&&s),o.uiRef=a,o.uiRefType=a?o.type:void 0,o.uiRefresh=((r="postFrame",i=!1,n=0)=>{var s;return this._uiObjectRefresh(r,null!==(s=null==e?void 0:e.uiConfig)&&void 0!==s?s:o,t,i,n)})}}removeUiObject(e){this.removeUiConfig(null==e?void 0:e.uiConfig)}removeUiConfig(e){var t,r;e&&e.uiRef&&(null===(r=(t=e.uiRef).dispose)||void 0===r||r.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,r,i,n){(i?AT(t,r):[{uiConfig:t,parentFolder:r}]).forEach(t=>{const r=[{uiConfig:t.uiConfig},t.parentFolder,n];"immediate"===e?this._refreshUiObject(...r):this.addToRefreshQueue(e,r)})}_refreshUiObject(e,t,r=0){this._appendUiObject(e,t),r>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=Et({id:"tweakpaneUiContainer",addToBody:!1});return Ct(E`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function AT(e,t,r){var i;return r=null!=r?r:[],e?(r.push({uiConfig:e,parentFolder:t}),null===(i=e.children)||void 0===i||i.forEach(t=>r=AT(t,e.uiRef,r)),r):r}class bT{constructor(){bT.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,r,i,n,s,o,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=n,c[5]=a,c[6]=r,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,n=this.elements,s=r[0],o=r[3],a=r[6],l=r[1],c=r[4],u=r[7],p=r[2],h=r[5],d=r[8],f=i[0],g=i[3],m=i[6],_=i[1],v=i[4],x=i[7],A=i[2],b=i[5],y=i[8];return n[0]=s*f+o*_+a*A,n[3]=s*g+o*v+a*b,n[6]=s*m+o*x+a*y,n[1]=l*f+c*_+u*A,n[4]=l*g+c*v+u*b,n[7]=l*m+c*x+u*y,n[2]=p*f+h*_+d*A,n[5]=p*g+h*v+d*b,n[8]=p*m+h*x+d*y,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*s*c-t*o*l-r*n*c+r*o*a+i*n*l-i*s*a}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=c*s-o*l,p=o*a-c*n,h=l*n-s*a,d=t*u+r*p+i*h;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return e[0]=u*f,e[1]=(i*l-c*r)*f,e[2]=(o*r-i*s)*f,e[3]=p*f,e[4]=(c*t-i*a)*f,e[5]=(i*n-o*t)*f,e[6]=h*f,e[7]=(r*a-l*t)*f,e[8]=(s*t-r*n)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,s,o){const a=Math.cos(n),l=Math.sin(n);return this.set(r*a,r*l,-r*(a*s+l*o)+s+e,-i*l,i*a,-i*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.elements,n=i[0],s=i[3],o=i[6],a=i[1],l=i[4],c=i[7];return i[0]=t*n+r*a,i[3]=t*s+r*l,i[6]=t*o+r*c,i[1]=-r*n+t*a,i[4]=-r*s+t*l,i[7]=-r*o+t*c,this}translate(e,t){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function yT(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}let wT;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;class ET{constructor(e=null){this.isSource=!0,this.uuid=$(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,r=i.length;t<r;t++)i[t].isDataTexture?e.push(ST(i[t].image)):e.push(ST(i[t]))}else e=ST(i);r.url=e}return t||(e.images[this.uuid]=r),r}}function ST(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return class{static getDataURL(e,t=!1){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{void 0===wT&&(wT=yT("canvas")),wT.width=e.width,wT.height=e.height;const t=wT.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),r=wT}return!t&&(r.width>2048||r.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),r.toDataURL("image/jpeg",.6)):r.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=yT("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),n=i.data;for(let e=0;e<n.length;e++)n[e]=255*ce(n[e]/255);return r.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ce(t[e]/255)):t[e]=ce(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(e);if(e.data){let t=[];try{t=Array.from(e.data)}catch(r){r.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(r),t=e.data}return{data:t,width:e.width,height:e.height,type:e.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let CT=0;class MT extends class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e);e.target=null}}}{constructor(e=MT.DEFAULT_IMAGE,t=MT.DEFAULT_MAPPING,r=1001,i=1001,n=oe,s=1008,o=1023,a=1009,l=1,c=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:CT++}),this.uuid=$(),this.name="",this.source=new ET(e),this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new I(0,0),this.repeat=new I(1,1),this.center=new I(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bT,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}MT.DEFAULT_IMAGE=null,MT.DEFAULT_MAPPING=300;var TT=__webpackgi_require__(898),IT={};TT.Z&&TT.Z.locals&&(IT.locals=TT.Z.locals);var kT,DT=0,PT={};PT.styleTagTransform=oh(),PT.setAttributes=rh(),PT.insert=function(e,t){(t.target||document.head).appendChild(e)},PT.domAPI=eh(),PT.insertStyleElement=nh(),IT.use=function(e){return PT.options=e||{},DT++||(kT=Zp()(TT.Z,PT)),IT},IT.unuse=function(){DT>0&&!--DT&&(kT(),kT=null)};var BT=IT;class RT extends xT{constructor(e=!1,t=!1,r=!1,i=document.body){super(e,t,r,!1),this.dependencies=[so],this._preRender=(()=>this.refreshQueue("preRender")),this._postRender=(()=>this.refreshQueue("postRender")),this._postFrame=(e=>{this.dispatchEvent(e),this.refreshQueue("postFrame")}),this._preFrame=(()=>this.refreshQueue("preFrame")),this._plugins=[],this.alert=(async e=>this._viewer?this._viewer.alert(e):super.alert(e)),this.confirm=(async e=>this._viewer?this._viewer.confirm(e):super.confirm(e)),this.prompt=(async(e,t,r=!0)=>this._viewer?this._viewer.prompt(e,t,r):super.prompt(e,t,r)),this._pane.registerPlugin(lT),BT.use({target:i})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(e=>(t,r,n,s)=>{const o=r.property,a="placeholder";if(void 0===r.value&&o&&"object"==typeof o[0]){const[t,n]=o,s=sy("Render Target"),l=sy("Data Texture"),c=sy("CUBE Texture"),u=sy("Compressed Texture"),p={},h={};Object.defineProperty(r,"value",{get:()=>{var e;let r,i=t[n];if((null==i?void 0:i.get)&&(i=i.get()),!i)return a;if(i.isRenderTargetTexture&&!i.image.tp_src&&(i.image.tp_src=s),i.isDataTexture&&!i.image.tp_src&&(i.image.tp_src=l),i.isCompressedTexture&&!i.image.tp_src&&(i.image.tp_src=u),i.isTexture?(i.image&&(i.image instanceof ImageBitmap||i.image instanceof HTMLImageElement||i.image instanceof HTMLVideoElement)&&!i.image.tp_src&&(i.image.tp_src=Tt(i.image,160)),i.image&&((r=(r=i.image.tp_src_uuid)?p[r]:void 0)||(r=i.image.tp_src||i.image.src))):"string"==typeof i?r=i:i.domainMin?(r=i.texture,i.texture.image&&!i.texture.image.tp_src&&(i.texture.image.tp_src=c),i.texture.image&&((r=(r=i.texture.image.tp_src_uuid)?p[r]:void 0)||(r=i.texture.image.tp_src||i.texture.image.src))):i&&console.error("unknown value",i),r||(r=a),i.image&&!i.image.tp_src_uuid){const e=We();i.image.tp_src_uuid=e,h[r]=e}return"string"==typeof r&&(r=null!==(e=p[r])&&void 0!==e?e:r),r},set:s=>{var o,l,c,u,d,f,g,m,_,v,x;const A=t[n],b=e=>{var r;t[n]=e,(null==e?void 0:e.isTexture)&&(e.flipY=e.isDataTexture?e.flipY:null===(r=null==A?void 0:A.flipY)||void 0===r||r)};if("string"==typeof s)return void("string"==typeof A&&b(s));if(!s)return void(r.value=a);if(s.isPlaceholder)return void(A&&(b("string"==typeof A?"":null),"function"==typeof(null==t?void 0:t.setDirty)&&t.setDirty()));let y=s.tp_src_uuid;if(y||(y=null!==(o=s.src)&&void 0!==o?o:s.tp_src,y=null!==(l=h[y])&&void 0!==l?l:y,delete h[y],s.tp_src_uuid=y),y&&(p[y]=s),"string"!=typeof A){if(!((null==A?void 0:A.image)===s||(null===(c=null==A?void 0:A.image)||void 0===c?void 0:c.src)===s.src||(null===(u=null==A?void 0:A.image)||void 0===u?void 0:u.tp_src)===s.tp_src&&null!=s.tp_src||(null===(d=null==A?void 0:A.image)||void 0===d?void 0:d.tp_src)===s.src&&null!=s.src||(null===(f=null==A?void 0:A.image)||void 0===f?void 0:f.src)===s.tp_src&&null!=s.tp_src))if(s instanceof File){const i=null==e?void 0:e.getPlugin(so);if(!i)throw"Viewer or AssetManagerPlugin not found";null===(g=i.importer)||void 0===g||g.importSingle({file:s,path:s.src}).then(e=>{var i,n,o,a;if(e){e.isDataTexture&&(e.needsUpdate=!0);const l=null===(o=null===(n=null===(i=s.src)||void 0===i?void 0:i.split("?"))||void 0===n?void 0:n[0])||void 0===o?void 0:o.split(".").pop();e.userData&&(e.userData.mimeType||(e.userData.mimeType="image/"+(["jpg","jpeg"].includes(l)?"jpeg":"png"))),b(e),[r.onChange].flat().forEach(e=>"function"==typeof e&&(null==e?void 0:e())),"function"==typeof(null==t?void 0:t.setDirty)&&t.setDirty(),null===(a=r.uiRefresh)||void 0===a||a.call(r,"postFrame",!1)}})}else{const e=new MT(s);e.assetType="texture",e.needsUpdate=!0;const o=null===(v=null===(_=null===(m=s.src)||void 0===m?void 0:m.split("?"))||void 0===_?void 0:_[0])||void 0===v?void 0:v.split(".").pop();e.userData.mimeType||(e.userData.mimeType="image/"+(["jpg","jpeg"].includes(o)?"jpeg":"png")),b(e);const a=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(n);e.encoding=a?i.rnI:i.knz,e.wrapS=i.rpg,e.wrapT=i.rpg,[r.onChange].flat().forEach(e=>"function"==typeof e&&(null==e?void 0:e())),"function"==typeof(null==t?void 0:t.setDirty)&&t.setDirty(),null===(x=r.uiRefresh)||void 0===x||x.call(r,"postFrame",!1)}}else b(y)}}),r.property=void 0,void 0===r.label&&(r.label=n)}return(s=null!=s?s:{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],void 0===s.imageFit&&(s.imageFit="contain"),void 0===s.clickCallback&&(s.clickCallback=((t,s)=>{var l;const c=null==t?void 0:t.target,u=null==c?void 0:c.getBoundingClientRect();if(!u)return void s.click();const p=r.uiRef.controller_.valueController.value.rawValue,h=p===a||(null==p?void 0:p.isPlaceholder)?{}:{"remove image":()=>{var e;r.uiRef.controller_.valueController.value.setRawValue("");const[t,i]=o||[r,"value"],n="string"==typeof t[i];t[i]=n?"":null,[r.onChange].flat().forEach(e=>"function"==typeof e&&(null==e?void 0:e())),"function"==typeof(null==t?void 0:t.setDirty)&&t.setDirty(),null===(e=r.uiRefresh)||void 0===e||e.call(r,"postFrame",!1),cT.Remove()},"download image":()=>{var e,t,i;const[n,s]=o||[r,"value"];let a=null!==(t=null===(e=n[s])||void 0===e?void 0:e.image)&&void 0!==t?t:r.uiRef.controller_.valueController.value.rawValue;a&&(a instanceof ImageBitmap||a instanceof HTMLImageElement||a instanceof HTMLVideoElement)&&!a.src&&(a=Tt(a));const l=document.createElement("a");document.body.appendChild(l),l.style.display="none",l.href=null!==(i=null==a?void 0:a.src)&&void 0!==i?i:a,l.download="image.png",l.click(),document.body.removeChild(l),cT.Remove()}},d=cT.Create({...h,"set/replace image":()=>{s.click(),cT.Remove()},"from url":async()=>{var t,s;let a="";if(a&&(a.startsWith("http")||a.startsWith("data:image"))||(a=""),!(a=await n.prompt("Load texture: Enter Image/Texture URL",a,!0))||!a.startsWith("http")&&!a.startsWith("data:image"))return null!==a&&await n.alert("Loading Image: Invalid URL"),void cT.Remove();const[l,c]=o||[r,"value"],u=l[c];if("string"==typeof u)l[c]=a,[r.onChange].flat().forEach(e=>"function"==typeof e&&(null==e?void 0:e())),"function"==typeof(null==l?void 0:l.setDirty)&&l.setDirty(),null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!1);else{const t=null==e?void 0:e.getPlugin(so);if(!t)throw"Viewer or AssetManagerPlugin not found";null===(s=t.importer)||void 0===s||s.importSinglePath(a).then(e=>{var t;if(e){e.isDataTexture?e.needsUpdate=!0:e&&void 0!==(null==u?void 0:u.flipY)&&(e.flipY=u.flipY),l[c]=e;const n=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(c);e.encoding=n?i.rnI:i.knz,[r.onChange].flat().forEach(e=>"function"==typeof e&&(null==e?void 0:e())),"function"==typeof(null==l?void 0:l.setDirty)&&l.setDirty(),null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!1)}})}cT.Remove()},cancel:()=>{cT.Remove()}},2,u.height+8);null===(l=c.parentElement)||void 0===l||l.appendChild(d),u.y>.7*document.body.clientHeight&&(d.style.top="auto",d.style.bottom=u.height+8+"px")})),s.view="input-image",vT(t,r,n,s)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var t;const r=null===(t=this._viewer)||void 0===t?void 0:t.getPlugin(e);if(!r)return void console.warn("plugin not found:",e);this._plugins.push(r),r.uiConfig&&(r.uiConfig.limitedUi=!0),r.uiConfig&&void 0===r.uiConfig.hidden&&(r.uiConfig.hidden=!1),this._appendUiObject(r);const i=r.uiConfig;if((null==i?void 0:i.uiRef)&&r.toJSON){const e=i.uiRef.controller_.view.element,t=Et({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});t.onclick=(t=>{const i={};"function"==typeof r.toJSON&&(i["download preset"]=(async()=>{var e,t;const i=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(so))||void 0===t?void 0:t.exportPluginPreset(r);await At(new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),"preset."+r.constructor.PluginType+".json"),cT.Remove()})),"function"==typeof r.fromJSON&&(i["upload preset"]=(async()=>{var e,t;cT.Remove();const i=await wt(!1,!1);if(0===i.length)return;const n=i[0],s=await n.text(),o=JSON.parse(s);await(null===(t=null===(e=this._viewer)||void 0===e?void 0:e.getPlugin(so))||void 0===t?void 0:t.importPluginPreset(o,r))}));const n=cT.Create(i,e.clientWidth-120,12);e.append(n),t.preventDefault()}),e.appendChild(t)}return i}setupPlugins(...e){e.forEach(e=>this.setupPluginUi(e))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var t;const r=e.uiConfig;r&&(!0!==x(r.hidden)?null===(t=r.uiRefresh)||void 0===t||t.call(r,"postFrame",!0):r.uiRef&&(r.uiRef.hidden=!0))})}}RT.PluginType="TweakpaneUi";class LT extends oo{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,srgb:!1,onChange:()=>{if(!this._viewer)return;const e=new xe(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;null===(e=this._viewer)||void 0===e||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const t=null===(e=this._viewer)||void 0===e?void 0:e.getBackground();return t&&(t.isTexture||"texture"===t.assetType)?t:null}set sceneBackground(e){var t,r;e?null===(t=this._viewer)||void 0===t||t.setBackground(e):null===(r=this._viewer)||void 0===r||r.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return null===(e=this._viewer)||void 0===e?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var t;null===(t=this._viewer)||void 0===t||t.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,t,r;return null!==(r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.getEnvironment())||void 0===t?void 0:t.rotation)&&void 0!==r?r:0}set sceneEnvironmentRotation(e){var t,r;const i=null===(t=this._viewer)||void 0===t?void 0:t.scene.getEnvironment();i&&(i.rotation=e,null===(r=this._viewer)||void 0===r||r.scene.setDirty())}get sceneEnvironmentIntensity(){var e,t;return null!==(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.envMapIntensity)&&void 0!==t?t:1}set sceneEnvironmentIntensity(e){var t;(null===(t=this._viewer)||void 0===t?void 0:t.scene)&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return(null===(e=this._viewer)||void 0===e?void 0:e.getBackground(!0))===yo}set envmapBg(e){if(this._viewer)if(e){const e=this._viewer.getBackground(!0);e&&e!==yo&&(this.lastBgVal=e),this._viewer.setBackground(yo)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var t;await super.onAdded(e);const r=e.getBackground();this.bgUIConfig.value="string"==typeof r&&r!==yo||"number"==typeof r||(null===(t=r)||void 0===t?void 0:t.isColor)?"#"+new xe(r).convertLinearToSRGB().getHexString():"#000000",this.lastBgVal=r}}LT.PluginType="SimpleBackgroundEnvUiPlugin1";class OT extends oo{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,t;null===(t=(e=this._uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;null===(e=this._viewer)||void 0===e||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;null===(e=this._viewer)||void 0===e||e.setDirty()}get uiConfig(){var e,t,r;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...null!==(r=null===(t=null===(e=this._viewer)||void 0===e?void 0:e.scene.modelRoot.modelObject.children)||void 0===t?void 0:t.map(e=>"light"===e.assetType?null:e.uiConfig).filter(e=>null!=e))&&void 0!==r?r:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,t;null===(t=null===(e=this._uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}}OT.PluginType="SimpleUi";var FT=__webpackgi_require__(1),UT=__webpackgi_require__.n(FT)();class NT extends oo{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=Et({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=((e,t)=>(e.push({text:t.name||"unnamed",id:t.uuid,children:t.children.reduce(this._buildData,[])}),e)),this._findVisible=((e,t)=>t.visible?(t.children.length<1?e.push(t.uuid):e.push(...t.children.reduce(this._findVisible,[])),e):e),this._setVisible=(e=>{var t,r,i;const n=null===(t=this._viewer)||void 0===t?void 0:t.scene.modelRoot;if(!n||null==e)return;const s=new Set;n.traverse(t=>{t!==n&&(t.visible=e.includes(t.uuid),t.visible&&t.traverseAncestors(e=>s.add(e)))}),s.forEach(e=>e.visible=!0),null===(i=null===(r=this._viewer)||void 0===r?void 0:r.scene)||void 0===i||i.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})}),this.enabled=e,this.reset=this.reset.bind(this),Ct(E`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var t;if(null==e?void 0:e.fromHierarchyPlugin)return;if(!(null==e?void 0:e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const r=null===(t=this._viewer)||void 0===t?void 0:t.scene.modelRoot;if(!r)return;const i=r.children.reduce(this._buildData,[]),n=r.children.reduce(this._findVisible,[]);let s=!1;return new Promise((e,t)=>{this.treeView=new UT(this.hierarchyDiv,{closeDepth:1,data:i,loaded:function(){this.values=n,e()},onChange:()=>{s?Tc(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):s=!0},onItemLabelClick:e=>{var t;const i=null===(t=this._viewer)||void 0===t?void 0:t.scene.modelRoot.modelObject.getObjectByProperty("uuid",e);i&&r.visible&&i.dispatchEvent({type:"select",value:i,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}NT.PluginType="HierarchyUiPlugin";class jT extends oo{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Ys;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[so],this._sceneUpdate=(e=>{var t,r,i;if(!e.hierarchyChanged)return;const n=[];null===(t=this._viewer)||void 0===t||t.traverseSceneObjects(e=>{if(!e.lightObject)return;const t=e.uiConfig;t&&!n.includes(t)&&n.push(t)}),[...this.uiConfig.children].forEach(e=>{var t;"button"===(null===(t=e)||void 0===t?void 0:t.type)||n.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)}),n.forEach(e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)}),null===(i=(r=this.uiConfig).uiRefresh)||void 0===i||i.call(r,"postFrame",!0)})}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}jT.PluginType="SimpleLightsUi";class GT extends oo{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[so],this._sceneUpdate=(e=>{var t,r,i;if(!e.hierarchyChanged)return;const n=[];null===(t=this._viewer)||void 0===t||t.traverseSceneObjects(e=>{if(!e.cameraObject)return;const t=e.uiConfig;t&&!n.includes(t)&&n.push(t)}),[...this.uiConfig.children].forEach(e=>{var t;"button"===(null===(t=e)||void 0===t?void 0:t.type)||n.includes(e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(e),1)}),n.forEach(e=>{this.uiConfig.children.includes(e)||this.uiConfig.children.push(e)}),null===(i=(r=this.uiConfig).uiRefresh)||void 0===i||i.call(r,"postFrame",!0)})}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}GT.PluginType="SimpleSceneCamerasUi";var zT,VT=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};let QT=zT=class extends oo{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var e;if(!this._viewer)return;const t={width:Math.round(this.width),height:Math.round(this.height)},r=this._viewer.container.getBoundingClientRect();t.width>=r.width&&delete t.width,t.height>=r.height&&delete t.height,null===(e=this._viewer)||void 0===e||e.setSize(t),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(e){await super.onAdded(e);const t=e.canvas.clientWidth,r=e.canvas.clientHeight,i=e.renderer.displayCanvasScaling;this.width=t,this.height=r,this.scale=i,e.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(e){return this.removeEventListener("deserialize",this._sizeChanged),e.renderer.removeEventListener("resize",this._refresh),super.onRemove(e)}_refresh(){var e,t;null===(t=null===(e=this.uiConfig)||void 0===e?void 0:e.uiRefresh)||void 0===t||t.call(e,"postFrame",!0)}toJSON(e){const t=super.toJSON(e),r=this._viewer.container.getBoundingClientRect();return t.width>=r.width&&delete t.width,t.height>=r.height&&delete t.height,t}};QT.PluginType="RendererParamsUiPlugin",VT([Ce(),M(zT.prototype._sizeChanged),Je("Width",void 0,1,e=>({bounds:()=>{var t;return[10,(null===(t=e._viewer)||void 0===t?void 0:t.container.getBoundingClientRect().width)||1024]}}))],QT.prototype,"width",void 0),VT([Ce(),M(zT.prototype._sizeChanged),Je("Height",void 0,1,e=>({bounds:()=>{var t;return[10,(null===(t=e._viewer)||void 0===t?void 0:t.container.getBoundingClientRect().height)||1024]}}))],QT.prototype,"height",void 0),VT([Ce(),M(zT.prototype._sizeChanged),Je("Scale",[.25,4],.25,{limitedUi:!0})],QT.prototype,"scale",void 0),QT=zT=VT([ot("Renderer")],QT);class HT extends oo{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var t;const r=super.toJSON(e);return r.activeCamera=null===(t=this._viewer)||void 0===t?void 0:t.scene.activeCamera.toJSON(),r}fromJSON(e,t){var r;return e.activeCamera&&(null===(r=this._viewer)||void 0===r||r.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&(null===(t=(e=this.uiConfig).uiRefresh)||void 0===t||t.call(e,"postFrame",!0))}get uiConfig(){var e;return(null===(e=this._viewer)||void 0===e?void 0:e.scene.activeCamera.uiConfig)||{}}}HT.PluginType="CameraUiPlugin";var WT={create:e=>{let t="button"+(e.type?" "+e.type:""),r=XT.createDiv(t,e.text);return r.addEventListener("click",e.onClick),r}};let qT={createElement:(e,t,r,i)=>{let n=document.createElement(e);if(t&&(n.className=t),r&&(n.innerHTML=r),i)for(let s in i)n.setAttribute(s,i[s]);return n},createDiv:(e,t,r)=>qT.createElement("div",e,t,r),createDomTree:e=>{if(!e||!e.hasOwnProperty("dom"))return e;let t=e.dom;if(e.children)for(let r in e.children)e.children[r]&&t.appendChild(qT.createDomTree(e.children[r]));return t},removeElement:e=>{null!=e&&e.parentNode.removeChild(e)},appendToBody:e=>{document.body.appendChild(e)},makeIconHTML:e=>{let t="";return"ok"==e&&(t="#tick"),"error"==e&&(t="#cancel"),"info"==e&&(t="#info-button"),"caution"==e&&(t="#danger"),"min"==e&&(t="#line"),"close"==e&&(t="#close"),`<svg class="icon ${e}"><use xlink:href="${t}" /></svg>`},makeNftContent:e=>{let t=null;if(e.type){let r=null;r="string"==typeof e.content?qT.createDiv("inner-content",e.content):qT.createDomTree({dom:qT.createDiv("inner-content"),children:[e.content]}),t="text"==e.type?qT.createDomTree({dom:qT.createDiv("content text"),children:[r]}):qT.createDomTree({dom:qT.createDiv("content"),children:[qT.createDiv("state",qT.makeIconHTML(e.type)),r]})}else"string"==typeof e.content&&(t=qT.createDiv("content",e.content));return t},standardizeButtons:(e,t)=>{let r=[];if(void 0===t.buttons)return"caution"!=t.type&&"info"!=t.type||r.push({key:27,text:"Cancel",onClick:e.close.bind(e,"cancel")}),r.push({key:13,text:"OK",type:"main",onClick:e.close.bind(e,"ok")}),r;(r=t.buttons).constructor!==Array&&(r=[r]);for(let i in r)!r[i].onClick&&(r[i].onClick=e.close.bind(e,r[i].id));return r},makeButtons:e=>{let t=[];if(e)for(let r in e)t.push(WT.create({text:e[r].text?e[r].text:"OK",type:e[r].normal?null:"main",onClick:e[r].onClick}));return qT.createDomTree({dom:qT.createDiv("button-wrapper"),children:t})},bindButtonKeyEvents:e=>{let t=t=>{for(let r in e)if(e[r].key===t.keyCode)return void e[r].onClick()};return window.addEventListener("keydown",t),t},unbindButtonKeyEvents:e=>{window.removeEventListener("keydown",e)}};var XT=qT,YT=__webpackgi_require__(476),KT={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let JT={};JT.overlay_in=[new YT.Frame(KT["wwise-overlay-in-1"],0),new YT.Frame(KT["wwise-overlay-in-2"],400)],JT.overlay_out=[new YT.Frame(KT["wwise-overlay-out-1"],300)],JT.pop_in=[new YT.Frame(KT["wwise-pop-in-1"],0),new YT.Frame(KT["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new YT.Frame(KT["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new YT.Frame(KT["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],JT.pop_out=[new YT.Frame(KT["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],JT.flip_in=[new YT.Frame(KT["wwise-flip-in-1"],0),new YT.Frame(KT["wwise-flip-in-2"],500)],JT.flip_out=[new YT.Frame(KT["wwise-flip-out-1"],400)],JT.min_in=[new YT.Frame(KT["wwise-min-in-1"],0),new YT.Frame(KT["wwise-min-in-2"],350)],JT.min_out=[new YT.Frame(KT["wwise-min-out-1"],400)];let ZT=["top","bottom","left","right"];for(let ck in ZT){let e=ZT[ck];JT[e+"_in"]=[new YT.Frame(KT["wwise-"+e+"-in-1"],0),new YT.Frame(KT["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],JT[e+"_out"]=[new YT.Frame(KT["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var $T=JT;let eI={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class tI{static create(e,t){let r=e.getElementsByClassName("title")[0];r&&(r=r.innerHTML);let i=e.getElementsByClassName("content")[0];return i&&(i=i.innerHTML),XT.removeElement(e),t.title=r,t.content=i,new tI(t)}constructor(e){this.options=JSON.parse(JSON.stringify(eI));for(let a in e)null!=e[a]&&(this.options[a]=e[a]);let t=this.options.position;if(-1==t.indexOf(" ")&&("left"==t||"right"==t?t+=" center":t="top"==t||"bottom"==t?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let e=document.getElementsByClassName("wwise-overlay");e.length?(this.overlay=e[0],this.hasOverlay=!0):(this.overlay=XT.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let r="content";if(this.options.topbar){let e=[];this.options.topbar.showMin&&(e.push(XT.createDiv(null,XT.makeIconHTML("min"))),e[e.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(e.push(XT.createDiv(null,XT.makeIconHTML("close"))),e[e.length-1].addEventListener("click",this.close.bind(this,void 0)));let t=null;t="string"==typeof this.options.title?XT.createDiv("title",this.options.title):XT.createDomTree({dom:XT.createDiv("title"),children:[this.options.title]}),this.topbar=XT.createDomTree({dom:XT.createDiv("topbar"),children:[{dom:XT.createDiv("control"),children:e.map(e=>({dom:e}))},{dom:t},{dom:XT.createDiv("clear")}]})}else r+=" no-topbar";"string"==typeof this.options.content?this.content=XT.createDomTree({dom:XT.createDiv(r,this.options.content)}):this.content=XT.createDomTree({dom:XT.createDiv(r),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=XT.createDomTree({dom:XT.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let i=XT.createDiv("wwise-wrapper");this.options.zIndex&&(i.style.zIndex=this.options.zIndex),this.wrapper=XT.createDomTree({dom:i,children:[this.window]}),this.dom=XT.createDomTree({dom:XT.createDiv(),children:[this.wrapper]});let n=this.options.position.split(" "),s=-50,o=-50;if("left"==n[0]?(s=0,this.wrapper.classList.add("left")):"right"==n[0]?(s=-100,this.wrapper.classList.add("right")):"center"==n[0]?this.wrapper.classList.add("h-center"):this.wrapper.style.left=n[0],"top"==n[1]?(o=0,this.wrapper.classList.add("top")):"bottom"==n[1]?(o=-100,this.wrapper.classList.add("bottom")):"center"==n[1]?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${s}%, ${o}%)`,this.options.style)for(let a in this.options.style)this.window.style[a]=this.options.style[a];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(e=>{this.promiseResolve=e}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){"min"!=t&&"flip"!=t||this.dom.classList.add("wwise-perspective");let e=[new YT.Queue(this.wrapper,$T[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&e.push(new YT.Queue(this.overlay,$T.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(e).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){"min"!=t&&"flip"!=t||this.dom.classList.add("wwise-perspective");let e=[new YT.Queue(this.wrapper,$T[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&e.push(new YT.Queue(this.overlay,$T.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(e).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(XT.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),XT.appendToBody(this.dom)}removeDoms(){XT.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(XT.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},r=window.getComputedStyle(this.wrapper),i=this.options.draggable,n=parseFloat(r.left),s=parseFloat(r.top);if(-1!=r.left.indexOf("%")){n=(n=r.left).substr(0,n.length-1),n=parseInt(n);let e=window,t=document,i=t.documentElement,s=t.getElementsByTagName("body")[0];n=n*(e.innerWidth||i.clientWidth||s.clientWidth)/100}if(-1!=r.top.indexOf("%")){s=(s=r.top).substr(0,s.length-1),s=parseInt(s);let e=window,t=document,i=t.documentElement,n=t.getElementsByTagName("body")[0];s=s*(e.innerHeight||i.clientHeight||n.clientHeight)/100}1!=i&&"horizontal"!=i||(this.wrapper.style.left=n+t.x+"px"),1!=i&&"vertical"!=i||(this.wrapper.style.top=s+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&"HTML"!=t.nodeName||(this.inDragging=!1)}}var rI=tI,iI=class{constructor(e){let t=this.options=e;!t.type&&(t.type="ok");let r={topbar:!1};r.content=this.constructContent({type:t.type,title:t.title,text:t.text,content:t.content,buttons:t.buttons}),r.overlay=!0,r.keepOverlay=t.keepOverlay,r.clickOverlayToClose=!1,r.animation=t.animation,r.zIndex=t.zIndex,this.wwise=new rI(r)}constructContent(e){let t=XT.createDiv("modal"),r=XT.createDomTree({dom:XT.createDiv("main "+e.type),children:[XT.createDiv(null,XT.makeIconHTML(e.type)),XT.createDiv("title",e.title),XT.createDiv("text",e.text)]});this.buttonArr=XT.standardizeButtons(this,e);let i=XT.makeButtons(this.buttonArr),n=null;e.content&&(n="string"==typeof e.content?XT.createDiv(null,e.content):e.content);let s=null;return i.innerHTML&&(s=XT.createDomTree({dom:XT.createDiv("operation "+e.type),children:[i]})),n||s||r.classList.add("no-op"),XT.createDomTree({dom:t,children:[r,n,s]})}open(){if(this.wwise.opened)return;let e=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=XT.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),e}close(e){if(this.wwise.opened)return this.value=e,XT.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let nI={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},sI={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var oI=__webpackgi_require__(513),aI={};oI.Z&&oI.Z.locals&&(aI.locals=oI.Z.locals);var lI,cI=0,uI={};uI.styleTagTransform=oh(),uI.setAttributes=rh(),uI.insert=function(e,t){(t.target||document.head).appendChild(e)},uI.domAPI=eh(),uI.insertStyleElement=nh(),aI.use=function(e){return uI.options=e||{},cI++||(lI=Zp()(oI.Z,uI)),aI},aI.unuse=function(){cI>0&&!--cI&&(lI(),lI=null)};var pI=aI;class hI extends oo{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},XT.appendToBody=(t=>{e.container.appendChild(t)}),XT.makeIconHTML=(e=>""),pI.use({target:e.container}),e.alert=(async e=>{const t=null==e?void 0:e.split(":")[0],r=new iI({type:"info",title:null!=t?t:"&ndsp;",text:(null==e?void 0:e.replace(t+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return r.open(),r.getPromise()}),e.confirm=(async e=>{const t=null==e?void 0:e.split(":")[0],r=new iI({type:"info",title:null!=t?t:"&ndsp;",text:(null==e?void 0:e.replace(t||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return r.open(),"yes"===await r.getPromise()}),e.prompt=(async(e,t,r=!0)=>{const i=null==e?void 0:e.split(":")[0],n=new class{constructor(e){this.options=JSON.parse(JSON.stringify(nI));for(let n in e)null!=e[n]&&(this.options[n]=e[n]);let t=this.options,r=JSON.parse(JSON.stringify(sI));for(let n in r)t.hasOwnProperty(n)&&(r[n]=t[n]);let i=[];t.showCancel&&i.push({key:27,text:t.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),i.push({key:13,text:t.okText,onClick:this.handleOk.bind(this)}),r.buttons=i,this.input=XT.createElement("input","input",null,{placeholder:t.placeholder}),this.error=XT.createDiv("error"),r.content=XT.createDomTree({dom:XT.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new iI(r)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},e=>{this.error.innerText=e}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let e=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((e,t)=>{this.promiseResolve=e,this.promiseReject=t}),e}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:null!=i?i:"&ndsp;",placeholder:null!=t?t:"",showCancel:r,animation:"overlay",text:(null==e?void 0:e.replace(i||"","").replace(":",""))||""});return n.open(),await n.getPromise().catch(async()=>null)})}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}hI.PluginType="WindowiseDialogPlugin";class dI extends oo{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>{var e;return{label:((null===(e=this._viewer)||void 0===e?void 0:e.useRgbm)?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var e,t;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&Bt("rgbm",(null===(t=this._viewer)||void 0===t?void 0:t.useRgbm)?"no":"yes",!0)}}},()=>{var e;return{label:((null===(e=this._viewer)||void 0===e?void 0:e.getPluginByType("debug"))?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var e,t;await(null===(e=this._viewer)||void 0===e?void 0:e.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&Bt("debug",(null===(t=this._viewer)||void 0===t?void 0:t.getPluginByType("debug"))?null:"true",!0)}}}]}}}dI.PluginType="ExtrasUiPlugin1";var fI=iw({defaultModifiers:[ow,pw,fw,gw]}),gI=__webpackgi_require__(388),mI=__webpackgi_require__.n(gI);function _I(e){const t=[];e.traverse(e=>{e.geometry&&t.push(e)});const r={},i={};t.forEach(e=>{var t;if(!r[e.geometry.uuid]){const t=e.geometry.toJSON().data,i=t?mI()({a:t.attributes||{},b:t.index||[]}):"";r[e.geometry.uuid]=i}const n=r[e.geometry.uuid],s=null!==(t=i[n])&&void 0!==t?t:i[n]=[];s.includes(e)||s.push(e)}),Object.values(i).forEach(e=>{if(e.length<2)return;const t=e[0].geometry;e.forEach((e,r)=>{r<1||(e.geometry.dispose(),e.geometry=t)})})}const vI=new i.Pa4,xI=new i.Pa4,AI=new i.Pa4,bI=new i.Pa4,yI=new i.Pa4,wI=new i.Pa4;let EI=1;const SI=new i.Pa4(0,1,0);class CI extends pt{constructor(e,t){super(e,t),this.targetOffset=new i.Pa4(0,0,0);const r=this.update;this.update=(()=>this._update(r))}_update(e){this.target.add(this.targetOffset),vI.copy(this.object.position).sub(this.target),EI=vI.length(),wI.copy(this.target);const t=e();return wI.sub(this.target),vI.copy(this.object.position).sub(this.target),EI/=vI.length(),this.target.add(wI),this.object.position.copy(this.target).add(vI),vI.normalize(),xI.crossVectors(SI,vI).normalize(),AI.crossVectors(vI,xI).normalize(),bI.crossVectors(xI,AI).normalize().negate(),xI.length()>.1&&this.object.up.crossVectors(vI.clone().normalize(),xI),this.enablePan&&(yI.set(0,0,0).addScaledVector(xI,wI.x).addScaledVector(AI,wI.y).addScaledVector(bI,wI.z),this.targetOffset.add(yI),this.targetOffset.multiplyScalar(1/EI)),yI.set(0,0,0).addScaledVector(xI,-this.targetOffset.x).addScaledVector(AI,-this.targetOffset.y).addScaledVector(bI,-this.targetOffset.z),this.object.lookAt(yI.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class MI extends Na{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new i.cJO(1,0))}}function TI(e,t){var r,i;const n=Array.from((null!==(r=e.access)&&void 0!==r?r:"").split(".")),s=n.pop();let o=null!==(i=e.targetObject)&&void 0!==i?i:t;if(!s||0===s.length)return{key:void 0,tar:o};if((o=_(n,o))&&!(s in o))throw console.error("invalid key",s,o,t,e),"";return{key:s,tar:o}}function II(e,t,r,i){const{key:n,tar:s}=TI(e,t);return n&&s?Ic(s,n,()=>{var t;r&&(null===(t=e.updater)||void 0===t?void 0:t.length)&&e.updater.forEach(e=>r[e]()),null==i||i()}):r=>console.warn("Unable to set ",r,n,s,e,t)}async function kI(e,t,r){var i,n,s,o;const{key:a,tar:l}=TI(t,e),c=t.animSet?[DI(l,t.animSet,r,null!==(i=t.animSetParallel)&&void 0!==i&&i)]:[];if(a&&l){const e=null!==(o=t.updater)&&void 0!==o?o:[],i=async()=>Dc(l,a,{...t,onUpdate:i=>{var n;null===(n=t.onUpdate)||void 0===n||n.call(t,i),e.forEach(e=>{var t;return null===(t=r[e])||void 0===t?void 0:t.call(r)})}});t.delay?c.push(Tc(t.delay).then(i)):c.push(i())}else(t.duration||t.delay)&&c.push(Tc((null!==(n=t.delay)&&void 0!==n?n:0)+(null!==(s=t.duration)&&void 0!==s?s:0)));return 1===c.length?c[0]:Promise.all(c)}async function DI(e,t,r,i=!1){if(i)return Promise.all(t.map(async t=>kI(e,t,r)));for(const n of t)await kI(e,n,r)}function PI(e,t,r,i){var n,s,o,a,l,c,u;if(!e)return;t||(t=[]);const p=null!=i?i:{},h=e;for(let d=0,f=t.length;d<f;d++){const e=t[d];if(e.uiRef){const t=null!==(l=null==h?void 0:h.indexOf(e.uiRef))&&void 0!==l?l:-1;t!==d&&(t>=0&&(null==h||h.splice(t,1)),null==h||h.splice(d,0,e.uiRef))}else{e.uiRef={type:"folder",label:null!==(n=e.name)&&void 0!==n?n:"Animation "+d,children:[]};const t=[{type:"button",label:"animate",value:()=>{kI(r,e,p).then(()=>{var t;return console.log((null===(t=e.uiRef)||void 0===t?void 0:t.label)+" finished")})}}];void 0!==e.access&&t.push({type:"input",property:[e,"access"]}),void 0!==e.from&&t.push({type:null!==(s=e.uiObjectType)&&void 0!==s?s:"input",property:[e,"from"],onChange:()=>{var t;II(e,r)(e.from),null===(t=e.updater)||void 0===t||t.forEach(e=>e in p&&p[e]())}}),void 0!==e.to&&t.push({type:null!==(o=e.uiObjectType)&&void 0!==o?o:"input",property:[e,"to"],onChange:()=>{var t;II(e,r)(e.to),null===(t=e.updater)||void 0===t||t.forEach(e=>e in p&&p[e]())}}),void 0!==e.duration&&t.push({type:"input",property:[e,"duration"]}),e.animSet&&(e.animSetParallel||(e.animSetParallel=!1),t.push({type:"input",label:"run parallel",property:[e,"animSetParallel"]})),e.animSet&&t.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),null===(a=e.uiRef.children)||void 0===a||a.push(...t),null==h||h.splice(d,0,e.uiRef)}const f=null===(c=e.uiRef.children)||void 0===c?void 0:c.map(e=>x(e)).flat(2).find(e=>null==e?void 0:e.animSetContainer);e.animSet&&f&&PI(f.children,e.animSet,null!==(u=e.targetObject)&&void 0!==u?u:r,i)}}function BI(e,t){return t?e*(1e3/t):0}function RI(e){var t,r=e.from,i=void 0===r?0:r,n=e.velocity,s=void 0===n?0:n,o=e.min,a=e.max,l=e.power,c=void 0===l?.8:l,u=e.timeConstant,p=void 0===u?750:u,h=e.bounceStiffness,d=void 0===h?500:h,f=e.bounceDamping,g=void 0===f?10:f,m=e.restDelta,_=void 0===m?1:m,v=e.modifyTarget,x=e.driver,A=e.onUpdate,b=e.onComplete;function y(e){return void 0!==o&&e<o||void 0!==a&&e>a}function w(e){return void 0===o?a:void 0===a||Math.abs(o-e)<Math.abs(a-e)?o:a}function E(e){null==t||t.stop(),t=Cc(ol(ol({},e),{driver:x,onUpdate:function(t){var r;null==A||A(t),null===(r=e.onUpdate)||void 0===r||r.call(e,t)},onComplete:b}))}function S(e){E(ol({type:"spring",stiffness:d,damping:g,restDelta:_},e))}if(y(i))S({from:i,velocity:s,to:w(i)});else{var C=c*s+i;void 0!==v&&(C=v(C));var M,T,I=w(C),k=I===o?-1:1;E({type:"decay",from:i,velocity:s,timeConstant:p,power:c,restDelta:_,modifyTarget:v,onUpdate:y(C)?function(e){M=T,T=e,s=BI(e-M,yc().delta),(1===k&&e>I||-1===k&&e<I)&&S({from:e,to:I,velocity:s})}:void 0})}return{stop:function(){return null==t?void 0:t.stop()}}}var LI=function(e){return 180*e/Math.PI},OI=function(e,t){return void 0===t&&(t=Yl),LI(Math.atan2(t.y-e.y,t.x-e.x))},FI=function(e,t){var r=!0;return void 0===t&&(t=e,r=!1),function(i){return r?i-e+t:(e=i,r=!0,t)}},UI=function(e){return e},NI=function(e){return void 0===e&&(e=UI),function(t,r,i){var n=r-i,s=-(0-t+1)*(0-e(Math.abs(n)));return n<=0?r+s:r-s}},jI=NI(),GI=NI(Math.sqrt),zI=function(e){return e*Math.PI/180},VI=function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")},QI=function(e){return VI(e)&&e.hasOwnProperty("z")},HI=function(e,t){return Math.abs(e-t)};function WI(e,t){if(Kl(e)&&Kl(t))return HI(e,t);if(VI(e)&&VI(t)){var r=HI(e.x,t.x),i=HI(e.y,t.y),n=QI(e)&&QI(t)?HI(e.z,t.z):0;return Math.sqrt(Math.pow(r,2)+Math.pow(i,2)+Math.pow(n,2))}}var qI=function(e,t,r){return t=zI(t),{x:r*Math.cos(t)+e.x,y:r*Math.sin(t)+e.y}},XI=function(e,t){return void 0===t&&(t=2),t=Math.pow(10,t),Math.round(e*t)/t},YI=function(e,t,r,i){return void 0===i&&(i=0),XI(e+r*(t-e)/Math.max(i,r))},KI=function(e){void 0===e&&(e=50);var t=0,r=0;return function(i){var n=yc().timestamp,s=n!==r?n-r:0,o=s?YI(t,i,s,e):t;return r=n,t=o,o}},JI=function(e){if("number"==typeof e)return function(t){return Math.round(t/e)*e};var t=0,r=e.length;return function(i){var n=Math.abs(e[0]-i);for(t=1;t<r;t++){var s=e[t],o=Math.abs(s-i);if(0===o)return s;if(o>n)return e[t-1];if(t===r-1)return s;n=o}}};function ZI(e,t){return e/(1e3/t)}var $I=function(e,t,r){var i=t-e;return((r-e)%i+i)%i+e},ek=function(e,t){return 1-3*t+3*e},tk=function(e,t){return 3*t-6*e},rk=function(e){return 3*e},ik=function(e,t,r){return((ek(t,r)*e+tk(t,r))*e+rk(t))*e},nk=function(e,t,r){return 3*ek(t,r)*e*e+2*tk(t,r)*e+rk(t)},sk=.1;function ok(e,t,r,i){if(e===t&&r===i)return Wa;for(var n=new Float32Array(11),s=0;s<11;++s)n[s]=ik(s*sk,e,r);return function(s){return 0===s||1===s?s:ik(function(t){for(var i=0,s=1;10!==s&&n[s]<=t;++s)i+=sk;var o=i+(t-n[--s])/(n[s+1]-n[s])*sk,a=nk(o,e,r);return a>=.001?function(e,t,r,i){for(var n=0;n<8;++n){var s=nk(t,r,i);if(0===s)return t;t-=(ik(t,r,i)-e)/s}return t}(t,o,e,r):0===a?o:function(e,t,r,i,n){var s,o,a=0;do{(s=ik(o=t+(r-t)/2,i,n)-e)>0?r=o:t=o}while(Math.abs(s)>1e-7&&++a<10);return o}(t,i,i+sk,e,r)}(s),t,i)}}var ak=function(e,t){return void 0===t&&(t="end"),function(r){var i=(r="end"===t?Math.min(r,.999):Math.max(r,.001))*e,n="end"===t?Math.floor(i):Math.ceil(i);return ll(0,1,n/e)}};async function lk(e,{debug:t=!1,ground:r=!0,bloom:i=!0,depthTonemap:n=!1,importPopup:s=!0,caching:o=!0}){const a=new bo(e);a.enabled=!1,t&&await a.addPlugin(qc),await a.addPlugin(so,void 0,void 0,{storage:o&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await a.addPlugin(o_),await a.addPlugin(XA),s&&await a.addPlugin(fh),await a.addPlugin(Jh),await a.addPlugin(hI),await a.addPlugin(Am),await a.addPlugin($g),await a.addPlugin(im),await a.addPlugin(om),await a.addPlugin(Mg),await a.addPlugin(wm),await a.addPlugin(nm),await a.addPlugin(Mo),await a.addPlugin(Fc,ja,!1,!0),await Zh(a,{ground:r,bloom:i,depthTonemap:n}),await a.addPlugin(Db),await a.addPlugin(BE,!1),await a.addPlugin(kE,!1),await a.addPlugin(GA,!1),await a.addPlugin(QA,!1),await a.addPlugin(HM),await a.addPlugin(ZM),await a.addPlugin(aT),await a.addPlugin(wb,!1),await a.addPlugin(ME),await a.addPlugin(UE),await a.addPlugin($E),await a.addPlugin(AE),await a.addPlugin(RE),await a.addPlugin(yE),await a.addPlugin(Xb),await a.addPlugin(Ju),await a.addPlugin(NT),await a.addPlugin(OT),await a.addPlugin(jT),await a.addPlugin(GT),await a.addPlugin(QT),await a.addPlugin(HT),await a.addPlugin(LT);const l=await a.addPlugin(new RT(!Dt()));return a.renderer.refreshPipeline(),a.scene.addEventListener("textureAdded",e=>{e.texture&&a.scene.setEnvironment(e.texture)}),l.setupPluginUi(So),l.setupPluginUi(QT),l.setupPluginUi(HT),l.setupPluginUi(Mo),l.setupPluginUi(LT),l.setupPluginUi(o_),l.setupPluginUi(Qc),l.setupPluginUi(lp),l.setupPluginUi(RE),l.setupPluginUi(AE),l.setupPluginUi(NT),l.setupPluginUi(yE),l.setupPluginUi(jc),l.setupPluginUi(Fc),r&&l.setupPluginUi(fu),l.setupPluginUi(Vo),l.setupPluginUi(tp),l.setupPluginUi(Xb),l.setupPluginUi(Mh),l.setupPluginUi(Db),l.setupPluginUi(jh),l.setupPluginUi(Qh),l.setupPluginUi(Ph),l.setupPluginUi(Oh),l.setupPluginUi(_p),l.setupPluginUi(Xo),l.setupPluginUi(GA),l.setupPluginUi(QA),l.setupPluginUi(OT),l.setupPluginUi(ME),l.setupPluginUi(UE),l.setupPluginUi(Po),l.setupPluginUi(jT),l.setupPluginUi(GT),l.setupPluginUi(Eu),l.setupPluginUi(Iu),i&&l.setupPluginUi(vu),l.setupPluginUi(Ju),l.setupPluginUi(Au),l.setupPluginUi(Xu),l.setupPluginUi(pp),l.setupPluginUi(BE),l.setupPluginUi($E),l.setupPluginUi(Rc),l.setupPluginUi(Wu),l.setupPluginUi(Xp),l.setupPluginUi(Lu),l.setupPluginUi(kE),l.setupPluginUi(fh),l.setupPluginUi(Kp),l.setupPluginUi(wb),a.enabled=!0,a}}();var __webpackgi_exports__AAssetManagerProcessStatePlugin=__webpackgi_exports__.MWW,__webpackgi_exports__ACESFilmicToneMapping=__webpackgi_exports__.LY2,__webpackgi_exports__ACameraControlsPlugin=__webpackgi_exports__.GYo,__webpackgi_exports__AMaterialManager=__webpackgi_exports__.HRj,__webpackgi_exports__ARPlacementBox=__webpackgi_exports__.li4,__webpackgi_exports__ARPlugin=__webpackgi_exports__.FO5,__webpackgi_exports__ARTouchInputHelper=__webpackgi_exports__.Nlh,__webpackgi_exports__AShaderMaterial2=__webpackgi_exports__.Mp4,__webpackgi_exports__AViewerPlugin=__webpackgi_exports__.QvI,__webpackgi_exports__AddBlendPass=__webpackgi_exports__.JHp,__webpackgi_exports__AddEquation=__webpackgi_exports__.bGH,__webpackgi_exports__AddOperation=__webpackgi_exports__.NDo,__webpackgi_exports__AdditiveAnimationBlendMode=__webpackgi_exports__.gSk,__webpackgi_exports__AdditiveBlending=__webpackgi_exports__.WMw,__webpackgi_exports__AlphaFormat=__webpackgi_exports__.OTo,__webpackgi_exports__AlwaysDepth=__webpackgi_exports__.Se2,__webpackgi_exports__AlwaysStencilFunc=__webpackgi_exports__.cum,__webpackgi_exports__AmbientLight=__webpackgi_exports__.Mig,__webpackgi_exports__AmbientLight2=__webpackgi_exports__.B$7,__webpackgi_exports__AmbientLightProbe=__webpackgi_exports__.i_9,__webpackgi_exports__AnimationClip=__webpackgi_exports__.m7l,__webpackgi_exports__AnimationLoader=__webpackgi_exports__.sYA,__webpackgi_exports__AnimationMixer=__webpackgi_exports__.Xcj,__webpackgi_exports__AnimationObjectGroup=__webpackgi_exports__.mzJ,__webpackgi_exports__AnimationUtils=__webpackgi_exports__.ZZA,__webpackgi_exports__AnisotropyPlugin=__webpackgi_exports__.$Ph,__webpackgi_exports__ArcCurve=__webpackgi_exports__.T__,__webpackgi_exports__ArrayCamera=__webpackgi_exports__.HkE,__webpackgi_exports__ArrowHelper=__webpackgi_exports__.tGC,__webpackgi_exports__AssetExporter=__webpackgi_exports__.g1S,__webpackgi_exports__AssetExporterPlugin=__webpackgi_exports__.I$C,__webpackgi_exports__AssetImporter=__webpackgi_exports__.QIH,__webpackgi_exports__AssetManagerBasicPopupPlugin=__webpackgi_exports__._JE,__webpackgi_exports__AssetManagerLoadingBarPlugin=__webpackgi_exports__.SwW,__webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm,__webpackgi_exports__AsyncCompress=__webpackgi_exports__.jl_,__webpackgi_exports__AsyncDecompress=__webpackgi_exports__.b7R,__webpackgi_exports__AsyncDeflate=__webpackgi_exports__.BDV,__webpackgi_exports__AsyncGunzip=__webpackgi_exports__.Ea_,__webpackgi_exports__AsyncGzip=__webpackgi_exports__.qff,__webpackgi_exports__AsyncInflate=__webpackgi_exports__.tmC,__webpackgi_exports__AsyncUnzipInflate=__webpackgi_exports__.BON,__webpackgi_exports__AsyncUnzlib=__webpackgi_exports__.P40,__webpackgi_exports__AsyncZipDeflate=__webpackgi_exports__.wLL,__webpackgi_exports__AsyncZlib=__webpackgi_exports__.iHO,__webpackgi_exports__Audio=__webpackgi_exports__.BbS,__webpackgi_exports__AudioAnalyser=__webpackgi_exports__.kqm,__webpackgi_exports__AudioContext=__webpackgi_exports__.Hmr,__webpackgi_exports__AudioListener=__webpackgi_exports__.SJI,__webpackgi_exports__AudioLoader=__webpackgi_exports__.mTL,__webpackgi_exports__AxesHelper=__webpackgi_exports__.y8_,__webpackgi_exports__BackSide=__webpackgi_exports__._Li,__webpackgi_exports__BaseGroundPlugin=__webpackgi_exports__.g56,__webpackgi_exports__BaseRenderer=__webpackgi_exports__.bj3,__webpackgi_exports__BasicDepthPacking=__webpackgi_exports__.z81,__webpackgi_exports__BasicShadowMap=__webpackgi_exports__._MY,__webpackgi_exports__BlobLoader=__webpackgi_exports__.yEv,__webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ,__webpackgi_exports__Bone=__webpackgi_exports__.N$j,__webpackgi_exports__BooleanKeyframeTrack=__webpackgi_exports__._YM,__webpackgi_exports__Box2=__webpackgi_exports__.TUj,__webpackgi_exports__Box3=__webpackgi_exports__.ZzF,__webpackgi_exports__Box3B=__webpackgi_exports__.qzb,__webpackgi_exports__Box3Helper=__webpackgi_exports__.GQ,__webpackgi_exports__BoxBufferGeometry=__webpackgi_exports__.nvb,__webpackgi_exports__BoxGeometry=__webpackgi_exports__.DvJ,__webpackgi_exports__BoxHelper=__webpackgi_exports__.fQA,__webpackgi_exports__BoxSelectionWidget=__webpackgi_exports__.cPz,__webpackgi_exports__BufferAttribute=__webpackgi_exports__.TlE,__webpackgi_exports__BufferGeometry=__webpackgi_exports__.u9r,__webpackgi_exports__BufferGeometryLoader=__webpackgi_exports__.s4_,__webpackgi_exports__ByteType=__webpackgi_exports__.T95,__webpackgi_exports__CSGPluginBSP=__webpackgi_exports__.F5w,__webpackgi_exports__CSGPluginBVH=__webpackgi_exports__.NlP,__webpackgi_exports__CSGPluginBase=__webpackgi_exports__.$8Z,__webpackgi_exports__CSS3DRendererPlugin=__webpackgi_exports__.YYN,__webpackgi_exports__Cache=__webpackgi_exports__.CtF,__webpackgi_exports__Camera=__webpackgi_exports__.V1s,__webpackgi_exports__CameraController=__webpackgi_exports__.jOv,__webpackgi_exports__CameraHelper=__webpackgi_exports__.Rki,__webpackgi_exports__CameraUiPlugin=__webpackgi_exports__.pzV,__webpackgi_exports__CameraView=__webpackgi_exports__.itZ,__webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.qKx,__webpackgi_exports__CanvasRecorder=__webpackgi_exports__.vlJ,__webpackgi_exports__CanvasRecorderPlugin=__webpackgi_exports__.nPO,__webpackgi_exports__CanvasSnipper=__webpackgi_exports__.zcQ,__webpackgi_exports__CanvasSnipperPlugin=__webpackgi_exports__.GH1,__webpackgi_exports__CanvasTexture=__webpackgi_exports__.ROQ,__webpackgi_exports__CapsuleBufferGeometry=__webpackgi_exports__.YN5,__webpackgi_exports__CapsuleGeometry=__webpackgi_exports__.BVQ,__webpackgi_exports__CatmullRomCurve3=__webpackgi_exports__.YT8,__webpackgi_exports__ChromaticAberrationPlugin=__webpackgi_exports__._DE,__webpackgi_exports__CineonToneMapping=__webpackgi_exports__.YGz,__webpackgi_exports__CircleBufferGeometry=__webpackgi_exports__.trn,__webpackgi_exports__CircleGeometry=__webpackgi_exports__.zf8,__webpackgi_exports__ClampToEdgeWrapping=__webpackgi_exports__.uWy,__webpackgi_exports__ClearcoatTintPlugin=__webpackgi_exports__.wYQ,__webpackgi_exports__Clock=__webpackgi_exports__.SUY,__webpackgi_exports__Color=__webpackgi_exports__.Ilk,__webpackgi_exports__ColorKeyframeTrack=__webpackgi_exports__.R2R,__webpackgi_exports__ColorManagement=__webpackgi_exports__.epp,__webpackgi_exports__CombinedPostPlugin=__webpackgi_exports__.xmJ,__webpackgi_exports__Compress=__webpackgi_exports__.GD$,__webpackgi_exports__CompressedTexture=__webpackgi_exports__.EB7,__webpackgi_exports__CompressedTextureLoader=__webpackgi_exports__.DqL,__webpackgi_exports__ConeBufferGeometry=__webpackgi_exports__._3,__webpackgi_exports__ConeGeometry=__webpackgi_exports__.b_z,__webpackgi_exports__ContactShadowGroundPlugin=__webpackgi_exports__.OCn,__webpackgi_exports__CubeCamera=__webpackgi_exports__._am,__webpackgi_exports__CubeNormalsCaptureHelper=__webpackgi_exports__.kB7,__webpackgi_exports__CubeReflectionMapping=__webpackgi_exports__.fY$,__webpackgi_exports__CubeRefractionMapping=__webpackgi_exports__.vxC,__webpackgi_exports__CubeTexture=__webpackgi_exports__.BtG,__webpackgi_exports__CubeTextureLoader=__webpackgi_exports__.cBK,__webpackgi_exports__CubeUVReflectionMapping=__webpackgi_exports__.g8_,__webpackgi_exports__CubicBezierCurve=__webpackgi_exports__.AXT,__webpackgi_exports__CubicBezierCurve3=__webpackgi_exports__.yj7,__webpackgi_exports__CubicInterpolant=__webpackgi_exports__.dYG,__webpackgi_exports__CullFaceBack=__webpackgi_exports__.tm_,__webpackgi_exports__CullFaceFront=__webpackgi_exports__.S2y,__webpackgi_exports__CullFaceFrontBack=__webpackgi_exports__.B02,__webpackgi_exports__CullFaceNone=__webpackgi_exports__.PeU,__webpackgi_exports__Curve=__webpackgi_exports__.Hyl,__webpackgi_exports__CurvePath=__webpackgi_exports__.Wqd,__webpackgi_exports__CustomBlending=__webpackgi_exports__.Xaj,__webpackgi_exports__CustomBumpMapPlugin=__webpackgi_exports__.DUb,__webpackgi_exports__CustomToneMapping=__webpackgi_exports__.dZ3,__webpackgi_exports__CylinderBufferGeometry=__webpackgi_exports__.m_w,__webpackgi_exports__CylinderGeometry=__webpackgi_exports__.fHI,__webpackgi_exports__Cylindrical=__webpackgi_exports__.LBq,__webpackgi_exports__DECAY_MILLISECONDS=__webpackgi_exports__.dHf,__webpackgi_exports__DRACOLoader2=__webpackgi_exports__.Qww,__webpackgi_exports__Damper=__webpackgi_exports__.CGV,__webpackgi_exports__Data3DTexture=__webpackgi_exports__.JUT,__webpackgi_exports__DataArrayTexture=__webpackgi_exports__.p3g,__webpackgi_exports__DataTexture=__webpackgi_exports__.IEO,__webpackgi_exports__DataTexture2DArray=__webpackgi_exports__.CN8,__webpackgi_exports__DataTexture3D=__webpackgi_exports__.zob,__webpackgi_exports__DataTextureLoader=__webpackgi_exports__.yxD,__webpackgi_exports__DataUrlLoader=__webpackgi_exports__.CUS,__webpackgi_exports__DataUtils=__webpackgi_exports__.A5E,__webpackgi_exports__DebugPlugin=__webpackgi_exports__.zqG,__webpackgi_exports__DecodeUTF8=__webpackgi_exports__.PfX,__webpackgi_exports__Decompress=__webpackgi_exports__.Q1o,__webpackgi_exports__DecrementStencilOp=__webpackgi_exports__.jfJ,__webpackgi_exports__DecrementWrapStencilOp=__webpackgi_exports__.T_J,__webpackgi_exports__DefaultLoadingManager=__webpackgi_exports__.tEQ,__webpackgi_exports__Deflate=__webpackgi_exports__.gb4,__webpackgi_exports__DepthFormat=__webpackgi_exports__.qkB,__webpackgi_exports__DepthOfFieldPass=__webpackgi_exports__.cvk,__webpackgi_exports__DepthOfFieldPlugin=__webpackgi_exports__.HWo,__webpackgi_exports__DepthStencilFormat=__webpackgi_exports__.brP,__webpackgi_exports__DepthTexture=__webpackgi_exports__.$YQ,__webpackgi_exports__DeviceOrientationControls2=__webpackgi_exports__.X8d,__webpackgi_exports__DeviceOrientationControlsPlugin=__webpackgi_exports__.Zdt,__webpackgi_exports__DiamondMaterial=__webpackgi_exports__.yNB,__webpackgi_exports__DiamondPlugin=__webpackgi_exports__.h7x,__webpackgi_exports__DirectionalLight=__webpackgi_exports__.Ox3,__webpackgi_exports__DirectionalLight2=__webpackgi_exports__.qtn,__webpackgi_exports__DirectionalLightHelper=__webpackgi_exports__.cBI,__webpackgi_exports__DiscreteInterpolant=__webpackgi_exports__.cU9,__webpackgi_exports__DodecahedronBufferGeometry=__webpackgi_exports__.DT1,__webpackgi_exports__DodecahedronGeometry=__webpackgi_exports__.Kgo,__webpackgi_exports__DoubleSide=__webpackgi_exports__.ehD,__webpackgi_exports__Dropzone=__webpackgi_exports__.fhJ,__webpackgi_exports__DropzonePlugin=__webpackgi_exports__.y1s,__webpackgi_exports__DstAlphaFactor=__webpackgi_exports__.fSK,__webpackgi_exports__DstColorFactor=__webpackgi_exports__.Vdb,__webpackgi_exports__DynamicCopyUsage=__webpackgi_exports__.l8J,__webpackgi_exports__DynamicDrawUsage=__webpackgi_exports__.dj0,__webpackgi_exports__DynamicReadUsage=__webpackgi_exports__.QM0,__webpackgi_exports__EXRLoadPlugin=__webpackgi_exports__.OIS,__webpackgi_exports__EasingFunctions=__webpackgi_exports__.q8b,__webpackgi_exports__EdgesGeometry=__webpackgi_exports__.TOt,__webpackgi_exports__EffectComposer2=__webpackgi_exports__.xaN,__webpackgi_exports__EllipseCurve=__webpackgi_exports__.Ny0,__webpackgi_exports__EllipseCurve3D=__webpackgi_exports__.NeD,__webpackgi_exports__EncodeUTF8=__webpackgi_exports__.Zof,__webpackgi_exports__EqualDepth=__webpackgi_exports__.eD,__webpackgi_exports__EqualStencilFunc=__webpackgi_exports__.jwo,__webpackgi_exports__EquirectangularReflectionMapping=__webpackgi_exports__.dSO,__webpackgi_exports__EquirectangularRefractionMapping=__webpackgi_exports__.Bf4,__webpackgi_exports__Euler=__webpackgi_exports__.USm,__webpackgi_exports__EventDispatcher=__webpackgi_exports__.pBf,__webpackgi_exports__ExtrasUiPlugin=__webpackgi_exports__.eBg,__webpackgi_exports__ExtrudeBufferGeometry=__webpackgi_exports__.$Vf,__webpackgi_exports__ExtrudeGeometry=__webpackgi_exports__.O7d,__webpackgi_exports__FBXLoadPlugin=__webpackgi_exports__.ksq,__webpackgi_exports__FSShadowMaterial=__webpackgi_exports__.gXf,__webpackgi_exports__FileLoader=__webpackgi_exports__.hH6,__webpackgi_exports__FilmicGrainPlugin=__webpackgi_exports__.kpi,__webpackgi_exports__FirstPersonControls2=__webpackgi_exports__.DwZ,__webpackgi_exports__FirstPersonControlsPlugin=__webpackgi_exports__.kN3,__webpackgi_exports__Float16BufferAttribute=__webpackgi_exports__.e62,__webpackgi_exports__Float32BufferAttribute=__webpackgi_exports__.a$l,__webpackgi_exports__Float64BufferAttribute=__webpackgi_exports__.OM3,__webpackgi_exports__FloatType=__webpackgi_exports__.VzW,__webpackgi_exports__Fog=__webpackgi_exports__.ybr,__webpackgi_exports__FogExp2=__webpackgi_exports__.yo9,__webpackgi_exports__FrameFadePlugin=__webpackgi_exports__.$Bt,__webpackgi_exports__FramebufferTexture=__webpackgi_exports__.Wzm,__webpackgi_exports__FrontSide=__webpackgi_exports__.Wl3,__webpackgi_exports__Frustum=__webpackgi_exports__.iWj,__webpackgi_exports__FullScreenPlugin=__webpackgi_exports__.DNz,__webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M,__webpackgi_exports__GLBufferAttribute=__webpackgi_exports__.ylh,__webpackgi_exports__GLSL1=__webpackgi_exports__.v9Y,__webpackgi_exports__GLSL3=__webpackgi_exports__.LSk,__webpackgi_exports__GLTFAnimationPlugin=__webpackgi_exports__.LHE,__webpackgi_exports__GLTFDracoExportPlugin=__webpackgi_exports__.KE0,__webpackgi_exports__GLTFDracoExporter=__webpackgi_exports__.KCF,__webpackgi_exports__GLTFExporter2=__webpackgi_exports__.a4n,__webpackgi_exports__GLTFLoader2=__webpackgi_exports__.zIH,__webpackgi_exports__GLTFMaterialsAlphaMapExtensionName=__webpackgi_exports__.Hfk,__webpackgi_exports__GLTFMaterialsBumpMapExtensionName=__webpackgi_exports__.png,__webpackgi_exports__GLTFMaterialsDisplacementMapExtensionName=__webpackgi_exports__.tAj,__webpackgi_exports__GLTFMaterialsLightMapExtensionName=__webpackgi_exports__.Eb_,__webpackgi_exports__GLTFMeshOptPlugin=__webpackgi_exports__.BT2,__webpackgi_exports__GLTFWriter2=__webpackgi_exports__._8p,__webpackgi_exports__GammaCorrectionExtension=__webpackgi_exports__.V5Z,__webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b,__webpackgi_exports__GenericBlendTexturePass=__webpackgi_exports__.hkn,__webpackgi_exports__GenericFilterPlugin=__webpackgi_exports__.GFY,__webpackgi_exports__GreaterDepth=__webpackgi_exports__.w$m,__webpackgi_exports__GreaterEqualDepth=__webpackgi_exports__.ksN,__webpackgi_exports__GreaterEqualStencilFunc=__webpackgi_exports__.j4z,__webpackgi_exports__GreaterStencilFunc=__webpackgi_exports__.OAl,__webpackgi_exports__GridHelper=__webpackgi_exports__.VLJ,__webpackgi_exports__GroundPlugin=__webpackgi_exports__.C73,__webpackgi_exports__Group=__webpackgi_exports__.ZAu,__webpackgi_exports__Gunzip=__webpackgi_exports__.ibP,__webpackgi_exports__Gzip=__webpackgi_exports__._fI,__webpackgi_exports__HDRiGroundPlugin=__webpackgi_exports__.hUN,__webpackgi_exports__HalfFloatType=__webpackgi_exports__.cLu,__webpackgi_exports__HemisphereLight=__webpackgi_exports__.vmT,__webpackgi_exports__HemisphereLightHelper=__webpackgi_exports__.Qpg,__webpackgi_exports__HemisphereLightProbe=__webpackgi_exports__.So8,__webpackgi_exports__HierarchyUiPlugin=__webpackgi_exports__.eOv,__webpackgi_exports__IcosahedronBufferGeometry=__webpackgi_exports__.Wjw,__webpackgi_exports__IcosahedronGeometry=__webpackgi_exports__.cJO,__webpackgi_exports__ImageBitmapLoader=__webpackgi_exports__.QRU,__webpackgi_exports__ImageLoader=__webpackgi_exports__.S3k,__webpackgi_exports__ImageUtils=__webpackgi_exports__.PpQ,__webpackgi_exports__ImmediateRenderObject=__webpackgi_exports__.AHu,__webpackgi_exports__Importer=__webpackgi_exports__.q_9,__webpackgi_exports__IncrementStencilOp=__webpackgi_exports__.ZRs,__webpackgi_exports__IncrementWrapStencilOp=__webpackgi_exports__.oqc,__webpackgi_exports__Inflate=__webpackgi_exports__.T_x,__webpackgi_exports__InstancedBufferAttribute=__webpackgi_exports__.lb7,__webpackgi_exports__InstancedBufferGeometry=__webpackgi_exports__.L5s,__webpackgi_exports__InstancedInterleavedBuffer=__webpackgi_exports__.$TI,__webpackgi_exports__InstancedMesh=__webpackgi_exports__.SPe,__webpackgi_exports__Int16BufferAttribute=__webpackgi_exports__.aVm,__webpackgi_exports__Int32BufferAttribute=__webpackgi_exports__.j87,__webpackgi_exports__Int8BufferAttribute=__webpackgi_exports__.RNb,__webpackgi_exports__IntType=__webpackgi_exports__.Kz5,__webpackgi_exports__InterleavedBuffer=__webpackgi_exports__.vpT,__webpackgi_exports__InterleavedBufferAttribute=__webpackgi_exports__.kB5,__webpackgi_exports__Interpolant=__webpackgi_exports__._C8,__webpackgi_exports__InterpolateDiscrete=__webpackgi_exports__.Syv,__webpackgi_exports__InterpolateLinear=__webpackgi_exports__.NMF,__webpackgi_exports__InterpolateSmooth=__webpackgi_exports__.pIN,__webpackgi_exports__InvertStencilOp=__webpackgi_exports__.eMJ,__webpackgi_exports__KHR_TEXTURE_BASISU=__webpackgi_exports__.rN7,__webpackgi_exports__KTX2LoadPlugin=__webpackgi_exports__.iUp,__webpackgi_exports__KTXLoadPlugin=__webpackgi_exports__.GFd,__webpackgi_exports__KeepStencilOp=__webpackgi_exports__.x5V,__webpackgi_exports__KeyframeTrack=__webpackgi_exports__.tUh,__webpackgi_exports__LOD=__webpackgi_exports__.z8B,__webpackgi_exports__LUTPlugin=__webpackgi_exports__.vcl,__webpackgi_exports__LatheBufferGeometry=__webpackgi_exports__.GZb,__webpackgi_exports__LatheGeometry=__webpackgi_exports__.p7y,__webpackgi_exports__Layers=__webpackgi_exports__.S9g,__webpackgi_exports__LessDepth=__webpackgi_exports__.Zr5,__webpackgi_exports__LessEqualDepth=__webpackgi_exports__.vCF,__webpackgi_exports__LessEqualStencilFunc=__webpackgi_exports__.yt0,__webpackgi_exports__LessStencilFunc=__webpackgi_exports__.uXU,__webpackgi_exports__Light=__webpackgi_exports__._kC,__webpackgi_exports__LightProbe=__webpackgi_exports__.lk7,__webpackgi_exports__LightsUiPlugin=__webpackgi_exports__.USc,__webpackgi_exports__Line=__webpackgi_exports__.x12,__webpackgi_exports__Line3=__webpackgi_exports__.Zzh,__webpackgi_exports__LineBasicMaterial=__webpackgi_exports__.nls,__webpackgi_exports__LineCurve=__webpackgi_exports__.g_z,__webpackgi_exports__LineCurve3=__webpackgi_exports__.U7,__webpackgi_exports__LineDashedMaterial=__webpackgi_exports__.FT0,__webpackgi_exports__LineLoop=__webpackgi_exports__.blk,__webpackgi_exports__LineSegments=__webpackgi_exports__.ejS,__webpackgi_exports__LinearEncoding=__webpackgi_exports__.rnI,__webpackgi_exports__LinearFilter=__webpackgi_exports__.wem,__webpackgi_exports__LinearInterpolant=__webpackgi_exports__.lfu,__webpackgi_exports__LinearMipMapLinearFilter=__webpackgi_exports__.FDw,__webpackgi_exports__LinearMipMapNearestFilter=__webpackgi_exports__.lRj,__webpackgi_exports__LinearMipmapLinearFilter=__webpackgi_exports__.D1R,__webpackgi_exports__LinearMipmapNearestFilter=__webpackgi_exports__.qyh,__webpackgi_exports__LinearSRGBColorSpace=__webpackgi_exports__.GUF,__webpackgi_exports__LinearToneMapping=__webpackgi_exports__.EoG,__webpackgi_exports__Loader=__webpackgi_exports__.aNw,__webpackgi_exports__LoaderUtils=__webpackgi_exports__.Zp0,__webpackgi_exports__LoadingManager=__webpackgi_exports__.lLk,__webpackgi_exports__LoopOnce=__webpackgi_exports__.jAl,__webpackgi_exports__LoopPingPong=__webpackgi_exports__.uEv,__webpackgi_exports__LoopRepeat=__webpackgi_exports__.YKA,__webpackgi_exports__LuminanceAlphaFormat=__webpackgi_exports__.cRx,__webpackgi_exports__LuminanceFormat=__webpackgi_exports__.Y8D,__webpackgi_exports__MOUSE=__webpackgi_exports__.RsA,__webpackgi_exports__MTLLoader2=__webpackgi_exports__.Y0m,__webpackgi_exports__Material=__webpackgi_exports__.F5T,__webpackgi_exports__MaterialConfiguratorBasePlugin=__webpackgi_exports__.EDU,__webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.z$Q,__webpackgi_exports__MaterialExtender=__webpackgi_exports__.KA8,__webpackgi_exports__MaterialLibraryBasePlugin=__webpackgi_exports__.XUj,__webpackgi_exports__MaterialLibraryPlugin=__webpackgi_exports__.Me$,__webpackgi_exports__MaterialLoader=__webpackgi_exports__.u7G,__webpackgi_exports__MaterialManager=__webpackgi_exports__.PEk,__webpackgi_exports__MaterialPreviewGenerator=__webpackgi_exports__.BG4,__webpackgi_exports__MathUtils=__webpackgi_exports__.M8C,__webpackgi_exports__Matrix3=__webpackgi_exports__.Vkp,__webpackgi_exports__Matrix4=__webpackgi_exports__.yGw,__webpackgi_exports__MaxEquation=__webpackgi_exports__.Sm8,__webpackgi_exports__Mesh=__webpackgi_exports__.Kj0,__webpackgi_exports__MeshBasicMaterial=__webpackgi_exports__.vBJ,__webpackgi_exports__MeshBasicMaterial2=__webpackgi_exports__.QfV,__webpackgi_exports__MeshDepthMaterial=__webpackgi_exports__.lRF,__webpackgi_exports__MeshDistanceMaterial=__webpackgi_exports__.Lun,__webpackgi_exports__MeshLambertMaterial=__webpackgi_exports__.YBo,__webpackgi_exports__MeshMatcapMaterial=__webpackgi_exports__.kaV,__webpackgi_exports__MeshNormalMaterial=__webpackgi_exports__.RSm,__webpackgi_exports__MeshPhongMaterial=__webpackgi_exports__.xoR,__webpackgi_exports__MeshPhysicalMaterial=__webpackgi_exports__.EJi,__webpackgi_exports__MeshStandardMaterial=__webpackgi_exports__.Wid,__webpackgi_exports__MeshStandardMaterial2=__webpackgi_exports__.iuj,__webpackgi_exports__MeshToonMaterial=__webpackgi_exports__.IKL,__webpackgi_exports__MinEquation=__webpackgi_exports__.r_,__webpackgi_exports__MirroredRepeatWrapping=__webpackgi_exports__.OoA,__webpackgi_exports__MixOperation=__webpackgi_exports__.qhX,__webpackgi_exports__MultiFilterPlugin=__webpackgi_exports__.qPT,__webpackgi_exports__MultiplyBlending=__webpackgi_exports__.M5h,__webpackgi_exports__MultiplyOperation=__webpackgi_exports__.Ns1,__webpackgi_exports__NearestFilter=__webpackgi_exports__.TyD,__webpackgi_exports__NearestMipMapLinearFilter=__webpackgi_exports__.vZf,__webpackgi_exports__NearestMipMapNearestFilter=__webpackgi_exports__.HTd,__webpackgi_exports__NearestMipmapLinearFilter=__webpackgi_exports__.aH4,__webpackgi_exports__NearestMipmapNearestFilter=__webpackgi_exports__.YLQ,__webpackgi_exports__NeverDepth=__webpackgi_exports__.BVF,__webpackgi_exports__NeverStencilFunc=__webpackgi_exports__.MyG,__webpackgi_exports__NoBlending=__webpackgi_exports__.jFi,__webpackgi_exports__NoColorSpace=__webpackgi_exports__.aCh,__webpackgi_exports__NoToneMapping=__webpackgi_exports__.uL9,__webpackgi_exports__NoiseBumpMaterialPlugin=__webpackgi_exports__.TNj,__webpackgi_exports__NormalAnimationBlendMode=__webpackgi_exports__.IFH,__webpackgi_exports__NormalBlending=__webpackgi_exports__.bdR,__webpackgi_exports__NormalBufferPlugin=__webpackgi_exports__.RPs,__webpackgi_exports__NormalCaptureMaterial=__webpackgi_exports__.kM_,__webpackgi_exports__NotEqualDepth=__webpackgi_exports__.M6v,__webpackgi_exports__NotEqualStencilFunc=__webpackgi_exports__.RvT,__webpackgi_exports__NumberKeyframeTrack=__webpackgi_exports__.dUE,__webpackgi_exports__OBJLoader2=__webpackgi_exports__.oe_,__webpackgi_exports__ObjMtlLoadPlugin=__webpackgi_exports__.BuN,__webpackgi_exports__Object3D=__webpackgi_exports__.Tme,__webpackgi_exports__Object3DModel=__webpackgi_exports__.N9P,__webpackgi_exports__ObjectLoader=__webpackgi_exports__.Gql,__webpackgi_exports__ObjectLoader2=__webpackgi_exports__.$XY,__webpackgi_exports__ObjectPicker=__webpackgi_exports__.O9d,__webpackgi_exports__ObjectProcessorMap=__webpackgi_exports__.zEO,__webpackgi_exports__ObjectRotationPlugin=__webpackgi_exports__.qfx,__webpackgi_exports__ObjectSpaceNormalMap=__webpackgi_exports__.PA7,__webpackgi_exports__OctahedronBufferGeometry=__webpackgi_exports__.REq,__webpackgi_exports__OctahedronGeometry=__webpackgi_exports__.pQR,__webpackgi_exports__OneFactor=__webpackgi_exports__.ghN,__webpackgi_exports__OneMinusDstAlphaFactor=__webpackgi_exports__.Hy8,__webpackgi_exports__OneMinusDstColorFactor=__webpackgi_exports__.Wpd,__webpackgi_exports__OneMinusSrcAlphaFactor=__webpackgi_exports__.LgZ,__webpackgi_exports__OneMinusSrcColorFactor=__webpackgi_exports__.iWC,__webpackgi_exports__OrbitControls2=__webpackgi_exports__.mqn,__webpackgi_exports__OrbitControls3=__webpackgi_exports__.SKe,__webpackgi_exports__OrthographicCamera=__webpackgi_exports__.iKG,__webpackgi_exports__OutlinePlugin=__webpackgi_exports__.rCq,__webpackgi_exports__PCFShadowMap=__webpackgi_exports__._iA,__webpackgi_exports__PCFSoftShadowMap=__webpackgi_exports__.ntZ,__webpackgi_exports__PMREMGenerator=__webpackgi_exports__.anP,__webpackgi_exports__PMREMGeneratorPlugin=__webpackgi_exports__.X2e,__webpackgi_exports__ParallaxMappingPlugin=__webpackgi_exports__.FCo,__webpackgi_exports__Path=__webpackgi_exports__.y$t,__webpackgi_exports__PerspectiveCamera=__webpackgi_exports__.cPb,__webpackgi_exports__PickingPlugin=__webpackgi_exports__.lmx,__webpackgi_exports__Plane=__webpackgi_exports__.JOQ,__webpackgi_exports__PlaneBufferGeometry=__webpackgi_exports__.BKK,__webpackgi_exports__PlaneGeometry=__webpackgi_exports__._12,__webpackgi_exports__PlaneHelper=__webpackgi_exports__.tJx,__webpackgi_exports__PointLight=__webpackgi_exports__.cek,__webpackgi_exports__PointLight2=__webpackgi_exports__.qD0,__webpackgi_exports__PointLightHelper=__webpackgi_exports__.xG9,__webpackgi_exports__PointerLockControls2=__webpackgi_exports__.wI8,__webpackgi_exports__PointerLockControlsPlugin=__webpackgi_exports__.Sgv,__webpackgi_exports__Points=__webpackgi_exports__.woe,__webpackgi_exports__PointsMaterial=__webpackgi_exports__.UY4,__webpackgi_exports__PolarGridHelper=__webpackgi_exports__.aq0,__webpackgi_exports__PolyhedronBufferGeometry=__webpackgi_exports__.ujx,__webpackgi_exports__PolyhedronGeometry=__webpackgi_exports__.Uol,__webpackgi_exports__PopmotionPlugin=__webpackgi_exports__.JiH,__webpackgi_exports__PositionalAudio=__webpackgi_exports__.VYz,__webpackgi_exports__PresetLibraryPlugin=__webpackgi_exports__._Pm,__webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW,__webpackgi_exports__PropertyBinding=__webpackgi_exports__.iUV,__webpackgi_exports__PropertyMixer=__webpackgi_exports__.tf,__webpackgi_exports__QuadraticBezierCurve=__webpackgi_exports__.ZQ6,__webpackgi_exports__QuadraticBezierCurve3=__webpackgi_exports__.mXe,__webpackgi_exports__Quaternion=__webpackgi_exports__._fP,__webpackgi_exports__QuaternionKeyframeTrack=__webpackgi_exports__.iLg,__webpackgi_exports__QuaternionLinearInterpolant=__webpackgi_exports__.zbs,__webpackgi_exports__REVISION=__webpackgi_exports__.UZH,__webpackgi_exports__RGBADepthPacking=__webpackgi_exports__.mSO,__webpackgi_exports__RGBAFormat=__webpackgi_exports__.wk1,__webpackgi_exports__RGBAIntegerFormat=__webpackgi_exports__.E2K,__webpackgi_exports__RGBA_ASTC_10x10_Format=__webpackgi_exports__.FUD,__webpackgi_exports__RGBA_ASTC_10x5_Format=__webpackgi_exports__.pKu,__webpackgi_exports__RGBA_ASTC_10x6_Format=__webpackgi_exports__.GG6,__webpackgi_exports__RGBA_ASTC_10x8_Format=__webpackgi_exports__.Gih,__webpackgi_exports__RGBA_ASTC_12x10_Format=__webpackgi_exports__.iiP,__webpackgi_exports__RGBA_ASTC_12x12_Format=__webpackgi_exports__.SvJ,__webpackgi_exports__RGBA_ASTC_4x4_Format=__webpackgi_exports__.ptH,__webpackgi_exports__RGBA_ASTC_5x4_Format=__webpackgi_exports__.jZA,__webpackgi_exports__RGBA_ASTC_5x5_Format=__webpackgi_exports__.y2t,__webpackgi_exports__RGBA_ASTC_6x5_Format=__webpackgi_exports__.gi4,__webpackgi_exports__RGBA_ASTC_6x6_Format=__webpackgi_exports__.Djp,__webpackgi_exports__RGBA_ASTC_8x5_Format=__webpackgi_exports__.BG$,__webpackgi_exports__RGBA_ASTC_8x6_Format=__webpackgi_exports__.NYV,__webpackgi_exports__RGBA_ASTC_8x8_Format=__webpackgi_exports__.xJs,__webpackgi_exports__RGBA_BPTC_Format=__webpackgi_exports__.bsb,__webpackgi_exports__RGBA_ETC2_EAC_Format=__webpackgi_exports__.ekQ,__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format=__webpackgi_exports__.CaW,__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format=__webpackgi_exports__.eaV,__webpackgi_exports__RGBA_S3TC_DXT1_Format=__webpackgi_exports__.BFQ,__webpackgi_exports__RGBA_S3TC_DXT3_Format=__webpackgi_exports__.v3W,__webpackgi_exports__RGBA_S3TC_DXT5_Format=__webpackgi_exports__.ILR,__webpackgi_exports__RGBFormat=__webpackgi_exports__.UCm,__webpackgi_exports__RGBM16Encoding=__webpackgi_exports__.Inb,__webpackgi_exports__RGBM16Encoding_=__webpackgi_exports__.U1$,__webpackgi_exports__RGBM7Encoding=__webpackgi_exports__.LgE,__webpackgi_exports__RGB_ETC1_Format=__webpackgi_exports__.fto,__webpackgi_exports__RGB_ETC2_Format=__webpackgi_exports__.l0P,__webpackgi_exports__RGB_PVRTC_2BPPV1_Format=__webpackgi_exports__.vCx,__webpackgi_exports__RGB_PVRTC_4BPPV1_Format=__webpackgi_exports__._AM,__webpackgi_exports__RGB_S3TC_DXT1_Format=__webpackgi_exports__.wuA,__webpackgi_exports__RGFormat=__webpackgi_exports__.av9,__webpackgi_exports__RGIntegerFormat=__webpackgi_exports__.CtA,__webpackgi_exports__RandomizedDirectionalLight=__webpackgi_exports__.BvQ,__webpackgi_exports__RandomizedDirectionalLightPlugin=__webpackgi_exports__.FZJ,__webpackgi_exports__RawShaderMaterial=__webpackgi_exports__.FIo,__webpackgi_exports__Ray=__webpackgi_exports__.zHn,__webpackgi_exports__Raycaster=__webpackgi_exports__.iMs,__webpackgi_exports__RectAreaLight=__webpackgi_exports__.T_f,__webpackgi_exports__RedFormat=__webpackgi_exports__.hEm,__webpackgi_exports__RedIntegerFormat=__webpackgi_exports__.D9w,__webpackgi_exports__Reflector2=__webpackgi_exports__.sHH,__webpackgi_exports__ReinhardToneMapping=__webpackgi_exports__.CdI,__webpackgi_exports__RendererUiPlugin=__webpackgi_exports__.rkc,__webpackgi_exports__RepeatWrapping=__webpackgi_exports__.rpg,__webpackgi_exports__ReplaceStencilOp=__webpackgi_exports__.ce8,__webpackgi_exports__ReverseSubtractEquation=__webpackgi_exports__.rOj,__webpackgi_exports__Rhino3dmLoadPlugin=__webpackgi_exports__.P6m,__webpackgi_exports__Rhino3dmLoader2=__webpackgi_exports__.JA6,__webpackgi_exports__RingBufferGeometry=__webpackgi_exports__.V4E,__webpackgi_exports__RingGeometry=__webpackgi_exports__.o8S,__webpackgi_exports__RootScene=__webpackgi_exports__.flB,__webpackgi_exports__SETTLING_TIME=__webpackgi_exports__.DUH,__webpackgi_exports__SRGBColorSpace=__webpackgi_exports__.KI_,__webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN,__webpackgi_exports__SSBevelPlugin=__webpackgi_exports__.rz_,__webpackgi_exports__SSContactShadows=__webpackgi_exports__.jsw,__webpackgi_exports__SSGIPlugin=__webpackgi_exports__.srG,__webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z,__webpackgi_exports__STLLoadPlugin=__webpackgi_exports__.vfv,__webpackgi_exports__Scene=__webpackgi_exports__.xsS,__webpackgi_exports__SceneCamerasUiPlugin=__webpackgi_exports__.or,__webpackgi_exports__SceneLoopPlugin=__webpackgi_exports__.EQj,__webpackgi_exports__SelectionWidget=__webpackgi_exports__.ov0,__webpackgi_exports__ShaderChunk=__webpackgi_exports__.WdD,__webpackgi_exports__ShaderLib=__webpackgi_exports__.Vj0,__webpackgi_exports__ShaderMaterial=__webpackgi_exports__.jyz,__webpackgi_exports__ShaderMaterial2=__webpackgi_exports__.mTM,__webpackgi_exports__ShaderMaterialEncodingSupport=__webpackgi_exports__.Mn1,__webpackgi_exports__ShaderPass2=__webpackgi_exports__.Hlq,__webpackgi_exports__ShadowMapBaker=__webpackgi_exports__.Fi7,__webpackgi_exports__ShadowMaterial=__webpackgi_exports__.Tn7,__webpackgi_exports__Shape=__webpackgi_exports__.bnF,__webpackgi_exports__ShapeBufferGeometry=__webpackgi_exports__.HW6,__webpackgi_exports__ShapeGeometry=__webpackgi_exports__.oa8,__webpackgi_exports__ShapePath=__webpackgi_exports__.T_1,__webpackgi_exports__ShapeTubeExtrudePlugin=__webpackgi_exports__.zHJ,__webpackgi_exports__ShapeUtils=__webpackgi_exports__.iDF,__webpackgi_exports__ShortType=__webpackgi_exports__.iAb,__webpackgi_exports__SimpleAssetList=__webpackgi_exports__.d4E,__webpackgi_exports__SimpleBackgroundEnvUiPlugin=__webpackgi_exports__.lBg,__webpackgi_exports__SimpleDataSource=__webpackgi_exports__.JeJ,__webpackgi_exports__SimpleEventDispatcher=__webpackgi_exports__.FKY,__webpackgi_exports__SimpleJSONExporter=__webpackgi_exports__.zlZ,__webpackgi_exports__SimpleJSONLoader=__webpackgi_exports__.vkg,__webpackgi_exports__SimpleTextExporter=__webpackgi_exports__.brh,__webpackgi_exports__SimpleTextPlugin=__webpackgi_exports__.kZK,__webpackgi_exports__SimpleViewerUi=__webpackgi_exports__.puG,__webpackgi_exports__Skeleton=__webpackgi_exports__.OdW,__webpackgi_exports__SkeletonHelper=__webpackgi_exports__._YX,__webpackgi_exports__SkinnedMesh=__webpackgi_exports__.TUv,__webpackgi_exports__Source=__webpackgi_exports__.Hw6,__webpackgi_exports__Sphere=__webpackgi_exports__.aLr,__webpackgi_exports__SphereBufferGeometry=__webpackgi_exports__.Aip,__webpackgi_exports__SphereGeometry=__webpackgi_exports__.xo$,__webpackgi_exports__SphereSelectionWidget=__webpackgi_exports__.bIn,__webpackgi_exports__Spherical=__webpackgi_exports__.$V,__webpackgi_exports__SphericalHarmonics3=__webpackgi_exports__.lDi,__webpackgi_exports__SplineCurve=__webpackgi_exports__.gti,__webpackgi_exports__SpotLight=__webpackgi_exports__.PMe,__webpackgi_exports__SpotLight2=__webpackgi_exports__.iwP,__webpackgi_exports__SpotLightHelper=__webpackgi_exports__.FvO,__webpackgi_exports__Sprite=__webpackgi_exports__.jyi,__webpackgi_exports__SpriteMaterial=__webpackgi_exports__.xeV,__webpackgi_exports__SrcAlphaFactor=__webpackgi_exports__.k74,__webpackgi_exports__SrcAlphaSaturateFactor=__webpackgi_exports__.RlZ,__webpackgi_exports__SrcColorFactor=__webpackgi_exports__.KhW,__webpackgi_exports__StaticCopyUsage=__webpackgi_exports__.HgB,__webpackgi_exports__StaticDrawUsage=__webpackgi_exports__.W2J,__webpackgi_exports__StaticReadUsage=__webpackgi_exports__.JWc,__webpackgi_exports__StereoCamera=__webpackgi_exports__.u37,__webpackgi_exports__StreamCopyUsage=__webpackgi_exports__.Z6B,__webpackgi_exports__StreamDrawUsage=__webpackgi_exports__.QZ1,__webpackgi_exports__StreamReadUsage=__webpackgi_exports__.Ir4,__webpackgi_exports__StringKeyframeTrack=__webpackgi_exports__.NwF,__webpackgi_exports__SubtractEquation=__webpackgi_exports__.Wbm,__webpackgi_exports__SubtractiveBlending=__webpackgi_exports__.N4l,__webpackgi_exports__SwitchNodePlugin=__webpackgi_exports__.ej9,__webpackgi_exports__TOUCH=__webpackgi_exports__.QmN,__webpackgi_exports__TangentSpaceNormalMap=__webpackgi_exports__.IOt,__webpackgi_exports__TemporalAAPlugin=__webpackgi_exports__.NOD,__webpackgi_exports__TetrahedronBufferGeometry=__webpackgi_exports__.L5g,__webpackgi_exports__TetrahedronGeometry=__webpackgi_exports__.H$k,__webpackgi_exports__TextSVGOptions=__webpackgi_exports__.cuP,__webpackgi_exports__Texture=__webpackgi_exports__.xEZ,__webpackgi_exports__TextureLoader=__webpackgi_exports__.dpR,__webpackgi_exports__ThinFilmLayerPlugin=__webpackgi_exports__.wOD,__webpackgi_exports__ThreeMaterialLoader=__webpackgi_exports__.KNb,__webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN,__webpackgi_exports__TorusBufferGeometry=__webpackgi_exports__.Cne,__webpackgi_exports__TorusGeometry=__webpackgi_exports__.XvJ,__webpackgi_exports__TorusKnotBufferGeometry=__webpackgi_exports__.XZw,__webpackgi_exports__TorusKnotGeometry=__webpackgi_exports__.FE5,__webpackgi_exports__TransformControls2=__webpackgi_exports__.lVp,__webpackgi_exports__Triangle=__webpackgi_exports__.CJI,__webpackgi_exports__TriangleFanDrawMode=__webpackgi_exports__.z$h,__webpackgi_exports__TriangleStripDrawMode=__webpackgi_exports__.UlW,__webpackgi_exports__TrianglesDrawMode=__webpackgi_exports__.WwZ,__webpackgi_exports__TubeBufferGeometry=__webpackgi_exports__.Lcc,__webpackgi_exports__TubeGeometry=__webpackgi_exports__.WXh,__webpackgi_exports__TubeShapeGeometry=__webpackgi_exports__.Vjr,__webpackgi_exports__TweakpaneUiPlugin=__webpackgi_exports__.LuM,__webpackgi_exports__TweakpaneWrapper=__webpackgi_exports__.LP5,__webpackgi_exports__UVMapping=__webpackgi_exports__.xfE,__webpackgi_exports__Uint16BufferAttribute=__webpackgi_exports__.qlB,__webpackgi_exports__Uint32BufferAttribute=__webpackgi_exports__.lCJ,__webpackgi_exports__Uint8BufferAttribute=__webpackgi_exports__.WTc,__webpackgi_exports__Uint8ClampedBufferAttribute=__webpackgi_exports__.rAo,__webpackgi_exports__Uncharted2Tonemapping=__webpackgi_exports__.LZj,__webpackgi_exports__Uniform=__webpackgi_exports__.xWb,__webpackgi_exports__UniformsGroup=__webpackgi_exports__.gH0,__webpackgi_exports__UniformsLib=__webpackgi_exports__.rBU,__webpackgi_exports__UniformsUtils=__webpackgi_exports__.rDY,__webpackgi_exports__UnsignedByteType=__webpackgi_exports__.ywz,__webpackgi_exports__UnsignedInt248Type=__webpackgi_exports__.wJv,__webpackgi_exports__UnsignedIntType=__webpackgi_exports__.JQ4,__webpackgi_exports__UnsignedShort4444Type=__webpackgi_exports__.k0A,__webpackgi_exports__UnsignedShort5551Type=__webpackgi_exports__.irR,__webpackgi_exports__UnsignedShortType=__webpackgi_exports__.LsT,__webpackgi_exports__Unzip=__webpackgi_exports__.q5h,__webpackgi_exports__UnzipInflate=__webpackgi_exports__.TKh,__webpackgi_exports__UnzipPassThrough=__webpackgi_exports__.tyg,__webpackgi_exports__Unzlib=__webpackgi_exports__.Ro5,__webpackgi_exports__VSMShadowMap=__webpackgi_exports__.dwk,__webpackgi_exports__Vector2=__webpackgi_exports__.FM8,__webpackgi_exports__Vector3=__webpackgi_exports__.Pa4,__webpackgi_exports__Vector4=__webpackgi_exports__.Ltg,__webpackgi_exports__VectorKeyframeTrack=__webpackgi_exports__.yC1,__webpackgi_exports__VelocityBufferPlugin=__webpackgi_exports__.lHq,__webpackgi_exports__VideoTexture=__webpackgi_exports__.fO1,__webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA,__webpackgi_exports__ViewerState=__webpackgi_exports__.JzW,__webpackgi_exports__VignettePlugin=__webpackgi_exports__.QEt,__webpackgi_exports__WebGL1Renderer=__webpackgi_exports__.b5g,__webpackgi_exports__WebGL3DRenderTarget=__webpackgi_exports__.Ywn,__webpackgi_exports__WebGLArrayRenderTarget=__webpackgi_exports__.GVz,__webpackgi_exports__WebGLCubeRenderTarget=__webpackgi_exports__.oAp,__webpackgi_exports__WebGLMultipleRenderTargets=__webpackgi_exports__.kFz,__webpackgi_exports__WebGLMultisampleRenderTarget=__webpackgi_exports__.p7A,__webpackgi_exports__WebGLRenderTarget=__webpackgi_exports__.dd2,__webpackgi_exports__WebGLRenderer=__webpackgi_exports__.CP7,__webpackgi_exports__WebGLUtils=__webpackgi_exports__.fQK,__webpackgi_exports__WebGiViewerElement=__webpackgi_exports__.Wd$,__webpackgi_exports__WindowiseDialogPlugin=__webpackgi_exports__.t1_,__webpackgi_exports__WireframeGeometry=__webpackgi_exports__.Uk6,__webpackgi_exports__WrapAroundEnding=__webpackgi_exports__._sL,__webpackgi_exports__ZeroCurvatureEnding=__webpackgi_exports__.Pnf,__webpackgi_exports__ZeroFactor=__webpackgi_exports__.c8b,__webpackgi_exports__ZeroSlopeEnding=__webpackgi_exports__._lf,__webpackgi_exports__ZeroStencilOp=__webpackgi_exports__.ad5,__webpackgi_exports__Zip=__webpackgi_exports__.sZV,__webpackgi_exports__ZipDeflate=__webpackgi_exports__.TfA,__webpackgi_exports__ZipLoader=__webpackgi_exports__.sKX,__webpackgi_exports__ZipPassThrough=__webpackgi_exports__.UdM,__webpackgi_exports__Zlib=__webpackgi_exports__.P0y,__webpackgi_exports___SRGBAFormat=__webpackgi_exports__.L_r,__webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve,__webpackgi_exports__addDracoLoader=__webpackgi_exports__.UeO,__webpackgi_exports__addGLTFExporter=__webpackgi_exports__.$nx,__webpackgi_exports__addGLTFLoader=__webpackgi_exports__.Bk6,__webpackgi_exports__addLUTData=__webpackgi_exports__.EER,__webpackgi_exports__addRGBELoader=__webpackgi_exports__.y4l,__webpackgi_exports__addZipLoader=__webpackgi_exports__.pQ0,__webpackgi_exports__afterMain=__webpackgi_exports__.wXW,__webpackgi_exports__afterRead=__webpackgi_exports__.r5x,__webpackgi_exports__afterWrite=__webpackgi_exports__.MSI,__webpackgi_exports__angle=__webpackgi_exports__.EUu,__webpackgi_exports__animate=__webpackgi_exports__.jtH,__webpackgi_exports__animateAsync=__webpackgi_exports__.T0T,__webpackgi_exports__animateObject=__webpackgi_exports__.gAb,__webpackgi_exports__animatePromise=__webpackgi_exports__.iwT,__webpackgi_exports__animateSet=__webpackgi_exports__.je_,__webpackgi_exports__animateTarget=__webpackgi_exports__.wBP,__webpackgi_exports__anticipate=__webpackgi_exports__.LU2,__webpackgi_exports__applyOffset=__webpackgi_exports__.wQL,__webpackgi_exports__applyStyles=__webpackgi_exports__.Zs7,__webpackgi_exports__arrayBufferToBase64=__webpackgi_exports__.sMc,__webpackgi_exports__arrow=__webpackgi_exports__.x7s,__webpackgi_exports__attract=__webpackgi_exports__.Mnd,__webpackgi_exports__attractExpo=__webpackgi_exports__.A0_,__webpackgi_exports__auto=__webpackgi_exports__.d73,__webpackgi_exports__autoCenterObject3D=__webpackgi_exports__.HCD,__webpackgi_exports__autoScaleObject3D=__webpackgi_exports__.RG9,__webpackgi_exports__backIn=__webpackgi_exports__.G2P,__webpackgi_exports__backInOut=__webpackgi_exports__.XLf,__webpackgi_exports__backOut=__webpackgi_exports__.CGN,__webpackgi_exports__base64ToArrayBuffer=__webpackgi_exports__.RGi,__webpackgi_exports__basePlacements=__webpackgi_exports__.mvg,__webpackgi_exports__basicMaterialPropList=__webpackgi_exports__.Hiy,__webpackgi_exports__beforeMain=__webpackgi_exports__.XMc,__webpackgi_exports__beforeRead=__webpackgi_exports__.N7M,__webpackgi_exports__beforeWrite=__webpackgi_exports__.iv,__webpackgi_exports__blobToDataURL=__webpackgi_exports__.n55,__webpackgi_exports__bottom=__webpackgi_exports__.IaC,__webpackgi_exports__bounceIn=__webpackgi_exports__.h9t,__webpackgi_exports__bounceInOut=__webpackgi_exports__.yDW,__webpackgi_exports__bounceOut=__webpackgi_exports__.gJv,__webpackgi_exports__buildCSGMeshBSP=__webpackgi_exports__.l$g,__webpackgi_exports__buildCSGMeshBVH=__webpackgi_exports__.vQi,__webpackgi_exports__cLinearToRGBM=__webpackgi_exports__.$MY,__webpackgi_exports__cRGBMToLinear=__webpackgi_exports__.wJl,__webpackgi_exports__circIn=__webpackgi_exports__.Z7Y,__webpackgi_exports__circInOut=__webpackgi_exports__.X7D,__webpackgi_exports__circOut=__webpackgi_exports__.BnX,__webpackgi_exports__clamp=__webpackgi_exports__.uZ5,__webpackgi_exports__clippingParents=__webpackgi_exports__.zVI,__webpackgi_exports__combineDofShader=__webpackgi_exports__.DpF,__webpackgi_exports__compress=__webpackgi_exports__.nNb,__webpackgi_exports__compressSync=__webpackgi_exports__.cqZ,__webpackgi_exports__computeAverageGeometryNormal=__webpackgi_exports__.pKN,__webpackgi_exports__computeEigenVectors=__webpackgi_exports__.d_$,__webpackgi_exports__computeGeometryCenter=__webpackgi_exports__.DdI,__webpackgi_exports__computeGeometrySize=__webpackgi_exports__.rrX,__webpackgi_exports__computeOffsetMatrix=__webpackgi_exports__.KlC,__webpackgi_exports__computeScreenSpaceBoundingBox=__webpackgi_exports__.KVn,__webpackgi_exports__computeStyles=__webpackgi_exports__.oau,__webpackgi_exports__copyMaterialUserData=__webpackgi_exports__.aw9,__webpackgi_exports__copyObject3DUserData=__webpackgi_exports__.Aap,__webpackgi_exports__copyProps=__webpackgi_exports__.Dxg,__webpackgi_exports__copyTextureUserData=__webpackgi_exports__.MjT,__webpackgi_exports__createAnticipate=__webpackgi_exports__.F7Q,__webpackgi_exports__createAttractor=__webpackgi_exports__.IFq,__webpackgi_exports__createBackIn=__webpackgi_exports__.IJl,__webpackgi_exports__createCanvasElement=__webpackgi_exports__.O5A,__webpackgi_exports__createDiv=__webpackgi_exports__.wCn,__webpackgi_exports__createExpoIn=__webpackgi_exports__.gGT,__webpackgi_exports__createIFrameCSS3DObject=__webpackgi_exports__.pEc,__webpackgi_exports__createImage=__webpackgi_exports__.Bi6,__webpackgi_exports__createPopper=__webpackgi_exports__.fi_,__webpackgi_exports__createPopperBase=__webpackgi_exports__.TT,__webpackgi_exports__createPopperLite=__webpackgi_exports__.q2Z,__webpackgi_exports__createRenderTargetKey=__webpackgi_exports__.NyK,__webpackgi_exports__createScriptFromURL=__webpackgi_exports__.bgu,__webpackgi_exports__createStyles=__webpackgi_exports__.kcS,__webpackgi_exports__csgOperations=__webpackgi_exports__.rRN,__webpackgi_exports__css=__webpackgi_exports__.ivY,__webpackgi_exports__cubicBezier=__webpackgi_exports__._s1,__webpackgi_exports__dataTextureFromColor=__webpackgi_exports__._HO,__webpackgi_exports__dataTextureFromVec4=__webpackgi_exports__.tpL,__webpackgi_exports__decay=__webpackgi_exports__.DMK,__webpackgi_exports__decompress=__webpackgi_exports__.LjN,__webpackgi_exports__decompressSync=__webpackgi_exports__.iFs,__webpackgi_exports__deepAccessObject=__webpackgi_exports__.qTg,__webpackgi_exports__deflate=__webpackgi_exports__.Wtl,__webpackgi_exports__deflateSync=__webpackgi_exports__.DmK,__webpackgi_exports__degreesToRadians=__webpackgi_exports__.Htt,__webpackgi_exports__deserializeObject=__webpackgi_exports__.Hx7,__webpackgi_exports__deserializers=__webpackgi_exports__.imt,__webpackgi_exports__detectOverflow=__webpackgi_exports__.US6,__webpackgi_exports__diamondMaterialPropList=__webpackgi_exports__.vZs,__webpackgi_exports__distance=__webpackgi_exports__.TE$,__webpackgi_exports__downloadBlob=__webpackgi_exports__.lmu,__webpackgi_exports__downloadFile=__webpackgi_exports__.SvO,__webpackgi_exports__easeIn=__webpackgi_exports__.YQY,__webpackgi_exports__easeInOut=__webpackgi_exports__.mZN,__webpackgi_exports__easeOut=__webpackgi_exports__.VvG,__webpackgi_exports__embedUrlRefs=__webpackgi_exports__.omp,__webpackgi_exports__end=__webpackgi_exports__.utz,__webpackgi_exports__envMapBackground=__webpackgi_exports__.TFV,__webpackgi_exports__escapeRegExp=__webpackgi_exports__.hrz,__webpackgi_exports__eventListeners=__webpackgi_exports__.JKM,__webpackgi_exports__extractAnimationKey=__webpackgi_exports__.jZf,__webpackgi_exports__flattenUiConfig=__webpackgi_exports__.RjL,__webpackgi_exports__flip=__webpackgi_exports__.RRI,__webpackgi_exports__fontFormatExtensionMap=__webpackgi_exports__.RUq,__webpackgi_exports__generateUiConfig=__webpackgi_exports__._t4,__webpackgi_exports__generateUiFolder=__webpackgi_exports__.YHh,__webpackgi_exports__getEncodingComponents=__webpackgi_exports__.R8g,__webpackgi_exports__getFilenameFromPath=__webpackgi_exports__.Bbl,__webpackgi_exports__getKeyByValue=__webpackgi_exports__.V9r,__webpackgi_exports__getOrCall=__webpackgi_exports__.PZ2,__webpackgi_exports__getPropertyDescriptor=__webpackgi_exports__.w7A,__webpackgi_exports__getTexelDecoding=__webpackgi_exports__.N6S,__webpackgi_exports__getTexelDecoding2=__webpackgi_exports__.Uxp,__webpackgi_exports__getTexelDecodingFunction=__webpackgi_exports__.tAz,__webpackgi_exports__getTexelEncoding=__webpackgi_exports__.R$F,__webpackgi_exports__getTexelEncodingFunction=__webpackgi_exports__.N33,__webpackgi_exports__getTextureDataType=__webpackgi_exports__.gw2,__webpackgi_exports__getTextureEncodingFromMap=__webpackgi_exports__.KlU,__webpackgi_exports__getTypedArray=__webpackgi_exports__.rfc,__webpackgi_exports__getUrlQueryParam=__webpackgi_exports__.wo6,__webpackgi_exports__glsl=__webpackgi_exports__.H4P,__webpackgi_exports__gunzip=__webpackgi_exports__.swA,__webpackgi_exports__gunzipSync=__webpackgi_exports__._Z3,__webpackgi_exports__gzip=__webpackgi_exports__.ivc,__webpackgi_exports__gzipSync=__webpackgi_exports__.rZ1,__webpackgi_exports__hide=__webpackgi_exports__.CpZ,__webpackgi_exports__html=__webpackgi_exports__.dyc,__webpackgi_exports__htmlToCanvas=__webpackgi_exports__.MxZ,__webpackgi_exports__htmlToPng=__webpackgi_exports__.btp,__webpackgi_exports__htmlToSvg=__webpackgi_exports__.mXy,__webpackgi_exports__iGeometryIgnoredUserData=__webpackgi_exports__.Ej0,__webpackgi_exports__iMaterialIgnoredUserData=__webpackgi_exports__.ep4,__webpackgi_exports__iModelIgnoredUserData=__webpackgi_exports__.DQP,__webpackgi_exports__iTextureIgnoredUserData=__webpackgi_exports__.VNr,__webpackgi_exports__imageBitmapToBase64=__webpackgi_exports__.V7q,__webpackgi_exports__imageToCanvas=__webpackgi_exports__.zEk,__webpackgi_exports__imageUrlToImageData=__webpackgi_exports__.qfq,__webpackgi_exports__includesAll=__webpackgi_exports__.piB,__webpackgi_exports__inertia=__webpackgi_exports__.IIc,__webpackgi_exports__inflate=__webpackgi_exports__.rrF,__webpackgi_exports__inflateSync=__webpackgi_exports__.naq,__webpackgi_exports__interpolate=__webpackgi_exports__.sXR,__webpackgi_exports__isAnimatableType=__webpackgi_exports__.p5I,__webpackgi_exports__isPoint=__webpackgi_exports__.wps,__webpackgi_exports__isPoint3D=__webpackgi_exports__.wuo,__webpackgi_exports__isPropertyWritable=__webpackgi_exports__.GpE,__webpackgi_exports__keyframes=__webpackgi_exports__.F4b,__webpackgi_exports__left=__webpackgi_exports__.t$v,__webpackgi_exports__lerpAngle=__webpackgi_exports__.tdn,__webpackgi_exports__lerpAngle2=__webpackgi_exports__.Y9t,__webpackgi_exports__linear=__webpackgi_exports__.GEo,__webpackgi_exports__main=__webpackgi_exports__.DH3,__webpackgi_exports__makeColorSvg=__webpackgi_exports__.uxM,__webpackgi_exports__makeColorSvgCircle=__webpackgi_exports__.zH3,__webpackgi_exports__makeFilter=__webpackgi_exports__.MLs,__webpackgi_exports__makeSamplerUi=__webpackgi_exports__.xXG,__webpackgi_exports__makeSetterFor=__webpackgi_exports__.YM4,__webpackgi_exports__makeSetterForAnimObject=__webpackgi_exports__.B3r,__webpackgi_exports__makeTextSvg=__webpackgi_exports__.iAx,__webpackgi_exports__matDefine=__webpackgi_exports__.lDn,__webpackgi_exports__mirrorEasing=__webpackgi_exports__.oaQ,__webpackgi_exports__mix=__webpackgi_exports__.CD7,__webpackgi_exports__mixColor=__webpackgi_exports__.Rc0,__webpackgi_exports__mixComplex=__webpackgi_exports__.iPG,__webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.TIc,__webpackgi_exports__modifierPhases=__webpackgi_exports__.xsC,__webpackgi_exports__now=__webpackgi_exports__.zOc,__webpackgi_exports__offset=__webpackgi_exports__.r46,__webpackgi_exports__onChange=__webpackgi_exports__.z2C,__webpackgi_exports__parseFileExtension=__webpackgi_exports__._X$,__webpackgi_exports__patchShaderEncodingSupport=__webpackgi_exports__._yn,__webpackgi_exports__pathJoin=__webpackgi_exports__.Dyg,__webpackgi_exports__physicalMaterialPropList=__webpackgi_exports__.cUc,__webpackgi_exports__pipe=__webpackgi_exports__.zGw,__webpackgi_exports__placements=__webpackgi_exports__.Ctq,__webpackgi_exports__pointFromVector=__webpackgi_exports__.$ch,__webpackgi_exports__popper=__webpackgi_exports__.k5b,__webpackgi_exports__popperGenerator=__webpackgi_exports__.kZl,__webpackgi_exports__popperOffsets=__webpackgi_exports__.OCg,__webpackgi_exports__preventOverflow=__webpackgi_exports__.YjH,__webpackgi_exports__processViewer=__webpackgi_exports__.Ui8,__webpackgi_exports__progress=__webpackgi_exports__.YD2,__webpackgi_exports__radiansToDegrees=__webpackgi_exports__.vi9,__webpackgi_exports__read=__webpackgi_exports__.ij3,__webpackgi_exports__reference=__webpackgi_exports__.YPW,__webpackgi_exports__removeDuplicateGeometries=__webpackgi_exports__.Bg1,__webpackgi_exports__replaceAll=__webpackgi_exports__.kon,__webpackgi_exports__reverseEasing=__webpackgi_exports__.M3g,__webpackgi_exports__right=__webpackgi_exports__.F2z,__webpackgi_exports__rotateDuplicatedMesh=__webpackgi_exports__.pJF,__webpackgi_exports__sRGBEncoding=__webpackgi_exports__.knz,__webpackgi_exports__safeSetProperty=__webpackgi_exports__.Ejo,__webpackgi_exports__serializable=__webpackgi_exports__.BgY,__webpackgi_exports__serialize=__webpackgi_exports__.qCG,__webpackgi_exports__serializeObject=__webpackgi_exports__.HD9,__webpackgi_exports__serializers=__webpackgi_exports__.fEB,__webpackgi_exports__setMeshGeometry=__webpackgi_exports__.Udc,__webpackgi_exports__setMeshMaterial=__webpackgi_exports__.ZQg,__webpackgi_exports__setThreeRendererMode=__webpackgi_exports__.ofC,__webpackgi_exports__setUrlQueryParam=__webpackgi_exports__.yRy,__webpackgi_exports__setupCoreWebGiViewer=__webpackgi_exports__._NL,__webpackgi_exports__setupIModel=__webpackgi_exports__.LCA,__webpackgi_exports__setupObject3dModel=__webpackgi_exports__.j1w,__webpackgi_exports__setupSandboxWebGiEditor=__webpackgi_exports__.i8J,__webpackgi_exports__shaderReplaceString=__webpackgi_exports__.p7C,__webpackgi_exports__slerp=__webpackgi_exports__.ZAS,__webpackgi_exports__smooth=__webpackgi_exports__.ipH,__webpackgi_exports__smoothFrame=__webpackgi_exports__.$TF,__webpackgi_exports__snap=__webpackgi_exports__.uZI,__webpackgi_exports__snapObject=__webpackgi_exports__.VWG,__webpackgi_exports__sphericalFromObject=__webpackgi_exports__.pQ7,__webpackgi_exports__spring=__webpackgi_exports__.STw,__webpackgi_exports__standardMaterialPropList=__webpackgi_exports__.jc8,__webpackgi_exports__start=__webpackgi_exports__.BL_,__webpackgi_exports__steps=__webpackgi_exports__.S6,__webpackgi_exports__strFromU8=__webpackgi_exports__.T8U,__webpackgi_exports__strToU8=__webpackgi_exports__.TD6,__webpackgi_exports__svgToCanvas=__webpackgi_exports__.akS,__webpackgi_exports__svgToPng=__webpackgi_exports__.QKE,__webpackgi_exports__svgUrl=__webpackgi_exports__.dKx,__webpackgi_exports__syncAnimSetUi=__webpackgi_exports__.OvX,__webpackgi_exports__timeout=__webpackgi_exports__.VsW,__webpackgi_exports__toDecimal=__webpackgi_exports__.YMc,__webpackgi_exports__toIndexedGeometry=__webpackgi_exports__.aPg,__webpackgi_exports__toTitleCase=__webpackgi_exports__.LFn,__webpackgi_exports__top=__webpackgi_exports__.wey,__webpackgi_exports__uiButton=__webpackgi_exports__.MaE,__webpackgi_exports__uiColor=__webpackgi_exports__.s4x,__webpackgi_exports__uiConfig=__webpackgi_exports__.FJA,__webpackgi_exports__uiDropdown=__webpackgi_exports__.vIA,__webpackgi_exports__uiFolder=__webpackgi_exports__.Spv,__webpackgi_exports__uiImage=__webpackgi_exports__.w8l,__webpackgi_exports__uiInput=__webpackgi_exports__.riG,__webpackgi_exports__uiMonitor=__webpackgi_exports__.Kbh,__webpackgi_exports__uiPanel=__webpackgi_exports__.BFq,__webpackgi_exports__uiSlider=__webpackgi_exports__.t8K,__webpackgi_exports__uiToggle=__webpackgi_exports__.Q7n,__webpackgi_exports__uiVector=__webpackgi_exports__.KGF,__webpackgi_exports__uniform=__webpackgi_exports__.e5,__webpackgi_exports__unzip=__webpackgi_exports__.Rik,__webpackgi_exports__unzipSync=__webpackgi_exports__.GZo,__webpackgi_exports__unzlib=__webpackgi_exports__.Bds,__webpackgi_exports__unzlibSync=__webpackgi_exports__.HTu,__webpackgi_exports__uploadFile=__webpackgi_exports__.cTq,__webpackgi_exports__vLinearToRGBM=__webpackgi_exports__.X_Y,__webpackgi_exports__vRGBMToLinear=__webpackgi_exports__.dA8,__webpackgi_exports__variationPlacements=__webpackgi_exports__.bwS,__webpackgi_exports__velocityPerFrame=__webpackgi_exports__.Lks,__webpackgi_exports__velocityPerSecond=__webpackgi_exports__.Rvq,__webpackgi_exports__verifyPermission=__webpackgi_exports__.P4F,__webpackgi_exports__viewerGLTFExtension=__webpackgi_exports__.Pd0,__webpackgi_exports__viewport=__webpackgi_exports__.Pjo,__webpackgi_exports__webgiLightExtrasExtension=__webpackgi_exports__.Tum,__webpackgi_exports__webgiMaterialExtrasExtension=__webpackgi_exports__.dRH,__webpackgi_exports__webgiObject3DExtrasExtension=__webpackgi_exports__.RX0,__webpackgi_exports__wrap=__webpackgi_exports__.reQ,__webpackgi_exports__write=__webpackgi_exports__.cWm,__webpackgi_exports__writeFile=__webpackgi_exports__.NC9,__webpackgi_exports__zip=__webpackgi_exports__.$Re,__webpackgi_exports__zipSync=__webpackgi_exports__.Xo9,__webpackgi_exports__zlib=__webpackgi_exports__.LNO,__webpackgi_exports__zlibSync=__webpackgi_exports__.iZP;exports.zlibSync=__webpackgi_exports__zlibSync,exports.zlib=__webpackgi_exports__zlib,exports.zipSync=__webpackgi_exports__zipSync,exports.zip=__webpackgi_exports__zip,exports.writeFile=__webpackgi_exports__writeFile,exports.write=__webpackgi_exports__write,exports.wrap=__webpackgi_exports__wrap,exports.webgiObject3DExtrasExtension=__webpackgi_exports__webgiObject3DExtrasExtension,exports.webgiMaterialExtrasExtension=__webpackgi_exports__webgiMaterialExtrasExtension,exports.webgiLightExtrasExtension=__webpackgi_exports__webgiLightExtrasExtension,exports.viewport=__webpackgi_exports__viewport,exports.viewerGLTFExtension=__webpackgi_exports__viewerGLTFExtension,exports.verifyPermission=__webpackgi_exports__verifyPermission,exports.velocityPerSecond=__webpackgi_exports__velocityPerSecond,exports.velocityPerFrame=__webpackgi_exports__velocityPerFrame,exports.variationPlacements=__webpackgi_exports__variationPlacements,exports.vRGBMToLinear=__webpackgi_exports__vRGBMToLinear,exports.vLinearToRGBM=__webpackgi_exports__vLinearToRGBM,exports.uploadFile=__webpackgi_exports__uploadFile,exports.unzlibSync=__webpackgi_exports__unzlibSync,exports.unzlib=__webpackgi_exports__unzlib,exports.unzipSync=__webpackgi_exports__unzipSync,exports.unzip=__webpackgi_exports__unzip,exports.uniform=__webpackgi_exports__uniform,exports.uiVector=__webpackgi_exports__uiVector,exports.uiToggle=__webpackgi_exports__uiToggle,exports.uiSlider=__webpackgi_exports__uiSlider,exports.uiPanel=__webpackgi_exports__uiPanel,exports.uiMonitor=__webpackgi_exports__uiMonitor,exports.uiInput=__webpackgi_exports__uiInput,exports.uiImage=__webpackgi_exports__uiImage,exports.uiFolder=__webpackgi_exports__uiFolder,exports.uiDropdown=__webpackgi_exports__uiDropdown,exports.uiConfig=__webpackgi_exports__uiConfig,exports.uiColor=__webpackgi_exports__uiColor,exports.uiButton=__webpackgi_exports__uiButton,exports.top=__webpackgi_exports__top,exports.toTitleCase=__webpackgi_exports__toTitleCase,exports.toIndexedGeometry=__webpackgi_exports__toIndexedGeometry,exports.toDecimal=__webpackgi_exports__toDecimal,exports.timeout=__webpackgi_exports__timeout,exports.syncAnimSetUi=__webpackgi_exports__syncAnimSetUi,exports.svgUrl=__webpackgi_exports__svgUrl,exports.svgToPng=__webpackgi_exports__svgToPng,exports.svgToCanvas=__webpackgi_exports__svgToCanvas,exports.strToU8=__webpackgi_exports__strToU8,exports.strFromU8=__webpackgi_exports__strFromU8,exports.steps=__webpackgi_exports__steps,exports.start=__webpackgi_exports__start,exports.standardMaterialPropList=__webpackgi_exports__standardMaterialPropList,exports.spring=__webpackgi_exports__spring,exports.sphericalFromObject=__webpackgi_exports__sphericalFromObject,exports.snapObject=__webpackgi_exports__snapObject,exports.snap=__webpackgi_exports__snap,exports.smoothFrame=__webpackgi_exports__smoothFrame,exports.smooth=__webpackgi_exports__smooth,exports.slerp=__webpackgi_exports__slerp,exports.shaderReplaceString=__webpackgi_exports__shaderReplaceString,exports.setupSandboxWebGiEditor=__webpackgi_exports__setupSandboxWebGiEditor,exports.setupObject3dModel=__webpackgi_exports__setupObject3dModel,exports.setupIModel=__webpackgi_exports__setupIModel,exports.setupCoreWebGiViewer=__webpackgi_exports__setupCoreWebGiViewer,exports.setUrlQueryParam=__webpackgi_exports__setUrlQueryParam,exports.setThreeRendererMode=__webpackgi_exports__setThreeRendererMode,exports.setMeshMaterial=__webpackgi_exports__setMeshMaterial,exports.setMeshGeometry=__webpackgi_exports__setMeshGeometry,exports.serializers=__webpackgi_exports__serializers,exports.serializeObject=__webpackgi_exports__serializeObject,exports.serialize=__webpackgi_exports__serialize,exports.serializable=__webpackgi_exports__serializable,exports.safeSetProperty=__webpackgi_exports__safeSetProperty,exports.sRGBEncoding=__webpackgi_exports__sRGBEncoding,exports.rotateDuplicatedMesh=__webpackgi_exports__rotateDuplicatedMesh,exports.right=__webpackgi_exports__right,exports.reverseEasing=__webpackgi_exports__reverseEasing,exports.replaceAll=__webpackgi_exports__replaceAll,exports.removeDuplicateGeometries=__webpackgi_exports__removeDuplicateGeometries,exports.reference=__webpackgi_exports__reference,exports.read=__webpackgi_exports__read,exports.radiansToDegrees=__webpackgi_exports__radiansToDegrees,exports.progress=__webpackgi_exports__progress,exports.processViewer=__webpackgi_exports__processViewer,exports.preventOverflow=__webpackgi_exports__preventOverflow,exports.popperOffsets=__webpackgi_exports__popperOffsets,exports.popperGenerator=__webpackgi_exports__popperGenerator,exports.popper=__webpackgi_exports__popper,exports.pointFromVector=__webpackgi_exports__pointFromVector,exports.placements=__webpackgi_exports__placements,exports.pipe=__webpackgi_exports__pipe,exports.physicalMaterialPropList=__webpackgi_exports__physicalMaterialPropList,exports.pathJoin=__webpackgi_exports__pathJoin,exports.patchShaderEncodingSupport=__webpackgi_exports__patchShaderEncodingSupport,exports.parseFileExtension=__webpackgi_exports__parseFileExtension,exports.onChange=__webpackgi_exports__onChange,exports.offset=__webpackgi_exports__offset,exports.now=__webpackgi_exports__now,exports.modifierPhases=__webpackgi_exports__modifierPhases,exports.mobileAndTabletCheck=__webpackgi_exports__mobileAndTabletCheck,exports.mixComplex=__webpackgi_exports__mixComplex,exports.mixColor=__webpackgi_exports__mixColor,exports.mix=__webpackgi_exports__mix,exports.mirrorEasing=__webpackgi_exports__mirrorEasing,exports.matDefine=__webpackgi_exports__matDefine,exports.makeTextSvg=__webpackgi_exports__makeTextSvg,exports.makeSetterForAnimObject=__webpackgi_exports__makeSetterForAnimObject,exports.makeSetterFor=__webpackgi_exports__makeSetterFor,exports.makeSamplerUi=__webpackgi_exports__makeSamplerUi,exports.makeFilter=__webpackgi_exports__makeFilter,exports.makeColorSvgCircle=__webpackgi_exports__makeColorSvgCircle,exports.makeColorSvg=__webpackgi_exports__makeColorSvg,exports.main=__webpackgi_exports__main,exports.linear=__webpackgi_exports__linear,exports.lerpAngle2=__webpackgi_exports__lerpAngle2,exports.lerpAngle=__webpackgi_exports__lerpAngle,exports.left=__webpackgi_exports__left,exports.keyframes=__webpackgi_exports__keyframes,exports.isPropertyWritable=__webpackgi_exports__isPropertyWritable,exports.isPoint3D=__webpackgi_exports__isPoint3D,exports.isPoint=__webpackgi_exports__isPoint,exports.isAnimatableType=__webpackgi_exports__isAnimatableType,exports.interpolate=__webpackgi_exports__interpolate,exports.inflateSync=__webpackgi_exports__inflateSync,exports.inflate=__webpackgi_exports__inflate,exports.inertia=__webpackgi_exports__inertia,exports.includesAll=__webpackgi_exports__includesAll,exports.imageUrlToImageData=__webpackgi_exports__imageUrlToImageData,exports.imageToCanvas=__webpackgi_exports__imageToCanvas,exports.imageBitmapToBase64=__webpackgi_exports__imageBitmapToBase64,exports.iTextureIgnoredUserData=__webpackgi_exports__iTextureIgnoredUserData,exports.iModelIgnoredUserData=__webpackgi_exports__iModelIgnoredUserData,exports.iMaterialIgnoredUserData=__webpackgi_exports__iMaterialIgnoredUserData,exports.iGeometryIgnoredUserData=__webpackgi_exports__iGeometryIgnoredUserData,exports.htmlToSvg=__webpackgi_exports__htmlToSvg,exports.htmlToPng=__webpackgi_exports__htmlToPng,exports.htmlToCanvas=__webpackgi_exports__htmlToCanvas,exports.html=__webpackgi_exports__html,exports.hide=__webpackgi_exports__hide,exports.gzipSync=__webpackgi_exports__gzipSync,exports.gzip=__webpackgi_exports__gzip,exports.gunzipSync=__webpackgi_exports__gunzipSync,exports.gunzip=__webpackgi_exports__gunzip,exports.glsl=__webpackgi_exports__glsl,exports.getUrlQueryParam=__webpackgi_exports__getUrlQueryParam,exports.getTypedArray=__webpackgi_exports__getTypedArray,exports.getTextureEncodingFromMap=__webpackgi_exports__getTextureEncodingFromMap,exports.getTextureDataType=__webpackgi_exports__getTextureDataType,exports.getTexelEncodingFunction=__webpackgi_exports__getTexelEncodingFunction,exports.getTexelEncoding=__webpackgi_exports__getTexelEncoding,exports.getTexelDecodingFunction=__webpackgi_exports__getTexelDecodingFunction,exports.getTexelDecoding2=__webpackgi_exports__getTexelDecoding2,exports.getTexelDecoding=__webpackgi_exports__getTexelDecoding,exports.getPropertyDescriptor=__webpackgi_exports__getPropertyDescriptor,exports.getOrCall=__webpackgi_exports__getOrCall,exports.getKeyByValue=__webpackgi_exports__getKeyByValue,exports.getFilenameFromPath=__webpackgi_exports__getFilenameFromPath,exports.getEncodingComponents=__webpackgi_exports__getEncodingComponents,exports.generateUiFolder=__webpackgi_exports__generateUiFolder,exports.generateUiConfig=__webpackgi_exports__generateUiConfig,exports.fontFormatExtensionMap=__webpackgi_exports__fontFormatExtensionMap,exports.flip=__webpackgi_exports__flip,exports.flattenUiConfig=__webpackgi_exports__flattenUiConfig,exports.extractAnimationKey=__webpackgi_exports__extractAnimationKey,exports.eventListeners=__webpackgi_exports__eventListeners,exports.escapeRegExp=__webpackgi_exports__escapeRegExp,exports.envMapBackground=__webpackgi_exports__envMapBackground,exports.end=__webpackgi_exports__end,exports.embedUrlRefs=__webpackgi_exports__embedUrlRefs,exports.easeOut=__webpackgi_exports__easeOut,exports.easeInOut=__webpackgi_exports__easeInOut,exports.easeIn=__webpackgi_exports__easeIn,exports.downloadFile=__webpackgi_exports__downloadFile,exports.downloadBlob=__webpackgi_exports__downloadBlob,exports.distance=__webpackgi_exports__distance,exports.diamondMaterialPropList=__webpackgi_exports__diamondMaterialPropList,exports.detectOverflow=__webpackgi_exports__detectOverflow,exports.deserializers=__webpackgi_exports__deserializers,exports.deserializeObject=__webpackgi_exports__deserializeObject,exports.degreesToRadians=__webpackgi_exports__degreesToRadians,exports.deflateSync=__webpackgi_exports__deflateSync,exports.deflate=__webpackgi_exports__deflate,exports.deepAccessObject=__webpackgi_exports__deepAccessObject,exports.decompressSync=__webpackgi_exports__decompressSync,exports.decompress=__webpackgi_exports__decompress,exports.decay=__webpackgi_exports__decay,exports.dataTextureFromVec4=__webpackgi_exports__dataTextureFromVec4,exports.dataTextureFromColor=__webpackgi_exports__dataTextureFromColor,exports.cubicBezier=__webpackgi_exports__cubicBezier,exports.css=__webpackgi_exports__css,exports.csgOperations=__webpackgi_exports__csgOperations,exports.createStyles=__webpackgi_exports__createStyles,exports.createScriptFromURL=__webpackgi_exports__createScriptFromURL,exports.createRenderTargetKey=__webpackgi_exports__createRenderTargetKey,exports.createPopperLite=__webpackgi_exports__createPopperLite,exports.createPopperBase=__webpackgi_exports__createPopperBase,exports.createPopper=__webpackgi_exports__createPopper,exports.createImage=__webpackgi_exports__createImage,exports.createIFrameCSS3DObject=__webpackgi_exports__createIFrameCSS3DObject,exports.createExpoIn=__webpackgi_exports__createExpoIn,exports.createDiv=__webpackgi_exports__createDiv,exports.createCanvasElement=__webpackgi_exports__createCanvasElement,exports.createBackIn=__webpackgi_exports__createBackIn,exports.createAttractor=__webpackgi_exports__createAttractor,exports.createAnticipate=__webpackgi_exports__createAnticipate,exports.copyTextureUserData=__webpackgi_exports__copyTextureUserData,exports.copyProps=__webpackgi_exports__copyProps,exports.copyObject3DUserData=__webpackgi_exports__copyObject3DUserData,exports.copyMaterialUserData=__webpackgi_exports__copyMaterialUserData,exports.computeStyles=__webpackgi_exports__computeStyles,exports.computeScreenSpaceBoundingBox=__webpackgi_exports__computeScreenSpaceBoundingBox,exports.computeOffsetMatrix=__webpackgi_exports__computeOffsetMatrix,exports.computeGeometrySize=__webpackgi_exports__computeGeometrySize,exports.computeGeometryCenter=__webpackgi_exports__computeGeometryCenter,exports.computeEigenVectors=__webpackgi_exports__computeEigenVectors,exports.computeAverageGeometryNormal=__webpackgi_exports__computeAverageGeometryNormal,exports.compressSync=__webpackgi_exports__compressSync,exports.compress=__webpackgi_exports__compress,exports.combineDofShader=__webpackgi_exports__combineDofShader,exports.clippingParents=__webpackgi_exports__clippingParents,exports.clamp=__webpackgi_exports__clamp,exports.circOut=__webpackgi_exports__circOut,exports.circInOut=__webpackgi_exports__circInOut,exports.circIn=__webpackgi_exports__circIn,exports.cRGBMToLinear=__webpackgi_exports__cRGBMToLinear,exports.cLinearToRGBM=__webpackgi_exports__cLinearToRGBM,exports.buildCSGMeshBVH=__webpackgi_exports__buildCSGMeshBVH,exports.buildCSGMeshBSP=__webpackgi_exports__buildCSGMeshBSP,exports.bounceOut=__webpackgi_exports__bounceOut,exports.bounceInOut=__webpackgi_exports__bounceInOut,exports.bounceIn=__webpackgi_exports__bounceIn,exports.bottom=__webpackgi_exports__bottom,exports.blobToDataURL=__webpackgi_exports__blobToDataURL,exports.beforeWrite=__webpackgi_exports__beforeWrite,exports.beforeRead=__webpackgi_exports__beforeRead,exports.beforeMain=__webpackgi_exports__beforeMain,exports.basicMaterialPropList=__webpackgi_exports__basicMaterialPropList,exports.basePlacements=__webpackgi_exports__basePlacements,exports.base64ToArrayBuffer=__webpackgi_exports__base64ToArrayBuffer,exports.backOut=__webpackgi_exports__backOut,exports.backInOut=__webpackgi_exports__backInOut,exports.backIn=__webpackgi_exports__backIn,exports.autoScaleObject3D=__webpackgi_exports__autoScaleObject3D,exports.autoCenterObject3D=__webpackgi_exports__autoCenterObject3D,exports.auto=__webpackgi_exports__auto,exports.attractExpo=__webpackgi_exports__attractExpo,exports.attract=__webpackgi_exports__attract,exports.arrow=__webpackgi_exports__arrow,exports.arrayBufferToBase64=__webpackgi_exports__arrayBufferToBase64,exports.applyStyles=__webpackgi_exports__applyStyles,exports.applyOffset=__webpackgi_exports__applyOffset,exports.anticipate=__webpackgi_exports__anticipate,exports.animateTarget=__webpackgi_exports__animateTarget,exports.animateSet=__webpackgi_exports__animateSet,exports.animatePromise=__webpackgi_exports__animatePromise,exports.animateObject=__webpackgi_exports__animateObject,exports.animateAsync=__webpackgi_exports__animateAsync,exports.animate=__webpackgi_exports__animate,exports.angle=__webpackgi_exports__angle,exports.afterWrite=__webpackgi_exports__afterWrite,exports.afterRead=__webpackgi_exports__afterRead,exports.afterMain=__webpackgi_exports__afterMain,exports.addZipLoader=__webpackgi_exports__addZipLoader,exports.addRGBELoader=__webpackgi_exports__addRGBELoader,exports.addLUTData=__webpackgi_exports__addLUTData,exports.addGLTFLoader=__webpackgi_exports__addGLTFLoader,exports.addGLTFExporter=__webpackgi_exports__addGLTFExporter,exports.addDracoLoader=__webpackgi_exports__addDracoLoader,exports.addBasePlugins=__webpackgi_exports__addBasePlugins,exports._SRGBAFormat=__webpackgi_exports___SRGBAFormat,exports.Zlib=__webpackgi_exports__Zlib,exports.ZipPassThrough=__webpackgi_exports__ZipPassThrough,exports.ZipLoader=__webpackgi_exports__ZipLoader,exports.ZipDeflate=__webpackgi_exports__ZipDeflate,exports.Zip=__webpackgi_exports__Zip,exports.ZeroStencilOp=__webpackgi_exports__ZeroStencilOp,exports.ZeroSlopeEnding=__webpackgi_exports__ZeroSlopeEnding,exports.ZeroFactor=__webpackgi_exports__ZeroFactor,exports.ZeroCurvatureEnding=__webpackgi_exports__ZeroCurvatureEnding,exports.WrapAroundEnding=__webpackgi_exports__WrapAroundEnding,exports.WireframeGeometry=__webpackgi_exports__WireframeGeometry,exports.WindowiseDialogPlugin=__webpackgi_exports__WindowiseDialogPlugin,exports.WebGiViewerElement=__webpackgi_exports__WebGiViewerElement,exports.WebGLUtils=__webpackgi_exports__WebGLUtils,exports.WebGLRenderer=__webpackgi_exports__WebGLRenderer,exports.WebGLRenderTarget=__webpackgi_exports__WebGLRenderTarget,exports.WebGLMultisampleRenderTarget=__webpackgi_exports__WebGLMultisampleRenderTarget,exports.WebGLMultipleRenderTargets=__webpackgi_exports__WebGLMultipleRenderTargets,exports.WebGLCubeRenderTarget=__webpackgi_exports__WebGLCubeRenderTarget,exports.WebGLArrayRenderTarget=__webpackgi_exports__WebGLArrayRenderTarget,exports.WebGL3DRenderTarget=__webpackgi_exports__WebGL3DRenderTarget,exports.WebGL1Renderer=__webpackgi_exports__WebGL1Renderer,exports.VignettePlugin=__webpackgi_exports__VignettePlugin,exports.ViewerState=__webpackgi_exports__ViewerState,exports.ViewerApp=__webpackgi_exports__ViewerApp,exports.VideoTexture=__webpackgi_exports__VideoTexture,exports.VelocityBufferPlugin=__webpackgi_exports__VelocityBufferPlugin,exports.VectorKeyframeTrack=__webpackgi_exports__VectorKeyframeTrack,exports.Vector4=__webpackgi_exports__Vector4,exports.Vector3=__webpackgi_exports__Vector3,exports.Vector2=__webpackgi_exports__Vector2,exports.VSMShadowMap=__webpackgi_exports__VSMShadowMap,exports.Unzlib=__webpackgi_exports__Unzlib,exports.UnzipPassThrough=__webpackgi_exports__UnzipPassThrough,exports.UnzipInflate=__webpackgi_exports__UnzipInflate,exports.Unzip=__webpackgi_exports__Unzip,exports.UnsignedShortType=__webpackgi_exports__UnsignedShortType,exports.UnsignedShort5551Type=__webpackgi_exports__UnsignedShort5551Type,exports.UnsignedShort4444Type=__webpackgi_exports__UnsignedShort4444Type,exports.UnsignedIntType=__webpackgi_exports__UnsignedIntType,exports.UnsignedInt248Type=__webpackgi_exports__UnsignedInt248Type,exports.UnsignedByteType=__webpackgi_exports__UnsignedByteType,exports.UniformsUtils=__webpackgi_exports__UniformsUtils,exports.UniformsLib=__webpackgi_exports__UniformsLib,exports.UniformsGroup=__webpackgi_exports__UniformsGroup,exports.Uniform=__webpackgi_exports__Uniform,exports.Uncharted2Tonemapping=__webpackgi_exports__Uncharted2Tonemapping,exports.Uint8ClampedBufferAttribute=__webpackgi_exports__Uint8ClampedBufferAttribute,exports.Uint8BufferAttribute=__webpackgi_exports__Uint8BufferAttribute,exports.Uint32BufferAttribute=__webpackgi_exports__Uint32BufferAttribute,exports.Uint16BufferAttribute=__webpackgi_exports__Uint16BufferAttribute,exports.UVMapping=__webpackgi_exports__UVMapping,exports.TweakpaneWrapper=__webpackgi_exports__TweakpaneWrapper,exports.TweakpaneUiPlugin=__webpackgi_exports__TweakpaneUiPlugin,exports.TubeShapeGeometry=__webpackgi_exports__TubeShapeGeometry,exports.TubeGeometry=__webpackgi_exports__TubeGeometry,exports.TubeBufferGeometry=__webpackgi_exports__TubeBufferGeometry,exports.TrianglesDrawMode=__webpackgi_exports__TrianglesDrawMode,exports.TriangleStripDrawMode=__webpackgi_exports__TriangleStripDrawMode,exports.TriangleFanDrawMode=__webpackgi_exports__TriangleFanDrawMode,exports.Triangle=__webpackgi_exports__Triangle,exports.TransformControls2=__webpackgi_exports__TransformControls2,exports.TorusKnotGeometry=__webpackgi_exports__TorusKnotGeometry,exports.TorusKnotBufferGeometry=__webpackgi_exports__TorusKnotBufferGeometry,exports.TorusGeometry=__webpackgi_exports__TorusGeometry,exports.TorusBufferGeometry=__webpackgi_exports__TorusBufferGeometry,exports.TonemapPlugin=__webpackgi_exports__TonemapPlugin,exports.ThreeMaterialLoader=__webpackgi_exports__ThreeMaterialLoader,exports.ThinFilmLayerPlugin=__webpackgi_exports__ThinFilmLayerPlugin,exports.TextureLoader=__webpackgi_exports__TextureLoader,exports.Texture=__webpackgi_exports__Texture,exports.TextSVGOptions=__webpackgi_exports__TextSVGOptions,exports.TetrahedronGeometry=__webpackgi_exports__TetrahedronGeometry,exports.TetrahedronBufferGeometry=__webpackgi_exports__TetrahedronBufferGeometry,exports.TemporalAAPlugin=__webpackgi_exports__TemporalAAPlugin,exports.TangentSpaceNormalMap=__webpackgi_exports__TangentSpaceNormalMap,exports.TOUCH=__webpackgi_exports__TOUCH,exports.SwitchNodePlugin=__webpackgi_exports__SwitchNodePlugin,exports.SubtractiveBlending=__webpackgi_exports__SubtractiveBlending,exports.SubtractEquation=__webpackgi_exports__SubtractEquation,exports.StringKeyframeTrack=__webpackgi_exports__StringKeyframeTrack,exports.StreamReadUsage=__webpackgi_exports__StreamReadUsage,exports.StreamDrawUsage=__webpackgi_exports__StreamDrawUsage,exports.StreamCopyUsage=__webpackgi_exports__StreamCopyUsage,exports.StereoCamera=__webpackgi_exports__StereoCamera,exports.StaticReadUsage=__webpackgi_exports__StaticReadUsage,exports.StaticDrawUsage=__webpackgi_exports__StaticDrawUsage,exports.StaticCopyUsage=__webpackgi_exports__StaticCopyUsage,exports.SrcColorFactor=__webpackgi_exports__SrcColorFactor,exports.SrcAlphaSaturateFactor=__webpackgi_exports__SrcAlphaSaturateFactor,exports.SrcAlphaFactor=__webpackgi_exports__SrcAlphaFactor,exports.SpriteMaterial=__webpackgi_exports__SpriteMaterial,exports.Sprite=__webpackgi_exports__Sprite,exports.SpotLightHelper=__webpackgi_exports__SpotLightHelper,exports.SpotLight2=__webpackgi_exports__SpotLight2,exports.SpotLight=__webpackgi_exports__SpotLight,exports.SplineCurve=__webpackgi_exports__SplineCurve,exports.SphericalHarmonics3=__webpackgi_exports__SphericalHarmonics3,exports.Spherical=__webpackgi_exports__Spherical,exports.SphereSelectionWidget=__webpackgi_exports__SphereSelectionWidget,exports.SphereGeometry=__webpackgi_exports__SphereGeometry,exports.SphereBufferGeometry=__webpackgi_exports__SphereBufferGeometry,exports.Sphere=__webpackgi_exports__Sphere,exports.Source=__webpackgi_exports__Source,exports.SkinnedMesh=__webpackgi_exports__SkinnedMesh,exports.SkeletonHelper=__webpackgi_exports__SkeletonHelper,exports.Skeleton=__webpackgi_exports__Skeleton,exports.SimpleViewerUi=__webpackgi_exports__SimpleViewerUi,exports.SimpleTextPlugin=__webpackgi_exports__SimpleTextPlugin,exports.SimpleTextExporter=__webpackgi_exports__SimpleTextExporter,exports.SimpleJSONLoader=__webpackgi_exports__SimpleJSONLoader,exports.SimpleJSONExporter=__webpackgi_exports__SimpleJSONExporter,exports.SimpleEventDispatcher=__webpackgi_exports__SimpleEventDispatcher,exports.SimpleDataSource=__webpackgi_exports__SimpleDataSource,exports.SimpleBackgroundEnvUiPlugin=__webpackgi_exports__SimpleBackgroundEnvUiPlugin,exports.SimpleAssetList=__webpackgi_exports__SimpleAssetList,exports.ShortType=__webpackgi_exports__ShortType,exports.ShapeUtils=__webpackgi_exports__ShapeUtils,exports.ShapeTubeExtrudePlugin=__webpackgi_exports__ShapeTubeExtrudePlugin,exports.ShapePath=__webpackgi_exports__ShapePath,exports.ShapeGeometry=__webpackgi_exports__ShapeGeometry,exports.ShapeBufferGeometry=__webpackgi_exports__ShapeBufferGeometry,exports.Shape=__webpackgi_exports__Shape,exports.ShadowMaterial=__webpackgi_exports__ShadowMaterial,exports.ShadowMapBaker=__webpackgi_exports__ShadowMapBaker,exports.ShaderPass2=__webpackgi_exports__ShaderPass2,exports.ShaderMaterialEncodingSupport=__webpackgi_exports__ShaderMaterialEncodingSupport,exports.ShaderMaterial2=__webpackgi_exports__ShaderMaterial2,exports.ShaderMaterial=__webpackgi_exports__ShaderMaterial,exports.ShaderLib=__webpackgi_exports__ShaderLib,exports.ShaderChunk=__webpackgi_exports__ShaderChunk,exports.SelectionWidget=__webpackgi_exports__SelectionWidget,exports.SceneLoopPlugin=__webpackgi_exports__SceneLoopPlugin,exports.SceneCamerasUiPlugin=__webpackgi_exports__SceneCamerasUiPlugin,exports.Scene=__webpackgi_exports__Scene,exports.STLLoadPlugin=__webpackgi_exports__STLLoadPlugin,exports.SSRPlugin=__webpackgi_exports__SSRPlugin,exports.SSGIPlugin=__webpackgi_exports__SSGIPlugin,exports.SSContactShadows=__webpackgi_exports__SSContactShadows,exports.SSBevelPlugin=__webpackgi_exports__SSBevelPlugin,exports.SSAOPlugin=__webpackgi_exports__SSAOPlugin,exports.SRGBColorSpace=__webpackgi_exports__SRGBColorSpace,exports.SETTLING_TIME=__webpackgi_exports__SETTLING_TIME,exports.RootScene=__webpackgi_exports__RootScene,exports.RingGeometry=__webpackgi_exports__RingGeometry,exports.RingBufferGeometry=__webpackgi_exports__RingBufferGeometry,exports.Rhino3dmLoader2=__webpackgi_exports__Rhino3dmLoader2,exports.Rhino3dmLoadPlugin=__webpackgi_exports__Rhino3dmLoadPlugin,exports.ReverseSubtractEquation=__webpackgi_exports__ReverseSubtractEquation,exports.ReplaceStencilOp=__webpackgi_exports__ReplaceStencilOp,exports.RepeatWrapping=__webpackgi_exports__RepeatWrapping,exports.RendererUiPlugin=__webpackgi_exports__RendererUiPlugin,exports.ReinhardToneMapping=__webpackgi_exports__ReinhardToneMapping,exports.Reflector2=__webpackgi_exports__Reflector2,exports.RedIntegerFormat=__webpackgi_exports__RedIntegerFormat,exports.RedFormat=__webpackgi_exports__RedFormat,exports.RectAreaLight=__webpackgi_exports__RectAreaLight,exports.Raycaster=__webpackgi_exports__Raycaster,exports.Ray=__webpackgi_exports__Ray,exports.RawShaderMaterial=__webpackgi_exports__RawShaderMaterial,exports.RandomizedDirectionalLightPlugin=__webpackgi_exports__RandomizedDirectionalLightPlugin,exports.RandomizedDirectionalLight=__webpackgi_exports__RandomizedDirectionalLight,exports.RGIntegerFormat=__webpackgi_exports__RGIntegerFormat,exports.RGFormat=__webpackgi_exports__RGFormat,exports.RGB_S3TC_DXT1_Format=__webpackgi_exports__RGB_S3TC_DXT1_Format,exports.RGB_PVRTC_4BPPV1_Format=__webpackgi_exports__RGB_PVRTC_4BPPV1_Format,exports.RGB_PVRTC_2BPPV1_Format=__webpackgi_exports__RGB_PVRTC_2BPPV1_Format,exports.RGB_ETC2_Format=__webpackgi_exports__RGB_ETC2_Format,exports.RGB_ETC1_Format=__webpackgi_exports__RGB_ETC1_Format,exports.RGBM7Encoding=__webpackgi_exports__RGBM7Encoding,exports.RGBM16Encoding_=__webpackgi_exports__RGBM16Encoding_,exports.RGBM16Encoding=__webpackgi_exports__RGBM16Encoding,exports.RGBFormat=__webpackgi_exports__RGBFormat,exports.RGBA_S3TC_DXT5_Format=__webpackgi_exports__RGBA_S3TC_DXT5_Format,exports.RGBA_S3TC_DXT3_Format=__webpackgi_exports__RGBA_S3TC_DXT3_Format,exports.RGBA_S3TC_DXT1_Format=__webpackgi_exports__RGBA_S3TC_DXT1_Format,exports.RGBA_PVRTC_4BPPV1_Format=__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format,exports.RGBA_PVRTC_2BPPV1_Format=__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format,exports.RGBA_ETC2_EAC_Format=__webpackgi_exports__RGBA_ETC2_EAC_Format,exports.RGBA_BPTC_Format=__webpackgi_exports__RGBA_BPTC_Format,exports.RGBA_ASTC_8x8_Format=__webpackgi_exports__RGBA_ASTC_8x8_Format,exports.RGBA_ASTC_8x6_Format=__webpackgi_exports__RGBA_ASTC_8x6_Format,exports.RGBA_ASTC_8x5_Format=__webpackgi_exports__RGBA_ASTC_8x5_Format,exports.RGBA_ASTC_6x6_Format=__webpackgi_exports__RGBA_ASTC_6x6_Format,exports.RGBA_ASTC_6x5_Format=__webpackgi_exports__RGBA_ASTC_6x5_Format,exports.RGBA_ASTC_5x5_Format=__webpackgi_exports__RGBA_ASTC_5x5_Format,exports.RGBA_ASTC_5x4_Format=__webpackgi_exports__RGBA_ASTC_5x4_Format,exports.RGBA_ASTC_4x4_Format=__webpackgi_exports__RGBA_ASTC_4x4_Format,exports.RGBA_ASTC_12x12_Format=__webpackgi_exports__RGBA_ASTC_12x12_Format,exports.RGBA_ASTC_12x10_Format=__webpackgi_exports__RGBA_ASTC_12x10_Format,exports.RGBA_ASTC_10x8_Format=__webpackgi_exports__RGBA_ASTC_10x8_Format,exports.RGBA_ASTC_10x6_Format=__webpackgi_exports__RGBA_ASTC_10x6_Format,exports.RGBA_ASTC_10x5_Format=__webpackgi_exports__RGBA_ASTC_10x5_Format,exports.RGBA_ASTC_10x10_Format=__webpackgi_exports__RGBA_ASTC_10x10_Format,exports.RGBAIntegerFormat=__webpackgi_exports__RGBAIntegerFormat,exports.RGBAFormat=__webpackgi_exports__RGBAFormat,exports.RGBADepthPacking=__webpackgi_exports__RGBADepthPacking,exports.REVISION=__webpackgi_exports__REVISION,exports.QuaternionLinearInterpolant=__webpackgi_exports__QuaternionLinearInterpolant,exports.QuaternionKeyframeTrack=__webpackgi_exports__QuaternionKeyframeTrack,exports.Quaternion=__webpackgi_exports__Quaternion,exports.QuadraticBezierCurve3=__webpackgi_exports__QuadraticBezierCurve3,exports.QuadraticBezierCurve=__webpackgi_exports__QuadraticBezierCurve,exports.PropertyMixer=__webpackgi_exports__PropertyMixer,exports.PropertyBinding=__webpackgi_exports__PropertyBinding,exports.ProgressivePlugin=__webpackgi_exports__ProgressivePlugin,exports.PresetLibraryPlugin=__webpackgi_exports__PresetLibraryPlugin,exports.PositionalAudio=__webpackgi_exports__PositionalAudio,exports.PopmotionPlugin=__webpackgi_exports__PopmotionPlugin,exports.PolyhedronGeometry=__webpackgi_exports__PolyhedronGeometry,exports.PolyhedronBufferGeometry=__webpackgi_exports__PolyhedronBufferGeometry,exports.PolarGridHelper=__webpackgi_exports__PolarGridHelper,exports.PointsMaterial=__webpackgi_exports__PointsMaterial,exports.Points=__webpackgi_exports__Points,exports.PointerLockControlsPlugin=__webpackgi_exports__PointerLockControlsPlugin,exports.PointerLockControls2=__webpackgi_exports__PointerLockControls2,exports.PointLightHelper=__webpackgi_exports__PointLightHelper,exports.PointLight2=__webpackgi_exports__PointLight2,exports.PointLight=__webpackgi_exports__PointLight,exports.PlaneHelper=__webpackgi_exports__PlaneHelper,exports.PlaneGeometry=__webpackgi_exports__PlaneGeometry,exports.PlaneBufferGeometry=__webpackgi_exports__PlaneBufferGeometry,exports.Plane=__webpackgi_exports__Plane,exports.PickingPlugin=__webpackgi_exports__PickingPlugin,exports.PerspectiveCamera=__webpackgi_exports__PerspectiveCamera,exports.Path=__webpackgi_exports__Path,exports.ParallaxMappingPlugin=__webpackgi_exports__ParallaxMappingPlugin,exports.PMREMGeneratorPlugin=__webpackgi_exports__PMREMGeneratorPlugin,exports.PMREMGenerator=__webpackgi_exports__PMREMGenerator,exports.PCFSoftShadowMap=__webpackgi_exports__PCFSoftShadowMap,exports.PCFShadowMap=__webpackgi_exports__PCFShadowMap,exports.OutlinePlugin=__webpackgi_exports__OutlinePlugin,exports.OrthographicCamera=__webpackgi_exports__OrthographicCamera,exports.OrbitControls3=__webpackgi_exports__OrbitControls3,exports.OrbitControls2=__webpackgi_exports__OrbitControls2,exports.OneMinusSrcColorFactor=__webpackgi_exports__OneMinusSrcColorFactor,exports.OneMinusSrcAlphaFactor=__webpackgi_exports__OneMinusSrcAlphaFactor,exports.OneMinusDstColorFactor=__webpackgi_exports__OneMinusDstColorFactor,exports.OneMinusDstAlphaFactor=__webpackgi_exports__OneMinusDstAlphaFactor,exports.OneFactor=__webpackgi_exports__OneFactor,exports.OctahedronGeometry=__webpackgi_exports__OctahedronGeometry,exports.OctahedronBufferGeometry=__webpackgi_exports__OctahedronBufferGeometry,exports.ObjectSpaceNormalMap=__webpackgi_exports__ObjectSpaceNormalMap,exports.ObjectRotationPlugin=__webpackgi_exports__ObjectRotationPlugin,exports.ObjectProcessorMap=__webpackgi_exports__ObjectProcessorMap,exports.ObjectPicker=__webpackgi_exports__ObjectPicker,exports.ObjectLoader2=__webpackgi_exports__ObjectLoader2,exports.ObjectLoader=__webpackgi_exports__ObjectLoader,exports.Object3DModel=__webpackgi_exports__Object3DModel,exports.Object3D=__webpackgi_exports__Object3D,exports.ObjMtlLoadPlugin=__webpackgi_exports__ObjMtlLoadPlugin,exports.OBJLoader2=__webpackgi_exports__OBJLoader2,exports.NumberKeyframeTrack=__webpackgi_exports__NumberKeyframeTrack,exports.NotEqualStencilFunc=__webpackgi_exports__NotEqualStencilFunc,exports.NotEqualDepth=__webpackgi_exports__NotEqualDepth,exports.NormalCaptureMaterial=__webpackgi_exports__NormalCaptureMaterial,exports.NormalBufferPlugin=__webpackgi_exports__NormalBufferPlugin,exports.NormalBlending=__webpackgi_exports__NormalBlending,exports.NormalAnimationBlendMode=__webpackgi_exports__NormalAnimationBlendMode,exports.NoiseBumpMaterialPlugin=__webpackgi_exports__NoiseBumpMaterialPlugin,exports.NoToneMapping=__webpackgi_exports__NoToneMapping,exports.NoColorSpace=__webpackgi_exports__NoColorSpace,exports.NoBlending=__webpackgi_exports__NoBlending,exports.NeverStencilFunc=__webpackgi_exports__NeverStencilFunc,exports.NeverDepth=__webpackgi_exports__NeverDepth,exports.NearestMipmapNearestFilter=__webpackgi_exports__NearestMipmapNearestFilter,exports.NearestMipmapLinearFilter=__webpackgi_exports__NearestMipmapLinearFilter,exports.NearestMipMapNearestFilter=__webpackgi_exports__NearestMipMapNearestFilter,exports.NearestMipMapLinearFilter=__webpackgi_exports__NearestMipMapLinearFilter,exports.NearestFilter=__webpackgi_exports__NearestFilter,exports.MultiplyOperation=__webpackgi_exports__MultiplyOperation,exports.MultiplyBlending=__webpackgi_exports__MultiplyBlending,exports.MultiFilterPlugin=__webpackgi_exports__MultiFilterPlugin,exports.MixOperation=__webpackgi_exports__MixOperation,exports.MirroredRepeatWrapping=__webpackgi_exports__MirroredRepeatWrapping,exports.MinEquation=__webpackgi_exports__MinEquation,exports.MeshToonMaterial=__webpackgi_exports__MeshToonMaterial,exports.MeshStandardMaterial2=__webpackgi_exports__MeshStandardMaterial2,exports.MeshStandardMaterial=__webpackgi_exports__MeshStandardMaterial,exports.MeshPhysicalMaterial=__webpackgi_exports__MeshPhysicalMaterial,exports.MeshPhongMaterial=__webpackgi_exports__MeshPhongMaterial,exports.MeshNormalMaterial=__webpackgi_exports__MeshNormalMaterial,exports.MeshMatcapMaterial=__webpackgi_exports__MeshMatcapMaterial,exports.MeshLambertMaterial=__webpackgi_exports__MeshLambertMaterial,exports.MeshDistanceMaterial=__webpackgi_exports__MeshDistanceMaterial,exports.MeshDepthMaterial=__webpackgi_exports__MeshDepthMaterial,exports.MeshBasicMaterial2=__webpackgi_exports__MeshBasicMaterial2,exports.MeshBasicMaterial=__webpackgi_exports__MeshBasicMaterial,exports.Mesh=__webpackgi_exports__Mesh,exports.MaxEquation=__webpackgi_exports__MaxEquation,exports.Matrix4=__webpackgi_exports__Matrix4,exports.Matrix3=__webpackgi_exports__Matrix3,exports.MathUtils=__webpackgi_exports__MathUtils,exports.MaterialPreviewGenerator=__webpackgi_exports__MaterialPreviewGenerator,exports.MaterialManager=__webpackgi_exports__MaterialManager,exports.MaterialLoader=__webpackgi_exports__MaterialLoader,exports.MaterialLibraryPlugin=__webpackgi_exports__MaterialLibraryPlugin,exports.MaterialLibraryBasePlugin=__webpackgi_exports__MaterialLibraryBasePlugin,exports.MaterialExtender=__webpackgi_exports__MaterialExtender,exports.MaterialConfiguratorPlugin=__webpackgi_exports__MaterialConfiguratorPlugin,exports.MaterialConfiguratorBasePlugin=__webpackgi_exports__MaterialConfiguratorBasePlugin,exports.Material=__webpackgi_exports__Material,exports.MTLLoader2=__webpackgi_exports__MTLLoader2,exports.MOUSE=__webpackgi_exports__MOUSE,exports.LuminanceFormat=__webpackgi_exports__LuminanceFormat,exports.LuminanceAlphaFormat=__webpackgi_exports__LuminanceAlphaFormat,exports.LoopRepeat=__webpackgi_exports__LoopRepeat,exports.LoopPingPong=__webpackgi_exports__LoopPingPong,exports.LoopOnce=__webpackgi_exports__LoopOnce,exports.LoadingManager=__webpackgi_exports__LoadingManager,exports.LoaderUtils=__webpackgi_exports__LoaderUtils,exports.Loader=__webpackgi_exports__Loader,exports.LinearToneMapping=__webpackgi_exports__LinearToneMapping,exports.LinearSRGBColorSpace=__webpackgi_exports__LinearSRGBColorSpace,exports.LinearMipmapNearestFilter=__webpackgi_exports__LinearMipmapNearestFilter,exports.LinearMipmapLinearFilter=__webpackgi_exports__LinearMipmapLinearFilter,exports.LinearMipMapNearestFilter=__webpackgi_exports__LinearMipMapNearestFilter,exports.LinearMipMapLinearFilter=__webpackgi_exports__LinearMipMapLinearFilter,exports.LinearInterpolant=__webpackgi_exports__LinearInterpolant,exports.LinearFilter=__webpackgi_exports__LinearFilter,exports.LinearEncoding=__webpackgi_exports__LinearEncoding,exports.LineSegments=__webpackgi_exports__LineSegments,exports.LineLoop=__webpackgi_exports__LineLoop,exports.LineDashedMaterial=__webpackgi_exports__LineDashedMaterial,exports.LineCurve3=__webpackgi_exports__LineCurve3,exports.LineCurve=__webpackgi_exports__LineCurve,exports.LineBasicMaterial=__webpackgi_exports__LineBasicMaterial,exports.Line3=__webpackgi_exports__Line3,exports.Line=__webpackgi_exports__Line,exports.LightsUiPlugin=__webpackgi_exports__LightsUiPlugin,exports.LightProbe=__webpackgi_exports__LightProbe,exports.Light=__webpackgi_exports__Light,exports.LessStencilFunc=__webpackgi_exports__LessStencilFunc,exports.LessEqualStencilFunc=__webpackgi_exports__LessEqualStencilFunc,exports.LessEqualDepth=__webpackgi_exports__LessEqualDepth,exports.LessDepth=__webpackgi_exports__LessDepth,exports.Layers=__webpackgi_exports__Layers,exports.LatheGeometry=__webpackgi_exports__LatheGeometry,exports.LatheBufferGeometry=__webpackgi_exports__LatheBufferGeometry,exports.LUTPlugin=__webpackgi_exports__LUTPlugin,exports.LOD=__webpackgi_exports__LOD,exports.KeyframeTrack=__webpackgi_exports__KeyframeTrack,exports.KeepStencilOp=__webpackgi_exports__KeepStencilOp,exports.KTXLoadPlugin=__webpackgi_exports__KTXLoadPlugin,exports.KTX2LoadPlugin=__webpackgi_exports__KTX2LoadPlugin,exports.KHR_TEXTURE_BASISU=__webpackgi_exports__KHR_TEXTURE_BASISU,exports.InvertStencilOp=__webpackgi_exports__InvertStencilOp,exports.InterpolateSmooth=__webpackgi_exports__InterpolateSmooth,exports.InterpolateLinear=__webpackgi_exports__InterpolateLinear,exports.InterpolateDiscrete=__webpackgi_exports__InterpolateDiscrete,exports.Interpolant=__webpackgi_exports__Interpolant,exports.InterleavedBufferAttribute=__webpackgi_exports__InterleavedBufferAttribute,exports.InterleavedBuffer=__webpackgi_exports__InterleavedBuffer,exports.IntType=__webpackgi_exports__IntType,exports.Int8BufferAttribute=__webpackgi_exports__Int8BufferAttribute,exports.Int32BufferAttribute=__webpackgi_exports__Int32BufferAttribute,exports.Int16BufferAttribute=__webpackgi_exports__Int16BufferAttribute,exports.InstancedMesh=__webpackgi_exports__InstancedMesh,exports.InstancedInterleavedBuffer=__webpackgi_exports__InstancedInterleavedBuffer,exports.InstancedBufferGeometry=__webpackgi_exports__InstancedBufferGeometry,exports.InstancedBufferAttribute=__webpackgi_exports__InstancedBufferAttribute,exports.Inflate=__webpackgi_exports__Inflate,exports.IncrementWrapStencilOp=__webpackgi_exports__IncrementWrapStencilOp,exports.IncrementStencilOp=__webpackgi_exports__IncrementStencilOp,exports.Importer=__webpackgi_exports__Importer,exports.ImmediateRenderObject=__webpackgi_exports__ImmediateRenderObject,exports.ImageUtils=__webpackgi_exports__ImageUtils,exports.ImageLoader=__webpackgi_exports__ImageLoader,exports.ImageBitmapLoader=__webpackgi_exports__ImageBitmapLoader,exports.IcosahedronGeometry=__webpackgi_exports__IcosahedronGeometry,exports.IcosahedronBufferGeometry=__webpackgi_exports__IcosahedronBufferGeometry,exports.HierarchyUiPlugin=__webpackgi_exports__HierarchyUiPlugin,exports.HemisphereLightProbe=__webpackgi_exports__HemisphereLightProbe,exports.HemisphereLightHelper=__webpackgi_exports__HemisphereLightHelper,exports.HemisphereLight=__webpackgi_exports__HemisphereLight,exports.HalfFloatType=__webpackgi_exports__HalfFloatType,exports.HDRiGroundPlugin=__webpackgi_exports__HDRiGroundPlugin,exports.Gzip=__webpackgi_exports__Gzip,exports.Gunzip=__webpackgi_exports__Gunzip,exports.Group=__webpackgi_exports__Group,exports.GroundPlugin=__webpackgi_exports__GroundPlugin,exports.GridHelper=__webpackgi_exports__GridHelper,exports.GreaterStencilFunc=__webpackgi_exports__GreaterStencilFunc,exports.GreaterEqualStencilFunc=__webpackgi_exports__GreaterEqualStencilFunc,exports.GreaterEqualDepth=__webpackgi_exports__GreaterEqualDepth,exports.GreaterDepth=__webpackgi_exports__GreaterDepth,exports.GenericFilterPlugin=__webpackgi_exports__GenericFilterPlugin,exports.GenericBlendTexturePass=__webpackgi_exports__GenericBlendTexturePass,exports.GammaCorrectionPlugin=__webpackgi_exports__GammaCorrectionPlugin,exports.GammaCorrectionExtension=__webpackgi_exports__GammaCorrectionExtension,exports.GLTFWriter2=__webpackgi_exports__GLTFWriter2,exports.GLTFMeshOptPlugin=__webpackgi_exports__GLTFMeshOptPlugin,exports.GLTFMaterialsLightMapExtensionName=__webpackgi_exports__GLTFMaterialsLightMapExtensionName,exports.GLTFMaterialsDisplacementMapExtensionName=__webpackgi_exports__GLTFMaterialsDisplacementMapExtensionName,exports.GLTFMaterialsBumpMapExtensionName=__webpackgi_exports__GLTFMaterialsBumpMapExtensionName,exports.GLTFMaterialsAlphaMapExtensionName=__webpackgi_exports__GLTFMaterialsAlphaMapExtensionName,exports.GLTFLoader2=__webpackgi_exports__GLTFLoader2,exports.GLTFExporter2=__webpackgi_exports__GLTFExporter2,exports.GLTFDracoExporter=__webpackgi_exports__GLTFDracoExporter,exports.GLTFDracoExportPlugin=__webpackgi_exports__GLTFDracoExportPlugin,exports.GLTFAnimationPlugin=__webpackgi_exports__GLTFAnimationPlugin,exports.GLSL3=__webpackgi_exports__GLSL3,exports.GLSL1=__webpackgi_exports__GLSL1,exports.GLBufferAttribute=__webpackgi_exports__GLBufferAttribute,exports.GBufferPlugin=__webpackgi_exports__GBufferPlugin,exports.FullScreenPlugin=__webpackgi_exports__FullScreenPlugin,exports.Frustum=__webpackgi_exports__Frustum,exports.FrontSide=__webpackgi_exports__FrontSide,exports.FramebufferTexture=__webpackgi_exports__FramebufferTexture,exports.FrameFadePlugin=__webpackgi_exports__FrameFadePlugin,exports.FogExp2=__webpackgi_exports__FogExp2,exports.Fog=__webpackgi_exports__Fog,exports.FloatType=__webpackgi_exports__FloatType,exports.Float64BufferAttribute=__webpackgi_exports__Float64BufferAttribute,exports.Float32BufferAttribute=__webpackgi_exports__Float32BufferAttribute,exports.Float16BufferAttribute=__webpackgi_exports__Float16BufferAttribute,exports.FirstPersonControlsPlugin=__webpackgi_exports__FirstPersonControlsPlugin,exports.FirstPersonControls2=__webpackgi_exports__FirstPersonControls2,exports.FilmicGrainPlugin=__webpackgi_exports__FilmicGrainPlugin,exports.FileLoader=__webpackgi_exports__FileLoader,exports.FSShadowMaterial=__webpackgi_exports__FSShadowMaterial,exports.FBXLoadPlugin=__webpackgi_exports__FBXLoadPlugin,exports.ExtrudeGeometry=__webpackgi_exports__ExtrudeGeometry,exports.ExtrudeBufferGeometry=__webpackgi_exports__ExtrudeBufferGeometry,exports.ExtrasUiPlugin=__webpackgi_exports__ExtrasUiPlugin,exports.EventDispatcher=__webpackgi_exports__EventDispatcher,exports.Euler=__webpackgi_exports__Euler,exports.EquirectangularRefractionMapping=__webpackgi_exports__EquirectangularRefractionMapping,exports.EquirectangularReflectionMapping=__webpackgi_exports__EquirectangularReflectionMapping,exports.EqualStencilFunc=__webpackgi_exports__EqualStencilFunc,exports.EqualDepth=__webpackgi_exports__EqualDepth,exports.EncodeUTF8=__webpackgi_exports__EncodeUTF8,exports.EllipseCurve3D=__webpackgi_exports__EllipseCurve3D,exports.EllipseCurve=__webpackgi_exports__EllipseCurve,exports.EffectComposer2=__webpackgi_exports__EffectComposer2,exports.EdgesGeometry=__webpackgi_exports__EdgesGeometry,exports.EasingFunctions=__webpackgi_exports__EasingFunctions,exports.EXRLoadPlugin=__webpackgi_exports__EXRLoadPlugin,exports.DynamicReadUsage=__webpackgi_exports__DynamicReadUsage,exports.DynamicDrawUsage=__webpackgi_exports__DynamicDrawUsage,exports.DynamicCopyUsage=__webpackgi_exports__DynamicCopyUsage,exports.DstColorFactor=__webpackgi_exports__DstColorFactor,exports.DstAlphaFactor=__webpackgi_exports__DstAlphaFactor,exports.DropzonePlugin=__webpackgi_exports__DropzonePlugin,exports.Dropzone=__webpackgi_exports__Dropzone,exports.DoubleSide=__webpackgi_exports__DoubleSide,exports.DodecahedronGeometry=__webpackgi_exports__DodecahedronGeometry,exports.DodecahedronBufferGeometry=__webpackgi_exports__DodecahedronBufferGeometry,exports.DiscreteInterpolant=__webpackgi_exports__DiscreteInterpolant,exports.DirectionalLightHelper=__webpackgi_exports__DirectionalLightHelper,exports.DirectionalLight2=__webpackgi_exports__DirectionalLight2,exports.DirectionalLight=__webpackgi_exports__DirectionalLight,exports.DiamondPlugin=__webpackgi_exports__DiamondPlugin,exports.DiamondMaterial=__webpackgi_exports__DiamondMaterial,exports.DeviceOrientationControlsPlugin=__webpackgi_exports__DeviceOrientationControlsPlugin,exports.DeviceOrientationControls2=__webpackgi_exports__DeviceOrientationControls2,exports.DepthTexture=__webpackgi_exports__DepthTexture,exports.DepthStencilFormat=__webpackgi_exports__DepthStencilFormat,exports.DepthOfFieldPlugin=__webpackgi_exports__DepthOfFieldPlugin,exports.DepthOfFieldPass=__webpackgi_exports__DepthOfFieldPass,exports.DepthFormat=__webpackgi_exports__DepthFormat,exports.Deflate=__webpackgi_exports__Deflate,exports.DefaultLoadingManager=__webpackgi_exports__DefaultLoadingManager,exports.DecrementWrapStencilOp=__webpackgi_exports__DecrementWrapStencilOp,exports.DecrementStencilOp=__webpackgi_exports__DecrementStencilOp,exports.Decompress=__webpackgi_exports__Decompress,exports.DecodeUTF8=__webpackgi_exports__DecodeUTF8,exports.DebugPlugin=__webpackgi_exports__DebugPlugin,exports.DataUtils=__webpackgi_exports__DataUtils,exports.DataUrlLoader=__webpackgi_exports__DataUrlLoader,exports.DataTextureLoader=__webpackgi_exports__DataTextureLoader,exports.DataTexture3D=__webpackgi_exports__DataTexture3D,exports.DataTexture2DArray=__webpackgi_exports__DataTexture2DArray,exports.DataTexture=__webpackgi_exports__DataTexture,exports.DataArrayTexture=__webpackgi_exports__DataArrayTexture,exports.Data3DTexture=__webpackgi_exports__Data3DTexture,exports.Damper=__webpackgi_exports__Damper,exports.DRACOLoader2=__webpackgi_exports__DRACOLoader2,exports.DECAY_MILLISECONDS=__webpackgi_exports__DECAY_MILLISECONDS,exports.Cylindrical=__webpackgi_exports__Cylindrical,exports.CylinderGeometry=__webpackgi_exports__CylinderGeometry,exports.CylinderBufferGeometry=__webpackgi_exports__CylinderBufferGeometry,exports.CustomToneMapping=__webpackgi_exports__CustomToneMapping,exports.CustomBumpMapPlugin=__webpackgi_exports__CustomBumpMapPlugin,exports.CustomBlending=__webpackgi_exports__CustomBlending,exports.CurvePath=__webpackgi_exports__CurvePath,exports.Curve=__webpackgi_exports__Curve,exports.CullFaceNone=__webpackgi_exports__CullFaceNone,exports.CullFaceFrontBack=__webpackgi_exports__CullFaceFrontBack,exports.CullFaceFront=__webpackgi_exports__CullFaceFront,exports.CullFaceBack=__webpackgi_exports__CullFaceBack,exports.CubicInterpolant=__webpackgi_exports__CubicInterpolant,exports.CubicBezierCurve3=__webpackgi_exports__CubicBezierCurve3,exports.CubicBezierCurve=__webpackgi_exports__CubicBezierCurve,exports.CubeUVReflectionMapping=__webpackgi_exports__CubeUVReflectionMapping,exports.CubeTextureLoader=__webpackgi_exports__CubeTextureLoader,exports.CubeTexture=__webpackgi_exports__CubeTexture,exports.CubeRefractionMapping=__webpackgi_exports__CubeRefractionMapping,exports.CubeReflectionMapping=__webpackgi_exports__CubeReflectionMapping,exports.CubeNormalsCaptureHelper=__webpackgi_exports__CubeNormalsCaptureHelper,exports.CubeCamera=__webpackgi_exports__CubeCamera,exports.ContactShadowGroundPlugin=__webpackgi_exports__ContactShadowGroundPlugin,exports.ConeGeometry=__webpackgi_exports__ConeGeometry,exports.ConeBufferGeometry=__webpackgi_exports__ConeBufferGeometry,exports.CompressedTextureLoader=__webpackgi_exports__CompressedTextureLoader,exports.CompressedTexture=__webpackgi_exports__CompressedTexture,exports.Compress=__webpackgi_exports__Compress,exports.CombinedPostPlugin=__webpackgi_exports__CombinedPostPlugin,exports.ColorManagement=__webpackgi_exports__ColorManagement,exports.ColorKeyframeTrack=__webpackgi_exports__ColorKeyframeTrack,exports.Color=__webpackgi_exports__Color,exports.Clock=__webpackgi_exports__Clock,exports.ClearcoatTintPlugin=__webpackgi_exports__ClearcoatTintPlugin,exports.ClampToEdgeWrapping=__webpackgi_exports__ClampToEdgeWrapping,exports.CircleGeometry=__webpackgi_exports__CircleGeometry,exports.CircleBufferGeometry=__webpackgi_exports__CircleBufferGeometry,exports.CineonToneMapping=__webpackgi_exports__CineonToneMapping,exports.ChromaticAberrationPlugin=__webpackgi_exports__ChromaticAberrationPlugin,exports.CatmullRomCurve3=__webpackgi_exports__CatmullRomCurve3,exports.CapsuleGeometry=__webpackgi_exports__CapsuleGeometry,exports.CapsuleBufferGeometry=__webpackgi_exports__CapsuleBufferGeometry,exports.CanvasTexture=__webpackgi_exports__CanvasTexture,exports.CanvasSnipperPlugin=__webpackgi_exports__CanvasSnipperPlugin,exports.CanvasSnipper=__webpackgi_exports__CanvasSnipper,exports.CanvasRecorderPlugin=__webpackgi_exports__CanvasRecorderPlugin,exports.CanvasRecorder=__webpackgi_exports__CanvasRecorder,exports.CameraViewPlugin=__webpackgi_exports__CameraViewPlugin,exports.CameraView=__webpackgi_exports__CameraView,exports.CameraUiPlugin=__webpackgi_exports__CameraUiPlugin,exports.CameraHelper=__webpackgi_exports__CameraHelper,exports.CameraController=__webpackgi_exports__CameraController,exports.Camera=__webpackgi_exports__Camera;exports.Cache=__webpackgi_exports__Cache,exports.CSS3DRendererPlugin=__webpackgi_exports__CSS3DRendererPlugin,exports.CSGPluginBase=__webpackgi_exports__CSGPluginBase,exports.CSGPluginBVH=__webpackgi_exports__CSGPluginBVH,exports.CSGPluginBSP=__webpackgi_exports__CSGPluginBSP,exports.ByteType=__webpackgi_exports__ByteType,exports.BufferGeometryLoader=__webpackgi_exports__BufferGeometryLoader,exports.BufferGeometry=__webpackgi_exports__BufferGeometry,exports.BufferAttribute=__webpackgi_exports__BufferAttribute,exports.BoxSelectionWidget=__webpackgi_exports__BoxSelectionWidget,exports.BoxHelper=__webpackgi_exports__BoxHelper,exports.BoxGeometry=__webpackgi_exports__BoxGeometry,exports.BoxBufferGeometry=__webpackgi_exports__BoxBufferGeometry,exports.Box3Helper=__webpackgi_exports__Box3Helper,exports.Box3B=__webpackgi_exports__Box3B,exports.Box3=__webpackgi_exports__Box3,exports.Box2=__webpackgi_exports__Box2,exports.BooleanKeyframeTrack=__webpackgi_exports__BooleanKeyframeTrack,exports.Bone=__webpackgi_exports__Bone,exports.BloomPlugin=__webpackgi_exports__BloomPlugin,exports.BlobLoader=__webpackgi_exports__BlobLoader,exports.BasicShadowMap=__webpackgi_exports__BasicShadowMap,exports.BasicDepthPacking=__webpackgi_exports__BasicDepthPacking,exports.BaseRenderer=__webpackgi_exports__BaseRenderer,exports.BaseGroundPlugin=__webpackgi_exports__BaseGroundPlugin,exports.BackSide=__webpackgi_exports__BackSide,exports.AxesHelper=__webpackgi_exports__AxesHelper,exports.AudioLoader=__webpackgi_exports__AudioLoader,exports.AudioListener=__webpackgi_exports__AudioListener,exports.AudioContext=__webpackgi_exports__AudioContext,exports.AudioAnalyser=__webpackgi_exports__AudioAnalyser,exports.Audio=__webpackgi_exports__Audio,exports.AsyncZlib=__webpackgi_exports__AsyncZlib,exports.AsyncZipDeflate=__webpackgi_exports__AsyncZipDeflate,exports.AsyncUnzlib=__webpackgi_exports__AsyncUnzlib,exports.AsyncUnzipInflate=__webpackgi_exports__AsyncUnzipInflate,exports.AsyncInflate=__webpackgi_exports__AsyncInflate,exports.AsyncGzip=__webpackgi_exports__AsyncGzip,exports.AsyncGunzip=__webpackgi_exports__AsyncGunzip,exports.AsyncDeflate=__webpackgi_exports__AsyncDeflate,exports.AsyncDecompress=__webpackgi_exports__AsyncDecompress,exports.AsyncCompress=__webpackgi_exports__AsyncCompress,exports.AssetManagerPlugin=__webpackgi_exports__AssetManagerPlugin,exports.AssetManagerLoadingBarPlugin=__webpackgi_exports__AssetManagerLoadingBarPlugin,exports.AssetManagerBasicPopupPlugin=__webpackgi_exports__AssetManagerBasicPopupPlugin,exports.AssetImporter=__webpackgi_exports__AssetImporter,exports.AssetExporterPlugin=__webpackgi_exports__AssetExporterPlugin,exports.AssetExporter=__webpackgi_exports__AssetExporter,exports.ArrowHelper=__webpackgi_exports__ArrowHelper,exports.ArrayCamera=__webpackgi_exports__ArrayCamera,exports.ArcCurve=__webpackgi_exports__ArcCurve,exports.AnisotropyPlugin=__webpackgi_exports__AnisotropyPlugin,exports.AnimationUtils=__webpackgi_exports__AnimationUtils,exports.AnimationObjectGroup=__webpackgi_exports__AnimationObjectGroup,exports.AnimationMixer=__webpackgi_exports__AnimationMixer,exports.AnimationLoader=__webpackgi_exports__AnimationLoader,exports.AnimationClip=__webpackgi_exports__AnimationClip,exports.AmbientLightProbe=__webpackgi_exports__AmbientLightProbe,exports.AmbientLight2=__webpackgi_exports__AmbientLight2,exports.AmbientLight=__webpackgi_exports__AmbientLight,exports.AlwaysStencilFunc=__webpackgi_exports__AlwaysStencilFunc,exports.AlwaysDepth=__webpackgi_exports__AlwaysDepth,exports.AlphaFormat=__webpackgi_exports__AlphaFormat,exports.AdditiveBlending=__webpackgi_exports__AdditiveBlending,exports.AdditiveAnimationBlendMode=__webpackgi_exports__AdditiveAnimationBlendMode,exports.AddOperation=__webpackgi_exports__AddOperation,exports.AddEquation=__webpackgi_exports__AddEquation,exports.AddBlendPass=__webpackgi_exports__AddBlendPass,exports.AViewerPlugin=__webpackgi_exports__AViewerPlugin,exports.AShaderMaterial2=__webpackgi_exports__AShaderMaterial2,exports.ARTouchInputHelper=__webpackgi_exports__ARTouchInputHelper,exports.ARPlugin=__webpackgi_exports__ARPlugin,exports.ARPlacementBox=__webpackgi_exports__ARPlacementBox,exports.AMaterialManager=__webpackgi_exports__AMaterialManager,exports.ACameraControlsPlugin=__webpackgi_exports__ACameraControlsPlugin,exports.ACESFilmicToneMapping=__webpackgi_exports__ACESFilmicToneMapping,exports.AAssetManagerProcessStatePlugin=__webpackgi_exports__AAssetManagerProcessStatePlugin;
},{"buffer":"aMB2"}],"D9Nj":[function(require,module,exports) {

},{}],"P74P":[function(require,module,exports) {
"use strict";function t(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.wrapYoyo=exports.wrap=exports.unitize=exports.toArray=exports.splitColor=exports.snap=exports.shuffle=exports.selector=exports.random=exports.pipe=exports.normalize=exports.mapRange=exports.interpolate=exports.gsap=exports.getUnit=exports.distribute=exports.default=exports.clamp=exports._ticker=exports._sortPropTweensByPriority=exports._setDefaults=exports._roundModifier=exports._round=exports._replaceRandom=exports._renderComplexString=exports._removeLinkedListItem=exports._relExp=exports._plugins=exports._parseRelative=exports._numWithUnitExp=exports._numExp=exports._missingPlugin=exports._isUndefined=exports._isString=exports._getSetter=exports._getProperty=exports._getCache=exports._forEachName=exports._config=exports._colorStringFilter=exports._colorExp=exports._checkPlugin=exports.TweenMax=exports.TweenLite=exports.Tween=exports.TimelineMax=exports.TimelineLite=exports.Timeline=exports.Strong=exports.SteppedEase=exports.Sine=exports.Quint=exports.Quart=exports.Quad=exports.PropTween=exports.Power4=exports.Power3=exports.Power2=exports.Power1=exports.Power0=exports.Linear=exports.GSCache=exports.Expo=exports.Elastic=exports.Cubic=exports.Circ=exports.Bounce=exports.Back=exports.Animation=void 0;var r,i,n,s,a,o,u,h,_,p,f,l={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},c={duration:.5,overwrite:!1,delay:0},d=1e8,m=1/d,v=2*Math.PI,g=v/4,x=0,y=Math.sqrt,T=Math.cos,w=Math.sin,b=function(t){return"string"==typeof t},k=function(t){return"function"==typeof t},D=function(t){return"number"==typeof t},E=function(t){return void 0===t},C=function(t){return"object"==typeof t},M=function(t){return!1!==t},R=function(){return"undefined"!=typeof window},A=function(t){return k(t)||b(t)},S="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},P=Array.isArray,z=/(?:-?\.?\d|\.)+/gi,O=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,L=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,F=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,I=/[+-]=-?[.\d]+/,U=/[^,'"\[\]\s]+/gi,B=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,N={},q={},Q=function(t){return(q=gt(t,N))&&Or},j=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},V=function(t,e){return!e&&console.warn(t)},G=function(t,e){return t&&(N[t]=e)&&q&&(q[t]=e)||N},W=function(){return 0},Y={suppressEvents:!0,isStart:!0,kill:!1},H={suppressEvents:!0,kill:!1},$={suppressEvents:!0},J={},K=[],X={},Z={},tt={},et=30,rt=[],it="",nt=function(t){var e,r,i=t[0];if(C(i)||k(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(r=rt.length;r--&&!rt[r].targetTest(i););e=rt[r]}for(r=t.length;r--;)t[r]&&(t[r]._gsap||(t[r]._gsap=new Ge(t[r],e)))||t.splice(r,1);return t},st=function(t){return t._gsap||nt(ee(t))[0]._gsap},at=function(t,e,r){return(r=t[e])&&k(r)?t[e]():E(r)&&t.getAttribute&&t.getAttribute(e)||r},ot=function(t,e){return(t=t.split(",")).forEach(e)||t},ut=function(t){return Math.round(1e5*t)/1e5||0},ht=function(t){return Math.round(1e7*t)/1e7||0},_t=function(t,e){var r=e.charAt(0),i=parseFloat(e.substr(2));return t=parseFloat(t),"+"===r?t+i:"-"===r?t-i:"*"===r?t*i:t/i},pt=function(t,e){for(var r=e.length,i=0;t.indexOf(e[i])<0&&++i<r;);return i<r},ft=function(){var t,e,r=K.length,i=K.slice(0);for(X={},K.length=0,t=0;t<r;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},lt=function(t,e,r,n){K.length&&ft(),t.render(e,r,n||i&&e<0&&(t._initted||t._startAt)),K.length&&ft()},ct=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(U).length<2?e:b(t)?t.trim():t},dt=function(t){return t},mt=function(t,e){for(var r in e)r in t||(t[r]=e[r]);return t},vt=function(t){return function(e,r){for(var i in r)i in e||"duration"===i&&t||"ease"===i||(e[i]=r[i])}},gt=function(t,e){for(var r in e)t[r]=e[r];return t},xt=function t(e,r){for(var i in r)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(e[i]=C(r[i])?t(e[i]||(e[i]={}),r[i]):r[i]);return e},yt=function(t,e){var r,i={};for(r in t)r in e||(i[r]=t[r]);return i},Tt=function(t){var e=t.parent||s,r=t.keyframes?vt(P(t.keyframes)):mt;if(M(t.inherit))for(;e;)r(t,e.vars.defaults),e=e.parent||e._dp;return t},wt=function(t,e){for(var r=t.length,i=r===e.length;i&&r--&&t[r]===e[r];);return r<0},bt=function(t,e,r,i,n){void 0===r&&(r="_first"),void 0===i&&(i="_last");var s,a=t[i];if(n)for(s=e[n];a&&a[n]>s;)a=a._prev;return a?(e._next=a._next,a._next=e):(e._next=t[r],t[r]=e),e._next?e._next._prev=e:t[i]=e,e._prev=a,e.parent=e._dp=t,e},kt=function(t,e,r,i){void 0===r&&(r="_first"),void 0===i&&(i="_last");var n=e._prev,s=e._next;n?n._next=s:t[r]===e&&(t[r]=s),s?s._prev=n:t[i]===e&&(t[i]=n),e._next=e._prev=e.parent=null},Dt=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove(t),t._act=0},Et=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var r=t;r;)r._dirty=1,r=r.parent;return t},Ct=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Mt=function(t,e,r,n){return t._startAt&&(i?t._startAt.revert(H):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,n))},Rt=function t(e){return!e||e._ts&&t(e.parent)},At=function(t){return t._repeat?St(t._tTime,t=t.duration()+t._rDelay)*t:0},St=function(t,e){var r=Math.floor(t/=e);return t&&r===t?r-1:r},Pt=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},zt=function(t){return t._end=ht(t._start+(t._tDur/Math.abs(t._ts||t._rts||m)||0))},Ot=function(t,e){var r=t._dp;return r&&r.smoothChildTiming&&t._ts&&(t._start=ht(r._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),zt(t),r._dirty||Et(r,t)),t},Lt=function(t,e){var r;if((e._time||e._initted&&!e._dur)&&(r=Pt(t.rawTime(),e),(!e._dur||$t(0,e.totalDuration(),r)-e._tTime>m)&&e.render(r,!0)),Et(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(r=t;r._dp;)r.rawTime()>=0&&r.totalTime(r._tTime),r=r._dp;t._zTime=-m}},Ft=function(t,e,r,i){return e.parent&&Dt(e),e._start=ht((D(r)?r:r||t!==s?Wt(t,r,e):t._time)+e._delay),e._end=ht(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),bt(t,e,"_first","_last",t._sort?"_start":0),Nt(e)||(t._recent=e),i||Lt(t,e),t._ts<0&&Ot(t,t._tTime),t},It=function(t,e){return(N.ScrollTrigger||j("scrollTrigger",e))&&N.ScrollTrigger.create(e,t)},Ut=function(t,e,r,n,s){return tr(t,e,s),t._initted?!r&&t._pt&&!i&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&_!==Ae.frame?(K.push(t),t._lazy=[s,n],1):void 0:1},Bt=function t(e){var r=e.parent;return r&&r._ts&&r._initted&&!r._lock&&(r.rawTime()<0||t(r))},Nt=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},qt=function(t,e,r,n){var s,a,o,u=t.ratio,h=e<0||!e&&(!t._start&&Bt(t)&&(t._initted||!Nt(t))||(t._ts<0||t._dp._ts<0)&&!Nt(t))?0:1,_=t._rDelay,p=0;if(_&&t._repeat&&(p=$t(0,t._tDur,e),a=St(p,_),t._yoyo&&1&a&&(h=1-h),a!==St(t._tTime,_)&&(u=1-h,t.vars.repeatRefresh&&t._initted&&t.invalidate())),h!==u||i||n||t._zTime===m||!e&&t._zTime){if(!t._initted&&Ut(t,e,n,r,p))return;for(o=t._zTime,t._zTime=e||(r?m:0),r||(r=e&&!o),t.ratio=h,t._from&&(h=1-h),t._time=0,t._tTime=p,s=t._pt;s;)s.r(h,s.d),s=s._next;e<0&&Mt(t,e,r,!0),t._onUpdate&&!r&&ge(t,"onUpdate"),p&&t._repeat&&!r&&t.parent&&ge(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===h&&(h&&Dt(t,1),r||i||(ge(t,h?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},Qt=function(t,e,r){var i;if(r>e)for(i=t._first;i&&i._start<=r;){if("isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=r;){if("isPause"===i.data&&i._start<e)return i;i=i._prev}},jt=function(t,e,r,i){var n=t._repeat,s=ht(e)||0,a=t._tTime/t._tDur;return a&&!i&&(t._time*=s/t._dur),t._dur=s,t._tDur=n?n<0?1e10:ht(s*(n+1)+t._rDelay*n):s,a>0&&!i&&Ot(t,t._tTime=t._tDur*a),t.parent&&zt(t),r||Et(t.parent,t),t},Vt=function(t){return t instanceof Ye?Et(t):jt(t,t._dur)},Gt={_start:0,endTime:W,totalDuration:W},Wt=function t(e,r,i){var n,s,a,o=e.labels,u=e._recent||Gt,h=e.duration()>=d?u.endTime(!1):e._dur;return b(r)&&(isNaN(r)||r in o)?(s=r.charAt(0),a="%"===r.substr(-1),n=r.indexOf("="),"<"===s||">"===s?(n>=0&&(r=r.replace(/=/,"")),("<"===s?u._start:u.endTime(u._repeat>=0))+(parseFloat(r.substr(1))||0)*(a?(n<0?u:i).totalDuration()/100:1)):n<0?(r in o||(o[r]=h),o[r]):(s=parseFloat(r.charAt(n-1)+r.substr(n+1)),a&&i&&(s=s/100*(P(i)?i[0]:i).totalDuration()),n>1?t(e,r.substr(0,n-1),i)+s:h+s)):null==r?h:+r},Yt=function(t,e,r){var i,n,s=D(e[1]),a=(s?2:1)+(t<2?0:1),o=e[a];if(s&&(o.duration=e[1]),o.parent=r,t){for(i=o,n=r;n&&!("immediateRender"in i);)i=n.vars.defaults||{},n=M(n.vars.inherit)&&n.parent;o.immediateRender=M(i.immediateRender),t<2?o.runBackwards=1:o.startAt=e[a-1]}return new or(e[0],o,e[a+1])},Ht=function(t,e){return t||0===t?e(t):e},$t=function(t,e,r){return r<t?t:r>e?e:r},Jt=function(t,e){return b(t)&&(e=B.exec(t))?e[1]:""},Kt=function(t,e,r){return Ht(r,function(r){return $t(t,e,r)})},Xt=[].slice,Zt=function(t,e){return t&&C(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&C(t[0]))&&!t.nodeType&&t!==a},te=function(t,e,r){return void 0===r&&(r=[]),t.forEach(function(t){var i;return b(t)&&!e||Zt(t,1)?(i=r).push.apply(i,ee(t)):r.push(t)})||r},ee=function(t,e,r){return n&&!e&&n.selector?n.selector(t):!b(t)||r||!o&&Se()?P(t)?te(t,r):Zt(t)?Xt.call(t,0):t?[t]:[]:Xt.call((e||u).querySelectorAll(t),0)},re=function(t){return t=ee(t)[0]||V("Invalid scope")||{},function(e){var r=t.current||t.nativeElement||t;return ee(e,r.querySelectorAll?r:r===t?V("Invalid scope")||u.createElement("div"):t)}},ie=function(t){return t.sort(function(){return.5-Math.random()})},ne=function(t){if(k(t))return t;var e=C(t)?t:{each:t},r=Ne(e.ease),i=e.from||0,n=parseFloat(e.base)||0,s={},a=i>0&&i<1,o=isNaN(i)||a,u=e.axis,h=i,_=i;return b(i)?h=_={center:.5,edges:.5,end:1}[i]||0:!a&&o&&(h=i[0],_=i[1]),function(t,a,p){var f,l,c,m,v,g,x,T,w,b=(p||e).length,k=s[b];if(!k){if(!(w="auto"===e.grid?0:(e.grid||[1,d])[1])){for(x=-d;x<(x=p[w++].getBoundingClientRect().left)&&w<b;);w--}for(k=s[b]=[],f=o?Math.min(w,b)*h-.5:i%w,l=w===d?0:o?b*_/w-.5:i/w|0,x=0,T=d,g=0;g<b;g++)c=g%w-f,m=l-(g/w|0),k[g]=v=u?Math.abs("y"===u?m:c):y(c*c+m*m),v>x&&(x=v),v<T&&(T=v);"random"===i&&ie(k),k.max=x-T,k.min=T,k.v=b=(parseFloat(e.amount)||parseFloat(e.each)*(w>b?b-1:u?"y"===u?b/w:w:Math.max(w,b/w))||0)*("edges"===i?-1:1),k.b=b<0?n-b:n,k.u=Jt(e.amount||e.each)||0,r=r&&b<0?Ue(r):r}return b=(k[t]-k.min)/k.max||0,ht(k.b+(r?r(b):b)*k.v)+k.u}},se=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(r){var i=ht(Math.round(parseFloat(r)/t)*t*e);return(i-i%1)/e+(D(r)?0:Jt(r))}},ae=function(t,e){var r,i,n=P(t);return!n&&C(t)&&(r=n=t.radius||d,t.values?(t=ee(t.values),(i=!D(t[0]))&&(r*=r)):t=se(t.increment)),Ht(e,n?k(t)?function(e){return i=t(e),Math.abs(i-e)<=r?i:e}:function(e){for(var n,s,a=parseFloat(i?e.x:e),o=parseFloat(i?e.y:0),u=d,h=0,_=t.length;_--;)(n=i?(n=t[_].x-a)*n+(s=t[_].y-o)*s:Math.abs(t[_]-a))<u&&(u=n,h=_);return h=!r||u<=r?t[h]:e,i||h===e||D(e)?h:h+Jt(e)}:se(t))},oe=function(t,e,r,i){return Ht(P(t)?!e:!0===r?!!(r=0):!i,function(){return P(t)?t[~~(Math.random()*t.length)]:(r=r||1e-5)&&(i=r<1?Math.pow(10,(r+"").length-2):1)&&Math.floor(Math.round((t-r/2+Math.random()*(e-t+.99*r))/r)*r*i)/i})},ue=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){return e.reduce(function(t,e){return e(t)},t)}},he=function(t,e){return function(r){return t(parseFloat(r))+(e||Jt(r))}},_e=function(t,e,r){return de(t,e,0,1,r)},pe=function(t,e,r){return Ht(r,function(r){return t[~~e(r)]})},fe=function t(e,r,i){var n=r-e;return P(e)?pe(e,t(0,e.length),r):Ht(i,function(t){return(n+(t-e)%n)%n+e})},le=function t(e,r,i){var n=r-e,s=2*n;return P(e)?pe(e,t(0,e.length-1),r):Ht(i,function(t){return e+((t=(s+(t-e)%s)%s||0)>n?s-t:t)})},ce=function(t){for(var e,r,i,n,s=0,a="";~(e=t.indexOf("random(",s));)i=t.indexOf(")",e),n="["===t.charAt(e+7),r=t.substr(e+7,i-e-7).match(n?U:z),a+=t.substr(s,e-s)+oe(n?r:+r[0],n?0:+r[1],+r[2]||1e-5),s=i+1;return a+t.substr(s,t.length-s)},de=function(t,e,r,i,n){var s=e-t,a=i-r;return Ht(n,function(e){return r+((e-t)/s*a||0)})},me=function t(e,r,i,n){var s=isNaN(e+r)?0:function(t){return(1-t)*e+t*r};if(!s){var a,o,u,h,_,p=b(e),f={};if(!0===i&&(n=1)&&(i=null),p)e={p:e},r={p:r};else if(P(e)&&!P(r)){for(u=[],h=e.length,_=h-2,o=1;o<h;o++)u.push(t(e[o-1],e[o]));h--,s=function(t){t*=h;var e=Math.min(_,~~t);return u[e](t-e)},i=r}else n||(e=gt(P(e)?[]:{},e));if(!u){for(a in r)Ke.call(f,e,a,"get",r[a]);s=function(t){return mr(t,f)||(p?e.p:e)}}}return Ht(i,s)},ve=function(t,e,r){var i,n,s,a=t.labels,o=d;for(i in a)(n=a[i]-e)<0==!!r&&n&&o>(n=Math.abs(n))&&(s=i,o=n);return s},ge=function(t,e,r){var i,s,a,o=t.vars,u=o[e],h=n,_=t._ctx;if(u)return i=o[e+"Params"],s=o.callbackScope||t,r&&K.length&&ft(),_&&(n=_),a=i?u.apply(s,i):u.call(s),n=h,a},xe=function(t){return Dt(t),t.scrollTrigger&&t.scrollTrigger.kill(!!i),t.progress()<1&&ge(t,"onInterrupt"),t},ye=function(t){var e=(t=!t.name&&t.default||t).name,r=k(t),i=e&&!r&&t.init?function(){this._props=[]}:t,n={init:W,render:mr,add:Ke,kill:gr,modifier:vr,rawVars:0},s={targetTest:0,get:0,getSetter:fr,aliases:{},register:0};if(Se(),t!==i){if(Z[e])return;mt(i,mt(yt(t,n),s)),gt(i.prototype,gt(n,yt(t,s))),Z[i.prop=e]=i,t.targetTest&&(rt.push(i),J[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}G(e,i),t.register&&t.register(Or,i,Tr)},Te=255,we={aqua:[0,Te,Te],lime:[0,Te,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Te],navy:[0,0,128],white:[Te,Te,Te],olive:[128,128,0],yellow:[Te,Te,0],orange:[Te,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Te,0,0],pink:[Te,192,203],cyan:[0,Te,Te],transparent:[Te,Te,Te,0]},be=function(t,e,r){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(r-e)*t*6:t<.5?r:3*t<2?e+(r-e)*(2/3-t)*6:e)*Te+.5|0},ke=function(t,e,r){var i,n,s,a,o,u,h,_,p,f,l=t?D(t)?[t>>16,t>>8&Te,t&Te]:0:we.black;if(!l){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),we[t])l=we[t];else if("#"===t.charAt(0)){if(t.length<6&&(i=t.charAt(1),n=t.charAt(2),s=t.charAt(3),t="#"+i+i+n+n+s+s+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(l=parseInt(t.substr(1,6),16))>>16,l>>8&Te,l&Te,parseInt(t.substr(7),16)/255];l=[(t=parseInt(t.substr(1),16))>>16,t>>8&Te,t&Te]}else if("hsl"===t.substr(0,3))if(l=f=t.match(z),e){if(~t.indexOf("="))return l=t.match(O),r&&l.length<4&&(l[3]=1),l}else a=+l[0]%360/360,o=+l[1]/100,i=2*(u=+l[2]/100)-(n=u<=.5?u*(o+1):u+o-u*o),l.length>3&&(l[3]*=1),l[0]=be(a+1/3,i,n),l[1]=be(a,i,n),l[2]=be(a-1/3,i,n);else l=t.match(z)||we.transparent;l=l.map(Number)}return e&&!f&&(i=l[0]/Te,n=l[1]/Te,s=l[2]/Te,u=((h=Math.max(i,n,s))+(_=Math.min(i,n,s)))/2,h===_?a=o=0:(p=h-_,o=u>.5?p/(2-h-_):p/(h+_),a=h===i?(n-s)/p+(n<s?6:0):h===n?(s-i)/p+2:(i-n)/p+4,a*=60),l[0]=~~(a+.5),l[1]=~~(100*o+.5),l[2]=~~(100*u+.5)),r&&l.length<4&&(l[3]=1),l},De=function(t){var e=[],r=[],i=-1;return t.split(Ce).forEach(function(t){var n=t.match(L)||[];e.push.apply(e,n),r.push(i+=n.length+1)}),e.c=r,e},Ee=function(t,e,r){var i,n,s,a,o="",u=(t+o).match(Ce),h=e?"hsla(":"rgba(",_=0;if(!u)return t;if(u=u.map(function(t){return(t=ke(t,e,1))&&h+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"}),r&&(s=De(t),(i=r.c).join(o)!==s.c.join(o)))for(a=(n=t.replace(Ce,"1").split(L)).length-1;_<a;_++)o+=n[_]+(~i.indexOf(_)?u.shift()||h+"0,0,0,0)":(s.length?s:u.length?u:r).shift());if(!n)for(a=(n=t.split(Ce)).length-1;_<a;_++)o+=n[_]+u[_];return o+n[a]},Ce=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in we)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),Me=/hsl[a]?\(/,Re=function(t){var e,r=t.join(" ");if(Ce.lastIndex=0,Ce.test(r))return e=Me.test(r),t[1]=Ee(t[1],e),t[0]=Ee(t[0],e,De(t[1])),!0},Ae=function(){var t,e,r,i,n,s,_=Date.now,p=500,l=33,c=_(),d=c,v=1e3/240,g=v,x=[],y=function r(a){var o,u,h,f,m=_()-d,y=!0===a;if(m>p&&(c+=m-l),((o=(h=(d+=m)-c)-g)>0||y)&&(f=++i.frame,n=h-1e3*i.time,i.time=h/=1e3,g+=o+(o>=v?4:v-o),u=1),y||(t=e(r)),u)for(s=0;s<x.length;s++)x[s](h,n,f,a)};return i={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(t){return n/(1e3/(t||60))},wake:function(){h&&(!o&&R()&&(a=o=window,u=a.document||{},N.gsap=Or,(a.gsapVersions||(a.gsapVersions=[])).push(Or.version),Q(q||a.GreenSockGlobals||!a.gsap&&a||{}),r=a.requestAnimationFrame),t&&i.sleep(),e=r||function(t){return setTimeout(t,g-1e3*i.time+1|0)},f=1,y(2))},sleep:function(){(r?a.cancelAnimationFrame:clearTimeout)(t),f=0,e=W},lagSmoothing:function(t,e){p=t||1/m,l=Math.min(e,p,0)},fps:function(t){v=1e3/(t||240),g=1e3*i.time+v},add:function(t,e,r){var n=e?function(e,r,s,a){t(e,r,s,a),i.remove(n)}:t;return i.remove(t),x[r?"unshift":"push"](n),Se(),n},remove:function(t,e){~(e=x.indexOf(t))&&x.splice(e,1)&&s>=e&&s--},_listeners:x}}(),Se=function(){return!f&&Ae.wake()},Pe={},ze=/^[\d.\-M][\d.\-,\s]/,Oe=/["']/g,Le=function(t){for(var e,r,i,n={},s=t.substr(1,t.length-3).split(":"),a=s[0],o=1,u=s.length;o<u;o++)r=s[o],e=o!==u-1?r.lastIndexOf(","):r.length,i=r.substr(0,e),n[a]=isNaN(i)?i.replace(Oe,"").trim():+i,a=r.substr(e+1).trim();return n},Fe=function(t){var e=t.indexOf("(")+1,r=t.indexOf(")"),i=t.indexOf("(",e);return t.substring(e,~i&&i<r?t.indexOf(")",r+1):r)},Ie=function(t){var e=(t+"").split("("),r=Pe[e[0]];return r&&e.length>1&&r.config?r.config.apply(null,~t.indexOf("{")?[Le(e[1])]:Fe(t).split(",").map(ct)):Pe._CE&&ze.test(t)?Pe._CE("",t):r},Ue=function(t){return function(e){return 1-t(1-e)}},Be=function t(e,r){for(var i,n=e._first;n;)n instanceof Ye?t(n,r):!n.vars.yoyoEase||n._yoyo&&n._repeat||n._yoyo===r||(n.timeline?t(n.timeline,r):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=r)),n=n._next},Ne=function(t,e){return t&&(k(t)?t:Pe[t]||Ie(t))||e},qe=function(t,e,r,i){void 0===r&&(r=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var n,s={easeIn:e,easeOut:r,easeInOut:i};return ot(t,function(t){for(var e in Pe[t]=N[t]=s,Pe[n=t.toLowerCase()]=r,s)Pe[n+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Pe[t+"."+e]=s[e]}),s},Qe=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},je=function t(e,r,i){var n=r>=1?r:1,s=(i||(e?.3:.45))/(r<1?r:1),a=s/v*(Math.asin(1/n)||0),o=function(t){return 1===t?1:n*Math.pow(2,-10*t)*w((t-a)*s)+1},u="out"===e?o:"in"===e?function(t){return 1-o(1-t)}:Qe(o);return s=v/s,u.config=function(r,i){return t(e,r,i)},u},Ve=function t(e,r){void 0===r&&(r=1.70158);var i=function(t){return t?--t*t*((r+1)*t+r)+1:0},n="out"===e?i:"in"===e?function(t){return 1-i(1-t)}:Qe(i);return n.config=function(r){return t(e,r)},n};exports._ticker=Ae,exports._colorStringFilter=Re,exports._colorExp=Ce,exports.splitColor=ke,exports.interpolate=me,exports.mapRange=de,exports._replaceRandom=ce,exports.wrapYoyo=le,exports.wrap=fe,exports.normalize=_e,exports.unitize=he,exports.pipe=ue,exports.random=oe,exports.snap=ae,exports._roundModifier=se,exports.distribute=ne,exports.shuffle=ie,exports.selector=re,exports.toArray=ee,exports.clamp=Kt,exports.getUnit=Jt,exports._removeLinkedListItem=kt,exports._setDefaults=mt,exports._parseRelative=_t,exports._round=ut,exports._forEachName=ot,exports._getProperty=at,exports._getCache=st,exports._plugins=Z,exports._missingPlugin=j,exports._relExp=I,exports._numWithUnitExp=L,exports._numExp=O,exports._isUndefined=E,exports._isString=b,exports._config=l,ot("Linear,Quad,Cubic,Quart,Quint,Strong",function(t,e){var r=e<5?e+1:e;qe(t+",Power"+(r-1),e?function(t){return Math.pow(t,r)}:function(t){return t},function(t){return 1-Math.pow(1-t,r)},function(t){return t<.5?Math.pow(2*t,r)/2:1-Math.pow(2*(1-t),r)/2})}),Pe.Linear.easeNone=Pe.none=Pe.Linear.easeIn,qe("Elastic",je("in"),je("out"),je()),function(t,e){var r=1/e,i=function(i){return i<r?t*i*i:i<.7272727272727273?t*Math.pow(i-1.5/e,2)+.75:i<.9090909090909092?t*(i-=2.25/e)*i+.9375:t*Math.pow(i-2.625/e,2)+.984375};qe("Bounce",function(t){return 1-i(1-t)},i)}(7.5625,2.75),qe("Expo",function(t){return t?Math.pow(2,10*(t-1)):0}),qe("Circ",function(t){return-(y(1-t*t)-1)}),qe("Sine",function(t){return 1===t?1:1-T(t*g)}),qe("Back",Ve("in"),Ve("out"),Ve()),Pe.SteppedEase=Pe.steps=N.SteppedEase={config:function(t,e){void 0===t&&(t=1);var r=1/t,i=t+(e?0:1),n=e?1:0,s=1-m;return function(t){return((i*$t(0,s,t)|0)+n)*r}}},c.ease=Pe["quad.out"],ot("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(t){return it+=t+","+t+"Params,"});var Ge=function(t,e){this.id=x++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:at,this.set=e?e.getSetter:fr};exports.GSCache=Ge;var We=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,jt(this,+t.duration,1,1),this.data=t.data,n&&(this._ctx=n,n.data.push(this)),f||Ae.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,jt(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(Se(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(Ot(this,t),!r._dp||r.parent||Lt(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&Ft(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===m||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),lt(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+At(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+At(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(t,e){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*r,e):this._repeat?St(this._tTime,r)+1:1},e.timeScale=function(t){if(!arguments.length)return this._rts===-m?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?Pt(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-m?0:this._rts,this.totalTime($t(-this._delay,this._tDur,e),!0),zt(this),Ct(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Se(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==m&&(this._tTime-=m)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&Ft(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(M(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Pt(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=$);var e=i;return i=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),i=e,this},e.globalTime=function(t){for(var e=this,r=arguments.length?t:e.rawTime();e;)r=e._start+r/(e._ts||1),e=e._dp;return!this.parent&&this.vars.immediateRender?-1:r},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,Vt(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,Vt(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(Wt(this,t),M(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,M(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-m:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-m,this},e.isActive=function(){var t,e=this.parent||this._dp,r=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=r&&t<this.endTime(!0)-m))},e.eventCallback=function(t,e,r){var i=this.vars;return arguments.length>1?(e?(i[t]=e,r&&(i[t+"Params"]=r),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(t){var e=this;return new Promise(function(r){var i=k(t)?t:dt,n=function(){var t=e.then;e.then=null,k(i)&&(i=i(e))&&(i.then||i===e)&&(e.then=t),r(i),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?n():e._prom=n})},e.kill=function(){xe(this)},t}();exports.Animation=We,mt(We.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-m,_prom:0,_ps:!1,_rts:1});var Ye=function(r){function n(e,i){var n;return void 0===e&&(e={}),(n=r.call(this,e)||this).labels={},n.smoothChildTiming=!!e.smoothChildTiming,n.autoRemoveChildren=!!e.autoRemoveChildren,n._sort=M(e.sortChildren),s&&Ft(e.parent||s,t(n),i),e.reversed&&n.reverse(),e.paused&&n.paused(!0),e.scrollTrigger&&It(t(n),e.scrollTrigger),n}e(n,r);var a=n.prototype;return a.to=function(t,e,r){return Yt(0,arguments,this),this},a.from=function(t,e,r){return Yt(1,arguments,this),this},a.fromTo=function(t,e,r,i){return Yt(2,arguments,this),this},a.set=function(t,e,r){return e.duration=0,e.parent=this,Tt(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new or(t,e,Wt(this,r),1),this},a.call=function(t,e,r){return Ft(this,or.delayedCall(0,t,e),r)},a.staggerTo=function(t,e,r,i,n,s,a){return r.duration=e,r.stagger=r.stagger||i,r.onComplete=s,r.onCompleteParams=a,r.parent=this,new or(t,r,Wt(this,n)),this},a.staggerFrom=function(t,e,r,i,n,s,a){return r.runBackwards=1,Tt(r).immediateRender=M(r.immediateRender),this.staggerTo(t,e,r,i,n,s,a)},a.staggerFromTo=function(t,e,r,i,n,s,a,o){return i.startAt=r,Tt(i).immediateRender=M(i.immediateRender),this.staggerTo(t,e,i,n,s,a,o)},a.render=function(t,e,r){var n,a,o,u,h,_,p,f,l,c,d,v,g=this._time,x=this._dirty?this.totalDuration():this._tDur,y=this._dur,T=t<=0?0:ht(t),w=this._zTime<0!=t<0&&(this._initted||!y);if(this!==s&&T>x&&t>=0&&(T=x),T!==this._tTime||r||w){if(g!==this._time&&y&&(T+=this._time-g,t+=this._time-g),n=T,l=this._start,_=!(f=this._ts),w&&(y||(g=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(d=this._yoyo,h=y+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*h+t,e,r);if(n=ht(T%h),T===x?(u=this._repeat,n=y):((u=~~(T/h))&&u===T/h&&(n=y,u--),n>y&&(n=y)),c=St(this._tTime,h),!g&&this._tTime&&c!==u&&(c=u),d&&1&u&&(n=y-n,v=1),u!==c&&!this._lock){var b=d&&1&c,k=b===(d&&1&u);if(u<c&&(b=!b),g=b?0:y,this._lock=1,this.render(g||(v?0:ht(u*h)),e,!y)._lock=0,this._tTime=T,!e&&this.parent&&ge(this,"onRepeat"),this.vars.repeatRefresh&&!v&&(this.invalidate()._lock=1),g&&g!==this._time||_!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(y=this._dur,x=this._tDur,k&&(this._lock=2,g=b?y:-1e-4,this.render(g,!0),this.vars.repeatRefresh&&!v&&this.invalidate()),this._lock=0,!this._ts&&!_)return this;Be(this,v)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(p=Qt(this,ht(g),ht(n)))&&(T-=n-(n=p._start)),this._tTime=T,this._time=n,this._act=!f,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,g=0),!g&&n&&!e&&(ge(this,"onStart"),this._tTime!==T))return this;if(n>=g&&t>=0)for(a=this._first;a;){if(o=a._next,(a._act||n>=a._start)&&a._ts&&p!==a){if(a.parent!==this)return this.render(t,e,r);if(a.render(a._ts>0?(n-a._start)*a._ts:(a._dirty?a.totalDuration():a._tDur)+(n-a._start)*a._ts,e,r),n!==this._time||!this._ts&&!_){p=0,o&&(T+=this._zTime=-m);break}}a=o}else{a=this._last;for(var D=t<0?t:n;a;){if(o=a._prev,(a._act||D<=a._end)&&a._ts&&p!==a){if(a.parent!==this)return this.render(t,e,r);if(a.render(a._ts>0?(D-a._start)*a._ts:(a._dirty?a.totalDuration():a._tDur)+(D-a._start)*a._ts,e,r||i&&(a._initted||a._startAt)),n!==this._time||!this._ts&&!_){p=0,o&&(T+=this._zTime=D?-m:m);break}}a=o}}if(p&&!e&&(this.pause(),p.render(n>=g?0:-m)._zTime=n>=g?1:-1,this._ts))return this._start=l,zt(this),this.render(t,e,r);this._onUpdate&&!e&&ge(this,"onUpdate",!0),(T===x&&this._tTime>=this.totalDuration()||!T&&g)&&(l!==this._start&&Math.abs(f)===Math.abs(this._ts)||this._lock||((t||!y)&&(T===x&&this._ts>0||!T&&this._ts<0)&&Dt(this,1),e||t<0&&!g||!T&&!g&&x||(ge(this,T===x&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(T<x&&this.timeScale()>0)&&this._prom())))}return this},a.add=function(t,e){var r=this;if(D(e)||(e=Wt(this,e,t)),!(t instanceof We)){if(P(t))return t.forEach(function(t){return r.add(t,e)}),this;if(b(t))return this.addLabel(t,e);if(!k(t))return this;t=or.delayedCall(0,t)}return this!==t?Ft(this,t,e):this},a.getChildren=function(t,e,r,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===r&&(r=!0),void 0===i&&(i=-d);for(var n=[],s=this._first;s;)s._start>=i&&(s instanceof or?e&&n.push(s):(r&&n.push(s),t&&n.push.apply(n,s.getChildren(!0,e,r)))),s=s._next;return n},a.getById=function(t){for(var e=this.getChildren(1,1,1),r=e.length;r--;)if(e[r].vars.id===t)return e[r]},a.remove=function(t){return b(t)?this.removeLabel(t):k(t)?this.killTweensOf(t):(kt(this,t),t===this._recent&&(this._recent=this._last),Et(this))},a.totalTime=function(t,e){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ht(Ae.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),r.prototype.totalTime.call(this,t,e),this._forcing=0,this):this._tTime},a.addLabel=function(t,e){return this.labels[t]=Wt(this,e),this},a.removeLabel=function(t){return delete this.labels[t],this},a.addPause=function(t,e,r){var i=or.delayedCall(0,e||W,r);return i.data="isPause",this._hasPause=1,Ft(this,i,Wt(this,t))},a.removePause=function(t){var e=this._first;for(t=Wt(this,t);e;)e._start===t&&"isPause"===e.data&&Dt(e),e=e._next},a.killTweensOf=function(t,e,r){for(var i=this.getTweensOf(t,r),n=i.length;n--;)He!==i[n]&&i[n].kill(t,e);return this},a.getTweensOf=function(t,e){for(var r,i=[],n=ee(t),s=this._first,a=D(e);s;)s instanceof or?pt(s._targets,n)&&(a?(!He||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&i.push(s):(r=s.getTweensOf(n,e)).length&&i.push.apply(i,r),s=s._next;return i},a.tweenTo=function(t,e){e=e||{};var r,i=this,n=Wt(i,t),s=e,a=s.startAt,o=s.onStart,u=s.onStartParams,h=s.immediateRender,_=or.to(i,mt({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:n,overwrite:"auto",duration:e.duration||Math.abs((n-(a&&"time"in a?a.time:i._time))/i.timeScale())||m,onStart:function(){if(i.pause(),!r){var t=e.duration||Math.abs((n-(a&&"time"in a?a.time:i._time))/i.timeScale());_._dur!==t&&jt(_,t,0,1).render(_._time,!0,!0),r=1}o&&o.apply(_,u||[])}},e));return h?_.render(0):_},a.tweenFromTo=function(t,e,r){return this.tweenTo(e,mt({startAt:{time:Wt(this,t)}},r))},a.recent=function(){return this._recent},a.nextLabel=function(t){return void 0===t&&(t=this._time),ve(this,Wt(this,t))},a.previousLabel=function(t){return void 0===t&&(t=this._time),ve(this,Wt(this,t),1)},a.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+m)},a.shiftChildren=function(t,e,r){void 0===r&&(r=0);for(var i,n=this._first,s=this.labels;n;)n._start>=r&&(n._start+=t,n._end+=t),n=n._next;if(e)for(i in s)s[i]>=r&&(s[i]+=t);return Et(this)},a.invalidate=function(t){var e=this._first;for(this._lock=0;e;)e.invalidate(t),e=e._next;return r.prototype.invalidate.call(this,t)},a.clear=function(t){void 0===t&&(t=!0);for(var e,r=this._first;r;)e=r._next,this.remove(r),r=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),Et(this)},a.totalDuration=function(t){var e,r,i,n=0,a=this._last,o=d;if(arguments.length)return this.timeScale((this._repeat<0?this.duration():this.totalDuration())/(this.reversed()?-t:t));if(this._dirty){for(i=this.parent;a;)e=a._prev,a._dirty&&a.totalDuration(),(r=a._start)>o&&this._sort&&a._ts&&!this._lock?(this._lock=1,Ft(this,a,r-a._delay,1)._lock=0):o=r,r<0&&a._ts&&(n-=r,(!i&&!this._dp||i&&i.smoothChildTiming)&&(this._start+=r/this._ts,this._time-=r,this._tTime-=r),this.shiftChildren(-r,!1,-Infinity),o=0),a._end>n&&a._ts&&(n=a._end),a=e;jt(this,this===s&&this._time>n?this._time:n,1,1),this._dirty=0}return this._tDur},n.updateRoot=function(t){if(s._ts&&(lt(s,Pt(t,s)),_=Ae.frame),Ae.frame>=et){et+=l.autoSleep||120;var e=s._first;if((!e||!e._ts)&&l.autoSleep&&Ae._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Ae.sleep()}}},n}(We);exports.TimelineLite=exports.TimelineMax=exports.Timeline=Ye,mt(Ye.prototype,{_lock:0,_hasPause:0,_forcing:0});var He,$e,Je=function(t,e,r,i,n,s,a){var o,u,h,_,p,f,l,c,d=new Tr(this._pt,t,e,0,1,dr,null,n),m=0,v=0;for(d.b=r,d.e=i,r+="",(l=~(i+="").indexOf("random("))&&(i=ce(i)),s&&(s(c=[r,i],t,e),r=c[0],i=c[1]),u=r.match(F)||[];o=F.exec(i);)_=o[0],p=i.substring(m,o.index),h?h=(h+1)%5:"rgba("===p.substr(-5)&&(h=1),_!==u[v++]&&(f=parseFloat(u[v-1])||0,d._pt={_next:d._pt,p:p||1===v?p:",",s:f,c:"="===_.charAt(1)?_t(f,_)-f:parseFloat(_)-f,m:h&&h<4?Math.round:0},m=F.lastIndex);return d.c=m<i.length?i.substring(m,i.length):"",d.fp=a,(I.test(i)||l)&&(d.e=0),this._pt=d,d},Ke=function(t,e,r,i,n,s,a,o,u,h){k(i)&&(i=i(n||0,t,s));var _,p=t[e],f="get"!==r?r:k(p)?u?t[e.indexOf("set")||!k(t["get"+e.substr(3)])?e:"get"+e.substr(3)](u):t[e]():p,c=k(p)?u?_r:hr:ur;if(b(i)&&(~i.indexOf("random(")&&(i=ce(i)),"="===i.charAt(1)&&((_=_t(f,i)+(Jt(f)||0))||0===_)&&(i=_)),!h||f!==i||$e)return isNaN(f*i)||""===i?(!p&&!(e in t)&&j(e,i),Je.call(this,t,e,f,i,c,o||l.stringFilter,u)):(_=new Tr(this._pt,t,e,+f||0,i-(f||0),"boolean"==typeof p?cr:lr,0,c),u&&(_.fp=u),a&&_.modifier(a,this,t),this._pt=_)},Xe=function(t,e,r,i,n){if(k(t)&&(t=nr(t,n,e,r,i)),!C(t)||t.style&&t.nodeType||P(t)||S(t))return b(t)?nr(t,n,e,r,i):t;var s,a={};for(s in t)a[s]=nr(t[s],n,e,r,i);return a},Ze=function(t,e,r,i,n,s){var a,o,u,h;if(Z[t]&&!1!==(a=new Z[t]).init(n,a.rawVars?e[t]:Xe(e[t],i,n,s,r),r,i,s)&&(r._pt=o=new Tr(r._pt,n,t,0,1,a.render,a,0,a.priority),r!==p))for(u=r._ptLookup[r._targets.indexOf(n)],h=a._props.length;h--;)u[a._props[h]]=o;return a},tr=function t(e,n,a){var o,u,h,_,p,f,l,v,g,x,y,T,w,b=e.vars,k=b.ease,D=b.startAt,E=b.immediateRender,C=b.lazy,R=b.onUpdate,A=b.onUpdateParams,S=b.callbackScope,P=b.runBackwards,z=b.yoyoEase,O=b.keyframes,L=b.autoRevert,F=e._dur,I=e._startAt,U=e._targets,B=e.parent,N=B&&"nested"===B.data?B.vars.targets:U,q="auto"===e._overwrite&&!r,Q=e.timeline;if(Q&&(!O||!k)&&(k="none"),e._ease=Ne(k,c.ease),e._yEase=z?Ue(Ne(!0===z?k:z,c.ease)):0,z&&e._yoyo&&!e._repeat&&(z=e._yEase,e._yEase=e._ease,e._ease=z),e._from=!Q&&!!b.runBackwards,!Q||O&&!b.stagger){if(T=(v=U[0]?st(U[0]).harness:0)&&b[v.prop],o=yt(b,J),I&&(I._zTime<0&&I.progress(1),n<0&&P&&E&&!L?I.render(-1,!0):I.revert(P&&F?H:Y),I._lazy=0),D){if(Dt(e._startAt=or.set(U,mt({data:"isStart",overwrite:!1,parent:B,immediateRender:!0,lazy:M(C),startAt:null,delay:0,onUpdate:R,onUpdateParams:A,callbackScope:S,stagger:0},D))),e._startAt._dp=0,n<0&&(i||!E&&!L)&&e._startAt.revert(H),E&&F&&n<=0&&a<=0)return void(n&&(e._zTime=n))}else if(P&&F&&!I)if(n&&(E=!1),h=mt({overwrite:!1,data:"isFromStart",lazy:E&&M(C),immediateRender:E,stagger:0,parent:B},o),T&&(h[v.prop]=T),Dt(e._startAt=or.set(U,h)),e._startAt._dp=0,n<0&&(i?e._startAt.revert(H):e._startAt.render(-1,!0)),e._zTime=n,E){if(!n)return}else t(e._startAt,m,m);for(e._pt=e._ptCache=0,C=F&&M(C)||C&&!F,u=0;u<U.length;u++){if(l=(p=U[u])._gsap||nt(U)[u]._gsap,e._ptLookup[u]=x={},X[l.id]&&K.length&&ft(),y=N===U?u:N.indexOf(p),v&&!1!==(g=new v).init(p,T||o,e,y,N)&&(e._pt=_=new Tr(e._pt,p,g.name,0,1,g.render,g,0,g.priority),g._props.forEach(function(t){x[t]=_}),g.priority&&(f=1)),!v||T)for(h in o)Z[h]&&(g=Ze(h,o,e,y,p,N))?g.priority&&(f=1):x[h]=_=Ke.call(e,p,h,"get",o[h],y,N,0,b.stringFilter);e._op&&e._op[u]&&e.kill(p,e._op[u]),q&&e._pt&&(He=e,s.killTweensOf(p,x,e.globalTime(n)),w=!e.parent,He=0),e._pt&&C&&(X[l.id]=1)}f&&yr(e),e._onInit&&e._onInit(e)}e._onUpdate=R,e._initted=(!e._op||e._pt)&&!w,O&&n<=0&&Q.render(d,!0,!0)},er=function(t,e,r,i,n,s,a){var o,u,h,_,p=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!p)for(p=t._ptCache[e]=[],h=t._ptLookup,_=t._targets.length;_--;){if((o=h[_][e])&&o.d&&o.d._pt)for(o=o.d._pt;o&&o.p!==e&&o.fp!==e;)o=o._next;if(!o)return $e=1,t.vars[e]="+=0",tr(t,a),$e=0,1;p.push(o)}for(_=p.length;_--;)(o=(u=p[_])._pt||u).s=!i&&0!==i||n?o.s+(i||0)+s*o.c:i,o.c=r-o.s,u.e&&(u.e=ut(r)+Jt(u.e)),u.b&&(u.b=o.s+Jt(u.b))},rr=function(t,e){var r,i,n,s,a=t[0]?st(t[0]).harness:0,o=a&&a.aliases;if(!o)return e;for(i in r=gt({},e),o)if(i in r)for(n=(s=o[i].split(",")).length;n--;)r[s[n]]=r[i];return r},ir=function(t,e,r,i){var n,s,a=e.ease||i||"power1.inOut";if(P(e))s=r[t]||(r[t]=[]),e.forEach(function(t,r){return s.push({t:r/(e.length-1)*100,v:t,e:a})});else for(n in e)s=r[n]||(r[n]=[]),"ease"===n||s.push({t:parseFloat(t),v:e[n],e:a})},nr=function(t,e,r,i,n){return k(t)?t.call(e,r,i,n):b(t)&&~t.indexOf("random(")?ce(t):t},sr=it+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",ar={};exports._checkPlugin=Ze,ot(sr+",id,stagger,delay,duration,paused,scrollTrigger",function(t){return ar[t]=1});var or=function(i){function n(e,n,a,o){var u;"number"==typeof n&&(a.duration=n,n=a,a=null);var h,_,p,f,c,d,v,g,x=(u=i.call(this,o?n:Tt(n))||this).vars,y=x.duration,T=x.delay,w=x.immediateRender,b=x.stagger,k=x.overwrite,E=x.keyframes,R=x.defaults,z=x.scrollTrigger,O=x.yoyoEase,L=n.parent||s,F=(P(e)||S(e)?D(e[0]):"length"in n)?[e]:ee(e);if(u._targets=F.length?nt(F):V("GSAP target "+e+" not found. https://greensock.com",!l.nullTargetWarn)||[],u._ptLookup=[],u._overwrite=k,E||b||A(y)||A(T)){if(n=u.vars,(h=u.timeline=new Ye({data:"nested",defaults:R||{},targets:L&&"nested"===L.data?L.vars.targets:F})).kill(),h.parent=h._dp=t(u),h._start=0,b||A(y)||A(T)){if(f=F.length,v=b&&ne(b),C(b))for(c in b)~sr.indexOf(c)&&(g||(g={}),g[c]=b[c]);for(_=0;_<f;_++)(p=yt(n,ar)).stagger=0,O&&(p.yoyoEase=O),g&&gt(p,g),d=F[_],p.duration=+nr(y,t(u),_,d,F),p.delay=(+nr(T,t(u),_,d,F)||0)-u._delay,!b&&1===f&&p.delay&&(u._delay=T=p.delay,u._start+=T,p.delay=0),h.to(d,p,v?v(_,d,F):0),h._ease=Pe.none;h.duration()?y=T=0:u.timeline=0}else if(E){Tt(mt(h.vars.defaults,{ease:"none"})),h._ease=Ne(E.ease||n.ease||"none");var I,U,B,N=0;if(P(E))E.forEach(function(t){return h.to(F,t,">")}),h.duration();else{for(c in p={},E)"ease"===c||"easeEach"===c||ir(c,E[c],p,E.easeEach);for(c in p)for(I=p[c].sort(function(t,e){return t.t-e.t}),N=0,_=0;_<I.length;_++)(B={ease:(U=I[_]).e,duration:(U.t-(_?I[_-1].t:0))/100*y})[c]=U.v,h.to(F,B,N),N+=B.duration;h.duration()<y&&h.to({},{duration:y-h.duration()})}}y||u.duration(y=h.duration())}else u.timeline=0;return!0!==k||r||(He=t(u),s.killTweensOf(F),He=0),Ft(L,t(u),a),n.reversed&&u.reverse(),n.paused&&u.paused(!0),(w||!y&&!E&&u._start===ht(L._time)&&M(w)&&Rt(t(u))&&"nested"!==L.data)&&(u._tTime=-m,u.render(Math.max(0,-T)||0)),z&&It(t(u),z),u}e(n,i);var a=n.prototype;return a.render=function(t,e,r){var i,n,s,a,o,u,h,_,p,f=this._time,l=this._tDur,c=this._dur,d=t<0,v=t>l-m&&!d?l:t<m?0:t;if(c){if(v!==this._tTime||!t||r||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==d){if(i=v,_=this.timeline,this._repeat){if(a=c+this._rDelay,this._repeat<-1&&d)return this.totalTime(100*a+t,e,r);if(i=ht(v%a),v===l?(s=this._repeat,i=c):((s=~~(v/a))&&s===v/a&&(i=c,s--),i>c&&(i=c)),(u=this._yoyo&&1&s)&&(p=this._yEase,i=c-i),o=St(this._tTime,a),i===f&&!r&&this._initted)return this._tTime=v,this;s!==o&&(_&&this._yEase&&Be(_,u),!this.vars.repeatRefresh||u||this._lock||(this._lock=r=1,this.render(ht(a*s),!0).invalidate()._lock=0))}if(!this._initted){if(Ut(this,d?t:i,r,e,v))return this._tTime=0,this;if(f!==this._time)return this;if(c!==this._dur)return this.render(t,e,r)}if(this._tTime=v,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=h=(p||this._ease)(i/c),this._from&&(this.ratio=h=1-h),i&&!f&&!e&&(ge(this,"onStart"),this._tTime!==v))return this;for(n=this._pt;n;)n.r(h,n.d),n=n._next;_&&_.render(t<0?t:!i&&u?-m:_._dur*_._ease(i/this._dur),e,r)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(d&&Mt(this,t,e,r),ge(this,"onUpdate")),this._repeat&&s!==o&&this.vars.onRepeat&&!e&&this.parent&&ge(this,"onRepeat"),v!==this._tDur&&v||this._tTime!==v||(d&&!this._onUpdate&&Mt(this,t,!0,!0),(t||!c)&&(v===this._tDur&&this._ts>0||!v&&this._ts<0)&&Dt(this,1),e||d&&!f||!(v||f||u)||(ge(this,v===l?"onComplete":"onReverseComplete",!0),this._prom&&!(v<l&&this.timeScale()>0)&&this._prom()))}}else qt(this,t,e,r);return this},a.targets=function(){return this._targets},a.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),i.prototype.invalidate.call(this,t)},a.resetTo=function(t,e,r,i){f||Ae.wake(),this._ts||this.play();var n,s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||tr(this,s),n=this._ease(s/this._dur),er(this,t,e,r,i,n,s)?this.resetTo(t,e,r,i):(Ot(this,0),this.parent||bt(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},a.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?xe(this):this;if(this.timeline){var r=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,He&&!0!==He.vars.overwrite)._first||xe(this),this.parent&&r!==this.timeline.totalDuration()&&jt(this,this._dur*this.timeline._tDur/r,0,1),this}var i,n,s,a,o,u,h,_=this._targets,p=t?ee(t):_,f=this._ptLookup,l=this._pt;if((!e||"all"===e)&&wt(_,p))return"all"===e&&(this._pt=0),xe(this);for(i=this._op=this._op||[],"all"!==e&&(b(e)&&(o={},ot(e,function(t){return o[t]=1}),e=o),e=rr(_,e)),h=_.length;h--;)if(~p.indexOf(_[h]))for(o in n=f[h],"all"===e?(i[h]=e,a=n,s={}):(s=i[h]=i[h]||{},a=e),a)(u=n&&n[o])&&("kill"in u.d&&!0!==u.d.kill(o)||kt(this,u,"_pt"),delete n[o]),"all"!==s&&(s[o]=1);return this._initted&&!this._pt&&l&&xe(this),this},n.to=function(t,e){return new n(t,e,arguments[2])},n.from=function(t,e){return Yt(1,arguments)},n.delayedCall=function(t,e,r,i){return new n(e,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:e,onReverseComplete:e,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:i})},n.fromTo=function(t,e,r){return Yt(2,arguments)},n.set=function(t,e){return e.duration=0,e.repeatDelay||(e.repeat=0),new n(t,e)},n.killTweensOf=function(t,e,r){return s.killTweensOf(t,e,r)},n}(We);exports.TweenLite=exports.TweenMax=exports.Tween=or,mt(or.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),ot("staggerTo,staggerFrom,staggerFromTo",function(t){or[t]=function(){var e=new Ye,r=Xt.call(arguments,0);return r.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,r)}});var ur=function(t,e,r){return t[e]=r},hr=function(t,e,r){return t[e](r)},_r=function(t,e,r,i){return t[e](i.fp,r)},pr=function(t,e,r){return t.setAttribute(e,r)},fr=function(t,e){return k(t[e])?hr:E(t[e])&&t.setAttribute?pr:ur},lr=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},cr=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},dr=function(t,e){var r=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;r;)i=r.p+(r.m?r.m(r.s+r.c*t):Math.round(1e4*(r.s+r.c*t))/1e4)+i,r=r._next;i+=e.c}e.set(e.t,e.p,i,e)},mr=function(t,e){for(var r=e._pt;r;)r.r(t,r.d),r=r._next},vr=function(t,e,r,i){for(var n,s=this._pt;s;)n=s._next,s.p===i&&s.modifier(t,e,r),s=n},gr=function(t){for(var e,r,i=this._pt;i;)r=i._next,i.p===t&&!i.op||i.op===t?kt(this,i,"_pt"):i.dep||(e=1),i=r;return!e},xr=function(t,e,r,i){i.mSet(t,e,i.m.call(i.tween,r,i.mt),i)},yr=function(t){for(var e,r,i,n,s=t._pt;s;){for(e=s._next,r=i;r&&r.pr>s.pr;)r=r._next;(s._prev=r?r._prev:n)?s._prev._next=s:i=s,(s._next=r)?r._prev=s:n=s,s=e}t._pt=i};exports._sortPropTweensByPriority=yr,exports._renderComplexString=dr,exports._getSetter=fr;var Tr=function(){function t(t,e,r,i,n,s,a,o,u){this.t=e,this.s=i,this.c=n,this.p=r,this.r=s||lr,this.d=a||this,this.set=o||ur,this.pr=u||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,r){this.mSet=this.mSet||this.set,this.set=xr,this.m=t,this.mt=r,this.tween=e},t}();exports.PropTween=Tr,ot(it+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(t){return J[t]=1}),N.TweenMax=N.TweenLite=or,N.TimelineLite=N.TimelineMax=Ye,s=new Ye({sortChildren:!1,defaults:c,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),l.stringFilter=Re;var wr=[],br={},kr=[],Dr=0,Er=function(t){return(br[t]||kr).map(function(t){return t()})},Cr=function(){var t=Date.now(),e=[];t-Dr>2&&(Er("matchMediaInit"),wr.forEach(function(t){var r,i,n,s,o=t.queries,u=t.conditions;for(i in o)(r=a.matchMedia(o[i]).matches)&&(n=1),r!==u[i]&&(u[i]=r,s=1);s&&(t.revert(),n&&e.push(t))}),Er("matchMediaRevert"),e.forEach(function(t){return t.onMatch(t)}),Dr=t,Er("matchMedia"))},Mr=function(){function t(t,e){this.selector=e&&re(e),this.data=[],this._r=[],this.isReverted=!1,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,r){k(t)&&(r=e,e=t,t=k);var i=this,s=function(){var t,s=n,a=i.selector;return s&&s!==i&&s.data.push(i),r&&(i.selector=re(r)),n=i,t=e.apply(i,arguments),k(t)&&i._r.push(t),n=s,i.selector=a,i.isReverted=!1,t};return i.last=s,t===k?s(i):t?i[t]=s:s},e.ignore=function(t){var e=n;n=null,t(this),n=e},e.getTweens=function(){var e=[];return this.data.forEach(function(r){return r instanceof t?e.push.apply(e,r.getTweens()):r instanceof or&&!(r.parent&&"nested"===r.parent.data)&&e.push(r)}),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var r=this;if(t){var i=this.getTweens();this.data.forEach(function(t){"isFlip"===t.data&&(t.revert(),t.getChildren(!0,!0,!1).forEach(function(t){return i.splice(i.indexOf(t),1)}))}),i.map(function(t){return{g:t.globalTime(0),t:t}}).sort(function(t,e){return e.g-t.g||-1}).forEach(function(e){return e.t.revert(t)}),this.data.forEach(function(e){return!(e instanceof We)&&e.revert&&e.revert(t)}),this._r.forEach(function(e){return e(t,r)}),this.isReverted=!0}else this.data.forEach(function(t){return t.kill&&t.kill()});if(this.clear(),e){var n=wr.indexOf(this);~n&&wr.splice(n,1)}},e.revert=function(t){this.kill(t||{})},t}(),Rr=function(){function t(t){this.contexts=[],this.scope=t}var e=t.prototype;return e.add=function(t,e,r){C(t)||(t={matches:t});var i,n,s,o=new Mr(0,r||this.scope),u=o.conditions={};for(n in this.contexts.push(o),e=o.add("onMatch",e),o.queries=t,t)"all"===n?s=1:(i=a.matchMedia(t[n]))&&(wr.indexOf(o)<0&&wr.push(o),(u[n]=i.matches)&&(s=1),i.addListener?i.addListener(Cr):i.addEventListener("change",Cr));return s&&e(o),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach(function(e){return e.kill(t,!0)})},t}(),Ar={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(function(t){return ye(t)})},timeline:function(t){return new Ye(t)},getTweensOf:function(t,e){return s.getTweensOf(t,e)},getProperty:function(t,e,r,i){b(t)&&(t=ee(t)[0]);var n=st(t||{}).get,s=r?dt:ct;return"native"===r&&(r=""),t?e?s((Z[e]&&Z[e].get||n)(t,e,r,i)):function(e,r,i){return s((Z[e]&&Z[e].get||n)(t,e,r,i))}:t},quickSetter:function(t,e,r){if((t=ee(t)).length>1){var i=t.map(function(t){return Or.quickSetter(t,e,r)}),n=i.length;return function(t){for(var e=n;e--;)i[e](t)}}t=t[0]||{};var s=Z[e],a=st(t),o=a.harness&&(a.harness.aliases||{})[e]||e,u=s?function(e){var i=new s;p._pt=0,i.init(t,r?e+r:e,p,0,[t]),i.render(1,i),p._pt&&mr(1,p)}:a.set(t,o);return s?u:function(e){return u(t,o,r?e+r:e,a,1)}},quickTo:function(t,e,r){var i,n=Or.to(t,gt(((i={})[e]="+=0.1",i.paused=!0,i),r||{})),s=function(t,r,i){return n.resetTo(e,t,r,i)};return s.tween=n,s},isTweening:function(t){return s.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Ne(t.ease,c.ease)),xt(c,t||{})},config:function(t){return xt(l,t||{})},registerEffect:function(t){var e=t.name,r=t.effect,i=t.plugins,n=t.defaults,s=t.extendTimeline;(i||"").split(",").forEach(function(t){return t&&!Z[t]&&!N[t]&&V(e+" effect requires "+t+" plugin.")}),tt[e]=function(t,e,i){return r(ee(t),mt(e||{},n),i)},s&&(Ye.prototype[e]=function(t,r,i){return this.add(tt[e](t,C(r)?r:(i=r)&&{},this),i)})},registerEase:function(t,e){Pe[t]=Ne(e)},parseEase:function(t,e){return arguments.length?Ne(t,e):Pe},getById:function(t){return s.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var r,i,n=new Ye(t);for(n.smoothChildTiming=M(t.smoothChildTiming),s.remove(n),n._dp=0,n._time=n._tTime=s._time,r=s._first;r;)i=r._next,!e&&!r._dur&&r instanceof or&&r.vars.onComplete===r._targets[0]||Ft(n,r,r._start-r._delay),r=i;return Ft(s,n,0),n},context:function(t,e){return t?new Mr(t,e):n},matchMedia:function(t){return new Rr(t)},matchMediaRefresh:function(){return wr.forEach(function(t){var e,r,i=t.conditions;for(r in i)i[r]&&(i[r]=!1,e=1);e&&t.revert()})||Cr()},addEventListener:function(t,e){var r=br[t]||(br[t]=[]);~r.indexOf(e)||r.push(e)},removeEventListener:function(t,e){var r=br[t],i=r&&r.indexOf(e);i>=0&&r.splice(i,1)},utils:{wrap:fe,wrapYoyo:le,distribute:ne,random:oe,snap:ae,normalize:_e,getUnit:Jt,clamp:Kt,splitColor:ke,toArray:ee,selector:re,mapRange:de,pipe:ue,unitize:he,interpolate:me,shuffle:ie},install:Q,effects:tt,ticker:Ae,updateRoot:Ye.updateRoot,plugins:Z,globalTimeline:s,core:{PropTween:Tr,globals:G,Tween:or,Timeline:Ye,Animation:We,getCache:st,_removeLinkedListItem:kt,reverting:function(){return i},context:function(t){return t&&n&&(n.data.push(t),t._ctx=n),n},suppressOverwrites:function(t){return r=t}}};ot("to,from,fromTo,delayedCall,set,killTweensOf",function(t){return Ar[t]=or[t]}),Ae.add(Ye.updateRoot),p=Ar.to({},{duration:0});var Sr=function(t,e){for(var r=t._pt;r&&r.p!==e&&r.op!==e&&r.fp!==e;)r=r._next;return r},Pr=function(t,e){var r,i,n,s=t._targets;for(r in e)for(i=s.length;i--;)(n=t._ptLookup[i][r])&&(n=n.d)&&(n._pt&&(n=Sr(n,r)),n&&n.modifier&&n.modifier(e[r],t,s[i],r))},zr=function(t,e){return{name:t,rawVars:1,init:function(t,r,i){i._onInit=function(t){var i,n;if(b(r)&&(i={},ot(r,function(t){return i[t]=1}),r=i),e){for(n in i={},r)i[n]=e(r[n]);r=i}Pr(t,r)}}}},Or=Ar.registerPlugin({name:"attr",init:function(t,e,r,i,n){var s,a,o;for(s in this.tween=r,e)o=t.getAttribute(s)||"",(a=this.add(t,"setAttribute",(o||0)+"",e[s],i,n,0,0,s)).op=s,a.b=o,this._props.push(s)},render:function(t,e){for(var r=e._pt;r;)i?r.set(r.t,r.p,r.b,r):r.r(t,r.d),r=r._next}},{name:"endArray",init:function(t,e){for(var r=e.length;r--;)this.add(t,r,t[r]||0,e[r],0,0,0,0,0,1)}},zr("roundProps",se),zr("modifiers"),zr("snap",ae))||Ar;exports.default=exports.gsap=Or,or.version=Ye.version=Or.version="3.11.3",h=1,R()&&Se();var Lr=Pe.Power0,Fr=Pe.Power1,Ir=Pe.Power2,Ur=Pe.Power3,Br=Pe.Power4,Nr=Pe.Linear,qr=Pe.Quad,Qr=Pe.Cubic,jr=Pe.Quart,Vr=Pe.Quint,Gr=Pe.Strong,Wr=Pe.Elastic,Yr=Pe.Back,Hr=Pe.SteppedEase,$r=Pe.Bounce,Jr=Pe.Sine,Kr=Pe.Expo,Xr=Pe.Circ;exports.Circ=Xr,exports.Expo=Kr,exports.Sine=Jr,exports.Bounce=$r,exports.SteppedEase=Hr,exports.Back=Yr,exports.Elastic=Wr,exports.Strong=Gr,exports.Quint=Vr,exports.Quart=jr,exports.Cubic=Qr,exports.Quad=qr,exports.Linear=Nr,exports.Power4=Br,exports.Power3=Ur,exports.Power2=Ir,exports.Power1=Fr,exports.Power0=Lr;
},{}],"KE4Q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.checkPrefix=exports._getBBox=exports._createElement=exports.CSSPlugin=void 0;var t,e,r,n,i,s,o,a,p,l=require("./gsap-core.js"),u=function(){return"undefined"!=typeof window},c={},f=180/Math.PI,h=Math.PI/180,g=Math.atan2,d=1e8,x=/([A-Z])/g,m=/(left|right|width|margin|padding|x)/i,_=/[\s,\(]\S/,y={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},v=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},b=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},w=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},O=function(t,e){var r=e.s+e.c*t;e.set(e.t,e.p,~~(r+(r<0?-.5:.5))+e.u,e)},P=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},M=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},C=function(t,e,r){return t.style[e]=r},S=function(t,e,r){return t.style.setProperty(e,r)},B=function(t,e,r){return t._gsap[e]=r},E=function(t,e,r){return t._gsap.scaleX=t._gsap.scaleY=r},T=function(t,e,r,n,i){var s=t._gsap;s.scaleX=s.scaleY=r,s.renderTransform(i,s)},A=function(t,e,r,n,i){var s=t._gsap;s[e]=r,s.renderTransform(i,s)},F="transform",X=F+"Origin",Y=function(t,e){var r=this,n=this.target,i=n.style;if(t in c){if(this.tfm=this.tfm||{},"transform"!==t&&(~(t=y[t]||t).indexOf(",")?t.split(",").forEach(function(t){return r.tfm[t]=K(n,t)}):this.tfm[t]=n._gsap.x?n._gsap[t]:K(n,t)),this.props.indexOf(F)>=0)return;n._gsap.svg&&(this.svgo=n.getAttribute("data-svg-origin"),this.props.push(X,e,"")),t=F}(i||e)&&this.props.push(t,e,i[t])},k=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},z=function(){var t,e,r=this.props,n=this.target,i=n.style,s=n._gsap;for(t=0;t<r.length;t+=3)r[t+1]?n[r[t]]=r[t+2]:r[t+2]?i[r[t]]=r[t+2]:i.removeProperty(r[t].replace(x,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)s[e]=this.tfm[e];s.svg&&(s.renderTransform(),n.setAttribute("data-svg-origin",this.svgo||"")),!(t=a())||t.isStart||i[F]||(k(i),s.uncache=1)}},U=function(t,e){var r={target:t,props:[],revert:z,save:Y};return e&&e.split(",").forEach(function(t){return r.save(t)}),r},N=function(t,r){var n=e.createElementNS?e.createElementNS((r||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):e.createElement(t);return n.style?n:e.createElement(t)},R=function t(e,r,n){var i=getComputedStyle(e);return i[r]||i.getPropertyValue(r.replace(x,"-$1").toLowerCase())||i.getPropertyValue(r)||!n&&t(e,I(r)||r,1)||""},W="O,Moz,ms,Ms,Webkit".split(","),I=function(t,e,r){var n=(e||i).style,s=5;if(t in n&&!r)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);s--&&!(W[s]+t in n););return s<0?null:(3===s?"ms":s>=0?W[s]:"")+t},V=function(){u()&&window.document&&(t=window,e=t.document,r=e.documentElement,i=N("div")||{style:{}},s=N("div"),F=I(F),X=F+"Origin",i.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",p=!!I("perspective"),a=l.gsap.core.reverting,n=1)},j=function t(e){var n,i=N("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,o=this.nextSibling,a=this.style.cssText;if(r.appendChild(i),i.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(p){}else this._gsapBBox&&(n=this._gsapBBox());return s&&(o?s.insertBefore(this,o):s.appendChild(this)),r.removeChild(i),this.style.cssText=a,n},q=function(t,e){for(var r=e.length;r--;)if(t.hasAttribute(e[r]))return t.getAttribute(e[r])},D=function(t){var e;try{e=t.getBBox()}catch(r){e=j.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===j||(e=j.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+q(t,["x","cx","x1"])||0,y:+q(t,["y","cy","y1"])||0,width:0,height:0}},G=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!D(t))},L=function(t,e){if(e){var r=t.style;e in c&&e!==X&&(e=F),r.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),r.removeProperty(e.replace(x,"-$1").toLowerCase())):r.removeAttribute(e)}},Z=function(t,e,r,n,i,s){var o=new l.PropTween(t._pt,e,r,0,1,s?M:P);return t._pt=o,o.b=n,o.e=i,t._props.push(r),o},H={deg:1,rad:1,turn:1},$={grid:1,flex:1},J=function t(r,n,s,o){var a,p,u,f,h=parseFloat(s)||0,g=(s+"").trim().substr((h+"").length)||"px",d=i.style,x=m.test(n),_="svg"===r.tagName.toLowerCase(),y=(_?"client":"offset")+(x?"Width":"Height"),v="px"===o,b="%"===o;return o===g||!h||H[o]||H[g]?h:("px"!==g&&!v&&(h=t(r,n,s,"px")),f=r.getCTM&&G(r),!b&&"%"!==g||!c[n]&&!~n.indexOf("adius")?(d[x?"width":"height"]=100+(v?g:o),p=~n.indexOf("adius")||"em"===o&&r.appendChild&&!_?r:r.parentNode,f&&(p=(r.ownerSVGElement||{}).parentNode),p&&p!==e&&p.appendChild||(p=e.body),(u=p._gsap)&&b&&u.width&&x&&u.time===l._ticker.time&&!u.uncache?(0,l._round)(h/u.width*100):((b||"%"===g)&&!$[R(p,"display")]&&(d.position=R(r,"position")),p===r&&(d.position="static"),p.appendChild(i),a=i[y],p.removeChild(i),d.position="absolute",x&&b&&((u=(0,l._getCache)(p)).time=l._ticker.time,u.width=p[y]),(0,l._round)(v?a*h/100:a&&h?100/a*h:0))):(a=f?r.getBBox()[x?"width":"height"]:r[y],(0,l._round)(b?h/a*100:h/100*a)))},K=function(t,e,r,i){var s;return n||V(),e in y&&"transform"!==e&&~(e=y[e]).indexOf(",")&&(e=e.split(",")[0]),c[e]&&"transform"!==e?(s=ut(t,i),s="transformOrigin"!==e?s[e]:s.svg?s.origin:ct(R(t,X))+" "+s.zOrigin+"px"):(!(s=t.style[e])||"auto"===s||i||~(s+"").indexOf("calc("))&&(s=nt[e]&&nt[e](t,e,r)||R(t,e)||(0,l._getProperty)(t,e)||("opacity"===e?1:0)),r&&!~(s+"").trim().indexOf(" ")?J(t,e,s,r)+r:s},Q=function(t,e,r,n){if(!r||"none"===r){var i=I(e,t,1),s=i&&R(t,i,1);s&&s!==r?(e=i,r=s):"borderColor"===e&&(r=R(t,"borderTopColor"))}var o,a,p,u,c,f,h,g,d,x,m,_=new l.PropTween(this._pt,t.style,e,0,1,l._renderComplexString),y=0,v=0;if(_.b=r,_.e=n,r+="","auto"===(n+="")&&(t.style[e]=n,n=R(t,e)||n,t.style[e]=r),o=[r,n],(0,l._colorStringFilter)(o),n=o[1],p=(r=o[0]).match(l._numWithUnitExp)||[],(n.match(l._numWithUnitExp)||[]).length){for(;a=l._numWithUnitExp.exec(n);)h=a[0],d=n.substring(y,a.index),c?c=(c+1)%5:"rgba("!==d.substr(-5)&&"hsla("!==d.substr(-5)||(c=1),h!==(f=p[v++]||"")&&(u=parseFloat(f)||0,m=f.substr((u+"").length),"="===h.charAt(1)&&(h=(0,l._parseRelative)(u,h)+m),g=parseFloat(h),x=h.substr((g+"").length),y=l._numWithUnitExp.lastIndex-x.length,x||(x=x||l._config.units[e]||m,y===n.length&&(n+=x,_.e+=x)),m!==x&&(u=J(t,e,f,x)||0),_._pt={_next:_._pt,p:d||1===v?d:",",s:u,c:g-u,m:c&&c<4||"zIndex"===e?Math.round:0});_.c=y<n.length?n.substring(y,n.length):""}else _.r="display"===e&&"none"===n?M:P;return l._relExp.test(n)&&(_.e=0),this._pt=_,_},tt={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},et=function(t){var e=t.split(" "),r=e[0],n=e[1]||"50%";return"top"!==r&&"bottom"!==r&&"left"!==n&&"right"!==n||(t=r,r=n,n=t),e[0]=tt[r]||r,e[1]=tt[n]||n,e.join(" ")},rt=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var r,n,i,s=e.t,o=s.style,a=e.u,p=s._gsap;if("all"===a||!0===a)o.cssText="",n=1;else for(i=(a=a.split(",")).length;--i>-1;)r=a[i],c[r]&&(n=1,r="transformOrigin"===r?X:F),L(s,r);n&&(L(s,F),p&&(p.svg&&s.removeAttribute("transform"),ut(s,1),p.uncache=1,k(o)))}},nt={clearProps:function(t,e,r,n,i){if("isFromStart"!==i.data){var s=t._pt=new l.PropTween(t._pt,e,r,0,0,rt);return s.u=n,s.pr=-10,s.tween=i,t._props.push(r),1}}},it=[1,0,0,1,0,0],st={},ot=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},at=function(t){var e=R(t,F);return ot(e)?it:e.substr(7).match(l._numExp).map(l._round)},pt=function(t,e){var n,i,s,o,a=t._gsap||(0,l._getCache)(t),p=t.style,u=at(t);return a.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(u=[(s=t.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")?it:u:(u!==it||t.offsetParent||t===r||a.svg||(s=p.display,p.display="block",(n=t.parentNode)&&t.offsetParent||(o=1,i=t.nextElementSibling,r.appendChild(t)),u=at(t),s?p.display=s:L(t,"display"),o&&(i?n.insertBefore(t,i):n?n.appendChild(t):r.removeChild(t))),e&&u.length>6?[u[0],u[1],u[4],u[5],u[12],u[13]]:u)},lt=function(t,e,r,n,i,s){var o,a,p,l=t._gsap,u=i||pt(t,!0),c=l.xOrigin||0,f=l.yOrigin||0,h=l.xOffset||0,g=l.yOffset||0,d=u[0],x=u[1],m=u[2],_=u[3],y=u[4],v=u[5],b=e.split(" "),w=parseFloat(b[0])||0,O=parseFloat(b[1])||0;r?u!==it&&(a=d*_-x*m)&&(p=w*(-x/a)+O*(d/a)-(d*v-x*y)/a,w=w*(_/a)+O*(-m/a)+(m*v-_*y)/a,O=p):(w=(o=D(t)).x+(~b[0].indexOf("%")?w/100*o.width:w),O=o.y+(~(b[1]||b[0]).indexOf("%")?O/100*o.height:O)),n||!1!==n&&l.smooth?(y=w-c,v=O-f,l.xOffset=h+(y*d+v*m)-y,l.yOffset=g+(y*x+v*_)-v):l.xOffset=l.yOffset=0,l.xOrigin=w,l.yOrigin=O,l.smooth=!!n,l.origin=e,l.originIsAbsolute=!!r,t.style[X]="0px 0px",s&&(Z(s,l,"xOrigin",c,w),Z(s,l,"yOrigin",f,O),Z(s,l,"xOffset",h,l.xOffset),Z(s,l,"yOffset",g,l.yOffset)),t.setAttribute("data-svg-origin",w+" "+O)},ut=function(t,e){var r=t._gsap||new l.GSCache(t);if("x"in r&&!e&&!r.uncache)return r;var n,i,s,o,a,u,c,d,x,m,_,y,v,b,w,O,P,M,C,S,B,E,T,A,Y,k,z,U,N,W,I,V,j=t.style,q=r.scaleX<0,D=getComputedStyle(t),L=R(t,X)||"0";return n=i=s=u=c=d=x=m=_=0,o=a=1,r.svg=!(!t.getCTM||!G(t)),D.translate&&("none"===D.translate&&"none"===D.scale&&"none"===D.rotate||(j[F]=("none"!==D.translate?"translate3d("+(D.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==D.rotate?"rotate("+D.rotate+") ":"")+("none"!==D.scale?"scale("+D.scale.split(" ").join(",")+") ":"")+("none"!==D[F]?D[F]:"")),j.scale=j.rotate=j.translate="none"),b=pt(t,r.svg),r.svg&&(r.uncache?(Y=t.getBBox(),L=r.xOrigin-Y.x+"px "+(r.yOrigin-Y.y)+"px",A=""):A=!e&&t.getAttribute("data-svg-origin"),lt(t,A||L,!!A||r.originIsAbsolute,!1!==r.smooth,b)),y=r.xOrigin||0,v=r.yOrigin||0,b!==it&&(M=b[0],C=b[1],S=b[2],B=b[3],n=E=b[4],i=T=b[5],6===b.length?(o=Math.sqrt(M*M+C*C),a=Math.sqrt(B*B+S*S),u=M||C?g(C,M)*f:0,(x=S||B?g(S,B)*f+u:0)&&(a*=Math.abs(Math.cos(x*h))),r.svg&&(n-=y-(y*M+v*S),i-=v-(y*C+v*B))):(V=b[6],W=b[7],z=b[8],U=b[9],N=b[10],I=b[11],n=b[12],i=b[13],s=b[14],c=(w=g(V,N))*f,w&&(A=E*(O=Math.cos(-w))+z*(P=Math.sin(-w)),Y=T*O+U*P,k=V*O+N*P,z=E*-P+z*O,U=T*-P+U*O,N=V*-P+N*O,I=W*-P+I*O,E=A,T=Y,V=k),d=(w=g(-S,N))*f,w&&(O=Math.cos(-w),I=B*(P=Math.sin(-w))+I*O,M=A=M*O-z*P,C=Y=C*O-U*P,S=k=S*O-N*P),u=(w=g(C,M))*f,w&&(A=M*(O=Math.cos(w))+C*(P=Math.sin(w)),Y=E*O+T*P,C=C*O-M*P,T=T*O-E*P,M=A,E=Y),c&&Math.abs(c)+Math.abs(u)>359.9&&(c=u=0,d=180-d),o=(0,l._round)(Math.sqrt(M*M+C*C+S*S)),a=(0,l._round)(Math.sqrt(T*T+V*V)),w=g(E,T),x=Math.abs(w)>2e-4?w*f:0,_=I?1/(I<0?-I:I):0),r.svg&&(A=t.getAttribute("transform"),r.forceCSS=t.setAttribute("transform","")||!ot(R(t,F)),A&&t.setAttribute("transform",A))),Math.abs(x)>90&&Math.abs(x)<270&&(q?(o*=-1,x+=u<=0?180:-180,u+=u<=0?180:-180):(a*=-1,x+=x<=0?180:-180)),e=e||r.uncache,r.x=n-((r.xPercent=n&&(!e&&r.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-n)?-50:0)))?t.offsetWidth*r.xPercent/100:0)+"px",r.y=i-((r.yPercent=i&&(!e&&r.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-i)?-50:0)))?t.offsetHeight*r.yPercent/100:0)+"px",r.z=s+"px",r.scaleX=(0,l._round)(o),r.scaleY=(0,l._round)(a),r.rotation=(0,l._round)(u)+"deg",r.rotationX=(0,l._round)(c)+"deg",r.rotationY=(0,l._round)(d)+"deg",r.skewX=x+"deg",r.skewY=m+"deg",r.transformPerspective=_+"px",(r.zOrigin=parseFloat(L.split(" ")[2])||0)&&(j[X]=ct(L)),r.xOffset=r.yOffset=0,r.force3D=l._config.force3D,r.renderTransform=r.svg?_t:p?mt:ht,r.uncache=0,r},ct=function(t){return(t=t.split(" "))[0]+" "+t[1]},ft=function(t,e,r){var n=(0,l.getUnit)(e);return(0,l._round)(parseFloat(e)+parseFloat(J(t,"x",r+"px",n)))+n},ht=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,mt(t,e)},gt="0deg",dt="0px",xt=") ",mt=function(t,e){var r=e||this,n=r.xPercent,i=r.yPercent,s=r.x,o=r.y,a=r.z,p=r.rotation,l=r.rotationY,u=r.rotationX,c=r.skewX,f=r.skewY,g=r.scaleX,d=r.scaleY,x=r.transformPerspective,m=r.force3D,_=r.target,y=r.zOrigin,v="",b="auto"===m&&t&&1!==t||!0===m;if(y&&(u!==gt||l!==gt)){var w,O=parseFloat(l)*h,P=Math.sin(O),M=Math.cos(O);O=parseFloat(u)*h,w=Math.cos(O),s=ft(_,s,P*w*-y),o=ft(_,o,-Math.sin(O)*-y),a=ft(_,a,M*w*-y+y)}x!==dt&&(v+="perspective("+x+xt),(n||i)&&(v+="translate("+n+"%, "+i+"%) "),(b||s!==dt||o!==dt||a!==dt)&&(v+=a!==dt||b?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+xt),p!==gt&&(v+="rotate("+p+xt),l!==gt&&(v+="rotateY("+l+xt),u!==gt&&(v+="rotateX("+u+xt),c===gt&&f===gt||(v+="skew("+c+", "+f+xt),1===g&&1===d||(v+="scale("+g+", "+d+xt),_.style[F]=v||"translate(0, 0)"},_t=function(t,e){var r,n,i,s,o,a=e||this,p=a.xPercent,u=a.yPercent,c=a.x,f=a.y,g=a.rotation,d=a.skewX,x=a.skewY,m=a.scaleX,_=a.scaleY,y=a.target,v=a.xOrigin,b=a.yOrigin,w=a.xOffset,O=a.yOffset,P=a.forceCSS,M=parseFloat(c),C=parseFloat(f);g=parseFloat(g),d=parseFloat(d),(x=parseFloat(x))&&(d+=x=parseFloat(x),g+=x),g||d?(g*=h,d*=h,r=Math.cos(g)*m,n=Math.sin(g)*m,i=Math.sin(g-d)*-_,s=Math.cos(g-d)*_,d&&(x*=h,o=Math.tan(d-x),i*=o=Math.sqrt(1+o*o),s*=o,x&&(o=Math.tan(x),r*=o=Math.sqrt(1+o*o),n*=o)),r=(0,l._round)(r),n=(0,l._round)(n),i=(0,l._round)(i),s=(0,l._round)(s)):(r=m,s=_,n=i=0),(M&&!~(c+"").indexOf("px")||C&&!~(f+"").indexOf("px"))&&(M=J(y,"x",c,"px"),C=J(y,"y",f,"px")),(v||b||w||O)&&(M=(0,l._round)(M+v-(v*r+b*i)+w),C=(0,l._round)(C+b-(v*n+b*s)+O)),(p||u)&&(o=y.getBBox(),M=(0,l._round)(M+p/100*o.width),C=(0,l._round)(C+u/100*o.height)),o="matrix("+r+","+n+","+i+","+s+","+M+","+C+")",y.setAttribute("transform",o),P&&(y.style[F]=o)},yt=function(t,e,r,n,i){var s,o,a=(0,l._isString)(i),p=parseFloat(i)*(a&&~i.indexOf("rad")?f:1)-n,u=n+p+"deg";return a&&("short"===(s=i.split("_")[1])&&(p%=360)!==p%180&&(p+=p<0?360:-360),"cw"===s&&p<0?p=(p+360*d)%360-360*~~(p/360):"ccw"===s&&p>0&&(p=(p-360*d)%360-360*~~(p/360))),t._pt=o=new l.PropTween(t._pt,e,r,n,p,b),o.e=u,o.u="deg",t._props.push(r),o},vt=function(t,e){for(var r in e)t[r]=e[r];return t},bt=function(t,e,r){var n,i,s,o,a,p,u,f=vt({},r._gsap),h=r.style;for(i in f.svg?(s=r.getAttribute("transform"),r.setAttribute("transform",""),h[F]=e,n=ut(r,1),L(r,F),r.setAttribute("transform",s)):(s=getComputedStyle(r)[F],h[F]=e,n=ut(r,1),h[F]=s),c)(s=f[i])!==(o=n[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(a=(0,l.getUnit)(s)!==(u=(0,l.getUnit)(o))?J(r,i,s,u):parseFloat(s),p=parseFloat(o),t._pt=new l.PropTween(t._pt,n,i,a,p-a,v),t._pt.u=u||0,t._props.push(i));vt(n,f)};exports._getBBox=D,exports.checkPrefix=I,exports._createElement=N,(0,l._forEachName)("padding,margin,Width,Radius",function(t,e){var r="Top",n="Right",i="Bottom",s="Left",o=(e<3?[r,n,i,s]:[r+s,r+n,i+n,i+s]).map(function(r){return e<2?t+r:"border"+r+t});nt[e>1?"border"+t:t]=function(t,e,r,n,i){var s,a;if(arguments.length<4)return s=o.map(function(e){return K(t,e,r)}),5===(a=s.join(" ")).split(s[0]).length?s[0]:a;s=(n+"").split(" "),a={},o.forEach(function(t,e){return a[t]=s[e]=s[e]||s[(e-1)/2|0]}),t.init(e,a,i)}});var wt={name:"css",register:V,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,r,i,s){var o,a,p,u,f,h,g,d,x,m,b,P,M,C,S,B,E=this._props,T=t.style,A=r.vars.startAt;for(g in n||V(),this.styles=this.styles||U(t),B=this.styles.props,this.tween=r,e)if("autoRound"!==g&&(a=e[g],!l._plugins[g]||!(0,l._checkPlugin)(g,e,r,i,t,s)))if(f=typeof a,h=nt[g],"function"===f&&(f=typeof(a=a.call(r,i,t,s))),"string"===f&&~a.indexOf("random(")&&(a=(0,l._replaceRandom)(a)),h)h(this,t,g,a,r)&&(S=1);else if("--"===g.substr(0,2))o=(getComputedStyle(t).getPropertyValue(g)+"").trim(),a+="",l._colorExp.lastIndex=0,l._colorExp.test(o)||(d=(0,l.getUnit)(o),x=(0,l.getUnit)(a)),x?d!==x&&(o=J(t,g,o,x)+x):d&&(a+=d),this.add(T,"setProperty",o,a,i,s,0,0,g),E.push(g),B.push(g,0,T[g]);else if("undefined"!==f){if(A&&g in A?(o="function"==typeof A[g]?A[g].call(r,i,t,s):A[g],(0,l._isString)(o)&&~o.indexOf("random(")&&(o=(0,l._replaceRandom)(o)),(0,l.getUnit)(o+"")||(o+=l._config.units[g]||(0,l.getUnit)(K(t,g))||""),"="===(o+"").charAt(1)&&(o=K(t,g))):o=K(t,g),u=parseFloat(o),(m="string"===f&&"="===a.charAt(1)&&a.substr(0,2))&&(a=a.substr(2)),p=parseFloat(a),g in y&&("autoAlpha"===g&&(1===u&&"hidden"===K(t,"visibility")&&p&&(u=0),B.push("visibility",0,T.visibility),Z(this,T,"visibility",u?"inherit":"hidden",p?"inherit":"hidden",!p)),"scale"!==g&&"transform"!==g&&~(g=y[g]).indexOf(",")&&(g=g.split(",")[0])),b=g in c)if(this.styles.save(g),P||((M=t._gsap).renderTransform&&!e.parseTransform||ut(t,e.parseTransform),C=!1!==e.smoothOrigin&&M.smooth,(P=this._pt=new l.PropTween(this._pt,T,F,0,1,M.renderTransform,M,0,-1)).dep=1),"scale"===g)this._pt=new l.PropTween(this._pt,M,"scaleY",u,(m?(0,l._parseRelative)(u,m+p):p)-u||0,v),this._pt.u=0,E.push("scaleY",g),g+="X";else{if("transformOrigin"===g){B.push(X,0,T[X]),a=et(a),M.svg?lt(t,a,0,C,0,this):((x=parseFloat(a.split(" ")[2])||0)!==M.zOrigin&&Z(this,M,"zOrigin",M.zOrigin,x),Z(this,T,g,ct(o),ct(a)));continue}if("svgOrigin"===g){lt(t,a,1,C,0,this);continue}if(g in st){yt(this,M,g,u,m?(0,l._parseRelative)(u,m+a):a);continue}if("smoothOrigin"===g){Z(this,M,"smooth",M.smooth,a);continue}if("force3D"===g){M[g]=a;continue}if("transform"===g){bt(this,a,t);continue}}else g in T||(g=I(g)||g);if(b||(p||0===p)&&(u||0===u)&&!_.test(a)&&g in T)p||(p=0),(d=(o+"").substr((u+"").length))!==(x=(0,l.getUnit)(a)||(g in l._config.units?l._config.units[g]:d))&&(u=J(t,g,o,x)),this._pt=new l.PropTween(this._pt,b?M:T,g,u,(m?(0,l._parseRelative)(u,m+p):p)-u,b||"px"!==x&&"zIndex"!==g||!1===e.autoRound?v:O),this._pt.u=x||0,d!==x&&"%"!==x&&(this._pt.b=o,this._pt.r=w);else if(g in T)Q.call(this,t,g,o,m?m+a:a);else{if(!(g in t)){(0,l._missingPlugin)(g,a);continue}this.add(t,g,o||t[g],m?m+a:a,i,s)}b||(g in T?B.push(g,0,T[g]):B.push(g,1,o||t[g])),E.push(g)}S&&(0,l._sortPropTweensByPriority)(this)},render:function(t,e){if(e.tween._time||!a())for(var r=e._pt;r;)r.r(t,r.d),r=r._next;else e.styles.revert()},get:K,aliases:y,getSetter:function(t,e,r){var n=y[e];return n&&n.indexOf(",")<0&&(e=n),e in c&&e!==X&&(t._gsap.x||K(t,"x"))?r&&o===r?"scale"===e?E:B:(o=r||{})&&("scale"===e?T:A):t.style&&!(0,l._isUndefined)(t.style[e])?C:~e.indexOf("-")?S:(0,l._getSetter)(t,e)},core:{_removeProperty:L,_getMatrix:pt}};exports.default=exports.CSSPlugin=wt,l.gsap.utils.checkPrefix=I,l.gsap.core.getStyleSaver=U,function(t,e,r,n){var i=(0,l._forEachName)("x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+e+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(t){c[t]=1});(0,l._forEachName)(e,function(t){l._config.units[t]="deg",st[t]=1}),y[i[13]]="x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+e,(0,l._forEachName)("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(t){var e=t.split(":");y[e[1]]=i[e[0]]})}(0,"rotation,rotationX,rotationY,skewX,skewY"),(0,l._forEachName)("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(t){l._config.units[t]="px"}),l.gsap.registerPlugin(wt);
},{"./gsap-core.js":"P74P"}],"f8Z0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Back",{enumerable:!0,get:function(){return e.Back}}),Object.defineProperty(exports,"Bounce",{enumerable:!0,get:function(){return e.Bounce}}),Object.defineProperty(exports,"CSSPlugin",{enumerable:!0,get:function(){return r.CSSPlugin}}),Object.defineProperty(exports,"Circ",{enumerable:!0,get:function(){return e.Circ}}),Object.defineProperty(exports,"Cubic",{enumerable:!0,get:function(){return e.Cubic}}),Object.defineProperty(exports,"Elastic",{enumerable:!0,get:function(){return e.Elastic}}),Object.defineProperty(exports,"Expo",{enumerable:!0,get:function(){return e.Expo}}),Object.defineProperty(exports,"Linear",{enumerable:!0,get:function(){return e.Linear}}),Object.defineProperty(exports,"Power0",{enumerable:!0,get:function(){return e.Power0}}),Object.defineProperty(exports,"Power1",{enumerable:!0,get:function(){return e.Power1}}),Object.defineProperty(exports,"Power2",{enumerable:!0,get:function(){return e.Power2}}),Object.defineProperty(exports,"Power3",{enumerable:!0,get:function(){return e.Power3}}),Object.defineProperty(exports,"Power4",{enumerable:!0,get:function(){return e.Power4}}),Object.defineProperty(exports,"Quad",{enumerable:!0,get:function(){return e.Quad}}),Object.defineProperty(exports,"Quart",{enumerable:!0,get:function(){return e.Quart}}),Object.defineProperty(exports,"Quint",{enumerable:!0,get:function(){return e.Quint}}),Object.defineProperty(exports,"Sine",{enumerable:!0,get:function(){return e.Sine}}),Object.defineProperty(exports,"SteppedEase",{enumerable:!0,get:function(){return e.SteppedEase}}),Object.defineProperty(exports,"Strong",{enumerable:!0,get:function(){return e.Strong}}),Object.defineProperty(exports,"TimelineLite",{enumerable:!0,get:function(){return e.TimelineLite}}),Object.defineProperty(exports,"TimelineMax",{enumerable:!0,get:function(){return e.TimelineMax}}),Object.defineProperty(exports,"TweenLite",{enumerable:!0,get:function(){return e.TweenLite}}),exports.gsap=exports.default=exports.TweenMax=void 0;var e=require("./gsap-core.js"),r=require("./CSSPlugin.js"),t=e.gsap.registerPlugin(r.CSSPlugin)||e.gsap,n=t.core.Tween;exports.TweenMax=n,exports.default=exports.gsap=t;
},{"./gsap-core.js":"P74P","./CSSPlugin.js":"KE4Q"}],"sFbG":[function(require,module,exports) {
"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports._vertical=exports._scrollers=exports._proxies=exports._isViewport=exports._horizontal=exports._getVelocityProp=exports._getTarget=exports._getScrollFunc=exports._getProxyProp=exports.Observer=void 0;var n,r,o,i,s,a,c,l,u,p,d,f,g,h=function(){return n||"undefined"!=typeof window&&(n=window.gsap)&&n.registerPlugin&&n},v=function(e){return e},x=1,y=[],m=[],_=[],b=Date.now,w=function(e,t){return t},M=function(){var e=p.core,t=e.bridge||{},n=e._scrollers,r=e._proxies;n.push.apply(n,m),r.push.apply(r,_),exports._scrollers=m=n,exports._proxies=_=r,w=function(e,n){return t[e](n)}},P=function(e,t){return~_.indexOf(e)&&_[_.indexOf(e)+1][t]},X=function(e){return!!~d.indexOf(e)},Y=function(e,t,n,r,o){return e.addEventListener(t,n,{passive:!r,capture:!!o})},D=function(e,t,n,r){return e.removeEventListener(t,n,!!r)},O="scrollLeft",E="scrollTop",T=function(){return f&&f.isPressed||m.cache++},k=function(e,t){var n=function n(r){if(r||0===r){x&&(i.history.scrollRestoration="manual");var o=f&&f.isPressed;r=n.v=Math.round(r)||(f&&f.iOS?1:0),e(r),n.cacheID=m.cache,o&&w("ss",r)}else(t||m.cache!==n.cacheID||w("ref"))&&(n.cacheID=m.cache,n.v=e());return n.v+n.offset};return n.offset=0,e&&n},S={s:O,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:k(function(e){return arguments.length?i.scrollTo(e,C.sc()):i.pageXOffset||s[O]||a[O]||c[O]||0})},C={s:E,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:S,sc:k(function(e){return arguments.length?i.scrollTo(S.sc(),e):i.pageYOffset||s[E]||a[E]||c[E]||0})},A=function(e){return n.utils.toArray(e)[0]||("string"==typeof e&&!1!==n.config().nullTargetWarn?console.warn("Element not found:",e):null)},L=function(e,t){var r=t.s,o=t.sc;X(e)&&(e=s.scrollingElement||a);var i=m.indexOf(e),c=o===C.sc?1:2;!~i&&(i=m.push(e)-1),m[i+c]||e.addEventListener("scroll",T);var l=m[i+c],u=l||(m[i+c]=k(P(e,r),!0)||(X(e)?o:k(function(t){return arguments.length?e[r]=t:e[r]})));return u.target=e,l||(u.smooth="smooth"===n.getProperty(e,"scrollBehavior")),u},V=function(e,t,n){var r=e,o=e,i=b(),s=i,a=t||50,c=Math.max(500,3*a),l=function(e,t){var c=b();t||c-i>a?(o=r,r=e,s=i,i=c):n?r+=e:r=o+(e-o)/(c-s)*(i-s)};return{update:l,reset:function(){o=r=n?0:r,s=i=0},getVelocity:function(e){var t=s,a=o,u=b();return(e||0===e)&&e!==r&&l(e),i===s||u-s>c?0:(r+(n?a:-a))/((n?u:i)-t)*1e3}}},G=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},H=function(e){var t=Math.max.apply(Math,e),n=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(n)?t:n},F=function(){(p=n.core.globals().ScrollTrigger)&&p.core&&M()},I=function(e){return(n=e||h())&&"undefined"!=typeof document&&document.body&&(i=window,s=document,a=s.documentElement,c=s.body,d=[i,s,a,c],o=n.utils.clamp,u="onpointerenter"in c?"pointer":"mouse",l=R.isTouch=i.matchMedia&&i.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in i||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,g=R.eventTypes=("ontouchstart"in a?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in a?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return x=0},500),F(),r=1),r};exports._getVelocityProp=V,exports._getScrollFunc=L,exports._getTarget=A,exports._vertical=C,exports._horizontal=S,exports._isViewport=X,exports._getProxyProp=P,exports._proxies=_,exports._scrollers=m,S.op=C,m.cache=0;var R=function(){function e(e){this.init(e)}return e.prototype.init=function(e){r||I(n)||console.warn("Please gsap.registerPlugin(Observer)"),p||F();var t=e.tolerance,o=e.dragMinimum,d=e.type,h=e.target,v=e.lineHeight,x=e.debounce,m=e.preventDefault,_=e.onStop,w=e.onStopDelay,M=e.ignore,P=e.wheelSpeed,O=e.event,E=e.onDragStart,k=e.onDragEnd,R=e.onDrag,z=e.onPress,B=e.onRelease,W=e.onRight,j=e.onLeft,q=e.onUp,N=e.onDown,U=e.onChangeX,J=e.onChangeY,K=e.onChange,Q=e.onToggleX,Z=e.onToggleY,$=e.onHover,ee=e.onHoverEnd,te=e.onMove,ne=e.ignoreCheck,re=e.isNormalizer,oe=e.onGestureStart,ie=e.onGestureEnd,se=e.onWheel,ae=e.onEnable,ce=e.onDisable,le=e.onClick,ue=e.scrollSpeed,pe=e.capture,de=e.allowClicks,fe=e.lockAxis,ge=e.onLockAxis;this.target=h=A(h)||a,this.vars=e,M&&(M=n.utils.toArray(M)),t=t||1e-9,o=o||0,P=P||1,ue=ue||1,d=d||"wheel,touch,pointer",x=!1!==x,v||(v=parseFloat(i.getComputedStyle(c).lineHeight)||22);var he,ve,xe,ye,me,_e,be,we=this,Me=0,Pe=0,Xe=L(h,S),Ye=L(h,C),De=Xe(),Oe=Ye(),Ee=~d.indexOf("touch")&&!~d.indexOf("pointer")&&"pointerdown"===g[0],Te=X(h),ke=h.ownerDocument||s,Se=[0,0,0],Ce=[0,0,0],Ae=0,Le=function(){return Ae=b()},Ve=function(e,t){return(we.event=e)&&M&&~M.indexOf(e.target)||t&&Ee&&"touch"!==e.pointerType||ne&&ne(e,t)},Ge=function(){var e=we.deltaX=H(Se),n=we.deltaY=H(Ce),r=Math.abs(e)>=t,o=Math.abs(n)>=t;K&&(r||o)&&K(we,e,n,Se,Ce),r&&(W&&we.deltaX>0&&W(we),j&&we.deltaX<0&&j(we),U&&U(we),Q&&we.deltaX<0!=Me<0&&Q(we),Me=we.deltaX,Se[0]=Se[1]=Se[2]=0),o&&(N&&we.deltaY>0&&N(we),q&&we.deltaY<0&&q(we),J&&J(we),Z&&we.deltaY<0!=Pe<0&&Z(we),Pe=we.deltaY,Ce[0]=Ce[1]=Ce[2]=0),(ye||xe)&&(te&&te(we),xe&&(R(we),xe=!1),ye=!1),_e&&!(_e=!1)&&ge&&ge(we),me&&(se(we),me=!1),he=0},He=function(e,t,n){Se[n]+=e,Ce[n]+=t,we._vx.update(e),we._vy.update(t),x?he||(he=requestAnimationFrame(Ge)):Ge()},Fe=function(e,t){fe&&!be&&(we.axis=be=Math.abs(e)>Math.abs(t)?"x":"y",_e=!0),"y"!==be&&(Se[2]+=e,we._vx.update(e,!0)),"x"!==be&&(Ce[2]+=t,we._vy.update(t,!0)),x?he||(he=requestAnimationFrame(Ge)):Ge()},Ie=function(e){if(!Ve(e,1)){var t=(e=G(e,m)).clientX,n=e.clientY,r=t-we.x,i=n-we.y,s=we.isDragging;we.x=t,we.y=n,(s||Math.abs(we.startX-t)>=o||Math.abs(we.startY-n)>=o)&&(R&&(xe=!0),s||(we.isDragging=!0),Fe(r,i),s||E&&E(we))}},Re=we.onPress=function(e){Ve(e,1)||(we.axis=be=null,ve.pause(),we.isPressed=!0,e=G(e),Me=Pe=0,we.startX=we.x=e.clientX,we.startY=we.y=e.clientY,we._vx.reset(),we._vy.reset(),Y(re?h:ke,g[1],Ie,m,!0),we.deltaX=we.deltaY=0,z&&z(we))},ze=function(e){if(!Ve(e,1)){D(re?h:ke,g[1],Ie,!0);var t=we.isDragging&&(Math.abs(we.x-we.startX)>3||Math.abs(we.y-we.startY)>3),r=G(e);t||(we._vx.reset(),we._vy.reset(),m&&de&&n.delayedCall(.08,function(){if(b()-Ae>300&&!e.defaultPrevented)if(e.target.click)e.target.click();else if(ke.createEvent){var t=ke.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,i,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(t)}})),we.isDragging=we.isGesturing=we.isPressed=!1,_&&!re&&ve.restart(!0),k&&t&&k(we),B&&B(we,t)}},Be=function(e){return e.touches&&e.touches.length>1&&(we.isGesturing=!0)&&oe(e,we.isDragging)},We=function(){return(we.isGesturing=!1)||ie(we)},je=function(e){if(!Ve(e)){var t=Xe(),n=Ye();He((t-De)*ue,(n-Oe)*ue,1),De=t,Oe=n,_&&ve.restart(!0)}},qe=function(e){if(!Ve(e)){e=G(e,m),se&&(me=!0);var t=(1===e.deltaMode?v:2===e.deltaMode?i.innerHeight:1)*P;He(e.deltaX*t,e.deltaY*t,0),_&&!re&&ve.restart(!0)}},Ne=function(e){if(!Ve(e)){var t=e.clientX,n=e.clientY,r=t-we.x,o=n-we.y;we.x=t,we.y=n,ye=!0,(r||o)&&Fe(r,o)}},Ue=function(e){we.event=e,$(we)},Je=function(e){we.event=e,ee(we)},Ke=function(e){return Ve(e)||G(e,m)&&le(we)};ve=we._dc=n.delayedCall(w||.25,function(){we._vx.reset(),we._vy.reset(),ve.pause(),_&&_(we)}).pause(),we.deltaX=we.deltaY=0,we._vx=V(0,50,!0),we._vy=V(0,50,!0),we.scrollX=Xe,we.scrollY=Ye,we.isDragging=we.isGesturing=we.isPressed=!1,we.enable=function(e){return we.isEnabled||(Y(Te?ke:h,"scroll",T),d.indexOf("scroll")>=0&&Y(Te?ke:h,"scroll",je,m,pe),d.indexOf("wheel")>=0&&Y(h,"wheel",qe,m,pe),(d.indexOf("touch")>=0&&l||d.indexOf("pointer")>=0)&&(Y(h,g[0],Re,m,pe),Y(ke,g[2],ze),Y(ke,g[3],ze),de&&Y(h,"click",Le,!1,!0),le&&Y(h,"click",Ke),oe&&Y(ke,"gesturestart",Be),ie&&Y(ke,"gestureend",We),$&&Y(h,u+"enter",Ue),ee&&Y(h,u+"leave",Je),te&&Y(h,u+"move",Ne)),we.isEnabled=!0,e&&e.type&&Re(e),ae&&ae(we)),we},we.disable=function(){we.isEnabled&&(y.filter(function(e){return e!==we&&X(e.target)}).length||D(Te?ke:h,"scroll",T),we.isPressed&&(we._vx.reset(),we._vy.reset(),D(re?h:ke,g[1],Ie,!0)),D(Te?ke:h,"scroll",je,pe),D(h,"wheel",qe,pe),D(h,g[0],Re,pe),D(ke,g[2],ze),D(ke,g[3],ze),D(h,"click",Le,!0),D(h,"click",Ke),D(ke,"gesturestart",Be),D(ke,"gestureend",We),D(h,u+"enter",Ue),D(h,u+"leave",Je),D(h,u+"move",Ne),we.isEnabled=we.isPressed=we.isDragging=!1,ce&&ce(we))},we.kill=function(){we.disable();var e=y.indexOf(we);e>=0&&y.splice(e,1),f===we&&(f=0)},y.push(we),re&&X(h)&&(f=we),we.enable(O)},t(e,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),e}();exports.default=exports.Observer=R,R.version="3.11.3",R.create=function(e){return new R(e)},R.register=I,R.getAll=function(){return y.slice()},R.getById=function(e){return y.filter(function(t){return t.vars.id===e})[0]},h()&&n.registerPlugin(R);
},{}],"rpvU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.ScrollTrigger=void 0;var e,t,r,n,o,i,a,s,l,c,u,f,p,d,h,g,v,m,_,y,b,x,w,S,T,P,k,E,O,C,A,M,z,R,F=require("./Observer.js"),I=1,B=Date.now,D=B(),N=0,L=0,W=function(){return d=1},H=function(){return d=0},q=function(e){return e},V=function(e){return Math.round(1e5*e)/1e5||0},Y=function(){return"undefined"!=typeof window},X=function(){return e||Y()&&(e=window.gsap)&&e.registerPlugin&&e},j=function(e){return!!~a.indexOf(e)},U=function(e){return(0,F._getProxyProp)(e,"getBoundingClientRect")||(j(e)?function(){return mt.width=r.innerWidth,mt.height=r.innerHeight,mt}:function(){return Ee(e)})},G=function(e,t,n){var o=n.d,i=n.d2,a=n.a;return(a=(0,F._getProxyProp)(e,"getBoundingClientRect"))?function(){return a()[o]}:function(){return(t?r["inner"+i]:e["client"+i])||0}},K=function(e,t){return!t||~F._proxies.indexOf(e)?U(e):function(){return mt}},Z=function(e,t){var n=t.s,a=t.d2,s=t.d,l=t.a;return(n="scroll"+a)&&(l=(0,F._getProxyProp)(e,n))?l()-U(e)()[s]:j(e)?(o[n]||i[n])-(r["inner"+a]||o["client"+a]||i["client"+a]):e[n]-e["offset"+a]},$=function(e,t){for(var r=0;r<_.length;r+=3)(!t||~t.indexOf(_[r+1]))&&e(_[r],_[r+1],_[r+2])},J=function(e){return"string"==typeof e},Q=function(e){return"function"==typeof e},ee=function(e){return"number"==typeof e},te=function(e){return"object"==typeof e},re=function(e){return Q(e)&&e()},ne=function(e,t){return function(){var r=re(e),n=re(t);return function(){re(r),re(n)}}},oe=function(e,t,r){return e&&e.progress(t?0:1)&&r&&e.pause()},ie=function(e,t){if(e.enabled){var r=t(e);r&&r.totalTime&&(e.callbackAnimation=r)}},ae=Math.abs,se="scrollLeft",le="scrollTop",ce="left",ue="top",fe="right",pe="bottom",de="width",he="height",ge="Right",ve="Left",me="Top",_e="Bottom",ye="padding",be="margin",xe="Width",we="Height",Se="px",Te=function(e){return r.getComputedStyle(e)},Pe=function(e){var t=Te(e).position;e.style.position="absolute"===t||"fixed"===t?t:"relative"},ke=function(e,t){for(var r in t)r in e||(e[r]=t[r]);return e},Ee=function(t,r){var n=r&&"matrix(1, 0, 0, 1, 0, 0)"!==Te(t)[h]&&e.to(t,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),o=t.getBoundingClientRect();return n&&n.progress(0).kill(),o},Oe=function(e,t){var r=t.d2;return e["offset"+r]||e["client"+r]||0},Ce=function(e){var t,r=[],n=e.labels,o=e.duration();for(t in n)r.push(n[t]/o);return r},Ae=function(t){return function(r){return e.utils.snap(Ce(t),r)}},Me=function(t){var r=e.utils.snap(t),n=Array.isArray(t)&&t.slice(0).sort(function(e,t){return e-t});return n?function(e,t,o){var i;if(void 0===o&&(o=.001),!t)return r(e);if(t>0){for(e-=o,i=0;i<n.length;i++)if(n[i]>=e)return n[i];return n[i-1]}for(i=n.length,e+=o;i--;)if(n[i]<=e)return n[i];return n[0]}:function(e,n,o){void 0===o&&(o=.001);var i=r(e);return!n||Math.abs(i-e)<o||i-e<0==n<0?i:r(n<0?e-t:e+t)}},ze=function(e){return function(t,r){return Me(Ce(e))(t,r.direction)}},Re=function(e,t,r,n){return r.split(",").forEach(function(r){return e(t,r,n)})},Fe=function(e,t,r,n,o){return e.addEventListener(t,r,{passive:!n,capture:!!o})},Ie=function(e,t,r,n){return e.removeEventListener(t,r,!!n)},Be=function(e,t,r){return r&&r.wheelHandler&&e(t,"wheel",r)},De={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Ne={toggleActions:"play",anticipatePin:0},Le={top:0,left:0,center:.5,bottom:1,right:1},We=function(e,t){if(J(e)){var r=e.indexOf("="),n=~r?+(e.charAt(r-1)+1)*parseFloat(e.substr(r+1)):0;~r&&(e.indexOf("%")>r&&(n*=t/100),e=e.substr(0,r-1)),e=n+(e in Le?Le[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},He=function(e,t,r,o,a,s,l,c){var u=a.startColor,f=a.endColor,p=a.fontSize,d=a.indent,h=a.fontWeight,g=n.createElement("div"),v=j(r)||"fixed"===(0,F._getProxyProp)(r,"pinType"),m=-1!==e.indexOf("scroller"),_=v?i:r,y=-1!==e.indexOf("start"),b=y?u:f,x="border-color:"+b+";font-size:"+p+";color:"+b+";font-weight:"+h+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return x+="position:"+((m||c)&&v?"fixed;":"absolute;"),(m||c||!v)&&(x+=(o===F._vertical?fe:pe)+":"+(s+parseFloat(d))+"px;"),l&&(x+="box-sizing:border-box;text-align:left;width:"+l.offsetWidth+"px;"),g._isStart=y,g.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),g.style.cssText=x,g.innerText=t||0===t?e+"-"+t:e,_.children[0]?_.insertBefore(g,_.children[0]):_.appendChild(g),g._offset=g["offset"+o.op.d2],qe(g,0,o,y),g},qe=function(t,r,n,o){var i={display:"block"},a=n[o?"os2":"p2"],s=n[o?"p2":"os2"];t._isFlipped=o,i[n.a+"Percent"]=o?-100:0,i[n.a]=o?"1px":0,i["border"+a+xe]=1,i["border"+s+xe]=0,i[n.p]=r+"px",e.set(t,i)},Ve=[],Ye={},Xe=function(){return B()-N>34&&(A||(A=requestAnimationFrame(lt)))},je=function(){(!w||!w.isPressed||w.startX>i.clientWidth)&&(F._scrollers.cache++,w?A||(A=requestAnimationFrame(lt)):lt(),N||Je("scrollStart"),N=B())},Ue=function(){P=r.innerWidth,T=r.innerHeight},Ge=function(){F._scrollers.cache++,!p&&!x&&!n.fullscreenElement&&!n.webkitFullscreenElement&&(!S||P!==r.innerWidth||Math.abs(r.innerHeight-T)>.25*r.innerHeight)&&s.restart(!0)},Ke={},Ze=[],$e=function e(){return Ie(wt,"scrollEnd",e)||it(!0)},Je=function(e){return Ke[e]&&Ke[e].map(function(e){return e()})||Ze},Qe=[],et=function(e){for(var t=0;t<Qe.length;t+=5)(!e||Qe[t+4]&&Qe[t+4].query===e)&&(Qe[t].style.cssText=Qe[t+1],Qe[t].getBBox&&Qe[t].setAttribute("transform",Qe[t+2]||""),Qe[t+3].uncache=1)},tt=function(e,t){var r;for(g=0;g<Ve.length;g++)!(r=Ve[g])||t&&r._ctx!==t||(e?r.kill(1):r.revert(!0,!0));t&&et(t),t||Je("revert")},rt=function(e,t){F._scrollers.cache++,(t||!M)&&F._scrollers.forEach(function(e){return Q(e)&&e.cacheID++&&(e.rec=0)}),J(e)&&(r.history.scrollRestoration=O=e)},nt=0,ot=function(){if(z!==nt){var e=z=nt;requestAnimationFrame(function(){return e===nt&&it(!0)})}},it=function(e,t){if(!N||e){M=wt.isRefreshing=!0,F._scrollers.forEach(function(e){return Q(e)&&e.cacheID++&&(e.rec=e())});var r=Je("refreshInit");y&&wt.sort(),t||tt(),F._scrollers.forEach(function(e){Q(e)&&(e.smooth&&(e.target.style.scrollBehavior="auto"),e(0))}),Ve.slice(0).forEach(function(e){return e.refresh()}),Ve.forEach(function(e,t){if(e._subPinOffset&&e.pin){var r=e.vars.horizontal?"offsetWidth":"offsetHeight",n=e.pin[r];e.revert(!0,1),e.adjustPinSpacing(e.pin[r]-n),e.revert(!1,1)}}),Ve.forEach(function(e){return"max"===e.vars.end&&e.setPositions(e.start,Math.max(e.start+1,Z(e.scroller,e._dir)))}),r.forEach(function(e){return e&&e.render&&e.render(-1)}),F._scrollers.forEach(function(e){Q(e)&&(e.smooth&&requestAnimationFrame(function(){return e.target.style.scrollBehavior="smooth"}),e.rec&&e(e.rec))}),rt(O,1),s.pause(),nt++,lt(2),Ve.forEach(function(e){return Q(e.vars.onRefresh)&&e.vars.onRefresh(e)}),M=wt.isRefreshing=!1,Je("refresh")}else Fe(wt,"scrollEnd",$e)},at=0,st=1,lt=function(e){if(!M||2===e){wt.isUpdating=!0,R&&R.update(0);var t=Ve.length,r=B(),n=r-D>=50,o=t&&Ve[0].scroll();if(st=at>o?-1:1,at=o,n&&(N&&!d&&r-N>200&&(N=0,Je("scrollEnd")),u=D,D=r),st<0){for(g=t;g-- >0;)Ve[g]&&Ve[g].update(0,n);st=1}else for(g=0;g<t;g++)Ve[g]&&Ve[g].update(0,n);wt.isUpdating=!1}A=0},ct=[ce,ue,pe,fe,be+_e,be+ge,be+me,be+ve,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],ut=ct.concat([de,he,"boxSizing","max"+xe,"max"+we,"position",be,ye,ye+me,ye+ge,ye+_e,ye+ve]),ft=function(e,t,r){ht(r);var n=e._gsap;if(n.spacerIsNative)ht(n.spacerState);else if(e._gsap.swappedIn){var o=t.parentNode;o&&(o.insertBefore(e,t),o.removeChild(t))}e._gsap.swappedIn=!1},pt=function(e,t,r,n){if(!e._gsap.swappedIn){for(var o,i=ct.length,a=t.style,s=e.style;i--;)a[o=ct[i]]=r[o];a.position="absolute"===r.position?"absolute":"relative","inline"===r.display&&(a.display="inline-block"),s[pe]=s[fe]="auto",a.flexBasis=r.flexBasis||"auto",a.overflow="visible",a.boxSizing="border-box",a[de]=Oe(e,F._horizontal)+Se,a[he]=Oe(e,F._vertical)+Se,a[ye]=s[be]=s[ue]=s[ce]="0",ht(n),s[de]=s["max"+xe]=r[de],s[he]=s["max"+we]=r[he],s[ye]=r[ye],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},dt=/([A-Z])/g,ht=function(t){if(t){var r,n,o=t.t.style,i=t.length,a=0;for((t.t._gsap||e.core.getCache(t.t)).uncache=1;a<i;a+=2)n=t[a+1],r=t[a],n?o[r]=n:o[r]&&o.removeProperty(r.replace(dt,"-$1").toLowerCase())}},gt=function(e){for(var t=ut.length,r=e.style,n=[],o=0;o<t;o++)n.push(ut[o],r[ut[o]]);return n.t=e,n},vt=function(e,t,r){for(var n,o=[],i=e.length,a=r?8:0;a<i;a+=2)n=e[a],o.push(n,n in t?t[n]:e[a+1]);return o.t=e.t,o},mt={left:0,top:0},_t=function(e,t,r,n,a,s,l,c,u,f,p,d,h){Q(e)&&(e=e(c)),J(e)&&"max"===e.substr(0,3)&&(e=d+("="===e.charAt(4)?We("0"+e.substr(3),r):0));var g,v,m,_=h?h.time():0;if(h&&h.seek(0),ee(e))l&&qe(l,r,n,!0);else{Q(t)&&(t=t(c));var y,b,x,w,S=(e||"0").split(" ");m=(0,F._getTarget)(t)||i,(y=Ee(m)||{})&&(y.left||y.top)||"none"!==Te(m).display||(w=m.style.display,m.style.display="block",y=Ee(m),w?m.style.display=w:m.style.removeProperty("display")),b=We(S[0],y[n.d]),x=We(S[1]||"0",r),e=y[n.p]-u[n.p]-f+b+a-x,l&&qe(l,x,n,r-x<20||l._isStart&&x>20),r-=r-x}if(s){var T=e+r,P=s._isStart;g="scroll"+n.d2,qe(s,T,n,P&&T>20||!P&&(p?Math.max(i[g],o[g]):s.parentNode[g])<=T+1),p&&(u=Ee(l),p&&(s.style[n.op.p]=u[n.op.p]-n.op.m-s._offset+Se))}return h&&m&&(g=Ee(m),h.seek(d),v=Ee(m),h._caScrollDist=g[n.p]-v[n.p],e=e/h._caScrollDist*d),h&&h.seek(_),h?e:Math.round(e)},yt=/(webkit|moz|length|cssText|inset)/i,bt=function(t,r,n,o){if(t.parentNode!==r){var a,s,l=t.style;if(r===i){for(a in t._stOrig=l.cssText,s=Te(t))+a||yt.test(a)||!s[a]||"string"!=typeof l[a]||"0"===a||(l[a]=s[a]);l.top=n,l.left=o}else l.cssText=t._stOrig;e.core.getCache(t).uncache=1,r.appendChild(t)}},xt=function(t,r){var n,o,i=(0,F._getScrollFunc)(t,r),a="_scroll"+r.p2,s=function r(s,l,c,u,f){var p=r.tween,d=l.onComplete,h={};return c=c||i(),f=u&&f||0,u=u||s-c,p&&p.kill(),n=Math.round(c),l[a]=s,l.modifiers=h,h[a]=function(e){return(e=Math.round(i()))!==n&&e!==o&&Math.abs(e-n)>3&&Math.abs(e-o)>3?(p.kill(),r.tween=0):e=c+u*p.ratio+f*p.ratio*p.ratio,o=n,n=Math.round(e)},l.onComplete=function(){r.tween=0,d&&d.call(p)},p=r.tween=e.to(t,l)};return t[a]=i,i.wheelHandler=function(){return s.tween&&s.tween.kill()&&(s.tween=0)},Fe(t,"wheel",i.wheelHandler),s},wt=function(){function w(r,n){t||w.register(e)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(r,n)}return w.prototype.init=function(t,a){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),L){var s,f,h,v,m,_,x,S,T,P,k,O,A,z,D,W,H,Y,X,U,$,re,ne,se,le,ce,ue,fe,pe,Ce,Re,Be,Le,qe,Xe,Ue,Ke,Ze,Je=t=ke(J(t)||ee(t)||t.nodeType?{trigger:t}:t,Ne),Qe=Je.onUpdate,et=Je.toggleClass,tt=Je.id,rt=Je.onToggle,nt=Je.onRefresh,it=Je.scrub,at=Je.trigger,lt=Je.pin,ct=Je.pinSpacing,ut=Je.invalidateOnRefresh,dt=Je.anticipatePin,mt=Je.onScrubComplete,yt=Je.onSnapComplete,wt=Je.once,St=Je.snap,Tt=Je.pinReparent,Pt=Je.pinSpacer,kt=Je.containerAnimation,Et=Je.fastScrollEnd,Ot=Je.preventOverlaps,Ct=t.horizontal||t.containerAnimation&&!1!==t.horizontal?F._horizontal:F._vertical,At=!it&&0!==it,Mt=(0,F._getTarget)(t.scroller||r),zt=e.core.getCache(Mt),Rt=j(Mt),Ft="fixed"===("pinType"in t?t.pinType:(0,F._getProxyProp)(Mt,"pinType")||Rt&&"fixed"),It=[t.onEnter,t.onLeave,t.onEnterBack,t.onLeaveBack],Bt=At&&t.toggleActions.split(" "),Dt="markers"in t?t.markers:Ne.markers,Nt=Rt?0:parseFloat(Te(Mt)["border"+Ct.p2+xe])||0,Lt=this,Wt=t.onRefreshInit&&function(){return t.onRefreshInit(Lt)},Ht=G(Mt,Rt,Ct),qt=K(Mt,Rt),Vt=0,Yt=0,Xt=(0,F._getScrollFunc)(Mt,Ct);if(E(Lt),Lt._dir=Ct,dt*=45,Lt.scroller=Mt,Lt.scroll=kt?kt.time.bind(kt):Xt,v=Xt(),Lt.vars=t,a=a||t.animation,"refreshPriority"in t&&(y=1,-9999===t.refreshPriority&&(R=Lt)),zt.tweenScroll=zt.tweenScroll||{top:xt(Mt,F._vertical),left:xt(Mt,F._horizontal)},Lt.tweenTo=s=zt.tweenScroll[Ct.p],Lt.scrubDuration=function(t){(Re=ee(t)&&t)?Ce?Ce.duration(t):Ce=e.to(a,{ease:"expo",totalProgress:"+=0.001",duration:Re,paused:!0,onComplete:function(){return mt&&mt(Lt)}}):(Ce&&Ce.progress(1).kill(),Ce=0)},a&&(a.vars.lazy=!1,a._initted||!1!==a.vars.immediateRender&&!1!==t.immediateRender&&a.duration()&&a.render(0,!0,!0),Lt.animation=a.pause(),a.scrollTrigger=Lt,Lt.scrubDuration(it),fe=0,tt||(tt=a.vars.id)),Ve.push(Lt),St&&(te(St)&&!St.push||(St={snapTo:St}),"scrollBehavior"in i.style&&e.set(Rt?[i,o]:Mt,{scrollBehavior:"auto"}),F._scrollers.forEach(function(e){return Q(e)&&e.target===(Rt?n.scrollingElement||o:Mt)&&(e.smooth=!1)}),h=Q(St.snapTo)?St.snapTo:"labels"===St.snapTo?Ae(a):"labelsDirectional"===St.snapTo?ze(a):!1!==St.directional?function(e,t){return Me(St.snapTo)(e,B()-Yt<500?0:t.direction)}:e.utils.snap(St.snapTo),Be=St.duration||{min:.1,max:2},Be=te(Be)?c(Be.min,Be.max):c(Be,Be),Le=e.delayedCall(St.delay||Re/2||.1,function(){var t=Xt(),r=B()-Yt<500,n=s.tween;if(!(r||Math.abs(Lt.getVelocity())<10)||n||d||Vt===t)Lt.isActive&&Vt!==t&&Le.restart(!0);else{var o=(t-_)/A,i=a&&!At?a.totalProgress():o,l=r?0:(i-pe)/(B()-u)*1e3||0,f=e.utils.clamp(-o,1-o,ae(l/2)*l/.185),p=o+(!1===St.inertia?0:f),g=c(0,1,h(p,Lt)),v=Math.round(_+g*A),m=St,y=m.onStart,b=m.onInterrupt,w=m.onComplete;if(t<=x&&t>=_&&v!==t){if(n&&!n._initted&&n.data<=ae(v-t))return;!1===St.inertia&&(f=g-o),s(v,{duration:Be(ae(.185*Math.max(ae(p-i),ae(g-i))/l/.05||0)),ease:St.ease||"power3",data:ae(v-t),onInterrupt:function(){return Le.restart(!0)&&b&&b(Lt)},onComplete:function(){Lt.update(),Vt=Xt(),fe=pe=a&&!At?a.totalProgress():Lt.progress,yt&&yt(Lt),w&&w(Lt)}},t,f*A,v-t-f*A),y&&y(Lt,s.tween)}}}).pause()),tt&&(Ye[tt]=Lt),(Ze=(at=Lt.trigger=(0,F._getTarget)(at||lt))&&at._gsap&&at._gsap.stRevert)&&(Ze=Ze(Lt)),lt=!0===lt?at:(0,F._getTarget)(lt),J(et)&&(et={targets:at,className:et}),lt&&(!1===ct||ct===be||(ct=!(!ct&&lt.parentNode&&lt.parentNode.style&&"flex"===Te(lt.parentNode).display)&&ye),Lt.pin=lt,(f=e.core.getCache(lt)).spacer?z=f.pinState:(Pt&&((Pt=(0,F._getTarget)(Pt))&&!Pt.nodeType&&(Pt=Pt.current||Pt.nativeElement),f.spacerIsNative=!!Pt,Pt&&(f.spacerState=gt(Pt))),f.spacer=H=Pt||n.createElement("div"),H.classList.add("pin-spacer"),tt&&H.classList.add("pin-spacer-"+tt),f.pinState=z=gt(lt)),!1!==t.force3D&&e.set(lt,{force3D:!0}),Lt.spacer=H=f.spacer,ue=Te(lt),ne=ue[ct+Ct.os2],X=e.getProperty(lt),U=e.quickSetter(lt,Ct.a,Se),pt(lt,H,ue),W=gt(lt)),Dt){O=te(Dt)?ke(Dt,De):De,P=He("scroller-start",tt,Mt,Ct,O,0),k=He("scroller-end",tt,Mt,Ct,O,0,P),Y=P["offset"+Ct.op.d2];var jt=(0,F._getTarget)((0,F._getProxyProp)(Mt,"content")||Mt);S=this.markerStart=He("start",tt,jt,Ct,O,Y,0,kt),T=this.markerEnd=He("end",tt,jt,Ct,O,Y,0,kt),kt&&(Ke=e.quickSetter([S,T],Ct.a,Se)),Ft||F._proxies.length&&!0===(0,F._getProxyProp)(Mt,"fixedMarkers")||(Pe(Rt?i:Mt),e.set([P,k],{force3D:!0}),le=e.quickSetter(P,Ct.a,Se),ce=e.quickSetter(k,Ct.a,Se))}if(kt){var Ut=kt.vars.onUpdate,Gt=kt.vars.onUpdateParams;kt.eventCallback("onUpdate",function(){Lt.update(0,0,1),Ut&&Ut.apply(Gt||[])})}Lt.previous=function(){return Ve[Ve.indexOf(Lt)-1]},Lt.next=function(){return Ve[Ve.indexOf(Lt)+1]},Lt.revert=function(e,t){if(!t)return Lt.kill(!0);var r=!1!==e||!Lt.enabled,n=p;r!==Lt.isReverted&&(r&&(Xe=Math.max(Xt(),Lt.scroll.rec||0),qe=Lt.progress,Ue=a&&a.progress()),S&&[S,T,P,k].forEach(function(e){return e.style.display=r?"none":"block"}),r&&(p=1,Lt.update(r)),lt&&(r?ft(lt,H,z):(!Tt||!Lt.isActive)&&pt(lt,H,Te(lt),se)),r||Lt.update(r),p=n,Lt.isReverted=r)},Lt.refresh=function(r,n){if(!p&&Lt.enabled||n)if(lt&&r&&N)Fe(w,"scrollEnd",$e);else{!M&&Wt&&Wt(Lt),p=1,Yt=B(),s.tween&&(s.tween.kill(),s.tween=0),Ce&&Ce.pause(),ut&&a&&a.revert({kill:!1}).invalidate(),Lt.isReverted||Lt.revert(!0,!0),Lt._subPinOffset=!1;for(var o,l,c,u,f,d,h,g,y,E,O=Ht(),C=qt(),R=kt?kt.duration():Z(Mt,Ct),I=0,L=0,q=t.end,V=t.endTrigger||at,Y=t.start||(0!==t.start&&at?lt?"0 0":"0 100%":0),j=Lt.pinnedContainer=t.pinnedContainer&&(0,F._getTarget)(t.pinnedContainer),U=at&&Math.max(0,Ve.indexOf(Lt))||0,G=U;G--;)(d=Ve[G]).end||d.refresh(0,1)||(p=1),!(h=d.pin)||h!==at&&h!==lt||d.isReverted||(E||(E=[]),E.unshift(d),d.revert(!0,!0)),d!==Ve[G]&&(U--,G--);for(Q(Y)&&(Y=Y(Lt)),_=_t(Y,at,O,Ct,Xt(),S,P,Lt,C,Nt,Ft,R,kt)||(lt?-.001:0),Q(q)&&(q=q(Lt)),J(q)&&!q.indexOf("+=")&&(~q.indexOf(" ")?q=(J(Y)?Y.split(" ")[0]:"")+q:(I=We(q.substr(2),O),q=J(Y)?Y:_+I,V=at)),x=Math.max(_,_t(q||(V?"100% 0":R),V,O,Ct,Xt()+I,T,k,Lt,C,Nt,Ft,R,kt))||-.001,A=x-_||(_-=.01)&&.001,I=0,G=U;G--;)(h=(d=Ve[G]).pin)&&d.start-d._pinPush<=_&&!kt&&d.end>0&&(o=d.end-d.start,(h===at&&d.start-d._pinPush<_||h===j)&&!ee(Y)&&(I+=o*(1-d.progress)),h===lt&&(L+=o));if(_+=I,x+=I,Lt._pinPush=L,S&&I&&((o={})[Ct.a]="+="+I,j&&(o[Ct.p]="-="+Xt()),e.set([S,T],o)),lt)o=Te(lt),u=Ct===F._vertical,c=Xt(),$=parseFloat(X(Ct.a))+L,!R&&x>1&&((Rt?i:Mt).style["overflow-"+Ct.a]="scroll"),pt(lt,H,o),W=gt(lt),l=Ee(lt,!0),g=Ft&&(0,F._getScrollFunc)(Mt,u?F._horizontal:F._vertical)(),ct&&((se=[ct+Ct.os2,A+L+Se]).t=H,(G=ct===ye?Oe(lt,Ct)+A+L:0)&&se.push(Ct.d,G+Se),ht(se),j&&Ve.forEach(function(e){e.pin===j&&!1!==e.vars.pinSpacing&&(e._subPinOffset=!0)}),Ft&&Xt(Xe)),Ft&&((f={top:l.top+(u?c-_:g)+Se,left:l.left+(u?g:c-_)+Se,boxSizing:"border-box",position:"fixed"})[de]=f["max"+xe]=Math.ceil(l.width)+Se,f[he]=f["max"+we]=Math.ceil(l.height)+Se,f[be]=f[be+me]=f[be+ge]=f[be+_e]=f[be+ve]="0",f[ye]=o[ye],f[ye+me]=o[ye+me],f[ye+ge]=o[ye+ge],f[ye+_e]=o[ye+_e],f[ye+ve]=o[ye+ve],D=vt(z,f,Tt),M&&Xt(0)),a?(y=a._initted,b(1),a.render(a.duration(),!0,!0),re=X(Ct.a)-$+A+L,A!==re&&Ft&&D.splice(D.length-2,2),a.render(0,!0,!0),y||a.invalidate(!0),a.parent||a.totalTime(a.totalTime()),b(0)):re=A;else if(at&&Xt()&&!kt)for(l=at.parentNode;l&&l!==i;)l._pinOffset&&(_-=l._pinOffset,x-=l._pinOffset),l=l.parentNode;E&&E.forEach(function(e){return e.revert(!1,!0)}),Lt.start=_,Lt.end=x,v=m=M?Xe:Xt(),kt||M||(v<Xe&&Xt(Xe),Lt.scroll.rec=0),Lt.revert(!1,!0),Le&&(Vt=-1,Lt.isActive&&Xt(_+A*qe),Le.restart(!0)),p=0,a&&At&&(a._initted||Ue)&&a.progress()!==Ue&&a.progress(Ue,!0).render(a.time(),!0,!0),(qe!==Lt.progress||kt)&&(a&&!At&&a.totalProgress(qe,!0),Lt.progress=(v-_)/A===qe?0:qe),lt&&ct&&(H._pinOffset=Math.round(Lt.progress*re)),nt&&!M&&nt(Lt)}},Lt.getVelocity=function(){return(Xt()-m)/(B()-u)*1e3||0},Lt.endAnimation=function(){oe(Lt.callbackAnimation),a&&(Ce?Ce.progress(1):a.paused()?At||oe(a,Lt.direction<0,1):oe(a,a.reversed()))},Lt.labelToScroll=function(e){return a&&a.labels&&(_||Lt.refresh()||_)+a.labels[e]/a.duration()*A||0},Lt.getTrailing=function(e){var t=Ve.indexOf(Lt),r=Lt.direction>0?Ve.slice(0,t).reverse():Ve.slice(t+1);return(J(e)?r.filter(function(t){return t.vars.preventOverlaps===e}):r).filter(function(e){return Lt.direction>0?e.end<=_:e.start>=x})},Lt.update=function(e,t,r){if(!kt||r||e){var n,o,c,f,d,h,g,y=M?Xe:Lt.scroll(),b=e?0:(y-_)/A,w=b<0?0:b>1?1:b||0,S=Lt.progress;if(t&&(m=v,v=kt?Xt():y,St&&(pe=fe,fe=a&&!At?a.totalProgress():w)),dt&&!w&&lt&&!p&&!I&&N&&_<y+(y-m)/(B()-u)*dt&&(w=1e-4),w!==S&&Lt.enabled){if(f=(d=(n=Lt.isActive=!!w&&w<1)!==(!!S&&S<1))||!!w!=!!S,Lt.direction=w>S?1:-1,Lt.progress=w,f&&!p&&(o=w&&!S?0:1===w?1:1===S?2:3,At&&(c=!d&&"none"!==Bt[o+1]&&Bt[o+1]||Bt[o],g=a&&("complete"===c||"reset"===c||c in a))),Ot&&(d||g)&&(g||it||!a)&&(Q(Ot)?Ot(Lt):Lt.getTrailing(Ot).forEach(function(e){return e.endAnimation()})),At||(!Ce||p||I?a&&a.totalProgress(w,!!p):((kt||R&&R!==Lt)&&Ce.render(Ce._dp._time-Ce._start),Ce.resetTo?Ce.resetTo("totalProgress",w,a._tTime/a._tDur):(Ce.vars.totalProgress=w,Ce.invalidate().restart()))),lt)if(e&&ct&&(H.style[ct+Ct.os2]=ne),Ft){if(f){if(h=!e&&w>S&&x+1>y&&y+1>=Z(Mt,Ct),Tt)if(e||!n&&!h)bt(lt,H);else{var T=Ee(lt,!0),k=y-_;bt(lt,i,T.top+(Ct===F._vertical?k:0)+Se,T.left+(Ct===F._vertical?0:k)+Se)}ht(n||h?D:W),re!==A&&w<1&&n||U($+(1!==w||h?0:re))}}else U(V($+re*w));St&&!s.tween&&!p&&!I&&Le.restart(!0),et&&(d||wt&&w&&(w<1||!C))&&l(et.targets).forEach(function(e){return e.classList[n||wt?"add":"remove"](et.className)}),Qe&&!At&&!e&&Qe(Lt),f&&!p?(At&&(g&&("complete"===c?a.pause().totalProgress(1):"reset"===c?a.restart(!0).pause():"restart"===c?a.restart(!0):a[c]()),Qe&&Qe(Lt)),!d&&C||(rt&&d&&ie(Lt,rt),It[o]&&ie(Lt,It[o]),wt&&(1===w?Lt.kill(!1,1):It[o]=0),d||It[o=1===w?1:3]&&ie(Lt,It[o])),Et&&!n&&Math.abs(Lt.getVelocity())>(ee(Et)?Et:2500)&&(oe(Lt.callbackAnimation),Ce?Ce.progress(1):oe(a,"reverse"===c?1:!w,1))):At&&Qe&&!p&&Qe(Lt)}if(ce){var E=kt?y/kt.duration()*(kt._caScrollDist||0):y;le(E+(P._isFlipped?1:0)),ce(E)}Ke&&Ke(-y/kt.duration()*(kt._caScrollDist||0))}},Lt.enable=function(e,t){Lt.enabled||(Lt.enabled=!0,Fe(Mt,"resize",Ge),Fe(Rt?n:Mt,"scroll",je),Wt&&Fe(w,"refreshInit",Wt),!1!==e&&(Lt.progress=qe=0,v=m=Vt=Xt()),!1!==t&&Lt.refresh())},Lt.getTween=function(e){return e&&s?s.tween:Ce},Lt.setPositions=function(e,t){lt&&($+=e-_,re+=t-e-A,ct===ye&&Lt.adjustPinSpacing(t-e-A)),Lt.start=_=e,Lt.end=x=t,A=t-e,Lt.update()},Lt.adjustPinSpacing=function(e){if(se){var t=se.indexOf(Ct.d)+1;se[t]=parseFloat(se[t])+e+Se,se[1]=parseFloat(se[1])+e+Se,ht(se)}},Lt.disable=function(e,t){if(Lt.enabled&&(!1!==e&&Lt.revert(!0,!0),Lt.enabled=Lt.isActive=!1,t||Ce&&Ce.pause(),Xe=0,f&&(f.uncache=1),Wt&&Ie(w,"refreshInit",Wt),Le&&(Le.pause(),s.tween&&s.tween.kill()&&(s.tween=0)),!Rt)){for(var r=Ve.length;r--;)if(Ve[r].scroller===Mt&&Ve[r]!==Lt)return;Ie(Mt,"resize",Ge),Ie(Mt,"scroll",je)}},Lt.kill=function(e,r){Lt.disable(e,r),Ce&&!r&&Ce.kill(),tt&&delete Ye[tt];var n=Ve.indexOf(Lt);n>=0&&Ve.splice(n,1),n===g&&st>0&&g--,n=0,Ve.forEach(function(e){return e.scroller===Lt.scroller&&(n=1)}),n||M||(Lt.scroll.rec=0),a&&(a.scrollTrigger=null,e&&a.revert({kill:!1}),r||a.kill()),S&&[S,T,P,k].forEach(function(e){return e.parentNode&&e.parentNode.removeChild(e)}),R===Lt&&(R=0),lt&&(f&&(f.uncache=1),n=0,Ve.forEach(function(e){return e.pin===lt&&n++}),n||(f.spacer=0)),t.onKill&&t.onKill(Lt)},Lt.enable(!1,!1),Ze&&Ze(Lt),a&&a.add&&!A?e.delayedCall(.01,function(){return _||x||Lt.refresh()})&&(A=.01)&&(_=x=0):Lt.refresh(),lt&&ot()}else this.update=this.refresh=this.kill=q},w.register=function(r){return t||(e=r||X(),Y()&&window.document&&w.enable(),t=L),t},w.defaults=function(e){if(e)for(var t in e)Ne[t]=e[t];return Ne},w.disable=function(e,t){L=0,Ve.forEach(function(r){return r[t?"kill":"disable"](e)}),Ie(r,"wheel",je),Ie(n,"scroll",je),clearInterval(f),Ie(n,"touchcancel",q),Ie(i,"touchstart",q),Re(Ie,n,"pointerdown,touchstart,mousedown",W),Re(Ie,n,"pointerup,touchend,mouseup",H),s.kill(),$(Ie);for(var o=0;o<F._scrollers.length;o+=3)Be(Ie,F._scrollers[o],F._scrollers[o+1]),Be(Ie,F._scrollers[o],F._scrollers[o+2])},w.enable=function(){if(r=window,n=document,o=n.documentElement,i=n.body,e&&(l=e.utils.toArray,c=e.utils.clamp,E=e.core.context||q,b=e.core.suppressOverwrites||q,O=r.history.scrollRestoration||"auto",e.core.globals("ScrollTrigger",w),i)){L=1,F.Observer.register(e),w.isTouch=F.Observer.isTouch,k=F.Observer.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),Fe(r,"wheel",je),a=[r,n,o,i],e.matchMedia?(w.matchMedia=function(t){var r,n=e.matchMedia();for(r in t)n.add(r,t[r]);return n},e.addEventListener("matchMediaInit",function(){return tt()}),e.addEventListener("matchMediaRevert",function(){return et()}),e.addEventListener("matchMedia",function(){it(0,1),Je("matchMedia")}),e.matchMedia("(orientation: portrait)",function(){return Ue(),Ue})):console.warn("Requires GSAP 3.11.0 or later"),Ue(),Fe(n,"scroll",je);var u,p,d=i.style,g=d.borderTopStyle,y=e.core.Animation.prototype;for(y.revert||Object.defineProperty(y,"revert",{value:function(){return this.time(-.01,!0)}}),d.borderTopStyle="solid",u=Ee(i),F._vertical.m=Math.round(u.top+F._vertical.sc())||0,F._horizontal.m=Math.round(u.left+F._horizontal.sc())||0,g?d.borderTopStyle=g:d.removeProperty("border-top-style"),f=setInterval(Xe,250),e.delayedCall(.5,function(){return I=0}),Fe(n,"touchcancel",q),Fe(i,"touchstart",q),Re(Fe,n,"pointerdown,touchstart,mousedown",W),Re(Fe,n,"pointerup,touchend,mouseup",H),h=e.utils.checkPrefix("transform"),ut.push(h),t=B(),s=e.delayedCall(.2,it).pause(),_=[n,"visibilitychange",function(){var e=r.innerWidth,t=r.innerHeight;n.hidden?(v=e,m=t):v===e&&m===t||Ge()},n,"DOMContentLoaded",it,r,"load",it,r,"resize",Ge],$(Fe),Ve.forEach(function(e){return e.enable(0,1)}),p=0;p<F._scrollers.length;p+=3)Be(Ie,F._scrollers[p],F._scrollers[p+1]),Be(Ie,F._scrollers[p],F._scrollers[p+2])}},w.config=function(e){"limitCallbacks"in e&&(C=!!e.limitCallbacks);var t=e.syncInterval;t&&clearInterval(f)||(f=t)&&setInterval(Xe,t),"ignoreMobileResize"in e&&(S=1===w.isTouch&&e.ignoreMobileResize),"autoRefreshEvents"in e&&($(Ie)||$(Fe,e.autoRefreshEvents||"none"),x=-1===(e.autoRefreshEvents+"").indexOf("resize"))},w.scrollerProxy=function(e,t){var n=(0,F._getTarget)(e),a=F._scrollers.indexOf(n),s=j(n);~a&&F._scrollers.splice(a,s?6:2),t&&(s?F._proxies.unshift(r,t,i,t,o,t):F._proxies.unshift(n,t))},w.clearMatchMedia=function(e){Ve.forEach(function(t){return t._ctx&&t._ctx.query===e&&t._ctx.kill(!0,!0)})},w.isInViewport=function(e,t,n){var o=(J(e)?(0,F._getTarget)(e):e).getBoundingClientRect(),i=o[n?de:he]*t||0;return n?o.right-i>0&&o.left+i<r.innerWidth:o.bottom-i>0&&o.top+i<r.innerHeight},w.positionInViewport=function(e,t,n){J(e)&&(e=(0,F._getTarget)(e));var o=e.getBoundingClientRect(),i=o[n?de:he],a=null==t?i/2:t in Le?Le[t]*i:~t.indexOf("%")?parseFloat(t)*i/100:parseFloat(t)||0;return n?(o.left+a)/r.innerWidth:(o.top+a)/r.innerHeight},w.killAll=function(e){if(Ve.forEach(function(e){return"ScrollSmoother"!==e.vars.id&&e.kill()}),!0!==e){var t=Ke.killAll||[];Ke={},t.forEach(function(e){return e()})}},w}();exports.default=exports.ScrollTrigger=wt,wt.version="3.11.3",wt.saveStyles=function(t){return t?l(t).forEach(function(t){if(t&&t.style){var r=Qe.indexOf(t);r>=0&&Qe.splice(r,5),Qe.push(t,t.style.cssText,t.getBBox&&t.getAttribute("transform"),e.core.getCache(t),E())}}):Qe},wt.revert=function(e,t){return tt(!e,t)},wt.create=function(e,t){return new wt(e,t)},wt.refresh=function(e){return e?Ge():(t||wt.register())&&it(!0)},wt.update=lt,wt.clearScrollMemory=rt,wt.maxScroll=function(e,t){return Z(e,t?F._horizontal:F._vertical)},wt.getScrollFunc=function(e,t){return(0,F._getScrollFunc)((0,F._getTarget)(e),t?F._horizontal:F._vertical)},wt.getById=function(e){return Ye[e]},wt.getAll=function(){return Ve.filter(function(e){return"ScrollSmoother"!==e.vars.id})},wt.isScrolling=function(){return!!N},wt.snapDirectional=Me,wt.addEventListener=function(e,t){var r=Ke[e]||(Ke[e]=[]);~r.indexOf(t)||r.push(t)},wt.removeEventListener=function(e,t){var r=Ke[e],n=r&&r.indexOf(t);n>=0&&r.splice(n,1)},wt.batch=function(t,r){var n,o=[],i={},a=r.interval||.016,s=r.batchMax||1e9,c=function(t,r){var n=[],o=[],i=e.delayedCall(a,function(){r(n,o),n=[],o=[]}).pause();return function(e){n.length||i.restart(!0),n.push(e.trigger),o.push(e),s<=n.length&&i.progress(1)}};for(n in r)i[n]="on"===n.substr(0,2)&&Q(r[n])&&"onRefreshInit"!==n?c(0,r[n]):r[n];return Q(s)&&(s=s(),Fe(wt,"refresh",function(){return s=r.batchMax()})),l(t).forEach(function(e){var t={};for(n in i)t[n]=i[n];t.trigger=e,o.push(wt.create(t))}),o};var St,Tt=function(e,t,r,n){return t>n?e(n):t<0&&e(0),r>n?(n-t)/(r-t):r<0?t/(t-r):1},Pt=function e(t,r){!0===r?t.style.removeProperty("touch-action"):t.style.touchAction=!0===r?"auto":r?"pan-"+r+(F.Observer.isTouch?" pinch-zoom":""):"none",t===o&&e(i,r)},kt={auto:1,scroll:1},Et=function(t){var r,n=t.event,o=t.target,i=t.axis,a=(n.changedTouches?n.changedTouches[0]:n).target,s=a._gsap||e.core.getCache(a),l=B();if(!s._isScrollT||l-s._isScrollT>2e3){for(;a&&a.scrollHeight<=a.clientHeight;)a=a.parentNode;s._isScroll=a&&!j(a)&&a!==o&&(kt[(r=Te(a)).overflowY]||kt[r.overflowX]),s._isScrollT=l}(s._isScroll||"x"===i)&&(n.stopPropagation(),n._gsapAllow=!0)},Ot=function(e,t,r,o){return F.Observer.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:o=o&&Et,onPress:o,onDrag:o,onScroll:o,onEnable:function(){return r&&Fe(n,F.Observer.eventTypes[0],At,!1,!0)},onDisable:function(){return Ie(n,F.Observer.eventTypes[0],At,!0)}})},Ct=/(input|label|select|textarea)/i,At=function(e){var t=Ct.test(e.target.tagName);(t||St)&&(e._gsapAllow=!0,St=t)},Mt=function(t){te(t)||(t={}),t.preventDefault=t.isNormalizer=t.allowClicks=!0,t.type||(t.type="wheel,touch"),t.debounce=!!t.debounce,t.id=t.id||"normalizer";var n,i,a,s,l,u,f,p,d=t,h=d.normalizeScrollX,g=d.momentum,v=d.allowNestedScroll,m=(0,F._getTarget)(t.target)||o,_=e.core.globals().ScrollSmoother,y=_&&_.get(),b=k&&(t.content&&(0,F._getTarget)(t.content)||y&&!1!==t.content&&!y.smooth()&&y.content()),x=(0,F._getScrollFunc)(m,F._vertical),w=(0,F._getScrollFunc)(m,F._horizontal),S=1,T=(F.Observer.isTouch&&r.visualViewport?r.visualViewport.scale*r.visualViewport.width:r.outerWidth)/r.innerWidth,P=0,E=Q(g)?function(){return g(n)}:function(){return g||2.8},O=Ot(m,t.type,!0,v),C=function(){return s=!1},A=q,M=q,z=function(){i=Z(m,F._vertical),M=c(k?1:0,i),h&&(A=c(0,Z(m,F._horizontal))),a=nt},R=function(){b._gsap.y=V(parseFloat(b._gsap.y)+x.offset)+"px",b.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(b._gsap.y)+", 0, 1)",x.offset=x.cacheID=0},I=function(){z(),l.isActive()&&l.vars.scrollY>i&&(x()>i?l.progress(1)&&x(i):l.resetTo("scrollY",i))};return b&&e.set(b,{y:"+=0"}),t.ignoreCheck=function(e){return k&&"touchmove"===e.type&&function(){if(s){requestAnimationFrame(C);var e=V(n.deltaY/2),t=M(x.v-e);if(b&&t!==x.v+x.offset){x.offset=t-x.v;var r=V((parseFloat(b&&b._gsap.y)||0)-x.offset);b.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+r+", 0, 1)",b._gsap.y=r+"px",x.cacheID=F._scrollers.cache,lt()}return!0}x.offset&&R(),s=!0}()||S>1.05&&"touchstart"!==e.type||n.isGesturing||e.touches&&e.touches.length>1},t.onPress=function(){var e=S;S=V((r.visualViewport&&r.visualViewport.scale||1)/T),l.pause(),e!==S&&Pt(m,S>1.01||!h&&"x"),u=w(),f=x(),z(),a=nt},t.onRelease=t.onGestureStart=function(t,r){if(x.offset&&R(),r){F._scrollers.cache++;var n,o,a=E();h&&(o=(n=w())+.05*a*-t.velocityX/.227,a*=Tt(w,n,o,Z(m,F._horizontal)),l.vars.scrollX=A(o)),o=(n=x())+.05*a*-t.velocityY/.227,a*=Tt(x,n,o,Z(m,F._vertical)),l.vars.scrollY=M(o),l.invalidate().duration(a).play(.01),(k&&l.vars.scrollY>=i||n>=i-1)&&e.to({},{onUpdate:I,duration:a})}else p.restart(!0)},t.onWheel=function(){l._ts&&l.pause(),B()-P>1e3&&(a=0,P=B())},t.onChange=function(e,t,r,n,o){if(nt!==a&&z(),t&&h&&w(A(n[2]===t?u+(e.startX-e.x):w()+t-n[1])),r){x.offset&&R();var i=o[2]===r,s=i?f+e.startY-e.y:x()+r-o[1],l=M(s);i&&s!==l&&(f+=l-s),x(l)}(r||t)&&lt()},t.onEnable=function(){Pt(m,!h&&"x"),wt.addEventListener("refresh",I),Fe(r,"resize",I),x.smooth&&(x.target.style.scrollBehavior="auto",x.smooth=w.smooth=!1),O.enable()},t.onDisable=function(){Pt(m,!0),Ie(r,"resize",I),wt.removeEventListener("refresh",I),O.kill()},t.lockAxis=!1!==t.lockAxis,(n=new F.Observer(t)).iOS=k,k&&!x()&&x(1),k&&e.ticker.add(q),p=n._dc,l=e.to(n,{ease:"power4",paused:!0,scrollX:h?"+=0.1":"+=0",scrollY:"+=0.1",onComplete:p.vars.onComplete}),n};wt.sort=function(e){return Ve.sort(e||function(e,t){return-1e6*(e.vars.refreshPriority||0)+e.start-(t.start+-1e6*(t.vars.refreshPriority||0))})},wt.observe=function(e){return new F.Observer(e)},wt.normalizeScroll=function(e){if(void 0===e)return w;if(!0===e&&w)return w.enable();if(!1===e)return w&&w.kill();var t=e instanceof F.Observer?e:Mt(e);return w&&w.target===t.target&&w.kill(),j(t.target)&&(w=t),t},wt.core={_getVelocityProp:F._getVelocityProp,_inputObserver:Ot,_scrollers:F._scrollers,_proxies:F._proxies,bridge:{ss:function(){N||Je("scrollStart"),N=B()},ref:function(){return p}}},X()&&e.registerPlugin(wt);
},{"./Observer.js":"sFbG"}],"B6dB":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function l(e){try{c(r.next(e))}catch(t){i(t)}}function a(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,a)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=(o=l.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("webgi");require("./styles.css");var o=n(require("gsap")),i=require("gsap/ScrollTrigger");function l(){var n,i,l,a,c,u,s,d;return e(this,void 0,void 0,function(){function e(){S=!0,f.setDirty()}function g(){h.style.visibility="visible",w.style.visibility="false",f.scene.activeCamera.setCameraOptions({controlsEnabled:!0})}function m(e){P.color=e,f.scene.setDirty()}var f,p,v,y,b,h,w,P,S,T,E;return t(this,function(t){switch(t.label){case 0:return[4,(f=new r.ViewerApp({canvas:document.getElementById("webgi-canvas")})).addPlugin(r.AssetManagerPlugin)];case 1:return p=t.sent(),v=f.scene.activeCamera,y=v.position,b=v.target,h=document.querySelector(".button--exit"),w=document.querySelector(".customizer--container"),[4,f.addPlugin(r.GBufferPlugin)];case 2:return t.sent(),[4,f.addPlugin(new r.ProgressivePlugin(32))];case 3:return t.sent(),[4,f.addPlugin(new r.TonemapPlugin(!0))];case 4:return t.sent(),[4,f.addPlugin(r.GammaCorrectionPlugin)];case 5:return t.sent(),[4,f.addPlugin(r.SSRPlugin)];case 6:return t.sent(),[4,f.addPlugin(r.SSAOPlugin)];case 7:return t.sent(),[4,f.addPlugin(r.BloomPlugin)];case 8:return t.sent(),[4,f.addPlugin(r.TemporalAAPlugin)];case 9:return t.sent(),f.renderer.refreshPipeline(),[4,p.addFromPath("./assets/mp4.glb")];case 10:return t.sent(),P=p.materials.findMaterialsByName("Drill_01")[0],f.getPlugin(r.TonemapPlugin).config.clipBackground=!0,f.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),e(),(k=o.default.timeline()).to(y,{x:.61,y:.12,z:-3.04,scrollTrigger:{trigger:".second",start:"top bottom",end:"+=100%",scrub:!0,immediateRender:!1,markers:!1},onUpdate:e}).to(".section--one--container",{xPercent:"-150",opacity:0,scrollTrigger:{trigger:".second",start:"top bottom",end:"+=100%",scrub:!0,immediateRender:!1}}).to(b,{x:-.67,y:-.21,z:.09,scrollTrigger:{trigger:".second",start:"top bottom",end:"+=100%",scrub:!0,immediateRender:!1}}),k.to(y,{x:3.1,y:4.82,z:-3.6,scrollTrigger:{trigger:".third",start:"top bottom",end:"+=100%",scrub:!0,immediateRender:!1,markers:!1},onUpdate:e}).to(b,{x:.71,y:-.7,z:.5,scrollTrigger:{trigger:".third",start:"top bottom",end:"+=100%",scrub:!0,immediateRender:!1}}).to(y,{x:2.03,y:.31,z:3.9,scrollTrigger:{trigger:".fourth",start:"top bottom",end:"top top",scrub:!0,immediateRender:!1},onUpdate:e}).to(b,{x:.25,y:.12,z:.26,scrollTrigger:{trigger:".fourth",start:"top bottom",end:"+=100%",scrub:!0,immediateRender:!1}}),S=!0,f.addEventListener("preFrame",function(){S&&(v.positionTargetUpdated(!0),S=!1)}),null===(n=document.querySelector(".button--hero"))||void 0===n||n.addEventListener("click",function(){var e=document.querySelector(".second");window.scrollTo({top:null==e?void 0:e.getBoundingClientRect().top,left:0,behavior:"smooth"})}),null===(i=document.querySelector(".button--second"))||void 0===i||i.addEventListener("click",function(){var e=document.querySelector(".third");window.scrollTo({top:null==e?void 0:e.getBoundingClientRect().bottom,left:0,behavior:"smooth"})}),null===(l=document.querySelector(".button--third"))||void 0===l||l.addEventListener("click",function(){var e=document.querySelector(".fourth");window.scrollTo({top:null==e?void 0:e.getBoundingClientRect().bottom,left:0,behavior:"smooth"}),console.log("click")}),null===(a=document.querySelectorAll(".button--footer"))||void 0===a||a.forEach(function(e){e.addEventListener("click",function(){window.scrollTo({top:0,left:0,behavior:"smooth"})})}),T=document.querySelector(".container"),E=document.getElementById("webgi-canvas-container"),null===(c=document.querySelector(".button--customize"))||void 0===c||c.addEventListener("click",function(){T.style.visibility="hidden",E.style.pointerEvents="all",document.body.style.cursor="grab",o.default.to(y,{x:3,y:1.7,z:-3.9,duration:2,ease:"power3.inOut",onUpdate:e}),o.default.to(b,{x:-.08,y:-.32,z:-.15,duration:2,ease:"power3.inOut",onUpdate:e,onComplete:g})}),h.addEventListener("click",function(){o.default.to(y,{x:2.03,y:.31,z:3.9,duration:1,ease:"power3.inOut",onUpdate:e}),o.default.to(b,{x:.25,y:.12,z:.26,duration:1,ease:"power3.inOut",onUpdate:e}),f.scene.activeCamera.setCameraOptions({controlsEnabled:!1}),T.style.visibility="visible",E.style.pointerEvents="none",document.body.style.cursor="default",h.style.visibility="hidden",w.style.visibility="hidden"}),null===(u=document.querySelector(".button--colors.black"))||void 0===u||u.addEventListener("click",function(){m(new r.Color(3684400).convertSRGBToLinear())}),null===(s=document.querySelector(".button--colors.red"))||void 0===s||s.addEventListener("click",function(){m(new r.Color(16657709).convertSRGBToLinear())}),null===(d=document.querySelector(".button--colors.yellow"))||void 0===d||d.addEventListener("click",function(){m(new r.Color(16777215).convertSRGBToLinear())}),[2]}var k})})}o.default.registerPlugin(i.ScrollTrigger),l();
},{"webgi":"rbXN","./styles.css":"D9Nj","gsap":"f8Z0","gsap/ScrollTrigger":"rpvU"}]},{},["B6dB"], null)
//# sourceMappingURL=https://github.com/darioparrinello/mclaren/src.995ec4ca.js.map